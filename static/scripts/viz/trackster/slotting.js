define(["exports","libs/underscore"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};s.get||s.set?Object.defineProperty(e,r,s):e[r]=t[r]}return e.default=t,e}}(e).extend,g=function(t,e){this.slot=t,this.feature=e},s=function(t,e,r,s){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=r,this.measureText=s};r(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),r=Math.ceil(t[2]*this.w_scale),s=t[3];if(void 0!==s&&this.include_label){var i=this.measureText(s).width+7;0<=e-i?e-=i:r+=i}return[e,r]},_find_slot:function(t){for(var e=t[0],r=t[1],s=0;s<=this.max_rows;s++){var i=!1,o=this.start_end_dct[s];if(void 0!==o)for(var a=0,n=o.length;a<n;a++){var l=o[a];if(r>l[0]&&e<l[1]){i=!0;break}}if(!i)return s}return-1},slot_features:function(t){for(var e,r,s=this.start_end_dct,i=[],o=0,a=0,n=t.length;a<n;a++){r=(e=t[a])[0];var l=this.slots[r];if(l){if(e[1]<l.feature[1]||l.feature[2]<e[2])for(var f=this._get_draw_coords(l.feature),h=this._get_draw_coords(e),_=this.start_end_dct[l.slot],d=0;d<_.length;d++){var c=_[d];c[0]===f[0]&&c[1]===f[1]&&(_[d]=h)}o=Math.max(o,this.slots[r].slot)}else i.push(a)}for(var u=0,v=i.length;u<v;u++){r=(e=t[i[u]])[0];var p=this._get_draw_coords(e),w=this._find_slot(p);0<=w&&(void 0===s[w]&&(s[w]=[]),s[w].push(p),this.slots[r]=new g(w,e),o=Math.max(o,w))}return o+1}}),t.default={FeatureSlotter:s}});