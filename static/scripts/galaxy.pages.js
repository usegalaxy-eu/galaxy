define(["exports","utils/localization","mvc/grid/grid-view","libs/jquery/jquery.form","libs/jquery/jquery.wymeditor","libs/jquery/jquery.autocomplete"],function(e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){$(document).ajaxError(function(e,t){var a=t.responseText||t.statusText||"Could not connect to server";return show_modal("Server error",a,{"Ignore error":hide_modal}),!1}),$("[name=page_content]").wymeditor({skin:"galaxy",basePath:editor_base_path,iframeBasePath:iframe_base_path,boxHtml:"<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>".concat(d.TOOLS,"</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>").concat(d.IFRAME).concat(d.STATUS,"</div></div></td></tr></table>"),toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:(0,n.default)("Superscript"),css:"wym_tools_superscript"},{name:"Subscript",title:(0,n.default)("Subscript"),css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"}]});var i=$.wymeditors(0),e=function(e){show_modal("Saving page","progress"),$.ajax({url:save_url,type:"POST",data:{id:page_id,content:i.xhtml(),annotations:JSON.stringify(new Object),_:"true"},success:function(){e()}})};$("#save-button").click(function(){e(function(){hide_modal()})}),$("#close-button").click(function(){window.document.location=page_list_url});var t=$("<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>");$(".wym_area_top").append(t);var o={};$.each(i._options.containersItems,function(e,t){var a=t.name;o[t.title.replace("_"," ")]=function(){i.container(a)}}),make_popupmenu(t,o);var a=$("<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>").addClass("galaxy-page-editor-button");$(".wym_area_top").append(a),make_popupmenu(a,{"Insert History Link":function(){i.dialog(I.DIALOG_HISTORY_LINK)},"Insert Dataset Link":function(){i.dialog(I.DIALOG_DATASET_LINK)},"Insert Workflow Link":function(){i.dialog(I.DIALOG_WORKFLOW_LINK)},"Insert Page Link":function(){i.dialog(I.DIALOG_PAGE_LINK)},"Insert Visualization Link":function(){i.dialog(I.DIALOG_VISUALIZATION_LINK)}});var l=$("<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>").addClass("galaxy-page-editor-button");$(".wym_area_top").append(l),make_popupmenu(l,{"Embed History":function(){i.dialog(I.DIALOG_EMBED_HISTORY)},"Embed Dataset":function(){i.dialog(I.DIALOG_EMBED_DATASET)},"Embed Workflow":function(){i.dialog(I.DIALOG_EMBED_WORKFLOW)},"Embed Visualization":function(){i.dialog(I.DIALOG_EMBED_VISUALIZATION)}})};var n=i(t),_=i(a);function i(e){return e&&e.__esModule?e:{default:e}}var d=window.WYMeditor,I={ITEM_HISTORY:"item_history",ITEM_DATASET:"item_dataset",ITEM_WORKFLOW:"item_workflow",ITEM_PAGE:"item_page",ITEM_VISUALIZATION:"item_visualization",DIALOG_HISTORY_LINK:"link_history",DIALOG_DATASET_LINK:"link_dataset",DIALOG_WORKFLOW_LINK:"link_workflow",DIALOG_PAGE_LINK:"link_page",DIALOG_VISUALIZATION_LINK:"link_visualization",DIALOG_EMBED_HISTORY:"embed_history",DIALOG_EMBED_DATASET:"embed_dataset",DIALOG_EMBED_WORKFLOW:"embed_workflow",DIALOG_EMBED_PAGE:"embed_page",DIALOG_EMBED_VISUALIZATION:"embed_visualization"};function u(e){var t,a,i,o;switch(e){case I.ITEM_HISTORY:a="Histories",i="history",o=t="History";break;case I.ITEM_DATASET:t="Dataset",a="Datasets",i="dataset",o="HistoryDatasetAssociation";break;case I.ITEM_WORKFLOW:t="Workflow",a="Workflows",i="workflow",o="StoredWorkflow";break;case I.ITEM_PAGE:a="Pages",i="page",o=t="Page";break;case I.ITEM_VISUALIZATION:a="Visualizations",i="visualization",o=t="Visualization"}var l="list_".concat(a.toLowerCase(),"_for_selection");return{singular:t,plural:a,controller:i,iclass:o,list_ajax_url:list_objects_url.replace("LIST_ACTION",l)}}function m(e,t,a){var i=set_accessible_url.replace("ITEM_CONTROLLER",e);$.ajax({type:"POST",url:i,data:{id:t,accessible:"True"},error:function(){alert("Making ".concat(a," accessible failed"))}})}d.editor.prototype.dialog=function(e,t,a){var i,o,r=this,l=r.uniqueStamp(),n=r.selected();e==d.DIALOG_LINK&&(n&&($(r._options.hrefSelector).val($(n).attr(d.HREF)),$(r._options.srcSelector).val($(n).attr(d.SRC)),$(r._options.titleSelector).val($(n).attr(d.TITLE)),$(r._options.altSelector).val($(n).attr(d.ALT))),n&&(null==(i=$(n).attr("href"))&&(i=""),null==(o=$(n).attr("title"))&&(o="")),show_modal("Create Link","<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='".concat(i,"' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='").concat(o,"' size='40' /></div><div>"),{"Make link":function(){var e=$(r._options.hrefSelector).val()||"",t=$(".wym_id").val()||"",a=$(r._options.titleSelector).val()||"";if(e||t){r._exec(d.CREATE_LINK,l);var i=$("a[href=".concat(l,"]"),r._doc.body);i.attr(d.HREF,e).attr(d.TITLE,a).attr("id",t),0===i.text().indexOf("wym-")&&i.text(a)}hide_modal()},Cancel:function(){hide_modal()}},{},function(){$("#set_link_id").click(function(){$("#link_attribute_label").text("ID/Name");var e=$(".wym_href");e.addClass("wym_id").removeClass("wym_href"),n&&e.val($(n).attr("id")),$(this).remove()})}));if(e==d.DIALOG_IMAGE)return r._selected_image&&($("".concat(r._options.dialogImageSelector," ").concat(r._options.srcSelector)).val($(r._selected_image).attr(d.SRC)),$("".concat(r._options.dialogImageSelector," ").concat(r._options.titleSelector)).val($(r._selected_image).attr(d.TITLE)),$("".concat(r._options.dialogImageSelector," ").concat(r._options.altSelector)).val($(r._selected_image).attr(d.ALT))),void show_modal("Image","<div class='row'><label>URL</label><br><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>Alt text</label><br><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>Title</label><br><input type='text' class='wym_title' value='' size='40' /></div>",{Insert:function(){var e=$(r._options.srcSelector).val();0<e.length&&(r._exec(d.INSERT_IMAGE,l),$("img[src$=".concat(l,"]"),r._doc.body).attr(d.SRC,e).attr(d.TITLE,$(r._options.titleSelector).val()).attr(d.ALT,$(r._options.altSelector).val())),hide_modal()},Cancel:function(){hide_modal()}});if(e==d.DIALOG_TABLE&&show_modal("Table","<div class='row'><label>Caption</label><br><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>Summary</label><br><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>Number Of Rows<br></label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>Number Of Cols<br></label><input type='text' class='wym_cols' value='2' size='3' /></div>",{Insert:function(){var e=$(r._options.rowsSelector).val(),t=$(r._options.colsSelector).val();if(0<e&&0<t){var a=r._doc.createElement(d.TABLE),i=null,o=$(r._options.captionSelector).val();a.createCaption().innerHTML=o;for(var l=0;l<e;l++){i=a.insertRow(l);for(var n=0;n<t;n++)i.insertCell(n)}$(a).attr("summary",$(r._options.summarySelector).val());var s=$(r.findUp(r.container(),d.MAIN_CONTAINERS)).get(0);s&&s.parentNode?$(s).after(a):$(r._doc.body).append(a)}hide_modal()},Cancel:function(){hide_modal()}}),e==I.DIALOG_HISTORY_LINK||e==I.DIALOG_DATASET_LINK||e==I.DIALOG_WORKFLOW_LINK||e==I.DIALOG_PAGE_LINK||e==I.DIALOG_VISUALIZATION_LINK){switch(e){case I.DIALOG_HISTORY_LINK:c=u(I.ITEM_HISTORY);break;case I.DIALOG_DATASET_LINK:c=u(I.ITEM_DATASET);break;case I.DIALOG_WORKFLOW_LINK:c=u(I.ITEM_WORKFLOW);break;case I.DIALOG_PAGE_LINK:c=u(I.ITEM_PAGE);break;case I.DIALOG_VISUALIZATION_LINK:c=u(I.ITEM_VISUALIZATION)}var s=new _.default({url_base:c.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to ".concat(c.singular),body:$("<div/>").append(s.$el).append($("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected ".concat(c.plural.toLowerCase()," accessible so that they can viewed by everyone."))),closing_events:!0,buttons:{Insert:function(){var t=!1;null!=$("#make-importable:checked").val()&&(t=!0);new Array;s.$("input[name=id]:checked").each(function(){var a=$(this).val();t&&m(c.controller,a,c.singular);var e=(get_name_and_link_url+a).replace("ITEM_CONTROLLER",c.controller);$.getJSON(e,function(e){r._exec(d.CREATE_LINK,l);var t=$("a[href=".concat(l,"]"),r._doc.body).text();""==t||t==l?r.insert("<a href='".concat(e.link,"'>").concat(c.singular," '").concat(e.name,"'</a>")):$("a[href=".concat(l,"]"),r._doc.body).attr(d.HREF,e.link).attr(d.TITLE,c.singular+a)})}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}if(e==I.DIALOG_EMBED_HISTORY||e==I.DIALOG_EMBED_DATASET||e==I.DIALOG_EMBED_WORKFLOW||e==I.DIALOG_EMBED_PAGE||e==I.DIALOG_EMBED_VISUALIZATION){var c;switch(e){case I.DIALOG_EMBED_HISTORY:c=u(I.ITEM_HISTORY);break;case I.DIALOG_EMBED_DATASET:c=u(I.ITEM_DATASET);break;case I.DIALOG_EMBED_WORKFLOW:c=u(I.ITEM_WORKFLOW);break;case I.DIALOG_EMBED_PAGE:c=u(I.ITEM_PAGE);break;case I.DIALOG_EMBED_VISUALIZATION:c=u(I.ITEM_VISUALIZATION)}s=new _.default({url_base:c.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to ".concat(c.singular),body:$("<div/>").append(s.$el).append($("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected ".concat(c.plural.toLowerCase()," accessible so that they can viewed by everyone."))),closing_events:!0,buttons:{Embed:function(){var o=!1;null!=$("#make-importable:checked").val()&&(o=!0),s.$("input[name=id]:checked").each(function(){var e=$(this),t=e.val(),a=e.closest("td").next("td").find("label").text();o&&m(c.controller,t,c.singular);var i=["<div id='","".concat(c.iclass,"-").concat(t),"' class='embedded-item ",c.singular.toLowerCase()," placeholder'>","<p class='title'>","Embedded Galaxy ",c.singular," '",a,"'","</p>","<p class='content'>","[Do not edit this block; Galaxy will fill it in with the annotated ",c.singular.toLowerCase()," when it is displayed.]","</p>","</div>"].join("");r.insert(i)}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}}});