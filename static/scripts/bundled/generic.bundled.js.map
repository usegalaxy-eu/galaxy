{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./galaxy/scripts/mvc/ui/ui-slider.js","webpack:///./galaxy/scripts/mvc/ui/ui-options.js","webpack:///./galaxy/scripts/mvc/ui/ui-drilldown.js","webpack:///./galaxy/scripts/mvc/ui/ui-misc.js","webpack:///./galaxy/scripts/mvc/history/job-states-model.js","webpack:///./galaxy/scripts/mvc/form/form-repeat.js","webpack:///./galaxy/scripts/mvc/history/history-content-model.js","webpack:///./galaxy/scripts/mvc/collection/pair-collection-creator.js","webpack:///./galaxy/scripts/mvc/base/controlled-fetch-collection.js","webpack:///./galaxy/scripts/mvc/list/list-view.js","webpack:///./galaxy/scripts/mvc/history/hda-li.js","webpack:///./galaxy/scripts/mvc/history/hdca-li.js","webpack:///./galaxy/scripts/mvc/annotation.js","webpack:///./galaxy/scripts/components/Nametags/Nametags.vue?17f6","webpack:///./galaxy/scripts/components/Nametags/Nametag.vue?360e","webpack:///galaxy/scripts/components/Nametags/Nametag.vue","webpack:///./galaxy/scripts/components/Nametags/Nametag.vue","webpack:///./galaxy/scripts/components/Nametags/Nametag.vue?6b51","webpack:///galaxy/scripts/components/Nametags/Nametags.vue","webpack:///./galaxy/scripts/components/Nametags/Nametags.vue?1e85","webpack:///./galaxy/scripts/components/Nametags/Nametags.vue","webpack:///./galaxy/scripts/components/Nametags/index.js","webpack:///./galaxy/scripts/mvc/dataset/states.js","webpack:///./galaxy/scripts/utils/levenshtein.js","webpack:///./galaxy/scripts/utils/natural-sort.js","webpack:///./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js","webpack:///./galaxy/scripts/mvc/tours.js","webpack:///./galaxy/scripts/layout/communication-server-view.js","webpack:///./galaxy/scripts/layout/menu.js","webpack:///./galaxy/scripts/mvc/ui/ui-frames.js","webpack:///./galaxy/scripts/layout/scratchbook.js","webpack:///./galaxy/scripts/mvc/user/user-quotameter.js","webpack:///./galaxy/scripts/layout/masthead.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-icons.js","webpack:///./galaxy/scripts/viz/visualization.js","webpack:///./galaxy/scripts/ui/search-input.js","webpack:///./galaxy/scripts/mvc/tool/tool-form-base.js","webpack:///./galaxy/scripts/utils/metrics-logger.js","webpack:///./galaxy/scripts/components/Citations.vue?a913","webpack:///./galaxy/scripts/components/Citations.vue?4cfa","webpack:///galaxy/scripts/components/Citations.vue","webpack:///./galaxy/scripts/components/Citations.vue","webpack:///./galaxy/scripts/ui/hoverhighlight.js","webpack:///./galaxy/scripts/legacy/grid/grid-model.js","webpack:///./galaxy/scripts/mvc/ui/ui-select.js","webpack:///./galaxy/scripts/polyfills.js","webpack:///./galaxy/scripts/bundleEntries.js","webpack:///./galaxy/scripts/nls/locale.js","webpack:///./galaxy/scripts/ui/popupmenu.js","webpack:///./galaxy/scripts/components/Citations.vue?22ab","webpack:///./galaxy/scripts/components/Nametags/Nametag.vue?cfbd","webpack:///./galaxy/scripts/components/Nametags/Nametags.vue?171f","webpack:///./galaxy/scripts/components/Tags/StatelessTags.vue?0fec","webpack:///./galaxy/scripts/components/Masthead/index.vue?b9cb","webpack:///./galaxy/scripts/mvc/workflow/workflow-connector.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-manager.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-canvas.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-terminals.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-view-terminals.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-view-data.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-view-node.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-node.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-forms.js","webpack:///./galaxy/scripts/layout/modal.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-view.js","webpack:///./galaxy/scripts/viz/circster.js","webpack:///./galaxy/scripts/viz/phyloviz.js","webpack:///./galaxy/scripts/viz/sweepster.js","webpack:///./galaxy/scripts/mvc/library/library-util.js","webpack:///./galaxy/scripts/mvc/library/library-model.js","webpack:///./galaxy/scripts/mvc/library/library-dataset-view.js","webpack:///./galaxy/scripts/mvc/library/library-folderrow-view.js","webpack:///./galaxy/scripts/mvc/library/library-folderlist-view.js","webpack:///./galaxy/scripts/mvc/library/library-libraryrow-view.js","webpack:///./galaxy/scripts/mvc/library/library-librarylist-view.js","webpack:///./galaxy/scripts/mvc/library/library-librarytoolbar-view.js","webpack:///./galaxy/scripts/mvc/library/library-foldertoolbar-view.js","webpack:///./galaxy/scripts/mvc/library/library-library-view.js","webpack:///./galaxy/scripts/mvc/library/library-folder-view.js","webpack:///./galaxy/scripts/galaxy.library.js","webpack:///./galaxy/scripts/mvc/toolshed/toolshed-model.js","webpack:///./galaxy/scripts/mvc/toolshed/util.js","webpack:///./galaxy/scripts/mvc/toolshed/shed-list-view.js","webpack:///./galaxy/scripts/mvc/toolshed/categories-view.js","webpack:///./galaxy/scripts/mvc/toolshed/repositories-view.js","webpack:///./galaxy/scripts/mvc/toolshed/repository-view.js","webpack:///./galaxy/scripts/mvc/toolshed/repository-queue-view.js","webpack:///./galaxy/scripts/mvc/toolshed/repo-status-view.js","webpack:///./galaxy/scripts/mvc/toolshed/workflows-view.js","webpack:///./galaxy/scripts/admin.toolshed.js","webpack:///./galaxy/scripts/galaxy.pages.js","webpack:///./galaxy/scripts/utils/genericConfig.js","webpack:///./galaxy/scripts/mvc/history/multi-panel.js","webpack:///./galaxy/scripts/mvc/history/history-view-annotated.js","webpack:///./galaxy/scripts/legacy/grid/grid-view.js","webpack:///./galaxy/scripts/reports/run_stats.js","webpack:///./galaxy/scripts/toolshed/groups/group-model.js","webpack:///./galaxy/scripts/toolshed/groups/group-listrow-view.js","webpack:///./galaxy/scripts/toolshed/groups/group-list-view.js","webpack:///./galaxy/scripts/toolshed/groups/group-detail-view.js","webpack:///./galaxy/scripts/toolshed/toolshed.groups.js","webpack:///./galaxy/scripts/mvc/visualization/visualization-model.js","webpack:///./galaxy/scripts/mvc/visualization/chart/components/model.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/groups.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/settings.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/description.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/editor.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/viewer.js","webpack:///./galaxy/scripts/mvc/visualization/chart/components/screenshot.js","webpack:///./galaxy/scripts/mvc/visualization/chart/views/menu.js","webpack:///./galaxy/scripts/mvc/visualization/chart/chart-client.js","webpack:///./galaxy/scripts/mvc/visualization/chart/utilities/datasets.js","webpack:///./galaxy/scripts/mvc/visualization/chart/utilities/series.js","webpack:///./galaxy/scripts/mvc/visualization/chart/utilities/jobs.js","webpack:///./galaxy/scripts/components/Masthead/index.vue?9243","webpack:///galaxy/scripts/components/Masthead/index.vue","webpack:///./galaxy/scripts/components/Masthead/index.vue","webpack:///./galaxy/scripts/components/Masthead/index.vue?43f2","webpack:///./galaxy/scripts/components/Masthead/initMasthead.js","webpack:///./galaxy/scripts/onload/globalInits/panelManagement.js","webpack:///./galaxy/scripts/onload/defaultConfigs.js","webpack:///./galaxy/scripts/onload/loadConfig.js","webpack:///./galaxy/scripts/utils/localization.js","webpack:///./galaxy/scripts/viz/trackster/util.js","webpack:///./galaxy/scripts/mvc/ui/ui-modal.js","webpack:///./galaxy/scripts/mvc/dataset/data.js","webpack:///./galaxy/scripts/ui/fa-icon-button.js","webpack:///./galaxy/scripts/mvc/form/form-input.js","webpack:///./galaxy/scripts/mvc/ui/ui-select-content.js","webpack:///./galaxy/scripts/mvc/ui/ui-list.js","webpack:///./galaxy/scripts/mvc/ui/ui-select-library.js","webpack:///./galaxy/scripts/mvc/ui/ui-select-ftp.js","webpack:///./galaxy/scripts/mvc/tool/tool-genomespace.js","webpack:///./galaxy/scripts/mvc/ui/ui-select-genomespace.js","webpack:///galaxy/scripts/components/RulesDisplay.vue","webpack:///./galaxy/scripts/components/RulesDisplay.vue?73bb","webpack:///./galaxy/scripts/components/RulesDisplay.vue","webpack:///./galaxy/scripts/components/RulesDisplay.vue?c46d","webpack:///./galaxy/scripts/mvc/ui/ui-rules-edit.js","webpack:///./galaxy/scripts/mvc/ui/ui-color-picker.js","webpack:///./galaxy/scripts/mvc/form/form-parameters.js","webpack:///./galaxy/scripts/mvc/form/form-section.js","webpack:///./galaxy/scripts/mvc/form/form-view.js","webpack:///./galaxy/scripts/mvc/list/list-item.js","webpack:///./galaxy/scripts/mvc/ui/icon-button.js","webpack:///./galaxy/scripts/mvc/ui/ui-buttons.js","webpack:///./galaxy/scripts/mvc/collection/list-collection-creator.js","webpack:///./galaxy/scripts/utils/query-string-parsing.js","webpack:///./galaxy/scripts/onload/initQueue.js","webpack:///./galaxy/scripts/utils/config.js","webpack:///./galaxy/scripts/mvc/history/hda-model.js","webpack:///./galaxy/scripts/mvc/grid/grid-model.js","webpack:///./galaxy/scripts/mvc/grid/grid-template.js","webpack:///./galaxy/scripts/mvc/grid/grid-view.js","webpack:///./galaxy/scripts/mvc/ui/error-modal.js","webpack:///./galaxy/scripts/utils/serverPath.js","webpack:///./galaxy/scripts/mvc/collection/collection-li.js","webpack:///./galaxy/scripts/mvc/history/history-model.js","webpack:///./galaxy/scripts/mvc/tool/tools.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li.js","webpack:///./galaxy/scripts/viz/viz_views.js","webpack:///./galaxy/scripts/viz/trackster/slotting.js","webpack:///./galaxy/scripts/viz/trackster/painters.js","webpack:///./galaxy/scripts/viz/trackster/filters.js","webpack:///./galaxy/scripts/viz/bbi-data-manager.js","webpack:///./galaxy/scripts/viz/trackster/tracks.js","webpack:///./galaxy/scripts/components/Tags/StatelessTags.vue?ec8f","webpack:///./galaxy/scripts/components/Tags/model.js","webpack:///./galaxy/scripts/components/Tags/StatelessTags.vue?244e","webpack:///galaxy/scripts/components/Tags/StatelessTags.vue","webpack:///./galaxy/scripts/components/Tags/StatelessTags.vue","webpack:///./galaxy/scripts/components/Tags/tagService.js","webpack:///galaxy/scripts/components/Tags/Tags.vue","webpack:///./galaxy/scripts/components/Tags/Tags.vue?6fdf","webpack:///./galaxy/scripts/components/Tags/Tags.vue","webpack:///./galaxy/scripts/components/Tags/Tags.vue?2b48","webpack:///./galaxy/scripts/components/Tags/backboneTagService.js","webpack:///./galaxy/scripts/components/Tags/mounts.js","webpack:///./galaxy/scripts/utils/redirect.js","webpack:///./galaxy/scripts/components/Tags/index.js","webpack:///./galaxy/scripts/onload/defaultAppFactory.js","webpack:///./galaxy/scripts/utils/mock.js","webpack:///./galaxy/scripts/utils/installMonitor.js","webpack:///./galaxy/scripts/onload/globalInits/initSentry.js","webpack:///./galaxy/scripts/onload/globalInits/initTooltips.js","webpack:///./galaxy/scripts/onload/globalInits/iframesAreTerrible.js","webpack:///./galaxy/scripts/onload/globalInits/onloadWebhooks.js","webpack:///./galaxy/scripts/onload/globalInits/replace_big_select_inputs.js","webpack:///./galaxy/scripts/onload/globalInits/initTours.js","webpack:///./galaxy/scripts/onload/globalInits/initModals.js","webpack:///./galaxy/scripts/onload/standardInit.js","webpack:///./galaxy/scripts/onload/globalInits/index.js","webpack:///./galaxy/scripts/onload/index.js","webpack:///./galaxy/scripts/mvc/collection/collection-model.js","webpack:///./galaxy/scripts/mvc/history/hdca-model.js","webpack:///./galaxy/scripts/mvc/webhooks.js","webpack:///./galaxy/scripts/utils/ajax-queue.js","webpack:///./galaxy/scripts/mvc/user/user-model.js","webpack:///./galaxy/scripts/app/galaxy.js","webpack:///./galaxy/scripts/app/singleton.js","webpack:///./galaxy/scripts/app/monitor.js","webpack:///./galaxy/scripts/app/index.js","webpack:///./galaxy/scripts/mvc/history/copy-dialog.js","webpack:///./galaxy/scripts/mvc/rules/rule-definitions.js","webpack:///./galaxy/scripts/legacy/grid/grid-template.js","webpack:///./galaxy/scripts/mvc/form/form-data.js","webpack:///./galaxy/scripts/ui/mode-button.js","webpack:///./galaxy/scripts/mvc/history/history-view.js","webpack:///./galaxy/scripts/ui/toast.js","webpack:///./galaxy/scripts/ui/editable-text.js","webpack:///./galaxy/scripts/onload/getRootFromIndexLink.js","webpack:///./galaxy/scripts/viz/trackster.js","webpack:///./galaxy/scripts/mvc/history/history-preferences.js","webpack:///./galaxy/scripts/mvc/history/history-contents.js","webpack:///./galaxy/scripts/utils/add-logging.js","webpack:///./galaxy/scripts/mvc/ui/ui-portlet.js","webpack:///./galaxy/scripts/utils/color.js","webpack:///./galaxy/scripts/onload/globalInits/init_refresh_on_change.js","webpack:///./galaxy/scripts/mvc/collection/base-creator.js","webpack:///./galaxy/scripts/mvc/base-mvc.js","webpack:///./galaxy/scripts/mvc/collection/collection-view.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li-edit.js","webpack:///./galaxy/scripts/utils/async-save-text.js","webpack:///./galaxy/scripts/ui/loading-indicator.js","webpack:///./galaxy/scripts/mvc/collection/collection-li-edit.js","webpack:///./galaxy/scripts/mvc/history/history-view-edit.js","webpack:///./galaxy/scripts/mvc/collection/collection-view-edit.js","webpack:///./galaxy/scripts/mvc/history/hdca-li-edit.js","webpack:///./galaxy/scripts/mvc/ui/ui-select-default.js","webpack:///./galaxy/scripts/utils/utils.js","webpack:///./galaxy/scripts/mvc/ui/ui-tabs.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-model.js","webpack:///./galaxy/scripts/entry/generic.js","webpack:///./galaxy/scripts/utils/mountVueComponent.js","webpack:///./galaxy/scripts/store/gridSearchStore.js","webpack:///./galaxy/scripts/store/tagStore.js","webpack:///./galaxy/scripts/store/index.js","webpack:///./galaxy/scripts/mvc/history/hda-li-edit.js","webpack:///./galaxy/scripts/utils/deferred.js","webpack:///./galaxy/scripts/mvc/ui/popup-menu.js","webpack:///./galaxy/scripts/layout/panel.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","4","exports","module","l","e","promises","installedChunkData","promise","Promise","resolve","reject","onScriptComplete","script","document","createElement","charset","timeout","nc","setAttribute","src","p","6","7","jsonpScriptSrc","event","onerror","onload","clearTimeout","chunk","errorType","type","realSrc","target","error","Error","request","undefined","setTimeout","head","appendChild","all","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","err","console","jsonpArray","window","oldJsonpFunction","slice","ui_slider","View","Backbone","extend","initialize","options","self","this","model","Model","id","Utils","uid","min","max","step","precise","split","onchange","set","setElement","_template","$el","attr","$text","$","$slider","pressed","on","val","which","v","preventDefault","indexOf","_isParameter","opts","attributes","has_slider","slider","ui","listenTo","render","show","addClass","hide","removeClass","new_val","original_val","is_value","isNaN","Math","round","trigger","message","parseInt","String","substring","Base","visible","error_text","wait_text","multiple","optional","_changeValue","_changeWait","_changeData","_changeVisible","empty","append","$message","$menu","$options","all_button","Buttons","ButtonCheck","onclick","prop","_getValue","update","input_def","_templateOptions","_","each","option","_templateOption","tooltip","title","placement","_messageShow","css","_setValue","first","isArray","new_value","wait","unwait","values","concat","selected","isEmpty","text","status","html","BaseIcons","pair","label","Radio","Checkbox","RadioButton","closest","icon","ui_options","ui_drilldown","Options","display","header_index","list","element","_setState","header_id","is_expanded","$button","$subgroup","attach","find","$tmpl","iterate","header","level","has_options","new_header","$group","Message","cls","persistent","fade","active_tab","messageForDisplay","escape","UnescapedMessage","Input","placeholder","disabled","readonly","area","color","style","tagName","events","input","datalist","autocomplete","source","response","change","_onchange","attr_name","removeAttr","Hidden","$info","$hidden","TextSelect","_this","select","SelectClass","textmode","textable","Upload","$file","$wait","_readFile","file","files","reader","FileReader","readAsText","Button","ButtonMenu","ButtonLink","__webpack_exports__","Modal","Select","Slider","Drilldown","backbone__WEBPACK_IMPORTED_MODULE_0__","backbone__WEBPACK_IMPORTED_MODULE_0___default","onload_loadConfig__WEBPACK_IMPORTED_MODULE_1__","NON_TERMINAL_STATES","ERROR_STATES","JobStatesSummary","url","getAppRoot","history_id","collection_id","hasDetails","has","new","errored","anyWithStates","states","anyWithState","queryState","queryStates","index","numWithStates","count","numInError","running","terminal","jobCount","toString","JobStatesSummaryCollection","Collection","add","active","fetch","updateTimeoutId","nonTerminalModels","models","filter","ids","map","summary","join","types","historyId","monitor","_this2","clearUpdateTimeout","_delayThenMonitorAgain","remove","done","FETCH_STATE_ON_ADD","utils_localization__WEBPACK_IMPORTED_MODULE_0__","utils_localization__WEBPACK_IMPORTED_MODULE_0___default","underscore__WEBPACK_IMPORTED_MODULE_1__","underscore__WEBPACK_IMPORTED_MODULE_1___default","jquery__WEBPACK_IMPORTED_MODULE_2__","jquery__WEBPACK_IMPORTED_MODULE_2___default","backbone__WEBPACK_IMPORTED_MODULE_3__","backbone__WEBPACK_IMPORTED_MODULE_3___default","app__WEBPACK_IMPORTED_MODULE_4__","utils_utils__WEBPACK_IMPORTED_MODULE_5__","mvc_ui_ui_portlet__WEBPACK_IMPORTED_MODULE_6__","mvc_ui_ui_misc__WEBPACK_IMPORTED_MODULE_7__","merge","_l","empty_text","button_new","Ui","onnew","$list","size","Galaxy","getGalaxyInstance","button_delete","ondel","portlet","Portlet","operations","fadeIn","disable","_refresh","emit","debug","del","enable","delAll","hideOptions","hideOperation","jquery__WEBPACK_IMPORTED_MODULE_0__","jquery__WEBPACK_IMPORTED_MODULE_0___default","collectionFuzzyCountDefault","localStorage","getItem","HistoryContentMixin","defaults","history_content_type","hid","idAttribute","hidden","isVisible","includeDeleted","includeHidden","urlRoot","historyContentType","historyContentId","save","jQuery","when","unhide","backbone__WEBPACK_IMPORTED_MODULE_2__","backbone__WEBPACK_IMPORTED_MODULE_2___default","mvc_collection_list_collection_creator__WEBPACK_IMPORTED_MODULE_3__","mvc_history_hdca_model__WEBPACK_IMPORTED_MODULE_4__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_5__","utils_localization__WEBPACK_IMPORTED_MODULE_6__","utils_localization__WEBPACK_IMPORTED_MODULE_6___default","PairedDatasetCollectionElementView","BASE_MVC","LoggableMixin","_logNamespace","className","identifier","template","destroy","off","_super","LIST_CREATOR","ListCollectionCreator","PairCollectionCreator","elementViewClass","collectionClass","HDCA","HistoryDatasetCollection","_mangleDuplicateNames","speed","callback","workingElements","_renderInvalid","_renderList","creator","$tmp","elementViews","view","removeElementView","_createForwardElementView","_createReverseElementView","children","invoke","_createElementView","elementView","swap","clone","click .swap","templates","middle","helpContent","invalidInitial","pairCollectionCreatorModal","elements","collectionCreatorModal","createPairCollection","contents","defaultHideSourceItems","toJSON","copyElements","creationFn","hideSourceItems","createHDCA","app__WEBPACK_IMPORTED_MODULE_3__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_4__","ControlledFetchCollection","setOrder","order","silent","_setUpListeners","changed-order","sort","_buildFetchOptions","traditional","_buildFetchData","filters","_buildFetchFilters","_fetchFiltersToAjaxData","pick","_fetchParams","filterMap","q","qv","k","reset","allFetched","comparators","update_time","buildComparator","ascending","update_time-asc","create_time","create_time-asc","comparator","isUndefined","PaginatedCollection","limitPerPage","currentPage","getTotalItemCount","shouldPaginate","getLastPage","floor","getPageCount","getPageLimitOffset","pageNum","constrainPageNum","limit","offset","fetchPage","always","fetchCurrentPage","fetchPrevPage","fetchNextPage","InfinitelyScrollingCollection","limitOnFirstFetch","limitPerFetch","lastFetched","fetchFirst","fetchMore","collection","fetchedData","numFetched","fetchAll","backbone__WEBPACK_IMPORTED_MODULE_1__","backbone__WEBPACK_IMPORTED_MODULE_1___default","underscore__WEBPACK_IMPORTED_MODULE_2__","underscore__WEBPACK_IMPORTED_MODULE_2___default","mvc_list_list_item__WEBPACK_IMPORTED_MODULE_3__","ui_loading_indicator__WEBPACK_IMPORTED_MODULE_4__","ListPanel","viewClass","LIST_ITEM","ListItemView","fxSpeed","emptyMsg","noneFoundMsg","searchPlaceholder","logger","log","searchFor","selecting","lastSelected","dragItems","views","_createDefaultCollection","$scrollContainer","subtitle","xhr","msg","details","loading","_showLoadingIndicator","loading-done","_hideLoadingIndicator","once","_setUpCollectionListeners","_setUpViewListeners","stopListening","changes","renderAll","added","removed","renderItems","addItemView","removeItemView","view:selected","ev","shiftKey","lastSelectedView","viewFromModelId","selectRange","altKey","showSelectors","view:de-selected","without","$newRender","_buildNewRender","_setUpBehaviors","_queueNewRender","el","_renderControls","_renderTitle","_renderSubtitle","_renderSearch","$controls","controls","replaceWith","$where","panel","queue","next","fadeOut","_swapNewRender","_renderMultiselectActionMenu","actions","multiselectActions","$newMenu","$actions","action","click","func","parent","$messages","$emptyMessage","$whereTo","freeViews","shownModels","_filterCollection","itemModel","_createItemView","_attachItems","_renderEmptyMessage","toggle","_filterItem","every","fn","matchesAll","_getItemViewClass","_getItemViewOptions","_setUpItemViewListeners","_destroyItemView","_destroyItemViews","forEach","expanded","selectable","contains","draggable","args","Array","arguments","json","getSelectedModels","dataTransfer","setData","JSON","stringify","_renderItemView$el","expandAll","expand","collapseAll","collapse","modelIndex","is","_attachView","useFx","_insertIntoListAt","slideDown","$what","prepend","eq","after","viewFromModel","viewsWhereModel","properties","isMatch","viewRange","viewA","viewB","indexA","indexB","searchInput","initialVal","onfirstsearch","_firstSearch","onsearch","searchItems","onclear","clearSearch","force","$search","THROTTLE_SELECTOR_FX_AT","showSelector","hideSelectors","slideUp","hideSelector","toggleSelectors","selectAll","deselectAll","deselect","range","getSelectedViews","constructor","indicator","LoadingIndicator","scrollPosition","scrollTop","scrollTo","pos","animate","scrollToTop","scrollToItem","scrollToId","click .select-all","click .deselect-all","wrapTemplate","controlsTemplate","ModelListPanel","modelCollectionKey","setModel","freeModel","oldModelId","_setUpModelListeners","unshift","info","warnings","underscore__WEBPACK_IMPORTED_MODULE_0__","underscore__WEBPACK_IMPORTED_MODULE_0___default","mvc_dataset_dataset_li__WEBPACK_IMPORTED_MODULE_1__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_2__","utils_localization__WEBPACK_IMPORTED_MODULE_3__","utils_localization__WEBPACK_IMPORTED_MODULE_3___default","DATASET_LI","DatasetListItemView","HDAListItemView","modelString","titleBar","dataset","mvc_dataset_states__WEBPACK_IMPORTED_MODULE_1__","mvc_collection_collection_li__WEBPACK_IMPORTED_MODULE_2__","mvc_collection_collection_view__WEBPACK_IMPORTED_MODULE_3__","utils_localization__WEBPACK_IMPORTED_MODULE_4__","utils_localization__WEBPACK_IMPORTED_MODULE_4___default","components_Nametags__WEBPACK_IMPORTED_MODULE_5__","DC_LI","DCListItemView","HDCAListItemView","_mountNametags","renderListen","jobStatesSummary","change:tags change:visible change:state","context","container","_this$model$attribute","model_class","tags","storeKey","mountNametags","_getFoldoutPanelClass","DC_VIEW","CollectionView","state","STATES","OK","RUNNING","stateDescription","jobStateSource","collectionTypeDescription","simpleDescription","collectionDescription","isNew","errorCount","okPercent","runningPercent","otherPercent","jobsStr","AnnotationEditor","baseMVC","HiddenUntilActivatedViewMixin","tooltipConfig","hiddenUntilActivated","$activator","$annotation","make_text_editable","use_textarea","on_finish","newAnnotation","annotation","fail","previous","Nametags_Nametagvue_type_script_lang_js_","props","tag","required","computed","tagLabel","startsWith","replace","tagStyles","_keyedColorScheme","background-color","primary","contrasting","border-color","darker","Nametag","componentNormalizer","_vm","_h","$createElement","_self","_c","staticClass","$event","$emit","_v","_s","Nametags_Nametagsvue_type_script_lang_js_","components","default","nameTags","$store","getters","getTagsById","methods","_objectSpread","vuex_esm","mounted","initializeTags","Nametags","attrs","mountVueComponent","UPLOAD","QUEUED","SETTING_METADATA","NEW","EMPTY","PAUSED","FAILED_METADATA","NOT_VIEWABLE","DISCARDED","ERROR","READY_STATES","NOT_READY_STATES","levenshteinDistance","a","b","matrix","charAt","naturalSort","oFxNcL","oFyNcL","re","x","toLowerCase","y","nC","fromCharCode","xN","yN","xD","Date","getTime","yD","cLoc","numS","parseFloat","PairView","dragStartHandler","_dragstart","dragEndHandler","_dragend","handle","addEventListener","dragover","drop","currentTarget","opacity","originalEvent","effectAllowed","_sendToParent","autoPairFnBuilder","createPair","params","listA","listB","aInBIndex","bInAIndex","_pair","_regexps","preprocessMatch","regexps","RegExp","matchTo","possible","bestMatch","score","paired","match","scoreThreshold","PairedCollectionCreator","baseCreator","CollectionCreatorMixin","metric","datasets","DEFAULT_FILTERS","automaticallyPair","strategy","matchPercentage","twoPassAutopairing","initialList","commonFilters","strategies","DEFAULT_STRATEGY","isFunction","removeExtensions","oncancel","oncreate","autoscrollDist","unpairedPanelHidden","pairedPanelHidden","$dragging","blocking","_setUpCommonSettings","_dataSetUp","illumina","Rs","simple","lcs","levenshtein","unpaired","selectedIds","_sortInitialList","_ensureIds","autoPair","_sortDatasetList","uniqueId","_splitByFilters","regexFilters","stringFilter","test","_filter","_addToUnpaired","binSearchSortedIndex","low","hi","mid","compared","autopairSimple","autopairLevenshtein","autopairLCS","_naiveStartingAndEndingLCS","s1","s2","fwdLCS","revLCS","fwd","rev","_createPair","forward","_guessNameForPair","reverse","fwdName","revName","lastSlashIndex","lastIndexOf","urlprefix","extension","lastDotIndex","_unpair","unpairAll","pairs","_pairToJSON","collection_type","element_identifiers","createList","ajaxData","hide_source_items","hideOriginals","copy_elements","ajax","contentType","dataType","_ajaxErrHandler","content","readyState","responseJSON","_showAlert","main","_renderHeader","_renderMiddle","_renderFooter","_addPluginComponents","$header","_renderFilters","$middle","_renderUnpaired","_renderPaired","$fwd","$rev","$prd","_renderUnpairedDisplayStr","_renderPairButton","_renderUnpairedDataset","_adjUnpairedOnScrollbar","_renderUnpairedNotShown","_renderUnpairedEmpty","numFiltered","$msg","$unpairedColumns","last","$firstDataset","ucRight","left","outerWidth","dsRight","rightDiff","pairView","_renderPairedEmpty","footerSettings",".hide-originals",".remove-extensions","_chooseFiltersPopover","hoverhighlight","selector","$popoverContent","filterSet","val1","val2","popover","_validationWarning","what","clear","focus","splitView","msgClass","hideUnpaired","click .more-help","click .less-help","click .main-help","click .header .alert button","click .forward-column .column-title","click .reverse-column .column-title","click .unpair-all-link","change .forward-unpaired-filter input","focus .forward-unpaired-filter input","click .autopair-link","click .choose-filters .filter-choice","click .clear-filters-link","change .reverse-unpaired-filter input","focus .reverse-unpaired-filter input","click .forward-column .dataset.unpaired","click .reverse-column .dataset.unpaired","click .paired-column .dataset.unpaired","click .unpaired-columns","mousedown .unpaired-columns .dataset","click .paired-column-title","mousedown .flexible-partition-drag","click .paired-columns .dataset.paired","click .paired-columns","click .paired-columns .pair-name","click .unpair-btn","dragover .paired-columns .column-datasets","drop .paired-columns .column-datasets","pair.dragstart .paired-columns .column-datasets","pair.dragend   .paired-columns .column-datasets","change .remove-extensions","toggleExtensions","change .collection-name","keydown .collection-name","change .hide-originals","click .cancel-create","click .create-collection","_clickShowOnlyUnpaired","hidePaired","_clickShowOnlyPaired","_clickUnpairAll","_clickAutopair","_clickFilterChoice","$selected","_hideChooseFilters","_clearFilters","_clickUnpairedDataset","stopPropagation","toggleSelectUnpaired","$dataset","hasClass","waitToPair","pairAllSelected","fwds","revs","clearSelectedUnpaired","_mousedownUnpaired","$startTarget","moveListener","one","_clickPairRow","rowIndex","_startPartitionDrag","startingY","pageY","trackMouse","adjPartition","mousemove","unbind","adj","$unpaired","$paired","unpairedHi","pairedHi","movingUpwards","height","flex","selectPair","toggleClass","clearSelectedPaired","_clickPairName","$name","prompt","customizedName","_clickUnpair","pairIndex","_dragoverPairedColumns","_checkForAutoscroll","clientY","$nearest","_getNearestPairedDatasetLi","$placeholder","before","$element","upperDist","top","lowerDist","outerHeight","lis","toArray","$li","halfHeight","_dropPairedColumns","dropEffect","insertBefore","insertAfter","_syncPairsToDom","newPaired","_pairDragstart","_pairDragend","_printList","_printPair","_creatorTemplates","footer","pairedCollectionCreatorModal","deferred","Deferred","modal","body","width","closing_events","createListOfPairsCollection","onload_loadConfig__WEBPACK_IMPORTED_MODULE_4__","Tour","Constructor","Default","whiteList","button","gxy_root","tour_opts","storage","sessionStorage","onEnd","removeItem","delay","orphan","hooked_tour_from_data","steps","preclick","onShow","postclick","onHide","textinsert","onShown","path","warn","TourItem","Tours","ToursView","success","tpl","tourtags","tour","tags_lc","Untagged","tours","otag","toUpperCase","tourtagorder","keys","giveTourById","elem","active_tags","fil_tour_tags","giveTourWithData","hookedTourData","setItem","init","goTo","restart","tour_id","getJSON","activeGalaxyTourRunner","et","parse","CommunicationServerView","makeModalIframe","host","config","communication_server_host","port","communication_server_port","username","user","persistent_communication_rooms","query_string","$el_chat_modal_header","$el_chat_modal_body","iframe_template","title_separator","logoutClick","galaxy","session_csrf_token","root","axios","then","clearSessionStorage","location","href","menu","extendedNavItem","Webhooks","load","webhooks","ready","webhook","activate","obj","function","Function","page","masthead","appendScriptStyle","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","helpsite_url","userTab","divider","allow_user_creation","noscratchbook","Tab","$link","$note","click .nav-link","visibility","_formatUrl","menuItem","_buildMenuItem","router","executeUseRouter","frame","buildLink","_toggleClick","_this3","FrameView","$title","$content","$option","ui_frames","defaultOptions","cols","rows","cell","margin","scroll","top_min","frame_max","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","_frameInit","_frameResize","_panelRefresh","resize","buttons","Close","frame_id","_toPixelCoord","_frameInsert","$frame","_panelAnimationComplete","mouseup","mouseleave","mousewheel","DOMMouseScroll","mousedown .frame","mousedown .frame-background","mousedown .frame-scroll-up","mousedown .frame-scroll-down","mousedown .f-close","_eventFrameMouseDown","_frameIdentify","xy","pageX","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","_frameScreen","min_dim","_toGridCoord","_frameOffset","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","srcElement","parents","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","_frameFocus","_frameGrid","grid_location","px","sign","g","_toGrid","_toPixel","_isCollision","_locationRank","loc","delta","top_new","screen_location","grid_rank","new_loc","place_list","f","place","_framePlace","has_focus","frames","Frames","buttonActive","show_note","note_cls","onbeforeunload","buttonLoad","note","history_cache","addDataset","dataset_id","current_dataset","currHistoryPanel","dataset_ids","_findDataset","history_details","dataset_list","_loadDatasetOffset","new_dataset_id","_loadDataset","new_dataset","Dataset","is_tabular","data_type","createTabularDatasetChunkedView","TabularDataset","embedded","addTrackster","viz_id","viz","visualization","Visualization","TracksterUI","frame_config","parent_elt","view_config","dbkey","stand_alone","latest_revision","drawables","hda_ldda","create_visualization","viewport","bookmarks","open","$galaxy_main","_build_url","use_panels","hide_panels","hide_masthead","param","user_quotameter","UserQuotaMeter","warnAtPercent","errorAtPercent","loadFromApi","isOverQuota","_render_quota","modelJson","percent","quota_percent","$meter","_templateQuotaMeter","$bar","_render_usage","usage","_templateUsage","meterHtml","nice_total_disk_usage","$navbarBrandLink","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","Menu","highlight","active_view","Scratchbook","quotaMeter","QuotaMeter","$download_link","brand","logo_url","logo_src","tool","data_input","data_collection_input","subworkflow","parameter_input","pause","jquery__WEBPACK_IMPORTED_MODULE_1__","jquery__WEBPACK_IMPORTED_MODULE_1___default","onload_loadConfig__WEBPACK_IMPORTED_MODULE_3__","mvc_dataset_data__WEBPACK_IMPORTED_MODULE_5__","viz_trackster_util__WEBPACK_IMPORTED_MODULE_6__","utils_config__WEBPACK_IMPORTED_MODULE_7__","mvc_grid_grid_view__WEBPACK_IMPORTED_MODULE_8__","mvc_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_9__","app__WEBPACK_IMPORTED_MODULE_10__","CustomToJSON","to_json_keys","to_json_mappers","CanvasManager","default_font","dummy_canvas","new_canvas","dummy_context","getContext","font","char_width_px","measureText","patterns","load_pattern","image","Image","createPattern","get_pattern","canvas","manager","Cache","num_elements","obj_cache","key_ary","get_elt","key_str","stale","move_key_to_end","set_elt","most_recently_added","GenomeDataManager","genome","init_data","min_region_size","filters_manager","data_mode_compatible","entry","can_subset","initial_entries","add_data","entries","set_data","region","data_is_ready","ready_deferred","query_type","ss_deferred","util_mod","ServerStateDeferred","ajax_settings","interval","success_fn","go","search_features","query","load_data","resolution","extra_params","chrom","high","filter_names","filter_cols","get_data","is_deferred","entry_region","is_subregion","subset_entry","copy","last_request","trim","DEEP_DATA_REQ","BROAD_DATA_REQ","get_more_data","req_type","cur_data","_mark_stale","query_low","start_val","max_high","query_region","data_manager","new_data_request","new_data_available","max_low","can_get_more_detailed_data","dataset_type","get_more_detailed_data","detail_multiplier","num_samples","get_genome_wide_data","all_data_available","gw_data","chrom_info","chrom_data","GenomeRegion","start","end","len","genome_wide_data","subregion","subset_fns","bigwig","data_point","refseq","seq_start","subregion_data","same","GenomeReferenceDataManager","dataset_placeholder","data_url","Genome","chroms_info","get_chroms_info","get_chrom_region","chr_name","get_chrom_len","str_val","from_str","pieces","start_end","compute_overlap","a_region","first_chrom","second_chrom","first_start","second_start","first_end","second_end","overlap_results","DIF_CHROMS","BEFORE","OVERLAP_START","CONTAINS","AFTER","CONTAINED_BY","OVERLAP_END","chrom_len","overlaps","intersection","GenomeRegionCollection","BrowserBookmark","BrowserBookmarkCollection","BackboneTrack","default_value","config_mod","ConfigSettingCollection","from_models_and_saved_values","prefs","preloaded_data","BackboneTrackCollection","vis_json","GenomeVisualization","tracks","unset","add_tracks","dummy","obj_type","content_visible","TrackBrowserRouter","Router","route","navigate","change_location","go_to","select_datasets","history_grid","GridView","url_base","library_grid","tabs","Tabs","Cancel","Add","requests","current","track_defs","arg","parentNode","KEYCODE_ESC","KEYCODE_RETURN","$parentNode","firstSearch","clearSearchInput","blur","classes","inputVal","minSearchLen","escWillClear","oninit","keyup","searchTerms","onload_loadConfig__WEBPACK_IMPORTED_MODULE_2__","utils_deferred__WEBPACK_IMPORTED_MODULE_5__","mvc_ui_ui_misc__WEBPACK_IMPORTED_MODULE_6__","mvc_form_form_view__WEBPACK_IMPORTED_MODULE_7__","mvc_webhooks__WEBPACK_IMPORTED_MODULE_8__","components_Citations_vue__WEBPACK_IMPORTED_MODULE_9__","vue__WEBPACK_IMPORTED_MODULE_10__","axios__WEBPACK_IMPORTED_MODULE_11__","axios__WEBPACK_IMPORTED_MODULE_11___default","FormBase","_update","_destroy","execute","process","_render","fixed_title","description","version","hide_operations","_operations","_footer","tool_errors","show_message","in_favorites","getFavorites","tools","favorite_button","narrow","isAnonymous","put","object_id","remove_favorite_button","updateFavorites","delete","encodeURIComponent","versions_button","sustain_version","versions","addMenu","menu_button","origin","requirements","requirements_visible","collapsed","_templateRequirements","sharable_url","favorite","remove_favorite","_templateHelp","citations","citationInstance","Vue","Citations","vm","propsData","$mount","help","img_src","nreq","requirements_message","req","requirements_link","MetricsLogger","userId","bootstrapped","consoleLogger","_init","usefulToString","asStr","LoggingCache","ALL","LOG","DEBUG","INFO","WARN","METRIC","NONE","logLevel","consoleLevel","defaultNamespace","consoleNamespaceWhitelist","consoleFlattenMessages","clientPrefix","maxCacheSize","postSize","addTime","cacheKeyPrefix","postUrl","delayPostInMs","getPingData","onServerResponse","_parseLevel","_sending","_waiting","_postSize","_initCache","cache","maxSize","_emitToConsole","_typeof","upper","namespace","logArguments","_addToCache","_buildEntry","_postCache","time","toISOString","entriesLength","postData","metrics","post","responseText","_delayPost","whitelist","_hasStorage","_initStorage","_cache","_fetchAndParse","overage","_unparseAndStore","print","components_Citationsvue_type_script_lang_js_","viewRender","Boolean","requried","errors","formattedReferences","reduce","formattedReference","created","axios_default","loadConfig_js_exposed","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","iterator","rawCitation","citation","fields","entryType","parsed","bibtexParse","underscore_js_exposed_default","entryTags","return","catch","ref","authorsAndYear","_asSentence","author","year","pages","address","volume","number","journal","booktitle","howpublished","institution","_formatBookInfo","doiUrl","doi","latex_to_unicode_converter","onError","latex","chapter","editor","publisher","series","issn","str","toggleViewRender","component","slot","_e","domProps","innerHTML","scope","$this","targetSelector","mouseover","background","mouseout","async","async_ops","categorical_filters","sort_key","show_item_checkboxes","advanced_search","cur_page","num_pages","operation","item_ids","can_async_op","op","add_filter","cur_val","remove_filter","condition","condition_index","get_url_data","url_data","get_url","utils_utils__WEBPACK_IMPORTED_MODULE_2__","optionsDefault","minimumInputLength","maximumTextLength","initialData","select_data","select2","_getIndex","select_opt","containerCssClass","dropdownCssClass","escapeMarkup","formatResult","formatSelection","initSelection","mx","sub","dropdownAutoWidth","findIndex","assert","assign","lastTime","vendors","requestAnimationFrame","cancelRequestAnimationFrame","currTime","timeToCall","cancelAnimationFrame","incompatibilities","compatible","CanvasRenderingContext2D","feature","querySelectorAll","item","global","require","amdi18n","__root","Analyze Data","Workflow","Shared Data","Data Libraries","Histories","Workflows","Visualizations","Pages","New Track Browser","Saved Visualizations","Interactive Environments","Admin","Help","Support","Search","Mailing Lists","Videos","Wiki","How to Cite Galaxy","Interactive Tours","User","Login","Register","Login or Register","Logged in as","Preferences","Custom Builds","Logout","Saved Histories","Saved Datasets","Saved Pages","Account and saved data","Account registration or login","Support, contact, and community","Administer this Galaxy","Visualize datasets","Access published resources","Chain tools into workflows","Analysis home view","History Lists","Histories Shared with Me","Current History","Create New","Copy History","Share or Publish","Show Structure","Extract Workflow","Delete Permanently","Dataset Actions","Copy Datasets","Dataset Security","Resume Paused Jobs","Collapse Expanded Datasets","Unhide Hidden Datasets","Delete Hidden Datasets","Purge Deleted Datasets","Downloads","Export Tool Citations","Export History to File","Other Actions","Import from File","This history is empty","No matching datasets found","An error occurred while getting updates from the server","Please contact a Galaxy administrator if the problem persists","search datasets","You are currently viewing a deleted history!","You are over your disk quota","Tool execution is on hold until your disk usage drops below your allocated quota","All","None","For all selected","Edit history tags","Edit history Annotation","Click to rename history","Operations on multiple datasets","Hide datasets","Unhide datasets","Delete datasets","Undelete datasets","Permanently delete datasets","This will permanently remove the data in your datasets. Are you sure?","Annotation","This history is empty. Click 'Get Data' on the left tool menu to start","You must be logged in to create histories","Unable to purge dataset","Cannot display datasets removed from disk","This dataset must finish uploading before it can be viewed","This dataset is not yet viewable","View data","Download","Download dataset","Additional files","View details","This is a new dataset and not all of its data are available yet","You do not have permission to view this dataset","The job creating this dataset was cancelled before completion","This job is waiting to run","This dataset is currently uploading","Metadata is being auto-detected","This job is currently running","This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume","An error occurred with this dataset","No data","An error occurred setting the metadata for this dataset","There was an error getting the data for this dataset","This dataset has been deleted and removed from disk","This dataset has been deleted","This dataset has been hidden","format","database","Edit attributes","Cannot edit attributes of datasets removed from disk","Undelete dataset to edit attributes","This dataset must finish uploading before it can be edited","This dataset is not yet editable","Delete","Dataset is already deleted","View or report this error","Run this job again","Visualize","Visualize in","Undelete it","Permanently remove it from disk","Unhide it","You may be able to","set it manually or retry auto-detection","Edit dataset tags","Edit dataset annotation","Tool Help","Reset passwords","Search Tool Shed","Monitor installing repositories","Manage installed tools","Reset metadata","Download local tool","Tool lineage","Reload a tool's configuration","Review tool migration stages","View Tool Error Logs","Manage Display Whitelist","Manage Tool Dependencies","Users","Groups","API keys","Impersonate a user","Data","Quotas","Roles","Local data","Form Definitions","Enable/Disable Scratchbook","Show/Hide Scratchbook","Tags","Edit annotation","Subscript","Superscript","Trackster","Any additional comments you can provide regarding what you were doing at the time of the bug.","Your email address","Report","Error Report","Dataset details","Save permissions.","Change the datatype to a new type.","Convert the datatype to a new format.","Save attributes of the dataset.","Change data type","Edit dataset attributes","Save permissions","Manage dataset permissions","Change datatype","Convert datatype","Convert to new format","Save","Permissions","Datatypes","Convert","Attributes","Import into History","Location Details","Deleting selected items","Please select folders or files","Please enter paths to import","Adding datasets from your history","Create New Folder","Create New Library","Click here to sign out of all sessions.","Add or remove custom builds using history datasets.","Associate OpenIDs with your account.","Customize your Toolbox by displaying or omitting sets of Tools.","Access your current API key or create a new one.","Enable or disable the communication feature to chat with other users.","Allows you to change your login credentials.","User Preferences","Sign out","Manage custom builds","Manage OpenIDs","Manage Toolbox filters","Manage API key","Set dataset permissions for new histories","Change communication settings","Change password","Manage information","Configured Galaxy Tool Sheds","Repository Installation Queue","Repository Status","Workflows Missing Tools","See in Tool Shed","Requirements","Share","Workflow submission failed","Run workflow","Job submission failed","Execute","Tool request failed","Copy and insert individual steps","Warning","An email notification will be sent when the job has completed.","Add a step label.","Assign columns","Delete this repeat block","Repeat","Browse GenomeSpace","Browse","Download from web or upload from disk","Composite","Regular","Upload configuration","FTP files","Reset","Pause","Start","Choose FTP file","Choose local file","Build","Choose FTP files","Choose local files","Create a collection of paired datasets","View all histories","History options","Refresh history","View error logs","View migration stages","View lineage","Manage dependencies","Manage whitelist","Manage metadata","Manage tools","Monitor installation","Install new tools","Tool Management","Forms","User Management","Manage jobs","Display applications","Data tables","Data types","Server","Could Not Save","Saving...","Settings","Add tracks","New Visualization","Add Data to Saved Visualization","Close visualization","Circster","Bookmarks","Add group","Remove parameter from tree","Add parameter to tree","Remove","Select datasets for new tracks","Libraries","Zoom out","Zoom in","Phyloviz Help","Save visualization","PhyloViz Settings","Title","Filtering Dataset","Filter Dataset","Show individual tracks","Trackster Error","Tool parameter space visualization","Tool","Set as overview","Set display mode","Filters","Show composite track","Edit settings","Test title","Test Title","Test button","Create new Build","Delete custom build.","Provide the data source.","Next in History","Previous in History","Chat online","Multiple collections","Dataset collections","Dataset collection","Multiple datasets","Single dataset","Download from URL or upload files from disk","tool tooltip","__ja","Search datasets","Edit history annotation","Search Tool Shed (Beta)","Form definitions","Administration","Tools and Tool Shed","Your workflows","__fr","load your own data","get data from an external source","Include Deleted Datasets","Include Hidden Datasets","__zh","Tools","History","An error was encountered while <% where %>","You can "," or ","ja","fr","zh","language","_i18n","locale","documentElement","lang","navigator","languages","userLanguage","make_popupmenu","make_popup_menus","button_element","initial_options","element_menu_exists","menu_element","appendTo","wrapper","scrollLeft","close_popup","link","link_dom","confirmtext","getAttribute","confirm","box","_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_dist_cjs_js_ref_7_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_vue_loader_lib_index_js_vue_loader_options_Citations_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_dist_cjs_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_sass_loader_lib_loader_js_ref_8_2_node_modules_vue_loader_lib_index_js_vue_loader_options_Nametag_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_dist_cjs_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_sass_loader_lib_loader_js_ref_8_2_node_modules_vue_loader_lib_index_js_vue_loader_options_Nametags_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_dist_cjs_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_sass_loader_lib_loader_js_ref_8_2_node_modules_vue_loader_lib_index_js_vue_loader_options_StatelessTags_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_dist_cjs_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_sass_loader_lib_loader_js_ref_8_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","Connector","handle1","handle2","dragging","inner_color","outer_color","connect","t1","t2","disconnect","destroyIfInvalid","attachable","canAccept","Toast","warning","redraw","startRibbon","isMappedOver","endRibbon","canvasClass","canvas_container","canvasZoom","workflow_globals","canvas_manager","zIndex","relativeLeft","relativeTop","start_x","start_y","end_x","end_y","canvas_min_x","canvas_max_x","canvas_min_y","canvas_max_y","cp_shift","abs","canvas_left","canvas_top","canvas_width","canvas_height","start_offsets","end_offsets","num_offsets","inner_width","outer_width","draw_outlined_curve","offset_start","offset_end","lineCap","strokeStyle","lineWidth","beginPath","moveTo","bezierCurveTo","stroke","app","_classCallCheck","id_counter","nodes","has_changes","active_form_has_changes","workflowOutputLabels","workflow_version","fromLabel","toLabel","unregisterOutputLabel","canLabelOutputWith","registerOutputLabel","node","outputName","labelWorkflowOutput","nodeView","redrawWorkflowOutputs","title_text","content_id","prebuildNode","add_node","fit_canvas_to_nodes","draw_overview","activate_node","workflow","active_node","clear_active_node","wf","remove_node","using_workflow_outputs","has_existing_pjas","workflow_outputs","post_job_actions","pja_id","pja","action_type","node_changed","pjas_to_rem","pja_name","output_terminals","ot_id","ot","isWorkflowOutput","output_name","action_arguments","reload_active_node","input_connections","input_terminals","cons","connectors","con_dict","input_subworkflow_step_id","act","node_data","tool_version","config_form","tool_state","position","uuid","initialImport_","initialImport","max_id","workflow_output","init_field_data","other_node","addWorkflowOutput","submit","make_inactive","activeElement","showAttributes","check_changes_in_active_form","showForm","make_active","showWorkflowParameters","n_pred","successors","other","node_ids_by_level","level_parents","pred_k","sk","all_nodes","max_width","xmin","Infinity","xmax","ymin","ymax","round_up","ceil","fix_delta","bounds","bounds_for_all_nodes","xmin_delta","ymin_delta","ScrollPanel","workflow_canvas_classCallCheck","onmove","panel_pos","panel_w","panel_h","viewport_w","viewport_h","viewport_offset","min_x","min_y","max_x","max_y","p_min_x","p_min_y","p_max_x","p_max_y","moved","zoomLevels","defaultZoomLevel","canvas_viewport","overview","cv","cc","oc","ov","zoomLevel","initZoomControls","init_drag","init_copy_paste","zoomControl","bottom","setZoom","x_adjust","y_adjust","move","background-position-x","background-position-y","update_viewport_overlay","scroll_panel","offsetX","offsetY","in_w","in_h","o_w","o_h","new_x_offset","new_y_offset","offsetParent","opo","new_size","_this4","getSelection","clipboardData","nodeId","getData","cc_pos","shift_h","shift_w","canvas_el","cv_w","cv_h","fillStyle","node_element","w","h","fillRect","CollectionTypeDescription","collectionType","isCollection","rank","ConnectionAcceptable","reason","NULL_COLLECTION_TYPE_DESCRIPTION","canMatch","canMapOver","otherCollectionType","equal","ANY_COLLECTION_TYPE_DESCRIPTION","otherCollectionTypeDescription","requiredSuffix","_endsWith","effectiveMapOver","suffix","TerminalMapping","mapOver","terminalMapping","disableMapOver","setMapOver","Terminal","connector","markChanged","inArray","resetMappingIfNeeded","resetCollectionTypeSource","destroyInvalidConnections","output_val","outputTerminal","resetMapping","output_terminal","collection_type_source","OutputTerminal","datatypes","hasConnectedOutputTerminals","hasConnectedMappedInputTerminals","mappedInputTerminals","mappedInput","hasMappedOverInputTerminals","connectedInput","BaseInputTerminal","_inputFilled","connected","_collectionAttached","firstOutput","_mappingConstraints","constraints","connectedMappedInputTerminals","inputTerminal","_producesAcceptableDatatype","thisDatatype","cat_outputs","pja_i","newtype","other_datatype_i","other_datatype","isSubType","_otherCollectionType","otherMapOver","InputTerminal","extensions","other_output","thisMapOver","endsWith","InputParameterTerminal","InputCollectionTerminal","collectionTypes","collection_types","_effectiveMapOver","some","collectionTypeIndex","_effectiveCollectionTypes","effectiveCollectionTypes","effectiveCollectionType","OutputCollectionTerminal","output","newCollectionType","oldCollectionType","workflow_terminals","OutputParameterTerminal","TerminalMappingView","InputTerminalMappingView","mouseenter","onMouseEnter","onMouseLeave","onClick","TerminalView","setupMappingView","terminalMappingClass","terminalMappingView","terminalMappingViewClass","terminalElements","BaseInputTerminalView","cid","terminalForInput","dropinit","dropstart","dropend","hover","onDropInit","connectionAcceptable","drag","onDropStart","proxy","dropTooltip","onDropEnd","onDrop","onHover","InputTerminalView","Terminals","InputParameterTerminalView","InputCollectionTerminalView","BaseOutputTerminalView","terminalForOutput","dragstart","dragend","onDrag","po","onDragStart","available","onDragEnd","stop","OutputTerminalView","OutputCollectionTerminalView","workflow_view_terminals","OutputParameterTerminalView","DataInputView","terminalElement","skipResize","updateMaxWidth","DataOutputView","calloutView","OutputCalloutView","detach","redrawWorkflowOutput","resetImage","ParameterOutputView","hoverImage","removeWorkflowOutput","right","workflow_view_data","output_width","tool_body","newInputsDiv","terminalViews","outputViews","renderToolLabel","renderToolErrors","newWidth","addRule","addDataInput","terminalView","terminalViewClass","TerminalViews","input_type","ib","DataViews","addDataOutput","outputViewClass","parameter","outputView","updateDataOutput","Node","getWorkflowOutput","findWhere","changed","oldLabel","workflowOutput","updateOutputLabel","connectedOutputTerminals","_connectedTerminals","terminals","connectedTerminals","outputTerminals","_connectedMappedTerminals","inputTerminals","inputName","mapped_outputs","_mappedTerminals","mappedTerminals","found","copiedData","create_node","tool_id","newData","update_field_data","removeChild","set_tool_version","NodeView","inputs","outputs","unused_outputs","output_view","cur_name","data_names","cur_name_in_data_outputs","data_name","unused_output","wf_output","pja_in","old_body","new_body","newTerminalViews","difference","unusedView","data_outputs","tmp","_addLabelAnnotation","form","fixed","new_label","duplicate","input_id","element_list","_makeSection","output_id","name_label_map","0","1","help_section","rename_help","name_label","input_config","flat","attemptUpdateOutputLabel","pja_arg","ignore","_visit","head_list","payload","p_id","workflow_forms","Form","ToolFormBase","text_enable","text_disable","initial_errors","initialmodel","_customize","buildmodel","postchange","current_state","deepeach","connectable","textify","__class__","collapsible_value","is_workflow","test_param","_addSections","$overlay","overlay","$dialog","dialog","$body","$footer","$backdrop","backdrop","hide_modal","show_modal","extra_buttons","init_fn","setContent","show_in_overlay","closeButton","$buttons","$extraButtons","reset_tool_search","initValue","tool_menu_frame","urls","workflow_index","save_current_workflow","eventObj","success_callback","rectify_workflow_outputs","to_simple","errlist","stored","build_version_select","Ok","err_msg","keyCode","lastValue","timer","tool_search","this_label","no_visible_tools","WorkflowCanvas","datatypes_mapping","ext_to_type","ext_to_class_name","type_to_type","class_to_classes","get_workflow_versions","_workflow_version_dropdown","workflow_versions","current_wf","version_text","load_workflow","_workflowLoadAjax","from_simple","scroll_to_nodes","upgrade_message","step_id","upgrade_messages","Continue","beforeSubmit","Save As","rename_name","rename_annotation","workflow_save_as","workflow_name","workflow_annotation","workflow_data","alert","Run","Edit Attributes","Auto Re-layout","layout","do_close","Save Changes","Don't Save","overview_size","workflows","_buildToolPanelWorkflows","wrap","last_expanded","async_save_text","rename_async","annotate_async","$section","step_count","copy_into_workflow","Copy","$add","add_node_for_subworkflow","latest_id","workflowId","vv","remove_all","_moduleInitAjax","request_data","add_node_for_tool","add_node_for_module","display_file_list","addlist","out_terminal","parameter_re","workflow_parameters","wf_parm_container","wf_parm_box","new_parameter_content","matches","form_matches","action_argument","arg_matches","$container","WorkflowIcons","form_type","FormWrappers","child","$f","$to_el","nodeType","iconStyle","$icon","add_node_icon","prependTo","SVGUtils","is_visible","svg_elt","svg","eltBRect","getBoundingClientRect","svgBRect","UsesTicks","drawTicks","dataHandler","textTransform","horizontal","ticks","enter","angle","PI","radius","tick_coords","text_coords","text_anchor","formatNum","num","sigDigits","rval","toPrecision","roundedNum","toFixed","CircsterLabelTrack","CircsterView","label_arc_height","scale","circular_views","chords_views","add_track","remove_track","vis_config","update_track_bounds","get_circular_tracks","track","get_chord_tracks","get_tracks_bounds","circular_tracks","dataset_arc_height","get_value","track_gap","min_dimension","radius_start","tracks_start_radii","d3","chords_tracks","total_gap","tracks_bounds","zoom","currentEvent","translate","zoom_drag_timeout","CircsterBigWigTrackView","radius_bounds","CircsterChromInteractionsTrackView","outermost_radius","track_bounds","label_track_view","CircsterChromLabelTrackView","new_track","innermost_radius_bounds","new_view","new_track_bounds","track_view","update_radius_bounds","track_index","CircsterTrackView","bg_stroke","loading_bg_fill","bg_fill","chroms_layout","_chroms_layout","data_bounds","get_fill_color","track_parent_elt","genome_arcs","arc_gen","arc","innerRadius","outerRadius","chroms_paths","data_ready_deferred","_render_data","render_labels","new_d","transition","duration","_transition_chrom_data","_transition_labels","update_scale","new_scale","old_scale","utils","data_deferred","path_elt","chrom_region","_update_data_bounds","chrom_arc","_render_chrom_data","chrom_arcs","chrom_data_paths","path_data","path_fn","_get_path_function","p_data","new_bounds","get_data_bounds","rendered_deferred","set_value","layout_and_data","zip","init_arcs","pie","pie_layout","gap_per_chrom","new_endAngle","endAngle","startAngle","min_arc_len","visibleChroms","CircsterQuantitativeTrackView","track_config","_update_min_max","_quantile","numbers","quantile","datum","linear","domain","clamp","line","radial","interpolate","_data_bounds_ticks_fn","classed","tick","ConfigSettingCollectionView","render_in_modal","labeledChroms","new_data","flatten","chord_data","cur_chrom","chrom_chord_data","source_angle","_get_region_angle","target_angle","chord","chrom_angle_data","chrom_layout","circster","GalaxyApp","mod_utils","cssLoadFile","galaxy_config","vis","viz_config","mod_icon_btn","create_icon_buttons_menu","icon_class","on_click","vis_info","vis_id","tooltip_config","UserMenuBase","isAcceptableValue","$inputKey","fieldName","isFinite","hasIllegalJsonCharacters","search","PhyloTreeLayout","hierarchy","layoutMode","leafHeight","depthSeparation","leafIndex","defaultDist","maxTextWidth","inputLeafHeight","layoutAngle","separation","dist","links","tree","_nodes","maxDepth","numLeaves","_d","depth","vertSeparation","sumChildVertSeparation","y0","x0","PhyloTree","visualization_mod","scaleFactor","fontSize","selectedNode","nodeAttrChangedTime","_children","toggleAll","cleanTree","_selected","res","PhylovizLinearView","nodeRadius","stdInit","updateAndRender","renderNodes","renderLinks","addTooltips","calcalateLinePos","pos0","pos1","pos2","insert","exit","selectNode","__data__","bootstrap","margins","diagonal","projection","nodeEnter","nodeUpdate","nodeExit","PhylovizView","MIN_SCALE","MAX_SCALE","MAX_DISPLACEMENT","phyloTree","zoomFunc","scaleExtent","navMenu","HeaderButtons","settingsMenu","SettingsMenu","nodeSelectionView","NodeSelectionView","PhyloVizSearch","zoomAndPan","mainSVG","boundingRect","layoutOptions","zoomParams","translateParams","zoomStatement","translationCoor","translateStatement","reloadViz","treeIndex","tree_index","packedJson","phylovizView","initNavBtns","initRightHeaderBtns","rightMenu","updateUI","nexSelected","resetToDefaults","$input","UI","enableEdit","saveChanges","cancelChanges","valuesOfConcern","updateNodes","isEnabled","toggleUI","checked","searchTerm","searchConditionVal","searchTree","attrVal","ToolInputsSettings","ToolParameterTree","tree_data","set_tree_data","add_param","remove_param","get_tree_params","params_samples","samples","get_samples","node_id","create_tree_data","param_samples","settings","setting","where","in_ptree","sortBy","get_num_leaves","memo","get_node_settings","target_node","fixed_settings","get_inputs_dict","cur_node","all_settings","get_settings","get_connected_nodes","cur_parent","get_subtree_nodes","a_node","get_leaf","SweepsterTrack","regions","converted_datasets_state_url","object_from_template","same_settings","a_track","this_settings","other_settings","to_dict","TrackCollection","SweepsterVisualization","parameter_tree","default_mode","tool_with_samplable_inputs","remove_inputs","tree_config","SweepsterTrackView","TILE_LEN","draw_tiles","settings_td","settings_div","icon_menu","tile_containers","data_ok","w_scale","tile_data","get_canvas_height","draw_tile","ToolInputValOrSweepView","number_input_template","select_input_template","tool_row","single_input_row","sweep_inputs_row","IntegerToolParameter","SelectToolParameter","options_text","ToolParameterTreeDesignView","tool_form_view","ToolFormView","not","at","ToolParameterTreeView","tree_params","cluster","param_depths","uniq","pluck","center_left","connected_node_ids","SweepsterVisualizationView","helpText","tool_param_tree_view","track_collection_container","handle_node_clicks","tree_design_view","tr","tracks_div","help_div","close_button","mode_mapping","get_base_color","base","run_tool_on_dataset","tool_name","set_input_values","rerun","pm_track","param_tree","settings_leaf","run_jobs_deferred","run_jobs","new_tracks","to_key_value_dict","track_obj","init_for_tool_data","library_util","sort_order","itemA","itemB","libraryA","libraryB","Library","show_deleted","search_term","lowercase_term","getVisible","sortLibraries","mod_util","LibraryItem","Ldda","FolderAsModel","Folder","sortFolder","FolderContainer","folder","folder_contents","folder_item","file_item","HistoryItem","HistoryContents","GalaxyHistory","GalaxyHistories","Jstree","library_model","Item","library_dataset_view","LibraryDatasetView","edit_mode","click .toolbtn_modify_dataset","click .toolbtn_cancel_modifications","click .toolbtn-download-dataset","click .toolbtn-import-dataset","click .copy-link-to-clipboard","click .make-private","click .remove-restrictions","click .toolbtn_save_permissions","click .toolbtn_save_modifications","click .toolbtn_detect_datatype","select_genome","select_extension","list_extensions","auto","list_genomes","fetchExtAndGenomes","fetchDataset","mod_library_model","show_permissions","showPermissions","show_version","fetchVersion","libraries","library_router","back","templateDataset","ldda_id","ldda","renderVersion","templateVersion","enableModification","templateModifyDataset","renderSelectBoxes","genome_build","file_ext","downloadDataset","ld_ids","processDownload","method","importIntoHistory","refreshUserHistoriesList","templateBulkImportInModal","histories","Import","importCurrentIntoHistory","disableButton","new_history_name","new_history","processImportToHistory","enableButton","historyItem","templateDatasetPermissions","fetched_permissions","access_dataset_roles","is_unrestricted","is_admin","is_admin_user","prepareSelectBoxes","_serializeRoles","role_list","selected_roles","accessSelectObject","mod_select","_generate_select_options","modifySelectObject","modify_item_roles","manageSelectObject","manage_dataset_roles","select_options","role","quietMillis","term","page_limit","results","more","total","roles","detectDatatype","ld","_submitModification","saveModifications","is_changed","new_name","new_info","new_message","new_genome_build","new_ext","library_dataset","patch","copyToClipboard","history","substr","makeDatasetPrivate","removeDatasetRestrictions","_extractIds","roles_list","ids_list","savePermissions","access_ids","manage_ids","modify_ids","access_ids[]","manage_ids[]","modify_ids[]","description_url","genomes","current_genome","current_ext","library_folderrow_view","FolderRowView","click .undelete_dataset_btn","click .undelete_folder_btn","click .edit_folder_btn","click .cancel_folder_btn","click .save_folder_btn","visibility_config","edit_folder_btn","save_folder_btn","cancel_folder_btn","permission_folder_btn","prepareButtons","templateRowDeletedFolder","templateRowFolder","templateRowDeletedFile","templateRowFile","content_item","button_config","showDatasetDetails","datasetView","mod_library_dataset_view","undeleteDataset","that","folderListView","updated_dataset","folder_id","undeleteFolder","updated_folder","startModifications","repaint","cancelModifications","new_description","row_view","old_element","library_folderlist_view","FolderListView","progress","progressStep","folderContainer","current_sort_order","current_sort_key","click #select-all-checkboxes","click .dataset_row","click .folder_row","click .sort-folder-name","click .sort-folder-file_ext","click .sort-folder-description","click .sort-folder-state","include_deleted","page_count","show_page","rowViews","renderOne","removeOne","rePaint","fetchFolder","folder_container","templateFolder","upper_folder_id","metadata","full_path","parent_library_id","row","paginate","total_items_count","preferences","page_start","items_to_render","items_shown","folderToolbarView","renderPaginator","removeAllRows","checkEmptiness","addAll","postRender","fetched_metadata","contains_file_or_folder","configureElements","rowView","mod_library_folderrow_view","sortColumnClicked","renderSortIcon","$row","makeDarkRow","makeWhiteRow","selectClickedRow","checkbox","localName","library_libraryrow_view","LibraryRowView","click .edit_library_btn","click .cancel_library_btn","click .save_library_btn","click .delete_library_btn","click .undelete_library_btn","element_visibility_config","upload_library_btn","edit_library_btn","permission_library_btn","save_library_btn","cancel_library_btn","delete_library_btn","undelete_library_btn","library","libraryListView","tmpl","templateRow","edit_button_clicked","cancel_library_modification","save_library_modification","new_synopsis","delete_library","undelete_library","library_librarylist_view","LibraryListView","click .sort-libraries-link","all_fetched","templateLibraryList","libraries_to_render","is_public","deleted","total_libraries_count","libraries_shown","libraryToolbarView","renderRows","fetchDeleted","mod_library_libraryrow_view","sort_clicked","searchLibraries","searching","library_librarytoolbar_view","LibraryToolbarView","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click .page_size_prompt","keyup .library-search-input","toolbar_template","templateToolBar","is_anonym","isAdmin","admin_user","anon_user","paginator_template","templatePaginator","library_page_size","createLibraryFromModal","templateNewLibraryInModal","Create","createNewLibrary","libraryDetails","serializeNewLibrary","validateNewLibrary","clearLibraryModal","showPageSizePrompt","synopsis","includeDeletedChecked","with_deleted","excludeRestrictedChecked","without_restricted","library_foldertoolbar_view","FolderToolbarView","click .toolbtn-create-folder","click .toolbtn-bulk-import","click .include-deleted-datasets-chk","click .toolbtn-bulk-delete","click .toolbtn-show-locinfo","click .page-size-prompt","click .toolbtn-collection-import","can_add_library_item","chain_call_control","total_number","failed_number","disabled_jstree_element","jstree","template_defaults","multiple_add_dataset_options","user_library_import_dir","allow_library_path_paste","library_import_dir","folder_page_size","createFolderFromModal","templateNewFolderInModal","createNewFolderEvent","folderDetails","serializeNewFolder","validateNewFolder","current_folder_id","url_items","fragment","importToHistoryModal","$checkedValues","findCheckedRows","templateImportIntoHistoryModal","fetchUserHistories","importAllIntoHistory","createNewHistory","history_name","checked_items","findCheckedItems","items_to_import","library_dataset_id","folder_ids","library_folder_id","initChainCallControl","chainCallImportingIntoHistory","updateProgress","txt_representation","download","addFilesFromHistoryModal","template_modal","templateAddFilesFromHistory","addAllDatasetsFromHistory","closing_callback","fetchAndDisplayHistoryContents","importFilesFromPathModal","_this5","templateImportPathModal","importFromPathsClicked","_this6","importFilesFromGalaxyFolderModal","_this7","templateBrowserModal","importFromJstreePath","renderJstree","core","plugins","three_state","err_code","preserve_dirs","link_data","space_to_tab","to_posix_lines","tag_using_filenames","file_type","paths","valid_paths","trimmed","chainCallImportingFolders","templateAddingDatasetsProgressBar","folder_name","templateDeletingItemsProgressBar","templateImportIntoHistoryProgressBar","get_selected","selected_nodes","selection_type","li_attr","full_source","chainCallImportingUserdirFiles","_this8","history_contents","history_contents_template","templateHistoryContents","checked_hdas","history_item_ids","history_item_types","items_to_add","item_type","history_item_id","from_hdca_id","from_hda_id","chainCallAddingHdas","history_item_set","_this9","popped_item","pop","_this10","post_url","post_data","encoded_folder_id","_this11","hdas_set","_this12","added_hdas","chainCallDeletingItems","items_to_delete","_this13","deleted_items","item_to_delete","updated_item","checkIncludeDeleted","deleteSelectedItems","row_id","items_total","showLocInfo","_this14","showLocInfoModal","templateLocInfoInModal","showImportModal","showCollectionSelect","_this15","templateCollectionSelectModal","selected_datasets","showCollectionBuilder","prepareCollectionTypeSelect","prepareHistoryTypeSelect","_this16","select_collection_type","updateCollectionType","_this17","history_options","select_collection_history","_this18","collection_elements","elements_source","collection_item","all_datasets","collectionImport","selected_history_id","selected_history_name","creator_class","_this19","modal_title","PAIR_CREATOR","PAIRED_CREATOR","ruleBasedCollectionCreatorModal","elementIdentifiers","HDCA_MODEL","library_library_view","LibraryView","fetchLibrary","access_library_role_list","templateLibraryPermissions","selected_access_library_roles","selected_add_item_roles","add_library_item_role_list","selected_manage_library_roles","manage_library_role_list","selected_modify_library_roles","modify_library_role_list","_createSelectOptions","addSelectObject","is_library_access","add_ids","add_ids[]","library_folder_view","FolderView","templateFolderPermissions","selected_manage_folder_roles","manage_folder_role_list","selected_modify_folder_roles","modify_folder_role_list","LibraryRouter","routesHit","trackPageview","routes","","page/:show_page","library/:library_id/permissions","folders/:folder_id/permissions","folders/:id","folders/:id/page/:show_page","folders/:folder_id/datasets/:dataset_id","folders/:folder_id/datasets/:dataset_id/permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id","folders/:folder_id/download/:format","folders/:folder_id/import/:source","getFragment","ga","LibraryPrefs","mod_baseMVC","SessionStorageModel","sort_by","galaxy_library","libraryView","ga_code","getElementsByTagName","mod_librarytoolbar_view","mod_librarylist_view","mod_foldertoolbar_view","mod_folderlist_view","library_id","mod_library_library_view","folderView","mod_library_folder_view","pushState","ToolShedModel","ToolShedsCollection","ToolShedCategoriesModel","ToolShedCategoriesCollection","ToolShedCategoryModel","ToolShedCategoryCollection","ToolShedRepositoryModel","ToolShedRepositoryCollection","RepoQueueModel","RepoQueueCollection","repositories_enc","repositories","queue_keys","repo","queue_key","RepoStatusModel","RepoStatusCollection","WorkflowToolsModel","toolshed_model","ShedModel","ShedsCollection","Category","Categories","CategoryModel","CategoryCollection","RepositoryModel","RepositoryCollection","RepoQueue","RepoStatus","WorkflowTools","util","searchShed","shed_url","base_url","tool_shed_url","result_list","shedParser","jsondata","hits","hit","record","repository","repo_owner_username","addToQueue","repository_id","changeset_revision","queued_repos","queueLength","repo_queue","toolByGuid","guid","changeset","returned_tool","shed_list_view","ShedListView","tool_sheds","toolshed_list_template","templateToolshedList","toolshed_util","categories_view","CategoryView","tool_shed","shed","categories","category_list_template","templateCategoryList","bindEvents","minLength","tsr_id","new_route","repositories_view","category_id","category","category_contents_template","templateCategoryContents","page_navigation_template","templatePageNavigation","sorting","class","owner","direction","previous_page","next_page","pagination_params","page_slice","slice_start","slice_end","page_navigation","parameters","field","repository_view","RepoDetails","repo_details_template","templateRepoDetails","changesets","ordered_metadata","unordered_metadata","current_changeset","current_metadata","repository_dependencies_template","templateRepoDependencies","repository_dependency_template","templateRepoDependency","tps_template_global_select","templateGlobalSectionSelect","tps_template_global_create","templateGlobalSectionCreate","tps_template_tool_select","templateToolSectionSelect","tps_template_tool_create","templateToolSectionCreate","panel_section_options","templatePanelSelectOptions","tool_dependencies","shed_tool_conf","templateShedToolConf","shed_tool_confs","panel_section_dict","api_url","checkInstalled","reDraw","tpsSelection","tool_shed_repository_ids","install_tool_dependencies","install_repository_dependencies","install_resolver_dependencies","tool_panel_section","panelSelect","prepareInstall","repository_metadata","toolTPSSelectionEvents","desc","toolform","FormView","selectedChangeset","getNamedItem","showToolTPSSelect","showToolTPSCreate","propagateTPS","already_installed","installed","uninstalled","changeset_match","installed_changeset_revision","repoQueued","tool_panel_section_id","new_tool_panel_section","element_name","tool_guid","queueKey","new_tps","iri_parameters","doInstall","controller_url","clean","templateToolDependency","repository_queue_view","RepoQueueView","repo_queue_template","templateRepoQueue","loadFromQueue","installFromQueue","repository_queue","iri_params","repo_status_view","setInterval","terminal_states","all_done","repo_status","clearInterval","close","repo_status_template","templateRepoStatus","workflows_view","workflows_missing_tools","templateWorkflows","tool_ids","toolshed","loadWorkflows","AdminToolshedRouter","sheds","status/r/:repositories","categories/s/:tool_shed","category/s/:tool_shed/c/:category_id/k/:sort_key/p/:page/t/:sort_order","repository/s/:tool_shed/r/:repository_id","admin_toolshed","app_config","known_views","admintoolshedapp","admin_toolshed_router","adminRepoQueueView","mod_repoqueue_view","adminShedListView","mod_shed_list_view","adminShedCategoriesView","mod_categories_view","adminShedCategoryView","mod_repositories_view","adminRepositoryView","mod_repository_view","adminRepoStatusView","mod_repo_status_view","adminWorkflowsView","mod_workflows_view","configs","defaultConfigs","Proxy","propName","buildConfig","WYMeditor","CONTROLS","ITEM_HISTORY","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","ITEM_VISUALIZATION","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_PAGE_LINK","DIALOG_VISUALIZATION_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","get_item_info","dialog_type","item_singular","item_plural","item_controller","item_class","item_list_action","singular","plural","controller","iclass","list_ajax_url","list_objects_url","make_item_importable","item_id","ajax_url","set_accessible_url","accessible","pagesEditorOnload","incoming","setPageConfigs","ajaxError","statusText","Ignore error","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","TOOLS","IFRAME","STATUS","toolsItems","wymeditors","save_url","page_id","xhtml","annotations","page_list_url","containers_menu","items","_options","containersItems","tagname","insert_link_menu_button","Insert History Link","Insert Dataset Link","Insert Workflow Link","Insert Page Link","Insert Visualization Link","embed_object_button","Embed History","Embed Dataset","Embed Workflow","Embed Visualization","dialogType","dialogFeatures","bodyHtml","curURL","curTitle","wym","sStamp","uniqueStamp","DIALOG_LINK","hrefSelector","HREF","srcSelector","SRC","titleSelector","TITLE","altSelector","ALT","Make link","sUrl","sId","sName","_exec","CREATE_LINK","_doc","attribute_input","DIALOG_IMAGE","_selected_image","dialogImageSelector","Insert","INSERT_IMAGE","DIALOG_TABLE","iRows","rowsSelector","iCols","colsSelector","table","TABLE","newRow","sCaption","captionSelector","createCaption","insertRow","insertCell","summarySelector","findUp","MAIN_CONTAINERS","item_info","grid","make_importable","get_name_and_link_url","returned_item_info","link_text","Embed","elt","item_name","item_embed_html","HistoryViewColumn","purgeAllowed","createPanel","setUpListeners","panelOptions","HISTORY_VIEW_EDIT","HistoryViewEdit","setUpPanelListeners","rendered","view:expanded view:rendered","inView","viewLeft","viewRight","columnLeft","$panel","modelData","renderPanel","setUpBehaviors","isCurrentHistory","currentHistory","controlsLeftTemplate","controlsRightTemplate","_renderDropTargetHelp","click .switch-to.btn","setAsCurrent","click .delete-history","_delete","click .undelete-history","undelete","click .purge-history","purge","click .copy-history","historyCopyDialog","variable","multi_panel","MultiPanelColumns","columnWidth","borderWidth","columnGap","headerHeight","footerHeight","controlsHeight","perPage","hdaQueue","ajaxQueue","NamedAjaxQueue","columnMap","columnOptions","historySearch","datasetSearch","setCollection","HistoryCollection","setUpCollectionListeners","createColumns","addModels","addColumn","errorHandler","all-fetched","_postFetchAll","new-current","addAsCurrentColumn","set-as-current","setCurrentHistory","change:deleted change:purged","handleDeletedHistory","renderColumns","fetchData","oldCurrentColumn","newCurrentColumn","currentHistoryId","_recalcFirstColumnHeight","column","removeColumn","isString","ERROR_MODAL","errorModal","badGatewayErrorModal","ajaxErrorModal","_ajaxErrorHandler","createColumn","allow_user_dataset_purge","setUpColumnListeners","queueHdaFetchDetails","newColumn","queueHdaFetch","widthToRemove","checkColumnsInView","in-view","view:draggable:dragstart","_dropData","currentColumnDropTargetOn","view:draggable:dragend","currentColumnDropTargetOff","droptarget:drop","toCopy","isCopyable","responses","columnMapLength","sortedFilteredColumns","sortedColumns","mainTemplate","isNumber","sortedAndFiltered","_addColumns","loadingIndicatorTemplate","columns","numExisting","_calcMiddleWidth","delegateEvents","numColumns","contentsShown","fetchOptions","allExpanded","JOB_STATES_MODEL","jobStateSummariesCollection","haveDetails","progressivelyFetchDetails","renderInfo","click .done.btn","click .create-new.btn","click #include-deleted","click .order .set-order","click #toggle-deleted","click #toggle-hidden","_clickToggleDeletedHistories","toggleDeletedHistories","toggleOptionsPopover","_clickToggleDeletedDatasets","toggleDeletedDatasets","toggleShowDeleted","_clickToggleHiddenDatasets","toggleHiddenDatasets","toggleShowHidden","_chooseOrder","orderKey","orderDescriptions","currentHistoryModel","_scrollLeft","_moreOptionsPopover","curr","debouncedInView","debounce","_viewport","checkForEndOfScroll","optionsPopoverTemplate","$firstColumn","middleHeight","controlHeight","$outerMiddle","columnsInView","vp","currentColumn","dataDropped","dropTargetOn","dataDrop","dropTarget","name-dsc","size-asc","HISTORY_VIEW","HistoryView","history_view_annotated","AnnotatedHistoryView","renderHistoryAnnotation","click .contents-container","click .icon-btn","$currTarget","dropdown","_clickSectionLink","sectionNumber","openSection","ajaxSettings","grid_config","GridModel","dict_format","title_id","add_tag_to_grid_filter","tag_name","tag_value","slideToggle","add_filter_condition","init_grid","padding","overflow","handle_refresh","refresh_frames","loadCurrentHistory","allow_title_display","setWindowTitle","Templates","use_hide_message","init_grid_elements","init_grid_controls","init_refresh_on_change","submit_operation","set_sort_condition","column_key","text_input_obj","text_input","remove_filter_condition","set_categorical_filter","check_all_items","checkboxes","check_count","update_checked","rating","set_page","encode_id","popup","PopupMenu","_add_operation","operation_config","allowed","allow_popup","addItem","url_args","confirmation_text","findItemByHtml","filter_element","go_page_one","col_key","cur_sort","new_sort","sort_arrow","category_filter","cur_value","filter_value","new_page","page_num","operation_button","operation_name","check","href_parts","href_parms","update_grid","response_text","parseJSON","complete","date_by_subtracting_days","date","days","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","date_by_subtracting_hours","hours","create_chart","inp_data","hours_array","now","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","days_array","barWidth","chart_width","chart_zoom","chart_height","chart","bar","curr_margin","wdth","parentElement","m_y","l_x","l_y","yAxis","axis","orient","tickFormat","left_pad","top_pad","curr_day","_y2","curr_day_text","toLocaleString","month","text_height","this_width","getBBox","curr_month","curr_month_text","create_histogram","histogram","bins","lengths","bar_x","dx","xAxis","minutes","Group","group_model","group_listrow_view","GroupListRowView","group","group_list_view","GroupListView","globalTS","groups","mod_group_model","templateGroupsList","groups_to_render","mod_group_row","tmpl_array","group_detail_view","GroupDetailView","group_id","fetchGroup","ToolshedRouter",":group_id","toolshed_groups","ToolshedGroups","groupListView","groupDetailView","ts_router","mod_group_list","mod_group_detail","isObject","oldConfig","idAndTitle","existing","merged","state_info","modified","dataset_id_job","viz_options","visualization_id","visualization_name","chart_dict","serialize","chart_parsed","GroupView","plugin","data_columns","FormData","visitInputs","prefixed","is_auto","is_zero","meta","metadata_column_types","is_numeric","is_label","model_value","repeat","title_new","panel_option","specs","$image","logo","linkify","Description","_fullscreen","_createContainer","confirmed","_draw","targets","container_id","container_el","n_panels","chart_load","_downloadData","imageData","filename","_downloadPNGData","toXML","$svg","nsvgs","serializer","XMLSerializer","$composite","xmlns","$target","sheet_id","styleSheets","sheet","rules","cssRules","idx","selectorText","cssText","_inline","$g","string","serializeToString","screenshot","createPNG","xml","btoa","drawImage","toDataURL","_svg2png","$canvas","newCanvas","newContext","restore","textAlign","textBaseline","_toImage","x_offset","y_offset","imgData","_canvas2png","createSVG","createPDF","execute_button","export_button","_wait","Screenshot","viewer","left_button","dispatchEvent","Event","right_button","save_button","$center","$right","Chart","visualization_plugin","Viewer","Editor","errormessage","dataset_groups","column_list","column_def","column_name","block_id","_block_id","provider","indeces","column_length","_fillFromCache","column_data","group_index","dict","requestPanels","valid","mapCategories","array","value_dict","makeCategories","column_keys","__data_columns","makeUniqueCategories","with_index","counter","makeSeries","plot_data","value_index","point","key_index","column_index","getDomains","_apply","operator","value_sub","makeTickFormat","precision","formatter","d3format","prefix","symbol","addZoom","xDomain","yDomain","xScale","yScale","x_boundary","y_boundary","d3zoom","fixDomain","boundary","nice","refreshHdas","refreshContents","jobs","job","requestCharts","settings_string","columns_string","settings_value","components_Mastheadvue_type_script_lang_js_","backboneRender","updated","scripts_app","$props","backboneDom","Masthead","initMasthead","panelManagement","panelConfig","left_panel","right_panel","rightPanelSelector","leftPanelSelector","lp","bundleEntries","panels","LeftPanel","force_left_panel","force_panel","rp","RightPanel","handle_minwidth_hint","force_right_panel","adminToolshed","bundleEntries_trackster","trackster","bundleEntries_circster","bundleEntries_workflow","workflow_view","bundleEntries_library","multiHistory","history_model","includingDeleted","current_history_id","multipanel","jquery_custom_js_exposed_default","bundleEntries_chart","chart_client","chartUtilities","dataset_data","history_history_contents","history_view","copy_dialog","hda_li_edit","hda_model","grid_grid_view","layout_panel","modal_Modal","popupmenu","store_modern_default","Datasets","Jobs","Series","getRootFromIndexLink","form_input_auto_focus","sentry","config$","initQueue","Subject","mergedConfigs","pipe","scan","currentConfig$","BehaviorSubject","subscribe","asObservable","debounceTime","fragments","getValue","defaultRoot","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","define","localeStrings","localize","strToLocalize","cacheNonLocalized","_go","commatize","rgx","get_random_color","colors","new_color","nr","ng","nb","other_color","or","og","ob","n_brightness","o_brightness","diff","r1","g1","b1","r2","g2","b2","brightness","ok","num_tries","random","xlarge","buttonList","canceled","getButton","showButton","hideButton","DatasetCollection","mvc_ui_icon_button__WEBPACK_IMPORTED_MODULE_5__","app__WEBPACK_IMPORTED_MODULE_6__","DatasetMetadata","_set_metadata","new_key","get_metadata","attribute","chunk_url","first_data_chunk","at_eof","url_viz","get_next_chunk","next_chunk","ck_data","TabularDatasetChunkedView","row_count","loading_chunk","TabularButtonTracksterView","expand_to_container","scroll_elt","attempt_to_fetch","scrolled_to_bottom","loading_indicator","_renderChunk","data_table","cellpadding","column_names","header_container","header_row","first_chunk","_renderCell","cell_contents","colspan","$cell","column_types","_renderRow","cells","num_columns","TopLevelTabularDatasetChunkedView","EmbeddedTabularDatasetChunkedView","innerHeight","scrollHeight","col","btn_viz","IconButtonView","IconButton","mouseover tr","btn_viz_pars","gene_region","dataset_config","faIconButton","faIcon","app_options","text_connected_enable","text_connected_disable","cls_enable","cls_disable","always_refresh","$field","$preview","$collapsible","$collapsible_text","$collapsible_icon","$connected_icon","$title_text","$error_text","$error","help_text","help_argument","collapsible","collapsible_disabled","collapsible_state","connected_icon_style","connected_icon_margin","connected_collapsible_state","Batch","Configurations","batch","data_multiple","data_collection","workflow_data_multiple","workflow_data_collection","module_data","module_data_collection","ui_select_content","src_labels","hda","hdca","pagelimit","statustimer","button_product","$batch_div","$batch","linked","enabled","lastenter","_handleDrop","_changeCurrent","_changeType","id_list","_batch","$batchfield","batchmode","button_type","config_id","button_data","searchable","individual","button_width","margin-left","keep","drop_data","new_id","new_src","current_value","_handleDropStatus","map_over_type","ui_list","selections","v_id","v_name","lst","_templateRow","LibraryDatasets","ui_select_library","library_select","List","ui_select_ftp","ftpfile_list","tool_genomespace","GS_UI_URL","genomespace_ui_url","GS_UPLOAD_URL","newWin","successCallback","destination","setCallbackOnGSUploadError","ui_select_genomespace","browse_button","browseGenomeSpace","filename_textbox","GenomespaceBrowser","RuleDisplayPreview","rule","staticRenderFns","colHeaders","ruleType","rule_definitions","RULES","IdentifierDisplayPreview","columnsLabel","typeDisplay","MAPPING_TARGETS","columnDisplay","components_RulesDisplayvue_type_script_lang_js_","mapping","inputRules","columnData","colHeadersPerRule","applyRules","colHeadersFor","RulesDisplay","col-headers","_b","ui_rules_edit","_fetcCollectionAndEdit","_showRuleEditor","rulesDisplayInstance","instance","initialRules","_showCollection","_renderFetchError","saveRulesFn","_handleRulesSave","_value","validate","hex","standard","theme","$view","$value","_build","$boxes","_templateCheck","rgb","_content","line_def","_templateContent","$line","$box","_templateBox","password","data_column","genomebuild","integer","float","boolean","drill_down","group_tag","hidden_data","baseurl","library_data","ftpfile","upload","genomespacefile","fieldClass","_fieldSelect","_fieldText","_fieldData","SelectContent","flavor","radio","radiobutton","_fieldDrilldown","str_value","_fieldSlider","_fieldHidden","_fieldBoolean","_fieldColor","ColorPicker","_fieldLibrary","SelectLibrary","_fieldFtp","SelectFtp","_fieldGenomeSpace","SelectGenomeSpace","_fieldRulesEdit","RulesEdit","_fieldUpload","Parameters","input_list","_addConditional","_addRepeat","_addSection","_addRow","cases","sub_section","_append","selectedCase","matchCase","case_def","section_row","nonhidden","block_index","sub_section_id","n_cache","input_element","InputElement","collapsible_button","field_list","hide_label","text_value","collapsible_preview","argument","form_section","new_model","matchModel","is_dynamic","error_messages","matchResponse","Manager","_renderForm","current_check","checksum","refresh_on_change","new_check","section","FormSection","onchange_title","FoldoutListItemView","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_3__","ExpandableView","$details","_renderDetails","$newDetails","toggleExpanded","_fetchModelDetails","_expand","mixin","SelectableViewMixin","DraggableViewMixin","isSelectable","_renderWarnings","_renderTitleBar","_renderPrimaryActions","draggableOn","$warnings","templateFn","click .title-bar","keydown .title-bar","click .selector","_clickTitleBar","toggleSelect","_keyDownTitleBar","detailsTemplate","foldoutStyle","foldoutPanelClass","foldout","_createFoldoutPanel","_attachFoldout","FoldoutClass","_getFoldoutPanelOptions","_expandByDrilldown","ui_popupmenu__WEBPACK_IMPORTED_MODULE_3__","menu_options","is_menu_button","new_elem","buffer","IconButtonCollection","IconButtonMenuView","global_config","utils_utils__WEBPACK_IMPORTED_MODULE_1__","wait_cls","percentage","$progress","$progress_bar","setIcon","icons","pull","onunload","$root","submodel","suboptions","mvc_history_hdca_model__WEBPACK_IMPORTED_MODULE_3__","mvc_dataset_states__WEBPACK_IMPORTED_MODULE_4__","mvc_collection_base_creator__WEBPACK_IMPORTED_MODULE_6__","mvc_ui_ui_modal__WEBPACK_IMPORTED_MODULE_7__","utils_localization__WEBPACK_IMPORTED_MODULE_8__","utils_localization__WEBPACK_IMPORTED_MODULE_8___default","vue__WEBPACK_IMPORTED_MODULE_9__","DatasetCollectionElementView","discard","parentWidth","margin-right","click .name","click .discard","_click","_clickName","_clickDiscard","minElements","defaultAttributes","TypeError","highlightClr","initialElements","_instanceSetUp","_elementsSetUp","invalidElements","_ensureElementIds","_validateElements","_sortElements","problem","_isElementInvalid","purged","existingNames","currName","problems","_invalidElementsAlert","_disableNameAndCreate","_renderClearSelected","_listenToElementView","addElementView","_renderNoElementsLeft","noElementsLeft","_elementToJSON","_errorHandler","click .reset","click .clear-selected","click .collection-elements","dragover .collection-elements","drop .collection-elements","collection-element.dragstart .collection-elements","collection-element.dragend   .collection-elements","clearSelectedElements","_dragoverElements","_getNearestElement","_dropElements","_syncOrderToDom","newElements","_elementDragstart","_elementDragend","collectionCreatorModalSetup","UI_MODAL","creatorOptions","showEl","CreatorClass","_collectionCreatorMod","elementsType","importType","_collectionCreatorMod2","ruleCollectionBuilderInstance","ftpUploadSite","listCollectionCreatorModal","createListCollection","createCollectionViaRules","selection","selectionType","hasNonWhitespaceChars","lines","exec","hasTabs","regex","queryString","keyRegex","decodeURIComponent","pairString","decodeURI","initializations$","addInitialization","_len","fns","_key","nextInits","_toConsumableArray","prependInitialization","_len2","_key2","clearInitQueue","viz_trackster_util__WEBPACK_IMPORTED_MODULE_3__","ConfigSetting","set_default_value","saved_values","fixed_farb_obj","container_div","tip","siblings","new_color_icon","tip_inner","farb_obj","farbtastic","setColor","cancel_fn","ok_fn","update_from_form","mvc_dataset_dataset_model__WEBPACK_IMPORTED_MODULE_1__","mvc_history_history_content_model__WEBPACK_IMPORTED_MODULE_2__","DATASET","DatasetAssociation","hcontentMixin","HISTORY_CONTENT","HistoryDatasetAssociation","grid_template","grid_header","grid_table","info_text","id_str","global_actions","show_popup","grid_filters","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","sortable","extra","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","current_item_id","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","nowrap","column_settings","column_config","popup_id","attach_popup","delayed","use_paging","num_page_links","cur_page_num","page_link_range","min_page","min_offset","max_offset","max_range","max_page","page_index","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","allow_multiple","found_global","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","global_operation","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","legend","default_filter_dict","advanced_search_display","show_advanced_search_link","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","filterable","f_key","d_key","standard_search_display","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","grid_column_filter","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","column_label","is_text","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_step11","_iterator11","column_filter","seperator","cf_label","cf","cf_key","cf_arg","filter_key","sanitize","store","watch","gridSearch","searchTags","newTags","tagArray","from","openAdvancedSearch","render_filter_button","markViewAsLoading","getRootClassName","add_operation","dispatch","_ref","_ref$title","slugify","utils_localization__WEBPACK_IMPORTED_MODULE_2__","utils_localization__WEBPACK_IMPORTED_MODULE_2___default","CONTACT_MSG","DEFAULT_AJAX_ERR_MSG","DETAILS_MSG","_errorModal","offlineErrorModal","raven","Raven","userAgent","onLine","omit","functions","lastAjax","_ajaxDetails","serverPath","rawUrl","URL","pathname","titleBarTemplate","subtitleTemplate","mvc_list_list_item__WEBPACK_IMPORTED_MODULE_2__","mvc_dataset_dataset_li__WEBPACK_IMPORTED_MODULE_3__","utils_localization__WEBPACK_IMPORTED_MODULE_5__","utils_localization__WEBPACK_IMPORTED_MODULE_5___default","linkTarget","hasUser","$selector","DCEListItemView","DatasetDCEListItemView","inReadyState","NestedDCDCEListItemView","mvc_history_history_contents__WEBPACK_IMPORTED_MODULE_5__","mvc_base_controlled_fetch_collection__WEBPACK_IMPORTED_MODULE_6__","utils_utils__WEBPACK_IMPORTED_MODULE_7__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_8__","utils_localization__WEBPACK_IMPORTED_MODULE_9__","utils_localization__WEBPACK_IMPORTED_MODULE_9___default","SearchableModelMixin","UPDATE_DELAY","contents_active","contents_states","contentsClass","searchAttributes","searchAliases","historyJSON","change:id","newId","makeArray","contentsActive","shown","nice_size","UTILS","bytesToString","ownedByCurrUser","numOfUnfinishedJobs","unfinishedJobIds","numOfUnfinishedShownContents","runningAndActive","_fetchContentRelatedAttributes","refresh","lastUpdateTime","fetchUpdated","serverResponseDatetime","getResponseHeader","checkForUpdates","_delayThenUpdate","historyData","stopPolling","fetchWithContents","contentsOptions","setHistoryId","fetchContents","allDatasets","_collectionSuper","CONTROLLED_FETCH_COLLECTION","change:deleted","copied","original","setCurrent","oldCurrentId","superFilters","encoded_id-in","hdas","historyOptions","xhrOptions","d3__WEBPACK_IMPORTED_MODULE_2__","d3__WEBPACK_IMPORTED_MODULE_2___default","app__WEBPACK_IMPORTED_MODULE_5__","mvc_dataset_data__WEBPACK_IMPORTED_MODULE_7__","VisibilityMixin","ToolParameter","unescape","ToolParameterCollection","DataToolParameter","FloatToolParameter","subModelTypes","incompatible_inputs","only_samplable_inputs","valid_inputs","apply_search_results","set_input_value","inputs_dict","input_name","run","_run","target_dataset","target_dataset_id","input_dict","additional_params","run_deferred","ToolCollection","ToolSectionLabel","ToolSection","elems","clear_search_results","cur_label","all_hidden","ToolSearch","SEARCH_RESERVED_TERMS_FAVORITES","search_hint_string","min_chars_for_search","clear_btn_url","clear_key","do_search","clear_search","ToolPanel","parse_elt","elt_dict","panel_elt","BaseView","update_visible","ToolLinkView","tool_link","formStyle","ToolSectionLabelView","ToolSectionView","update_open","panel_section","section_body","tool_view","label_view","click .toolSectionTitle > a","ToolSearchView","keyup :input","change :input","click #search-clear-btn","focus_and_select","query_changed","evData","ToolPanelView","handle_search_results","search_view","section_title_view","tool_form","mvc_list_list_item__WEBPACK_IMPORTED_MODULE_4__","mvc_dataset_states__WEBPACK_IMPORTED_MODULE_5__","ui_fa_icon_button__WEBPACK_IMPORTED_MODULE_6__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_7__","components_Nametags__WEBPACK_IMPORTED_MODULE_9__","_mountVueNametags","changedAttributes","_renderDisplayButton","displayBtnData","noAccess","_renderSecondaryActions","_renderSummary","_renderDetailMessages","_renderDisplayApplications","summaryRenderFn","summaries","unknown","detailMessages","isDeletedOrPurged","displayApplications","_renderDownloadButton","_renderShowParamsButton","show_params","hasData","_renderMetaFileDownloadButton","meta_file","meta_download","click .display-btn","click .params-btn","click .download-btn","failed_metadata","noAccessTemplate","summaryTemplates","detailMessageTemplates","resubmitted","displayApplicationsTemplate","viz_views","TrackHeaderView","update_name","drag_handle_class","action_icons","render_action_icons","dblclick","icons_div","action_icons_def","icon_dict","add_action_icon","css_class","on_click_fn","set_display_modes","display_modes","new_modes","init_mode","mode_icon","change_mode","SlottedInfo","FeatureSlotter","max_rows","slots","start_end_dct","include_label","_get_draw_coords","draw_start","draw_end","f_name","text_len","_find_slot","draw_coords","slot_num","has_overlap","k_len","s_e","slot_features","features","feature_uid","undone","highest_slot","slotted_info","old_draw_coords","new_draw_coords","slotted_coords","dc","slotting","first_region","second_region","is_overlap","overlap","drawDownwardEquilateralTriangle","ctx","down_vertex_x","down_vertex_y","side_len","x1","x2","sqrt","lineTo","fill","closePath","Scaler","default_val","DrawResults","incomplete_features","feature_mapper","Painter","view_start","view_end","default_prefs","chrom_pos","_chrom_pos_to_draw_pos","LinePainter","_possibleConstructorReturn","_getPrototypeOf","in_path","min_value","max_value","vertical_range","height_px","x_scaled","delta_x_pxs","y_zero","delta_x_px","painter_color","block_color","pref_color","pref_r","pref_g","pref_b","top_overflow","bot_overflow","saturation","new_r","new_g","new_b","overflow_x","overflow_color","FeaturePositionMapper","slot_height","feature_positions","translation","y_translation","feature_data","x_start","x_end","feature_dict","FeaturePainter","alpha_scaler","height_scaler","max_label_length","rows_required","required_height","get_row_height","y_scale","get_top_padding","x_draw_coords","feature_start","feature_end","draw_element","map_feature_data","tile_low","tile_high","connector_color","LinkedFeaturePainter","draw_background_connector","draw_individual_connectors","feature_name","feature_strand","f_start","f_end","y_start","thick_start","thick_end","reverse_strand_color","label_color","globalAlpha","gen_val","thin_height","thick_height","feature_ts","feature_te","feature_blocks","full_height","cur_y_start","cur_height","SQUISH_FEATURE_HEIGHT","last_block_start","last_block_end","block","block_start","block_end","block_thick_start","block_thick_end","draw_connector","hscale_factor","new_height","ws_height","fillText","ReadPainter","ref_seq","base_color_fn","show_insertions","cigar_str","blocks","cur_block","base_pos","parsed_cigar","op_len","op_char","cigar","strand","read_seq","update_base_offset","cig_op","cig_len","update_seq_offset","get_draw_coord","sequence_coord","drawing_blocks","s_start","s_end","tile_region","base_offset","seq_offset","gap","detail_block_color","pack_mode","draw_height","rect_y","paint_utils","ReadPainterUtils","draw_last","_parse_cigar","cig_id","cig","cur_seq","start_pos","show_differences","c_start","draw_deletion","insert_x_coord","seq","x_center","str_len","draw_read","b1_end","b2_start","line_height","y1","y2","dashLen","dX","dY","dashes","dashX","dashY","dashedLine","ArcLinkedFeaturePainter","longest_feature_length","calculate_longest_feature_length","block1_start","block1_end","block2_start","block2_end","Color","alpha","argb","color2","weight","toHSL","w1","w2","LinearRamp","start_color","end_color","start_value","end_value","value_range","mix","toCSS","SplitRamp","middle_color","positive_ramp","negative_ramp","map_value","DiagonalHeatmapPainter","e1","e2","invsqrt2","ramp","neg_color","pos_color","rotate","row_height","px_per_base","draw_details","delete_details_thickness","thickness","painters","VariantPainter","divider_height","summary_height","show_sample_data","locus_data","alt","sample_gts","allele_counts","variant","draw_x_start","draw_y_start","genotype","get_indel_info","ref_len","alt_len","base_px","feature_height","draw_summary","alt_info","indel_info","get_start_draw_pos","allele_frac","snp","get_draw_pos","Filter","obj_dict","tool_exp_name","create_action_icon","NumberFilter","Number","MAX_VALUE","slider_label","parent_div","filter_label","values_span","values_span_container","span","slider_div","control_element","get_slider_step","slide","input_size","multi_value","slider_row","slider_min","slider_max","invalid","a_val","display_controls_div","transparency_icon","alpha_filter","request_draw","clear_after","height_icon","height_filter","applies_to","_keep_val","to_filter","returnVal","update_attrs","update_ui_elt","FiltersManager","alpha_filter_name","height_filter_name","filters_dict","run_buttons_row","run_on_dataset_button","filter_manager","run_on_dataset","filter_dicts","init_filters","clear_filters","tool_filter_conditions","get_or_create_dict_item","new_item","active_filters","active_filters_list","run_filter","input_dataset_id","filter_tuple","tool_filters","url_params","cond","run_tool_url","trackster_filters","bbi_data_manager","BBIDataManager","bb","readWigData","prev","MIN_VALUE","html_elt_js_obj_dict","is_container","moveable","handle_class","container_selector","element_js_obj","relative","this_obj","cur_container","remove_drawable","add_drawable_before","add_drawable","move_drawable","deltaY","DATA_NOCONVERTER","CONTINUOUS_DATA_MODES","places","pow","Drawable","is_overview","build_config_params","config_onchange","build_container_div","header_div","header_view","drawable","toggle_icon","hide_contents","show_contents","config_params","can_draw","set_name","old_name","revert_name","update_intro_div","update_icons","get_drawables","DrawableCollection","unpack_drawables","drawables_array","dictified_drawables","replace_drawable","old_drawable","new_drawable","update_html","new_position","get_tracks","track_type","DrawableGroup","content_div","filters_mod","saved_filters_managers","old_manager","setup_multitrack_filtering","show_composite_track","_restore_filter_managers","clear_tile_cache","tiles_div","num_drawables","composite_icon","filters_icon","CompositeTrack","a_type","get_type","num_feature_tracks","FeatureTrack","LineTrack","shared_filters","filter_name","new_filter","composite_track","TracksterView","label_tracks","tracks_to_be_redrawn","zoom_factor","min_separation","load_chroms_deferred","ownerDocument","requested_redraw","parent_element","top_container","browser_content_div","bottom_container","top_labeltrack","viewport_container","intro_div","nav_container","nav","overview_viewport","overview_close","overview_highlight","overview_box_background","overview_box","default_overview_height","nav_controls","chrom_select","nav_input","location_span","all_features","feature_search_deferreds","dataset_features","hidden_input","zo_link","zoom_out","zi_link","zoom_in","load_chroms","change_chrom","current_x","delta_chrom","move_delta","reset_overview","clientX","original_low","current_height","new_scroll","startX","update_location","old_low","request_redraw","add_label_track","LabelTrack","resize_timer","resize_window","trigger_navigate","new_chrom","new_low","new_high","url_parms","reference","ref_track","ReferenceTrack","reference_track","chrom_option","prev_chroms","next_chroms","chrom_start_index","start_index","grep","move_fraction","fraction","current_chrom_span","data_fetch","redraw_on_move_fn","label_track","track_list","track_options","to","_redraw","resolution_px_b","left_px","width_px","cur_center","new_half","resize_viewport","set_overview","overview_drawable","postdraw_actions","TracksterTool","tools_mod","state_dict","ToolParameterView","param_div","update_value","update_event","TracksterToolView","set_visible","keydown","param_view","run_tool_row","run_on_region","update_params","track_data","track_name","tool_region_and_parameters_str","set_filters_manager","set_dataset","FilterScaler","Tile","html_elt","predisplay_actions","LineTrackTile","FeatureTrackTile","all_slotted","seq_data","has_icons","other_tiles_features_drawn","Track","dataset_check_type","data_url_extra_params","data_query_wait","data_and_mode_compatible","min_height_px","max_height_px","visible_height_px","add_resize_handle","No","Yes","regions_to_use","view_region","bookmarked_regions","on_resize","in_handle","in_drag","drag_control","original_height","tile_cache","ReadTrack","VariantTrack","msg_html","retry","init_deferred","kind","valid_chroms","predraw_init","msg_elt","stats","mean","sd","TiledTrack","filters_available","left_offset","dynamic_tool_div","overlay_div","slotters","set_min_max","new_mode","tools_icon","param_space_viz_icon","_gen_tile_cache_key","before_draw","tile_promise","tile_width","tile_index","tile_promises","tiles","draw_helper","tile","_add_yaxis_label","on_change","pref_name","num_cols","get_mode","update_auto_mode","display_mode","_get_drawables","show_tile","get_tile_data","data_mode","tile_drawn","tracks_data","drawing_modes","drawing_heights","globalCompositeOperation","_draw_line_track_tile","draw","tile_element","track_height","region_str","param_str","extra_info","tickDistance","new_div","screenPosition","union","show_group","visible_height","init_deferreds","update_all_min_max","max_height","new_visible","cur_visible","subset","beforeSend","setRequestHeader","supportsByteRanges","bbi","DiagonalHeatmapTrack","summary_draw_height","set_painter_from_config","painter","all_incomplete_features","inc_features","tile_incomplete_features","new_canvas_ctx","new_tile","example_feature","show_more_rows_icon","incremental_slots","slotter","dummy_painter","get_required_height","cur_tile","filtered","hide_feature","flen","filter_alpha_scaler","filter_height_scaler","draw_results","deferreds","line_track_tiles","sample_names","font_size","font-size","samples_div_html","line-height","addable_objects","VcfTrack","drawable_type","TagModel","keyedColorScheme","styles","createTag","equals","otherTag","Tags_StatelessTagsvue_type_script_lang_js_","VueTagsInput","vue_tags_input_default","autocompleteItems","maxVisibleTags","useToggleLink","tagText","tagToggle","triggerKeys","tagContainerClasses","tagModels","autocompleteTags","linkText","linkVisible","tagsVisible","newValue","tagsChanged","pluckLabels","toggleTagDisplay","beforeAddingTag","emitHookEvent","addTag","beforeDeletingTag","deleteTag","eventName","hasHandler","$listeners","includes","StatelessTags","_f","autocomplete-items","add-on-key","before-adding-tag","before-deleting-tag","tags-changed","scopedSlots","_u","$$v","expression","TagService","itemClass","_ref$debounceInterval","debounceInterval","_searchText","_autocomplete","_delete2","_save","_asyncToGenerator","regeneratorRuntime","mark","_callee","rawTag","_context","sent","abrupt","_x","_callee2","_context2","_x2","_callee3","searchText","_context3","rawResponse","_x3","txt","distinctUntilChanged","switchMap","vue_runtime_esm","use","vue_rx_esm","Tags_Tagsvue_type_script_lang_js_","tagService","tagService_TagService","observedTags","updateTags","subscriptions","autocompleteOptions","resultTags","existingTags","newModels","existingModels","st","_ref2","updateTagSearch","searchTxt","autocompleteSearchText","tag-click","tag-input-changed","BackboneTagService","_TagService","backboneTagService_classCallCheck","_inherits","backboneTagService_asyncToGenerator","Set","mountMakoTags","_options$tags","_options$disabled","_options$context","propData","$on","makoClickHandler","_options$tagClickFn","tagClickFn","clickUrl","mountModelTags","_options$disabled2","_options$context2","_model$attributes","_model$attributes$tag","mounts_mountMakoTags","mounts_mountModelTags","defaultAppFactory","setGalaxyInstance","doNothing","mock","installMonitor","globalProp","setter","getToggles","configurable","groupCollapsed","trace","_monitorStorage","groupEnd","installObjectWatcher","toggleGlobalMonitor","bShow","toggleList","setToggles","showMonitorToggles","monitorInit","monitoredProps","initSentry","_config$sentry","sentry_dsn_public","email","install","setUser","initTooltips","adjustIframeLinks","anchor","galaxy_main_exists","galaxy_main","addIframeClass","classList","onloadWebhooks","enable_webhooks","replace_big_select_inputs","min_length","max_length","select_elts","select_elt","num_options","closeOnSelect","initTours","initModals","standardInit","appFactory","galaxy$","cfg","combineLatest","_slicedToArray","inits","DatasetCollectionElementMixin","element_identifier","element_index","element_type","_mergeObject","elementId","element_id","DatasetCollectionElement","DCECollection","DatasetDCE","DATASET_MODEL","datasetId","_getDatasetId","_downloadQueryParameters","fileExt","elementIdentifier","parentHdcaId","objStr","DatasetDCECollection","NestedDCDCECollection","_createElementsModel","parent_hdca_id","populated","getVisibleContents","recursive","idAndName","NestedDCDCE","collection_model","DC","DC_MODEL","WebhookView","toolId","toolVersion","filterType","weights","sum","normalizedWeightsMap","Map","_step$value","weightedRandomPick","itype","AjaxQueue","initialFunctions","numToProcess","fnIndex","notify","causeFail","names","_get","total_disk_usage","resp","updatePreferences","favorites","object_type","new_favorites","idOrCurrent","CURRENT_ID_STR","userFn","newModel","userInfo","getCurrentUserFromApi","currentUser","user_model","addLogging","NAMESPACE_KEY","FLATTEN_LOG_MESSAGES_KEY","localDebugging","storageErr","Events","_processOptions","_initConfig","existingGalaxy","_patchGalaxy","_initLogger","loggerOptions","_initLocale","_initUser","_initUserLocale","patchExisting","patchWith","metricsLogger","global_locale","default_locale","extra_user_preferences","user_locale","nav_locale","userJSON","userModel","debugging","debuggingNamespaces","namespaces","csv","newSettings","userEmail","factory","getStorage","newInstance","_galaxyInstance","galaxyStub","mvc_ui_ui_modal__WEBPACK_IMPORTED_MODULE_0__","mvc_ui_error_modal__WEBPACK_IMPORTED_MODULE_1__","underscore__WEBPACK_IMPORTED_MODULE_3__","underscore__WEBPACK_IMPORTED_MODULE_3___default","jquery__WEBPACK_IMPORTED_MODULE_4__","jquery__WEBPACK_IMPORTED_MODULE_4___default","CopyDialog","defaultName","submitLabel","errorMessage","progressive","activeLabel","allLabel","anonWarning","_showAjaxIndicator","margin-top","defaultCopyName","nameFn","defaultCopyWhat","allowAll","autoClose","checkNameAndCopy","copyAllDatasets","rejectWith","originalClosingCallback","isAnon","copyWhat","cancelled","ImportDialog","MODAL","useImport","multiColumnsToString","targetColumns","targetHeaders","removeColumns","newColumns","applyRegex","replacement","groupCount","regExp","pyre","failedCount","pyreReplace","flatMap","xs","acc","add_column_basename","target_column","addColumnBasenameTarget","sources","add_column_rownum","addColumnRownumStart","rownum","add_column_value","addColumnValue","addValue","add_column_metadata","addColumnMetadataValue","ruleValue","identifierIndex","add_column_group_tag_value","addColumnGroupTagValueValue","addColumnGroupTagValueDefault","groupTagPrefix","groupTagValue","add_column_regex","addColumnRegexTarget","addColumnRegexExpression","addColumnRegexReplacement","addColumnRegexGroupCount","group_count","addColumnRegexType","add_column_concatenate","target_column_0","target_column_1","addColumnConcatenateTarget0","addColumnConcatenateTarget1","target0","target1","add_column_substr","substr_type","addColumnSubstrTarget","addColumnSubstrLength","addColumnSubstrType","originalValue","remove_columns","target_columns","removeColumnTargets","add_filter_regex","addFilterRegexTarget","addFilterRegexExpression","addFilterRegexInvert","invert","filterFunction","add_filter_count","addFilterCountN","addFilterCountWhich","addFilterCountInvert","inverse","dataLength","add_filter_empty","addFilterEmptyTarget","addFilterEmptyInvert","add_filter_matches","addFilterMatchesTarget","addFilterMatchesValue","addFilterMatchesInvert","add_filter_compare","compare_type","addFilterCompareTarget","addFilterCompareValue","addFilterCompareType","targetValue","addSortingTarget","addSortingNumeric","numeric","aVal","bVal","newSources","zipped","swap_columns","swapColumnsTarget0","swapColumnsTarget1","tempColumn","split_columns","splitColumnsTargets0","target_columns_0","splitColumnsTargets1","target_columns_1","targets0","targets1","newRow0","newRow1","list_identifiers","columnHeader","paired_identifier","collection_name","modes","name_tag","group_tags","ftp_path","requiresFtp","headersPerRule","hasRuleError","ruleIndex","ruleHeaders","columnNames","utils_utils__WEBPACK_IMPORTED_MODULE_0__","label_id_prefix","_iterate","result_dict","flat_id","input_value","flat_dict","convert","block_indices","block_prefix","block_label","separator","truevalue","falsevalue","ModeButton","currModeIndex","DATA_KEY","switchModesOnClick","modeButton","callModeFn","_incModeIndex","_getModeIndex","modeKey","_setModeByIndex","newMode","currentMode","getMode","hasMode","setMode","initialMode","modeFn","fnName","historyEntry","paginationTemplate","LIST_VIEW","HDAViewClass","HDA_LI","HDCAViewClass","HDCA_LI","views:ready view:attached view:removed","_renderSelectButton","view:attached","loadHistory","fetching-more","_toggleContentsLoadingIndicator","fetching-more-done","$indicator","$existing","$emptyMsg","haveSearchDetails","_renderPagination","_renderSomeItems","$paginationControls","pagination","isExpanded","addExpanded","removeExpanded","clearExpanded","click .show-selectors-btn","click > .controls .prev","click > .controls .next","change > .controls .pages","click .messages [class$=message]","_clickPrevPage","_clickNextPage","_changePageSelect","setIncludeDeleted","setIncludeHidden","clearMessages","scrollToHid","ordinalIndicator","numStr","initialModeDeleted","initialModeHidden","hview","switchToHistory","hasMasthead","userIsOwner","HistoryCopyDialog","historyView","showDeletedJson","show_hidden","showHiddenJson","toastr__WEBPACK_IMPORTED_MODULE_0__","Toastr","config_dict","num_rows","input_elt","button_elt","set_text","new_text","cur_text","utils_serverPath__WEBPACK_IMPORTED_MODULE_0__","indexLink","rel","_Backbone$Model","_createClass","baseURL","overview_track_name","hash","save_viz","handle_unsaved_changes","buttonMenu","editable","bookmarks_container","new_bookmark","position_div","annotation_div","delete_icon_container","viewport_config","drawables_config","bookmarks_config","overview_drawable_name","bookmark","add_bookmark","set_up_router","Leave without Saving","TracksterUIView","_Backbone$View","createButtonMenu","view_existing","choose_existing_or_new","view_new","dataset_params","View in saved visualization","view_in_saved","View in new visualization","tracks_grid","Add to visualization","init_editor","template_view_new","create_browser","dbkeys_in_genomes","default_dbkey","add_dataset","init_keyboard_nav","HistoryPrefs","expandedIds","contentId","storageKeyPrefix","historyStorageKey","clearAll","history_preferences","limitPerPageDefault","limitPerProgressiveFetch","sync add","trackJobStates","historyContent","jobSourceType","job_source_type","jobSourceId","job_source_id","HDA_MODEL","validationError","_setUpWebStorage","initialSettings","HISTORY_PREFS","include-deleted","newVal","include-hidden","hid-asc","getByHid","visibleAndUndeleted","isBoolean","since","update_time-ge","fetchHidden","fetchAllDetails","_filterAndUpdate","filterParams","updateWhat","updateArgs","fetched","modelArray","currJson","ajaxFn","AJAX_QUEUE","_recursivelyFetch","detailKeys","defer","limitPerCall","contentsJSON","LibraryDatasetDatasetAssociation","HistoryDatasetCollectionAssociation","matchesWhat","LOGGING_FNS","addTo","logFn","mvc_ui_ui_misc__WEBPACK_IMPORTED_MODULE_3__","scrollable","$title_icon","$operations","new_title","showOperation","setOperation","strKey","hashFnv32a","hue","lightness","_hslToRgb2","hue2rgb","hslToRgb","contrastingColor","select_field","select_val","ref_on_change_vals","last_selected_value","_changeHideOriginals","_changeName","_getName","_nameCheckForEnter","_clickCreate","_clickMoreHelp","_clickLessHelp","_toggleHelp","alertClass","_hideAlert","_cancelCreate","utils_add_logging__WEBPACK_IMPORTED_MODULE_3__","initialAttrs","_checkEnabledSessionStorage","_read","sync","returned","_create","DOMException","_log","searchAttribute","attrKey","_searchArrayAttribute","any","terms","HUAVOptions","$elementShown","showFn","showSpeed","hasBeenShown","isHidden","onshowFirstTime","onshow","onhide","$dragHandle","toggleDraggable","draggableOff","_dragStartHandler","_dragEndHandler","removeEventListener","_renderSelected","toggleSelector","mixinHash1","propsHash","lastArg","jsonNamespace","templateVars","attribute_name","mvc_list_list_view__WEBPACK_IMPORTED_MODULE_2__","mvc_collection_collection_li__WEBPACK_IMPORTED_MODULE_3__","DatasetDCEViewClass","panelStack","parentName","downloadUrl","getNestedDCDCEViewClass","handleWarning","viewLength","elementCount","expanded:drilldown","drilldown","_expandDrilldownPanel","collapsed:drilldown","_collapseDrilldownPanel","click .navigation .back","countDescription","itemsDescription","visualizationsTemplate","mvc_dataset_dataset_li__WEBPACK_IMPORTED_MODULE_5__","components_Tags__WEBPACK_IMPORTED_MODULE_6__","mvc_annotation__WEBPACK_IMPORTED_MODULE_7__","ui_fa_icon_button__WEBPACK_IMPORTED_MODULE_8__","mvc_base_mvc__WEBPACK_IMPORTED_MODULE_9__","utils_localization__WEBPACK_IMPORTED_MODULE_10__","utils_localization__WEBPACK_IMPORTED_MODULE_10___default","DatasetListItemEdit","tagsEditorShown","annotationEditorShown","_renderEditButton","_renderDeleteButton","editBtnData","deletedAlready","_renderTags","_renderAnnotation","_makeDbkeyEditLink","_renderToolHelpButton","datasetID","jobID","creating_job","parseToolBuild","helpString","parseHTML","parseToolID","_renderErrButton","_renderRerunButton","_renderVisualizationsButton","job_id","visualizations","dsid","toggleEditor","annotationEditor","ANNOTATIONS","editableDbkey","edit","click .undelete-link","click .purge-link","click .edit-btn","click .delete-btn","click .rerun-btn","click .report-err-btn","click .visualization-btn","click .dbkey a","_clickUndeleteLink","_clickPurgeLink","click_to_edit_elt","text_elt_id","text_parm_name","on_start","text_elt","old_text","ajax_data","processed_text","cover","z-index","text-align","font-style","DCListItemEdit","DCEListItemEdit","DatasetDCEListItemEdit","DATASET_LI_EDIT","countsTemplate","foundTemplate","collection_li_edit","NestedDCDCEListItemEdit","CollectionViewEdit","DC_EDIT","NestedDCDCEViewClass","newName","previousName","collection_view_edit","hdca_li_edit","HDCAListItemEdit","DC_VIEW_EDIT","click .delete-collection","click .delete-collection-and-datasets","click .delete-collection-and-purge-datasets","HDA_LI_EDIT","HDAListItemEdit","HDCA_LI_EDIT","tagsEditor","dropTargetOff","view:attached view:removed","_renderCounts","search:loading-progress","_renderSearchProgress","search:searching","_renderSearchFindings","updateHistoryDiskSize","_handleItemDeletedChange","change:visible","_handleItemVisibleChange","change:purged","fetching-deleted","fetching-hidden","fetching-deleted-done fetching-hidden-done","counts","toggleHDAAnnotationEditors","historyContents","selectedDatasets","_collectionActions","buildCollection","createFunc","LIST_COLLECTION_CREATOR","PAIR_COLLECTION_CREATOR","LIST_OF_PAIRS_COLLECTION_CREATOR","_handleItemDeletion","_handleItemUndeletion","_handleItemHidden","_handleItemUnhidden","showOrHide","click .toggle-deleted-link","click .toggle-hidden-link","dropHandlers","dragenter","dragleave","$dropTarget","_renderDropTarget","evName","_dropHandlers","dropTargetToggle","utils_utils__WEBPACK_IMPORTED_MODULE_3__","utils_color__WEBPACK_IMPORTED_MODULE_4__","mvc_ui_ui_buttons__WEBPACK_IMPORTED_MODULE_5__","data2","pagesize","_changeDisabled","_renderSearchable","_renderClassic","$select","$dropdown","$resize","$resize_icon","currentY","currentHeight","minHeight","_match","data2index","matched_tags","extraTagWarning","filteredTags","tagColors","exists","sorter","setOnChange","ajaxConfig","isEmptyObject","kb","mb","gb","tb","hval","charCodeAt","cssGetAttribute","classname","__utils__get__","cache_key","iframe","normal_font","numberPlaces","unit","rounded","numPlaces","placesMultiplier","roundToDecimalPlaces","__utils__uid__","new_dict","isJSON","inputText","replacePattern1","replacePattern2","replacePattern3","getQueryString","$nav","_add","_remove","_change","_reset","showTab","hideTab","tab_model","_template_tab","$href","searchableMixin","file_size","meta_files","misc_blurb","misc_info","_generateUrls","report_error","currModel","newState","responseObj","blurb","nameAndId","DatasetAssociationCollection","notReady","startingLength","ajaxFns","chain","onload__WEBPACK_IMPORTED_MODULE_0__","vue__WEBPACK_IMPORTED_MODULE_0__","_store__WEBPACK_IMPORTED_MODULE_1__","ComponentDefinition","gridSearchStore","mutations","setSearchTags","toggleSearchTag","commit","removeSearchTag","_ref3","_ref4","clearSearchTags","_ref5","modelTagCache","tagSet","setTags","userTagList","tagStore","Vuex","Store","mvc_dataset_dataset_li_edit__WEBPACK_IMPORTED_MODULE_2__","mvc_history_hda_li__WEBPACK_IMPORTED_MODULE_3__","click .unhide-link","has_deferred","_renderAndShow","clickEvent","_getShownPosition","_setUpCloseBehavior","li","menuWidth","closePopup","findIndexByHtml","convertedOptions","optionVal","optionKey","newOption","convertLinksToOptions","$parent","linkHref","confirmText","fromExistingDom","$buttonElement","$menuElement","menuElementLinkSelector","menuSelector","buttonSelectorBuildFn","popupMenusCreated","fromDom","MIN_PANEL_WIDTH","MAX_PANEL_WIDTH","SidePanel","saved_size","hiddenByTool","$toggleButton","_templatePanel","_templateHeader","_templateBody","_templateFooter","mousedown .unified-panel-footer > .drag","click .unified-panel-footer > .panel-collapse","_mousedownDragHandler","draggingLeft","initialX","initialWidth","newSize","animation","whichSide","hint","CenterPanel","_iframeChangeHandler","contentWindow","fullpath"],"mappings":"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EA,uEACA,kDACA,8BACA,6BACA,uBACAA,IAAG,oBACH,UACA,iDACA,SACA,mEACA,4CACAA,IAAG,oBACH,OACA,SACA,SACA,SACA,yDACA,8BACA,4DACAA,IAAG,kBACH,OACA,4DACAA,IAAG,iBACH,aACA,uDACAA,IAAG,aACH,OACA,SACA,SACA,kDACA,8BACA,6BACA,uBACAA,IAAG,oBACH,UACA,iDACA,SACA,mEACA,4CACAA,IAAG,oBACH,OACA,SACA,SACA,SACA,UACFvB,KAAK,KAIXiH,OAAQ/P,IAAE+N,SACN,CAEI,iFACA,kDACA,oCACA,SACA,yDACA,oCACA,SACA,kDACA,oCACA,SACA,SACA,mCACA,+CACA1D,IAAG,kBACH,WACA,8BACA,iDACA,8BACA,SACA,yDACAA,IAAG,cACH,OACA,SACA,SACA,+EACA,oCACA,UACFvB,KAAK,KAIXwxB,OAAQt6B,IAAE+N,SACN,CACI,iCACA,sBACA,6CACA1D,IAAG,0BACH,IACA,+DACA,WACA,6CACAA,IAAG,0CACH,IACA,kEACA,WACA,SACA,sBACA,2DACA,gBACAA,IAAG,kCACH,OACA,mDACAA,IAAG,QACH,UACA,SACA,SAEA,gDACA,yCACA,mDACAA,IAAG,UACH,YACA,8CACA,4EACAA,IAAG,yCACH,+BACA,YACA,yCACA,mBACAA,IAAG,+BACH,YACA,mBACAA,IAAG,6CACH,YACA,QACA,SACA,SAEA,yCACA,qDACAA,IAAG,eACH,YACA,SACA,UACFvB,KAAK,KAIXkH,YAAahQ,IAAE+N,SACX,CACI,MACA1D,IACI,CACI,wGACA,2GACA,yGACA,sCACFvB,KAAK,KAEX,OACA,MACAuB,IACI,CACI,8FACA,yDACA,wFACA,iCACA,8BACA,sEACA,yDACA,4CACA,sEACA,yDACA,QACA,6DACA,qEACA,uDACA,4CACA,QACA,6DACA,4DACA,QACA,SACFvB,KAAK,KAEX,OACA,MACAuB,IACI,CACI,gEACA,oDACA,yEACA,sEACA,QACA,8DACA,mEACA,QACA,iEACA,8FACA,uEACA,6CACA,QA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plG,EAAQqlG,WACfyE,EAAc9pG,EAAQqlG,WAG9BnlG,KAAK2jG,cAAgB,IAAIoD,KAAWrnG,KAAK,CACrCwF,IAAK,wBACL9L,KAbO4G,KAaI+jG,aACX59E,UAdOnmB,KAcSe,IAAIsG,KAAK,0BACzB9I,MAAOorG,IAEX3pG,KAAK4jG,iBAAmB,IAAImD,KAAWrnG,KAAK,CACxCwF,IAAK,2BACL9L,KAnBO4G,KAmBI6jG,gBACX19E,UApBOnmB,KAoBSe,IAAIsG,KAAK,6BACzB9I,MAAOqrG,KAIflF,gBAAiB,WACb,OAAOhgG,IAAE+N,SACL,CAEI,wCACA,4BACA,kKACA,uCACA,iBACA,YACA,2KACA,mCACA,mBACA,YACA,2CACA,mKACA,qCACA,eACA,YACA,wLACA,mCACA,6BACA,YACA,UACA,2CACA,uFACA,sKACA,oCACA,oBACA,YACA,OACA,UACA,SAGA,0BACA,qGACA,4DACA,uCACA,mIACA,iBACA,gGACA,UACA,YACA,QAEA,2CACA,QACA,2JACA,SACA,UAGA,8BACA,oDACA,OACA,oHACA,6CACA,QACA,oCACA,OACA,iCACA,iDACA,QACA,UACA,wCACA,OACA,oCACA,qDACA,QACA,UACA,qCACA,OACA,4BACA,kDACA,QACA,UACA,yCACA,OACA,2CACA,sDACA,QACA,UACA,uCACA,OACA,mCACA,oDACA,QACA,UACA,+CACA,OACA,kCACA,wEACA,QACA,UACA,kDACA,OACA,qCACA,2EACA,QACA,UACA,4CACA,OACA,yCACA,qEACA,QACA,UACA,iDACA,OACA,oCACA,0EACA,QACA,UACA,mCACA,OACA,+BACA,4DACA,QACA,UACA,sCACA,OACA,mCACA,+DACA,QACA,UACA,qCACA,OACA,kCACA,8DACA,QACA,UACA,gCACA,OACA,4BACA,yDACA,QACA,UACA,2CACA,OACA,4BACA,yDACA,QACA,UACA,4CACA,OACA,6BACA,0DACA,QACA,UACA,WAEA,sCACA,8BACA,qBACA,0CACA,SACA,UAEA,sCACA,+BACA,qBACA,0CACA,SACA,UAEA,QACA,qBACA,SACA,SAEA,wCACA,QACA,6BACA,OACA,iEACA,wKACA,WACA,OACA,SACA,UAEA,SAEA,UACFjF,KAAK,MAIfs3F,gBAAiB,WACb,OAAOpgG,IAAE+N,SACL,CAEI,wCACA,4BACA,2EACA,6IACA,+CACA,uBACA,YACA,MACA,SAGA,0BACA,qGACA,4DACA,uCACA,mIACA,iBACA,gGACA,UACA,YACA,QAEA,8HAEA,8BACA,oDACA,OACA,2EACA,6CACA,QACA,oCACA,OACA,iCACA,iDACA,QACA,UACA,wCACA,OACA,oCACA,qDACA,QACA,UACA,qCACA,OACA,4BACA,kDACA,QACA,UACA,yCACA,OACA,2CACA,sDACA,QACA,UACA,uCACA,OACA,mCACA,oDACA,QACA,UACA,+CACA,OACA,kCACA,wEACA,QACA,UACA,kDACA,OACA,qCACA,2EACA,QACA,UACA,4CACA,OACA,yCACA,qEACA,QACA,UACA,iDACA,OACA,oCACA,0EACA,QACA,UACA,mCACA,OACA,+BACA,4DACA,QACA,UACA,sCACA,OACA,2CACA,+DACA,QACA,UACA,qCACA,OACA,iDACA,8DACA,QACA,UACA,gCACA,OACA,4BACA,yDACA,QACA,UACA,WACA,QACA,qBACA,SACA,SAEA,SAEA,UACFjF,KAAK,MAIfw3F,sBAAuB,WACnB,OAAOtgG,IAAE+N,SACL,CAEI,wCAGA,0BACA,qGACA,4DACA,uCACA,mIACA,iBACA,gGACA,UACA,YACA,QAEA,8BACA,oDACA,OACA,oHACA,oIACA,QACA,OACA,iCACA,OACA,0EACA,QACA,QACA,OACA,oCACA,OACA,oEACA,QACA,QACA,OACA,4BACA,kDACA,QACA,OACA,2CACA,sDACA,QACA,OACA,mCACA,oDACA,QACA,mBACA,kCACA,wEACA,QACA,qCACA,yDACA,2EACA,iBACA,+BACA,UACA,QACA,OACA,yCACA,qEACA,QACA,OACA,oCACA,0EACA,QACA,OACA,+BACA,yJACA,QACA,OACA,mCACA,+DACA,QACA,OACA,yCACA,8IACA,QAEA,gCACA,OACA,4BACA,yDACA,QACA,UACA,WACA,QACA,qBACA,SACA,SACA,SAEA,uBACA,0KACA,oCACA,eACA,YACA,sKACA,uCACA,aACA,YACA,SAGA,UACFjF,KAAK,MAIf44F,2BAA4B,WACxB,OAAO1hG,IAAE+N,SACL,CAEI,wCACA,4BACA,2EACA,2IACA,qCACA,wBACA,YACA,MACA,SAGA,0BACA,qGACA,4DACA,uCACA,mIACA,iBACA,gGACA,UACA,YACA,QAEA,sDACA,oCACA,wBACA,yKACA,iBACA,+IACA,UACA,SACA,8BACA,uCACA,kDACA,mEACA,8KACA,QACA,uCACA,+LACA,4CACA,yHACA,iBACA,oGACA,UACA,6CACA,mEACA,iDACA,qFACA,mGACA,mGACA,SACA,4DACA,mEACA,iDACA,sLACA,SACA,oKACA,uCACA,aACA,YACA,SAEA,UACFjF,KAAK,MAIfk4F,0BAA2B,WACvB,OAAOhhG,IAAE+N,SACL,CACI,QACA,mCACA,mBACA,qHACA,8CACA,mGACA,YACA,YACA,SACA,mCACA,kBACA,4GACA,WACA,SACA,UACFjF,KAAK,SCxsBJq8F,GAAA,CACXC,cAlZgBnqG,IAASD,KAAKE,OAAO,CACrCiJ,OAAQ,CACJkhG,8BAA+B,kBAC/BC,6BAA8B,iBAC9BC,yBAA0B,qBAC1BC,2BAA4B,sBAC5BC,yBAA0B,qBAG9Bt5F,SAAU,CACN7T,KAAM,KACNotG,kBAAmB,CACfC,iBAAiB,EACjBC,iBAAiB,EACjBC,mBAAmB,EACnBC,uBAAuB,GAE3BxH,WAAW,GAGfnjG,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAEmM,SAAS/Q,GAAW,GAAIE,KAAK6Q,UAC9C7Q,KAAKkC,OAAOlC,KAAKF,UAGrBoC,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtC,IAAIuiG,EAAcriG,KAAKF,QAAQG,MAC3BwS,EAAW,KACXnD,EAASC,cAiCb,MA/BgC,WAA5B8yF,EAAYlkG,IAAI,SAA2D,kBAAnCkkG,EAAYlkG,IAAI,gBACxD6B,KAAKF,QAA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CA,mBACA,gDACA,QACA,kEACA,yBACA,OACA,gFACA,QACA,OACA,yCACA,QACA,8BACA,oIACA,yJACA,UACA,kBACA,YACA,OACA,mDACA,QACA,YACA,OACA,wBACA,4NACA,sCACA,YACA,mOACA,qCACA,YACA,+BACA,0PACA,oCACA,YACA,0DACA,gQACA,qCACA,YACA,OACA,UACA,QACA,SACFjF,KAAK,MAIfq9F,gBAAiB,WACb,OAAOnmG,IAAE+N,SACL,CACI,8EACA,mBACA,+CACA,QACA,mBACA,6CACA,QACA,OACA,mHACA,kCACA,MACA,QACA,8CACA,yDACA,0DACA,4DACA,OACA,oDACA,6CACA,UACA,QACA,OACA,mDACA,0HACA,UACA,8CACA,mHACA,UACA,6GACA,yHACA,UACA,8CACA,uGACA,uKACA,qCACA,YACA,OACA,UACA,QACA,SACFjF,KAAK,MAIfo9F,uBAAwB,WACpB,OAAOlmG,IAAE+N,SACL,CACI,mFACA,mBACA,+CACA,QACA,YACA,2BACA,kCACA,QACA,OACA,qCACA,QACA,OACA,gDACA,QACA,OACA,iDACA,QACA,OACA,mDACA,QACA,OACA,oDACA,6CACA,UACA,QACA,OACA,kHACA,qMACA,wCACA,YACA,QACA,SACFjF,KAAK,MAIfk9F,yBAA0B,WACtB,OAAOhmG,IAAE+N,SACL,CACI,wFACA,mBACA,gDACA,QACA,YACA,2BACA,kCACA,QACA,OACA,yCACA,QACA,OACA,SACA,QACA,YACA,OACA,mDACA,QACA,YACA,OACA,kHACA,oMACA,wCACA,YACA,QACA,SACFjF,KAAK,SCcJw+F,GAAA,CACXC,eA5ZiBtsG,IAASD,KAAKE,OAAO,CACtC+c,GAAI,wBAEJuvF,SAAU,EAEVC,aAAc,EAEdC,gBAAiB,KAEjBC,mBAAoB,MAEpBC,iBAAkB,OAElBzjG,OAAQ,CACJ0jG,+BAAgC,YAChCC,qBAAsB,mBACtBC,oBAAqB,mBACrBC,0BAA2B,oBAC3BC,8BAA+B,oBAC/BC,iCAAkC,oBAClCC,2BAA4B,qBAGhC9zF,WAAY,KAEZlI,SAA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DACA,OACA,uBACA,6CACA,QACA,UACA,OACA,cACA,6BACA,QACA,WACA,WACA,UACFjF,KAAK,MAIf4nG,yBAA0B,WACtB,OAAO1wG,IAAE+N,SACL,CACI,8BACA,SACA,wEACA,4EACA,UACA,UACFjF,KAAK,MAIfuoG,+BAAgC,WAC5B,OAAOrxG,IAAE+N,SACL,CACI,QACA,mCACA,mBACA,sFACA,8CACA,mGACA,YACA,YACA,SACA,mCACA,kBACA,8GACA,SACA,UACFjF,KAAK,MAIfwrG,qCAAsC,WAClC,OAAOt0G,IAAE+N,SACL,CACI,4BACA,2EACA,SACA,yBACA,gJACA,mDACA,SACA,UACFjF,KAAK,MAIfqrG,kCAAmC,WAC/B,OAAOn0G,IAAE+N,SACL,CACI,4BACA,iFACA,SACA,yBACA,gJACA,mDACA,SACA,UACFjF,KAAK,MAIfurG,iCAAkC,WAC9B,OAAOr0G,IAAE+N,SACL,CACI,4BACA,SACA,yBACA,gJACA,mDACA,SACA,UACFjF,KAAK,MAIfoqG,qBAAsB,WAClB,OAAOlzG,IAAE+N,SACL,CACI,gCACA,mCACA,oFACA,yGACA,WACA,sFACA,uFACA,WACA,SACA,0JACA,wLACA,mCACA,kFACA,yFACA,+BACA,WACA,kCACA,mEACA,gCACA,WACA,kCACA,0FACA,gCACA,WACA,kCACA,yEACA,yBACA,WACA,SACA,qGACA,aACA,YACA,qGACA,eACA,YACA,SAEA,4BACA,SACA,SACA,kFACA,QACA,gFACA,4EACA,SACA,OACA,QACA,4CACA,mCACA,wEACA,WACA,SACA,UACFjF,KAAK,MAIf+pG,wBAAyB,WACrB,OAAO7yG,IAAE+N,SACL,CACI,gCACA,+JACA,sCACA,kCACA,yFACA,+BACA,WACA,kCACA,mEACA,gCACA,WACA,OACA,kCACA,0FACA,gCACA,WACA,kCACA,yEACA,yBACA,WACA,SACA,uKACA,SACA,kFACA,QACA,gFACA,4EACA,SACA,QACA,4CACA,mCACA,wEACA,WACA,SACA,UACFjF,KAAK,MAIfypG,4BAA6B,WACzB,OAAOvyG,IAAE+N,SACL,CACI,6BACA,QACA,gCACA,8EACA,8CACA,mGACA,YACA,YACA,SACA,QACA,iDACA,SACA,UACFjF,KAAK,MAIfksG,wBAAyB,WACrB,OAAOh1G,IAAE+N,SACL,CACI,gDACA,QACA,6GACA,aACA,YACA,+GACA,eACA,YACA,SACA,OACA,OACA,0DACA,oDACA,iDACA,yDACA,kEACA,0CACA,+GACA,UACA,6CACA,wFACA,0HACA,WACA,QACA,iBACA,6FACA,2GACA,6CACA,kLACA,UACA,QACA,UACA,iGACA,+GACA,6CACA,wFACA,qGACA,WACA,QACA,UACA,UACA,YACA,SACFjF,KAAK,MAIfslG,kBAAmB,WACf,OAAOpuG,IAAE+N,SACL,CACI,+BACA,uCACA,gDACA,qIACA,oJACA,iBACA,qIACA,+IACA,UACA,iBACA,8IACA,oJACA,UACA,gCACA,4GACA,QACA,4CACA,+IACA,8JACA,iBACA,qJACA,uKACA,UACA,QACA,sBACA,iLACA,UACA,sBACA,kCACA,WACFjF,KAAK,MAIfyuG,8BAA+B,WAC3B,OAAOv3G,IAAE+N,SACL,CACI,QAEA,mCACA,2BACA,6BACA,+BACA,+KACA,iCACA,8BACA,UACA,WACA,+BACA,8JACA,WACA,UACA,SAEA,mCACA,2BACA,iDACA,iCACA,OACA,OACA,0GACA,QACA,OACA,yGACA,QACA,OACA,wIACA,QACA,OACA,iKACA,QACA,QACA,SAEA,mCACA,0BACA,oDACA,mBACA,2FACA,SACA,UACFjF,KAAK,UClkDJowG,GAAA,CACXC,YApScl+G,IAASD,KAAKE,OAAO,CACnC+c,GAAI,UAEJ1c,MAAO,KAEPH,QAAS,GAET+I,OAAQ,CACJ26F,kCAAmC,mBAGvC3jG,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GAClCE,KAAKF,QAAQK,IACbH,KAAK89G,gBAIbA,aAAc,SAASh+G,GACnBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKC,MAAQ,IAAIikG,GAAkB5C,QAAQ,CACvCnhG,GAAIH,KAAKF,QAAQK,KAErB,IAAIirG,EAAOprG,KACXA,KAAKC,MAAM+M,MAAM,CACbo0B,QAAS,WACDgqE,EAAKtrG,QAAQqkG,kBACbiH,EAAKhH,mBAGbjnG,MAAO,SAAS8C,EAAOiJ,GACnB,IAAIoG,EAASC,mBACwB,IAA1BrG,EAAS2rB,aAChB+vC,IAAMznE,MAAN,GAAAuI,OAAewD,EAAS2rB,aAAawuD,QAArC,2BAAuE,GAAI,CACvEj/E,QAAS,WACLkL,EAAOi1F,UAAUC,eAAeC,UAIxC7/B,IAAMznE,MAAM,4CAA6C,GAAI,CACzDiH,QAAS,WACLkL,EAAOi1F,UAAUC,eAAeC,cAQxDL,gBAAiB,SAAStkG,GACtBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCoB,IAAE,YAAY6M,cAE2BzQ,IAArC0C,KAAKF,QAAQumG,sBAC4D,IAArErmG,KAAKF,QAAQumG,oBAAoB0X,yBAAyBnkH,OAC1DoG,KAAKC,MAAMW,IAAI,CAAE2lG,iBAAiB,IAElCvmG,KAAKC,MAAMW,IAAI,CAAE2lG,iBAAiB,KAG1C,IAAIC,GAAW,EACXl3F,EAASC,cACTD,EAAOg0B,OACPkjE,EAAWl3F,EAAOg0B,KAAKovE,WAE3B,IAAIjgG,EAAWzS,KAAKg+G,6BACpBh+G,KAAKe,IAAIgF,KAAK0M,EAAS,CAAE49F,QAASrwG,KAAKC,MAAOumG,SAAUA,KAExD,IAAIzmG,EAAOC,KACXkB,IAAE/C,IAAF,GAAAuH,OAAS8F,uBAAT,kBAAA9F,OAAsC3F,EAAKI,GAA3C,+BACK6N,KAAK,SAAAq4F,GACFtmG,EAAK2mG,mBAAmB,CACpBL,oBAAqBA,MAG5B99E,KAAK,WACFq8C,IAAMznE,MAAM,sEAGpB+D,IAAE,mCAAmC4D,QAAQ,CAAEjC,QAAS,UAExD3B,IAAE,WAAWgE,IAAI,WAAY,SAGjCyhG,gBAAiB,SAASC,GAEtB,IADA,IAAIC,EAAiB,GACZntG,EAAI,EAAGA,EAAIktG,EAAUhtG,OAAQF,IAClCmtG,EAAe/sG,KAAf,GAAA4L,OAAuBkhG,EAAUltG,GAAG,GAApC,KAAAgM,OAA0CkhG,EAAUltG,GAAG,KAE3D,OAAOmtG,GAGXH,mBAAoB,SAAS5mG,GACzBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtC,IAAIumG,EAAsBrmG,KAAKF,QAAQumG,oBAGnC4X,EAAgCj+G,KAAK2mG,gBAAgBN,EAAoB0X,0BACzEG,EAA0Bl+G,KAAK2mG,gBAAgBN,EAAoB8X,4BACnEC,EAAgCp+G,KAAK2mG,gBAAgBN,EAAoBgY,0BACzEC,EAAgCt+G,KAAK2mG,gBAAgBN,EAAoBkY,0BALlEv+G,KAON8mG,mBAAqB,IAAIC,KAAWrnG,KACrCM,KAAKw+G,qBAAqBx+G,KAAM,cAAei+G,GAA+B,IARvEj+G,KAUNy+G,gBAAkB,IAAI1X,KAAWrnG,KAClCM,KAAKw+G,qBAAqBx+G,KAAM,WAAYk+G,GAAyB,IAX9Dl+G,KAaNmnG,mBAAqB,IAAIJ,KAAWrnG,KACrCM,KAAKw+G,qBAAqBx+G,KAAM,cAAeo+G,GAA+B,IAdvEp+G,KAgBNinG,mBAAqB,IAAIF,KAAWrnG,KACrCM,KAAKw+G,qBAAqBx+G,KAAM,cAAes+G,GAA+B,KAItFE,qBAAsB,SAASz+G,EAAMI,EAAIm0C,EAAWoqE,GAsDhD,OArDAA,GAA0C,IAAtBA,GAA6BA,EAC5B,CACjBrzD,mBAAoB,EACpBnmD,IAAK/E,EACLmD,UAAU,EACVgF,YAAa,yBACb6d,UAAWpmB,EAAKgB,IAAIsG,KAAT,IAAA3B,OAAkBvF,IAC7Bo0B,KAAM,CACFhpB,IAAG,GAAA7F,OAAK8F,uBAAL,kBAAA9F,OACC3F,EAAKI,GADN,mDAAAuF,OAE+Cg5G,GAClDjqF,SAAU,OACV8yE,YAAa,IACbnuG,KAAM,SAASouG,EAAMviE,GAEjB,MAAO,CACHxuB,EAAG+wF,EACHC,WAAY,GACZxiE,KAAMA,IAGdyiE,QAAS,SAAStuG,EAAM6rC,GACpB,IAAI0iE,EAAc,GAAP1iE,EAAY7rC,EAAKwuG,MAE5B,MAAO,CAAEF,QAAStuG,EAAKyuG,MAAOF,KAAMA,KAG5C57C,aAAc,SAA0Bu7C,GACpC,SAAA5hG,OAAU4hG,EAAKxpG,KAAf,WAAA4H,OAA6B4hG,EAAKtqG,OAGtCgvD,gBAAiB,SAA6Bs7C,GAC1C,OAAOA,EAAKxpG,MAEhBmuD,cAAe,SAASnlD,EAASwM,GAI7B,IAAIla,EAAO,GACX8H,IAAE4F,EAAQxF,MAAMZ,MAAM,MAAMiE,KAAK,WAC7B,IAAIyoD,EAAOptD,KAAKU,MAAM,KACtBtH,EAAKU,KAAK,CACNqG,GAAIitD,EAAK,GACTtvD,KAAMsvD,EAAK,OAGnB95C,EAASla,IAGbmyD,YAAajX,EACbuX,iBAAkB,YAM1Bg9C,mBAAoB,WAChB,IAAI9oG,EAAOC,KACXkB,IAAEkkD,KAAF,GAAA1/C,OAAU8F,uBAAV,2BAAA9F,OAAgD3F,EAAKI,GAArD,qCACK6N,KAAK,SAAAq4F,GACFtmG,EAAKE,MAAMW,IAAI,CAAE2lG,iBAAiB,IAClCxmG,EAAKqkG,gBAAgB,CACjBiC,oBAAqBA,IAEzBzhC,IAAMxjC,QAAQ,wCAEjB7Y,KAAK,WACFq8C,IAAMznE,MAAM,kEAIxB2rG,0BAA2B,WACvB,IAAI/oG,EAAOC,KACXkB,IAAEkkD,KAAF,GAAA1/C,OAAU8F,uBAAV,2BAAA9F,OAAgD3F,EAAKI,GAArD,4CACK6N,KAAK,SAAAq4F,GACFtmG,EAAKE,MAAMW,IAAI,CAAE2lG,iBAAiB,IAClCxmG,EAAKqkG,gBAAgB,CACjBiC,oBAAqBA,IAEzBzhC,IAAMxjC,QAAQ,iDAEjB7Y,KAAK,WACFq8C,IAAMznE,MAAM,uEAIxB4rG,YAAa,SAASC,GAElB,IADA,IAAIC,EAAW,GACNvvG,EAAIsvG,EAAWpvG,OAAS,EAAGF,GAAK,EAAGA,IACxCuvG,EAASnvG,KAAKkvG,EAAWtvG,GAAGyG,IAEhC,OAAO8oG,GAEXC,gBAAiB,SAASxsG,GACtB,IAAIqD,EAAOC,KAEPmpG,EAAanpG,KAAK+oG,YAAY/oG,KAAK8mG,mBAAmB/lG,IAAI0qD,QAAQ,SAClEkzD,EAAU3+G,KAAK+oG,YAAY/oG,KAAKy+G,gBAAgB19G,IAAI0qD,QAAQ,SAC5D29C,EAAappG,KAAK+oG,YAAY/oG,KAAKmnG,mBAAmBpmG,IAAI0qD,QAAQ,SAClE49C,EAAarpG,KAAK+oG,YAAY/oG,KAAKinG,mBAAmBlmG,IAAI0qD,QAAQ,SAEtEvqD,IAAEkkD,KAAF,GAAA1/C,OAAU8F,uBAAV,kBAAA9F,OAAuC3F,EAAKI,GAA5C,uCAAqF,CACjFmpG,eAAgBH,EAChByV,YAAaD,EACbpV,eAAgBH,EAChBI,eAAgBH,IAEfr7F,KAAK,SAAAq4F,GAEFtmG,EAAKqkG,gBAAgB,CACjBiC,oBAAqBA,IAEzBzhC,IAAMxjC,QAAQ,wBAEjB7Y,KAAK,WACFq8C,IAAMznE,MAAM,qEAIxB6gH,2BAA4B,WACxB,OAAOt5G,IAAE+N,SACL,CACI,wCACA,QACA,eACA,sJACA,6BACA,kBACA,YACA,OACA,SACA,OACA,gDACA,QACA,oCACA,wBACA,yKACA,iBACA,+IACA,SACA,SACA,8BACA,+BACA,6CACA,8DACA,iDACA,yKACA,SACA,6DACA,8DACA,iDACA,iHACA,SACA,oDACA,wDACA,iDACA,sGACA,SACA,8CACA,8DACA,iDACA,gGACA,SACA,mLACA,iCACA,aACA,YACA,SACA,UACFjF,KAAK,SCrCJqxG,GAAA,CACXC,WA1Pan/G,IAASD,KAAKE,OAAO,CAClC+c,GAAI,UAEJ1c,MAAO,KAEPH,QAAS,GAET+I,OAAQ,CACJ26F,kCAAmC,mBAGvC3jG,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GAClCE,KAAKF,QAAQK,IACbH,KAAKqtG,eAIbA,YAAa,SAASvtG,GAClB,IAAIwP,EAASC,cACbvP,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKC,MAAQ,IAAIikG,GAAkBnC,cAAc,CAC7C5hG,GAAIH,KAAKF,QAAQK,KAErB,IAAIirG,EAAOprG,KACXA,KAAKC,MAAM+M,MAAM,CACbo0B,QAAS,WACDgqE,EAAKtrG,QAAQqkG,kBACbiH,EAAKhH,mBAGbjnG,MAAO,SAAS8C,EAAOiJ,QACkB,IAA1BA,EAAS2rB,aAChB+vC,IAAMznE,MAAN,GAAAuI,OAAewD,EAAS2rB,aAAawuD,QAArC,2BAAuE,GAAI,CACvEj/E,QAAS,WACLkL,EAAOi1F,UAAUC,eAAeC,UAIxC7/B,IAAMznE,MAAM,4CAA6C,GAAI,CACzDiH,QAAS,WACLkL,EAAOi1F,UAAUC,eAAeC,cAQxDL,gBAAiB,SAAStkG,GACtB,IAAIwP,EAASC,cACbvP,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCoB,IAAE,YAAY6M,SAEd,IAAIy4F,GAAW,EACXl3F,EAAOg0B,OACPkjE,EAAWl3F,EAAOg0B,KAAKovE,WAE3B,IAAIjgG,EAAWzS,KAAK++G,4BACpB/+G,KAAKe,IAAIgF,KAAK0M,EAAS,CAAE0vF,OAAQniG,KAAKC,MAAOumG,SAAUA,KAEvD,IAAIzmG,EAAOC,KACXkB,IAAE/C,IAAF,GAAAuH,OAAS8F,uBAAT,gBAAA9F,OAAoC3F,EAAKI,GAAzC,+BACK6N,KAAK,SAAAq4F,GACFtmG,EAAK2mG,mBAAmB,CACpBL,oBAAqBA,MAG5B99E,KAAK,WACFq8C,IAAMznE,MAAM,qEAGpB+D,IAAE,mCAAmC4D,QAAQ,CAAEjC,QAAS,UAExD3B,IAAE,WAAWgE,IAAI,WAAY,SAGjCyhG,gBAAiB,SAASC,GAEtB,IADA,IAAIC,EAAiB,GACZntG,EAAI,EAAGA,EAAIktG,EAAUhtG,OAAQF,IAClCmtG,EAAe/sG,KAAf,GAAA4L,OAAuBkhG,EAAUltG,GAAG,GAApC,KAAAgM,OAA0CkhG,EAAUltG,GAAG,KAE3D,OAAOmtG,GAGXH,mBAAoB,SAAS5mG,GACzBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtC,IAAIumG,EAAsBrmG,KAAKF,QAAQumG,oBAGnC6X,EAA0Bl+G,KAAK2mG,gBAAgBN,EAAoB8X,4BACnEa,EAA+Bh/G,KAAK2mG,gBAAgBN,EAAoB4Y,yBACxEC,EAA+Bl/G,KAAK2mG,gBAAgBN,EAAoB8Y,yBAJjEn/G,KAMNy+G,gBAAkB,IAAI1X,KAAWrnG,KAClCM,KAAKw+G,qBAAqBx+G,KAAM,WAAYk+G,GAAyB,IAP9Dl+G,KASNmnG,mBAAqB,IAAIJ,KAAWrnG,KACrCM,KAAKw+G,qBAAqBx+G,KAAM,cAAeg/G,GAA8B,IAVtEh/G,KAYNinG,mBAAqB,IAAIF,KAAWrnG,KACrCM,KAAKw+G,qBAAqBx+G,KAAM,cAAek/G,GAA8B,KAIrFV,qBAAsB,SAASz+G,EAAMI,EAAIm0C,GAkDrC,MAjDqB,CACjB+W,mBAAoB,EACpBnmD,IAAK/E,EACLmD,UAAU,EACVgF,YAAa,yBACb6d,UAAWpmB,EAAKgB,IAAIsG,KAAT,IAAA3B,OAAkBvF,IAC7Bo0B,KAAM,CACFhpB,IAAG,GAAA7F,OAAK8F,uBAAL,gBAAA9F,OAAgC3F,EAAKI,GAArC,gCACHs0B,SAAU,OACV8yE,YAAa,IACbnuG,KAAM,SAASouG,EAAMviE,GAEjB,MAAO,CACHxuB,EAAG+wF,EACHC,WAAY,GACZxiE,KAAMA,IAGdyiE,QAAS,SAAStuG,EAAM6rC,GACpB,IAAI0iE,EAAc,GAAP1iE,EAAY7rC,EAAKwuG,MAE5B,MAAO,CAAEF,QAAStuG,EAAKyuG,MAAOF,KAAMA,KAG5C57C,aAAc,SAA0Bu7C,GACpC,SAAA5hG,OAAU4hG,EAAKxpG,KAAf,WAAA4H,OAA6B4hG,EAAKtqG,OAGtCgvD,gBAAiB,SAA6Bs7C,GAC1C,OAAOA,EAAKxpG,MAEhBmuD,cAAe,SAASnlD,EAASwM,GAI7B,IAAIla,EAAO,GACX8H,IAAE4F,EAAQxF,MAAMZ,MAAM,MAAMiE,KAAK,WAC7B,IAAIyoD,EAAOptD,KAAKU,MAAM,KACtBtH,EAAKU,KAAK,CACNqG,GAAIitD,EAAK,GACTtvD,KAAMsvD,EAAK,OAGnB95C,EAASla,IAEbmyD,YAAajX,EAAU9mC,KAAK,KAC5Bq+C,iBAAkB,YAS1Bk9C,YAAa,SAASC,GAElB,IADA,IAAIC,EAAW,GACNvvG,EAAIsvG,EAAWpvG,OAAS,EAAGF,GAAK,EAAGA,IACxCuvG,EAASnvG,KAAKkvG,EAAWtvG,GAAGyG,IAEhC,OAAO8oG,GAMXC,gBAAiB,SAASxsG,GACtB,IAAIqD,EAAOC,KACP2+G,EAAU3+G,KAAK+oG,YAAY/oG,KAAKy+G,gBAAgB19G,IAAI0qD,QAAQ,SAC5D29C,EAAappG,KAAK+oG,YAAY/oG,KAAKmnG,mBAAmBpmG,IAAI0qD,QAAQ,SAClE49C,EAAarpG,KAAK+oG,YAAY/oG,KAAKinG,mBAAmBlmG,IAAI0qD,QAAQ,SACtEvqD,IAAEkkD,KAAF,GAAA1/C,OAAU8F,uBAAV,gBAAA9F,OAAqC3F,EAAKI,GAA1C,uCAAmF,CAC/Ey+G,YAAaD,EACbpV,eAAgBH,EAChBI,eAAgBH,IAEfr7F,KAAK,SAAAq4F,GACFtmG,EAAKqkG,gBAAgB,CACjBiC,oBAAqBA,IAEzBzhC,IAAMxjC,QAAQ,wBAEjB7Y,KAAK,WACFq8C,IAAMznE,MAAM,oEAIxB4hH,0BAA2B,WACvB,OAAOr6G,IAAE+N,SACL,CACI,wCACA,QACA,sDACA,kJACA,yCACA,sBACA,YACA,OACA,SACA,OACA,8CACA,QACA,oCACA,wBACA,wKACA,iBACA,+IACA,SACA,SACA,8BACA,8BACA,OACA,mDACA,QACA,8DACA,iDACA,uFACA,SACA,OACA,0CACA,QACA,wDACA,iDACA,qGACA,SACA,OACA,oCACA,QACA,8DACA,iDACA,qFACA,SACA,iKACA,iCACA,aACA,YACA,SACA,UACFjF,KAAK,SCpOf4xG,GAAgBz/G,IAAS08C,OAAOz8C,OAAO,CACvCC,WAAY,WACRG,KAAKq/G,UAAY,EAEjB1/G,IAASgpG,QAAQtnG,GACb,QACA,WACIrB,KAAKq/G,aAETr/G,MAGJA,KAAKlB,KAAK,QAASkB,KAAKs/G,gBAG5BC,OAAQ,CACJC,GAAI,YACJC,kBAAmB,iBACnBC,kCAAmC,sBACnCC,iCAAkC,qBAClCC,cAAe,iBACfC,8BAA+B,cAC/BC,0CAA2C,iBAC3CC,sDAAuD,sBACvDC,4DAA6D,kBAC7DC,sCAAuC,WACvCC,oCAAqC,mBASzCzb,KAAM,WACEzkG,KAAKq/G,UAAY,EACjB//G,OAAOqpG,QAAQlE,OAEfzkG,KAAKu8C,SAAS,IAAK,CAAE15C,SAAS,EAAMmmB,SAAS,KAOrDs2F,cAAe,WACX,IAAI/zG,EAAM5L,IAASgpG,QAAQwX,cAEtB,MAAMpuF,KAAKxmB,IAAe,IAAPA,IACpBA,EAAG,IAAA7F,OAAO6F,IAEI,oBAAP60G,IACPA,GAAG,OAAQ,WAAT,GAAA16G,OAAwB8F,uBAAxB,gBAAA9F,OAAmD6F,OAO7D80G,GAAeC,KAAYC,oBAAoB3gH,OAAO,CACtDiR,SAAU,CACN8iG,cAAc,EACdE,oBAAoB,EACpB5S,WAAY,MACZuf,QAAS,OACTzN,kBAAmB,GACnBmC,iBAAkB,MAuKXuL,GAAA,CACXjuB,UA/JgB7yF,IAASD,KAAKE,OAAO,CACrC6xG,mBAAoB,KACpBnB,gBAAiB,KACjB9L,eAAgB,KAChBkc,YAAa,KACbvS,kBAAmB,KACnB9C,eAAgB,KAChBJ,YAAa,KAEbprG,WAAY,WAER,IAEMnG,EAAGsB,EAAGgD,EAAMI,EAAG4tB,EAAGruB,EAFpB2R,EAASC,cACTD,EAAO2zB,OAAO09E,UACZjnH,EAYC4F,OAZEtE,EAYMe,SAZHiC,EAYa,SAZPI,EAY4D,KAXtE1E,EAAC,sBAA4B0E,EAC5B1E,EAAC,GACEA,EAAC,IACD,YACKA,EAAC,GAAI+c,EAAI/c,EAAC,GAAI+c,GAAK,IAAI3c,KAAK+lB,YAEhCnmB,EAAC,GAAI2B,EAAI,EAAI,IAAI2xB,KACrBhB,EAAIhxB,EAAEgB,cAAcgC,GAAML,EAAI3C,EAAE4lH,qBAAqB5iH,GAAG,GACzDguB,EAAE+9B,MAAQ,EACV/9B,EAAE3vB,IAEyB,0CAD3BsB,EAAE4/C,WAAWhf,aAAavS,EAAGruB,GAEjCyiH,GAAG,SAAU9wG,EAAO2zB,OAAO09E,QAAS,QACpCP,GAAG,OAAQ,aAGf9wG,EAAOi1F,UAAYvkG,KAEnBA,KAAK+tG,YAAc,IAAIsS,GAAa,CAAElgH,GAAI,qBAE1CH,KAAKwkG,eAAiB,IAAI4a,GAE1Bp/G,KAAKwkG,eAAenjG,GAAG,kBAAmB,WAClCiO,EAAOi1F,UAAUkN,oBACjBniG,EAAOi1F,UAAUkN,mBAAmB1wG,IAAIo7B,OAAO,SAEnD7sB,EAAOi1F,UAAUkN,mBAAqB,IAAIoP,GAAwB5O,mBAClE3iG,EAAOi1F,UAAU+L,gBAAkB,IAAIwQ,GAAqB9P,kBAGhEhxG,KAAKwkG,eAAenjG,GAAG,uBAAwB,SAAA2rG,GACC,OAAxC19F,EAAOi1F,UAAUkN,oBACjBniG,EAAOi1F,UAAUkN,mBAAqB,IAAIoP,GAAwB5O,mBAClE3iG,EAAOi1F,UAAU+L,gBAAkB,IAAIwQ,GAAqB9P,gBAAgB,CAAEhE,UAAWA,KAEzF19F,EAAOi1F,UAAU+L,gBAAgBpuG,OAAO,CACpC8qG,UAAWA,MAKvBhtG,KAAKwkG,eAAenjG,GAAG,uBAAwB,SAAAlB,GACvCmP,EAAOi1F,UAAU4J,mBACjB7+F,EAAOi1F,UAAU4J,kBAAkBptG,IAAIo7B,OAAO,SAElD7sB,EAAOi1F,UAAU4J,kBAAoB,IAAI4S,GAAuBhN,kBAAkB,CAAE5zG,GAAIA,IACxFmP,EAAOi1F,UAAU8G,eAAiB,IAAI2V,GAAoB/U,eAAe,CAAE9rG,GAAIA,MAGnFH,KAAKwkG,eAAenjG,GAAG,oBAAqB,SAAClB,EAAI6sG,GACF,OAAvC19F,EAAOi1F,UAAU4J,mBACjB7+F,EAAOi1F,UAAU4J,kBAAoB,IAAI4S,GAAuBhN,kBAAkB,CAAE5zG,GAAIA,IACxFmP,EAAOi1F,UAAU8G,eAAiB,IAAI2V,GAAoB/U,eAAe,CACrE9rG,GAAIA,EACJ6sG,UAAWA,KAGf19F,EAAOi1F,UAAU8G,eAAenpG,OAAO,CACnC/B,GAAIA,EACJ6sG,UAAWjqG,SAASiqG,OAKhChtG,KAAKwkG,eAAenjG,GAAG,iBAAkB,SAACkqG,EAAWj3C,GACM,IAAnDpzD,IAAE,qBAAqBmG,KAAK,YAAYzN,QACxCgrE,IAAMrgD,KAAK,oDACXjV,EAAOi1F,UAAUC,eAAejoD,SAAhC,WAAA72C,OAAoD6lG,GAAa,CAAE1oG,SAAS,EAAMmmB,SAAS,MAE3F1Z,EAAOi1F,UAAU4J,kBAAkB2I,SAASxiD,GAC5ChlD,EAAOi1F,UAAUC,eAAejoD,SAAhC,WAAA72C,OAAoD6lG,GAAa,CAAE1oG,SAAS,EAAOmmB,SAAS,OAIpGhpB,KAAKwkG,eAAenjG,GAAG,uBAAwB,SAACkqG,EAAW1+D,GACnDv9B,EAAOi1F,UAAU0G,aACjB37F,EAAOi1F,UAAU0G,YAAYlqG,IAAIo7B,OAAO,SAE5C7sB,EAAOi1F,UAAU0G,YAAc,IAAIC,GAAyBnI,mBAAmB,CAC3E5iG,GAAI0sC,EACJw3D,cAAc,EACdF,kBAAkB,MAI1BnkG,KAAKwkG,eAAenjG,GAAG,wBAAyB,SAACkqG,EAAW1+D,EAAY83D,GAChEr1F,EAAOi1F,UAAU0G,aACjB37F,EAAOi1F,UAAU0G,YAAYlqG,IAAIo7B,OAAO,SAE5C7sB,EAAOi1F,UAAU0G,YAAc,IAAIC,GAAyBnI,mBAAmB,CAC3E5iG,GAAI0sC,EACJ83D,QAASA,EACTN,cAAc,MAItBrkG,KAAKwkG,eAAenjG,GAAG,4BAA6B,SAACkqG,EAAW1+D,GACxDv9B,EAAOi1F,UAAU0G,aACjB37F,EAAOi1F,UAAU0G,YAAYlqG,IAAIo7B,OAAO,SAE5C7sB,EAAOi1F,UAAU0G,YAAc,IAAIC,GAAyBnI,mBAAmB,CAC3E5iG,GAAI0sC,EACJs3D,kBAAkB,MAI1BnkG,KAAKwkG,eAAenjG,GAAG,4BAA6B,SAAA4/G,GAC5C3xG,EAAOi1F,UAAUmc,aACjBpxG,EAAOi1F,UAAUmc,YAAY3/G,IAAIo7B,OAAO,SAE5C7sB,EAAOi1F,UAAUmc,YAAc,IAAIQ,GAAyBrD,YAAY,CACpE19G,GAAI8gH,EACJ9c,kBAAkB,MAI1BnkG,KAAKwkG,eAAenjG,GAAG,2BAA4B,SAAAkqG,GAC3Cj8F,EAAOi1F,UAAU4c,YACjB7xG,EAAOi1F,UAAU4c,WAAWpgH,IAAIo7B,OAAO,SAE3C7sB,EAAOi1F,UAAU4c,WAAa,IAAIC,GAAwBtC,WAAW,CACjE3+G,GAAIorG,EACJpH,kBAAkB,MAI1BnkG,KAAKwkG,eAAenjG,GAAG,wBAAyB,SAACkqG,EAAWtiG,GACpDqG,EAAOi1F,UAAU4J,mBAAqB7+F,EAAOi1F,UAAU8G,eACvD/7F,EAAOi1F,UAAU4J,kBAAkB2N,gBAAgB,CAC/C7yG,OAAQA,KAGZqG,EAAOi1F,UAAU4J,kBAAoB,IAAI4S,GAAuBhN,kBAAkB,CAAE5zG,GAAIorG,IACxFj8F,EAAOi1F,UAAU8G,eAAiB,IAAI2V,GAAoB/U,eAAe,CAAE9rG,GAAIorG,IAC/Ej8F,EAAOi1F,UAAU4J,kBAAkB2N,gBAAgB,CAC/C7yG,OAAQA,OAKpBtJ,IAASgpG,QAAQtwD,MAAM,CAAEgpE,WAAW,QC3PxCC,GAAgB3hH,IAASO,MAAMN,OAAO,CACtCiR,SAAU,CACNtF,IAAK,kCACLzN,KAAM,yBAEVuT,QAAO,GAAA3L,OAAK8F,uBAAL,mBAGP+1G,GAAsB5hH,IAASkN,WAAWjN,OAAO,CACjD2L,IAAG,GAAA7F,OAAK8F,uBAAL,iBACHvL,MAAOqhH,KAGPE,GAA0B7hH,IAASO,MAAMN,OAAO,CAChDiR,SAAU,CAAC,IACXQ,QAAO,GAAA3L,OAAK8F,uBAAL,4BAGPi2G,GAA+B9hH,IAASkN,WAAWjN,OAAO,CAC1D2L,IAAG,GAAA7F,OAAK8F,uBAAL,0BACHvL,MAAOuhH,KAGPE,GAAwB/hH,IAASO,MAAMN,OAAO,CAC9CiR,SAAU,CAAC,IACXQ,QAAO,GAAA3L,OAAK8F,uBAAL,4BAGPm2G,GAA6BhiH,IAASkN,WAAWjN,OAAO,CACxD2L,IAAG,GAAA7F,OAAK8F,uBAAL,0BACHvL,MAAOyhH,KAGPE,GAA0BjiH,IAASO,MAAMN,OAAO,CAChDiR,SAAU,CAAC,IACXQ,QAAO,GAAA3L,OAAK8F,uBAAL,8BAGPq2G,GAA+BliH,IAASkN,WAAWjN,OAAO,CAC1D2L,IAAG,GAAA7F,OAAK8F,uBAAL,4BACHvL,MAAO2hH,KAGPE,GAAiBniH,IAASO,MAAMN,OAAO,CACvC2L,IAAK,MAGLw2G,GAAsBpiH,IAASkN,WAAWjN,OAAO,CACjD2L,IAAK,IACLtL,MAAO6hH,GACP90G,MAAO,WACH,IACIg1G,EADAC,EAAeriG,QAGfoiG,EADA1iH,OAAOoR,aAAazW,eAAe,gBAChBimB,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,cAE/B,GAEvB,IAAIC,EAAanoH,OAAO+nC,KAAKkgF,GAO7B,OANAt9G,IAAEC,KAAKu9G,EAAY,SAAArjH,GACf,IAAIsjH,EAAOH,EAAiBnjH,GAC5BsjH,EAAKC,UAAYvjH,EACjBojH,EAAanoH,KAAKqoH,KAEtBniH,KAAK4W,MAAMqrG,GACJtiH,IAASkN,WAAW7S,UAAUgT,MAAM9S,KAAK8F,SAIpDqiH,GAAkB1iH,IAASO,MAAMN,OAAO,CACxCiR,SAAU,CAAC,IACXQ,QAAO,GAAA3L,OAAK8F,uBAAL,0BAGP82G,GAAuB3iH,IAASkN,WAAWjN,OAAO,CAClD2L,IAAG,GAAA7F,OAAK8F,uBAAL,wBACHvL,MAAOoiH,KAGPE,GAAqB5iH,IAASO,MAAMN,OAAO,CAC3CiR,SAAU,CAAC,IACXQ,QAAO,GAAA3L,OAAK8F,uBAAL,sCAQIg3G,GAAA,CACXC,UAAWnB,GACXoB,gBAAiBnB,GACjBoB,SAAUnB,GACVoB,WAAYnB,GACZoB,cAAenB,GACfoB,mBAAoBnB,GACpBoB,gBAAiBnB,GACjBoB,qBAAsBnB,GACtBoB,UAAWlB,GACXmB,WAAYZ,GACZa,cAhB0BxjH,IAASkN,WAAWjN,OAAO,CACrD2L,IAAG,GAAA7F,OAAK8F,uBAAL,oCACHvL,MAAOsiH,MC/BIa,GAAA,CACXC,WAzDa,SAAShmH,EAAS6L,GAAU,IAAAS,EAAA3J,KACrCsjH,EAAWtjH,KAAKsjH,SAChBC,EAAQ,GAAA79G,OAAM8F,uBAAN,wBACZtK,IAAE/C,IAAIolH,EAAU,CAAE/b,KAAMnqG,EAAQmqG,KAAMgc,cAAeF,GAAY,SAAAlqH,GAC7D,IAAIqqH,EAAc95G,EAAK+5G,WAAWtqH,GAClC8P,EAASu6G,MAqDbC,WAjDa,SAAAC,GACb,IAAIjc,EAAU,GACVkc,EAAOD,EAASC,KASpB,OARA1iH,IAAEyD,KAAKi/G,EAAM,SAAAC,GACT,IAAIC,EAASF,EAAKC,GACd39G,EAAK,GAAAR,OAAMo+G,EAAOC,WAAWjmH,KAAxB,QAAA4H,OAAmCo+G,EAAOC,WAAWC,oBAArD,MAAAt+G,OACLo+G,EAAOC,WAAW1kE,aAElB5kD,EAAS,CAAE8D,MAAOulH,EAAOC,WAAW5jH,GAAI+F,MAAOA,GACnDwhG,EAAQ5tG,KAAKW,KAEVitG,GAuCPuc,WApCa,SAAAxW,GAC4B,KAArCA,EAAS+V,cAAc5a,QAAQ,KAC/B6E,EAAS+V,cAAgB/V,EAAS+V,cAAc5a,OAAO,EAAG6E,EAAS+V,cAAc5pH,OAAS,IAE9F,IAAIiF,EAAG,GAAA6G,OAAM+nG,EAAS+V,cAAf,KAAA99G,OAAgC+nG,EAASyW,cAAzC,KAAAx+G,OAA0D+nG,EAAS0W,oBACtEC,EAAe,GACf9kH,OAAOoR,aAAauxG,eACpBmC,EAAelkG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,eAElDmC,EAAavlH,GAAO4uG,EACpBnuG,OAAOoR,aAAauxG,aAAe/hG,KAAKC,UAAUikG,IA2BlDC,YAxBc,WACd,GAAI/kH,OAAOoR,aAAazW,eAAe,gBAAiB,CACpD,IAAIqqH,EAAapkG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,cAEhD,OADmBloH,OAAO+nC,KAAKwiF,GAAY1qH,OAG3C,OAAO,GAmBX2qH,WAfa,SAASC,EAAMC,EAAW3kE,GACvC,IAAI4kE,EAMJ,OALA5kE,EAAMxgC,QAAQ,SAASiyB,GACfA,EAAKizE,MAAQA,EAAKjmH,QAClBmmH,EAAgBnzE,KAGjBmzE,ICMIC,GAAA,CACXC,aAzDOjlH,IAASD,KAAKE,OAAO,CAC5BiR,SAAU,CACNg0G,WAAY,CACR,CACIt5G,IAAK,kCACLzN,KAAM,2BAKlB+B,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,GAAIE,KAAK6Q,UACnD7Q,KAAKC,MAAQ,IAAIuiH,GAAeE,gBAChC1iH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvClC,KAAKC,MAAM+M,SAGf2P,GAAI,UAEJza,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,GAAIA,EAASE,KAAK6Q,UAC5D,IAAIi0G,EAAyB9kH,KAAK+kH,qBAClC/kH,KAAKe,IAAIgF,KACL++G,EAAuB,CACnB//G,MAAOgK,IAAG,gCACV81G,WAAY7kH,KAAKC,MAAMkN,OACvBkQ,MAAO2nG,GAAcX,kBAKjCU,qBAAsBrgH,IAAE+N,SACpB,CACI,yEACA,kIACA,SACA,uDACA,yBACA,uBACA,4CACA,4BACA,OACA,wEACA,8GACA,SACA,QACA,QACA,YACA,WACA,SACA,kCACA,UACFjF,KAAK,QC4CAy3G,WAAA,CACXC,aA/FqBvlH,IAASD,KAAKE,OAAO,CAC1C+c,GAAI,UAEJ9L,SAAU,CACNs0G,UAAW,mCAGftlH,WAAY,SAASC,GACjB,IAAIslH,EAAOtlH,EAAQqlH,UAAUn8F,QAAQ,MAAO,OAC5ChpB,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAWA,EAASE,KAAK6Q,UACxD7Q,KAAKC,MAAQ,IAAIuiH,GAAeI,WAChC5iH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvClC,KAAKC,MAAMsL,IAAX,GAAA7F,OAAoB1F,KAAKC,MAAMsL,IAA/B,mBAAA7F,OAAoD1F,KAAKF,QAAQqlH,WACjEnlH,KAAKC,MAAMklH,UAAYC,EACvBplH,KAAKC,MAAM+M,SAGf9K,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKF,QAAQulH,WAAarlH,KAAKC,MAAMkN,OACrCnN,KAAKF,QAAQud,MAAQ2nG,GAAcX,cACnC,IAAIiB,EAAyBtlH,KAAKulH,qBAClCvlH,KAAKe,IAAIgF,KAAKu/G,EAAuBtlH,KAAKF,UAC1CoB,IAAE,WAAWgE,IAAI,WAAY,QAC7BlF,KAAKwlH,cAGTA,WAAY,WAAW,IAAA77G,EAAA3J,KACnBkB,IAAE,eAAe8H,aAAa,CAC1BC,OAAQ,SAAC5L,EAAS6L,GACd,IAAIo6G,EAAW35G,EAAK1J,MAAMklH,UAAUn8F,QAAQ,OAAQ,KAChDu6F,EAAQ,GAAA79G,OAAM8F,uBAAN,wBACR8iB,EAAS,CACTk5E,KAAMnqG,EAAQmqG,KACdgc,cAAeF,GAEnBpiH,IAAEkkD,KAAKm+D,EAAUj1F,EAAQ,SAAAl1B,GACrBgG,QAAQ8a,IAAI9gB,GACZ,IAAIqqH,EAAcuB,GAActB,WAAWtqH,GAC3C8P,EAASu6G,MAGjBgC,UAAW,EACX77G,OAAQ,SAAClN,EAAOsF,GACZ,IAAI0jH,EAAS1jH,EAAGorD,KAAK7uD,MACjBonH,EAAS,gBAAAjgH,OAAmBiE,EAAK1J,MAAMklH,UAA9B,OAAAz/G,OAA6CggH,GAC1D/lH,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,QAMzBu8F,qBAAsB7gH,IAAE+N,SACpB,CACI,0BACA,+CACA,6CACA,WACA,yEACA,iMACA,SACA,wDACA,+DACA,4BACA,8LACA,UACA,SACA,8CACA,uBACA,iCACA,OACA,gBACA,uBACA,wBACA,QACA,WACA,gDACA,OACA,OACA,uHACA,QACA,8CACA,+CACA,QACA,YACA,WACA,SACA,UACFjF,KAAK,SCuHAo4G,GAAA,CACXjD,SAlN+BhjH,IAASD,KAAKE,OAAO,CACpD+c,GAAI,UAEJ9c,WAAY,SAASyuB,GACjBtuB,KAAKsuB,OAASA,EACdtuB,KAAKC,MAAQ,IAAIuiH,GAAeM,mBAChC9iH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvC,IAAIkjH,EAAO92F,EAAO62F,UAAUn8F,QAAQ,MAAO,OAC3ChpB,KAAKC,MAAMsL,KAAX,kBAAA7F,OAAoC0/G,EAApC,iBAAA1/G,OAAwD4oB,EAAOu3F,YAA/D,cAAAngH,OACI4oB,EAAO47B,SADX,gBAAAxkD,OAEe4oB,EAAO2yE,WAFtB,UAAAv7F,OAEyC4oB,EAAO2W,MAChDjlC,KAAKC,MAAMklH,UAAYC,EACvBplH,KAAKC,MAAM6lH,SAAWx3F,EAAOu3F,YAC7B7lH,KAAKC,MAAM+M,SAGf9K,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,GAAIA,GAC9C,IAAIimH,EAA6B/lH,KAAKgmH,yBAClCC,EAA2BjmH,KAAKkmH,uBAChCC,EAAU,CACVC,MAAO,CAAEC,MAAO,UAAWhnE,YAAa,UAAWvhD,KAAM,WACzDwoH,UAAW,CAAED,MAAO,MAAOhnE,YAAa,MAAOvhD,KAAM,QAEzDqoH,EAAQC,MAAMpmH,KAAKsuB,OAAO47B,UAAsC,QAA1BlqD,KAAKsuB,OAAO2yE,WAAuB,eAAiB,aAC1FklB,EAAQG,UAAUtmH,KAAKsuB,OAAO47B,UAAsC,OAA1BlqD,KAAKsuB,OAAO2yE,WAAsB,OAAS,MACrF,IAAIslB,EAAgB5jH,KAAKpC,IAAIP,KAAKsuB,OAAO2W,KAAO,EAAG,GAC/C8iB,EAAQhlD,SAAS/C,KAAKC,MAAMkN,OAAO,GAAGhP,IAAI,oBAAsB,IAAM,EACtEqoH,EAAY7jH,KAAKrC,IAAIyC,SAAS/C,KAAKsuB,OAAO2W,MAAQ,EAAG8iB,GACrD0+D,EAAoB,CACpBxhF,KAAMjlC,KAAKsuB,OAAO2W,KAClB3nB,KAAMkpG,EACNh+F,SAAU+9F,EACVx+D,MAAOA,GAEX,GAAIA,EAAQ,EAAG,CACX,IAAI9iB,EAAOliC,SAAS/C,KAAKsuB,OAAO2W,MAC5ByhF,EAAa9mG,QACb+mG,EAAchkH,KAAKpC,IAAI0kC,EAAO,EAAG,GACjCvrC,EAAIitH,EACJC,EAAYjkH,KAAKrC,IAAIqC,KAAKrC,IAAI2kC,EAAO,EAAG0hF,EAAc,GAAI5+D,GAC9D,IAAKruD,EAAIitH,EAAajtH,GAAKktH,EAAWltH,IAClCgtH,EAAW5sH,KAAKJ,GAEpB+sH,EAAiB,WAAiBC,EAEtC1mH,KAAKe,IAAIgF,KACLggH,EAA2B,CACvBc,gBAAiBZ,EAAyBQ,GAC1CX,SAAU9lH,KAAKC,MAAMkN,OAAO,GAC5Bg4G,UAAWnlH,KAAKC,MAAMklH,UACtB9nG,MAAO2nG,GAAcX,cACrB8B,QAASA,EACTlhF,KAAMjlC,KAAKsuB,OAAO2W,QAG1B/jC,IAAE,WAAWgE,IAAI,WAAY,QAC7BlF,KAAKwlH,cAGTA,WAAY,WAAW,IAAA77G,EAAA3J,KACnBkB,IAAE,eAAe8H,aAAa,CAC1BC,OAAQ,SAAC5L,EAAS6L,GACd,IAAIo6G,EAAW35G,EAAK1J,MAAMklH,UAAUn8F,QAAQ,OAAQ,KAChDu6F,EAAQ,GAAA79G,OAAM8F,uBAAN,wBACR8iB,EAAS,CACTk5E,KAAMnqG,EAAQmqG,KACdgc,cAAeF,GAEnBpiH,IAAEkkD,KAAKm+D,EAAUj1F,EAAQ,SAAAl1B,GACrB,IAAIqqH,EAAcuB,GAActB,WAAWtqH,GAC3C8P,EAASu6G,MAGjBgC,UAAW,EACX77G,OAAQ,SAASlN,EAAOsF,GACpB,IAAI0jH,EAAS1jH,EAAGorD,KAAK7uD,MACjBonH,EAAS,gBAAAjgH,OAAmB1F,KAAKC,MAAMklH,UAA9B,OAAAz/G,OAA6CggH,GAC1D/lH,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,OAIrB9nB,IAAE,UAAUG,GAAG,QAAS,SAAAya,GACpB,IAAIgrG,EAAa,GACjBA,EAAWC,MAAQ7lH,IAAE4a,EAAG5e,QAAQ8D,KAAK,cACrC8lH,EAAWR,UAAYplH,IAAE4a,EAAG5e,QAAQ8D,KAAK,kBACzC,IAAI2kH,EAAS,cAAAjgH,OAAiBiE,EAAK1J,MAAMklH,UAA5B,OAAAz/G,OAA2CiE,EAAK1J,MAAM6lH,SAAtD,OAAApgH,OAAoEohH,EAAWC,MAA/E,OAAArhH,OACTiE,EAAK2kB,OAAO2W,KADH,OAAAv/B,OAEPohH,EAAWR,WACjB3mH,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,MAGjB9nB,IAAE,YAAYG,GAAG,QAAS,SAAAya,GACtB,IAAImpB,EAAO/jC,IAAE4a,EAAG5e,QAAQ8D,KAAK,aACzB2kH,EAAS,cAAAjgH,OAAiBiE,EAAK1J,MAAMklH,UAA5B,OAAAz/G,OAA2CiE,EAAK1J,MAAM6lH,SAAtD,OAAApgH,OACTiE,EAAK2kB,OAAO47B,SADH,OAAAxkD,OAEPu/B,EAFO,OAAAv/B,OAEGiE,EAAK2kB,OAAO2yE,YAC5BthG,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,OAKrBk9F,uBAAwBxhH,IAAE+N,SACtB,CACI,2BACA,yBACA,0DACA,wEACA,iBACA,mEACA,iFACA,UACA,yBACA,yBACA,+CACA,yBACA,6BACA,UACA,iBACA,wDACA,UACA,yCACA,yBACA,mEACA,iBACA,0DACA,UACA,YACA,wDACA,wDACA,6BACA,kEACA,UACA,iBACA,uCACA,yBACA,mEACA,iBACA,0DACA,UACA,UACA,UACA,4BACA,mEACA,oEACA,iBACA,4EACA,6EACA,UACA,UACFjF,KAAK,KAGXw4G,yBAA0BthH,IAAE+N,SACxB,CACI,0BACA,+CACA,6CACA,sDACA,6GACA,uCACA,WACA,yEACA,iKACA,SACA,0DACA,+DACA,4BACA,8LACA,UACA,SACA,qDACA,yBACA,UACA,8CACA,qCACA,iCACA,OACA,2JACA,uJACA,4JACA,oCACA,QACA,WACA,oEACA,OACA,mCACA,OACA,wEACA,8FACA,SACA,QACA,yCACA,kCACA,QACA,YACA,WACA,SACA,UACFjF,KAAK,iBCsaAw5G,GAAA,CACXC,YAjnByBtnH,IAASD,KAAKE,OAAO,CAC9C+c,GAAI,UAEJ9c,WAAY,SAASyuB,GACjBtuB,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,GAAIE,KAAK6Q,UACnD7Q,KAAKC,MAAQ,IAAIuiH,GAAeQ,qBAChChjH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvC,IAAIkjH,EAAO92F,EAAO62F,UAAUn8F,QAAQ,MAAO,OAC3ChpB,KAAKC,MAAMsL,KAAX,kBAAA7F,OAAoC0/G,EAApC,mBAAA1/G,OAA0D4oB,EAAO41F,eACjElkH,KAAKC,MAAMujH,cAAgBl1F,EAAO62F,UAAUn8F,QAAQ,OAAQ,KAC5DhpB,KAAKC,MAAMklH,UAAYC,EACvBplH,KAAKC,MAAM6lH,SAAWx3F,EAAO41F,cAC7BlkH,KAAKC,MAAM+M,SAGf9K,OAAQ,SAASpC,GACb,IAAIonH,EAAwBlnH,KAAKmnH,oBAC7Bh6G,EAASnN,KAAKC,MAAMkN,OAAO,GAC/BnN,KAAKF,QAAU,CACXikH,WAAY52G,EAAOhP,IAAI,cACvBgnH,UAAWnlH,KAAKC,MAAMklH,UACtB9nG,MAAO2nG,GAAcX,eAEzB,IAAI+C,EAAartH,OAAO+nC,KAAK9hC,KAAKF,QAAQikH,WAAWtW,UAAU13F,KAAK,SAASiW,EAAGC,GAC5E,OAAOlpB,SAASipB,EAAEtrB,MAAM,KAAK,GAAKurB,EAAEvrB,MAAM,KAAK,MAE/C2mH,EAAmB,GACnBC,EAAqBtnH,KAAKF,QAAQikH,WAAWtW,SACjD2Z,EAAW9nG,QAAQ,SAASzgB,GACxBwoH,EAAiBxoH,GAAOyoH,EAAmBzoH,KAE/CmB,KAAKF,QAAQikH,WAAWtW,SAAW4Z,EACnCrnH,KAAKF,QAAQynH,kBAAoBvnH,KAAKF,QAAQynH,mBAAqBH,EAAWA,EAAWxtH,OAAS,GAClGoG,KAAKF,QAAQ0nH,iBAAmBxnH,KAAKF,QAAQikH,WAAWtW,SAASztG,KAAKF,QAAQynH,mBAC9EvnH,KAAKF,QAAQ0nH,iBAAiBhE,cAAgBxjH,KAAKC,MAAMujH,cACzDxjH,KAAKF,QAAQggD,MAAQ9/C,KAAKF,QAAQ0nH,iBAAiB1nE,MACnD9/C,KAAKF,QAAQ2nH,iCAAmCznH,KAAK0nH,yBACrD1nH,KAAKF,QAAQ6nH,+BAAiC3nH,KAAK4nH,uBACnD5nH,KAAKF,QAAQ+nH,2BAA6B7nH,KAAK8nH,4BAC/C9nH,KAAKF,QAAQioH,2BAA6B/nH,KAAKgoH,4BAC/ChoH,KAAKF,QAAQmoH,yBAA2BjoH,KAAKkoH,0BAC7CloH,KAAKF,QAAQqoH,yBAA2BnoH,KAAKooH,0BAC7CpoH,KAAKF,QAAQuoH,sBAAwBroH,KAAKsoH,2BAC1CtoH,KAAKF,QAAQyoH,kBAAoBp7G,EAAOhP,IAAI,qBAC5C6B,KAAKF,QAAQ0oH,eAAiBxoH,KAAKyoH,qBAAqB,CACpDC,gBAAiBv7G,EAAOhP,IAAI,eAEhC6B,KAAKF,QAAQ6oH,mBAAqBx7G,EAAOhP,IAAI,sBAC7C6B,KAAKF,QAAQ8oH,QAAb,GAAAljH,OAA0B8F,uBAA1B,iDACAxL,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKe,IAAIgF,KAAKmhH,EAAsBlnH,KAAKF,UACzCE,KAAK6oH,eAAe7oH,KAAKF,QAAQ0nH,kBACjCxnH,KAAKwlH,aACLtkH,IAAE,WAAWgE,IAAI,WAAY,SAGjCsgH,WAAY,WAAW,IAAA77G,EAAA3J,KACnBkB,IAAE,cAAcG,GAAG,SAAU,WACzBsI,EAAK7J,QAAQynH,kBAAoBrmH,IAAE,cAC9BmG,KAAK,mBACLxB,OACL8D,EAAK7J,QAAQ0nH,iBAAmB79G,EAAK7J,QAAQikH,WAAWtW,SAAS9jG,EAAK7J,QAAQynH,mBAC9E59G,EAAKk/G,eAAel/G,EAAK7J,QAAQ0nH,kBACjC79G,EAAKm/G,OAAOn/G,EAAK7J,WAErBoB,IAAE,8BAA8BG,GAAG,SAAU,WACzCsI,EAAKo/G,iBAET7nH,IAAE,uBAAuBG,GAAG,QAAS,SAAAya,GACjCA,EAAGra,iBACH,IAAI6sB,EAAS,GACbA,EAAO2zF,aAAe/hG,KAAKC,UAAU,CACjC,CACIjf,IAAE,uBAAuBF,KAAK,cAC9BE,IAAE,cACGmG,KAAK,mBACL/F,SAGbgtB,EAAO06F,yBAA2B9oG,KAAKC,UAAU,CAACjf,IAAE,uBAAuBF,KAAK,gBAChFstB,EAAOk1F,cAAgB75G,EAAK1J,MAAMujH,cAClCl1F,EAAO26F,0BAA4B/nH,IAAE,8BAA8BI,MACnEgtB,EAAO46F,gCAAkChoH,IAAE,oCAAoCI,MAC/EgtB,EAAO66F,8BAAgCjoH,IAAE,kCAAkCI,MAC3EgtB,EAAO86F,mBAAqBlpG,KAAKC,UAAUxW,EAAK0/G,YAAY/6F,IAC5DA,EAAOk6F,eAAiBtnH,IAAE,iCACrBmG,KAAK,mBACL/F,MACLgtB,EAAOm2F,UAAYvjH,IAAE,cAChBmG,KAAK,mBACL/F,MACL,IAAIiK,EAAMrK,IAAE,4BAA4BF,KAAK,UAC7C2I,EAAK2/G,eAAeh7F,EAAQ/iB,KAEhCrK,IAAE,kBAAkBG,GAAG,QAAS,SAAAya,GAC5BnS,EAAK7J,QAAQynH,kBAAoBrmH,IAAE,cAC9BmG,KAAK,mBACLxB,OACL8D,EAAK7J,QAAQ0nH,iBAAmB79G,EAAK7J,QAAQikH,WAAWtW,SAAS9jG,EAAK7J,QAAQynH,mBAC9E,IAAIgC,EAAsB,GAC1B7kH,IAAEC,KAAK5K,OAAO+nC,KAAKn4B,EAAK7J,QAAQ0nH,kBAAmB,SAAA3oH,GAC1C0qH,EAAoB1qH,KACrB0qH,EAAoB1qH,GAAO8K,EAAK7J,QAAQ0nH,iBAAiB3oH,MAGjE0qH,EAAoBN,0BAA4B/nH,IAAE,8BAA8BI,MAChFioH,EAAoBL,gCAAkChoH,IAAE,oCAAoCI,MAC5FioH,EAAoBJ,8BAAgCjoH,IAAE,kCAAkCI,MACxFioH,EAAoBH,mBAAqBlpG,KAAKC,UAAUxW,EAAK0/G,YAAY,KACzEE,EAAoBf,eAAiBtnH,IAAE,iCAClCmG,KAAK,mBACL/F,MACLioH,EAAoB/F,cAAgB75G,EAAK1J,MAAMujH,cACK,KAAhD+F,EAAoB/F,cAAc5a,QAAQ,KAC1C2gB,EAAoB/F,cAAgB+F,EAAoB/F,cAAc5a,OAClE,EACA2gB,EAAoB/F,cAAc5pH,OAAS,IAGnDorH,GAAcf,WAAWsF,GACzB5/G,EAAKk/G,eAAeU,KAExBvpH,KAAKwpH,yBACLtoH,IAAE,WACEA,IAAE,4BAA4B0zG,WAElC1zG,IAAE,cAAcG,GAAG,QAAS,SAAAya,GACxB,IAAI0oG,EAAOtjH,IAAE4a,EAAG5e,QAAQ8D,KAAK,aACzBlD,EAAOoD,IAAE4a,EAAG5e,QAAQ8D,KAAK,aACzByoH,EAAOvoH,IAAE4a,EAAG5e,QAAQ8D,KAAK,aACzBwiH,EAAgB75G,EAAK1J,MAAMujH,cAC3BkC,EAASxkH,IAAE,uBAAuBF,KAAK,cACvCyjH,EAAYvjH,IAAE,cACbmG,KAAK,mBACL/F,MACDsnH,EAAO,GAAAljH,OAAM8F,uBAAN,2BACP8iB,EAAS,CACTk2F,KAAMA,EACNhB,cAAeA,EACfkC,OAAQA,EACRjB,UAAWA,GAEfvjH,IAAE/C,IAAIyqH,EAASt6F,EAAQ,SAAAl1B,GACnB,IAAIswH,EAAW,IAAIC,KAASvwH,GAC5BgH,IAAM0gF,SAAS1nF,EAAKqkF,OAAQ,SAAA30E,GACpBA,EAAM9L,OACkD,GAApD,CAAC,OAAQ,mBAAmB0E,QAAQoH,EAAM9L,QAC1C8L,EAAM9L,KAAO,SACb8L,EAAMyb,KAAN,eAAA7e,OAA4BoD,EAAMhL,KAAlC,OAAA4H,OAA4CtF,IAAM4gF,QAAQl4E,EAAM0sE,YAAhE,QAIZ,IAAIp2C,EAAQ,IAAIv0B,KAAMnL,KAClB49G,EAAW,MAAA53G,OAAS5H,EAAT,SAAA4H,OAAqB+jH,GACpCrqF,EAAMj9B,KAAK,CACPo9B,gBAAgB,EAChBx6B,MAAOu4G,EACPj+E,KAAMqqF,EAAS3oH,IACfunC,QAAS,CACLC,MAAO,WACHnJ,EAAM/8B,eAM1BnB,IAAE,sBAAsBG,GAAG,QAAS,SAAAitB,GAChC,IAAIm2F,EAAY96G,EAAKigH,oBACjBpF,EAAOl2F,EAAOpxB,OAAO2E,WAAWgoH,aAAa,iBACjDlgH,EAAKmgH,kBAAkBtF,EAAMC,KAEjCvjH,IAAE,sBAAsBG,GAAG,QAAS,SAAAitB,GAChC,IAAIm2F,EAAY96G,EAAKigH,oBACjBpF,EAAOl2F,EAAOpxB,OAAO2E,WAAWgoH,aAAa,iBACjDlgH,EAAKogH,kBAAkBvF,EAAMC,KAEjCvjH,IAAE,6BAA6BG,GAAG,QAAS,WACvCH,IAAE,uBAAuBgc,YAAYvT,EAAK7J,QAAQ+nH,2BAA2Bl+G,EAAK7J,UAClF6J,EAAKqgH,eACLrgH,EAAK67G,eAETtkH,IAAE,6BAA6BG,GAAG,QAAS,WACvCH,IAAE,uBAAuBgc,YAAYvT,EAAK7J,QAAQioH,8BAClDp+G,EAAK67G,gBAIbqD,eAAgB,SAASpb,GAAU,IAAA7/F,EAAA5N,KAC3BsuB,EAAS,CAAExwB,KAAM2vG,EAAS3vG,KAAMuoH,MAAO5Y,EAAS4Y,OAChD4D,GAAoB,EACxB/oH,IAAE/C,IAAF,GAAAuH,OAAS8F,uBAAT,8BAAmD8iB,EAAQ,SAAAl1B,GACvD,IAAK,IAAIgT,EAAQ,EAAGA,EAAQhT,EAAKQ,OAAQwS,IAAS,CAC9C,IAAI23G,EAAa3qH,EAAKgT,GAClB89G,GAAanG,EAAWzS,UAAYyS,EAAWoG,YAC/CC,EACArG,EAAWI,oBAAsB1W,EAAS0W,oBAC1CJ,EAAWsG,8BAAgC5c,EAAS0W,mBAEpDJ,EAAWjmH,MAAQ2vG,EAASsW,WAAWjmH,MACvCimH,EAAWsC,OAAS5Y,EAASsW,WAAWsC,OACxC6D,GACAE,IAEAH,GAAoB,GAEpBA,GACA/oH,IAAE,uBAAuBmD,KAAK,YAAY,GAC1CnD,IAAE,uBAAuBI,IAAI,wCAE7BJ,IAAE,uBAAuBmD,KAAK,YAAY,GAC1CnD,IAAE,uBAAuBI,IAAI,0BAGjCsM,EAAK08G,WAAW7c,IAAawc,GAC7B/oH,IAAE,kBAAkBmB,OACpBnB,IAAE,kBAAkBI,IAAI,2CAExBJ,IAAE,kBAAkBiB,OACpBjB,IAAE,kBAAkBI,IAAI,mCAKpC+nH,YAAa,SAAS/6F,GAClB,IAAI86F,EAAqB,GAyBzB,OAxBIloH,IAAE,8BAA8BtH,OAChC00B,EAAOi8F,sBAAwBrpH,IAAE,8BAC5BmG,KAAK,mBACL/F,MAELgtB,EAAOk8F,uBAAyBtpH,IAAE,2BAA2BI,MAEjEJ,IAAE,8BAA8ByD,KAAK,WACjC,IAAI8lH,EAAevpH,IAAElB,MAAMgB,KAAK,QAC5B0pH,EAAYxpH,IAAElB,MAAMgB,KAAK,iBAEzBooH,EAAmBsB,GADF,0BAAjBD,EACgC,CAC5BrB,mBAAoBloH,IAAElB,MACjBqH,KAAK,mBACL/F,MACLwc,OAAQ,UAGoB,CAC5BsrG,mBAAoBloH,IAAElB,MAAMsB,MAC5Bwc,OAAQ,YAIbsrG,GAGXN,OAAQ,SAAShpH,GACbE,KAAKe,IAAI6C,QACT5D,KAAKkC,OAAOpC,IAGhBwqH,WAAY,SAAS7c,GACjB,GAAKnuG,OAAOoR,aAAauxG,aAAzB,CAGA,IACImC,EADAhC,EAAYpiH,KAAK2qH,SAASld,GAK9B,OAHInuG,OAAOoR,aAAauxG,eACpBmC,EAAelkG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,kBAE9CmC,IAAgBA,EAAanqH,eAAemoH,MAMpDuI,SAAU,SAASld,GACf,IAAI6V,EAAWtjH,KAAKC,MAAMujH,cAK1B,MAH2B,KAAvBF,EAAS1a,QAAQ,KACjB0a,EAAWA,EAAS1a,OAAO,EAAG0a,EAAS1pH,OAAS,IAEpD,GAAA8L,OAAU49G,EAAV,KAAA59G,OAAsB+nG,EAASyW,cAA/B,KAAAx+G,OAAgD+nG,EAAS0W,qBAG7D4E,aAAc,WACV,IAAI6B,EAAU1pH,IAAE,8BACXmG,KAAK,mBACL/F,MACLJ,IAAE,gDAAgDyD,KAAK,WACnDzD,IAAElB,MAAMsB,IAAIspH,MAIpBtB,eAAgB,SAASh7F,EAAQs6F,GAAS,IAAA9hF,EAAA9mC,KACtCkB,IAAEkkD,KAAKwjE,EAASt6F,EAAQ,SAAAl1B,GACpB,IAAIyxH,EAAiB3qG,KAAK2iB,MAAMzpC,GAChC0tC,EAAKgkF,UAAUD,MAIvBC,UAAW,SAASx8F,GAChB,IAAIy8F,EAAc,GAAArlH,OAAM8F,uBAAN,uCACdy2G,EAAe3zF,EAAO2zF,aACtB0D,EAAS,YAAAjgH,OAAeu8G,EAAaz0G,KAAK,MAC9CtM,IAAEkkD,KAAK2lE,EAAgBz8F,EAAQ,SAAAl1B,GAC3BgG,QAAQ8a,IAAI,oDAEhBva,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,KAIjB4gG,kBAAmB,WAIf,OAHgB1oH,IAAE,cACbmG,KAAK,mBACL/F,OAITyoH,kBAAmB,SAASvF,EAAMC,GAAW,IAAA/zC,EAAA1wE,KAErC8/C,EADW9/C,KAAKF,QAAQ0nH,iBACP1nE,MACjBvO,EAAOyzE,GAAcT,WAAWC,EAAMC,EAAW3kE,GACjD3oB,EAAW,aAAeoa,EAAKy5E,MACnC9pH,IAAEi2B,GAAUvzB,QACZ1C,IAAEi2B,GAAUtzB,OAAO7D,KAAKF,QAAQqoH,yBAAyB,CAAE52E,KAAMA,KACjErwC,IAAE,sBAAsB6c,MAAM,SAAAjC,GAC1B,IAAI2oG,EAAY/zC,EAAKk5C,oBACjBpF,EAAO1oG,EAAG5e,OAAO2E,WAAWgoH,aAAa,iBAC7Cn5C,EAAKo5C,kBAAkBtF,EAAMC,KAEjCzkH,KAAKwlH,cAGTsE,kBAAmB,SAAStF,EAAMC,GAAW,IAAAnN,EAAAt3G,KAErC8/C,EADW9/C,KAAKF,QAAQ0nH,iBACP1nE,MACjBvO,EAAOyzE,GAAcT,WAAWC,EAAMC,EAAW3kE,GACjD3oB,EAAW,aAAeoa,EAAKy5E,MACnC9pH,IAAEi2B,GAAUvzB,QACZ1C,IAAEi2B,GAAUtzB,OACR7D,KAAKF,QAAQmoH,yBAAyB,CAClC12E,KAAMA,EACNo3E,mBAAoB3oH,KAAKF,QAAQ6oH,mBACjCN,sBAAuBroH,KAAKF,QAAQuoH,yBAG5CnnH,IAAE,sBAAsB6c,MAAM,SAAAjC,GAC1B,IAAI2oG,EAAYnN,EAAKsS,oBACjBpF,EAAO1oG,EAAG5e,OAAO2E,WAAWgoH,aAAa,iBAC7CvS,EAAKyS,kBAAkBvF,EAAMC,KAEjCzkH,KAAKwlH,cAGTwE,aAAc,WACV9oH,IAAE,8BAA8BiI,OAAO,WACnC,IAAIyhH,EAAU1pH,IAAE,8BACXmG,KAAK,mBACL/F,MACLJ,IAAE,gDAAgDyD,KAAK,SAAAmgC,GACnDA,EAAIxjC,IAAIspH,OAGhB5qH,KAAKwpH,0BAGTA,uBAAwB,WACpBtoH,IAAE,8BAA8BG,GAAG,SAAU,SAAAya,GACzC,IAAIhV,EAAU5F,IAAE4a,EAAG5e,QACH4J,EAAQO,KAAK,mBAAmB/F,OAC9BJ,IAAE,8BACfmG,KAAK,mBACL/F,MAEDwF,EAAQ9F,KAAK,UAAW,UAExB8F,EAAQwC,WAAW,cAK/B69G,oBAAqBziH,IAAE+N,SACnB,CACI,yEACA,qPACA,SACA,6FACA,sGACA,mFACA,2FACA,yBACA,6CACA,uCACA,gEACA,uEACA,wGACA,0FACA,YACA,YACA,wMACA,6IACA,kIACA,SACA,SACA,wBACA,4DACA,gIACA,6BACA,oDACA,yEACA,uFACA,OACA,0FACA,oEACA,2BACA,wEACA,qGACA,OACA,SACA,4DACA,SACA,SACA,UACA,2DACA,qDACA,6BACA,kDACA,uEACA,mFACA,OACA,8CACA,mEACA,2EACA,OACA,8DACA,2BACA,kEACA,6FACA,OACA,SACA,8HACA,UACA,sGACA,4CACA,mBACA,gBACA,QACA,WACA,yBACA,4EACA,0EACA,mCACA,8BACA,qCACA,kCACA,QACA,YACA,WACA,WACA,SACA,SACA,UACA,yEACA,6IACA,6BACA,yDACA,kHACA,UACA,sGACA,4CACA,uBACA,mBACA,qIACA,WACA,6BACA,wDACA,0GACA,mCACA,wFACA,mPACA,SACA,QACA,mCACA,kDACA,0DACA,sIACA,QACA,QACA,YACA,WACA,WACA,SACA,SACA,UACA,UACA,UACFjF,KAAK,KAGXk6G,yBAA0BhjH,IAAE+N,SACxB,CACI,2DACA,iFACA,OACA,qDACA,2CACA,+DACA,oFACA,oDACA,YACA,UACA,QACA,QACA,UACFjF,KAAK,KAGXo6G,uBAAwBljH,IAAE+N,SACtB,CACI,4EACA,6HACA,2CACA,kCACA,+DACA,oFACA,oDACA,YACA,QACA,UACA,SACFjF,KAAK,KAGXi7G,qBAAsB/jH,IAAE+N,SACpB,CACI,iEACA,6BACA,yBACA,iCACA,yDACA,+DACA,YACA,YACA,kJACA,SACA,UACFjF,KAAK,KAGXy9G,uBAAwBvmH,IAAE+N,SACtB,CACI,2CACA,+DACA,qDACA,uEACA,8CACA,UACA,YACA,WACFjF,KAAK,KAGXw6G,4BAA6BtjH,IAAE+N,SAC3B,CACI,gCACA,sCACA,yGACA,wHACA,mDACA,0EACA,SACA,SACA,UACFjF,KAAK,KAGXs6G,4BAA6BpjH,IAAE+N,SAC3B,CACI,gCACA,sDACA,6BACA,yCACA,gEACA,wEACA,YACA,8GACA,mDACA,mFACA,SACA,SACA,SACA,UACFjF,KAAK,KAGX46G,0BAA2B1jH,IAAE+N,SACzB,CACI,uFACA,+KACA,yMACA,UACFjF,KAAK,KAGX06G,0BAA2BxjH,IAAE+N,SACzB,CACI,6FACA,kMACA,wEACA,YACA,8NACA,yDACA,UACFjF,KAAK,KAGX86G,2BAA4B5jH,IAAE+N,SAC1B,CACI,6CACA,iEACA,aACFjF,KAAK,QC9dA09G,GAAA,CACXC,cAlJOxrH,IAASD,KAAKE,OAAO,CAC5B+c,GAAI,UAEJ9L,SAAU,GAEVhR,WAAY,SAASC,GACjBE,KAAKC,MAAQ,IAAIuiH,GAAeS,UAChCjjH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvClC,KAAKC,MAAM+M,QACXhN,KAAKkC,UAGTA,OAAQ,SAASpC,GACb,IAAIsrH,EAAsBprH,KAAKqrH,kBAC3BpJ,EAAejiH,KAAKC,MAAMkN,OAC9BnN,KAAKe,IAAIgF,KACLqlH,EAAoB,CAChBrmH,MAAOgK,IAAG,iCACVkzG,aAAcA,EACdr+G,MAAOmL,IAAG,6BACVsO,MAAO2nG,GAAcX,iBAG7BnjH,IAAE,WAAWgE,IAAI,WAAY,QAC7BlF,KAAKwlH,cAGTA,WAAY,WAAW,IAAA77G,EAAA3J,KACnBkB,IAAE,gBAAgBG,GAAG,QAAS,SAAAya,GAC1B,IAAIytG,EAAsB5/G,EAAK2hH,cAAcpqH,IAAE4a,EAAG5e,QAAQ8D,KAAK,iBAC/D2I,EAAK4hH,iBAAiBhC,EAAqBroH,IAAE4a,EAAG5e,QAAQ8D,KAAK,mBAEjEE,IAAE,eAAeG,GAAG,QAAS,SAAAya,GACzB,IAAIsmG,EAAYlhH,IAAE4a,EAAG5e,QAAQ8D,KAAK,gBAC9BsjH,EAAapkG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,cAChD,GAAIqC,EAAWrqH,eAAemoH,GAAY,CACtC,IAAI8B,EAAgBI,EAAWlC,GAAW2B,WAAW5jH,UAC9CmkH,EAAWlC,GAClBlhH,IAAC,sBAAAwE,OAAuBw+G,IAAiBn2G,SAE7CzO,OAAOoR,aAAauxG,aAAe/hG,KAAKC,UAAUmkG,KAEtDpjH,IAAE,gBAAgBG,GAAG,QAAS,WAC1B/B,OAAOoR,aAAauxG,aAAe,OAEvC/gH,IAAE,kBAAkBG,GAAG,QAAS,WAC5B1B,IAASgpG,QAAQpsD,SAAS,YAAa,CACnC15C,SAAS,EACTmmB,SAAS,OAKrBuiG,iBAAkB,SAAShC,EAAqBnH,GAC5C,IAAI9zF,EAAS,GACbA,EAAO26F,0BAA4BM,EAAoBN,0BACvD36F,EAAO46F,gCAAkCK,EAAoBL,gCAC7D56F,EAAO66F,8BAAgCI,EAAoBJ,8BAC3D76F,EAAO86F,mBAAqBG,EAAoBH,mBAChD96F,EAAOk6F,eAAiBe,EAAoBf,eAC5Cl6F,EAAO2zF,aAAe/hG,KAAKC,UAAU,CACjC,CAACopG,EAAoBxF,WAAW5jH,GAAIopH,EAAoBpF,sBAE5D71F,EAAO06F,yBAA2B9oG,KAAKC,UAAU,CAACopG,EAAoBxF,WAAW5jH,KACjFmuB,EAAOk1F,cAAgBpB,EAAU1hH,MAAM,KAAK,GAC5C4tB,EAAOm2F,UAAY8E,EAAoBpF,mBACvC,IAAI54G,EAAG,GAAA7F,OAAM8F,uBAAN,iDAEP,GADAtK,IAAC,sBAAAwE,OAAuB6jH,EAAoBxF,WAAW5jH,KAAM4N,SACzDzO,OAAOoR,aAAauxG,aAAc,MAChB3kH,IAAd8kH,IACAA,EAAY4C,GAAc2F,SAASpB,IAEvC,IAAIiC,EAAmBtrG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,cAClDuJ,EAAiBvxH,eAAemoH,YACzBoJ,EAAiBpJ,GACxB9iH,OAAOoR,aAAauxG,aAAe/hG,KAAKC,UAAUqrG,IAI1DtqH,IAAEkkD,KAAK75C,EAAK+iB,EAAQ,SAAAl1B,GAChB,IAAIqyH,EAAavrG,KAAK2iB,MAAMzpC,GACxB6oH,EAAewJ,EAAWxJ,aAC1B0D,EAAS,YAAAjgH,OAAeu8G,EAAaz0G,KAAK,MAC9CtM,IAAEkkD,KAAF,GAAA1/C,OAAU8F,uBAAV,uCAA6DigH,EAAY,SAAAryH,GACrEgG,QAAQ8a,IAAI,oDAEhBva,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,OAKrBsiG,cAAe,SAASlJ,GACpB,IAAIoJ,EAAmBtrG,KAAK2iB,MAAMvjC,OAAOoR,aAAauxG,cACtD,OAAIuJ,EAAiBvxH,eAAemoH,GACzBoJ,EAAiBpJ,GAErBpiH,KAAK6Q,UAGhBw6G,kBAAmB3mH,IAAE+N,SACjB,CACI,yEACA,kIACA,SACA,iEACA,wGACA,iCACA,OACA,mCACA,oCACA,uCACA,uCACA,sCACA,sIACA,QACA,WACA,UACA,uCACA,oDACA,0DACA,uEACA,wEACA,0EACA,qEACA,0BACA,kNACA,QACA,0BACA,uNACA,QACA,QACA,YACA,iBACA,6CACA,UACA,WACA,WACA,+FACA,UACFjF,KAAK,QCtBAk+G,GAAA,CACXxI,WAzHyBvjH,IAASD,KAAKE,OAAO,CAC9C+c,GAAI,UAEJ9c,WAAY,SAASC,GAAS,IAAA6J,EAAA3J,KAC1BA,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,CAAC,IAAKA,EAASE,KAAK6Q,UAC9D7Q,KAAKC,MAAQ,IAAIuiH,GAAeU,WAChCljH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvClC,KAAKC,MAAMsL,KAAX,iBAAA7F,OAAmC1F,KAAKF,QAAQmiH,aAAaz0G,KAAK,MAClExN,KAAKC,MAAM+M,QACXhN,KAAKwjF,MAAQlkF,OAAOqsH,YAAY,WAC5B,IAAIC,EAAkB,CAAC,YAAa,SAChCC,GAAW,EACfnnH,IAAEuxE,KAAKtsE,EAAK1J,MAAMkN,OAAQ,SAAA42G,GACtB,IAAI+H,EAAc/H,EAAW5lH,IAAI,UAAUsuB,cAC3C,IAA8C,IAA1Cm/F,EAAgBlqH,QAAQoqH,GAExB,OADAD,GAAW,GACJ,IAGXA,EACAvsH,OAAOysH,cAAcpiH,EAAK65E,OAE1B75E,EAAK1J,MAAM+M,SAEhB,MAGPg/G,MAAO,WACH1sH,OAAOysH,cAAc/rH,KAAKwjF,QAG9BthF,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtC,IAAImsH,EAAuBjsH,KAAKksH,mBAChClsH,KAAKe,IAAIgF,KACLkmH,EAAqB,CACjBlnH,MAAOgK,IAAG,qBACVkzG,aAAcjiH,KAAKC,MAAMkN,OACzBkQ,MAAO2nG,GAAcX,iBAG7BnjH,IAAE,WAAWgE,IAAI,WAAY,SAGjCgnH,mBAAoBxnH,IAAE+N,SAClB,CACI,yEACA,kIACA,SACA,0BACA,oBACA,4BACA,qEACA,wBACA,sCACA,mDACA,6CACA,0FACA,sEACA,kEACA,WACA,uCACA,iCACA,OACA,iEACA,wEACA,kEACA,qEACA,gFACA,QACA,WACA,+BACA,oDACA,OACA,OACA,uBACA,uFACA,gCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,uCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,iCACA,WACA,SACA,QACA,OACA,uBACA,4FACA,8CACA,WACA,SACA,QACA,OACA,uBACA,8FACA,qKACA,kCACA,SACA,WACA,SACA,QACA,QACA,YACA,WACA,yCACA,YACFjF,KAAK,QCOA2+G,GAAA,CACXr+D,UA3HOnuD,IAASD,KAAKE,OAAO,CAC5B+c,GAAI,UAEJ9L,SAAU,CAAC,IAEXhR,WAAY,SAASC,GACjBE,KAAKC,MAAQ,IAAIuiH,GAAeW,cAChCnjH,KAAKiC,SAASjC,KAAKC,MAAO,OAAQD,KAAKkC,QACvClC,KAAKC,MAAM+M,QACXhN,KAAKkC,UAGTA,OAAQ,SAASpC,GACb,IAAIssH,EAA0BpsH,KAAKqsH,kBAC/BrmC,EAAYhmF,KAAKC,MAAMkN,OAC3BnN,KAAKe,IAAIgF,KACLqmH,EAAwB,CACpBrnH,MAAOgK,IAAG,2BACVi3E,UAAWA,EACX3oE,MAAO2nG,GAAcX,iBAG7BnjH,IAAE,WAAWgE,IAAI,WAAY,QAC7BlF,KAAKwlH,cAGTA,WAAY,WACR,IAAItB,EACJhjH,IAAE,iBAAiBG,GAAG,QAAS,SAAAya,GAC3B,IAAIwwG,EAAWprH,IAAE4a,EAAG5e,QAAQ8D,KAAK,gBAC7BurH,EAAWrrH,IAAE4a,EAAG5e,QAAQ8D,KAAK,aAC7B4nH,EAAO,GAAAljH,OAAM8F,uBAAN,4BACP8iB,EAAS,CAAEg+F,SAAUA,GACzBprH,IAAE/C,IAAIyqH,EAASt6F,EAAQ,SAAAl1B,GACnB8qH,EAAgB9qH,EAAK2qH,WAAW5jH,GAChC,IAAIwlH,EAAS,gBAAAjgH,OAAmB6mH,EAASvjG,QAAQ,KAAM,OAAOA,QAAQ,MAAO,OAAhE,OAAAtjB,OACTtM,EAAK2qH,WAAW5jH,IAEpBR,IAASgpG,QAAQpsD,SAASopE,EAAW,CACjC9iH,SAAS,EACTmmB,SAAS,QAIrB9nB,IAAE,kBAAkBG,GAAG,QAAS,SAAAya,GAC5B,IAAIkmB,EAAO9gC,IAAE4a,EAAG5e,QACZovH,EAAWtqF,EAAKhhC,KAAK,gBACrBurH,EAAWvqF,EAAKhhC,KAAK,aACrB4nH,EAAO,GAAAljH,OAAM8F,uBAAN,4BACP8iB,EAAS,CAAEg+F,SAAUA,GACzBprH,IAAE/C,IAAIyqH,EAASt6F,EAAQ,SAAAl1B,GACnB8qH,EAAgB9qH,EAAK2qH,WAAW5jH,GAChCmuB,EAAS,CACLk1F,cAAe+I,EACfrI,cAAeA,GAEnBhjH,IAAE/C,IAAIyqH,EAASt6F,EAAQ,SAAAl1B,GACnB,IACImuH,EADaxtH,OAAO+nC,KAAK1oC,EAAK2qH,WAAWtW,UACV,GAC/B+Z,EAAmBpuH,EAAK2qH,WAAWtW,SAAS8Z,GAChDC,EAAiBhE,cAAgB+I,EACjCvH,GAAcf,WAAWuD,GACzBxlF,EAAKj0B,eAIjB7M,IAAE,kBAAkBG,GAAG,QAASrB,KAAKwsH,gBAGzCH,kBAAmB3nH,IAAE+N,SACjB,CACI,yEACA,kIACA,SACA,0BACA,2HACA,WACA,4GACA,iCACA,OACA,wCACA,uCACA,mCACA,mCACA,oCACA,sCACA,QACA,WACA,UACA,+CACA,OACA,0BACA,8BACA,2DACA,8CACA,YACA,QACA,QACA,0BACA,8BACA,uDACA,8CACA,YACA,QACA,QACA,0DACA,gEACA,2DACA,0BACA,8BACA,8BACA,kRACA,QACA,QACA,QACA,YACA,QACA,UACFjF,KAAK,QCpHXi/G,GAAsB9sH,IAAS08C,OAAOz8C,OAAO,CAC7CC,WAAY,WACRG,KAAKq/G,UAAY,EAEjB1/G,IAASgpG,QAAQtnG,GACb,QACA,WACIrB,KAAKq/G,aAETr/G,MAEJA,KAAKlB,KAAK,QAASkB,KAAKs/G,gBAG5BC,OAAQ,CACJC,GAAI,YACJkN,MAAO,YACPrvG,MAAO,QACP2oE,UAAW,YACX2mC,yBAA0B,SAC1B7mH,OAAQ,SACR8mH,0BAA2B,aAC3BC,yEAA0E,eAC1EC,2CAA4C,cAShDroB,KAAM,WACEzkG,KAAKq/G,UAAY,EACjB//G,OAAOqpG,QAAQlE,OAEfzkG,KAAKu8C,SAAS,IAAK,CAAE15C,SAAS,EAAMmmB,SAAS,OA0D1C+jG,GAAA,CACXv6B,UAtDyB7yF,IAASD,KAAKE,OAAO,CAC9CotH,WAAY,CACRC,YAAa,CAAC,YAAa,QAAS,SAAU,aAAc,eAAgB,eAGhFptH,WAAY,WACR,IAAIyP,EAASC,cAEbD,EAAO49G,iBAAmBltH,KAC1BA,KAAKmtH,sBAAwB,IAAIV,GAEjCzsH,KAAKmtH,sBAAsB9rH,GAAG,cAAe,WACzCiO,EAAO49G,iBAAiBE,mBAAqB,IAAIC,GAAmBlC,gBAExEnrH,KAAKmtH,sBAAsB9rH,GAAG,kBAAmB,WAC7CiO,EAAO49G,iBAAiBI,kBAAoB,IAAIC,GAAmB3I,eAEvE5kH,KAAKmtH,sBAAsB9rH,GAAG,mBAAoB,SAAA8jH,GAC9C71G,EAAO49G,iBAAiBM,wBAA0B,IAAIC,GAAoBvI,aAAa,CACnFC,UAAWA,EAAUn8F,QAAQ,MAAO,WAG5ChpB,KAAKmtH,sBAAsB9rH,GACvB,qBACA,SAAC8jH,EAAWU,GAAiE,IAApD37D,EAAoDrqC,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAAzC,OAAQolB,EAAiCplB,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAA1B,EAAGohF,EAAuBphF,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAAV,MAC/DvQ,EAAO49G,iBAAiBQ,sBAAwB,IAAIC,GAAsBhL,SAAS,CAC/EwC,UAAWA,EAAUn8F,QAAQ,MAAO,OACpC68F,YAAaA,EACb5gF,KAAMA,EACNg8D,WAAYA,EACZ/2C,SAAUA,MAItBlqD,KAAKmtH,sBAAsB9rH,GAAG,mBAAoB,SAAC8jH,EAAWjB,GAC1D50G,EAAO49G,iBAAiBU,oBAAsB,IAAIC,GAAoB5G,YAAY,CAC9E9B,UAAWA,EAAUn8F,QAAQ,MAAO,OACpCk7F,cAAeA,MAGvBlkH,KAAKmtH,sBAAsB9rH,GAAG,eAAgB,SAAA4gH,GAC1C3yG,EAAO49G,iBAAiBY,oBAAsB,IAAIC,GAAqB7K,WAAW,CAC9EjB,aAAcA,EAAavhH,MAAM,SAGzCV,KAAKmtH,sBAAsB9rH,GAAG,kBAAmB,WAC7CiO,EAAO49G,iBAAiBc,mBAAqB,IAAIC,GAAmBngE,YAGxEnuD,IAASgpG,QAAQtwD,MAAM,CAAEgpE,WAAW,iBCzF5C,IAAM6M,GCPC,WAA0C,IAArBC,EAAqBtuG,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAAJ,GACrCogB,EAAUlmC,OAAOwyD,OAAO,GAAI4hE,GAEhC,OAAO,IAAIC,MAAMnuF,EAAS,CACtB9hC,IADsB,SAClBjB,EAAQmxH,GACR,GAAIA,KAAYnxH,EACZ,OAAOA,EAAOmxH,GAEdjvH,QAAQ4hC,KAAK,gCAAiCqtF,MDD9CC,GAShB,IAAIC,GAAYjvH,OAAOivH,UAEnBC,GAAW,CAEXC,aAAc,eACdC,aAAc,eACdC,cAAe,gBACfC,UAAW,YACXC,mBAAoB,qBAGpBC,oBAAqB,eACrBC,oBAAqB,eACrBC,qBAAsB,gBACtBC,iBAAkB,YAClBC,0BAA2B,qBAG3BC,qBAAsB,gBACtBC,qBAAsB,gBACtBC,sBAAuB,iBACvBC,kBAAmB,aACnBC,2BAA4B,uBAIhC,SAASC,GAAcC,GACnB,IAAIC,EACAC,EACAC,EACAC,EACJ,OAAQJ,GACJ,KAAKjB,GAASC,aACViB,EAAgB,UAChBC,EAAc,YACdC,EAAkB,UAClBC,EAAa,UACb,MACJ,KAAKrB,GAASE,aACVgB,EAAgB,UAChBC,EAAc,WACdC,EAAkB,UAClBC,EAAa,4BACb,MACJ,KAAKrB,GAASG,cACVe,EAAgB,WAChBC,EAAc,YACdC,EAAkB,WAClBC,EAAa,iBACb,MACJ,KAAKrB,GAASI,UACVc,EAAgB,OAChBC,EAAc,QACdC,EAAkB,OAClBC,EAAa,OACb,MACJ,KAAKrB,GAASK,mBACVa,EAAgB,gBAChBC,EAAc,iBACdC,EAAkB,gBAClBC,EAAa,gBAKrB,IAAIC,EAAgB,QAAApqH,OAAWiqH,EAAYljG,cAAvB,kBAIpB,MAAO,CACHsjG,SAAUL,EACVM,OAAQL,EACRM,WAAYL,EACZM,OAAQL,EACRM,cARWjC,GAAQkC,iBAAiBpnG,QAAQ,cAAe8mG,IAanE,SAASO,GAAqBT,EAAiBU,EAASvW,GACpD,IAAIwW,EAAWrC,GAAQsC,mBAAmBxnG,QAAQ,kBAAmB4mG,GACrE1uH,IAAEqzB,KAAK,CACHv3B,KAAM,OACNuO,IAAKglH,EACLn3H,KAAM,CAAE+G,GAAImwH,EAASG,WAAY,QACjCtzH,MAAO,WACHooF,MAAK,UAAA7/E,OAAWq0G,EAAX,0BAkYF,SAAS2W,MA5dxB,WAAuC,IAAfC,EAAe9wG,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAAJ,GACxB9lB,OAAOwyD,OAAO2hE,GAASyC,GA4d9BC,CAD4D/wG,UAAAjmB,OAAA,QAAA0D,IAAAuiB,UAAA,GAAAA,UAAA,GAAJ,IAIxD3e,IAAEnF,UAAU80H,UAAU,SAACv1H,EAAGkxB,GAItB,OADAu1D,GAAW,eADGv1D,EAAE64B,cAAgB74B,EAAEskG,YAAc,8BACZ,CAAEC,eAAgBjvC,MAC/C,IAGX5gF,IAAE,uBAAuB8vH,UAAU,CAC/BC,KAAM,SACNC,SAAUhD,GAAQiD,iBAClBC,eAAgBlD,GAAQmD,iBAExBC,QAAO,uFAAA5rH,OACH6oH,GAAUgD,MADP,2FAAA7rH,OAIH6oH,GAAUiD,QAJP9rH,OAKJ6oH,GAAUkD,OALN,kCAMPC,WAAY,CACR,CAAE5zH,KAAM,OAAQiH,MAAO,SAAUG,IAAK,oBACtC,CAAEpH,KAAM,SAAUiH,MAAO,WAAYG,IAAK,sBAC1C,CACIpH,KAAM,cACNiH,MAAOgK,IAAG,eACV7J,IAAK,yBAET,CACIpH,KAAM,YACNiH,MAAOgK,IAAG,aACV7J,IAAK,uBAET,CACIpH,KAAM,oBACNiH,MAAO,eACPG,IAAK,0BAET,CACIpH,KAAM,sBACNiH,MAAO,iBACPG,IAAK,4BAET,CAAEpH,KAAM,SAAUiH,MAAO,SAAUG,IAAK,oBACxC,CAAEpH,KAAM,UAAWiH,MAAO,UAAWG,IAAK,qBAC1C,CAAEpH,KAAM,OAAQiH,MAAO,OAAQG,IAAK,kBACpC,CAAEpH,KAAM,OAAQiH,MAAO,OAAQG,IAAK,kBACpC,CAAEpH,KAAM,aAAciH,MAAO,OAAQG,IAAK,kBAC1C,CAAEpH,KAAM,SAAUiH,MAAO,SAAUG,IAAK,oBACxC,CAAEpH,KAAM,cAAeiH,MAAO,QAASG,IAAK,mBAC5C,CAAEpH,KAAM,cAAeiH,MAAO,QAASG,IAAK,sBAIpD,IAAI4jD,EAAS5nD,IAAEywH,WAAW,GACtBngH,EAAO,SAAA8B,GACPyuE,GAAW,cAAe,YAG1B7gF,IAAEqzB,KAAK,CACHhpB,IAAK2iH,GAAQ0D,SACb50H,KAAM,OACN5D,KAAM,CACF+G,GAAI+tH,GAAQ2D,QACZl9F,QAASm0B,EAAOgpE,QAChBC,YAAa7xG,KAAKC,UAAU,IAE5Bzb,EAAG,QAEP08B,QAAS,WACL9tB,QAKZpS,IAAE,gBAAgB6c,MAAM,WACpBvM,EAAK,WACDswE,SAIR5gF,IAAE,iBAAiB6c,MAAM,WAuBjBze,OAAOvD,SAASqoC,SAAW8pF,GAAQ8D,gBAU3C,IAAIC,EAAkB/wH,IAClB,mIAEJA,IAAE,iBAAiB2C,OAAOouH,GAG1B,IAAIC,EAAQ,GACZhxH,IAAEyD,KAAKmkD,EAAOqpE,SAASC,gBAAiB,SAACz7G,EAAGnV,GACxC,IAAI6wH,EAAU7wH,EAAE1D,KAChBo0H,EAAM1wH,EAAEuD,MAAMikB,QAAQ,IAAK,MAAQ,WAC/B8/B,EAAO3iC,UAAUksG,MAGzB3vD,aAAeuvD,EAAiBC,GAOhC,IAAII,EAA0BpxH,IAC1B,+GACFkB,SAAS,6BACXlB,IAAE,iBAAiB2C,OAAOyuH,GAG1B5vD,aAAe4vD,EAAyB,CACpCC,sBAAuB,WACnBzpE,EAAO24B,OAAO+sC,GAASM,sBAE3B0D,sBAAuB,WACnB1pE,EAAO24B,OAAO+sC,GAASO,sBAE3B0D,uBAAwB,WACpB3pE,EAAO24B,OAAO+sC,GAASQ,uBAE3B0D,mBAAoB,WAChB5pE,EAAO24B,OAAO+sC,GAASS,mBAE3B0D,4BAA6B,WACzB7pE,EAAO24B,OAAO+sC,GAASU,8BAS/B,IAAI0D,EAAsB1xH,IACtB,uGACFkB,SAAS,6BACXlB,IAAE,iBAAiB2C,OAAO+uH,GAG1BlwD,aAAekwD,EAAqB,CAChCC,gBAAiB,WACb/pE,EAAO24B,OAAO+sC,GAASW,uBAE3B2D,gBAAiB,WACbhqE,EAAO24B,OAAO+sC,GAASY,uBAE3B2D,iBAAkB,WACdjqE,EAAO24B,OAAO+sC,GAASa,wBAE3B2D,sBAAuB,WACnBlqE,EAAO24B,OAAO+sC,GAASe,+BAljBnChB,GAAUzlE,OAAO9uD,UAAUynF,OAAS,SAASwxC,EAAYC,EAAgBC,GACrE,IA+BQC,EAEAC,EAjCJC,EAAMtzH,KACNuzH,EAASD,EAAIE,cACb7tH,EAAW2tH,EAAI3tH,WAoBfstH,GAAc1E,GAAUkF,cACpB9tH,IACAzE,IAAEoyH,EAAInB,SAASuB,cAAcpyH,IAAIJ,IAAEyE,GAAU3E,KAAKutH,GAAUoF,OAC5DzyH,IAAEoyH,EAAInB,SAASyB,aAAatyH,IAAIJ,IAAEyE,GAAU3E,KAAKutH,GAAUsF,MAC3D3yH,IAAEoyH,EAAInB,SAAS2B,eAAexyH,IAAIJ,IAAEyE,GAAU3E,KAAKutH,GAAUwF,QAC7D7yH,IAAEoyH,EAAInB,SAAS6B,aAAa1yH,IAAIJ,IAAEyE,GAAU3E,KAAKutH,GAAU0F,OAO3DtuH,IAEcrI,OADd81H,EAASlyH,IAAEyE,GAAU3E,KAAK,WACDoyH,EAAS,IAElB91H,OADhB+1H,EAAWnyH,IAAEyE,GAAU3E,KAAK,YACDqyH,EAAW,KAE1CtxC,GACI,cADM,iNAAAr8E,OAE2M0tH,EAF3M,iGAAA1tH,OAEiT2tH,EAFjT,6BAGN,CACIa,YAAa,WAET,IAAIC,EAAOjzH,IAAEoyH,EAAInB,SAASuB,cAAcpyH,OAAS,GAE7C8yH,EAAMlzH,IAAE,WAAWI,OAAS,GAC5B+yH,EAAQnzH,IAAEoyH,EAAInB,SAAS2B,eAAexyH,OAAS,GAEnD,GAAI6yH,GAAQC,EAAK,CAEbd,EAAIgB,MAAM/F,GAAUgG,YAAahB,GAGjC,IAAInwD,EAAOliE,IAAC,UAAAwE,OAAW6tH,EAAX,KAAsBD,EAAIkB,KAAKn1F,MAC3C+jC,EAAKpiE,KAAKutH,GAAUoF,KAAMQ,GACrBnzH,KAAKutH,GAAUwF,MAAOM,GACtBrzH,KAAK,KAAMozH,GAGoB,IAAhChxD,EAAKv9D,OAAOnE,QAAQ,SACpB0hE,EAAKv9D,KAAKwuH,GAGlBvyC,MAEJ7kC,OAAQ,WACJ6kC,OAGR,GAnER,WAEI5gF,IAAE,gBAAgB6c,MAAM,WAEpB7c,IAAE,yBAAyB2E,KAAK,WAGhC,IAAI4uH,EAAkBvzH,IAAE,aACxBuzH,EAAgBryH,SAAS,UAAUE,YAAY,YAC3CqD,GAAU8uH,EAAgBnzH,IAAIJ,IAAEyE,GAAU3E,KAAK,OAGnDE,IAAElB,MAAM+N,cA6DhB,GAAIklH,GAAc1E,GAAUmG,aA2CxB,OA1CIpB,EAAIqB,kBACJzzH,IAAC,GAAAwE,OAAI4tH,EAAInB,SAASyC,oBAAjB,KAAAlvH,OAAwC4tH,EAAInB,SAASyB,cAAetyH,IACjEJ,IAAEoyH,EAAIqB,iBAAiB3zH,KAAKutH,GAAUsF,MAE1C3yH,IAAC,GAAAwE,OAAI4tH,EAAInB,SAASyC,oBAAjB,KAAAlvH,OAAwC4tH,EAAInB,SAAS2B,gBAAiBxyH,IACnEJ,IAAEoyH,EAAIqB,iBAAiB3zH,KAAKutH,GAAUwF,QAE1C7yH,IAAC,GAAAwE,OAAI4tH,EAAInB,SAASyC,oBAAjB,KAAAlvH,OAAwC4tH,EAAInB,SAAS6B,cAAe1yH,IACjEJ,IAAEoyH,EAAIqB,iBAAiB3zH,KAAKutH,GAAU0F,YAG9ClyC,GACI,QACA,2TAYA,CACI8yC,OAAQ,WACJ,IAAIV,EAAOjzH,IAAEoyH,EAAInB,SAASyB,aAAatyH,MACnC6yH,EAAKv6H,OAAS,IACd05H,EAAIgB,MAAM/F,GAAUuG,aAAcvB,GAClCryH,IAAC,YAAAwE,OAAa6tH,EAAb,KAAwBD,EAAIkB,KAAKn1F,MAC7Br+B,KAAKutH,GAAUsF,IAAKM,GACpBnzH,KAAKutH,GAAUwF,MAAO7yH,IAAEoyH,EAAInB,SAAS2B,eAAexyH,OACpDN,KAAKutH,GAAU0F,IAAK/yH,IAAEoyH,EAAInB,SAAS6B,aAAa1yH,QAEzDwgF,MAEJ7kC,OAAQ,WACJ6kC,QAoEhB,GA5DImxC,GAAc1E,GAAUwG,cACxBhzC,GACI,QACA,+bAgBA,CACI8yC,OAAQ,WACJ,IAAIG,EAAQ9zH,IAAEoyH,EAAInB,SAAS8C,cAAc3zH,MACrC4zH,EAAQh0H,IAAEoyH,EAAInB,SAASgD,cAAc7zH,MAEzC,GAAI0zH,EAAQ,GAAKE,EAAQ,EAAG,CACxB,IAAIE,EAAQ9B,EAAIkB,KAAKx4H,cAAcuyH,GAAU8G,OACzCC,EAAS,KAETC,EAAWr0H,IAAEoyH,EAAInB,SAASqD,iBAAiBl0H,MAG9B8zH,EAAMK,gBACZjsE,UAAY+rE,EAGvB,IAAK,IAAI/oG,EAAI,EAAGA,EAAIwoG,EAAOxoG,IAAK,CAC5B8oG,EAASF,EAAMM,UAAUlpG,GACzB,IAAK,IAAIE,EAAI,EAAGA,EAAIwoG,EAAOxoG,IACvB4oG,EAAOK,WAAWjpG,GAK1BxrB,IAAEk0H,GAAOp0H,KAAK,UAAWE,IAAEoyH,EAAInB,SAASyD,iBAAiBt0H,OAGzD,IAAI8mE,EAAOlnE,IAAEoyH,EAAIuC,OAAOvC,EAAIntG,YAAaooG,GAAUuH,kBAAkB33H,IAAI,GACpEiqE,GAASA,EAAK7qB,WACdr8C,IAAEknE,GAAMlnD,MAAMk0G,GADYl0H,IAAEoyH,EAAIkB,KAAKn1F,MAAMx7B,OAAOuxH,GAG3DtzC,MAEJ7kC,OAAQ,WACJ6kC,QAQZmxC,GAAczE,GAASM,qBACvBmE,GAAczE,GAASO,qBACvBkE,GAAczE,GAASQ,sBACvBiE,GAAczE,GAASS,kBACvBgE,GAAczE,GAASU,0BACzB,CAEE,IAAI6G,EACJ,OAAQ9C,GACJ,KAAKzE,GAASM,oBACViH,EAAYvG,GAAchB,GAASC,cACnC,MACJ,KAAKD,GAASO,oBACVgH,EAAYvG,GAAchB,GAASE,cACnC,MACJ,KAAKF,GAASQ,qBACV+G,EAAYvG,GAAchB,GAASG,eACnC,MACJ,KAAKH,GAASS,iBACV8G,EAAYvG,GAAchB,GAASI,WACnC,MACJ,KAAKJ,GAASU,0BACV6G,EAAYvG,GAAchB,GAASK,oBAI3C,IAAImH,EAAO,IAAIp5E,KAAS,CACpBC,SAAUk5E,EAAU5F,cACpBtiF,UAAU,IAEVv+B,EAASC,cACbD,EAAO8vB,MAAMj9B,KAAK,CACd4C,MAAK,kBAAAW,OAAoBqwH,EAAUhG,UACnC1wF,KAAMn+B,IAAE,UACH2C,OAAOmyH,EAAKj1H,KACZ8C,OACG3C,IAAE,UACG2C,OAAO,yDACPA,OAFL,qBAAA6B,OAG6BqwH,EAAU/F,OAAOvjG,cAH9C,sDAMR8S,gBAAgB,EAChB+I,QAAS,CACLusF,OAAQ,WAEJ,IAAIoB,GAAkB,EACqB,MAAvC/0H,IAAE,4BAA4BI,QAAe20H,GAAkB,GAGnED,EAAK90H,EAAE,0BAA0ByD,KAAK,WAClC,IAAI2rH,EAAUpvH,IAAElB,MAAMsB,MAGlB20H,GAAiB5F,GAAqB0F,EAAU9F,WAAYK,EAASyF,EAAUhG,UAGnF,IACIQ,GADerC,GAAQgI,sBAAwB5F,GACvBtnG,QAAQ,kBAAmB+sG,EAAU9F,YACjE/uH,IAAEwhC,QAAQ6tF,EAAU,SAAA4F,GAEhB7C,EAAIgB,MAAM/F,GAAUgG,YAAahB,GACjC,IAAI6C,EAAYl1H,IAAC,UAAAwE,OAAW6tH,EAAX,KAAsBD,EAAIkB,KAAKn1F,MAAMx5B,OAIrC,IAAbuwH,GACAA,GAAa7C,EAGbD,EAAI78B,OAAJ,YAAA/wF,OACgBywH,EAAmB/yD,KADnC,MAAA19D,OAC4CqwH,EAAUhG,SADtD,MAAArqH,OAEQywH,EAAmBr4H,KAF3B,UAOAoD,IAAC,UAAAwE,OAAW6tH,EAAX,KAAsBD,EAAIkB,KAAKn1F,MAC3Br+B,KAAKutH,GAAUoF,KAAMwC,EAAmB/yD,MACxCpiE,KAAKutH,GAAUwF,MAAOgC,EAAUhG,SAAWO,OAI5DhhH,EAAO8vB,MAAM/8B,QAEjBkmC,MAAO,WACHj5B,EAAO8vB,MAAM/8B,WAM7B,GACI4wH,GAAczE,GAASW,sBACvB8D,GAAczE,GAASY,sBACvB6D,GAAczE,GAASa,uBACvB4D,GAAczE,GAASc,mBACvB2D,GAAczE,GAASe,2BACzB,CAEE,IAAIwG,EACJ,OAAQ9C,GACJ,KAAKzE,GAASW,qBACV4G,EAAYvG,GAAchB,GAASC,cACnC,MACJ,KAAKD,GAASY,qBACV2G,EAAYvG,GAAchB,GAASE,cACnC,MACJ,KAAKF,GAASa,sBACV0G,EAAYvG,GAAchB,GAASG,eACnC,MACJ,KAAKH,GAASc,kBACVyG,EAAYvG,GAAchB,GAASI,WACnC,MACJ,KAAKJ,GAASe,2BACVwG,EAAYvG,GAAchB,GAASK,oBAI3C,IAAImH,EAAO,IAAIp5E,KAAS,CACpBC,SAAUk5E,EAAU5F,cACpBtiF,UAAU,IAEVv+B,EAASC,cACbD,EAAO8vB,MAAMj9B,KAAK,CACd4C,MAAK,kBAAAW,OAAoBqwH,EAAUhG,UACnC1wF,KAAMn+B,IAAE,UACH2C,OAAOmyH,EAAKj1H,KACZ8C,OACG3C,IAAE,UACG2C,OAAO,yDACPA,OAFL,qBAAA6B,OAG6BqwH,EAAU/F,OAAOvjG,cAH9C,sDAMR8S,gBAAgB,EAChB+I,QAAS,CACL+tF,MAAO,WAEH,IAAIJ,GAAkB,EACqB,MAAvC/0H,IAAE,4BAA4BI,QAAe20H,GAAkB,GAEnED,EAAK90H,EAAE,0BAA0ByD,KAAK,WAClC,IAAI2xH,EAAMp1H,IAAElB,MAERswH,EAAUgG,EAAIh1H,MAEdi1H,EAAYD,EACXhwH,QAAQ,MACRgX,KAAK,MACLjW,KAAK,SACLxB,OAEDowH,GAAiB5F,GAAqB0F,EAAU9F,WAAYK,EAASyF,EAAUhG,UAKnF,IACIyG,EAAkB,CAClB,YAFW,GAAA9wH,OAAMqwH,EAAU7F,OAAhB,KAAAxqH,OAA0B4qH,GAIrC,0BACAyF,EAAUhG,SAAStjG,cACnB,iBACA,oBACA,mBACAspG,EAAUhG,SACV,KACAwG,EACA,IACA,OACA,sBACA,sEACAR,EAAUhG,SAAStjG,cACnB,0BACA,OACA,UACFjf,KAAK,IAGP8lH,EAAI78B,OAAO+/B,KAEflnH,EAAO8vB,MAAM/8B,QAEjBkmC,MAAO,WACHj5B,EAAO8vB,MAAM/8B,iFEhd7Bo0H,WAAoB92H,IAASD,KAAKE,OAAOgoB,KAAQvV,eAAezS,OAAO,CACvE0S,cAPe,UASf1J,QAAS,MACT2J,UAAW,gDACXpS,GAAI,WACA,OAAKH,KAAKC,MAGV,kBAAAyF,OAAyB1F,KAAKC,MAAM9B,IAAI,OAF7B,IAOf0B,WAAY,SAAoBC,GAC5BA,EAAUA,GAAW,GACrBE,KAAK02H,cAAgBhyH,IAAE4S,YAAYxX,EAAQ42H,eAAgB52H,EAAQ42H,aACnE12H,KAAKod,MAAQtd,EAAQsd,OAASpd,KAAK22H,YAAY72H,GAE/CE,KAAK42H,kBAITD,YAAa,SAAqBE,GAC9B,OAAO,IAAIC,KAAkBC,gBACzBryH,IAAEmM,SAASgmH,EAAc,CACrB52H,MAAOD,KAAKC,MAEZy2H,aAAc12H,KAAK02H,aACnBp8G,WAAW,EACXG,iBAAkB,WACd,OAAOza,KAAKe,SAO5B61H,eAAgB,WAA0B,IAAAjtH,EAAA3J,KAEtCA,KAAKkb,KAAK,WAAY,WAClBvR,EAAK9G,QAAQ,mBAAoB8G,KAErC3J,KAAKg3H,uBAITA,oBAAqB,WAA+B,IAAAppH,EAAA5N,KAChDA,KAAKiC,SACDjC,KAAKod,MACL,CAII65G,SAAU,WACNrpH,EAAK/K,QAAQ,WAAY+K,IAK7BspH,8BAA+B,SAASrjH,GACpCA,EAAK3S,EAAE,cAAcyR,QAG7B3S,OAKRm3H,OAAQ,SAASC,EAAUC,GACvB,IAAIC,EAAat3H,KAAKe,IAAIoX,SAASqe,KAEnC,QADkB8gG,EAAat3H,KAAKe,IAAIu+B,QACtB83F,MAGdE,EAAaD,IAOrBE,OAAQ,WACJ,OAAOv3H,KAAKkB,EAAE,mBAKlBgB,OAAQ,SAAgBmR,GACpBA,OAAkB/V,IAAV+V,EAAsBA,EAAQ,OAGtC,IAAImkH,EAAYx3H,KAAKC,MAAQD,KAAKC,MAAMiV,SAAW,GAUnD,OATAlV,KAAKe,IAAIgF,KAAK/F,KAAKyS,SAAS+kH,IAC5Bx3H,KAAKy3H,YAAYpkH,GAEjBrT,KAAKod,MAAMrc,IAAImE,IAAI,UAAW,QAI9BlF,KAAK03H,iBAEE13H,MAIX03H,eAAgB,aAMhBjlH,SAAU,SAAkBrZ,GAIxB,OAHAA,EAAOsL,IAAE9E,OAAOxG,GAAQ,GAAI,CACxBu+H,iBAAkB33H,KAAK43H,iBAEpB12H,IAAC,yKAAAwE,OAGM1F,KAAK63H,qBAAqB,CAAElvB,QAASvvG,EAAMya,KAAM7T,OAHvD,0BAAA0F,OAIM1F,KAAK83H,sBAAsB,CAAEnvB,QAASvvG,EAAMya,KAAM7T,OAJxD,mJAAA0F,OAQmBtM,EAAK+G,GARxB,mFAaZs3H,YAAa,SAAqBpkH,GAM9B,OALAA,OAAkB/V,IAAV+V,EAAsBA,EAAQ,OACtCrT,KAAKod,MAAMvc,WAAWb,KAAKu3H,UAAUr1H,OAAOmR,GACxCrT,KAAK43H,gBACL53H,KAAKod,MAAMhO,QAAQuuB,OAAO39B,KAAKod,MAAM26G,yBAElC/3H,MAKX6I,OAAQ,CAEJmvH,uBAAwB,WACpBh4H,KAAKC,MAAMg4H,gBAGfC,wBAAyB,WAAW,IAAApxF,EAAA9mC,KAChCA,KAAKC,MAAMk4H,UAAUnqH,KAAK,SAAA5U,GACtB0tC,EAAK5kC,YAGbk2H,0BAA2B,WAAW,IAAA1nD,EAAA1wE,KAClCA,KAAKC,MAAMo4H,WAAWrqH,KAAK,SAAA5U,GACvBs3E,EAAKxuE,YAGbo2H,uBAAwB,WAAW,IAAAhhB,EAAAt3G,KAC3BV,OAAOkkE,QAAQz0D,IAAG,0DAClB/O,KAAKC,MAAMs4H,QAAQvqH,KAAK,SAAA5U,GACpBk+G,EAAKp1G,YAKjBs2H,sBAAuB,QAK3B/hF,KAAM,WACFgiF,aAAkBz4H,KAAKC,QAK3B43H,qBAAsBnzH,IAAE+N,SAAF,wKAAA/M,OAKJqJ,IAAG,mBALC,+IAAArJ,OASJqJ,IAAG,aATC,oEAalB,CAAE2pH,SAAU,SAIhBZ,sBAAuBpzH,IAAE+N,SAAF,ojBAAA/M,OAUOqJ,IAAG,QAVV,oKAAArJ,OAaOqJ,IAAG,UAbV,kOAAArJ,OAiBOqJ,IAAG,YAjBV,iQAAArJ,OAsBOqJ,IAAG,SAtBV,oKA6BnB,CAAE2pH,SAAU,SAKhB/rH,SAAU,WACN,2BAAAjH,OAA4B1F,KAAKod,MAAQpd,KAAKod,MAAQ,GAAtD,SA40BOu7G,GAAA,CACXC,kBAt0BoBj5H,IAASD,KAAKE,OAAOgoB,KAAQvV,eAAezS,OAAO,CACvE0S,cAjPe,UAmPfC,UAAW,sBAIX1S,WAAY,SAAoBC,GAC5BA,EAAUA,GAAW,GACrBE,KAAKka,IAAL,GAAAxU,OAAY1F,KAAZ,SAAyBF,GAGzBE,KAAKe,IAAIqB,SAASpC,KAAKuS,WAIvBvS,KAAKF,QAAU,CACX+4H,YAAa,IACbC,YAAa,EACbC,UAAW,EACXC,aAAc,GACdC,aAAc,EACdC,eAAgB,IAIpBl5H,KAAKm5H,QAAUr5H,EAAQq5H,SAAW,GAGlCn5H,KAAKo5H,SAAW,IAAIC,KAAUC,eAAe,IAAI,GAIjDt5H,KAAK+Y,WAAa,KAElB/Y,KAAKu5H,UAAY,GAEjBv5H,KAAKw5H,cAAgB15H,EAAQ05H,eAAiB,GAG9Cx5H,KAAKy5H,cAAgB,KAErBz5H,KAAK05H,cAAgB,KAErB15H,KAAK25H,cAAc75H,EAAQ6lG,WAC3B3lG,KAAK42H,kBAITA,eAAgB,WAA0B,IAAAnf,EAAAz3G,KAEtCA,KAAKqB,GAAG,gBAAiB,WACrBo2G,EAAK1+F,WAAWD,eAQxB6gH,cAAe,SAAuB5gH,GAWlC,OATA/Y,KAAKqb,cAAcrb,KAAK+Y,YAExB/Y,KAAK+Y,WAAaA,GAAc,IAAI6gH,KACpC55H,KAAK65H,2BAEL75H,KAAK85H,gBACL95H,KAAKo5H,SAASzhG,QAEd33B,KAAK6C,QAAQ,iBAAkB7C,MACxBA,MAMX+5H,UAAW,SAAmB5sH,EAAQ4L,EAAYjZ,GAAS,IAAA63G,EAAA33G,KAQvD,OANAF,EAAUA,GAAW,IACrBqN,EAASzI,IAAEW,QAAQ8H,GAAUA,EAAS,CAACA,IAChCmS,QAAQ,SAAArf,GACX03G,EAAKqiB,UAAU/5H,GAAO,KAGnBD,MAIX65H,yBAA0B,WACtB75H,KAAKiC,SAASjC,KAAK+Y,WAAY,CAE3B5b,MAAO6C,KAAKi6H,aAEZntH,IAAK9M,KAAK+5H,UAEVG,cAAel6H,KAAKm6H,cAEpBC,cAAep6H,KAAKq6H,mBAEpBC,iBAAkBt6H,KAAKu6H,kBAEvBC,+BAAgCx6H,KAAKy6H,qBAErC1kH,KAAM,WACF/V,KAAK06H,cAAc,OAK/BP,cAAe,SAASQ,GAMpB,GAJA36H,KAAKkB,EAAE,gCAAgC6M,UAIlC/N,KAAKy5H,cAAe,CACrB,IAAIh/G,EAAmBza,KAAKkB,EAAE,iBAC9BuZ,EAAiByoD,WAAWzoD,EAAiByoD,aAAe,MAKpEq3D,kBAAmB,SAA2B5xB,GAC1C3oG,KAAKka,IAAI,qBAAsByuF,GAC/B,IAAIiyB,EAAmBl2H,IAAEs3E,UAAUh8E,KAAKu5H,UAAW,CAC/C3B,gBAAgB,IAEhBgD,IACAA,EAAiBhD,gBAAiB,EAClCgD,EAAiB75H,IAAI27B,OAAO,KAGhC,IAAIm+F,EAAmB76H,KAAKu5H,UAAUv5H,KAAK+Y,WAAW+hH,kBAItD,OAHAD,EAAiBjD,gBAAiB,EAClC53H,KAAK+Y,WAAWhD,OAChB/V,KAAK+6H,2BACEF,GAMXJ,qBAAsB,SAA8B9xB,GAChD,GAAIA,EAAQxqG,IAAI,YAAcwqG,EAAQxqG,IAAI,UAAW,CACjD6B,KAAKka,IAAI,uBAAwBla,KAAK+Y,WAAW5H,eAAgBw3F,GACjE,IAAIqyB,EAASh7H,KAAKu5H,UAAU5wB,EAAQxoG,IACpC,IAAK66H,EACD,OAIAA,EAAO/6H,MAAME,KAAOH,KAAK+Y,WAAW+hH,kBAM5B96H,KAAK+Y,WAAW5H,gBACxBnR,KAAKi7H,aAAaD,KAa9Bf,aAAc,SAASh6H,EAAO0a,EAAK7a,GAE/B,IAAI6a,GAAsB,IAAfA,EAAI7U,QAAmC,IAAnB6U,EAAIia,WAAnC,CASA,GAHA50B,KAAK7C,MAAM8C,EAAO0a,EAAK7a,GAGnB4E,IAAEw2H,SAASj7H,IAAUyE,IAAEw2H,SAASvgH,GAAM,CACtC,IAAI7X,EAAU7C,EACV8E,EAAQ4V,EACZ,OAAOwgH,KAAYC,WAAWt4H,EAASiC,EAAOjF,GAIlD,OAAI6a,GAAsB,MAAfA,EAAI7U,OACJq1H,KAAYE,uBAEhBF,KAAYG,eAAer7H,EAAO0a,EAAK7a,KAIlDy7H,kBAAmB,WACfJ,KAAYG,eAAe/gI,MAAM,KAAMmK,IAAEw5B,QAAQre,aAIrDjhB,OAAQ,SAASkd,GACb,OAAO9b,KAAK+Y,WAAWna,OAAO,CAAEw+C,SAAS,KAK7C08E,cAAe,SAAuB3sH,EAAQqsH,GAAe,IAAAjgB,EAAAv5G,KACzDw5H,EAAgBA,GAAiBx5H,KAAKF,QAAQ05H,cAG9Cx5H,KAAKu5H,UAAY,GACjBv5H,KAAK+Y,WAAWpU,KAAK,SAAC1E,EAAOvG,GACzB6/G,EAAKggB,UAAUt5H,EAAME,IAAMo5G,EAAKiiB,aAAav7H,EAAOu5H,MAK5DgC,aAAc,SAAsB7yB,EAAS7oG,GACzC,IAAIwP,EAASC,cAEbzP,EAAU4E,IAAE9E,OAAO,GAAIE,EAAS,CAC5BG,MAAO0oG,EACP+tB,aAAcpnH,EAAO2zB,OAAOw4F,2BAEhC,IAAIT,EAAS,IAAIvE,GAAkB32H,GASnC,OARI6oG,EAAQxoG,KAAOH,KAAK+Y,WAAW+hH,mBAC/BE,EAAOpD,gBAAiB,GAE5B53H,KAAK07H,qBAAqBV,GACtBh7H,KAAK05H,gBACLsB,EAAO59G,MAAM6E,YAAYjiB,KAAK05H,eAC9B15H,KAAK27H,qBAAqBX,IAEvBA,GAIXhB,UAAW,SAAarxB,EAASzmG,GAC7BA,OAAoB5E,IAAX4E,GAAuBA,EAChC,IAAI05H,EAAY57H,KAAKw7H,aAAa7yB,GAKlC,OAJA3oG,KAAKu5H,UAAU5wB,EAAQxoG,IAAMy7H,EACzB15H,GACAlC,KAAK06H,gBAEFkB,GAIXvB,mBAAoB,SAAa1xB,EAAS5vF,EAAYjZ,GAAS,IAAAu6G,EAAAr6G,KACvD47H,EAAY57H,KAAKg6H,UAAUrxB,GAAS,GAKxC,OAJA3oG,KAAKu6H,kBAAkB5xB,GACvBizB,EAAU1gH,KAAK,WAAY,WACvBm/F,EAAKwhB,cAAcD,KAEhBA,GAIXX,aAAc,SAAgBD,EAAQ94H,GAAQ,IAAAs4G,EAAAx6G,KAG1C,GAFAkC,OAAoB5E,IAAX4E,GAAuBA,EAChClC,KAAKka,IAAI,eAAgB8gH,GACpBA,EAAL,CAGA,IAAIc,EAAgB97H,KAAKF,QAAQ+4H,YAAc74H,KAAKF,QAAQi5H,UAC5DiC,EAAOj6H,IAAIwc,QAAQ,OAAQ,WACnBrb,IACAhB,IAAEs5G,GAAMzsG,SACRysG,EAAKt5G,EAAE,WAAWo+B,MAAMk7E,EAAKt5G,EAAE,WAAWo+B,QAAUw8F,GACpDthB,EAAKuhB,qBACLvhB,EAAKugB,4BAITvgB,EAAKn/F,cAAc2/G,EAAO59G,OAC1Bo9F,EAAKn/F,cAAc2/G,UACZxgB,EAAK+e,UAAUyB,EAAO/6H,MAAME,IACnC66H,EAAOjtH,aAKf2tH,qBAAsB,SAA8BV,GAAQ,IAAApgB,EAAA56G,KACxDA,KAAKiC,SAAS+4H,EAAQ,CAElBgB,UAAWh8H,KAAK67H,gBAGpB77H,KAAKiC,SAAS+4H,EAAO59G,MAAO,CAGxB6+G,2BAA4B,SAACngH,EAAIjI,EAAMuJ,EAAO49G,GAC1CpgB,EAAKshB,UAAYh8G,KAAK2iB,MAAM/mB,EAAGkE,aAAa8wD,QAAQ,SACpD8pC,EAAKuhB,6BAETC,yBAA0B,SAACtgH,EAAIjI,EAAMuJ,EAAO49G,GACxCpgB,EAAKshB,UAAY,KACjBthB,EAAKyhB,8BAETC,kBAAmB,SAACxgH,EAAI1iB,EAAMgkB,GAE1B,IAAIm/G,EAAS3hB,EAAKshB,UAAU9uH,OAAO,SAAA0S,GAAI,OAAI1C,EAAMnd,MAAM+U,SAASwnH,WAAW18G,KAC3E86F,EAAKshB,UAAY,KAEjB,IAAI7+G,EAAQ,IAAIg8G,KAAUC,eACe,IAArCl8G,EAAMnd,MAAM+U,SAASyC,aACrB4F,EAAMvQ,IAAI,CACNhP,KAAM,mBACNihB,GAAI,WACA,OAAO3B,EAAMnd,MAAM+U,SAASoD,UAAU,MAMlDmkH,EAAOnpG,UAAU9T,QAAQ,SAAAqV,GACrBtX,EAAMvQ,IAAI,CACNhP,KAAI,QAAA4H,OAAUivB,EAAQx0B,IACtB4e,GAAI,WACA,OAAO3B,EAAMnd,MAAM+U,SAASyhC,KAAK9hB,QAI7CtX,EAAMg7B,QACNh7B,EAAMrP,KAAK,SAAAyuH,GACPr/G,EAAMnd,MAAM+M,cAO5B0vH,gBAAiB,WACb,OAAO3iI,OAAO+nC,KAAK9hC,KAAKu5H,WAAW3/H,QAMvC+iI,sBAAuB,SAASxmH,GAE5B,OADAA,EAAUA,GAAWnW,KAAKmW,UACTA,EAAQvc,OAGlBoG,KAAK48H,gBAAgBxvH,OAAO,SAAC4tH,EAAQ5uH,GAExC,OADe4uH,EAAOpD,gBAAkBlzH,IAAEoa,MAAM3I,EAAQ7I,IAAI,SAAAF,GAAM,OAAIA,EAAOlT,KAAK8gI,QAH3Eh7H,KAAK48H,iBASpBA,cAAe,WAAW,IAAA9hB,EAAA96G,KAEtB,OADaA,KAAK+Y,WAAWzL,IAAI,SAACq7F,EAASv8F,GAAV,OAAoB0uG,EAAKye,UAAU5wB,EAAQxoG,OAMhF+B,OAAQ,SAAgBmR,GAYpB,OAXAA,OAAkB/V,IAAV+V,EAAsBA,EAAQrT,KAAK6Z,QAE3C7Z,KAAKka,IAAL,GAAAxU,OAAY1F,KAAZ,YACAA,KAAKe,IAAIgF,KAAK/F,KAAK68H,cACnB78H,KAAK06H,cAAcrnH,GAGnBrT,KAAK03H,iBAGL13H,KAAK6C,QAAQ,WAAY7C,MAClBA,MAIX06H,cAAe,SAAuBrnH,GAClCA,EAAQ3O,IAAEo4H,SAASzpH,GAASA,EAAQrT,KAAK6Z,QAGzC,IAAIkjH,EAAoB/8H,KAAK28H,wBAEzBrnG,EAAUt1B,KAAKkB,EAAE,WAAW0C,QAehC,OAbA5D,KAAKg9H,YAAYD,EAAmB1pH,GAC/BrT,KAAK+Y,WAAWlC,YACjBye,EAAQzxB,OAAO7D,KAAKi9H,0BAGxBj9H,KAAK6C,QAAQ,mBAAoBk6H,EAAmB/8H,QAE/CA,KAAK05H,eAAiBqD,EAAkBnjI,OAAS,KAElDoG,KAAK+7H,qBAEL/7H,KAAK+6H,4BAEFgC,GAGXC,YAAa,SAASE,EAAS7pH,GAC3BA,EAAQ3O,IAAEo4H,SAASzpH,GAASA,EAAQrT,KAAK6Z,QACzC,IAAIyb,EAAUt1B,KAAKkB,EAAE,WAEjBi8H,EAAc7nG,EAAQrhB,SAAS,mBAAmBra,OACtD07B,EAAQgK,MAAMt/B,KAAKo9H,iBAAiBF,EAAQtjI,OAASujI,IAErDD,EAAQ59G,QAAQ,SAAC07G,EAAQthI,GACrBshI,EACKqC,iBACAn7H,OAAOmR,GACPtS,IAAIiiE,SAAS1tC,MAI1B8nG,iBAAkB,SAASE,GAEvB,OACIA,GAAct9H,KAAKF,QAAQ+4H,YAAc74H,KAAKF,QAAQi5H,WAEtD/4H,KAAKF,QAAQi5H,UAJU,IAgB/B8C,cAAe,SAAuBb,GAElC,IAAIhmH,EAAWgmH,EAAO/6H,MAAM+U,SAG5B,GAAwB,IAApBA,EAASpb,QAAgBohI,EAAO/6H,MAAMs9H,gBAAiB,CACvD,IAAIC,EAAe,CAAE5nH,QAAQ,GACzBvI,EAAM3I,IAAEe,OAAOuP,EAASirB,QAAQw9F,eAAejwH,OAC/CH,IACAmwH,EAAa3iH,QAAUxN,GAG3BrN,KAAKo5H,SAAStsH,IAAI,CACdhP,KAAMk9H,EAAO/6H,MAAME,GACnB4e,GAAI,WACA,OAAO/J,EACFsD,iBAAiBklH,GACjBxvH,KAAK,WACFgtH,EAAO59G,MAAM1B,gBAEhB1N,KAAK,WACG0vH,KAAiBzvH,oBAClB+G,EAAS2oH,4BAA4B3wH,aAMpDhN,KAAKo5H,SAAS5sH,SACfxM,KAAKo5H,SAAS/gF,UAM1BsjF,qBAAsB,SAASX,GAC3B,IAAIhmH,EAAWgmH,EAAO/6H,MAAM+U,WACkB,IAApBA,EAASpb,QAAgBohI,EAAO/6H,MAAMs9H,kBACpCvoH,EAAS4oH,gBAEjC59H,KAAKo5H,SAAStsH,IAAI,CACdhP,KAAMk9H,EAAO/6H,MAAME,GACnB4e,GAAI,WACA,OAAO/J,EAAS6oH,4BAA4B7vH,KAAK,WAC7CgtH,EAAO59G,MAAMuB,2BAKpB3e,KAAKo5H,SAAS5sH,SACfxM,KAAKo5H,SAAS/gF,UAM1BylF,WAAY,SAASljH,GACjB,OAAO5a,KAAKkB,EAAE,wBAAwB2E,KAAK+U,IAI/C/R,OAAQ,CAEJk1H,kBAAmB,QAEnBC,wBAAyB,SACzBC,yBAA0B,+BAE1BC,0BAA2B,eAC3BC,wBAAyB,8BACzBC,uBAAwB,8BAI5BpS,MAAO,SAASlwG,GAEZxc,OAAO8kC,SAAW54B,wBAGtB6yH,6BAA8B,SAASviH,GACnC9b,KAAKs+H,uBAAuBp9H,IAAE4a,EAAGiS,eAAerN,GAAG,aACnD1gB,KAAKu+H,wBAGTD,uBAAwB,SAASn8H,GAEzB7C,OAAO8kC,SAAP,GAAA1+B,OAAqB8F,uBADrBrJ,EACA,uDAEA,0BAIRq8H,4BAA6B,SAAS1iH,GAClC9b,KAAKy+H,sBAAsBv9H,IAAE4a,EAAGiS,eAAerN,GAAG,aAClD1gB,KAAKu+H,wBAETE,sBAAuB,SAASt8H,GAC5BA,OAAgB7E,IAAT6E,GAAqBA,EAC5BnC,KAAK28H,wBAAwBr9G,QAAQ,SAAC07G,EAAQthI,GAC1CgL,IAAE27B,MAAM,WACJ26F,EAAO59G,MAAMshH,kBAAkBv8H,GAAM,IAClC,IAAJzI,MAIXilI,2BAA4B,SAAS7iH,GACjC9b,KAAK4+H,qBAAqB19H,IAAE4a,EAAGiS,eAAerN,GAAG,aACjD1gB,KAAKu+H,wBAETK,qBAAsB,SAASz8H,GAC3BA,OAAgB7E,IAAT6E,GAAqBA,EAC5BnC,KAAK28H,wBAAwBr9G,QAAQ,SAAC07G,EAAQthI,GAC1CgL,IAAE27B,MAAM,WACJ26F,EAAO59G,MAAMyhH,iBAAiB18H,GAAM,IACjC,IAAJzI,MAKXolI,aAAc,SAAShjH,GAAI,IAAAo/F,EAAAl7G,KACnB+Y,EAAa/Y,KAAK+Y,WAClBgmH,EAAW79H,IAAE4a,EAAGiS,eAAe30B,KAAK,SAExC4G,KAAKkB,EAAE,kBAAkB2E,KAAK7F,KAAKg/H,kBAAkBD,IACrD/+H,KAAKu+H,uBAELxlH,EAAWrD,SAASqpH,GACpB,IAAIE,EAAsBlmH,EAAWvZ,MAAM,EAAG,GAC9CuZ,EAAWF,aAAa7K,KAAK,WACzB+K,EAAWuL,QAAQ26G,EAAqB,CACpCrpH,QAAQ,IAEZslG,EAAK4e,gBAEL5e,EAAKke,SAASzhG,QACdujF,EAAKh5G,WAETlC,KAAKkb,KAAK,mBAAoBlb,KAAKk/H,cAKvCA,YAAa,SAAS59H,GAClBA,EAAMoD,IAAEo4H,SAASx7H,GAAOA,EAAM,EAC9BtB,KAAKkB,EAAE,iBAAiBgiE,WAAW5hE,IAIvCo2H,eAAgB,WAAW,IAAA/b,EAAA37G,KACvBA,KAAKm/H,sBAGLn/H,KAAKkB,EAAE,qBAAqB0gB,YAAY,CACpC9jB,KAAM,mBACNwK,YAAayG,IAAG,oBAEhB+S,cAAe,SAAA3H,GACXwhG,EAAKz6G,EAAE,qBAAqB0gB,YAAY,kBACxC+5F,EAAKmiB,WAAW/uH,IAAG,qCACnB4sG,EAAK5iG,WAAWG,WAAWlL,KAAK,WAC5B2tG,EAAKz6G,EAAE,qBAAqB0gB,YAAY,kBACxC+5F,EAAKmiB,WAAW,OAGxB97G,SAAU,SAAA7H,GACNwhG,EAAK8d,cAAgBt/G,EACrBwhG,EAAKxlG,QAAU,CACX,WACI,OAAOwlG,EAAK17G,MAAM+e,WAAW28F,EAAK8d,iBAG1C9d,EAAK+e,cAAc,IAEvBx4G,QAAS,SAAA/H,GACLwhG,EAAK8d,cAAgB,KAErB9d,EAAKxlG,QAAU,GACfwlG,EAAK+e,cAAc,MAK3B16H,KAAKkB,EAAE,oBAAoB0gB,YAAY,CACnC9jB,KAAM,kBACNwK,YAAayG,IAAG,uBAEhB+S,cAAe,SAAA3H,GACXwhG,EAAKyd,SAASzhG,QACdgkF,EAAKz6G,EAAE,oBAAoB0gB,YAAY,kBACvC+5F,EAAK+d,cAAgBv/G,EACrBwhG,EAAKghB,wBAAwBr9G,QAAQ,SAAA07G,GACjCA,EAAO59G,MAAM6E,YAAY9H,GAEzBwhG,EAAKggB,qBAAqBX,KAE9Brf,EAAKyd,SAASltB,SAAS,SAAAA,GACnByP,EAAKmiB,WAAW,CAAC/uH,IAAG,aAAcm9F,EAASkzB,KAAO,EAAGrwH,IAAG,MAAOm9F,EAAStE,OAAOp6F,KAAK,QAExFmuG,EAAKyd,SAASl6F,SAASlxB,KAAK,WACxB2tG,EAAKmiB,WAAW,IAChBniB,EAAKz6G,EAAE,oBAAoB0gB,YAAY,qBAG/CI,SAAU,SAAA7H,GACNwhG,EAAK+d,cAAgBv/G,EACrBwhG,EAAKghB,wBAAwBr9G,QAAQ,SAAA07G,GACjCA,EAAO59G,MAAM6E,YAAY9H,MAGjC+H,QAAS,SAAA/H,GACLwhG,EAAK+d,cAAgB,KACrB/d,EAAKghB,wBAAwBr9G,QAAQ,SAAA07G,GACjCA,EAAO59G,MAAM+E,mBAMzBjhB,IAAE5B,QAAQ+oC,OAAO,WACbszE,EAAKof,6BAKT,IAAIsE,EAAkB36H,IAAE46H,SAAS,WAC7B,IAAIzwF,EAAW8sE,EAAK4jB,YACpB5jB,EAAKogB,mBAAmBltF,GACxB8sE,EAAK6jB,oBAAoB3wF,IAC1B,KACH7uC,KAAKkB,EAAE,WACF+c,SACAwpB,OAAO43F,IAIhBF,oBAAqB,WACjB,OAAOn/H,KAAKkB,EAAE,0BAA0Bs2B,QAAQ,CAC5CrR,UAAW,UACXnhB,UAAW,SACXe,MAAM,EACN4uB,QAASzzB,IAAElB,KAAKy/H,uBAAuBz/H,UAK/Cu+H,qBAAsB,SAASziH,GAE3B9b,KAAKkB,EAAE,0BAA0Bs2B,QAAQ,WAI7CujG,yBAA0B,WACtB,IAAI2E,EAAe1/H,KAAKkB,EAAE,mBAAmBkE,QACzCu6H,EAAe3/H,KAAKkB,EAAE,WAAWw7B,SACjCkjG,EAAgBF,EAAar4H,KAAK,mBAAmBq1B,SACzDgjG,EACKhjG,OAAOijG,GACPt4H,KAAK,UACLq1B,OAAOijG,EAAeC,IAI/BL,UAAW,WACP,IAAIM,EAAe7/H,KAAKkB,EAAE,WAAW+c,SACjCm5G,EAAWyI,EAAa1nH,SAASqe,KAErC,MAAO,CACHA,KAAM4gG,EACN78C,MAAO68C,EAHCyI,EAAavgG,UAQ7BwgG,cAAe,SAASjxF,GAGpB,IAAIkxF,EAAKlxF,GAAY7uC,KAAKu/H,YAC1B,OAAOv/H,KAAK28H,wBAAwBvvH,OAAO,SAAA4tH,GAAM,OAAIA,EAAOpD,gBAAkBoD,EAAO7D,OAAO4I,EAAGvpG,KAAMupG,EAAGxlD,UAK5GwhD,mBAAoB,WAEhB/7H,KAAK8/H,gBAAgBxgH,QAAQ,SAAA07G,GACzBA,EAAOn4H,QAAQ,UAAWm4H,MAKlCwE,oBAAqB,SAAS3wF,GAC1BA,EAAWA,GAAY7uC,KAAKu/H,YAC5B,IACIjqG,EAAUt1B,KAAKkB,EAAE,WACHo0B,EAAQrX,SAASilD,aAAer0B,EAAS0rC,OACxCjlD,EAAQgK,QAHT,IAIdt/B,KAAK6C,QAAQ,kBAKrBs5H,0BAA2B,WACvB,IAAI6D,EAAgBhgI,KAAKu5H,UAAUv5H,KAAK+Y,WAAW+hH,kBAC9CkF,IAILA,EAAc5iH,MAAM6iH,YAAc,SAAA7mI,KAClC4mI,EAAc5iH,MAAM8iH,iBAIxB7D,2BAA4B,WACxB,IAAI2D,EAAgBhgI,KAAKu5H,UAAUv5H,KAAK+Y,WAAW+hH,kBAC9CkF,IAGLA,EAAc5iH,MAAM6iH,YAAcnJ,KAAkBC,gBAAgB/8H,UAAUmmI,SAE9EH,EAAc5iH,MAAMgjH,YAAa,EACjCJ,EAAc5iH,MAAMlc,EAAE,wBAAwB6M,WAKlDpB,SAAU,WACN,2BAAAjH,OAA4B1F,KAAKk9H,QAAUl9H,KAAKk9H,QAAQtjI,OAAS,EAAjE,MAIJijI,aAAY,wxBAAAn3H,OAeMqJ,IAAG,cAfT,oRAwBZkuH,yBAAwB,6HAAAv3H,OAGdqJ,IAAG,qBAHW,wBAMxBiwH,kBAAmB,CACfjoH,YAAahI,IAAG,qBAChBmI,kBAAmBnI,IAAG,sBACtBjR,KAAMiR,IAAG,gBACTsxH,WAAYtxH,IAAG,gBACfM,KAAMN,IAAG,wBACTuxH,WAAYvxH,IAAG,yBAGnB0wH,uBAAwB/6H,IAAE+N,SACtB,CACI,gDACA,qCACA,0FAHJ,GAAA/M,OAIOqJ,IAAG,sBAJV,KAKI,6FACA,8BACA,YACA,yCACA,iEACA,uGACA,cACA,YACA,YACA,QACA,SAEA,2EACA,0DACAA,IAAG,6BACH,iBAEA,2EACAA,IAAG,4BACH,iBACA,0EACAA,IAAG,2BACH,iBACA,UACFvB,KAAK,IACP,CAAEkrH,SAAU,qBCtjChB9lH,GAAS2tH,KAAaC,YAgGXC,GAAA,CACXC,qBAxFuB9tH,GAAOhT,OACe,CACzC2S,UAAS,GAAA7M,OAAKkN,GAAO5Y,UAAUuY,UAAtB,4BAITiK,gBAAiB,WAEb,IAAID,EAAa3J,GAAO5Y,UAAUwiB,gBAAgBtiB,KAAK8F,MAEvD,OADAA,KAAK2gI,wBAAwBpkH,GACtBA,GAIXokH,wBAAyB,SAASpkH,GAC9B,IAAI+L,EAAatoB,KAAKC,MAAM9B,IAAI,cAC3BmqB,GAGL/L,EAAWlV,KAAK,yBAAyBxB,KAAKyiB,IAIlD5M,YAAa,SAAS0C,GAClBA,EAAWA,GAAYpe,KAAKe,IAC5B6R,GAAO5Y,UAAU0hB,YAAYxhB,KAAK8F,KAAMoe,GAExC,IAAIpB,EAAYoB,EAAS/W,KAAK,eAU9B,OATA2V,EAAU3V,KAAK,+BAA+B0G,SAE9C7M,IAAE,6CACG2C,OAAO,CACJ3C,IAAE,yCAAyC2E,KAAKkJ,IAAG,YACnD7N,IAAE,yCAAyC2E,KAAKkJ,IAAG,iBAEtDi0D,SAAShmD,GAEPjd,KAAKwa,OAKhB6F,mBAAoB,SAASvM,GACzB,OAAO3S,IAAE,qCAAqC2C,OAAO,CACjDgQ,EAAK3R,OAAO,GAAGnB,IACfG,IAAE,kCAAkC2E,KAAKgO,EAAK5T,MAAM9B,IAAI,eAAiB,OAKjF0K,OAAQnE,IAAE9E,OAAO8E,IAAE4P,MAAM1B,GAAO5Y,UAAU6O,QAAS,CAE/C+3H,4BAA6B,SAAS9kH,GAClCA,EAAGgf,kBACH55B,IAAE4a,EAAGiS,eACA1mB,KAAK,yBACL0W,SAGT8iH,kBAAmB,SAAS/kH,GACxBA,EAAGgf,kBAGH,IAAIgmG,EAAc5/H,IAAE4a,EAAGiS,eACnB+yG,EAAYlnI,QAA8C,aAApCknI,EAAY9/H,KAAK,gBACvC8/H,EAAYC,SAAS,aAKjCC,kBAAmB,SAASllH,GACxB,IAAImlH,EAAgB//H,IAAE4a,EAAGiS,eACpB9P,SACAA,SACA7kB,KAAK,WACV4G,KAAKkhI,YAAYD,IAKrBt0H,SAAU,WACN,8BAAAjH,OAA+B1F,KAAKC,MAAQD,KAAKC,MAAM9B,IAAI,QAAU,GAArE,gEC7FZsT,IAAO0vH,aAAalrH,aAAc,EASlC,IAAI/U,GAAIuQ,IAGO9R,OAASD,KAAKE,OAAO,CAEhCo2H,KAAM,KAGNn2H,WAAY,SAASuhI,GACjBphI,KAAKg2H,KAAO,IAAIqL,KAChBrhI,KAAKshI,YAAcF,EAAYE,YAC/BthI,KAAK+E,MAAQq8H,EAAYr8H,MACzB/E,KAAKuhI,SAAWH,EAAYG,SAC5B,IAAIxhI,EAAOC,KAkBX,GAZAV,OAAOkiI,uBAAyB,SAACC,EAAUC,GAEvC,IAAI/4G,EAAM84G,QAA0BnkI,IAAdokI,GAAyC,KAAdA,EAA3B,IAAAh8H,OAAkDg8H,GAAc,IAChExgI,GAAE,oBAAoBwf,GAAG,cAE3Cxf,GAAE,oBAAoBygI,YAAY,QAClCzgI,GAAE,oBAAoBygI,YAAY,SAEtC5hI,EAAK6hI,qBAAqB,OAAQj5G,IAIlC3oB,KAAKshI,YAEL,GADAthI,KAAKa,WAAW,UACZugI,EAAYvkF,WAAaukF,EAAYlP,MAAO,CAC5C,IAAIjnE,EAAWm2E,EAAYn2E,UAAY,GACvCvmD,IAAEC,KAAKy8H,EAAYjrH,QAAS,SAAC3U,EAAGmV,GAC5Bs0C,EAAQ,KAAAvlD,OAAMiR,IAAOnV,IAEzBN,GAAEqzB,KAAK,CACHhpB,IAAG,GAAA7F,OAAK07H,EAAYvkF,SAAjB,KAAAn3C,OAA6BxE,GAAEmuC,MAAM4b,IACxC7pB,QAAS,SAASl4B,GACdA,EAAS2kC,SAAWuzF,EAAYvzF,SAChC3kC,EAASiN,QAAUirH,EAAYjrH,SAAW,GAC1CpW,EAAK8hI,UAAU34H,WAIvBlJ,KAAK6hI,UAAUT,QAGnBphI,KAAKa,WAAW,mBAChBb,KAAK6hI,UAAUT,GAIfA,EAAYlyF,YACZhuC,GAAE,WAAWgE,IAAI,CACb48H,QAAS,OACTC,SAAU,UAMtBC,eAAgB,SAASC,GACjBA,GACI/gI,GAAEiyE,QAAQ,UAAW8uD,IAAmB,GACpC3iI,OAAOw+B,IAAIxuB,QAAUhQ,OAAOw+B,IAAIxuB,OAAOy9B,kBACvCztC,OAAOw+B,IAAIxuB,OAAOy9B,iBAAiBm1F,sBAOnDL,UAAW,SAAST,GAChBphI,KAAKg2H,KAAKp1H,IAAIwgI,GAGd,IAAIthI,EAAUE,KAAKg2H,KAAKn0H,WAEpB7B,KAAKmiI,qBAAuBriI,EAAQiF,OACpC3E,IAAMgiI,eAAetiI,EAAQiF,OAGjC/E,KAAKgiI,eAAeliI,EAAQmiI,gBAG5B,IAAI12H,EAAMvL,KAAKg2H,KAAK73H,IAAI,YAaxB,GAZAoN,EAAMA,EAAIyd,QAAQ,gBAAiB,IACnChpB,KAAKg2H,KAAKp1H,IAAI,WAAY2K,GAG1BvL,KAAKe,IAAIgF,KAAKs8H,KAAUrM,KAAKl2H,IAG7BE,KAAKe,IAAIsG,KAAK,sBAAsBtB,KAAKs8H,KAAU76H,OAAO1H,IAC1DE,KAAKe,IAAIsG,KAAK,oBAAoBtB,KAAKs8H,KAAUhjG,KAAKv/B,IACtDE,KAAKe,IAAIsG,KAAK,sBAAsBtB,KAAKs8H,KAAUrjG,OAAOl/B,IAGtDA,EAAQgD,QAAS,CACjB9C,KAAKe,IAAIsG,KAAK,iBAAiBtB,KAAKs8H,KAAUv/H,QAAQhD,IACtD,IAAIC,EAAOC,KACPF,EAAQwiI,kBACR/kI,WAAW,WACPwC,EAAKgB,IAAIsG,KAAK,iBAAiBtB,KAAK,KACrC,KAKX/F,KAAKuiI,qBACLviI,KAAKwiI,qBAILC,gBAIJD,mBAAoB,WAEhB,IAAIziI,EAAOC,KAGXA,KAAKe,IAAIsG,KAAK,qBAAqB1C,KAAK,WACpCzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM+d,MAAM,WAEV,OADAhe,EAAK2iI,iBAAiB1iI,OACf,MAKfA,KAAKe,IAAIsG,KAAK,oBAAoB1C,KAAK,WACnCzD,GAAElB,MAAM2S,MACRzR,GAAElB,MACG+d,MAAM,WACH7c,GAAElB,MAAM4J,WAEXu0C,MAAM,WACHj9C,GAAElB,MAAMkF,IAAI,aAAc,cAKtClF,KAAKe,IAAIsG,KAAK,cAAc1C,KAAK,WAC7BzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM+d,MAAM,WAEV,OADAhe,EAAK4iI,mBAAmBzhI,GAAElB,MAAMgB,KAAK,cAC9B,MAKfhB,KAAKe,IAAIsG,KAAK,qBAAqB1C,KAAK,WACpCzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM0rE,OAAO,WACX,IAAIk3D,EAAa1hI,GAAElB,MAAMgB,KAAK,cAC1B6hI,EAAiB3hI,GAAC,UAAAwE,OAAWk9H,EAAX,YAClBE,EAAaD,EAAevhI,MAGhC,OAFAuhI,EAAevhI,IAAI,IACnBvB,EAAK6hI,qBAAqBgB,EAAYE,IAC/B,MAKf9iI,KAAKe,IAAIsG,KAAK,wBAAwB1C,KAAK,WACvCzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM+d,MAAM,WAUV,OARA7c,GAAElB,MACGie,SACAlQ,SAGLhO,EAAKgjI,wBAAwB7hI,GAAElB,MAAMgB,KAAK,cAAeE,GAAElB,MAAMgB,KAAK,gBAG/D,MAKfhB,KAAKe,IAAIsG,KAAK,2BAA2B1C,KAAK,WAC1CzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM+d,MAAM,WAEV,OADAhe,EAAKijI,uBAAuB9hI,GAAElB,MAAMgB,KAAK,cAAeE,GAAElB,MAAMgB,KAAK,gBAC9D,MAKfhB,KAAKe,IAAIsG,KAAK,2BAA2B1C,KAAK,WAC1CzD,GAAElB,MAAM2S,MACRzR,GAAElB,MAAM+d,MAAM,WAGV,OAFAhe,EAAKgB,IAAIsG,KAAK,oBAAoBs6H,YAAY,QAC9C5hI,EAAKgB,IAAIsG,KAAK,oBAAoBs6H,YAAY,SACvC,MAKf3hI,KAAKe,IAAIsG,KAAK,cAAcsL,MAC5B3S,KAAKe,IAAIsG,KAAK,cAAchG,GAAG,QAAS,WACpCtB,EAAKkjI,qBAKbV,mBAAoB,WAEhBviI,KAAKe,IAAIsG,KAAK,SAAS1C,KAAK,WACxB,IAAIu+H,EAAahiI,GAAElB,MAAMqH,KAAK,kCAC1B87H,EAAcjiI,GAAElB,MAAMqH,KAAK,4BAC3B+7H,EAAiB,WACjBD,EAAYt9H,KAAK3E,GAAEgiI,GAAY91H,OAAO,YAAYxT,SAGtDsH,GAAEgiI,GAAYv+H,KAAK,WACfzD,GAAElB,MAAMmJ,OAAOi6H,KAEnBA,MAImD,IAAnDpjI,KAAKe,IAAIsG,KAAK,0BAA0BzN,QAAcoG,KAAKe,IAAIsG,KAAK,0BAA0Bg8H,OAAO,IAGzG,IAAIvjI,EAAUE,KAAKg2H,KAAKn0H,WACpB9B,EAAOC,KAKXA,KAAKe,IAAIsG,KAAK,kBAAkB1C,KAAK,WACjCzD,GAAElB,MAAM+d,MAAM,WAEV,OADAhe,EAAKujI,SAASpiI,GAAElB,MAAMgB,KAAK,cACpB,MAOfhB,KAAKe,IAAIsG,KAAK,eAAe1C,KAAK,WAC9BzD,GAAElB,MAAM+d,MAAM,WAKV,OAJAhe,EAAKk/C,QAAQ,CACT5a,KAAMnjC,GAAElB,MAAMgB,KAAK,QACnB9D,OAAQgE,GAAElB,MAAMgB,KAAK,aAElB,MAMM,IADFlB,EAAQoyH,MAAMt4H,QAMjC8K,IAAEC,KAAK7E,EAAQoyH,MAAO,SAAC9kE,EAAMhhD,GACzB,IAAI0zB,EAAS//B,EAAKmB,EAAL,SAAAwE,OAAgB0nD,EAAKm2E,UAArB,WAAwC5wH,MACjD6wH,EAAQ,IAAIC,KAAU3jG,GAC1Bp7B,IAAEC,KAAK7E,EAAQ8P,WAAY,SAAA26C,GACvBxqD,EAAK2jI,eAAeF,EAAOj5E,EAAW6C,QAMlDs2E,eAAgB,SAASF,EAAOj5E,EAAW6C,GACvC,IAAIrtD,EAAOC,KACPi7F,EAAW7tC,EAAKu2E,iBAAiBp5E,EAAUrkD,OAC3C+0F,EAAS2oC,SAAWr5E,EAAUs5E,aAC9BL,EAAMM,QAAQ,CACV/9H,KAAMwkD,EAAUrkD,MAChBm+B,KAAM42D,EAAS8oC,SACf7mI,OAAQ+9F,EAAS/9F,OACjB8mI,kBAAmBz5E,EAAUiZ,QAC7BxlD,KAAM,SAAS1iB,GACXA,EAAEmG,iBACF,IAAIyE,EAAQhF,GAAE5F,EAAE4B,QAAQ6I,OACpBwkD,EAAUnmD,QACVmmD,EAAUnmD,QAAQgpD,EAAKm2E,WAEvBxjI,EAAKk/C,QAAQj/C,KAAKikI,eAAe/9H,QAQrD07H,qBAAsB,SAAS9jI,EAAMS,GAEjC,GAAc,KAAVA,EACA,OAAO,EAIXyB,KAAKg2H,KAAKrrE,WAAW7sD,EAAMS,GAAO,GAGlC,IAAIC,EAAI0C,GAAEmhI,KAAU6B,eAAepmI,EAAMS,IACrCwB,EAAOC,KACXxB,EAAEuf,MAAM,WAEJ7c,GAAElB,MAAM+N,SAGRhO,EAAKgjI,wBAAwBjlI,EAAMS,KAIvByB,KAAKe,IAAIsG,KAAT,IAAA3B,OAAkB5H,EAAlB,wBACN+F,OAAOrF,GAGjBwB,KAAKmkI,cACLnkI,KAAKi/C,WAIT8jF,wBAAyB,SAASjlI,EAAMS,GAEpCyB,KAAKg2H,KAAKnrE,cAAc/sD,EAAMS,GAG9ByB,KAAKmkI,cACLnkI,KAAKi/C,WAIT0jF,mBAAoB,SAASyB,GAGzB,IAAIC,EAAWrkI,KAAKg2H,KAAK73H,IAAI,YACzBmmI,EAAWF,GACoB,IAA/BC,EAAS3iI,QAAQ0iI,IAEgB,MAA7BC,EAASphI,UAAU,EAAG,KACtBqhI,EAAQ,IAAA5+H,OAAO0+H,IAKvBpkI,KAAKe,IAAIsG,KAAK,eAAe0G,SAG7B,IAAIw2H,EAAyC,KAA5BD,EAASrhI,UAAU,EAAG,GAAY,SAAW,SAC1DzE,EAAI0C,GAAC,SAAAwE,OAAU6+H,EAAV,YAA+BniI,SAAS,cAGjDpC,KAAKe,IAAIsG,KAAT,IAAA3B,OAAkB0+H,EAAlB,YAAoCvgI,OAAOrF,GAG3CwB,KAAKg2H,KAAKp1H,IAAI,WAAY0jI,GAC1BtkI,KAAKmkI,cACLnkI,KAAKi/C,WAIT+jF,uBAAwB,SAASllI,EAAMwH,GAEnC,IAAIk/H,EAAkBxkI,KAAKg2H,KAAK73H,IAAI,uBAAuBL,GAEvD2mI,EAAYzkI,KAAKg2H,KAAK73H,IAAI,WAAWL,GACrCiC,EAAOC,KACXA,KAAKe,IAAIsG,KAAT,IAAA3B,OAAkB5H,EAAlB,YAAiC6G,KAAK,WAClC,IAAIkB,EAAO3E,GAAEy1C,KAAKz1C,GAAElB,MAAM6F,QAEtB6+H,EADSF,EAAgB3+H,GACH/H,GAC1B,GAAI4mI,GAAgBp/H,EAGhBpE,GAAElB,MAAM4D,QACR1C,GAAElB,MAAMoC,SAAS,kBACjBlB,GAAElB,MAAM6D,OAAOgC,QACZ,GAAI6+H,GAAgBD,EAAW,CAGlCvjI,GAAElB,MAAM4D,QACR,IAAIpF,EAAI0C,GAAC,eAAAwE,OAAgBG,EAAhB,SACTrH,EAAEuf,MAAM,WACJhe,EAAKijI,uBAAuBllI,EAAM4mI,KAEtCxjI,GAAElB,MAAMsC,YAAY,kBACpBpB,GAAElB,MAAM6D,OAAOrF,MAKvBwB,KAAKg2H,KAAKrrE,WAAW7sD,EAAMwH,GAC3BtF,KAAKmkI,cACLnkI,KAAKi/C,WAITqkF,SAAU,SAASqB,GAEf,IAAI5kI,EAAOC,KACXA,KAAKe,IAAIsG,KAAK,cAAc1C,KAAK,WAC7B,IAMIkB,EANA1F,EAAKe,GAAElB,MAAMgB,KAAK,MAGlB4jI,EAAW7hI,SAAS5C,EAAGO,MAAM,KAAK,GAAI,IAEtC2pD,EAAWtqD,EAAKi2H,KAAK73H,IAAI,YAE7B,GAAIymI,IAAaD,EAGb9+H,EAAO3E,GAAElB,MACJiU,WACApO,OACL3E,GAAElB,MAAM4D,QACR1C,GAAElB,MAAMoC,SAAS,iBACjBlB,GAAElB,MAAM6F,KAAKA,QACV,GAAI++H,IAAav6E,EAAU,CAG9BxkD,EAAO3E,GAAElB,MAAM6F,OACf3E,GAAElB,MAAM4D,QACR1C,GAAElB,MAAMsC,YAAY,iBACpB,IAAI9D,EAAI0C,GAAC,eAAAwE,OAAgBG,EAAhB,SACTrH,EAAEuf,MAAM,WACJhe,EAAKujI,SAASsB,KAElB1jI,GAAElB,MAAM6D,OAAOrF,MAIN,QAAbmmI,EACA3kI,KAAKg2H,KAAKp1H,IAAI,WAAY+jI,GAE1B3kI,KAAKg2H,KAAKp1H,IAAI,WAAYmC,SAAS4hI,EAAU,KAEjD3kI,KAAKi/C,WAITyjF,iBAAkB,SAASmC,EAAkBb,GAEzC,IAAIc,EAAiB5jI,GAAE2jI,GAAkBvjI,MAIzC,GAD4BtB,KAAKe,IAAIsG,KAAK,4BAA4BzN,OAC1C,EACxB,OAAO,EAIX,IAAI2wD,EAAY7lD,IAAEs3E,UAAUh8E,KAAKg2H,KAAKn0H,WAAW+N,WAAY,CACzD1J,MAAO4+H,IAEPv6E,IAAcy5E,IACdA,EAAoBz5E,EAAUiZ,SAAW,IAI7C,IAAIhZ,EAAW,GACfxqD,KAAKe,IAAIsG,KAAK,0BAA0B1C,KAAK,WACzC6lD,EAAS1wD,KAAKoH,GAAElB,MAAMsB,SAI1B,IAAIxB,EAAU,CACVyqD,UAAWu6E,EACX3kI,GAAIqqD,EACJw5E,kBAAmBA,GASvB,MAPwB,OAApBz5E,EAAUrtD,QAAuC,UAApBqtD,EAAUrtD,SACvC4C,EAAU4E,IAAE9E,OAAOE,EAAS,CACxBukC,KAAMkmB,EAAUlmB,KAChBnnC,OAAQqtD,EAAUrtD,UAG1B8C,KAAKi/C,QAAQn/C,IACN,GAGXmjI,gBAAiB,WACb,IAAI8B,EAAQ/kI,KAAKkB,EAAE,6BACf0lB,EAAQ5mB,KAAKkB,EAAE,cAAcmD,KAAK,WACtCK,IAAEC,KAAKogI,EAAO,SAAAnnI,GACVsD,GAAEtD,GAAGyG,KAAK,UAAWuiB,KAEzB5mB,KAAKuiI,sBAIT4B,YAAa,WAET,IAAI95E,EAAWrqD,KAAKg2H,KAAK73H,IAAI,YACzBksD,SAA4D,QAAbA,GAC/CrqD,KAAKg2H,KAAKp1H,IAAI,WAAY,IAOlCq+C,QAAS,SAASn/C,GAEd,IAAIK,EAAK,KACLkkC,EAAO,KACPkmB,EAAY,KACZy5E,EAAoB,KACpB9mI,EAAS,KAGb,GAAI4C,IAEAukC,EAAOvkC,EAAQukC,KACfkmB,EAAYzqD,EAAQyqD,UACpBpqD,EAAKL,EAAQK,GACb6jI,EAAoBlkI,EAAQkkI,kBAC5B9mI,EAAS4C,EAAQ5C,YAGJI,IAAT+mC,IAAqD,GAA/BA,EAAK3iC,QAAQ,eAAqB,CAExD,IAAIsjI,EAAa3gG,EAAK3jC,MAAM,KAC5B,GAAIskI,EAAWprI,OAAS,EAGpB,IAFA,IACIqrI,EADiBD,EAAW,GACAtkI,MAAM,KAC7B0L,EAAQ,EAAGA,EAAQ64H,EAAWrrI,OAAQwS,KACI,GAA3C64H,EAAW74H,GAAO1K,QAAQ,aAG1B6oD,GADAA,EAAY06E,EAAW74H,GAAO1L,MAAM,KAAK,IACnBsoB,QAAQ,MAAO,MACM,GAApCi8G,EAAW74H,GAAO1K,QAAQ,QAEjCvB,EAAK8kI,EAAW74H,GAAO1L,MAAM,KAAK,IAQtD,OAAI6pD,GAAapqD,IAGT6jI,GACsB,KAAtBA,GACqB,QAArBA,GACqB,QAArBA,IAEKxgE,QAAQwgE,MAGjBz5E,EAAYA,EAAU99B,cAGtBzsB,KAAKg2H,KAAKp1H,IAAI,CACV2pD,UAAWA,EACXC,SAAUrqD,IAIA,OAAVjD,EACAoC,OAAOw+B,IAAIsG,SAAX,GAAA1+B,OAAyB2+B,EAAzB,KAAA3+B,OAAiCxE,GAAEmuC,MAAMrvC,KAAKg2H,KAAKhrE,iBAClC,UAAV9tD,EACPgE,GAAE,gBAAgBF,KAAK,MAAvB,GAAA0E,OAAiC2+B,EAAjC,KAAA3+B,OAAyCxE,GAAEmuC,MAAMrvC,KAAKg2H,KAAKhrE,kBACpDhrD,KAAKg2H,KAAKvrE,aAAaF,IAAcvqD,KAAKshI,YACjDthI,KAAKklI,cAELllI,KAAKy8C,MAAMv/C,EAAQmnC,IAIhB,GAIPA,GACArkC,KAAKy8C,MAAMv/C,EAAQmnC,IACZ,IAIPrkC,KAAKg2H,KAAK73H,IAAI,UAAY6B,KAAKshI,YAC/BthI,KAAKklI,cAELllI,KAAKy8C,MAAMv/C,EAAQmnC,IAIhB,IAIXoY,MAAO,SAASv/C,EAAQmnC,GAEpB,IAAI0lB,EAAQ/pD,KAAKg2H,KAAK73H,IAAI,SAC1B6B,KAAKg2H,KAAKp1H,IAAI,SAAS,GAGvB,IAAIwpD,EAAkBpqD,KAAKe,IAAIsG,KAAK,oBAAoBqZ,GAAG,YAc3D,OAbA1gB,KAAKg2H,KAAKp1H,IAAI,kBAAmBwpD,GAG5B/lB,IACDA,EAAI,GAAA3+B,OAAM1F,KAAKg2H,KAAK73H,IAAI,YAApB,KAAAuH,OAAmCxE,GAAEmuC,MAAMrvC,KAAKg2H,KAAKhrE,kBAI7DhrD,KAAKg2H,KAAKp1H,IAAI,CACV2pD,eAAWjtD,EACXktD,cAAUltD,EACVysD,MAAOA,IAEH7sD,GACJ,IAAK,SACDgE,GAAE,gBAAgBF,KAAK,MAAOqjC,GAC9B,MACJ,IAAK,MACD/kC,OAAOw+B,IAAIsG,SAAWC,EACtB,MACJ,QACI/kC,OAAO8kC,SAAWC,IAK9B6gG,YAAa,WAET,IAAI3/B,EAASvlG,KAAKg2H,KAAK73H,IAAI,aAAe,OAAS,MAGnD6B,KAAKe,IAAIsG,KAAK,wBAAwBlF,OACtC,IAAIpC,EAAOC,KACXkB,GAAEqzB,KAAK,CACHv3B,KAAMuoG,EACNh6F,IAAKxL,EAAKi2H,KAAK73H,IAAI,YACnB/E,KAAM2G,EAAKi2H,KAAKhrE,eAChB7tD,MAAO,WACHooF,MAAM,wBAEVnkD,QAAS,SAAS+jG,GAEd,IAAIt3F,EAAW9tC,EAAKi2H,KAAK73H,IAAI,YACzBs4F,EAAS12F,EAAKi2H,KAAK73H,IAAI,UACvBisD,EAAkBrqD,EAAKgB,IAAIsG,KAAK,oBAAoBqZ,GAAG,YAGvDZ,EAAO/f,EAAKuhI,YAAc6D,EAAgBjkI,GAAEkkI,UAAUD,GAG1DrlH,EAAK+tB,SAAWA,EAChB/tB,EAAK22E,OAASA,EACd32E,EAAKsqC,gBAAkBA,EAGvBrqD,EAAK8hI,UAAU/hH,GAGf/f,EAAKgB,IAAIsG,KAAK,wBAAwBhF,QAE1CgjI,SAAU,WAENtlI,EAAKi2H,KAAKp1H,IAAI,CACV2pD,eAAWjtD,EACXktD,cAAUltD,UCvqB9B,SAASgoI,GAAyBC,EAAMC,GACpC,OAAO,IAAIx4G,KACPu4G,EAAKE,cACLF,EAAKG,WACLH,EAAKI,UAAYH,EACjBD,EAAKK,WACLL,EAAKM,aACLN,EAAKO,aACLP,EAAKQ,mBAIb,SAASC,GAA0BT,EAAMU,GACrC,OAAO,IAAIj5G,KACPu4G,EAAKE,cACLF,EAAKG,WACLH,EAAKI,UACLJ,EAAKK,WAAaK,EAClBV,EAAKM,aACLN,EAAKO,aACLP,EAAKQ,mBAaN,SAASG,GAAaC,EAAUroI,EAAMinD,EAAMhgD,GAE/C,IATIwgI,EAaA7rI,EAJAN,EAAO+sI,EAEPC,EAAc,GACdC,GAZAd,EAAO,IAAIv4G,KACR,IAAIA,KAAKu4G,EAAKe,iBAAkBf,EAAKgB,cAAehB,EAAKiB,aAAcjB,EAAKkB,cAAe,EAAG,IAarG,IAAK/sI,EAAI,EAAGA,EAAI,GAAIA,IAChB0sI,EAAYtsI,KAAKksI,GAA0BK,EAAK3sI,IAGpD,IAAIgtI,EAAa,GACjB,IAAKhtI,EAAI,EAAGA,EAAI,GAAIA,IAChBgtI,EAAW5sI,KAAKwrI,GAAyBe,EAAK3sI,IAGlD,IAAI8tC,EAAgB,GAAhBA,EAAuC,GAAvCA,EAAiD,GAEjDm/F,EAAW,EACH,SAAR5hF,EACA4hF,EAAWrnG,KACI,QAARylB,IACP4hF,EAAWrnG,IAEf,IAII2sD,EAJA26C,EAPQ,IAOcp/F,EARK,GAU3Bq/F,EAAa,KAIb56C,EADiB,IAAjBJ,OAAOzyF,GAFE,IAGOyyF,OAAOzyF,GAEhB,EAEX,IAAI0tI,EAPS,IAOet/F,EAAaA,EAuBzCtmC,IAAE,WAAWgE,IAAI,SAAU4hI,EAAeD,GAG1C,IAAIE,EAAQl7C,UAAA,IAAAnmF,OACI5H,IACXkD,KAAK,QAAS4lI,GACd5lI,KAAK,SAAU8lI,GACf9lI,KAAK,sBAAuB,YAC5BA,KAAK,UALE,OAAA0E,OAKgBkhI,EALhB,KAAAlhI,OAK+BohI,IACtCzlI,GAAG,QA7BR,WACI,IAAIy8C,EAAU+tC,UAAU7rF,MAAMgB,KAAK,SACnC88C,EAAUA,EAAQp9C,MAAM,KACxBmrF,aAAA,IAAAnmF,OAAiBo4C,EAAQ,KACpB1wC,OADL,IAAA1H,OACgBo4C,EAAQ,KACnBn1C,MAAM,SAAU,WAChB2lF,aACAC,SAAS,KACTvtF,KAAK,SAAU8lI,GACf9lI,KAAK,QAAS4lI,GAEnB/6C,UAAU7rF,MACL2I,MAAM,SAAU,WAChB2lF,aACAC,SAAS,KACTvtF,KAAK,SAAU8lI,EAAeD,GAC9B7lI,KAAK,QAAS4lI,EAAcC,KAgBjCG,EAAMD,EACLnkH,UAAU,KACVxpB,KAAKA,GACLswF,QACA7lF,OAAO,KACP7C,KAAK,YAAa,SAACnD,EAAGnE,GAEnB,IAAIutI,EAAcz/F,EAElB,mBAAA9hC,OADAuhI,IAAiBvtI,EAAIitI,EACrB,KAAAjhI,OAAmC8hC,EAAnC,OAEHnmC,GAAG,aAAc,SAAAxD,GAKd,IAHA,IAAInE,EAAI,EACJ2V,EAAOxR,EAEJwR,GAAQ,IACXA,GAAc,GACd3V,IAGJ,IAAIwtI,EAAW,EAAJxtI,EAAQ,GACnBmyF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,YAHV,cAAA0E,OAGqC8hC,EAAc,EAHnD,MAAA9hC,OAhEK,IAmE6D7H,EAAIouF,EAAOzkD,EAAa,GAH1F,OAIKxmC,KAAK,aAAc,WACnB6E,KAAKhI,GAEVguF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACP5I,KAAK,QAFV,GAAA0E,OAEsBwhI,EAFtB,OAGKlmI,KAAK,SAAU,QACf4I,OAAO,QACP5I,KAAK,YALV,cAAA0E,OAKqC8hC,EAAc0/F,EALnD,MAAAxhI,OAvEK,IA4EgE7H,EAAIouF,EAAOzkD,EALhF,OAMKxmC,KAAK,QANV,GAAA0E,OAMsBwhI,EANtB,OAOKlmI,KAAK,SAAU,QACfA,KAAK,OAAQ,aAErBK,GAAG,aAAc,SAAAxD,GAEdguF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,aAAc,UAExB6qF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,QAAS,KACdA,KAAK,SAAU,KACfA,KAAK,OAAQ,IACb6E,KAAKhI,KAIlBkpI,EACKljI,OAAO,KACPA,OAAO,QACP7C,KAAK,QAAS,SACdA,KAAK,cAAe,OACpBA,KAAK,YAAa,+BAAA0E,OAjHX,IAiHW,WAClBG,KAAKd,GAGVgiI,EACKljI,OAAO,KACP7C,KAAK,QAAS,QACd6C,OAAO,QACP7C,KAAK,QAAS,KACdA,KAAK,IAAK,WACP,IACIomI,EAAM5/F,EAlHL,IAmHD6/F,EAFM7/F,EA3HN,IA8HA8/F,EAAMF,EAEV,UAAA1hI,OALU8hC,EAKV,KAAA9hC,OAAkB0hI,EAAlB,OAAA1hI,OAA2B2hI,EAA3B,KAAA3hI,OAAkC4hI,KAI1C,IAAI56G,EAAIm/D,SAASmF,SAASjuE,MAAM,CA1HnB,IA0H4B,IAGrCwkH,EAAQ17C,OACP27C,OACA78C,MAAMj+D,GACN+6G,OAAO,QACPC,WAAW,SAAA7pI,GAAC,OAAIguF,SAAShuF,EAAIguF,OAAOzyF,GAAO,KAGhD2tI,EACKljI,OAAO,KACP7C,KAAK,QAAS,UACdA,KAAK,KAHV,KAAA0E,OAGqB5H,IAChBkD,KAAK,cAAe,OACpBA,KAAK,YALV,cAAA0E,OAKqC8hC,EALrC,KAAA9hC,OAKoD8hC,EALpD,MAMKttC,KAAKqtI,GACL39H,OAAO,WAGZm9H,EACKljI,OAAO,KACPA,OAAO,QACP7C,KAAK,QAAS,YACdA,KAAK,YAAa,WACf,IAAIwmI,EAAO37C,UAAA,MAAAnmF,OAAgB5H,IAAQsqE,OAC/Bu/D,EAAWngG,EAAcggG,EAAKt+C,wBAAwB5pD,MAAQ,EAC9DsoG,EAAUpgG,EAAaggG,EAAKt+C,wBAAwBxsD,OAAS,EAAI,GAGrE,MAFS,aAAAh3B,OAAgBiiI,EAAhB,KAAAjiI,OAA4BkiI,EAA5B,kBAIZ/hI,KAAK,kBAGVmhI,EAAInjI,OAAO,QACN7C,KAAK,IAAK,SAAAnD,GAAC,OA9JH,IA8JgBA,EAAIouF,IAC5BjrF,KAAK,SAAU,SAAAnD,GAAC,OAAIA,EAAIouF,IACxBjrF,KAAK,QAAS2lI,EAAW,GAE9B,IAAIvhI,GAAQ,EAGZ,GAAY,SAAR2/C,EAAiB,CAEjBiiF,EAAInjI,OAAO,QACN7C,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,QACvBA,KAAK,YAAa,+BAAA0E,OAAoBihI,EAAW,EAA/B,MAAAjhI,OA/Kd,IA+Kc,OAGvBshI,EAAInjI,OAAO,QACN7C,KAAK,OAAQ,cACbA,KAAK,YAFV,kBAAA0E,OAEyCg3B,IAFzC,OAGK72B,KAAK,SAAChI,EAAGnE,GASN,OANI0sI,EAAY1sI,GAAGksI,WAAa,GACxB,IAAAlgI,OAAO1C,OAAOojI,EAAY1sI,GAAGksI,aAE1BQ,EAAY1sI,GAAGksI,aAOlC,IAAIiC,EAAW,GACfziI,GAAQ,EACR4hI,EAAInjI,OAAO,QACN7C,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,SAACnD,EAAGnE,GACZ,IAAIouI,EAAM,EAaV,OAXI1B,EAAY1sI,GAAGisI,WAAakC,IACvBziI,EAID0iI,EAAM,IAHNA,EAAM,GACN1iI,GAAQ,GAKZyiI,EAAWzB,EAAY1sI,GAAGisI,WAGvBmC,IAEV9mI,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,QACvBA,KAAK,YAAa,kCAAA0E,OA3Nd,IA2Nc,OAGvBmiI,EAAW,GACX,IAAIE,EAAgB,GACpB3iI,GAAQ,EACR4hI,EAAInjI,OAAO,QACN7C,KAAK,OAAQ,cACbA,KAAK,iBAAkB,QACvB6E,KAAK,SAAChI,EAAGnE,GACN,IAAIqrD,EAAO,GAUX,OAPIqhF,EAAY1sI,GAAGisI,WAAaoC,IAC5BhjF,EAAO/hD,OAAOojI,EAAY1sI,GAAGsuI,eAHpB,QAG2C,CAAEC,MAAO,UAC7DljF,GAAI,IAAAr/C,OAAQ1C,OAAOojI,EAAY1sI,GAAGisI,YAElCoC,EAAgB3B,EAAY1sI,GAAGisI,WAG5B5gF,IAEV/jD,KAAK,YAAa,SAASnD,EAAGnE,GAC3B,IAAIwuI,EAlPH,IAmPGC,EAAat8C,UACL7rF,MACPooE,OACAggE,UAAU9oG,MAaf,OAXI8mG,EAAY1sI,GAAGisI,WAAakC,IACvBziI,EAID8iI,GAAe,IAHfA,GAAe,GACf9iI,GAAQ,GAKZyiI,EAAWzB,EAAY1sI,GAAGisI,WAG9B,cAAAjgI,OAAqByiI,EAAa,EAAlC,MAAAziI,OAAwCwiI,EAAxC,aAEL,GAAY,QAARnjF,EAAgB,CAEvBiiF,EAAInjI,OAAO,QACN7C,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,QACvBA,KAAK,YAAa,+BAAA0E,OAAoBihI,EAAW,EAA/B,MAAAjhI,OA/Qd,IA+Qc,OAGvBshI,EAAInjI,OAAO,QACN7C,KAAK,OAAQ,cACbA,KAAK,YAFV,iBAAA0E,OAEwCg3B,IAFxC,OAGK72B,KAAK,SAAChI,EAAGnE,GASN,OANIgtI,EAAWhtI,GAAGisI,UAAY,GACtB,IAAAjgI,OAAO1C,OAAO0jI,EAAWhtI,GAAGisI,YAEzBe,EAAWhtI,GAAGisI,YAOjC,IAAI0C,EAAa,GACjBjjI,GAAQ,EACR4hI,EAAInjI,OAAO,QACN7C,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,SAACnD,EAAGnE,GACZ,IAAIouI,EAAM,EAaV,OAXIpB,EAAWhtI,GAAGgsI,YAAc2C,IACvBjjI,EAID0iI,EAAM,IAHNA,EAAM,GACN1iI,GAAQ,GAKZijI,EAAa3B,EAAWhtI,GAAGgsI,YAGxBoC,IAEV9mI,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,QACvBA,KAAK,YAAa,kCAAA0E,OA3Td,IA2Tc,OAGvB2iI,EAAa,GACb,IAAIC,EAAkB,GACtBljI,GAAQ,EACR4hI,EAAInjI,OAAO,QACN7C,KAAK,OAAQ,gBACbA,KAAK,iBAAkB,QACvB6E,KAAK,SAAChI,EAAGnE,GACN,IAAIqrD,EAAO,GAUX,OAPI2hF,EAAWhtI,GAAGgsI,YAAc4C,IAC5BvjF,EAAO/hD,OAAO0jI,EAAWhtI,GAAGsuI,eAHnB,QAG0C,CAAEC,MAAO,UAC5DljF,GAAI,IAAAr/C,OAAQ1C,OAAO0jI,EAAWhtI,GAAG+rI,gBAEjC6C,EAAkB5B,EAAWhtI,GAAGgsI,YAG7B3gF,IAEV/jD,KAAK,YAAa,SAASnD,EAAGnE,GAC3B,IAAIwuI,EAlVH,IAmVGC,EAAat8C,UACL7rF,MACPooE,OACAggE,UAAU9oG,MAaf,OAXIonG,EAAWhtI,GAAGgsI,YAAc2C,IACvBjjI,EAID8iI,GAAe,IAHfA,GAAe,GACf9iI,GAAQ,GAKZijI,EAAa3B,EAAWhtI,GAAGgsI,YAG/B,cAAAhgI,OAAqByiI,EAAa,EAAlC,MAAAziI,OAAwCwiI,EAAxC,QAKZnB,EACKljI,OAAO,KACP7C,KAAK,QAAS,YACd6C,OAAO,QACZkjI,EAAMn9H,OAAO,aAAa/F,OAAO,QAGrB,eAAR/F,GAAiC,eAARA,GACzB+tF,UAAA,IAAAnmF,OAAc5H,IACTkD,KAAK,SAAU8lI,EAAeD,GAC9B7lI,KAAK,QAAS4lI,EAAcC,GAC5Bl+H,MAAM,SAAU,WAMtB,SAAS4/H,GAAiBpC,EAAUroI,EAAMiH,GAG7C,IAAI3L,EAAO+sI,EAEPU,EAAa,KACbr/F,EAAgB,GAAhBA,EAAiD,GAGjDs/F,EADS,IACet/F,EAHe,GAMvCo/F,EADQ,IACcp/F,EANK,GAU3Bhb,EAAIq/D,SACHmF,SACAC,OAAO,CAAC,EAAGpF,OAAOzyF,KAClB2pB,MAAM,CAAC,EARA,MAWZ3pB,EAAOyyF,UAAU28C,YAAYC,KAAKj8G,EAAEi9D,MAAM,IAAnCoC,CAAwCzyF,GAI/C,IADA,IAKI6yF,EALAy8C,EAAU,GACLhvI,EAAI,EAAGA,EAAIN,EAAKQ,OAAQF,IAC7BgvI,EAAQ5uI,KAAKV,EAAKM,GAAGE,QAMrBqyF,EADiB,IAAjBJ,OAAOzyF,GAxBE,IAyBOyyF,OAAO68C,GAEhB,EAKX,IAAIh8G,EAAIm/D,SACHmF,SACAC,OAAO,CAAC,EAAGpF,OAAOzyF,EAAM,SAAAyE,GAAC,OAAIA,EAAE6uB,MAC/B3J,MAAM,CAnCE,IAmCO,IAuBpB,IAeIgkH,EAAQl7C,UAAA,IAAAnmF,OACI5H,IACXkD,KAAK,UAFE,OAAA0E,OAEgBkhI,EAFhB,KAAAlhI,OAE+BohI,IACtC9lI,KAAK,QAAS4lI,GACd5lI,KAAK,SAAU8lI,GACf9lI,KAAK,sBAAuB,YAC5BK,GAAG,QAzCR,WACI,IAAIy8C,EAAU+tC,UAAU7rF,MAAMgB,KAAK,SACnC88C,EAAUA,EAAQp9C,MAAM,KACxBmrF,aAAA,IAAAnmF,OAAiBo4C,EAAQ,KACpB1wC,OADL,IAAA1H,OACgBo4C,EAAQ,KACnBn1C,MAAM,SAAU,WAChB2lF,aACAC,SAAS,KACTvtF,KAAK,SAAU8lI,GACf9lI,KAAK,QAAS4lI,GAEnB/6C,UAAU7rF,MACL2I,MAAM,SAAU,WAChB2lF,aACAC,SAAS,KACTvtF,KAAK,SAAU8lI,EAAeD,GAC9B7lI,KAAK,QAAS4lI,EAAcC,KA4BrCE,EACKljI,OAAO,KACPA,OAAO,QACP7C,KAAK,QAAS,SACdA,KAAK,YAAa,+BAAA0E,OAnFX,IAmFW,WAClBG,KAAKd,GAGV,IAmDI4jI,EAnDA3B,EAAMD,EACLnkH,UAAU,QACVxpB,KAAKA,GACLswF,QACA7lF,OAAO,KACP7C,KAAK,QAAS,OACdA,KAAK,YAAa,SAAAnD,GAAC,mBAAA6H,QAAkB8mB,EAAE3uB,EAAE2uB,GAAKgb,EAA3B,KAAA9hC,QAA2CgnB,EAAE7uB,EAAE6uB,GAAK8a,EAApD,OACnBnmC,GAAG,aAAc,SAAAxD,GAMd,IAJA,IAAInE,EAAI,EAEJ2V,EAAOxR,EAAEjE,OAENyV,GAAQ,GACXA,GAAc,GACd3V,IAEJ,IAAIwtI,EAAW,EAAJxtI,EAAQ,GACnBmyF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,YAHV,cAAA0E,OAGqC8hC,EAAc,EAHnD,MAAA9hC,OA5GK,IA+G6D7H,EAAEjE,OAASqyF,EAAOzkD,EAAa,GAHjG,OAIKxmC,KAAK,aAAc,WACnB6E,KAAKhI,EAAEjE,QAEZiyF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACP5I,KAAK,QAFV,GAAA0E,OAEsBwhI,EAFtB,OAGKlmI,KAAK,SAAU,QACf4I,OAAO,QACP5I,KAAK,YALV,cAAA0E,OAKqC8hC,EAAc0/F,EALnD,MAAAxhI,OAnHK,IAwHgE7H,EAAEjE,OAASqyF,EAAOzkD,EALvF,OAMKxmC,KAAK,QANV,GAAA0E,OAMsBwhI,EANtB,OAOKlmI,KAAK,SAAU,QACfA,KAAK,OAAQ,aAErBK,GAAG,aAAc,WAEdwqF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,aAAc,UAExB6qF,UAAUK,SAAahvF,OAAOiqI,eACzBv9H,OAAO,aACPA,OAAO,QACP5I,KAAK,QAAS,KACdA,KAAK,SAAU,KACfA,KAAK,OAAQ,MAMtB2nI,OADYrrI,IAAZlE,EAAK,GACG,EAEAozB,EAAEpzB,EAAK,GAAGwvI,IAItB5B,EAAInjI,OAAO,QACN7C,KAAK,IAAK,GACVA,KAAK,QAAS2nI,EAAQ,GACtB3nI,KAAK,SAAU,SAAAnD,GAAC,OAxJR,IAwJqB6uB,EAAE7uB,EAAE6uB,KAGtC,IAAIm8G,EAAQh9C,OACP27C,OACA78C,MAAMn+D,GACNi7G,OAAO,UACPC,WArGe,SAAA7pI,GAChB,IAAIooI,EAAQtjI,KAAKkV,MAAMha,EAAI,IACvBirI,EAAUnmI,KAAKkV,MAAMha,EAAY,GAARooI,GAS7B,OAPIA,EAAQ,KACRA,EAAK,IAAAvgI,OAAOugI,IAEZ6C,EAAU,KACVA,EAAO,IAAApjI,OAAOojI,IAGlB,GAAApjI,OAAUugI,EAAV,KAAAvgI,OAAmBojI,KA6FvB/B,EACKljI,OAAO,KACP7C,KAAK,QAAS,UACdA,KAAK,KAHV,KAAA0E,OAGqB5H,IAChBkD,KAAK,YAJV,cAAA0E,OAIqC8hC,EAJrC,KAAA9hC,OAIoD,IAAU8hC,EAJ9D,MAKKttC,KAAK2uI,GAGV9B,EACKljI,OAAO,KACPA,OAAO,QACP7C,KAAK,QAAS,YACdA,KAAK,YAAa,WACf,IAAIwmI,EAAO37C,UAAA,MAAAnmF,OAAgB5H,IAAQsqE,OAC/Bu/D,EAAWngG,EAAcggG,EAAKt+C,wBAAwB5pD,MAAQ,EAAI,GAClEsoG,EAAUpgG,EAjLT,IAiL+BggG,EAAKt+C,wBAAwBxsD,OAAS,GAG1E,MAFS,aAAAh3B,OAAgBiiI,EAAhB,KAAAjiI,OAA4BkiI,EAA5B,OAIZ/hI,KAAK,kBAGV,IAAI0hI,EAAQ17C,OACP27C,OACA78C,MAAMj+D,GACN+6G,OAAO,QAGZV,EACKljI,OAAO,KACP7C,KAAK,QAAS,UACdA,KAAK,KAHV,KAAA0E,OAGqB5H,IAChBkD,KAAK,YAJV,cAAA0E,OAIqC8hC,EAJrC,KAAA9hC,OAIoD8hC,EAJpD,MAKKttC,KAAKqtI,GAGVR,EACKljI,OAAO,KACPA,OAAO,QACP7C,KAAK,QAAS,YACdA,KAAK,YAAa,WACf,IAAIwmI,EAAO37C,UAAA,MAAAnmF,OAAgB5H,IAAQsqE,OAC/Bu/D,EAAWngG,EAAcggG,EAAKt+C,wBAAwB5pD,MAAQ,EAC9DsoG,EAAUpgG,EAAaggG,EAAKt+C,wBAAwBxsD,OAAS,EAAI,GAGrE,MAFS,aAAAh3B,OAAgBiiI,EAAhB,KAAAjiI,OAA4BkiI,EAA5B,kBAIZ/hI,KAAK,kBAGVkhI,EACKljI,OAAO,KACP7C,KAAK,QAAS,YACd6C,OAAO,QACZkjI,EAAMn9H,OAAO,aAAa/F,OAAO,QCrpBrC,IAAMklI,GAAQppI,IAASO,MAAMN,OAAO,CAChCyR,QAAO,GAAA3L,OAAK8F,uBAAL,gBASIw9H,GAAA,CACXD,MAAOA,GACPvyE,OARW72D,IAASkN,WAAWjN,OAAO,CACtC2L,IAAG,GAAA7F,OAAK8F,uBAAL,cAEHvL,MAAO8oI,MCmBIE,GAAA,CACXC,iBA7BqBvpI,IAASD,KAAKE,OAAO,CAC1CiJ,OAAQ,GAERhJ,WAAY,SAASC,GACjBE,KAAKkC,OAAOpC,EAAQqpI,QAGxBjnI,OAAQ,SAASinI,GACb,IAAM54B,EAAOvwG,KAAKwwG,cAGlB,OAFAxwG,KAAKa,WAAW0vG,EAAK,CAAE44B,MAAOA,KAC9BnpI,KAAKe,IAAIoB,OACFnC,MAGXwwG,YAAa,WACT,OAAO9rG,IAAE+N,SACL,CACI,iDACA,2FAEA,6CACA,2CACA,SACFjF,KAAK,SCmGJ47H,GAAA,CACXC,cAzHkB1pI,IAASD,KAAKE,OAAO,CACvC+c,GAAI,kBACJ9L,SAAU,GAOVhR,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAEmM,SAAS7Q,KAAKF,SAAW,GAAIE,KAAK6Q,SAAU/Q,GAC7D,IAAMsrG,EAAOprG,KACbV,OAAOgqI,SAASC,OAAOxwH,WAAa,IAAIywH,GAAgBhzE,OACxDl3D,OAAOgqI,SAASC,OAAOxwH,WAAW/L,MAAM,CACpCo0B,QAAS,SAASnhC,GACdmrG,EAAKlpG,UAET/E,MAAO,SAAS8C,EAAOiJ,QACkB,IAA1BA,EAAS2rB,aAChB+vC,IAAMznE,MAAM+L,EAAS2rB,aAAawuD,SAElCze,IAAMznE,MAAM,0BAM5B6P,MAAO,aAKP9K,OAAQ,SAASpC,GACbE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCoB,IAAE,YAAYmB,OACd,IAAMoQ,EAAWzS,KAAKypI,qBACtBzpI,KAAKe,IAAIgF,KAAK0M,EAAS,CAAE7Y,OAAQ0F,OAAOgqI,SAASC,OAAOxwH,WAAW5L,OAAOvT,UAC1EoG,KAAK0xG,WAAWpyG,OAAOgqI,SAASC,OAAOxwH,WAAW5L,QAClDjM,IAAE,mCAAmC4D,QAAQ,CAAEjC,QAAS,UACxD3B,IAAE,WAAWgE,IAAI,WAAY,SAOjCwsG,WAAY,SAASg4B,GACjB,IAAK,IAAIhwI,EAAI,EAAGA,EAAIgwI,EAAiB9vI,OAAQF,IAAK,CAC9C,IAAMyvI,EAAQO,EAAiBhwI,GAC/BsG,KAAKktG,UAAU,CAAEi8B,MAAOA,MAQhCj8B,UAAW,SAASptG,GAChB,IAAM8uG,EAAU,IAAI+6B,GAAcT,iBAAiBppI,GACnDE,KAAKe,IAAIsG,KAAK,oBAAoBxD,OAAO+qG,EAAQjyF,KAkCrD8sH,mBAAoB,WAChB,IAAMG,EAAa,GAsBnB,OApBAA,EAAW9vI,KAAK,qBAChB8vI,EAAW9vI,KAAK,UAChB8vI,EAAW9vI,KAAK,mDAChB8vI,EAAW9vI,KAAK,4BAChB8vI,EAAW9vI,KAAK,uCAChB8vI,EAAW9vI,KAAK,iBAChB8vI,EAAW9vI,KAAK,uCAChB8vI,EAAW9vI,KAAK,cAChB8vI,EAAW9vI,KAAK,sBAEhB8vI,EAAW9vI,KAAK,0BAChB8vI,EAAW9vI,KAAK,8BAChB8vI,EAAW9vI,KAAK,eAChB8vI,EAAW9vI,KAAK,mCAEhB8vI,EAAW9vI,KAAK,eAChB8vI,EAAW9vI,KAAK,YAChB8vI,EAAW9vI,KAAK,UAChB8vI,EAAW9vI,KAAK,UAET4K,IAAE+N,SAASm3H,EAAWp8H,KAAK,SCgB3Bq8H,GAAA,CACXC,gBApIoBnqI,IAASD,KAAKE,OAAO,CACzC+c,GAAI,kBACJ7c,QAAS,GACTynE,IAAK,KAEL1nE,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKunE,IAAMjoE,OAAOgqI,SAASC,OAEC,OAAxBvpI,KAAKunE,IAAIxuD,YACT/Y,KAAKC,MAAQD,KAAKunE,IAAIxuD,WAAW5a,IAAI6B,KAAKF,QAAQiqI,UAClD/pI,KAAKkC,UAELlC,KAAKgqI,cAIbA,WAAY,SAASlqI,GACjB,IAAMsrG,EAAOprG,KACbA,KAAKF,QAAU4E,IAAE9E,OAAOI,KAAKF,QAASA,GACtCE,KAAKC,MAAQ,IAAIupI,GAAgBT,MAAM,CAAE5oI,GAAIH,KAAKF,QAAQiqI,WAC1D/pI,KAAKC,MAAM+M,MAAM,CACbo0B,QAAS,SAASnhC,GACdb,QAAQ8a,IAAI,mBACZ9a,QAAQ8a,IAAIja,GACZmrG,EAAKlpG,UAET/E,MAAO,SAAS8C,EAAOiJ,QACkB,IAA1BA,EAAS2rB,aAChB+vC,IAAMznE,MAAM+L,EAAS2rB,aAAawuD,SAElCze,IAAMznE,MAAM,0BAM5B+E,OAAQ,WACJ,IAAMuQ,EAAWzS,KAAKwwG,cACtBxwG,KAAKe,IAAIgF,KAAK0M,EAAS,CAAE02H,MAAOnpI,KAAKC,SACrCiB,IAAE,mCAAmC4D,QAAQ,CAAEjC,QAAS,UACxD3B,IAAE,WAAWgE,IAAI,WAAY,SAGjCsrG,YAAa,WACT,OAAO9rG,IAAE+N,SACL,CACI,QACA,8CACA,mCACA,qMAEA,mBACA,sCACA,UACA,gBACA,wBACA,sBACA,WACA,UACA,wDACA,OACA,OACA,mCACA,QACA,OACA,0PACA,QACA,OACA,6BACA,QACA,QACA,YACA,WACA,WAEA,wBACA,sCACA,UACA,gBACA,uBACA,kBACA,iBACA,sBACA,mBACA,mBACA,kBACA,oBACA,WACA,UACA,2DACA,OACA,OACA,qNACA,QACA,OACA,oCACA,QACA,OACA,+BACA,QACA,OACA,8BACA,QACA,OACA,kDACA,qMAEA,YACA,QACA,wFACA,2BACA,QACA,wFACA,2BACA,QACA,OACA,2BACA,QACA,OACA,uBACA,QACA,QACA,YACA,WACA,WACA,UACFjF,KAAK,SC5Hby8H,GAAiBtqI,IAAS08C,OAAOz8C,OAAO,CAC1C2/G,OAAQ,CACJC,GAAI,SACJ0qB,YAAa,gBA2BNC,GAAA,CACXC,eAxBmBzqI,IAASD,KAAKE,OAAO,CACxCyqI,cAAe,KACfC,gBAAiB,KACjBvxH,WAAY,KAEZlZ,WAAY,WACRP,OAAOgqI,SAASC,OAASvpI,KAEzBA,KAAKuqI,UAAY,IAAIN,GACrBjqI,KAAKuqI,UAAUlpI,GAAG,eAAgB,WAC9B/B,OAAOgqI,SAASC,OAAOc,cAAgB,IAAIG,GAAenB,gBAG9DrpI,KAAKuqI,UAAUlpI,GAAG,mBAAoB,SAAA0oI,GAClCzqI,OAAOgqI,SAASC,OAAOe,gBAAkB,IAAIG,GAAiBX,gBAAgB,CAC1EC,SAAUA,MAIlBpqI,IAASgpG,QAAQtwD,MAAM,CAAEgpE,WAAW,0BC1BjCnzE,GAAgBvuC,IAASO,MAAMN,OACA,CAMlCiR,SAAU,CACNoyB,OAAQ,IAIZ5xB,QAAS,WAEL,OAAO7F,uBADM,sBAOjB3L,WAAY,SAASzG,GAIbsL,IAAEgmI,SAAStxI,EAAK6pC,SAAWv+B,IAAEgmI,SAAS1qI,KAAK6Q,SAASoyB,SACpDv+B,IAAEmM,SAASzX,EAAK6pC,OAAQjjC,KAAK6Q,SAASoyB,QAG1CjjC,KAAK6V,mBAKTA,gBAAiB,aAQjBjV,IAAK,SAAS/B,EAAKyC,GAEf,GAAY,WAARzC,EAAkB,CAClB,IAAI8rI,EAAY3qI,KAAK7B,IAAI,UAGrBuG,IAAEgmI,SAASC,KACXrpI,EAAMoD,IAAE9E,OAAO8E,IAAE4P,MAAMq2H,GAAYrpI,IAI3C,OADA3B,IAASO,MAAMlG,UAAU4G,IAAI1G,KAAK8F,KAAMnB,EAAKyC,GACtCtB,MAKX2M,SAAU,WACN,IAAIi+H,EAAa5qI,KAAK7B,IAAI,OAAS,GAInC,OAHI6B,KAAK7B,IAAI,WACTysI,GAAU,IAAAllI,OAAQ1F,KAAK7B,IAAI,WAE/B,iBAAAuH,OAAwBklI,EAAxB,QCrEGjrI,ID+EsBA,IAASkN,WAAWjN,OACL,CAC5CK,MAAOiuC,GAMP3iC,IAAK,WACD,SAAA7F,OAAU8F,uBAAV,uBAMJ3L,WAAY,SAASsN,EAAQrN,GACzBA,EAAUA,GAAW,IAUzBc,IAAK,SAASuM,EAAQrN,GAMlB,IAAIiZ,EAAa/Y,KACjBmN,EAASzI,IAAE4I,IAAIH,EAAQ,SAAAlN,GACnB,IAAI4qI,EAAW9xH,EAAW5a,IAAI8B,EAAME,IACpC,IAAK0qI,EACD,OAAO5qI,EAIX,IAAI6qI,EAASD,EAAS31H,SAEtB,OADAxQ,IAAE9E,OAAOkrI,EAAQ7qI,GACV6qI,IAGXnrI,IAASkN,WAAW7S,UAAU4G,IAAI1G,KAAK8F,KAAMmN,EAAQrN,IAIzD6M,SAAU,WACN,MAAO,CAAC,2BAA4B,CAAC3M,KAAK0N,UAAW1N,KAAKpG,QAAQ4T,OAAQ,KAAKA,KAAK,OCjIjF7N,IAASO,MAAMN,OAAO,CACjCiR,SAAU,CACN9L,MAAO,GACP/H,KAAM,GACNuoI,KAAM,KACN3+G,MAAO,GACPmkH,WAAY,GACZC,UAAU,EACVn+F,WAAY,GACZo+F,eAAgB,MAGpBprI,WAAY,SAASC,EAASorI,GAC1BlrI,KAAKupI,OAAS,IAAI5pI,IAASkN,WAC3B7M,KAAKi7F,SAAW,IAAIt7F,IAASO,MAC7BF,KAAKmrI,iBAAmBD,EAAYC,iBACpCnrI,KAAKorI,mBAAqBF,EAAYE,mBACtCprI,KAAK6sC,WAAaq+F,EAAYr+F,WAC9B7sC,KAAKqrI,WAAaH,EAAYG,WAC9BjsI,QAAQ6Q,MAAM,yDACd7Q,QAAQ6Q,MAAMi7H,IAGlBt0H,MAAO,WACH5W,KAAK23B,QAAQ/2B,IAAI,CACbmE,MAAO,YACP8nC,WAAY7sC,KAAK6sC,aAErB7sC,KAAKi7F,SAAStjE,QACd33B,KAAKupI,OAAO3yH,QACZ5W,KAAKupI,OAAOz8H,IAAI,CAAE3M,GAAIC,IAAMC,SAGhCumB,MAAO,SAASroB,EAAOgmB,GACnBvkB,KAAKY,IAAI,CAAEgmB,MAAOroB,EAAOwsI,WAAYxmH,IACrCvkB,KAAK6C,QAAQ,aACbzD,QAAQ6Q,MAAM,oBAAsBsU,EAAO,KAAOhmB,EAAQ,MAI9D+sI,UAAW,WACP,IAAIztI,EAAI,CACJgE,WAAY7B,KAAK6B,WACjBo5F,SAAUj7F,KAAKi7F,SAASp5F,WACxB0nI,OAAQ,IAKZ,OAHAvpI,KAAKupI,OAAO5kI,KAAK,SAASwkI,GACtBtrI,EAAE0rI,OAAOzvI,KAAKqvI,EAAMtnI,cAEjBhE,GAIX2T,KAAM,SAAS1R,GACX,IAAIC,EAAOC,KACXF,EAAUA,GAAW,GACrBE,KAAKqrI,WAAarrI,KAAKsrI,YACb,IAAIp9F,GAAc,CACxB/tC,GAAIH,KAAKmrI,uBAAoB7tI,EAC7BN,KAAMgD,KAAKorI,mBACXrmI,MAAO/E,KAAK7B,IAAI,UAAY,GAC5B8kC,OAAQ,CACJ4J,WAAY7sC,KAAK6sC,WACjBw+F,WAAYrrI,KAAKqrI,cAGrB75H,OACC0yB,KAAK,SAASh7B,GACPA,GAAYA,EAAS/I,IACrBJ,EAAKorI,iBAAmBjiI,EAAS/I,GAC7BL,EAAQshC,SACRthC,EAAQshC,UAEZhiC,QAAQ6Q,MAAM,8CAAgD/G,EAAS/I,MAEnEL,EAAQ3C,OACR2C,EAAQ3C,QAEZiC,QAAQ6Q,MAAM,qEAGrBsY,KAAK,SAASrf,GACPpJ,EAAQ3C,OACR2C,EAAQ3C,QAEZiC,QAAQ6Q,MAAM,oCAEtB7Q,QAAQ6Q,MAAM,+CAIlBw0B,KAAM,SAAS8mG,GACX,IAAI1tI,EAAI0tI,GAAgBvrI,KAAKqrI,WAM7B,OALIxtI,IACAuB,QAAQ6Q,MAAM,0DACd7Q,QAAQ6Q,MAAMpS,IAElBmC,KAAK4W,QACD/Y,GAAKA,EAAEgE,YACP7B,KAAKY,IAAI/C,EAAEgE,YACX7B,KAAK4mB,MAAM,KAAM,kCACjB5mB,KAAKi7F,SAASr6F,IAAI/C,EAAEo9F,UACpBj7F,KAAKupI,OAAO3yH,QACZ5W,KAAKupI,OAAOz8H,IAAIjP,EAAE0rI,QAClBvpI,KAAKY,IAAI,YAAY,GACrBZ,KAAK6C,QAAQ,QACbzD,QAAQ6Q,MAAM,uCAAyCpS,EAAEgE,WAAW7E,KAAO,MACpE,IAEPgD,KAAKY,IAAI,YAAY,GACrBZ,KAAK6C,QAAQ,QACbzD,QAAQ6Q,MAAM,0DACP,mCCxGfu7H,GAAY7rI,IAASD,KAAKE,OAAO,CACjCC,WAAY,SAAS0nE,EAAKznE,GACtB,IAAIC,EAAOC,KACXA,KAAKk/B,SAAWqoC,EAAIroC,SACpBl/B,KAAK+mI,MAAQx/D,EAAIw/D,MACjB/mI,KAAKmpI,MAAQrpI,EAAQqpI,MACrBnpI,KAAKa,WAAWK,IAAE,WAClBlB,KAAKiC,SAASjC,KAAK+mI,MAAO,oBAAqB,WAC3ChnI,EAAKmC,WAETlC,KAAKkC,UAETA,OAAQ,WACJ,IAAInC,EAAOC,KACPy9E,EAASr9E,IAAMkU,MAAMtU,KAAK+mI,MAAM0E,OAAOlC,SAAW,GAClD18F,EAAa7sC,KAAK+mI,MAAM5oI,IAAI,cAC5B0uC,IACA7sC,KAAK+mI,MAAMngH,MAAM,OAAQ,uBACzB5mB,KAAKk/B,SAAS+f,QAAQ,SAASC,GAC3B9+C,IAAMjC,IAAI,CACNoN,IAAKC,uBAAe,gBAAkBqhC,EACtCwX,OAAO,EACPjjB,QAAS,SAAShc,GACd,IAAIsmH,EAAe,GACnBC,KAASC,YAAYnuD,EAAQ,SAAS30E,EAAO+iI,GACzC,GAAkB,eAAd/iI,EAAM9L,KAAuB,CAC7B0uI,EAAaG,GAAYzrI,IAAMkU,MAAMxL,GACrC,IAAIo0H,EAAU,GACVp0H,EAAMgjI,SACN5O,EAAQpjI,KAAK,CAAEoM,MAAO,qBAAsB3H,MAAO,SAEnDuK,EAAMijI,SACN7O,EAAQpjI,KAAK,CAAEoM,MAAO,eAAgB3H,MAAO,SAEjD,IAAIytI,EAAO5mH,EAAQ6mH,sBACnB,IAAK,IAAIptI,KAAOmtI,IAEiC,GAAxC,CAAC,MAAO,SAAStqI,QAAQsqI,EAAKntI,KAAeiK,EAAMojI,YACpDpjI,EAAMqjI,WAENjP,EAAQpjI,KAAK,CAAEoM,MAAO,YAAcnD,SAASlE,GAAO,GAAIN,MAAOM,IAGvEiK,EAAM1P,KAAO8jI,EAEjB,IAAIkP,EAAcrsI,EAAKopI,MAAMhrI,IAAI0tI,QACbvuI,IAAhB8uI,GAA8BtjI,EAAMmI,SACpCnI,EAAMvK,MAAQ6tI,KAGtB3uD,EAAO3jF,KAAK,CACRgE,KAAM,iBACNd,KAAM,SACNiU,QAAQ,EACR1S,MAAOmtI,IAEX3rI,EAAKgnI,MAAMngH,MAAM,KAAM,2BACvB7mB,EAAK6+E,KAAO,IAAIwB,KAAK,CACjB3C,OAAQA,EACR98E,SAAU,WACNZ,EAAKopI,MAAMvoI,IAAIb,EAAK6+E,KAAKxlF,KAAKwF,UAC9BmB,EAAKgnI,MAAMnmI,IAAI,YAAY,GAC3Bb,EAAKgnI,MAAMlkI,QAAQ,aAG3B9C,EAAKopI,MAAMvoI,IAAIb,EAAK6+E,KAAKxlF,KAAKwF,UAC9BmB,EAAKgB,IAAI6C,QAAQC,OAAO9D,EAAK6+E,KAAK79E,KAClCm+C,EAAQvjD,UACRoE,EAAKgnI,MAAMlkI,QAAQ,mBAQ5BlD,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,GACjB,IAAIxnE,EAAOC,KACXA,KAAKunE,IAAMA,EACXvnE,KAAK+mI,MAAQx/D,EAAIw/D,MACjB/mI,KAAKqsI,OAAS,IAAI9wE,KAAO77D,KAAK,CAC1BqF,MAAO,cACPunI,UAAW,cACXhsI,IAAK,EACL6O,MAAO,WACHpP,EAAKgnI,MAAMwC,OAAOz8H,IAAI,CAAE3M,GAAIC,IAAMC,WAG1CL,KAAKa,WAAWK,IAAE,UAAU2C,OAAO7D,KAAKqsI,OAAOtrI,MAC/Cf,KAAKiC,SAASjC,KAAK+mI,MAAMwC,OAAQ,SAAU,SAASJ,GAChDppI,EAAKssI,OAAOn8H,IAAIi5H,EAAMhpI,IACtBJ,EAAKgnI,MAAMlkI,QAAQ,YAEvB7C,KAAKiC,SAASjC,KAAK+mI,MAAMwC,OAAQ,QAAS,WACtCxpI,EAAKssI,OAAOj8H,WAEhBpQ,KAAKiC,SAASjC,KAAK+mI,MAAMwC,OAAQ,MAAO,SAASJ,GAC7CppI,EAAKssI,OAAOv/H,IAAI,CACZ3M,GAAIgpI,EAAMhpI,GACVY,IAAK,IAAIyqI,GAAUzrI,EAAKwnE,IAAK,CAAE4hE,MAAOA,IAASpoI,IAC/C0O,MAAO,WACH1P,EAAKgnI,MAAMwC,OAAOx7H,OAAOo7H,SAKzCjnI,OAAQ,WACAwC,IAAE2K,KAAKrP,KAAK+mI,MAAM0E,OAAOlC,QAAU,EACnCvpI,KAAKqsI,OAAOtrI,IAAIoB,OAEhBnC,KAAKqsI,OAAOtrI,IAAIsB,UCnHb1C,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,EAAKznE,GACtB,IAAIC,EAAOC,KACXA,KAAK+mI,MAAQx/D,EAAIw/D,MACjB/mI,KAAKa,WAAW,UAChBb,KAAKiC,SAASjC,KAAK+mI,MAAO,OAAQ,WAC9BhnI,EAAKmC,YAGbA,OAAQ,WACJ,IAAInC,EAAOC,KACPy9E,EAASr9E,IAAMkU,MAAMtU,KAAK+mI,MAAM0E,OAAOxwC,WAAa,GACpDsxC,EAAevsI,KAAK+mI,MAAM0E,OAAOe,MAAMt9F,WACvB,YAAhBq9F,EACA9uD,EAAO3jF,KAAK,CACRgE,KAAM,eACNd,KAAM,UACNkJ,MAAO,mBACP27C,KAAM,iEAGV7hD,KAAK+mI,MAAM9rC,SAASr6F,IAAI,eAAgC,OAAhB2rI,EAAwB,OAAS,SAE7EvsI,KAAKe,IAAI6C,QACLc,IAAE2K,KAAKouE,GAAU,IACjBkuD,KAASC,YAAYnuD,EAAQ,SAAS30E,EAAOhL,GACzC,IAAIsuI,EAAcrsI,EAAKgnI,MAAM9rC,SAAS98F,IAAIL,QACtBR,IAAhB8uI,GAA8BtjI,EAAMmI,SACpCnI,EAAMvK,MAAQ6tI,KAGtBpsI,KAAK4+E,KAAO,IAAIwB,KAAK,CACjB3C,OAAQA,EACR98E,SAAU,WACNZ,EAAKgnI,MAAM9rC,SAASr6F,IAAIb,EAAK6+E,KAAKxlF,KAAKwF,UACvCmB,EAAKgnI,MAAMlkI,QAAQ,aAG3B7C,KAAK+mI,MAAM9rC,SAASr6F,IAAIZ,KAAK4+E,KAAKxlF,KAAKwF,UACvCoB,KAAKe,IAAI8C,OAAO7D,KAAK4+E,KAAK79E,SCxCvBpB,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,GACjBvnE,KAAKyrI,OAASlkE,EAAIw/D,MAAM0E,OACxBzrI,KAAKa,WAAWb,KAAKc,aACrBd,KAAKgnC,OAAShnC,KAAKkB,EAAE,6BACrBlB,KAAKysI,OAASzsI,KAAKkB,EAAE,6BACrBlB,KAAKiB,MAAQjB,KAAKkB,EAAE,4BACpBlB,KAAKkC,UAETA,OAAQ,WACAlC,KAAKyrI,OAAOiB,MACZ1sI,KAAKysI,OAAOzrI,KAAK,MAAOwK,uBAAexL,KAAKyrI,OAAOiB,MACnD1sI,KAAKgnC,OAAOjhC,KAAK/F,KAAKyrI,OAAO1lI,MAAQ,eACrC/F,KAAKiB,MAAM8E,KAAK3F,IAAMusI,QAAQ3sI,KAAKyrI,OAAOpsF,aAAe,KACzDr/C,KAAKe,IAAIoB,QAETnC,KAAKe,IAAIsB,QAGjBvB,UAAW,WACP,whBCdOnB,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,EAAKznE,GAAS,IAAA6J,EAAA3J,KAC/BA,KAAKunE,IAAMA,EACXvnE,KAAK+mI,MAAQ/mI,KAAKunE,IAAIw/D,MACtB/mI,KAAKq/C,YAAc,IAAIutF,GAAY5sI,KAAKunE,KACxCvnE,KAAK+E,MAAQ,IAAImK,KAAG7G,MAAM,CACtB1H,SAAU,WACNgJ,EAAKo9H,MAAMnmI,IAAI,QAAS+I,EAAK5E,MAAMxG,YAG3CyB,KAAK+8C,KAAO,IAAIC,KAAKt9C,KAAK,IAC1BM,KAAK+8C,KAAKjwC,IAAI,CACV3M,GAAI,WACJoG,KAAM,aACNzB,QAAS,mBACT/D,IAAKG,IAAE,UACF2C,OAAO,wCACPA,OAAO7D,KAAK+E,MAAMhE,KAClB8C,OACG3C,IAAE,UACGkB,SAAS,wBACT2D,KAAK,kEAEblC,OAAO,IAAIi6D,GAAS99D,KAAKunE,KAAKxmE,OAEnCf,KAAK+mI,MAAM0E,OAAOlC,QAClBvpI,KAAK+8C,KAAKjwC,IAAI,CACV3M,GAAI,SACJoG,KAAM,cACNzB,QAAS,eACT/D,IAAK,IAAIy1D,GAAOx2D,KAAKunE,KAAKxmE,MAGlCf,KAAKa,WAAW,gCAChBb,KAAKe,IAAI8C,OAAO7D,KAAKq/C,YAAYt+C,KACjCf,KAAKe,IAAI8C,OAAO7D,KAAK+8C,KAAKh8C,KAC1Bf,KAAKiC,SAASjC,KAAK+mI,MAAO,OAAQ,WAC9Bp9H,EAAK5E,MAAMxG,MAAMoL,EAAKo9H,MAAM5oI,IAAI,eCzC7BwB,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,EAAKznE,GACtB,IAAIC,EAAOC,KACXA,KAAKunE,IAAMA,EACXvnE,KAAK+mI,MAAQ/mI,KAAKunE,IAAIw/D,MACtB/mI,KAAKF,QAAUA,EACfE,KAAKa,WACDK,IAAE,UACGkB,SAAS,iBACTyB,OACG3C,IAAE,UACGkB,SAAS,QACTyB,OAAO3C,IAAE,WAAWkB,SAAS,SAC7ByB,OAAO3C,IAAE,WAAWkB,SAAS,WAG9CpC,KAAKwJ,MAAQxJ,KAAKkB,EAAE,SACpBlB,KAAK0oF,MAAQ1oF,KAAKkB,EAAE,SACpBlB,KAAKiB,MAAQjB,KAAKkB,EAAE,SACpBlB,KAAK6sI,YAAY7sI,KAAKe,IAAK,IAC3Bf,KAAK8sI,iBAAiB,OACtB9sI,KAAK+mI,MAAM1lI,GAAG,SAAU,SAAS0rI,GACxBhtI,EAAKgnI,MAAM5oI,IAAI,aAAgB4B,EAAKgnI,MAAM0E,OAAOe,MAAMhpE,UAAWupE,EAMnEhtI,EAAKgnI,MAAMngH,MAAM,OAAQ,6DALzB7mB,EAAKwnE,IAAIroC,SAAS+f,QAAQ,SAASC,GAC/B9/C,QAAQ6Q,MAAM,kCACdlQ,EAAKitI,MAAM9tF,EAASn/C,EAAKgnI,WAMrC/mI,KAAK+mI,MAAM1lI,GAAG,YAAa,WACvB,IAAI4mF,EAAaloF,EAAKmB,EAAE,4BACpBsI,EAAQzJ,EAAKyJ,MACbk/E,EAAQ3oF,EAAK2oF,MACbznF,EAAQlB,EAAKkB,MAKjB,OAJAynF,EAAMpmF,cACNkH,EAAMrH,OACNlB,EAAM8E,KAAKhG,EAAKgnI,MAAM5oI,IAAI,eACd4B,EAAKgnI,MAAM5oI,IAAI,UAEvB,IAAK,KACDqL,EAAMnH,OACN4lF,EAAW9lF,OACX,MACJ,IAAK,SACDumF,EAAMtmF,SAAS,sBACf6lF,EAAW5lF,OACX,MACJ,IAAK,OACDqmF,EAAMtmF,SAAS,mBACf6lF,EAAW5lF,OACX,MACJ,QACIqmF,EAAMtmF,SAAS,8BACf6lF,EAAW9lF,WAM3B0qI,YAAa,SAAS9rI,EAAKymC,GACvBzmC,EAAImE,IAAI,SAAUhE,IAAE5B,QAAQo9B,SAAW8K,GACvCtmC,IAAE5B,QAAQ+oC,OAAO,WACbtnC,EAAImE,IAAI,SAAUhE,IAAE5B,QAAQo9B,SAAW8K,MAK/CslG,iBAAkB,SAASnkH,EAAK5pB,GAC5B4pB,EAAMA,GAAO,MACb5pB,EAAIA,GAAK,EACTiB,KAAKkB,EAAE,4BAA4B6M,SACnC/N,KAAKitI,QAAU,GACf,IAAK,IAAIvzI,EAAI,EAAGA,EAAIqF,EAAGrF,IAAK,CACxB,IAAIwzI,EAAe9sI,IAAMC,MACrB8sI,EAAejsI,IAAE,UAChBkB,SAAS,2BACTk9B,MAAMv8B,SAAS,IAAMhE,GAAK,KAC1B8E,OAAO3C,IAAE,IAAMynB,EAAM,oCAAoC3nB,KAAK,KAAMksI,IACzEltI,KAAKe,IAAI8C,OAAOspI,GAChBntI,KAAKitI,QAAQnzI,KAAKozI,KAK1BF,MAAO,SAAS9tF,EAAS6nF,GACrB,IAAIqG,EAAiD,QAAtCrG,EAAM9rC,SAAS98F,IAAI,gBAA4B4oI,EAAMwC,OAAO3vI,OAAS,EACpFoG,KAAK8sI,iBAAiB/F,EAAM0E,OAAOe,MAAM7jH,IAAKykH,GAC9CrG,EAAMnmI,IAAI,OAAQR,IAAM2kD,QACxBgiF,EAAMngH,MAAM,OAAQ,kBACpB5mB,KAAKunE,IAAI8lE,WAAW,CAAEnuF,QAASA,EAAS6nF,MAAOA,EAAO3hH,QAASplB,KAAKunE,IAAIniD,QAAS6nH,QAASjtI,KAAKitI,aCtFvG,SAASK,GAAcC,EAAWC,GAC9B,IAAIpqE,EAAOrnE,SAASC,cAAc,KAClConE,EAAK0zC,SAAW02B,EAChBpqE,EAAK/+B,KAAOkpG,EACZnqE,EAAKrlD,QAET,SAAS0vH,GAAiBF,EAAWC,GACjCF,GAAcC,EAAUvkH,QAAQ,YAAa,sBAAhC,GAAAtjB,OAA0D8nI,GAAY,cAAtE,SA6HjB,SAASE,GAAM5tI,GACX,IAAI6tI,EAAO7tI,EAAQiB,IAAIsG,KAAK,OAC5B,GAAmB,GAAfsmI,EAAK/zI,SACDkG,EAAQ3C,MADhB,CAMA,IAAIywI,EAAQD,EAAK/zI,OACb8iC,EAAS35B,SAAS4qI,EAAKvoI,QAAQF,IAAI,WACnCo6B,EAAQv8B,SAAS4qI,EAAKvoI,QAAQF,IAAI,UAClC2oI,EAAa,IAAIC,cACjBC,EAAa7sI,IAAE,UAAUF,KAAK,CAC9Bs+C,QAAS,MACT0uF,MAAO,6BACP1uG,MAAOA,EAAQsuG,EACflxG,OAAQA,IAERqzC,EAAU,EASd,OARA49D,EAAKhpI,KAAK,WACN,IAAIgpI,EAAOzsI,IAAElB,MAAMsU,SAe3B,SAAiB25H,GACb,IAAK,IAAIC,KAAYnyI,SAASoyI,YAAa,CACvC,IAAIC,EAAQryI,SAASoyI,YAAYD,GAC7BG,EAAQD,EAAME,SAClB,GAAID,EACA,IAAK,IAAIE,EAAM,EAAGh2F,EAAM81F,EAAMz0I,OAAQ20I,EAAMh2F,EAAKg2F,IAC7C,IACIN,EAAQ5mI,KAAKgnI,EAAME,GAAKC,cAAc7pI,KAAK,SAASjL,EAAGsoC,GACnDA,EAAKr5B,MAAM8lI,SAAWJ,EAAME,GAAK5lI,MAAM8lI,UAE7C,MAAOtvI,GACLC,QAAQjC,MAAMgC,KAzB1BuvI,CAAQf,GACR,IAAIgB,EAAKztI,IAAE,2BAA6B6uE,EAAU,UAAU/uE,KAAK,QAAS,8BAC1E2tI,EAAG9qI,OAAO8pI,EAAKtmI,KAAK,KAAKjC,SACzB2oI,EAAWlqI,OAAO8qI,GAClB5+D,GAAWzwC,IAER,CACHsvG,OAAQf,EAAWgB,kBAAkBd,EAAW,IAChDrxG,OAAQA,EACR4C,MAAOA,GA1BHx/B,EAAQ3C,MAAM,0EAiDX,IAAA2xI,GAAA,CACXC,UAlMJ,SAAmBjvI,GACXA,EAAQiB,IAAIsG,KAAK,OAAOzN,OAAS,EA0EzC,SAAkBkG,GACd,IACIkvI,EAAMtB,GAAM5tI,GACZ0zC,EAASz3C,SAASC,cAAc,UAChCkqB,EAAUstB,EAAOV,WAAW,MAC5B7pC,EAAS,IAAIoqC,MACb40C,EAAa/mF,IAAE,gCAAgC2C,OAAO3C,IAAEsyC,IAC5DtyC,IAAE,QAAQ2C,OAAOokF,GACjBz0C,EAAOlU,MAPK,EAOG0vG,EAAI1vG,MACnBkU,EAAO9W,OARK,EAQIsyG,EAAItyG,OACpBzzB,EAAO5M,IAAM,6BAA+BiD,OAAO2vI,KAAKD,EAAIJ,QAC5D3lI,EAAOrM,OAAS,WACZspB,EAAQgpH,UAAUjmI,EAAQ,EAAG,EAAGuqC,EAAOlU,MAAOkU,EAAO9W,QACrD,IAAI6wG,EAAY/5F,EAAO27F,UAAU,aACjC1B,GAAiBF,EAAWztI,EAAQiF,OACpCkjF,EAAWl6E,UAxFXqhI,CAAStvI,GAyCjB,SAAqBA,GACjB,IAAIuvI,EAAUvvI,EAAQiB,IAAIsG,KAAK,yBAC/B,IACI,GAAwB,IAApBgoI,EAAQ/vG,SAAsC,IAArB+vG,EAAQ3yG,SAAgB,CACjD,IAAI4yG,EAAYvzI,SAASC,cAAc,UACvCszI,EAAUhwG,MAAQ+vG,EAAQ54G,YAAW,GACrC64G,EAAU5yG,OAAS2yG,EAAQrxG,aAAY,GACvC,IAAIuxG,EAAaD,EAAUx8F,WAAW,MACtCy8F,EAAW/9H,OACX+9H,EAAWl+D,UAAY,mBACvBk+D,EAAW99D,SAAS,EAAG,EAAG69D,EAAUhwG,MAAOgwG,EAAU5yG,QACrD6yG,EAAWC,UACXD,EAAWpjD,UAAU,EAAG,GACxBojD,EAAWE,UAAY,OACvBF,EAAWG,aAAe,MAC1BL,EAAQp7H,WAAWtP,KAAK,YAxCpC,SAASgrI,EAAS5uI,EAAK6uI,EAAUC,EAAUN,GACvC,IAAIld,EAAUtxH,EAAIsD,KAAK,WAAWooB,cAC9BnwB,EAAIyE,EAAIkqE,WACRz0C,EACAo5G,EACAtzI,EAAEk6B,KACFzzB,SAAShC,EAAImE,IAAI,cAAe,IAChCnC,SAAShC,EAAImE,IAAI,mBAAoB,IACrCnC,SAAShC,EAAImE,IAAI,eAAgB,IACjC44B,EACA+xG,EACAvzI,EAAEwhC,IACF/6B,SAAShC,EAAImE,IAAI,aAAc,IAC/BnC,SAAShC,EAAImE,IAAI,kBAAmB,IACpCnC,SAAShC,EAAImE,IAAI,cAAe,IACrB,OAAXmtH,GAA+B,QAAXA,EACpBtxH,EAAIkT,WAAWtP,KAAK,WAChBgrI,EAASzuI,IAAElB,MAAOw2B,EAAMsH,KAEV,UAAXu0F,GACPkd,EAAWL,UAAUnuI,EAAI,GAAIy1B,EAAMsH,GAqB3B6xG,CAASzuI,IAAElB,MAAO,EAAG,EAAGuvI,KAE5B,IAAMO,EAAUR,EAAUH,UAAU,aAChCW,GACArC,GAAiBqC,EAAShwI,EAAQiF,QAG5C,MAAO5F,GACLC,QAAQ6Q,MAAM,wCAA0C9Q,GACpDW,EAAQ3C,OACR2C,EAAQ3C,MAAM,sEAjElB4yI,CAAYjwI,IA+LhBkwI,UApGJ,SAAmBlwI,GAGfwtI,GAFe,yBAAA5nI,OAA4BpG,OAAO2vI,KAAKvB,GAAM5tI,GAAS8uI,SACxD,GAAAlpI,OAAM5F,EAAQiF,OAAS,cAAvB,UAmGdkrI,UA9FJ,SAAmBnwI,GACf,IAAIkvI,EAAMtB,GAAM5tI,GACZ1G,EAAO,CACPo0I,SAAU,gBACVxwI,KAAM,kBACN0/B,OAAQsyG,EAAItyG,OACZ4C,MAAO0vG,EAAI1vG,MACXqrD,MAAO,EACP3B,IAAKgmD,EAAIJ,QAET7tI,EAAMG,IAAE,QACR09E,EAAO79E,EAAIsG,KAAK,gBAWpB,IAAK,IAAIvJ,KAVW,IAAhB8gF,EAAKhlF,SACLglF,EAAO19E,IAAE,SAAU,CACff,GAAI,cACJolG,OAAQ,OACRznF,OAAQ,gCACRnX,QAAS,SAEb5F,EAAI8C,OAAO+6E,IAEfA,EAAKh7E,QACYxK,EAAM,CACnB,IAAI0P,EAAQ5H,IAAE,WAAY,CACtBlE,KAAM,SACNc,KAAMA,EACNS,MAAOnF,EAAK0E,KAEhB8gF,EAAK/6E,OAAOiF,GAEhB,IACI81E,EAAKlT,SACP,MAAOvsE,GACLC,QAAQ8a,IAAI/a,MCvILQ,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,GAAK,IAAA59D,EAAA3J,KACtBA,KAAKunE,IAAMA,EACXvnE,KAAKC,MAAQ,IAAIN,IAASO,MAAM,CAAEiD,SAAS,IAC3CnD,KAAKkwI,eAAiB,IAAIhhI,KAAGzE,OAAO,CAChClE,KAAM,kBACNzB,QAAS,UACTV,QAAS,WACLmjE,EAAIw/D,MAAMlkI,QAAQ,UAAU,MAGpC7C,KAAKmwI,cAAgB,IAAIjhI,KAAGxE,WAAW,CACnCnE,KAAM,YACNzB,QAAS,WAEb9E,KAAKmwI,cAAcxvF,QAAQ,CACvB9hD,IAAK,MACLkG,MAAO,cACPwB,KAAM,UACNnC,QAAS,WACLuF,EAAKymI,MAAM7oE,EAAIw/D,MAAO,WAClBsJ,GAAWtB,UAAU,CACjBhuI,IAAKwmE,EAAI+oE,OAAOvvI,IAChBgE,MAAOwiE,EAAIw/D,MAAM5oI,IAAI,SACrBhB,MAAO,SAAAgC,GACHooE,EAAIzkE,QAAQyB,OAAO,CAAEzB,QAAS3D,EAAK2G,OAAQ,mBAM/D9F,KAAKmwI,cAAcxvF,QAAQ,CACvB9hD,IAAK,MACLkG,MAAO,cACPwB,KAAM,iBACNnC,QAAS,WACLuF,EAAKymI,MAAM7oE,EAAIw/D,MAAO,WAClBsJ,GAAWL,UAAU,CACjBjvI,IAAKwmE,EAAI+oE,OAAOvvI,IAChBgE,MAAOwiE,EAAIw/D,MAAM5oI,IAAI,SACrBhB,MAAO,SAAAgC,GACHooE,EAAIzkE,QAAQyB,OAAO,CAAEzB,QAAS3D,EAAK2G,OAAQ,mBAM/D9F,KAAKmwI,cAAcxvF,QAAQ,CACvB9hD,IAAK,MACLkG,MAAO,cACPwB,KAAM,YACNnC,QAAS,WACLmjE,EAAInoC,MAAMj9B,KAAK,CACX4C,MAAO,2CACPs6B,KACI,kKACJiJ,QAAS,CACL2U,OAAQ,WACJsqB,EAAInoC,MAAM/8B,QAEdyiF,SAAU,WACNvd,EAAInoC,MAAM/8B,OACVsH,EAAKymI,MAAM7oE,EAAIw/D,MAAO,WAClBsJ,GAAWJ,UAAU,CACjBlvI,IAAKwmE,EAAI+oE,OAAOvvI,IAChBgE,MAAOwiE,EAAIw/D,MAAM5oI,IAAI,SACrBhB,MAAO,SAAAgC,GACHooE,EAAIzkE,QAAQyB,OAAO,CAAEzB,QAAS3D,EAAK2G,OAAQ,uBAS3E9F,KAAKuwI,YAAc,IAAIrhI,KAAGzE,OAAO,CAC7BlE,KAAM,uBACNzB,QAAS,OACTV,QAAS,WACLuF,EAAK1J,MAAMW,IAAI,WAAW,GAC1BtB,OAAOkxI,cAAc,IAAIC,MAAM,cAGvCzwI,KAAK0wI,aAAe,IAAIxhI,KAAGzE,OAAO,CAC9BlE,KAAM,wBACNzB,QAAS,OACTV,QAAS,WACLuF,EAAK1J,MAAMW,IAAI,WAAW,GAC1BtB,OAAOkxI,cAAc,IAAIC,MAAM,cAGvCzwI,KAAK2wI,YAAc,IAAIzhI,KAAGzE,OAAO,CAC7BlE,KAAM,UACNzB,QAAS,OACTV,QAAS,WACDmjE,EAAIw/D,MAAM5oI,IAAI,UACdopE,EAAIzkE,QAAQyB,OAAO,CACfzB,QAAO,WAAA4C,OAAa6hE,EAAIw/D,MAAM5oI,IAC1B,SADG,4DAGP2H,OAAQ,YAEZyhE,EAAIw/D,MAAMv1H,KAAK,CACXrU,MAAO,WACHoqE,EAAIzkE,QAAQyB,OAAO,CACfzB,QAAS,gCACTgD,OAAQ,eAKpByhE,EAAIzkE,QAAQyB,OAAO,CACfzB,QAAS,yBACTgD,OAAQ,cAKxB9F,KAAKsoC,QAAU,CAACtoC,KAAKuwI,YAAavwI,KAAK0wI,aAAc1wI,KAAKkwI,eAAgBlwI,KAAKmwI,cAAenwI,KAAK2wI,aACnG3wI,KAAKa,WAAW,UAvHM,IAAA6lD,GAAA,EAAAC,GAAA,EAAAC,OAAAtpD,EAAA,IAwHtB,QAAAupD,EAAAC,EAAc9mD,KAAKsoC,QAAnBjqC,OAAA0oD,cAAAL,GAAAG,EAAAC,EAAAxpC,QAAAtP,MAAA04C,GAAA,EAA4B,KAAnBz6B,EAAmB46B,EAAAtoD,MACxByB,KAAKe,IAAI8C,OAAOooB,EAAElrB,MAzHA,MAAA5B,GAAAwnD,GAAA,EAAAC,EAAAznD,EAAA,YAAAunD,GAAA,MAAAI,EAAAU,QAAAV,EAAAU,SAAA,WAAAb,EAAA,MAAAC,GA2HtB5mD,KAAKiC,SAASjC,KAAKC,MAAO,SAAU,kBAAM0J,EAAKzH,WAC/ClC,KAAKkC,UAGTA,OAAQ,WACJ,IAAIiB,EAAUnD,KAAKC,MAAM9B,IAAI,WAC7B6B,KAAKunE,IAAIxmE,IAAIoC,EAAU,cAAgB,YAAY,qBACnDnD,KAAKkwI,eAAejwI,MAAMW,IAAI,UAAWuC,KAAanD,KAAKunE,IAAIw/D,MAAM0E,OAAOe,MAAMhpE,SAClFxjE,KAAK2wI,YAAY1wI,MAAMW,IAAI,UAAWuC,GACtCnD,KAAKmwI,cAAclwI,MAAMW,IAAI,UAAWuC,GACxCnD,KAAK0wI,aAAazwI,MAAMW,IAAI,UAAWuC,GACvCnD,KAAKuwI,YAAYtwI,MAAMW,IAAI,WAAYuC,GACvC,IAAIhI,EAAU6E,KAAKunE,IAAIw/D,MAAM0E,OAAOe,MAAMrxI,SAAW,GACrD6E,KAAKmwI,cAAcp3H,WAAWpU,KAAK,SAAA1E,GAC/BA,EAAMW,IAAI,WAAkD,IAAvCzF,EAAQuG,QAAQzB,EAAM9B,IAAI,YAIvDiyI,MAAO,SAASrJ,EAAOzzH,GACftT,KAAKunE,IAAIroC,SAASyF,QAClBrxB,IAEAtT,KAAKunE,IAAIzkE,QAAQyB,OAAO,CACpBzB,QAAS,mFC5IVnD,OAASD,KAAKE,OAAO,CAChCC,WAAY,SAASC,GAAS,IAAA6J,EAAA3J,KACtBsP,EAASC,cACbvP,KAAKo/B,MAAQ9vB,GAAUA,EAAO8vB,MAAQ9vB,EAAO8vB,MAAQ,IAAIv0B,KAAMnL,KAC/DM,KAAKa,WACDK,IAAE,UACGkB,SAAS,iBACTyB,OAAO3C,IAAE,UAAUkB,SAAS,mBAC5ByB,OAAO3C,IAAE,UAAUkB,SAAS,kBAC5ByB,OAAO3C,IAAE,UAAUkB,SAAS,kBAErCpC,KAAK4wI,QAAU5wI,KAAKkB,EAAE,kBACtBlB,KAAK6wI,OAAS7wI,KAAKkB,EAAE,iBACrBlB,KAAKqiF,SAAWriF,KAAKkB,EAAE,mBACvBlB,KAAK+mI,MAAQ,IAAI+J,GAAM,GAAIhxI,GAC3BE,KAAK+mI,MAAM0E,OAAS3rI,EAAQixI,qBAC5B/wI,KAAK+mI,MAAM0E,OAAOe,MAAQxsI,KAAK+mI,MAAM0E,OAAOe,OAAS,GACrDxsI,KAAKqtI,WAAavtI,EAAQutI,WAC1BrtI,KAAK8C,QAAU,IAAIoM,KAAGrH,QACtB7H,KAAKk/B,SAAW,IAAIC,KACpBn/B,KAAKswI,OAAS,IAAIU,GAAOhxI,MACzBA,KAAK8oD,OAAS,IAAImoF,GAAOjxI,MACzBA,KAAKskC,KAAO,IAAIuM,GAAK7wC,MACrBA,KAAK4wI,QAAQ/sI,OAAO7D,KAAKswI,OAAOvvI,KAChCf,KAAK6wI,OAAOhtI,OAAO7D,KAAK8C,QAAQ/B,KAAK8C,OAAO7D,KAAK8oD,OAAO/nD,KACxDf,KAAKqiF,SAASx+E,OAAO7D,KAAKskC,KAAKvjC,KAC/BG,IAAEqzB,KAAK,CACHhpB,IAAG,GAAA7F,OAAK8F,uBAAL,iBAAA9F,OAAiC5F,EAAQ+sC,cAE3C7+B,KAAK,SAAAoX,GACFzb,EAAKyb,QAAUA,EACfzb,EAAKo9H,MAAMtiG,OACX96B,EAAKo9H,MAAMlkI,QAAQ,YAEtB0lB,KAAK,SAAArf,GACF,IAAIpG,EAAUoG,EAAS2rB,cAAgB3rB,EAAS2rB,aAAawuD,QAC7D15E,EAAKunI,aAAepuI,GAAW,wCCC3C4iD,GAAS,GACTroD,GAAU,SAASyC,GACnB,IAAIypI,EAASzpI,EAAQqxI,eACjBtkG,EAAa/sC,EAAQ+sC,WAErBukG,EAAc,GAClB7H,EAAO5kI,KAAK,SAASwkI,GACjBzkI,IAAEC,KAAKwkI,EAAMhrI,IAAI,kBAAmB,SAASkzI,EAAYC,GACrD,IAAItW,EAASmO,EAAMhrI,IAAImzI,GACnBC,EAAWC,GAAU3kG,EAAYmuF,IAEA,IAAjCoW,EAAY1vI,QAAQs5H,IACnBt1E,GAAO6rF,IACE,QAAVvW,GACU,QAAVA,QACW19H,IAAX09H,GAEAoW,EAAYt3I,KAAKkhI,OAIF,IAAvBoW,EAAYx3I,OAKhBwG,IAAMjC,IAAI,CACNoN,IAAKC,uBAAe,gBAAkBqhC,EACtCzzC,KAAM,CACFs0C,UAAW,WACX+jG,SAAU,iBACVC,QAASN,EAAYzkI,YAEzBy0B,QAAS,SAASl4B,GAGd,IAFA,IAAIyoI,EAAgBP,EAAYx3I,OAC5B8tG,EAAU,IAAI9nF,MAAM+xH,GACfj4I,EAAI,EAAGA,EAAIguG,EAAQ9tG,OAAQF,IAChCguG,EAAQhuG,GAAK,GAEjB,IAAK,IAAIA,KAAKwP,EAAS9P,KAAM,CACzB,IAAIw0G,EAAM1kG,EAAS9P,KAAKM,GACxB,IAAK,IAAIkB,KAAKgzG,EAAK,CACf,IAAIpsG,EAAIosG,EAAIhzG,QACF0C,IAANkE,GAAwB,YAALA,GAAmB5G,EAAI+2I,GAC1CjqC,EAAQ9sG,GAAGd,KAAK0H,IAK5B,IAAK,IAAI9H,KADT0F,QAAQ6Q,MAAM,mDACAy3F,EAAS,CACnB,IAAIszB,EAASoW,EAAY13I,GACrB63I,EAAWC,GAAU3kG,EAAYmuF,GACrCt1E,GAAO6rF,GAAY7pC,EAAQhuG,GAE/Bk4I,GAAe9xI,MAhCnB8xI,GAAe9xI,IAsCnB8xI,GAAiB,SAAS9xI,GAC1B,IAAIypI,EAASzpI,EAAQqxI,eACjBtkG,EAAa/sC,EAAQ+sC,WACzBztC,QAAQ6Q,MAAM,oEACd,IAAIiI,EAAQ,EACZqxH,EAAO5kI,KAAK,SAASwkI,GACjBzkI,IAAEC,KAAKwkI,EAAMhrI,IAAI,kBAAmB,SAASkzI,EAAYC,GACrD,IAAItW,EAASmO,EAAMhrI,IAAImzI,GACnBC,EAAWC,GAAU3kG,EAAYmuF,GACjC6W,EAAcnsF,GAAO6rF,GACrBM,IACA35H,EAAQvV,KAAKpC,IAAI2X,EAAO25H,EAAYj4I,aAIlC,IAAVse,IACA9Y,QAAQ6Q,MAAM,2DACVnQ,EAAQinI,OACRjnI,EAAQinI,MAAMngH,MAAM,SAAU,uBAGtC,IAAI8gF,EAAU,GACd6hC,EAAO5kI,KAAK,SAASwkI,EAAO2I,GAExB,IADA,IAAIC,EAAO3xI,IAAM0O,MAAM,CAAEjQ,IAAKizI,EAAc,IAAM3I,EAAMhrI,IAAI,OAAQsH,OAAQ,IAAM0jI,EAAMtnI,YAC/EjH,EAAI,EAAGA,EAAIsd,EAAOtd,IACvBm3I,EAAKtsI,OAAO7K,GAAK,CAAE4xB,EAAGzpB,SAASnI,IAEnC8sG,EAAQ5tG,KAAKi4I,KAEjBxI,EAAO5kI,KAAK,SAASwkI,EAAO2I,GACxB,IAAIrsI,EAASiiG,EAAQoqC,GAAarsI,OAClCf,IAAEC,KAAKwkI,EAAMhrI,IAAI,kBAAmB,SAASkzI,EAAYC,GACrD,IAAItW,EAASmO,EAAMhrI,IAAImzI,GACvB,OAAQtW,GACJ,IAAK,OACD,IAAK,IAAIpgI,EAAI,EAAGA,EAAIsd,EAAOtd,IACvB6K,EAAO7K,GAAG02I,GAAevuI,SAASnI,GAEtC,MACJ,IAAK,OACD,IAAK,IAAIA,EAAI,EAAGA,EAAIsd,EAAOtd,IACvB6K,EAAO7K,GAAG02I,GAAe,EAE7B,MACJ,QAGI,IAFA,IAAIC,EAAWC,GAAU3kG,EAAYmuF,GACjC6W,EAAcnsF,GAAO6rF,GAChB32I,EAAI,EAAGA,EAAIsd,EAAOtd,IAAK,CAC5B,IAAI2D,EAAQkH,EAAO7K,GACf4G,EAAIqwI,EAAYj3I,GAChB8H,MAAMlB,KAAO6vI,EAAWlF,WACxB3qI,EAAI,GAERjD,EAAM+yI,GAAe9vI,QAKzC1B,EAAQshC,QAAQsmE,IAIhB8pC,GAAY,SAAS3kG,EAAYmuF,GACjC,OAAOnuF,EAAa,KAAYmuF,GAGrBrrG,GAAA,CAAEtyB,QAASA,GAAS20I,cAzKf,SAASlyI,GACzB,IAAIo/C,EAAUp/C,EAAQo/C,QAClB6nF,EAAQjnI,EAAQinI,MAChB7kI,EAASpC,EAAQoC,OACjB+qI,EAAUntI,EAAQmtI,QAClBpgG,EAAa/sC,EAAQ+sC,YAAc/sC,EAAQinI,MAAM5oI,IAAI,cACrDgzI,EAAiBrxI,EAAQqxI,gBAAkBrxI,EAAQinI,MAAMwC,OAC7DlsI,GAAQ,CACJ0pI,MAAOA,EACPl6F,WAAYA,EACZskG,eAAgBA,EAChB/vG,QAAS,SAAS3mC,GACd,IACI,GAAIwyI,EAAQrzI,QAAUa,EAAOb,OAAQ,CACjC,IAAIq4I,GAAQ,EACZ,IAAK,IAAIH,KAAer3I,EAAQ,CAC5B,IAAI0uI,EAAQ1uI,EAAOq3I,GACnB,IAAK5vI,EAAO+qI,EAAQ6E,GAAc,CAAC3I,IAAS,CACxC8I,GAAQ,EACR,OAGJA,GACAlL,EAAMngH,MAAM,KAAM,iCAEG,GAAlBqmH,EAAQrzI,OACXsI,EAAO+qI,EAAQ,GAAIxyI,IACnBssI,EAAMngH,MAAM,KAAM,gBAGtBmgH,EAAMngH,MAAM,SAAU,wBAE1Bs4B,EAAQvjD,UACV,MAAOwD,GACLC,QAAQ6Q,MAAM,8CAAgD9Q,GAC9D4nI,EAAMngH,MAAM,SAAUznB,GACtB+/C,EAAQtjD,eC8BxB,SAASs2I,GAAcC,EAAO5I,GAC1B7kI,IAAEC,KAAK4kI,EAAQ,SAASJ,GACpBzkI,IAAEC,KAAKwkI,EAAM1jI,OAAQ,SAAS2sI,EAAY14I,GACtC,IAAK,IAAImF,KAAOszI,EACZC,EAAWvzI,GAAOkE,SAASrJ,OAiJ5B,IAAAsvD,GAAA,CACXqpF,eA1KJ,SAAwB9I,EAAQ+I,GAC5B,IAAIH,EAAQ,GACRzG,EAAenC,EAAO,GAAGgJ,eAc7B,OAbA7tI,IAAEC,KAAK2tI,EAAa,SAASzzI,GACrB6sI,EAAa7sI,GAAKstI,WAClBgG,EAAMtzI,GAAO,MAGjB0qI,GAAUA,EAAO,IACjB7kI,IAAEC,KAAK4kI,EAAO,GAAG9jI,OAAQ,SAAS2sI,GAC9B,IAAK,IAAIvzI,KAAOszI,EACZA,EAAMtzI,GAAK/E,KAAKkJ,OAAOovI,EAAWvzI,OAI9CqzI,GAAcC,EAAO5I,GACd,CAAE4I,MAAOA,IA2JhBK,qBA5IJ,SAA8BjJ,EAAQkJ,GAClC,IAAIptB,EAAa,GACb8sB,EAAQ,GACRO,EAAU,GACVhH,EAAenC,EAAO,GAAGgJ,eAS7B,IAAK,IAAI74I,KARTgL,IAAEC,KAAK+mI,EAAc,SAAS2F,EAAYxyI,GAClCwyI,EAAWlF,WACX9mB,EAAWxmH,GAAO,GAClBszI,EAAMtzI,GAAO,GACb6zI,EAAQ7zI,GAAO,KAIT0qI,EAAQ,CAClB,IAAIJ,EAAQI,EAAO7vI,GACnB,IAAK,IAAIkB,KAAKuuI,EAAM1jI,OAAQ,CACxB,IAAI2sI,EAAajJ,EAAM1jI,OAAO7K,GAC9B,IAAK,IAAIiE,KAAOwmH,EAAY,CACxB,IAAI9mH,EAAQyE,OAAOovI,EAAWvzI,SACCvB,IAA3B+nH,EAAWxmH,GAAKN,KAChB8mH,EAAWxmH,GAAKN,GAASm0I,EAAQ7zI,GACjCszI,EAAMtzI,GAAK/E,KAAK24I,EAAa,CAACC,EAAQ7zI,GAAMN,GAASA,GACrDm0I,EAAQ7zI,QAMxB,IAAK,IAAInF,KAAK6vI,EAAQ,CAClB,IAAIJ,EAAQI,EAAO7vI,GACnB,IAAK,IAAIkB,KAAKuuI,EAAM1jI,OAAQ,CACxB,IAAI2sI,EAAajJ,EAAM1jI,OAAO7K,GAC9B,IAAK,IAAIiE,KAAOwmH,EAAY,CACxB,IAAI9mH,EAAQyE,OAAOovI,EAAWvzI,IAC9BuzI,EAAWvzI,GAAOwmH,EAAWxmH,GAAKN,KAI9C,MAAO,CACH8mH,WAAYA,EACZ8sB,MAAOA,EACPO,QAASA,IAoGbC,WArMJ,SAAoBpJ,EAAQznG,GACxB,IAAI8wG,EAAY,GAChB,IAAK,IAAId,KAAevI,EAAQ,CAC5B,IAAIJ,EAAQI,EAAOuI,GACf14I,EAAO,GACX,IAAK,IAAIy5I,KAAe1J,EAAM1jI,OAAQ,CAClC,IAAIqtI,EAAQ,GACZ,GAAIhxG,EACA,IAAK,IAAIixG,KAAajxG,EAAM,CACxB,IAAIkxG,EAAelxG,EAAKixG,GACxBD,EAAMh5I,KAAKqvI,EAAM1jI,OAAOotI,GAAaG,SAGzC,IAAK,IAAIA,KAAgB7J,EAAM1jI,OAAOotI,GAClCC,EAAMh5I,KAAKqvI,EAAM1jI,OAAOotI,GAAaG,IAG7C55I,EAAKU,KAAKg5I,GAEdF,EAAU94I,KAAKV,GAEnB,OAAOw5I,GAiLPK,WA7NJ,SAAoB1J,EAAQznG,GACxB,SAASoxG,EAAOC,EAAUt0I,GACtB,IAAIN,EACJ,IAAK,IAAIuzI,KAAevI,EAAQ,CAC5B,IAAI6J,EAAYvnD,GAAGsnD,GAAU5J,EAAOuI,GAAarsI,OAAQ,SAAS5H,GAC9D,OAAOA,EAAEgB,KAEbN,OAAkBjB,IAAViB,EAAsB60I,EAAYzwI,KAAKwwI,GAAU50I,EAAO60I,GAEpE,OAAO70I,EAEX,IAAI9D,EAAS,GACb,IAAK,IAAI2R,KAAS01B,EAAM,CACpB,IAAIjjC,EAAMijC,EAAK11B,GACf3R,EAAOoE,GAAO,CACVyB,IAAK4yI,EAAO,MAAOr0I,GACnB0B,IAAK2yI,EAAO,MAAOr0I,IAG3B,OAAOpE,GA2MPy3I,cAAeA,GACfmB,eAlGJ,SAAwBvzI,GACpB,IAAI9C,EAAO8C,EAAQ9C,KACfs2I,EAAYxzI,EAAQwzI,UACpBjuB,EAAavlH,EAAQulH,WACrBkuB,EAAYzzI,EAAQyzI,UACxB,GAAY,QAARv2I,EACAu2I,EAAU,WACN,MAAO,UAER,GAAY,QAARv2I,EACHqoH,GACAkuB,EAAU,SAASh1I,GACf,OAAO8mH,EAAW9mH,IAAU,SAGjC,CACH,IAAIi1I,EAAW,SAAS31I,GACpB,OAAQb,GACJ,IAAK,IACD,IAAIy2I,EAAS5nD,gBAAgBhuF,GAC7B,OAAO41I,EAAO9oD,MAAM9sF,GAAG0sF,UAAYkpD,EAAOC,OAC9C,QACI,OAAO7nD,UAAU,IAAMynD,EAAYt2I,EAA5B6uF,CAAkChuF,KAIjD01I,EADAluB,EACU,SAAS9mH,GACf,IAAI2H,EAAQm/G,EAAW9mH,GACvB,IAAI2H,EAWA,MAAO,GAVP,GAAIxD,MAAMwD,GACN,OAAOA,EAEP,IACI,OAAOstI,EAASttI,GAClB,MAAO/G,GACL,OAAO+G,IAQb,SAAS3H,GACf,OAAOi1I,EAASj1I,OAuD5Bo1I,QAhDJ,SAAiB7zI,GACb,IAAI43F,EAAc,IACd6vC,EAAQznI,EAAQynI,MAChBsB,EAAQ/oI,EAAQ+oI,MAChB+K,EAAU9zI,EAAQ8zI,SAAW/K,EAAMl+C,QAAQsG,OAC3C4iD,EAAU/zI,EAAQ+zI,SAAWtM,EAAM58C,QAAQsG,OAC3CnsB,EAAShlE,EAAQglE,OACjBkkB,EAAMlpF,EAAQkpF,IACd8qD,EAASjL,EAAMl+C,QACfopD,EAASxM,EAAM58C,QACfqpD,EAAaF,EAAO7iD,SAASzxF,QAC7By0I,EAAaF,EAAO9iD,SAASzxF,QAC7B00I,EAASroD,YAAYI,OAGzB,SAASkoD,EAAUljD,EAAQmjD,GAGvB,OAFAnjD,EAAO,GAAKtuF,KAAKrC,IAAIqC,KAAKpC,IAAI0wF,EAAO,GAAImjD,EAAS,IAAKA,EAAS,GAAKA,EAAS,GAAK18C,GACnFzG,EAAO,GAAKtuF,KAAKpC,IAAI6zI,EAAS,GAAKA,EAAS,GAAK18C,EAAa/0F,KAAKrC,IAAI2wF,EAAO,GAAImjD,EAAS,KACpFnjD,EAoBX,OAzBA6iD,EAAOO,OACPN,EAAOM,OAkBPH,EACK1nH,EAAEsnH,GACFpnH,EAAEqnH,GACFr8C,YAAY,CAAC,EAAGA,IAChBr2F,GAAG,OAhBR,WACIwyI,EAAQM,EAAUJ,EAAO9iD,SAAUgjD,IACnCL,EAAQO,EAAUL,EAAO7iD,SAAU+iD,IACnClvE,MAcJkkB,EAAI9uF,KAAKg6I,GAAQ7yI,GAAG,gBAZpB,WACIuyI,EAAQI,GACRH,EAAQI,GACRnvE,IACAovE,EAAOvpD,MAAM,GACbupD,EAAO/nD,UAAU,CAAC,EAAG,MAQlB+nD,ICjHP3uI,GAAO,SAAPA,EAAgBwhI,EAAO3lG,EAASjkC,GAChCiD,IAAM/C,QAAQ,CACVL,KAAM,MACNuO,IAAKC,uBAAe,gBAAkBu7H,EAAM5oI,IAAI,kBAChD/E,KAAM,GACNgoC,QAAS,SAAShc,GACd,IAAIuf,GAAQ,EACZ,OAAQvf,EAAQwB,OACZ,IAAK,KACDmgH,EAAMngH,MAAM,OAAQ,iCAChBwa,GACAA,EAAQhc,GAEZuf,GAAQ,EACR,MACJ,IAAK,QACDoiG,EAAMngH,MAAM,SAAU,yDAClBzpB,GACAA,EAAMioB,GAEVuf,GAAQ,EACR,MACJ,IAAK,UACDoiG,EAAMngH,MACF,OACA,yIAGP+d,GACDrlC,OAAO/B,WAAW,WACdgI,EAAKwhI,EAAO3lG,EAASjkC,IAhIxB,SAwIbm3I,GAAc,WACd,IAAIhlI,EAASC,cACTD,GAAUA,EAAOy9B,kBACjBz9B,EAAOy9B,iBAAiBwnG,mBAIjBC,GAAA,CAAEn3I,QA1GH,SAAS0pI,EAAOjgB,EAAY1lF,EAASjkC,GAC/C4pI,EAAMngH,MAAM,OAAQ,6BAChBmgH,EAAM5oI,IAAI,aAAe4oI,EAAM5oI,IAAI,oBACnCiC,IAAM/C,QAAQ,CACVL,KAAM,MACNuO,IAAKC,uBAAe,+BAAiCu7H,EAAM5oI,IAAI,kBAC/D/E,KAAM,CAAEk4G,SAAS,GACjBlwE,QAAS,WACLkzG,QAGRvN,EAAMnmI,IAAI,iBAAkB,MAC5BmmI,EAAMnmI,IAAI,YAAY,IAEtBmmI,EAAM5oI,IAAI,kBACVoH,GAAKwhI,EAAO3lG,EAASjkC,IAErB4pI,EAAMngH,MAAM,OAAQ,0BACpBxmB,IAAM/C,QAAQ,CACVL,KAAM,OACNuO,IAAKC,uBAAe,YACpBpS,KAAM0tH,EACN1lF,QAAS,SAASl4B,GACd,GAAKA,EAASw0E,SAAuC,IAA5Bx0E,EAASw0E,QAAQ9jF,OAKnC,CACH06I,KACA,IAAIG,EAAMvrI,EAASw0E,QAAQ,GAC3BqpD,EAAMngH,MACF,OACA,mGAEJmgH,EAAMnmI,IAAI,iBAAkB6zI,EAAIt0I,IAChC4mI,EAAMv1H,OACNjM,GAAKwhI,EAAO3lG,EAASjkC,QAbrB4pI,EAAMngH,MAAM,SAAU,uCAClBzpB,GACAA,KAcZA,MAAO,SAAS+L,GACZ,IAAIpG,EAAU,GACVoG,GAAYA,EAASpG,SAAWoG,EAASpG,QAAQ1J,MAAQ8P,EAASpG,QAAQ1J,KAAK0P,QAC/EhG,EAAUoG,EAASpG,QAAQ1J,KAAK0P,MAAQ,KAE5Ci+H,EAAMngH,MACF,SACA,oCACIkgG,EAAW3pC,QACX,6CACAr6E,GAEJ3F,GACAA,SAqDeu3I,cA5If,SAAS3N,EAAO3rI,GAChC,IAAIu5I,EAAkB,GAClBC,EAAiB,GACjB9C,EAAc,EAClB,IAAK,IAAIjzI,KAAOkoI,EAAM9rC,SAASp5F,WAAY,CACvC,IAAIgzI,EAAiB9N,EAAM9rC,SAAS98F,IAAIU,GACxC6F,IAAEC,KAAK,CAAC,CAAC,IAAK,SAAU,CAAC,IAAK,SAAU,CAAC,IAAK,UAAW,SAASsB,GAC9D4uI,EAAiBA,EAAe7rH,QAAQ,IAAI+F,OAAO9oB,EAAK,GAAI,KAAMA,EAAK,MAE3E0uI,GAAmB91I,EAAM,IAAMg2I,EAAiB,KAUpD,OARAF,EAAkBA,EAAgB1xI,UAAU,EAAG0xI,EAAgB/6I,OAAS,GACxEmtI,EAAMwC,OAAO5kI,KAAK,SAASwkI,GACvB2I,IACAptI,IAAEC,KAAKwkI,EAAMhrI,IAAI,kBAAmB,SAASutI,EAAc5tI,GACvD82I,GAAkB92I,EAAO,IAAMg0I,EAAc,KAAO/uI,SAASomI,EAAMhrI,IAAIL,IAAS,GAAK,SAG7F82I,EAAiBA,EAAe3xI,UAAU,EAAG2xI,EAAeh7I,OAAS,GAC9D,CACHujF,QAAS,uDACTM,OAAQ,CACJ30E,MAAO,CACH3I,GAAI4mI,EAAM5oI,IAAI,cACd9B,IAAK,OAETjB,OAAQA,EACR8hI,QAAS0X,EACT35C,SAAU05C,yBCtCmLG,GCQzM,CACAhqH,QADA,WAEA9qB,KAAA+0I,kBAGAC,QALA,WAMAh1I,KAAA+0I,kBAGApqH,QAAA,CACAoqH,eADA,WAGA,GAAAz1I,OAAAw+B,MAAAx+B,OAAA,CAIA,IAAAwkC,EAAA/pC,OAAAk7I,EAAA,EAAAl7I,GAGA+pC,EAAAoB,WACApB,EAAAoB,SAAA,IAAAA,GAAA,EAAAxlC,KAAAM,KAAAk1I,SAIA,IAAAC,EAAArxG,EAAAoB,SAAAhjC,SACAlC,KAAAe,IAAAtD,YAAA03I,EAAAp0I,IAAA,0BCdeq0I,GAXCr7I,OAAA0vB,GAAA,EAAA1vB,CACd+6I,GCTQ,WAAgB,IAAanrH,EAAb3pB,KAAa4pB,eAAkD,OAA/D5pB,KAAuC6pB,MAAAC,IAAAH,GAAwB,OAAiBsB,MAAA,CAAO9qB,GAAA,eACjH,IDWA,EACA,KACA,KACA,cERO,SAASk1I,GAAapyG,EAAQ9c,GAGjC,OAFA/mB,QAAQ8a,IAAI,gBAEL,IADSsnC,KAAI5hD,OAAOw1I,IACpB,CAAc,CACjB1sH,MAAO3uB,OAAO+nC,KAAKmB,GACnB0e,UAAW1e,EACXtmB,GAAIwJ,ICPL,SAASmvH,GAAgBC,GAC5Bn2I,QAAQ8a,IAAI,mBACZ9a,QAAQ8a,IAAI,wGAF6B,IAInCs7H,EAAmED,EAAnEC,WAAYC,EAAuDF,EAAvDE,YAAaC,EAA0CH,EAA1CG,mBAAoBC,EAAsBJ,EAAtBI,kBAEnD,GAAIH,EAAY,CACZ,IAAII,EAAK,IAAIt2I,OAAOu2I,cAAcC,OAAOC,UAAU,CAC/Cp5H,GAAIg5H,IAERr2I,OAAO02I,iBAAmB,SAASxpH,GAC/BptB,QAAQ8a,IAAI,iCACZ07H,EAAGK,YAAYzpH,IAIvB,GAAIipH,EAAa,CACb,IAAIS,EAAK,IAAI52I,OAAOu2I,cAAcC,OAAOK,WAAW,CAChDx5H,GAAI+4H,IAERp2I,OAAO82I,qBAAuB,SAAS5pH,GACnCptB,QAAQ8a,IAAI,8BAA+BsS,GAC3C0pH,EAAGE,qBAAqB5pH,IAE5BltB,OAAO+2I,kBAAoB,SAAS7pH,GAChCptB,QAAQ8a,IAAI,2BAA4BsS,GACxC0pH,EAAGD,YAAYzpH,uCzEGpB,SAAA8pH,GAAAx2I,GACP,IAAQitH,GAAav6B,UAAA1yF,GAGd,SAASy2I,GAASz2I,GACzB,IAAQ02I,GAAA,EAAe12I,GAGhB,SAAS22I,GAAQ32I,GACxB,IAAQyyF,GAAQC,UAAA1yF,GAGT,SAAS42I,GAAQ52I,GACxB,IAAQ62I,GAAY72I,GAGb,SAAS82I,GAAO92I,GACvB,IAAQ2gH,GAAajuB,UAAA1yF,GAGd,SAAA+2I,GAAA/2I,GACP,IAAA6lG,EAAA,IAAwBmxC,GAAA,EAAiB,IACzC3lI,eAAArR,EAAAi3I,iBACAphI,MAAA7V,EAAA6V,MACA+C,kBAAA5Y,EAAAoY,MACAS,cAAA7Y,EAAAoY,MACA4iH,iBAAAh7H,EAAAk3I,qBAEAC,EAAA,IAAyBte,GAAUC,kBAAA,CACnCj8G,GAAYu6H,IAAC,WAAA/4I,IAAA,GACbwnG,cAGAA,EAAA9sF,WAAA,CAA0BjD,QAAA,IAAe5H,KAAA,WACzCipI,EAAAnd,gBACAmd,EAAA/0I,OAAA,KAgBO,SAASi1I,GAAKr3I,GACrB,WAAes3I,GAAMt3I,GAvFrB/E,EAAA8C,EAAA+M,EAAA,kCAAA0rI,KAAAv7I,EAAA8C,EAAA+M,EAAA,8BAAA2rI,KAAAx7I,EAAA8C,EAAA+M,EAAA,6BAAA6rI,KAAA17I,EAAA8C,EAAA+M,EAAA,6BAAA8rI,KAAA37I,EAAA8C,EAAA+M,EAAA,4BAAAgsI,KAAA77I,EAAA8C,EAAA+M,EAAA,iCAAAisI,KAAA97I,EAAA8C,EAAA+M,EAAA,0BAAAusI,KAAAp8I,EAAA8C,EAAA+M,EAAA,mCAAAysI,KAAAt8I,EAAA8C,EAAA+M,EAAA,sCAAAqqI,EAAA,IAAAl6I,EAAA8C,EAAA+M,EAAA,sCAAAqqI,EAAA,IAAAl6I,EAAA8C,EAAA+M,EAAA,gCAAA4rI,GAAA,IAAAz7I,EAAA8C,EAAA+M,EAAA,6BAAAwsF,KAAAr8F,EAAA8C,EAAA+M,EAAA,2CAAAkyF,KAAA/hG,EAAA8C,EAAA+M,EAAA,+CAAA00F,KAAAvkG,EAAA8C,EAAA+M,EAAA,0BAAA8lH,KAAA31H,EAAA8C,EAAA+M,EAAA,oDAAA0sI,GAAA,IAAAv8I,EAAA8C,EAAA+M,EAAA,4BAAAksI,GAAA,IAAA/7I,EAAA8C,EAAA+M,EAAA,oCAAA2sI,GAAA,IAAAx8I,EAAA8C,EAAA+M,EAAA,4BAAA4sI,GAAA,IAAAz8I,EAAA8C,EAAA+M,EAAA,yCAAA61H,KAAA1lI,EAAA8C,EAAA+M,EAAA,sCAAA6sI,GAAA,IAAA18I,EAAA8C,EAAA+M,EAAA,oCAAA8sI,GAAA,IAAA38I,EAAA8C,EAAA+M,EAAA,6BAAA+sI,GAAA,IAAA58I,EAAA8C,EAAA+M,EAAA,mCAAAgtI,KAAA78I,EAAA8C,EAAA+M,EAAA,iCAAAs7H,KAAAnrI,EAAA8C,EAAA+M,EAAA,qCAAA29H,KAAAxtI,EAAA8C,EAAA+M,EAAA,mCAAAu/H,KAAApvI,EAAA8C,EAAA+M,EAAA,2BAAAitI,GAAA,IAAA98I,EAAA8C,EAAA+M,EAAA,oCAAAu3E,KAAApnF,EAAA8C,EAAA+M,EAAA,+BAAAk3E,KAAA/mF,EAAA8C,EAAA+M,EAAA,iCAAA+0C,KAAA5kD,EAAA8C,EAAA+M,EAAA,+BAAAm3E,KAAAhnF,EAAA8C,EAAA+M,EAAA,0BAAAktI,KAAA/8I,EAAA8C,EAAA+M,EAAA,mCAAAmtI,GAAA,IAAAh9I,EAAA8C,EAAA+M,EAAA,qCAAAmtI,GAAA,IAAAh9I,EAAA8C,EAAA+M,EAAA,oCAAAw7E,GAAA,IAAArrF,EAAA8C,EAAA+M,EAAA,iCAAAyqI,KAAAt6I,EAAA8C,EAAA+M,EAAA,oCAAA0qI,KAAAv6I,EAAA8C,EAAA+M,EAAA,kCAAAssD,GAAA,IAAAn8D,EAAA8C,EAAA+M,EAAA,0BAAAotI,GAAAhsH,IA0FO,IAAAqrH,GAAA,CACPY,SAActoH,GACduoH,KAAU1D,GACV2D,OAAYnvF,sG0E3FCmlE,EAAiB,CAC1BruH,QAAS,CACLkkC,KAAMo0G,eAEV/1F,aAAc,GACdg2F,uBAAuB,EACvBC,OAAQ,YCRZv9I,EAAA8C,EAAA+M,EAAA,4BAAA2tI,IAAAx9I,EAAA8C,EAAA+M,EAAA,wBAAAhK,IAAA7F,EAAA8C,EAAA+M,EAAA,wBAAAzM,IAAApD,EAAA8C,EAAA+M,EAAA,+BAAAY,IAAAzQ,EAAA8C,EAAA+M,EAAA,sCAAA4tI,EAAA,IAiCA,MAAA1vI,EAAA,IAAkB2vI,EAAA,EAClBC,EAAA5vI,EAAA6vI,KACI5+I,OAAAqT,EAAA,EAAArT,CAAM47G,gBAAA57G,QACNA,OAAA6+I,EAAA,EAAA7+I,CAAI,CAAAkpC,EAAA0yE,IACR57G,OAAAwyD,OAAA,GAA+BtpB,EAAA0yE,GACxBwY,IAIP0qB,EAAA,IAA2BC,EAAA,EAAgB3qB,GAC3CuqB,EAAAK,UAAAF,GAGO,MAAAN,EAAAM,EAAAG,eAAAL,KACH5+I,OAAAqT,EAAA,EAAArT,CAAMksD,SACNlsD,OAAAk/I,EAAA,EAAAl/I,CAAY,MAOT,SAAA6G,KAAAs4I,GACPA,EAAA55H,QAAAq2F,GAAA7sG,EAAAwU,KAAAq4F,IAMO,SAAAx3G,IACP,OAAA06I,EAAAM,WAUO,SAAA3tI,EAAA4tI,EAAA,KACP,IAAAp1G,EAAAo1G,EACA,IAEAp1G,EAAA7lC,IAAA2B,QAAAkkC,KACK,MAAA7kC,GACL,IACA6kC,EAAmBjqC,OAAAq+I,EAAA,EAAAr+I,CAAoBq/I,GAC9B,MAAAj6I,GACTC,QAAA4hC,KAAA,oCAAA7hC,IAGA,OAAA6kC,sBCrFA,IAAAq1G,EAAAC,EACAC,EAAO,CAACx+I,EAAA,WAAFuC,KAAAg8I,EAAA,SAA+BE,GAIjC,GAAIA,EAAcv/I,eAAe,UAAW,CAGxC,IAAImoE,EAASliC,eAAevvB,QAAQ,iBAEhCyxD,IACAo3E,EACIA,EAAc,KAAOp3E,IAAWo3E,EAAc,KAAOp3E,EAAO1hE,MAAM,KAAK,KAAO84I,EAAchsF,QAcxG,IAAIisF,EAAW,SAASC,GAcpB,OAAOF,EAAcE,IAAkBA,GAK3C,OAHAD,EAASE,mBAAoB,EAGtBF,GA5CLl/I,MAAAY,EAAAk+I,MAAAj+I,EAAAD,QAAAm+I,oCCDN,IAAA/oI,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAA4I,EAAApe,EAAA,GAkBA,IAMIu6C,EAxBJv6C,EAAAgE,EAAAoa,GAwB0BxZ,EAASO,MAAMN,OAAO,CAC5CiR,SAAU,CACN0kC,cAAe,GACfC,SAAU,IACVC,WAAY,SAASh7C,GACjB,OAAO,IAOfi7C,GAAI,WACA,IAAIxW,EAAWh+B,IAAEi+B,WAEboW,EADOv1C,KACc7B,IAAI,iBACzBs3C,EAFOz1C,KAEW7B,IAAI,cACtBq3C,EAHOx1C,KAGS7B,IAAI,YAexB,OAbU,SAANy7I,IACA14I,IAAEqzB,KAAKghB,GAAenU,QAAQ,SAAA3mC,GACtBg7C,EAAWh7C,GAEXykC,EAASvjC,QAAQlB,GAGjB8C,WAAWq8I,EAAKpkG,KAK5BokG,GACO16G,KAmFAt0B,EAAA,GACXivI,UAtIJ,SAAmB3xF,GACfA,GAAU,GAEV,IADA,IAAI4xF,EAAM,eACHA,EAAI/nH,KAAKm2B,IACZA,EAASA,EAAOl/B,QAAQ8wH,EAAK,SAEjC,OAAO5xF,GAiIP7R,YA3Hc,SAAAx4C,GAAC,MAAI,YAAaA,GA4HhCy3C,oBAAqBA,EACrBykG,iBA9EmB,SAAAC,GAEdA,IACDA,EAAS,WAIS,iBAAXA,IACPA,EAAS,CAACA,IAId,IAAK,IAAItgJ,EAAI,EAAGA,EAAIsgJ,EAAOpgJ,OAAQF,IAC/BsgJ,EAAOtgJ,GAAKqJ,SAASi3I,EAAOtgJ,GAAG8F,MAAM,GAAI,IAO7C,IAUIy6I,EAEAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAlBcC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAHlCC,EAAa,SAAC98I,EAAG+sC,EAAGlf,GAAP,OAAkB,IAAJ7tB,EAAc,IAAJ+sC,EAAc,IAAJlf,GAAW,KAsB1DkvH,GAAK,EACLC,EAAY,EAChB,EAAG,CAQC,IAFAX,EAAeS,EAHfhB,GAAkB,UADlBD,EAAYt3I,KAAKC,MAAsB,SAAhBD,KAAK04I,aACG,GAC/BlB,GAAkB,MAAZF,IAAyB,EAC/BG,EAAiB,IAAZH,GAELkB,GAAK,EACAzhJ,EAAI,EAAGA,EAAIsgJ,EAAOpgJ,OAAQF,IAS3B,GAJAghJ,EAAeQ,EAHfZ,GAAoB,UADpBD,EAAcL,EAAOtgJ,MACY,GACjC6gJ,GAAoB,MAAdF,IAA2B,EACjCG,EAAmB,IAAdH,GAjCKO,EAmCQV,EAnCJW,EAmCQV,EAnCJW,EAmCQV,EAnCJW,EAmCQT,EAnCJU,EAmCQT,EAnCJU,EAmCQT,EAAtCG,EAlCJh4I,KAAKpC,IAAIq6I,EAAIG,GACbp4I,KAAKrC,IAAIs6I,EAAIG,IACZp4I,KAAKpC,IAAIs6I,EAAIG,GAAMr4I,KAAKrC,IAAIu6I,EAAIG,KAChCr4I,KAAKpC,IAAIu6I,EAAIG,GAAMt4I,KAAKrC,IAAIw6I,EAAIG,IAkCzBt4I,KAAKwjE,IAAIs0E,EAAeC,GAAgB,IAAMC,EAAO,IAAK,CAC1DQ,GAAK,EACL,MAIRC,WACMD,GAAMC,GAAa,IAG7B,UAAA11I,QAAY,SAAYu0I,GAAWttI,SAAS,IAAIi8F,OAAO,EAAG,uCCxI9D,IAAAr4F,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAAnC,EAAArT,EAAA,GAAAsT,EAAAtT,EAAAgE,EAAAqP,GAAAwD,EAAA7W,EAAA,GAIW2E,EAJX3E,EAAAgE,EAAA6S,GAIkBjS,EAASD,KAAKE,OAAO,CACnC2S,UAAW,WAGX64C,eAAgB,CACZjlC,UAAW,OACXphB,MAAO,WACP+C,IAAK,WACLu3B,KAAM,GACNwiD,UAAU,EACVnlD,OAAQ,KACR4C,MAAO,KACPg8G,QAAQ,EACR/7G,gBAAgB,EAChB43E,iBAAkB,KAClBvzE,iBAAiB,GAIrB23G,WAAY,GAGZ17I,WAAY,SAASC,GACjBE,KAAKF,QAAU4E,IAAEmM,SAAS/Q,GAAW,GAAIE,KAAKorD,gBAC9ClqD,IAAElB,KAAKF,QAAQqmB,WAAWnF,QAAQhhB,KAAK2c,IAEnC7c,GACAE,KAAKkC,UAObC,KAAM,SAASrC,GAAS,IAAA6J,EAAA3J,KAChBF,IACAE,KAAKF,QAAU4E,IAAEmM,SAAS/Q,EAASE,KAAKorD,gBACxCprD,KAAKkC,UAEJlC,KAAKmD,UACNnD,KAAKmD,SAAU,EACfnD,KAAKe,IAAI8O,OAAO,SAEhB7P,KAAKF,QAAQy/B,iBACbr+B,IAAEnF,UAAUsF,GAAG,iBAAkB,SAAA/F,GACZ,IAAbA,EAAEgoF,SACF35E,EAAKtH,MAAK,KAGlBrC,KAAK4hF,UAAUvgF,GAAG,QAAS,WACvBsI,EAAKtH,MAAK,OAQtBA,KAAM,SAASm5I,GACXx7I,KAAKmD,SAAU,EACfnD,KAAKe,IAAIwc,QAAQ,QACbvd,KAAKF,QAAQq3G,kBACbn3G,KAAKF,QAAQq3G,iBAAiBqkC,GAElCt6I,IAAEnF,UAAU4W,IAAI,kBAChB3S,KAAK4hF,UAAUjvE,IAAI,UAMvBzQ,OAAQ,WACJ,IAAInC,EAAOC,KA8BX,GA7BAA,KAAKe,IAAIgF,KAAK/F,KAAKc,aAGnBd,KAAKo1B,QAAUp1B,KAAKkB,EAAE,iBACtBlB,KAAKwhF,QAAUxhF,KAAKkB,EAAE,iBACtBlB,KAAK0hF,MAAQ1hF,KAAKkB,EAAE,eACpBlB,KAAK2hF,QAAU3hF,KAAKkB,EAAE,iBACtBlB,KAAK4hF,UAAY5hF,KAAKkB,EAAE,mBACxBlB,KAAKqiF,SAAWriF,KAAKkB,EAAE,YAEE,YAArBlB,KAAKF,QAAQu/B,OACbr/B,KAAKF,QAAQu/B,KAAOn+B,IAChB,yHAORlB,KAAKe,IACAuB,cACAF,SAAS,SACTA,SAASpC,KAAKF,QAAQgI,KAC3B9H,KAAKo1B,QAAQ/tB,KAAK,UAAUtB,KAAK/F,KAAKF,QAAQiF,OAC9C/E,KAAK0hF,MAAM37E,KAAK/F,KAAKF,QAAQu/B,MAG7Br/B,KAAKqiF,SAASz+E,QACd5D,KAAKu7I,WAAa,GACdv7I,KAAKF,QAAQwoC,QAAS,CACtB,IAAIoqG,EAAU,EACdxxI,IAAEyD,KAAK3E,KAAKF,QAAQwoC,QAAS,SAACxqC,EAAMwV,GAChC,IAAIpM,EAAUhG,IAAE,aACXF,KAAK,KADI,UAAA0E,OACYgtI,MACrB7sI,KAAK/H,GACLigB,MAAMzK,GACXvT,EAAKsiF,SAASx+E,OAAOqD,GAASrD,OAAO,UACrC9D,EAAKw7I,WAAWz9I,GAAQoJ,SAG5BlH,KAAK2hF,QAAQt/E,OAIjBrC,KAAK4hF,UAAW5hF,KAAKF,QAAQ+hF,SAAY,WAAe,eAAe,MACvE7hF,KAAKo1B,QAAUp1B,KAAKF,QAAQ8jC,gBAAkC,cAAf,YAA8B,gBAI7E5jC,KAAK0hF,MAAMp4E,WAAW,SAClBtJ,KAAKF,QAAQ48B,QACb18B,KAAK0hF,MAAMx8E,IAAI,SAAUlF,KAAKF,QAAQ48B,QACtC18B,KAAK0hF,MAAMx8E,IAAI,WAAY,WAE3BlF,KAAK0hF,MAAMx8E,IAAI,aAAchE,IAAE5B,QAAQo9B,SAAW,GAElD18B,KAAKF,QAAQw/B,OACbt/B,KAAKwhF,QAAQt8E,IAAI,QAASlF,KAAKF,QAAQw/B,OAEvCt/B,KAAKF,QAAQw7I,QACbt7I,KAAKwhF,QAAQt8E,IAAI,YAAa,WAQtCu2I,UAAW,SAAS39I,GAChB,OAAOkC,KAAKu7I,WAAWz9I,IAO3BooG,aAAc,SAASpoG,GACnBkC,KAAKy7I,UAAU39I,GAAMuG,KAAK,YAAY,IAO1CyhG,cAAe,SAAShoG,GACpBkC,KAAKy7I,UAAU39I,GAAMuG,KAAK,YAAY,IAO1Cq3I,WAAY,SAAS59I,GACjBkC,KAAKy7I,UAAU39I,GAAMqE,QAOzBw5I,WAAY,SAAS79I,GACjBkC,KAAKy7I,UAAU39I,GAAMuE,QAMzBghB,UAAW,WACP,OAAOrjB,KAAK0hF,MAAMr+D,aAMtBviB,UAAW,WACP,MACI,2OAgBG8J,EAAA,GACXlL,KAAMA,oCClNV3E,EAAA8C,EAAA+M,EAAA,sBAAA4iC,IAAAzyC,EAAA8C,EAAA+M,EAAA,sBAAAgjC,IAAA7yC,EAAA8C,EAAA+M,EAAA,sBAAAgxI,IAAA7gJ,EAAA8C,EAAA+M,EAAA,sBAAA+iC,IAAA,IAAAlpB,EAAA1pB,EAAA,GAAA2pB,EAAA3pB,EAAAgE,EAAA0lB,GAAAotB,EAAA92C,EAAA,GAAA+2C,EAAA/2C,EAAAgE,EAAA8yC,GAAAjgC,EAAA7W,EAAA,GAAA8W,EAAA9W,EAAAgE,EAAA6S,GAAAmgC,EAAAh3C,EAAA,GAAAyqB,EAAAzqB,EAAA,GAAA0qB,EAAA1qB,EAAAgE,EAAAymB,GAAAq2H,EAAA9gJ,EAAA,IAAA+gJ,EAAA/gJ,EAAA,GAWIghJ,EAAkBp8I,IAASO,MAAMN,OAAO,IAMjC4tC,EAAU7tC,IAASO,MAAMN,OAAO,CACvCiR,SAAU,CACN1Q,GAAI,GACJnD,KAAM,GACNc,KAAM,GACN6wC,SAAU,MACV8+D,SAAU,MAGd5tG,WAAY,WAGHG,KAAK7B,IAAI,aACV6B,KAAKg8I,gBAITh8I,KAAKqB,GAAG,SAAUrB,KAAKg8I,cAAeh8I,OAG1Cg8I,cAAe,WACX,IAAIvuC,EAAW,IAAIsuC,EAGnBr3I,IAAEC,KACED,IAAEo9B,KAAK9hC,KAAK6B,YACZ,SAAS8U,GACL,GAA+B,IAA3BA,EAAEjV,QAAQ,aAAoB,CAE9B,IAAIu6I,EAAUtlI,EAAEjW,MAAM,aAAa,GACnC+sG,EAAS7sG,IAAIq7I,EAASj8I,KAAK6B,WAAW8U,WAC/B3W,KAAK6B,WAAW8U,KAG/B3W,MAIJA,KAAKY,IAAI,WAAY6sG,EAAU,CAAE73F,QAAQ,KAM7CsmI,aAAc,SAASC,GACnB,OAAOn8I,KAAK6B,WAAW4rG,SAAStvG,IAAIg+I,IAGxC9qI,QAAO,GAAA3L,OAAK8F,uBAAL,kBAMAoiC,EAAiBJ,EAAQ5tC,OAAO,CACvCiR,SAAUnM,IAAE9E,OAAO,GAAI4tC,EAAQxzC,UAAU6W,SAAU,CAC/CurI,UAAW,KACXC,iBAAkB,KAClBlkI,OAAQ,EACRmkI,QAAQ,IAGZz8I,WAAY,SAASC,GACjB0tC,EAAQxzC,UAAU6F,WAAW3F,KAAK8F,MAG9BA,KAAK6B,WAAWw6I,mBAChBr8I,KAAK6B,WAAWsW,OAASnY,KAAK6B,WAAWw6I,iBAAiBlkI,QAE9DnY,KAAK6B,WAAWu6I,UAAhB,GAAA12I,OAA+B8F,uBAA/B,+BAAA9F,OAAyE1F,KAAKG,IAC9EH,KAAK6B,WAAW06I,QAAhB,GAAA72I,OAA6B8F,uBAA7B,kBAMJgxI,eAAgB,WAEZ,GAAIx8I,KAAK6B,WAAWy6I,OAChB,OAAO,KAIX,IAAIv8I,EAAOC,KAEPy8I,EAAav7I,IAAEi+B,WAiBnB,OAhBAj+B,IAAEwhC,QAAQ1iC,KAAK6B,WAAWu6I,UAAW,CACjCjkI,OAAQpY,EAAK8B,WAAWsW,SACzBipB,QAAQ,SAAAtkC,GACP,IAAIstF,EACkB,KAAlBttF,EAAM4/I,SAENtyD,EAAOttF,EACPiD,EAAK8B,WAAWsW,OAASrb,EAAMqb,SAG/BpY,EAAK8B,WAAWy6I,QAAS,EACzBlyD,EAAO,MAEXqyD,EAAW9gJ,QAAQyuF,KAGhBqyD,KAIJb,EAAoBj8I,IAASkN,WAAWjN,OAAO,CACtDK,MAAOutC,IAQPmvG,EAA4Bh9I,IAASD,KAAKE,OAAO,CAIjDC,WAAY,SAASC,GAEjBE,KAAK48I,UAAY,EACjB58I,KAAK68I,eAAgB,EAGrB,IAAIC,EAA2B,CAC3B78I,MAAOH,EAAQG,MACfc,IAAKf,KAAKe,OAIlBg8I,oBAAqB,WACb/8I,KAAKe,IAAI27B,SAAW18B,KAAKg9I,WAAWtgH,UACpC18B,KAAKi9I,oBAIbA,iBAAkB,SAASj/H,GACvB,IAAIje,EAAOC,MACNA,KAAK68I,eAAiB78I,KAAKk9I,uBAC5Bl9I,KAAK68I,eAAgB,EACrB78I,KAAKm9I,kBAAkBh7I,OACvBjB,IAAEwQ,KAAK3R,EAAKE,MAAMu8I,kBAAkBt4G,KAAK,SAAAzpC,GACjCA,IACAsF,EAAKq9I,aAAa3iJ,GAClBsF,EAAK88I,eAAgB,GAEzB98I,EAAKo9I,kBAAkB96I,OACvBtC,EAAKg9I,0BAKjB76I,OAAQ,WAEJlC,KAAKm9I,kBAAoBj8I,IAAE,UAAUF,KAAK,KAAM,qBAChDhB,KAAKe,IAAI8C,OAAO7D,KAAKm9I,mBAGrB,IAAIE,EAAan8I,IAAE,YAAYF,KAAK,CAChCb,GAAI,gBACJm9I,YAAa,IAEjBt9I,KAAKe,IAAI8C,OAAOw5I,GAChB,IAAIE,EAAev9I,KAAKC,MAAMi8I,aAAa,gBACvCsB,EAAmBt8I,IAAE,YAAY8hE,SAASq6E,GAC1CI,EAAav8I,IAAE,SAAS8hE,SAASw6E,GACrC,GAAID,EACAE,EAAW55I,OAAX,OAAA6B,OAAyB63I,EAAa/vI,KAAK,aAA3C,eAEA,IAAK,IAAI5S,EAAI,EAAGA,GAAKoF,KAAKC,MAAMi8I,aAAa,WAAYthJ,IACrD6iJ,EAAW55I,OAAX,OAAA6B,OAAyB9K,EAAzB,UAKR,IAAImF,EAAOC,KAEP09I,EAAc19I,KAAKC,MAAM9B,IAAI,oBAC7Bu/I,EAEA19I,KAAKo9I,aAAaM,GAGlBx8I,IAAEwQ,KAAK3R,EAAKE,MAAMu8I,kBAAkBt4G,KAAK,SAAAzpC,GACrCsF,EAAKq9I,aAAa3iJ,KAO1BuF,KAAKg9I,WAAWv1G,OAAO,WACnB1nC,EAAKk9I,sBAObC,mBAAoB,WAChB,OAAO,GAKXS,YAAa,SAASC,EAAexxI,EAAOyxI,GACxC,IAAIC,EAAQ58I,IAAE,QAAQ2E,KAAK+3I,GACvBG,EAAe/9I,KAAKC,MAAMi8I,aAAa,gBAW3C,YAVgB5+I,IAAZugJ,EACAC,EAAM98I,KAAK,UAAW68I,GAASz7I,SAAS,eACjC27I,GACH3xI,EAAQ2xI,EAAankJ,SACO,QAAxBmkJ,EAAa3xI,IAA4C,SAAxB2xI,EAAa3xI,IAE9C0xI,EAAM17I,SAAS,gBAIpB07I,GAGXE,WAAY,SAAS7sD,GAEjB,IAAI8sD,EAAQ9sD,EAAKzwF,MAAM,MAEnBktG,EAAM1sG,IAAE,QACRg9I,EAAcl+I,KAAKC,MAAMi8I,aAAa,WAkE1C,OAhEIl8I,KAAK48I,UAAY,GAAM,GACvBhvC,EAAIxrG,SAAS,YAGb67I,EAAMrkJ,SAAWskJ,EACjBx5I,IAAEC,KACEs5I,EACA,SAASL,EAAexxI,GACpBwhG,EAAI/pG,OAAO7D,KAAK29I,YAAYC,EAAexxI,KAE/CpM,MAEGi+I,EAAMrkJ,OAASskJ,GAEtBx5I,IAAEC,KACEs5I,EAAMz+I,MAAM,EAAG0+I,EAAc,GAC7B,SAASN,EAAexxI,GACpBwhG,EAAI/pG,OAAO7D,KAAK29I,YAAYC,EAAexxI,KAE/CpM,MAEJ4tG,EAAI/pG,OAAO7D,KAAK29I,YAAYM,EAAMz+I,MAAM0+I,EAAc,GAAG1wI,KAAK,MAAO0wI,EAAc,KAC3D,IAAjBD,EAAMrkJ,QACbqkJ,EAAQ9sD,EAAKzwF,MAAM,MACT9G,SAAWskJ,EACjBx5I,IAAEC,KACEs5I,EACA,SAASL,EAAexxI,GACpBwhG,EAAI/pG,OAAO7D,KAAK29I,YAAYC,EAAexxI,KAE/CpM,OAGJi+I,EAAQ9sD,EAAKzwF,MAAM,MACT9G,SAAWskJ,EACjBx5I,IAAEC,KACEs5I,EACA,SAASL,EAAexxI,GACpBwhG,EAAI/pG,OAAO7D,KAAK29I,YAAYC,EAAexxI,KAE/CpM,MAIJ4tG,EAAI/pG,OAAO7D,KAAK29I,YAAYxsD,EAAM,EAAG+sD,KAO7Cx5I,IAAEC,KACEs5I,EACA,SAASL,EAAexxI,GACpBwhG,EAAI/pG,OAAO7D,KAAK29I,YAAYC,EAAexxI,KAE/CpM,MAEJ0E,IAAEC,KAAKD,IAAEqe,MAAMm7H,EAAcD,EAAMrkJ,QAAS,WACxCg0G,EAAI/pG,OAAO3C,IAAE,YAIrBlB,KAAK48I,YACEhvC,GAGXwvC,aAAc,SAAStgJ,GACnB,IAAIugJ,EAAar9I,KAAKe,IAAIsG,KAAK,SAC/B3C,IAAEC,KACE7H,EAAM4/I,QAAQh8I,MAAM,MACpB,SAASywF,EAAM/kF,GACE,KAAT+kF,GACAksD,EAAWx5I,OAAO7D,KAAKg+I,WAAW7sD,KAG1CnxF,SASRm+I,EAAoCxB,EAA0B/8I,OAAO,CACrEC,WAAY,SAASC,GACjB68I,EAA0B3iJ,UAAU6F,WAAW3F,KAAK8F,KAAMF,GAG1D,IAAIk9I,EAAat4I,IAAE2C,KAAKrH,KAAKe,IAAIypC,UAAW,SAAAluC,GAAC,MAA6B,SAAzB4E,IAAE5E,GAAG4I,IAAI,cAGrD83I,IACDA,EAAa19I,QAIjBU,KAAKg9I,WAAa97I,IAAE87I,IAMxBE,mBAAoB,WAChB,OAAOl9I,KAAKe,IAAI27B,SAAW18B,KAAKg9I,WAAW35H,YAAcrjB,KAAKg9I,WAAWtgH,UAAY,KAOzF0hH,EAAoCzB,EAA0B/8I,OAAO,CACrEC,WAAY,SAASC,GACjB68I,EAA0B3iJ,UAAU6F,WAAW3F,KAAK8F,KAAMF,GAG1DE,KAAKg9I,WAAah9I,KAAKe,IAAImE,IAAI,CAC3B+lE,SAAU,WACV82D,SAAU,SACVrlG,OAAQ58B,EAAQ48B,QAAU,WAOlCwgH,mBAAoB,WAChB,OAAOl9I,KAAKe,IAAIsiB,YAAcrjB,KAAKe,IAAIs9I,eAAiBr+I,KAAK2c,GAAG2hI,gBAIxE,SAAS3qD,EAAOzqC,EAAKipF,GACjB,IAAK,IAAIv3I,EAAI,EAAGA,EAAIu3I,EAAMv4I,OAAQgB,IAAK,GAAIu3I,EAAMv3I,GAAGy0B,MAAM65B,GAAM,OAAOtuD,EACvE,OAAQ,EAIZ,IAAIkiJ,EAA6Bn9I,IAASD,KAAKE,OAAO,CAElD2+I,IAAK,CACDvoG,MAAO,KACPqC,MAAO,KACPC,IAAK,MAITikG,QAAS,KAGT1vG,WAAY,KAGZq4D,aAAc,KAGdC,SAAU,KAGVtlG,WAAY,SAASC,GAEjB,IAAIwP,EAASC,cAab,GAVID,GAAUA,EAAO8vB,QACjBp/B,KAAKo/B,MAAQ9vB,EAAO8vB,OAIpB9vB,GAAUA,EAAOq3B,QACjB3mC,KAAK2mC,MAAQr3B,EAAOq3B,OAInB3mC,KAAKo/B,OAAUp/B,KAAK2mC,MAAzB,CAKA,IAAI1mC,EAAQH,EAAQG,MAChBwtG,EAAWxtG,EAAM9B,IAAI,YAGzB,GAAK8B,EAAM9B,IAAI,YAAf,CAQA,GAHA6B,KAAKmlG,SAAWllG,EAAM9B,IAAI,YAGL,OAAjB6B,KAAKmlG,SAAmB,CAExB,KAAIsI,EAAStvG,IAAI,aAAesvG,EAAStvG,IAAI,aAAesvG,EAAStvG,IAAI,WAOrE,YADAiB,QAAQ8a,IAAI,0DAJZla,KAAKu+I,IAAIvoG,MAAQy3D,EAAStvG,IAAI,YAAc,EAC5C6B,KAAKu+I,IAAIlmG,MAAQo1D,EAAStvG,IAAI,YAAc,EAC5C6B,KAAKu+I,IAAIjmG,IAAMm1D,EAAStvG,IAAI,UAAY,EAQhD,GAAqB,OAAjB6B,KAAKmlG,WAILnlG,KAAKu+I,IAAIvoG,MAAQ29C,EAAO,QAAS8Z,EAAStvG,IAAI,iBAC9C6B,KAAKu+I,IAAIlmG,MAAQs7C,EAAO,MAAO8Z,EAAStvG,IAAI,iBAC5C6B,KAAKu+I,IAAIjmG,IAAM,MAGQ,GAAnBt4C,KAAKu+I,IAAIvoG,QAAkC,GAAnBh2C,KAAKu+I,IAAIlmG,QAOzC,QAAuB/6C,IAAnB0C,KAAKu+I,IAAIvoG,MAKb,GAAI/1C,EAAME,GAQV,GAPIH,KAAK6sC,WAAa5sC,EAAME,GAOxBF,EAAM9B,IAAI,WAAd,CACI6B,KAAKu8I,QAAUt8I,EAAM9B,IAAI,WAOzB8B,EAAM9B,IAAI,kBACV6B,KAAKklG,aAAejlG,EAAM9B,IAAI,iBAIlC,IAAIqgJ,EAAU,IAAI1rD,IAAa2rD,eAAe,CAC1Cx+I,MAAO,IAAI6yF,IAAa4rD,WAAW,CAC/B35I,MAAOgK,IAAG,aACVikF,WAAY,cACZ7yF,GAAI,cAKZH,KAAKa,WAAWf,EAAQiB,KAGxBf,KAAKe,IAAI8C,OAAO26I,EAAQt8I,SAASnB,KAGjCf,KAAKqC,YAzBDjD,QAAQ8a,IAAI,8EARZ9a,QAAQ8a,IAAI,oEAdR9a,QAAQ8a,IAAI,6DAmDxBrR,OAAQ,CACJ81I,eAAgB,OAChB71G,WAAY,QAIhB3mC,KAAM,SAAS7G,GACX,IAAIyE,EAAOC,KAQX,GAAuB,OAAnBA,KAAKu+I,IAAIvoG,MAAb,CAGA,IARoBj3C,EAQhB6uG,EAAM1sG,IAAE5F,EAAE4B,QAAQ+gB,SAGlB+3B,EAAQ43D,EACP35F,WACAgN,GAAGjhB,KAAKu+I,IAAIvoG,OACZjwC,OACDsyC,EAAQu1D,EACP35F,WACAgN,GAAGjhB,KAAKu+I,IAAIlmG,OACZtyC,OAGDuyC,EAAMt4C,KAAKu+I,IAAIjmG,IACbs1D,EACK35F,WACAgN,GAAGjhB,KAAKu+I,IAAIjmG,KACZvyC,OACLsyC,EAGN,GAAKrC,EAAM3mB,MAAM,OAAmB,KAAV2mB,IA7BNj3C,EA6BiCs5C,EA5BzC31C,MAAM2qB,WAAWtuB,MAAO00F,SAAS10F,IA0DzCmC,IAAE,YAAYmB,WA9B2C,CAEzD,IAAIu8I,EAAe,CACf/xG,WAAY7sC,KAAK6sC,WACjBgyG,YAAW,GAAAn5I,OAAKswC,EAAL,KAAAtwC,OAAc2yC,EAAd,KAAA3yC,OAAuB4yC,IAIlCngC,EAASy1F,EAAIz1F,SACbqe,EAAOre,EAAOqe,KAAO,GACrBsH,EAAM3lB,EAAO2lB,IAAM58B,IAAE5B,QAAQ+jB,YAAc,EAG/CniB,IAAE,YAAYgE,IAAI,CACd+lE,SAAU,QACVntC,IAAG,GAAAp4B,OAAKo4B,EAAL,MACHtH,KAAI,GAAA9wB,OAAK8wB,EAAL,QAERt1B,IAAE,YAAYyR,IAAI,SAClBzR,IAAE,YAAY6c,MAAM,WAChBhe,EAAK4mC,MAAM75B,IAAI,CACX/H,MAAOgK,IAAG,aACVxD,IAAG,GAAA7F,OAAK3F,EAAKw8I,QAAV,eAAA72I,OAA+BxE,IAAEmuC,MAAMuvG,QAKlD19I,IAAE,YAAYiB,UAQtBE,KAAM,WACFrC,KAAKkB,EAAE,YAAYmB,UAQhBsrC,EAAkC,SAAA7tC,GAEpCA,EAAQG,QACTH,EAAQG,MAAQ,IAAI2tC,EAAe9tC,EAAQg/I,iBAG/C,IAAIzwG,EAAavuC,EAAQuuC,WACrBR,EAAW/tC,EAAQ+tC,gBAGhB/tC,EAAQ+tC,gBACR/tC,EAAQuuC,kBACRvuC,EAAQg/I,eAGf,IAAIjrI,EAAOg6B,EACL,IAAIuwG,EAAkCt+I,GACtC,IAAIq+I,EAAkCr+I,GAW5C,OAVA+T,EAAK3R,SAEDmsC,IACAA,EAAWxqC,OAAOgQ,EAAK9S,KAIvB8S,EAAKkpI,uBAGFlpI,oCC/mBX,IAAAtD,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAAnC,EAAArT,EAAA,GAAAsT,EAAAtT,EAAAgE,EAAAqP,GAGIlN,EAAIuQ,IAsDOstI,IAzCI,SAAAj/I,IACfA,EAAUA,GAAW,IACbgoB,cAAgBhoB,EAAQgoB,eAAiB,CAC7C9iB,UAAW,UAGflF,EAAQg+C,QAAU,CAAC,YAAYp4C,OAAO5F,EAAQg+C,SAAW,IACrDh+C,EAAQyI,UACRzI,EAAQg+C,QAAQhkD,KAAK,YAGzB,IAAIiM,EAAO,CACP,aACAjG,EAAQg+C,QAAQtwC,KAAK,KACrB,IACA1N,EAAQiF,MAAR,WAAAW,OAA2B5F,EAAQiF,MAAnC,KAA8C,IAC7CjF,EAAQyI,UAAYzI,EAAQ5C,OAA7B,YAAAwI,OAAkD5F,EAAQ5C,OAA1D,KAAsE,GACtE,WACC4C,EAAQyI,UAAYzI,EAAQukC,KAAOvkC,EAAQukC,KAAO,sBACnD,KAEA,mBACAvkC,EAAQk/I,OACR,YACA,QACFxxI,KAAK,IACHtG,EAAUhG,EAAE6E,GAAMjB,QAAQhF,EAAQgoB,eAWtC,OAVIpjB,IAAE2rB,WAAWvwB,EAAQsE,UACrB8C,EAAQ6W,MAAM,SAASjC,GACnB5U,EAAQpC,QAAQ,QAChBoC,EACK+W,SACAjd,KAAK,YAAa,GAClB42B,QACL93B,EAAQsE,QAAQ7J,MAAMyF,KAAM6f,aAG7B3Y,wHC/CIvH,MAASD,KAAKE,OAAO,CAChCC,WAAY,SAAS0nE,EAAKznE,GAAS,IAAA6J,EAAA3J,KAC/BA,KAAKunE,IAAMA,EACXvnE,KAAKi/I,YAAc13E,EAAItnE,MAAQsnE,EAAItnE,MAAM4B,WAAa,GACtD7B,KAAK+mH,MAASjnH,GAAWA,EAAQinH,OAAU,IAAIpnH,IAASD,KACxDM,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfogF,YAAatgF,KAAKi/I,YAAY3+D,aAAe,SAC7CC,aAAcvgF,KAAKi/I,YAAY1+D,cAAgB,UAC/C2+D,sBAAuBl/I,KAAKi/I,YAAYC,uBAAyB,2BACjEC,uBAAwBn/I,KAAKi/I,YAAYE,wBAA0B,gCACnEC,WAAYp/I,KAAKi/I,YAAYG,YAAc,4BAC3CC,YAAar/I,KAAKi/I,YAAYI,aAAe,0BAC7CC,eAAgBt/I,KAAKi/I,YAAYK,iBAClC1+I,IAAId,GAGXE,KAAKa,WAAWb,KAAKc,aACrBd,KAAKu/I,OAASv/I,KAAKkB,EAAE,kBACrBlB,KAAKwJ,MAAQxJ,KAAKkB,EAAE,iBACpBlB,KAAKw/I,SAAWx/I,KAAKkB,EAAE,oBACvBlB,KAAKy/I,aAAez/I,KAAKkB,EAAE,wBAC3BlB,KAAK0/I,kBAAoB1/I,KAAKkB,EAAE,6BAChClB,KAAK2/I,kBAAoB3/I,KAAKkB,EAAE,6BAChClB,KAAK4/I,gBAAkB5/I,KAAKkB,EAAE,2BAC9BlB,KAAKgnC,OAAShnC,KAAKkB,EAAE,kBACrBlB,KAAK6/I,YAAc7/I,KAAKkB,EAAE,uBAC1BlB,KAAK8/I,YAAc9/I,KAAKkB,EAAE,uBAC1BlB,KAAK+/I,OAAS//I,KAAKkB,EAAE,kBACrBlB,KAAK4hF,UAAY5hF,KAAKkB,EAAE,qBAGxBlB,KAAKu/I,OAAOv+H,QAAQhhB,KAAK+mH,MAAMhmH,KAG/B,IAAImgF,EAAoBlhF,KAAKC,MAAM9B,IAAI,qBACnCI,EAAQ2hB,KAAKC,UAAUngB,KAAKC,MAAM9B,IAAI,UAC1C6B,KAAK+mH,MAAMzyC,UAAY/1E,GAAS2hB,KAAKC,UAAU,CAAE8gE,UAAW,mBAC5DjhF,KAAK+mH,MAAM/lE,UACPhhD,KAAK+mH,MAAMzyC,gBACYh3E,IAAtB4jF,GACGhhE,KAAKC,UAAUngB,KAAKC,MAAM9B,IAAI,WAAa+hB,KAAKC,UAAU+gE,GAClElhF,KAAKiC,SAASjC,KAAKC,MAAO,SAAUD,KAAKkC,OAAQlC,MACjDA,KAAKkC,SAGL,IAAInC,EAAOC,KACXA,KAAK2/I,kBAAkBt+I,GAAG,QAAS,WAC/BtB,EAAKgnH,MAAM/lE,WAAajhD,EAAKgnH,MAAM/lE,UACnCjhD,EAAKgnH,MAAMzyC,WAAY,EACvB/M,EAAI1kE,SAAW0kE,EAAI1kE,QAAQ,UAC3B9C,EAAKmC,WAETlC,KAAK4/I,gBAAgBv+I,GAAG,QAAS,WAC7BtB,EAAKgnH,MAAMzyC,WAAav0E,EAAKgnH,MAAMzyC,UACnCv0E,EAAKgnH,MAAM/lE,UAAYjhD,EAAKgnH,MAAMzyC,UAClC/M,EAAI1kE,SAAW0kE,EAAI1kE,QAAQ,UAC3B9C,EAAKmC,WAILlC,KAAK+mH,MAAM9mH,QAAUD,KAAKC,MAAM9B,IAAI,mBACpC6B,KAAKiC,SAASjC,KAAK+mH,MAAM9mH,MAAO,eAAgB,WAC5CF,EAAK6W,UAKT5W,KAAK+mH,MAAM9mH,OACXD,KAAKiC,SAASjC,KAAK+mH,MAAM9mH,MAAO,QAAS,SAAA6C,GACjCA,EACA6G,EAAKxM,MAAM2F,GAEX6G,EAAKiN,WAOrBirE,SAAU,WACN7hF,KAAKC,MAAMW,IAAI,YAAY,IAI/BzD,MAAO,SAAS0I,GACZ7F,KAAKC,MAAMW,IAAI,aAAciF,IAIjC+Q,MAAO,YACF5W,KAAKC,MAAM9B,IAAI,UAAY6B,KAAKC,MAAMW,IAAI,aAAc,OAG7DsB,OAAQ,WAEJhB,IAAE,YAAYmB,OACd,IAAI29I,EAAYhgJ,KAAKC,MAAM9B,IAAI,OAAQ,IACnC8hJ,EAAgBjgJ,KAAKC,MAAM9B,IAAI,YAC/B8hJ,IAA6D,GAA5CD,EAAUt+I,QAAV,IAAAgE,OAAsBu6I,EAAtB,QACjBD,GAAS,KAAAt6I,OAASu6I,EAAT,MAEbjgJ,KAAKwJ,MAAMzD,KAAKi6I,GAEhBhgJ,KAAKe,IAAIf,KAAKC,MAAM9B,IAAI,UAAY,OAAS,UAG7C,IAAM4H,EAAOrB,IAAEyD,OAAOnI,KAAKC,MAAM9B,IAAI,eAAe6qB,QAAQ,MAAO,UACnEhpB,KAAKw/I,SACAx/I,KAAK+mH,MAAM/lE,WAAahhD,KAAKC,MAAM9B,IAAI,wBAA2B6B,KAAKC,MAAM9B,IAAI,YAC5E,OACA,UACN4H,KAAKA,GAET,IAAI3C,EAAapD,KAAKC,MAAM9B,IAAI,cAChC6B,KAAK+/I,OAAO38I,EAAa,OAAS,UAClCpD,KAAKe,IAAIqC,EAAa,WAAa,eAAe,sBAClDpD,KAAK8/I,YAAY/5I,KAAK3C,GAEtBpD,KAAK4hF,UAAU5hF,KAAKC,MAAM9B,IAAI,YAAc,OAAS,UAErD6B,KAAK+mH,MAAM/lE,WAAahhD,KAAKC,MAAM9B,IAAI,YAAc6B,KAAKu/I,OAAOl9I,OAASrC,KAAKu/I,OAAOp9I,OAEtFnC,KAAK+mH,MAAM9mH,OACPD,KAAK+mH,MAAM9mH,MAAMW,IAAI,CACjB8H,MAAO1I,KAAKC,MAAM9B,IAAI,SACtBwK,MAAO3I,KAAKC,MAAM9B,IAAI,WAG9B,IAAMm2E,EAAYt0E,KAAK+mH,MAAMzyC,UACvB4rE,GACDlgJ,KAAK+mH,MAAMo5B,uBACXngJ,KAAKC,MAAM9B,IAAI,kBACwBb,IAAxC0C,KAAKC,MAAM9B,IAAI,qBACb4iF,EAAcm/D,GAAelgJ,KAAKC,MAAM9B,IAAI,eAClD,GAAI+hJ,GAAen/D,EAAa,CAC5B,IAAIq/D,EAAoBpgJ,KAAK+mH,MAAM/lE,UAAY,SAAW,UAgB1D,GAfAhhD,KAAK6/I,YAAYx9I,OACjBrC,KAAKy/I,aAAat9I,OAClBnC,KAAK0/I,kBAAkB75I,KAAK7F,KAAKC,MAAM9B,IAAI,UACvC+hJ,IAAgB5rE,EAChBt0E,KAAK2/I,kBACAr9I,cACAF,SAAS,iCACTA,SAASpC,KAAKC,MAAM9B,IAAX,OAAAuH,OAAsB06I,KAC/Bt7I,QAAQ,WACR9D,KAAK,sBAAuBhB,KAAKC,MAAM9B,IAAX,QAAAuH,OAAuB06I,KACnDt7I,QAAQ,CAAEE,UAAW,WACrB7C,OAELnC,KAAK2/I,kBAAkBt9I,OAEvB0+E,EAAa,CACb,IAAMs/D,EAAuBrgJ,KAAK+mH,MAAMzyC,UAAY,cAAgB,iBAC9DgsE,GAAyBhsE,GAAa4rE,EAAc,OAAS,GAC7DK,EAA8BvgJ,KAAK+mH,MAAMzyC,UAAY,UAAY,SACvEt0E,KAAK4/I,gBACAt9I,cACAF,SAAS,+BACTA,SAASi+I,GACTj+I,SAASk+I,GACTx7I,QAAQ,WACR9D,KAAK,sBAAuBhB,KAAKC,MAAM9B,IAAX,kBAAAuH,OAAiC66I,KAC7Dz7I,QAAQ,CAAEE,UAAW,WACrB7C,YAELnC,KAAK4/I,gBAAgBv9I,YAGzBrC,KAAK6/I,YAAY19I,OAAO0D,KAAK7F,KAAKC,MAAM9B,IAAI,UAC5C6B,KAAKy/I,aAAap9I,QAI1BvB,UAAW,WACP,OAAOI,IAAE,UACJkB,SAAS,mBACTyB,OACG3C,IAAE,UACGkB,SAAS,iBACTyB,OAAO3C,IAAE,WAAWkB,SAAS,0BAC7ByB,OAAO3C,IAAE,WAAWkB,SAAS,wBAErCyB,OACG3C,IAAE,UACGkB,SAAS,iBACTyB,OACG3C,IAAE,UACGkB,SAAS,uBACTyB,OAAO3C,IAAE,QAAQkB,SAAS,6BAC1ByB,OAAO3C,IAAE,QAAQkB,SAAS,2BAC1ByB,OAAO3C,IAAE,WAAWkB,SAAS,mCAErCyB,OAAO3C,IAAE,WAAWkB,SAAS,wBAErCyB,OACG3C,IAAE,UACGkB,SAAS,iBACTyB,OAAO3C,IAAE,WAAWkB,SAAS,2CAC7ByB,OAAO3C,IAAE,UAAUkB,SAAS,sBAEpCyB,OAAO3C,IAAE,UAAUkB,SAAS,sDCtMrCo+I,EAAoB,WAApBA,EAAyC,UAAzCA,EAA4D,SAG5DC,EAAiB,CACjBrnJ,KAAM,CACF,CACIiD,IAAK,MACLkK,KAAM,YACNzB,QAASiK,IAAG,kBACZzL,UAAU,EACVo9I,MAAOF,GAEX,CACInkJ,IAAK,MACLkK,KAAM,aACNzB,QAASiK,IAAG,qBACZzL,UAAU,EACVo9I,MAAOF,GAEX,CACInkJ,IAAK,OACLkK,KAAM,cACNzB,QAASiK,IAAG,sBACZzL,UAAU,EACVo9I,MAAOF,IAGfG,cAAe,CACX,CACItkJ,IAAK,MACLkK,KAAM,aACNzB,QAASiK,IAAG,qBACZzL,UAAU,EACVo9I,MAAOF,GAEX,CACInkJ,IAAK,OACLkK,KAAM,cACNzB,QAASiK,IAAG,uBACZzL,UAAU,EACVo9I,MAAOF,IAGfI,gBAAiB,CACb,CACIvkJ,IAAK,OACLkK,KAAM,cACNzB,QAASiK,IAAG,sBACZzL,UAAU,EACVo9I,MAAOF,IAGfl7D,cAAe,CACX,CACIjpF,IAAK,MACLkK,KAAM,YACNzB,QAASiK,IAAG,kBACZzL,UAAU,EACVo9I,MAAOF,IAGfK,uBAAwB,CACpB,CACIxkJ,IAAK,MACLkK,KAAM,aACNzB,QAASiK,IAAG,qBACZzL,UAAU,EACVo9I,MAAOF,IAGfM,yBAA0B,CACtB,CACIzkJ,IAAK,OACLkK,KAAM,cACNzB,QAASiK,IAAG,sBACZzL,UAAU,EACVo9I,MAAOF,IAGfO,YAAa,CACT,CACI1kJ,IAAK,MACLkK,KAAM,YACNzB,QAASiK,IAAG,kBACZzL,UAAU,EACVo9I,MAAOF,GAEX,CACInkJ,IAAK,MACLkK,KAAM,aACNzB,QAASiK,IAAG,qBACZzL,UAAU,EACVo9I,MAAOF,IAGfQ,uBAAwB,CACpB,CACI3kJ,IAAK,OACLkK,KAAM,cACNzB,QAASiK,IAAG,sBACZzL,UAAU,EACVo9I,MAAOF,GAEX,CACInkJ,IAAK,OACLkK,KAAM,YACNzB,QAASiK,IAAG,wBACZzL,UAAU,EACVo9I,MAAOF,KAsXJS,EAAA,CACXvhJ,KAjXOC,IAASD,KAAKE,OAAO,CAC5BC,WAAY,SAASC,GAAS,IAAA6J,EAAA3J,KACtBD,EAAOC,KACXA,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfghJ,WAAY,CAAEC,IAAK,UAAWC,KAAM,sBACpCC,UAAW,IACXC,YAAa,MACd1gJ,IAAId,GACXE,KAAKa,WAAWK,IAAE,UAAUkB,SAAS,sBACrCpC,KAAKuhJ,eAAiB,IAAIryI,IAAG7I,YAAY3G,KAAK,CAC1CnB,MAAO,QACPnF,KAAM,CACF,CACImN,KAAM,cACNhI,MAAO,QACPuG,QACI,wHAER,CACIyB,KAAM,qBACNhI,MAAO,OACPuG,QAAS,sEAIrB,IAAI08I,EAAatgJ,IAAE,UACdkB,SAAS,wBACTyB,OAAO3C,IAAE,QAAQkB,SAAS,kBAC1ByB,OACG3C,IAAE,WAAW6E,KACT,kGAGZ/F,KAAKyhJ,OAAS,CACVC,OAAQF,EAAWltI,QACnBqtI,QAASH,EACJltI,QACAzQ,OACG3C,IAAE,UACG2C,OACG3C,IAAE,UACGkB,SAAS,iBACT2D,KAAK,mBAEblC,OAAO7D,KAAKuhJ,eAAexgJ,MAEnC8C,OAAO3C,IAAE,UAAUgE,IAAI,QAAS,UAIzC,IAAI4B,EAAU9G,KAAKe,IAAI5C,IAAI,GAC3B2I,EAAQ8mB,iBAAiB,YAAa,SAAAtyB,GAClCqO,EAAKi4I,UAAYtmJ,EAAE4B,OACnB6C,EAAKgB,IAAIqB,SAAS,iBAEtB0E,EAAQ8mB,iBAAiB,WAAY,SAAAtyB,GACjCA,EAAEmG,mBAENqF,EAAQ8mB,iBAAiB,YAAa,SAAAtyB,GAClCqO,EAAKi4I,YAActmJ,EAAE4B,QAAU6C,EAAKgB,IAAIuB,YAAY,iBAExDwE,EAAQ8mB,iBAAiB,OAAQ,SAAAtyB,GAC7ByE,EAAK8hJ,YAAYvmJ,KAIrB0E,KAAK2oG,QAAU,GAGf3oG,KAAKiC,SAASjC,KAAKC,MAAO,cAAeD,KAAK0D,YAAa1D,MAC3DA,KAAKiC,SAASjC,KAAKC,MAAO,cAAeD,KAAKyD,YAAazD,MAC3DA,KAAKiC,SAASjC,KAAKC,MAAO,iBAAkBD,KAAK8hJ,eAAgB9hJ,MACjEA,KAAKiC,SAASjC,KAAKC,MAAO,eAAgBD,KAAKwD,aAAcxD,MAC7DA,KAAKiC,SACDjC,KAAKC,MACL,gEACAD,KAAK+hJ,YACL/hJ,MAEJA,KAAKkC,SAGLlC,KAAKqB,GAAG,SAAU,WACdvB,EAAQa,UAAYb,EAAQa,SAASZ,EAAKxB,YAIlD2D,OAAQ,WACJlC,KAAK+hJ,cACL/hJ,KAAKwD,eACLxD,KAAKyD,eAIT8B,KAAM,WACFvF,KAAKC,MAAMW,IAAI,QAAQ,IAI3B4E,OAAQ,WACJxF,KAAKC,MAAMW,IAAI,QAAQ,IAI3B2D,OAAQ,SAASC,GACbxE,KAAKC,MAAMW,IAAI,OAAQ4D,EAAU1E,UAIrCvB,MAAO,SAAS+G,GACZ,IAAIgK,EAASC,mBACCjS,IAAdgI,GAA2BtF,KAAKC,MAAMW,IAAI,QAAS0E,GACnD,IAAI83C,EAAUp9C,KAAKC,MAAM9B,IAAI,WAC7B,GAAI6B,KAAKijC,OAAOma,GAAU,CACtB,IAAI4kG,EAAUhiJ,KAAKknD,OAAO9J,GAAS7+C,QACnC,GAAgB,OAAZyjJ,IACAA,EAAU9gJ,IAAEmE,QAAQ28I,GAAWA,EAAU,CAACA,IAC9BpoJ,OAAS,EAAG,CACpB,IAAIa,EAASuF,KAAKiiJ,OAAO,CAAEx8I,OAAQ,KACnC,IAAK,IAAI/L,KAAKsoJ,EAAS,CACnB,IAAInnI,EAAU7a,KAAK2oG,QAAL,GAAAjjG,OAAgBs8I,EAAQtoJ,GAAxB,KAAAgM,OAA8B1F,KAAKijC,OAAOma,GAAS/gD,MACjE,IAAIwe,EAOA,OAJAvL,EAAOU,KAAKC,MACR,6BADJ,oCAAAvK,OAEwCs8I,EAAQtoJ,GAFhD,OAIO,KANPe,EAAOgL,OAAO3L,KAAK+gB,GAU3B,OADApgB,EAAOgL,OAAOsQ,KAAK,SAACiW,EAAGC,GAAJ,OAAUD,EAAEjb,IAAMkb,EAAElb,MAChCtW,QAIf6U,EAAOU,KAAKC,MAAM,6BAAlB,yBAAAvK,OAAyEJ,EAAzE,OAEJ,OAAO,MAIXw8I,eAAgB,WACZ,IAAI/hJ,EAAOC,KACX0E,IAAEC,KAAK3E,KAAKknD,OAAQ,SAAC6/D,EAAOrtH,GACpBqG,EAAKE,MAAM9B,IAAI,YAAczE,GAC7BqtH,EAAMhmH,IAAIoB,OACVuC,IAAEC,KAAK5E,EAAK0hJ,OAAQ,SAACS,EAAaC,GAC9BD,EAAYniJ,EAAKkjC,OAAOvpC,GAAGgnJ,OAASyB,EAAY,OAAS,YAE7DpiJ,EAAKqiJ,YAAY7jJ,MAAM7E,IAEvBqtH,EAAMhmH,IAAIsB,UAMtB0/I,YAAa,WACT,IAAIzyI,EAASC,cACTxP,EAAOC,KAGPqiJ,GACCriJ,KAAKC,MAAM9B,IAAI,UAAf,GAAAuH,OAA8B1F,KAAKC,MAAM9B,IAAI,UAA7C,KAA4D,IAC7D6E,OAAOhD,KAAKC,MAAM9B,IAAI,UACrB6B,KAAKC,MAAM9B,IAAI,YAAc,YAAc,IAC5CsiJ,EAAe4B,GACfriJ,KAAKijC,OAASw9G,EAAe4B,IAE7BriJ,KAAKijC,OAASw9G,EAAc,KAC5BnxI,EAAOU,KAAKC,MAAM,mCAAlB,kCAAAvK,OAAwF28I,EAAxF,QAIJ,IAAIjpJ,EAAO2G,EAAKE,MAAM9B,IAAI,QACtBq3E,EAAap1E,IAAM4gF,QAAQhhF,KAAKC,MAAM9B,IAAI,eAC1C+iJ,EAAalhJ,KAAKC,MAAM9B,IAAI,cAGhC6B,KAAKknD,OAAS,GACdlnD,KAAKsiJ,YAAc,GACnB59I,IAAEC,KAAK3E,KAAKijC,OAAQ,SAACrlC,EAAGlE,GACpBqG,EAAKuiJ,YAAYxoJ,KAAK,CAClByE,MAAO7E,EACP6M,KAAM3I,EAAE2I,KACRzB,QAASlH,EAAEkH,UAEf/E,EAAKmnD,OAAOptD,KACR,IAAIgR,IAAOpL,KAAK,CACZ6D,SAAUxD,EAAKE,MAAM9B,IAAI,YACzBmF,SAAU1F,EAAE0F,SACZi/I,YACK3kJ,EAAE0F,UAAalK,GAAQA,EAAKwE,EAAEvB,MAAQjD,EAAKwE,EAAEvB,KAAKzC,OAASmG,EAAKE,MAAM9B,IAAI,aAC/EqkJ,YAAY,EACZp/I,WAAU,MAAAsC,OAAQ8vE,EAAU,GAAA9vE,OAAM8vE,EAAN,KAAsB,IAAxC9vE,OAA6Cw7I,EAAWtjJ,EAAEvB,MAAQ,UAAlE,eACVsE,SAAU,WACNZ,EAAK8C,QAAQ,gBAK7B7C,KAAKoiJ,YAAc,IAAIlzI,IAAG7I,YAAY3G,KAAK,CACvCnB,MAAOyB,KAAKC,MAAM9B,IAAI,WACtB/E,KAAM4G,KAAKsiJ,YACX3hJ,SAAU,SAASpC,GACfwB,EAAKE,MAAMW,IAAI,UAAWrC,GAC1BwB,EAAK8C,QAAQ,aAKrB7C,KAAKe,IAAI6C,QACT,IAAI6+I,EAAe,EACfziJ,KAAKknD,OAAOttD,OAAS,IACrBoG,KAAKe,IAAI8C,OAAO7D,KAAKoiJ,YAAYrhJ,KACjC0hJ,EAAY,GAAA/8I,OAAM/C,KAAKpC,IAAI,EAAwB,GAArBP,KAAKknD,OAAOttD,QAA9B,OAEhB8K,IAAEC,KAAK3E,KAAKknD,OAAQ,SAAA6/D,GAChBhnH,EAAKgB,IAAI8C,OAAOkjH,EAAMhmH,IAAImE,IAAI,CAAEw9I,cAAeD,OAEnD/9I,IAAEC,KAAK3E,KAAKyhJ,OAAQ,SAACS,EAAaC,GAC9BpiJ,EAAKgB,IAAI8C,OAAOq+I,EAAYh9I,IAAI,CAAEw9I,cAAeD,OAErDziJ,KAAKC,MAAMW,IAAI,UAAW,GAC1BZ,KAAK8hJ,iBACL9hJ,KAAK0D,eAITD,YAAa,WACT,IAAI1D,EAAOC,KACX0E,IAAEC,KAAK3E,KAAKknD,OAAQ,SAAA6/D,GAChBA,EAAMhnH,EAAKE,MAAM9B,IAAI,QAAU,OAAS,eAKhDuF,YAAa,WACT,IAAI5D,EAAUE,KAAKC,MAAM9B,IAAI,QACzB4B,EAAOC,KACPqnG,EAAiB,GACrB3iG,IAAEC,KAAK7E,EAAS,SAACoyH,EAAO71H,GACpBgrG,EAAehrG,GAAO,GACtBqI,IAAEC,KAAKutH,EAAO,SAAA9kE,GACVi6C,EAAehrG,GAAKvC,KAAK,CACrBiX,IAAKq8C,EAAKr8C,IACV4xI,KAAMv1F,EAAKu1F,KACXz8I,MAAK,GAAAR,OAAK0nD,EAAKr8C,IAAV,MAAArL,OAAkB0nD,EAAKtvD,MAC5BS,MAAO6uD,EAAKjtD,GACZmmB,KAAM8mC,EAAK9mC,OAEfvmB,EAAK4oG,QAAL,GAAAjjG,OAAgB0nD,EAAKjtD,GAArB,KAAAuF,OAA2BrJ,IAAS+wD,MAG5C1oD,IAAEC,KAAK3E,KAAKijC,OAAQ,SAACrlC,EAAGlE,GACpB2tG,EAAezpG,EAAEvB,MAAQ0D,EAAKmnD,OAAOxtD,GAAGoT,IAAIu6F,EAAezpG,EAAEvB,KAAM,SAAC2vB,EAAGC,GAAJ,OAAUA,EAAElb,IAAMib,EAAEjb,SAK/FvN,aAAc,WACV,IAAI8B,EAAYtF,KAAKC,MAAM9B,IAAI,SAC/B,GAAImH,GAAaA,EAAUG,QAAUH,EAAUG,OAAO7L,OAAS,EAAG,CAE9D,IAAIiN,EAAO,GACXnC,IAAEC,KAAKW,EAAUG,OAAQ,SAAAlH,GACrBsI,EAAK/M,KAAKyE,EAAM4B,MAKpB,IAFA,IAAI9D,EAAMiJ,EAAUG,OAAO,GAAGpJ,IAC1BiH,EAAWgC,EAAUG,OAAO7L,OAAS,EAChCF,EAAI,EAAGA,EAAIsG,KAAKijC,OAAOrpC,OAAQF,IAAK,CACzC,IAAIqtH,EAAQ/mH,KAAKknD,OAAOxtD,GACpBkE,EAAIoC,KAAKijC,OAAOvpC,GACpB,GAAIkE,EAAEvB,KAAOA,IAAiD,IAA1C,CAACiH,GAAU,GAAM5B,QAAQ9D,EAAE0F,UAAkB,CAC7DtD,KAAKC,MAAMW,IAAI,UAAWlH,GAC1BqtH,EAAMxoH,MAAMsI,GACZ,aAIRnC,IAAEC,KAAK3E,KAAKknD,OAAQ,SAAA6/D,GAChBA,EAAMxoH,MAAM,SAMxBsjJ,YAAa,SAAS/lI,GAClB,IACI,IAAI1iB,EAAO4G,KAAKC,MAAM9B,IAAI,QACtBi/C,EAAUp9C,KAAKC,MAAM9B,IAAI,WACzB8kC,EAASjjC,KAAKijC,OAAOma,GACrB2pE,EAAQ/mH,KAAKknD,OAAO9J,GACpBwlG,EAAY1iI,KAAK2iB,MAAM/mB,EAAGkE,aAAa8wD,QAAQ,SAAS,GACxD+xE,EAASD,EAAUziJ,GACnB2iJ,EAA4C,sBAAlCF,EAAU9xI,qBAA+C,OAAS,MAC5ExL,EAAY,CAAEnF,GAAI0iJ,EAAQxmJ,IAAKymJ,GACnC,GAAI1pJ,GAAQwpJ,EAAUn3I,WAAY,CAY9B,GAXK/G,IAAEs3E,UAAU5iF,EAAK0pJ,GAAUx9I,KAC5BlM,EAAK0pJ,GAAShpJ,KAAK,CACfqG,GAAI0iJ,EACJxmJ,IAAKymJ,EACL/xI,IAAK6xI,EAAU7xI,KAAO,UACtBjT,KAAM8kJ,EAAU7xI,IAAM6xI,EAAU9kJ,KAAO+kJ,EACvCF,MAAM,EACNr8H,KAAM,KAEVtmB,KAAK0D,eAELu/B,EAAO5mC,KAAOymJ,EAAS,CACvB,IAAIC,EAAgBh8B,EAAMxoH,QACtBwkJ,GAAiB9/G,EAAO3/B,UACc,GAAlCy/I,EAAcrhJ,QAAQmhJ,IACtBE,EAAcjpJ,KAAK+oJ,GAGvBE,EAAgBF,EAEpB97B,EAAMxoH,MAAMwkJ,QAEZ/iJ,KAAKC,MAAMW,IAAI,QAAS,CAAE6E,OAAQ,CAACH,KACnCtF,KAAKC,MAAM4C,QAAQ,gBAEvB7C,KAAK6C,QAAQ,UACb7C,KAAKgjJ,kBAAkB,gBAEvBhjJ,KAAKgjJ,kBAAkB,UAE7B,MAAO1nJ,GACL0E,KAAKgjJ,kBAAkB,UAE3BlnI,EAAGra,kBAIPuhJ,kBAAmB,SAASl9I,GACxB,IAAI/F,EAAOC,KACXA,KAAKe,IAAIuB,YAAY,eAAeF,SAApC,eAAAsD,OAA4DI,IAC5DvI,WAAW,WACPwC,EAAKgB,IAAIuB,YAAT,eAAAoD,OAAoCI,KACrC9F,KAAKC,MAAM9B,IAAI,iBAItB8jJ,OAAQ,SAASxnJ,GACbA,EAAM,OAAY,EAClB,IAAI2iD,EAAUp9C,KAAKC,MAAM9B,IAAI,WACzB8kC,EAASjjC,KAAKijC,OAAOma,GACzB,GAAkB,QAAdna,EAAO5mC,IAAe,CACtB,IAAI+kJ,EAAOphJ,KAAK2oG,QAAL,GAAAjjG,OAAgB1F,KAAKknD,OAAO9J,GAAS7+C,QAArC,UACP6iJ,GAAQA,EAAK6B,gBACbxoJ,EAAM,OAAY,GAS1B,OANIwoC,EAAOy9G,OAASF,GAAgBv9G,EAAOy9G,OAASF,IAChD/lJ,EAAM,OAAY,EACdwoC,EAAOy9G,OAASF,GAAiD,SAAhCxgJ,KAAKuhJ,eAAehjJ,UACrD9D,EAAM,SAAc,IAGrBA,MCtVAyoJ,EAAA,CACXxjJ,KA/IOC,IAASD,KAAKE,OAAO,CAC5BC,WAAY,SAASC,GAAS,IAAA6J,EAAA3J,KAC1BA,KAAKF,QAAUA,EACfE,KAAKlC,KAAOgC,EAAQhC,MAAQ,UAC5BkC,KAAKsD,SAAWxD,EAAQwD,WAAY,EAGpCtD,KAAK8C,QAAU,IAAIoM,IAAGrH,QAAQ,CAAEC,IAAK,aAGrC9H,KAAKmjJ,WAAajiJ,IAAE,UAGpBlB,KAAK4J,OAAS,IAAIsF,IAAGpE,OAAOpL,KAAK,CAAE6D,SAAUzD,EAAQyD,WAGrDvD,KAAKkH,QAAUhG,IAAC,mCAChBlB,KAAKkH,QAAQ7F,GAAG,QAAS,WACrBsI,EAAKmD,IAAI,CACL3M,GAAIwJ,EAAKC,OAAOrL,QAChBT,KAAM6L,EAAKC,OAAO/D,WAK1B7F,KAAKa,WAAWb,KAAKc,UAAUhB,IAC/BE,KAAKkB,EAAE,oBAAoB2C,OAAO7D,KAAK8C,QAAQ/B,KAC/Cf,KAAKkB,EAAE,uBAAuB2C,OAAO7D,KAAKmjJ,YAC1CnjJ,KAAKkB,EAAE,mBAAmB2C,OAAO7D,KAAKkH,SACtClH,KAAKkB,EAAE,mBAAmB2C,OAAO7D,KAAK4J,OAAO7I,MAIjDxC,MAAO,SAAS+C,GAEZ,QAAYhE,IAARgE,EAAmB,CAEnB,GADAtB,KAAKmjJ,WAAWv/I,QACZ1C,IAAEmE,QAAQ/D,GACV,IAAK,IAAI5H,KAAK4H,EAAK,CACf,IAAIE,EAAIF,EAAI5H,GACR0pJ,EAAO,KACPC,EAAS,KACI,UAAbniJ,IAAElE,KAAKwE,IACP4hJ,EAAO5hJ,EAAErB,GACTkjJ,EAAS7hJ,EAAE1D,MAEXslJ,EAAOC,EAAS7hJ,EAER,MAAR4hJ,GACApjJ,KAAK8M,IAAI,CACL3M,GAAIijJ,EACJtlJ,KAAMulJ,IAKtBrjJ,KAAK+P,WAGT,IAAIuzI,EAAM,GASV,OARAtjJ,KAAKkB,EAAE,eAAeyD,KAAK,WACvB2+I,EAAIxpJ,KAAK,CACLqG,GAAIe,IAAElB,MAAMqE,KAAK,MACjBvG,KAAMoD,IAAElB,MACHqH,KAAK,iBACLtB,WAGK,GAAdu9I,EAAI1pJ,OACG,KAEJ0pJ,GAIXx2I,IAAK,SAAShN,GACV,IAAIC,EAAOC,KACX,GAA8C,IAA1CA,KAAKkB,EAAL,QAAAwE,OAAe5F,EAAQK,GAAvB,OAA+BvG,OAC/B,GAAKwG,IAAMwF,QAAQ9F,EAAQK,IAcvBH,KAAK8C,QAAQyB,OAAO,CAChBzB,QAAO,yBAAA4C,OAA2B1F,KAAKlC,KAAhC,KACPgI,OAAQ,eAhBgB,CAC5B,IAAI/E,EAAMG,IACNlB,KAAKujJ,aAAa,CACdpjJ,GAAIL,EAAQK,GACZrC,KAAMgC,EAAQhC,QAGtBiD,EAAIsG,KAAK,UAAUhG,GAAG,QAAS,WAC3BN,EAAIgN,SACJhO,EAAKgQ,aAET/P,KAAKmjJ,WAAWt/I,OAAO9C,GACvBf,KAAK+P,gBAQT/P,KAAK8C,QAAQyB,OAAO,CAChBzB,QAAO,QAAA4C,OAAU1F,KAAKlC,KAAf,+BAMnByG,OAAQ,SAASC,GACbxE,KAAK4J,OAAOrF,OAAOC,IAIvBuL,SAAU,WACF/P,KAAKkB,EAAE,eAAetH,OAAS,GAC9BoG,KAAKsD,UAAYtD,KAAKkH,QAAQlG,KAAK,YAAY,GAEhDhB,KAAKkH,QAAQlG,KAAK,YAAY,GAElChB,KAAKF,QAAQa,UAAYX,KAAKF,QAAQa,YAI1CG,UAAW,SAAShB,GAChB,+cAaJyjJ,aAAc,SAASzjJ,GACnB,kBAAA4F,OAAmB5F,EAAQK,GAA3B,yJAAAuF,OAEwC5F,EAAQhC,KAFhD,8CCpIJ4gE,EAAY/+D,IAASkN,WAAWjN,OAAO,CACvC2L,IAAG,GAAA7F,OAAK8F,uBAAL,iCAIHg4I,EAAkB7jJ,IAASkN,WAAWjN,OAAO,CAC7CC,WAAY,WACR,IAAIE,EAAOC,KACXA,KAAKijC,OAAS,IAAItjC,IAASO,MAAM,CAAE+gH,WAAY,OAC/CjhH,KAAKijC,OAAO5hC,GAAG,SAAU,WACrBtB,EAAKiN,MAAM,CAAE4J,OAAO,OAG5BrL,IAAK,WACD,SAAA7F,OAAU8F,uBAAV,kBAAA9F,OAAuC1F,KAAKijC,OAAO9kC,IAAI,cAAvD,gBAsGOslJ,EAAA,CACX/jJ,KAlGOC,IAASD,KAAKE,OAAO,CAE5BC,WAAY,SAASC,GAEjB,IAAIC,EAAOC,KAGXA,KAAKukG,UAAY,IAAI7lC,EACrB1+D,KAAK2vB,SAAW,IAAI6zH,EAGpBxjJ,KAAKF,QAAUA,EAIfE,KAAK0jJ,eAAiB,IAAIx0I,IAAGpE,OAAOpL,KAAK,CACrCiB,SAAU,SAASpC,GACfwB,EAAK4vB,SAASsT,OAAOriC,IAAI,aAAcrC,MAK/CyB,KAAKmtC,aAAe,IAAIw2G,EAAKjkJ,KAAK,CAC9B5B,KAAM,UACNyF,SAAUzD,EAAQyD,SAClBD,SAAUxD,EAAQwD,SAClB3C,SAAU,WACNZ,EAAK8C,QAAQ,aAKrB7C,KAAKukG,UAAUljG,GAAG,QAAS,WACvB,IAAIjI,EAAO,GACX2G,EAAKwkG,UAAU5/F,KAAK,SAAA1E,GAChB7G,EAAKU,KAAK,CACNyE,MAAO0B,EAAME,GACb+F,MAAOjG,EAAM9B,IAAI,YAGzB4B,EAAK2jJ,eAAen/I,OAAO,CAAEnL,KAAMA,MAIvC4G,KAAK2vB,SAAStuB,GAAG,QAAS,WACtB,IAAIjI,EAAO,GAEa,OADF2G,EAAK2jJ,eAAe79I,QAEtC9F,EAAK4vB,SAAShrB,KAAK,SAAA1E,GACW,SAAtBA,EAAM9B,IAAI,SACV/E,EAAKU,KAAK,CACNyE,MAAO0B,EAAME,GACb+F,MAAOjG,EAAM9B,IAAI,YAKjC4B,EAAKotC,aAAa5oC,OAAO,CAAEnL,KAAMA,MAIrC4G,KAAKqB,GAAG,SAAU,WACVvB,EAAQa,UACRb,EAAQa,SAASZ,EAAKxB,WAK9ByB,KAAKa,WAAWb,KAAKc,aACrBd,KAAKkB,EAAE,mBAAmB2C,OAAO7D,KAAK0jJ,eAAe3iJ,KACrDf,KAAKe,IAAI8C,OAAO7D,KAAKmtC,aAAapsC,KAGlCf,KAAKukG,UAAUv3F,MAAM,CACjB4J,OAAO,EACPwqB,QAAS,WACLrhC,EAAK2jJ,eAAe7gJ,QAAQ,eACDvF,IAAvByC,EAAKD,QAAQvB,OACbwB,EAAKxB,MAAMwB,EAAKD,QAAQvB,WAOxCA,MAAO,SAAS+C,GACZ,OAAOtB,KAAKmtC,aAAa5uC,MAAM+C,IAInCR,UAAW,WACP,4HCpEO8iJ,EAAA,CACXlkJ,KA1COC,IAASD,KAAKE,OAAO,CAE5BC,WAAY,SAASC,GAEjB,IAAIC,EAAOC,KAGXA,KAAK6jJ,aAAe,IAAIF,EAAKjkJ,KAAK,CAC9B5B,KAAM,OACNyF,SAAUzD,EAAQyD,SAClBD,SAAUxD,EAAQwD,SAClB3C,SAAU,WACNb,EAAQa,UAAYb,EAAQa,SAASZ,EAAKxB,YAKlDyB,KAAKa,WAAWb,KAAK6jJ,aAAa9iJ,KAGlCX,IAAMjC,IAAI,CACNoN,IAAG,GAAA7F,OAAK8F,uBAAL,oBACH41B,QAAS,SAASl4B,GACd,IAAI9P,EAAO,GACX,IAAK,IAAIM,KAAKwP,EACV9P,EAAKU,KAAK,CACNyE,MAAO2K,EAASxP,GAAT,KACPwM,MAAOgD,EAASxP,GAAT,OAGfqG,EAAK8jJ,aAAat/I,OAAOnL,OAMrCmF,MAAO,SAAS+C,GACZ,OAAOtB,KAAK6jJ,aAAatlJ,MAAM+C,OCzCxBwiJ,EACM,SAAShkJ,GACtB,IAAIwP,EAASC,cACTw0I,EAAYz0I,EAAO2zB,OAAO+gH,mBAC1BC,EAAa,GAAAv+I,OAAMq+I,EAAN,qDAEbG,EAAS5kJ,OAAOyvC,KAAKk1G,EAAe,2BAA4B,4BAEpE3kJ,OAAOsuB,iBACH,UACA,SAAAtyB,GACQwE,EAAQqkJ,iBAAmB7oJ,EAAElC,KAAKgrJ,aAClCtkJ,EAAQqkJ,gBAAgB7oJ,EAAElC,QAGlC,GAGJ8qJ,EAAOtsH,QAEyB,MAA5B93B,EAAO,gBAA2BokJ,EAAOG,2BAA6B/0I,EAAO2zB,OAAP,gBCoDnEqhH,EAAA,CACX5kJ,KAtEOC,IAASD,KAAKE,OAAO,CAE5BC,WAAY,SAASC,GAEjB,IAAIC,EAAOC,KACXA,KAAKF,QAAUA,EAGfE,KAAKukJ,cAAgB,IAAIr1I,IAAGzE,OAAO,CAC/B1F,MAAOgK,IAAG,UACVxI,KAAM,gBACNuB,IAAK,+BACLhD,QAASiK,IAAG,sBACZ3K,QAAS,WACLrE,EAAKykJ,kBAAkB1kJ,MAK/BE,KAAKykJ,iBAAmB,IAAIv1I,IAAG7G,MAG/BrI,KAAKa,WAAWb,KAAKc,UAAUhB,IAC/BE,KAAKkB,EAAE,qBAAqB2C,OAAO7D,KAAKukJ,cAAcxjJ,KACtDf,KAAKkB,EAAE,wBAAwB2C,OAAO7D,KAAKykJ,iBAAiB1jJ,MAIhEyjJ,kBAAmB,SAAS1kJ,GACxB,IAAIC,EAAOC,KACX0kJ,EAAmC,CAC/BP,gBAAiB,SAAS/qJ,GACtB2G,EAAKxB,MAAMnF,EAAKgrJ,iBAM5BtjJ,UAAW,SAAShB,GAChB,2KAOJvB,MAAO,SAAS+G,GAEZ,QAAkBhI,IAAdgI,EAGA,OAAOtF,KAAKsE,YAFZtE,KAAKmF,UAAUG,IAOvBhB,UAAW,WACP,OAAOtE,KAAKykJ,iBAAiBlmJ,SAIjC4G,UAAW,SAASG,GACZA,GACAtF,KAAKykJ,iBAAiBlmJ,MAAM+G,GAEhCtF,KAAKF,QAAQa,UAAYX,KAAKF,QAAQa,SAAS2E,gDChDvDq/I,EAAA,CAAAziJ,OAAA,eAAAwnB,EAAA1pB,KAAA2pB,EAAAD,EAAAE,eAAAE,EAAAJ,EAAAG,MAAAC,IAAAH,EAAA,OAAAG,EAAA,MAAAC,YAAA,SAAAD,EAAA,QAAAC,YAAA,iBAAAL,EAAAQ,GAAAR,EAAAS,GAAAT,EAAA3kB,OAAA,oBAAA2kB,EAAAQ,GAAA,KAAAR,EAAAk7H,KAAA5jH,KAAAlX,EAAA,QAAAC,YAAA,iBAAAL,EAAAQ,GAAA,qBAAAR,EAAAS,GAAAT,EAAAk7H,KAAA5jH,MAAA,oBAAAtX,EAAA4/B,KAAA5/B,EAAAQ,GAAA,KAAAR,EAAAk7H,KAAAznJ,MAAA2sB,EAAA,QAAAC,YAAA,eAAAD,EAAA,QAAAC,YAAA,kBAAAL,EAAAQ,GAAAR,EAAAS,GAAAT,EAAAk7H,KAAAznJ,YAAAusB,EAAA4/B,QAAAu7F,gBAAA,GAaAn8H,MAAA,CACAk8H,KAAA,CACAh8H,UAAA,EACA5rB,KAAAjD,QAEA+qJ,WAAA,CACA9nJ,KAAA4iB,MACAgJ,UAAA,IAGAC,SAAA,CACA9jB,MADA,WAEA,IAAAggJ,EAAA/kJ,KAAA4kJ,KAAA5nJ,KACA,OAAAgoJ,EAAA,EAAAC,MAAAF,GAAAp+I,QAAA3G,KAAA4kJ,KAAA5kJ,KAAA8kJ,cAGAn6H,QAAA,IAGAu6H,EAAA,CAAAhjJ,OAAA,eAAAynB,EAAA3pB,KAAA4pB,eAAA,OAAA5pB,KAAA6pB,MAAAC,IAAAH,GAAA,MAAAI,YAAA,OAAAkB,MAAA,CAAAlmB,MAAA/E,KAAA6hD,OAAA,CAAA7hD,KAAAkqB,GAAA,iBAAAlqB,KAAAmqB,GAAAnqB,KAAAmlJ,cAAA,OAAAnlJ,KAAAmqB,GAAAnqB,KAAAolJ,aAAA,eAAAP,gBAAA,GAMAn8H,MAAA,CACA1rB,KAAA,CACAA,KAAAgG,OACA4lB,UAAA,GAEAs0G,QAAA,CACAt0G,UAAA,GAEAk8H,WAAA,CACA9nJ,KAAA4iB,MACAgJ,UAAA,IAGAC,SAAA,CACAu8H,YADA,WAEA,OAAAJ,EAAA,EAAAK,gBAAArlJ,KAAAhD,MAAAkJ,OAEA27C,KAJA,WAKA,OAAAmjG,EAAA,EAAAK,gBAAArlJ,KAAAhD,MAAA6kD,MAAA,IAEAsjG,aAPA,WAQA,OAAAH,EAAA,EAAAM,cAAAtlJ,KAAAk9H,QAAAl9H,KAAA8kJ,eCnF0MS,EDwF1M,CACAnsJ,KAAA,WACA,UAEAyvB,SAAA,CACA28H,QAAA,WACA,OAAAxlJ,KAAAylJ,WAAAzlJ,KAAAylJ,WAAAD,QAAA,IAEAnX,MAAA,WACA,OAAAruI,KAAAylJ,WAAAzlJ,KAAAylJ,WAAApX,MAAA,IAEAqX,WAAA,WACA,IAAAC,EAAA,GAEA,OAAAA,oBAAAzoB,QADA8nB,EAAA,EAAAY,WAAA,SAAA5lJ,KAAAquI,MAAAsX,GACAzoB,UAEA4nB,WAAA,WACA,IAAA5nB,EAAAl9H,KAAA0lJ,WAAAxoB,QACA,OAAA8nB,EAAA,EAAAa,cAAA,GAAA3oB,KAGAx0G,MAAA,CACA+8H,WAAA,CACA78H,UAAA,EACA5rB,KAAAjD,SAGAswB,WAAA,CACAs6H,qBACAO,qCEnGeY,EAXC/rJ,OAAA0vB,EAAA,EAAA1vB,CACdwrJ,ECRQ,WAAgB,IAAA77H,EAAA1pB,KAAa2pB,EAAAD,EAAAE,eAA0BE,EAAAJ,EAAAG,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAAA,EAAA,MAA0BC,YAAA,SAAoB,CAAAL,EAAA3a,GAAA2a,EAAA,eAAAk7H,EAAAx4I,GAA0C,OAAA0d,EAAA,wBAAkCjrB,IAAAuN,EAAA6e,MAAA,CAAiB25H,OAAAx4I,QAAA25I,cAAAr8H,EAAAg8H,WAAAC,kBAAAv5I,QAAmFsd,EAAAQ,GAAA,KAAAR,EAAA3a,GAAA2a,EAAA,iBAAApc,EAAAlB,GAAuD,OAAA0d,EAAA,6BAAAJ,EAAAs8H,GAAA,CAA+CnnJ,IAAAyO,EAAAtQ,KAAAiuB,MAAA,CAAoB7e,QAAA25I,cAAAr8H,EAAAo7H,aAA4C,6BAAAx3I,GAAA,OAA0C,MACvgB,IDUA,EACA,KACA,KACA,cEqJe24I,EAAA,CACXvmJ,KAvJOC,IAASD,KAAKE,OAAO,CAE5BC,WAAY,SAASC,GAAS,IAAA6J,EAAA3J,KAE1BA,KAAKF,QAAUA,EACfE,KAAK9C,OAAS4C,EAAQ5C,OACtB8C,KAAK4W,MAAQ,KACb,IAAM/C,EAAO7T,KAGbA,KAAKukJ,cAAgB,IAAIr1I,IAAGzE,OAAO,CAC/B1F,MAAOgK,IAAG,QACVxI,KAAM,aACNzB,QAASiK,IAAG,cACZ3K,QAAS,WACDyP,EAAK3W,OACL2W,EAAKqyI,yBAELryI,EAAKsyI,gBAAgB,SAMjCnmJ,KAAKqB,GAAG,SAAU,WACVvB,EAAQa,UACRb,EAAQa,SAASgJ,EAAKpL,WAK9ByB,KAAKa,WAAWb,KAAKc,UAAUhB,IAC/BE,KAAKkB,EAAE,yBAAyB2C,OAAO7D,KAAKukJ,cAAcxjJ,KAC1D,IAAIqlJ,EAAuB5kG,IAAI5hD,OAAOkmJ,GAClCpkG,EAAK3lD,SAASC,cAAc,OAChCgE,KAAKkB,EAAE,qBAAqB2C,OAAO69C,GACnC1hD,KAAKqmJ,SAAW,IAAID,EAAqB,CACrCzkG,UAAW,CACP2kG,aAAc,CACVjY,MAAO,GACPmX,QAAS,OAIrBxlJ,KAAKqmJ,SAASzkG,OAAOF,GACrB1hD,KAAKmgJ,sBAAuB,GAGhC+F,uBAAwB,WAAW,IAAAt4I,EAAA5N,KAEzBuL,EAAG,GAAA7F,OAAM8F,uBAAN,4BAAA9F,OADI1F,KAC8C9C,OAAOiD,GAAzD,0BACT8jC,IACK9lC,IAAIoN,GACJ24B,KAAK,SAAAh7B,GAAQ,OAAI0E,EAAK24I,gBAAgBr9I,KACtCu+C,MALQznD,KAKGwmJ,oBAGpBD,gBAAiB,SAASr9I,GACtB,IAAM2L,EAAW3L,EAAS9P,KAC1B4G,KAAKmmJ,gBAAgBtxI,IAGzBsxI,gBAAiB,SAAStxI,GAAU,IAAAiyB,EAAA9mC,KAI1BF,EAAU,CACZ2mJ,YAAa,SAAApY,GAAK,OAAIvnG,EAAK4/G,iBAAiBrY,IAC5CiY,aAHQtmJ,KAAK2mJ,QAKjB7zI,IAAsB2qG,gCAAgC5oG,EAPjC,sBACF,cAMuE/U,GAASkO,KAC/F,eAIR04I,iBAAkB,SAASrY,GACvBruI,KAAKmF,UAAUkpI,IAGnBmY,kBAAmB,SAASlrJ,GACxB8D,QAAQ8a,IAAI5e,GACZ8D,QAAQ8a,IAAI,gCAIhBpZ,UAAW,SAAShB,GAChB,+MASJvB,MAAO,SAAS+G,GAEZ,QAAkBhI,IAAdgI,EAGA,OAAOtF,KAAKsE,YAFZtE,KAAKmF,UAAUG,IAOvBf,OAAQ,SAASC,GACbxE,KAAK9C,OAASsH,EAAUtH,QAI5BoH,UAAW,WACP,OAAOtE,KAAK2mJ,QAIhBxhJ,UAAW,SAASG,GACZA,IACwB,iBAAbA,IACPA,EAAY4a,KAAK2iB,MAAMv9B,IAE3BtF,KAAK2mJ,OAASrhJ,EACdtF,KAAK6C,QAAQ,UACb7C,KAAKqmJ,SAASZ,WAAangJ,EACvBtF,KAAK4W,QACL5W,KAAK4W,QACL5W,KAAK4W,MAAQ,QAKzBgwI,SAAU,SAAShwI,GACf,IAAMrY,EAAQyB,KAAK2mJ,OACf7jJ,EAAU,KACd,GAAKvE,GAAgC,IAAvBA,EAAM8vI,MAAMz0I,OAEnB,GAA6B,IAAzB2E,EAAMinJ,QAAQ5rJ,OACrBkJ,EAAU,qFACP,KAAA4jD,GAAA,EAAAC,GAAA,EAAAC,OAAAtpD,EAAA,IACH,QAAAupD,EAAAC,EAAiBvoD,EAAM8vI,MAAvBhwI,OAAA0oD,cAAAL,GAAAG,EAAAC,EAAAxpC,QAAAtP,MAAA04C,GAAA,EAA8B,CAC1B,GAD0BG,EAAAtoD,MACjBpB,MAAO,CACZ2F,EAAU,8BACV,QAJL,MAAA3D,GAAAwnD,GAAA,EAAAC,EAAAznD,EAAA,YAAAunD,GAAA,MAAAI,EAAAU,QAAAV,EAAAU,SAAA,WAAAb,EAAA,MAAAC,SAHH9jD,EAAU,8CAYd,OADA9C,KAAK4W,MAAQA,EACN,CAAEq7H,OAAQnvI,EAASA,QAASA,OC1J3C,SAAS+jJ,EAAIr6H,GACT,MAAO,IAAA9mB,OAAI3C,SAASypB,GAAG7f,SAAS,KAAMnN,OAAO,GAGlCG,UAASD,KAAKE,OAAO,CAChCo6I,OAAQ,CACJ8M,SAAU,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UACrG5mD,KAAM,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UACjG6mD,MAAO,CACH,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UAC3F,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UAC3F,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UAC3F,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UAC3F,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,YAInGlnJ,WAAY,SAASC,GACjBE,KAAKF,QAAUM,IAAM0O,MAAMhP,EAAS,IACpCE,KAAKa,WAAWb,KAAKc,aACrBd,KAAKu3H,OAASv3H,KAAKkB,EAAE,0BACrBlB,KAAKgnJ,MAAQhnJ,KAAKkB,EAAE,yBACpBlB,KAAKinJ,OAASjnJ,KAAKkB,EAAE,0BACrBlB,KAAKo1B,QAAUp1B,KAAKkB,EAAE,2BACtBlB,KAAKknJ,SACLlnJ,KAAKmD,SAAU,EACfnD,KAAKzB,MAAMyB,KAAKF,QAAQvB,OACxByB,KAAKmnJ,OAASnnJ,KAAKkB,EAAE,wBACrB,IAAInB,EAAOC,KACXA,KAAKmnJ,OAAO9lJ,GAAG,QAAS,WACpBtB,EAAKxB,MAAM2C,IAAElB,MAAMkF,IAAI,qBACvBnF,EAAKq1B,QAAQvyB,QAAQ,WAEzB7C,KAAKo1B,QAAQ/zB,GAAG,QAAS,WACrBtB,EAAKoD,SAAWpD,EAAKoD,QACjBpD,EAAKoD,QACLpD,EAAKinJ,MAAMn3I,OAAO,QAElB9P,EAAKinJ,MAAMzpI,QAAQ,WAM/Bhf,MAAO,SAASgE,GAOZ,OANIA,UACAvC,KAAKinJ,OAAO/hJ,IAAI,mBAAoB3C,GACpCvC,KAAKkB,EAAE,wBAAwB0C,QAC/B5D,KAAKkB,EAAElB,KAAKsE,aAAayB,KAAK/F,KAAKonJ,kBACnCpnJ,KAAKF,QAAQa,UAAYX,KAAKF,QAAQa,SAAS4B,IAE5CvC,KAAKsE,aAIhBA,UAAW,WACP,IAAI+iJ,EAAMrnJ,KAAKinJ,OAAO/hJ,IAAI,oBAE1B,OADAmiJ,EAAMA,EAAIh4H,MAAM,qCAEZ,IAAA3pB,OAAWmhJ,EAAIQ,EAAI,KAAnB3hJ,OAAyBmhJ,EAAIQ,EAAI,KAAjC3hJ,OAAuCmhJ,EAAIQ,EAAI,KAExC,MAKfH,OAAQ,WAEJ,IAAK,IAAIxtJ,KADTsG,KAAKsnJ,SAAS,CAAEtN,OAAQh6I,KAAKg6I,OAAO95C,OACtBlgG,KAAKg6I,OAAO+M,MAAO,CAC7B,IAAIQ,EAAW,GACN,GAAL7tJ,EACA6tJ,EAAQ,QAAa,EACd7tJ,GAAKsG,KAAKg6I,OAAO+M,MAAMntJ,OAAS,GACvC2tJ,EAAQ,KAAU,EAClBA,EAAQ,QAAa,GAErBA,EAAQ,KAAU,EAEtBA,EAAQ,OAAavnJ,KAAKg6I,OAAO+M,MAAMrtJ,GACvCsG,KAAKsnJ,SAASC,GAElBvnJ,KAAKsnJ,SAAS,CAAEtN,OAAQh6I,KAAKg6I,OAAO8M,YAIxCQ,SAAU,SAASxnJ,GACf,IAAIk6I,EAASl6I,EAAQk6I,OACjB/yG,EAAW/lC,IAAElB,KAAKwnJ,oBAClBC,EAAQxgH,EAAS5/B,KAAK,SAE1B,IAAK,IAAI3N,KADTsG,KAAKu3H,OAAO1zH,OAAOojC,GACL+yG,EAAQ,CAClB,IAAI0N,EAAOxmJ,IAAElB,KAAK2nJ,aAAa3N,EAAOtgJ,KAClCoG,EAAQg+B,MACR4pH,EAAKxiJ,IAAI,aAAc,QACvBwiJ,EAAKxiJ,IAAI,yBAA0B,OACnCwiJ,EAAKxiJ,IAAI,0BAA2B,QAEpCpF,EAAQwvE,SACRo4E,EAAKxiJ,IAAI,gBAAiB,QAC1BwiJ,EAAKxiJ,IAAI,4BAA6B,OACtCwiJ,EAAKxiJ,IAAI,6BAA8B,QAE3CuiJ,EAAM5jJ,OAAO6jJ,GAEjB,OAAOzgH,GAIXmgH,eAAgB,WACZ,MAAO,oDAIXI,iBAAkB,WACd,MAAO,kEAIXG,aAAc,SAASj/I,GACnB,kBAAAhD,OAAmBgD,EAAnB,4DAAAhD,OAAmFgD,EAAnF,SAIJ5H,UAAW,WACP,6bCjHOnB,MAASO,MAAMN,OAAO,CAEjC6N,MAAO,CACH5H,KAAM,aACN+hJ,SAAU,aACVh+I,OAAQ,eACRi+I,YAAa,eACbC,YAAa,eACb1uJ,KAAM,aACNwnJ,gBAAiB,aACjBmH,QAAS,eACTC,MAAO,eACPC,QAAS,gBACTC,WAAY,kBACZx/I,MAAO,cACPy/I,UAAW,eACXl3I,OAAQ,eACRm3I,YAAa,eACbC,QAAS,eACTC,aAAc,gBACdC,QAAS,YACTC,OAAQ,eACRna,MAAO,kBACPoa,gBAAiB,qBAIrB7pJ,OAAQ,SAAS4F,GACb,IAAI8K,EAASC,cACTm5I,EAAa1oJ,KAAKyN,MAAMjJ,EAAUxH,MAClC+pH,EAAoC,mBAArB/mH,KAAK0oJ,GAA6B1oJ,KAAK0oJ,GAAYxuJ,KAAK8F,KAAMwE,GAAa,KAS9F,OARKuiH,IACDA,EAAQviH,EAAU1E,QAAUE,KAAK2oJ,aAAankJ,GAAaxE,KAAK4oJ,WAAWpkJ,GAC3E8K,EAAOU,KAAKC,MAAM,6BAAlB,4BAAAvK,OAA4ElB,EAAUxH,KAAtF,aAEoBM,IAApBkH,EAAUjG,QACViG,EAAUjG,MAAQ,MAEtBwoH,EAAMxoH,MAAMiG,EAAUjG,OACfwoH,GAIX8hC,WAAY,SAASrkJ,GACjB,OAAO,IAAIskJ,EAAcppJ,KAAK,CAC1BS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBq1E,WAAYhxE,EAAUgxE,WACtBjyE,SAAUiB,EAAUjB,SACpBD,SAAUkB,EAAUlB,SACpBtG,KAAMwH,EAAUxH,KAChB+rJ,OAAQvkJ,EAAUukJ,OAClB3vJ,KAAMoL,EAAU1E,QAChBa,SAAU6D,EAAU7D,YAK5BgoJ,aAAc,SAASnkJ,GAEnB,GAAIA,EAAU28E,YACV,OAAOnhF,KAAK4oJ,WAAWpkJ,GAIL,eAAlBA,EAAUxH,OACVwH,EAAUpB,WAAa,0CAI3B,IAKIyG,EALU,CACVq5H,WAAYh0H,IAAG9I,SACf4iJ,MAAO95I,IAAG/I,MACV8iJ,YAAa/5I,IAAG7I,aAEM7B,EAAUmC,UAAYuI,IAAGpE,OACnD,OAAO,IAAIoE,IAAGxF,WAAW,CACrBvJ,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvB/G,KAAMoL,EAAUpL,KAChB0G,QAAS0E,EAAU1E,QACnB6G,QAASnC,EAAUmC,QACnBvD,WAAYoB,EAAUpB,YAAc,uBACpCoF,SAAUhE,EAAUgE,SACpBlF,SAAUkB,EAAUlB,SACpBC,SAAUiB,EAAUjB,SACpB5C,SAAU6D,EAAU7D,SACpB6hJ,WAAYh+I,EAAUg+I,WACtBD,WAAiC,aAArB/9I,EAAUukJ,OACtBh/I,SAAUvF,EAAUuF,SACpBF,YAAaA,KAKrBq/I,gBAAiB,SAAS1kJ,GAEtB,OAAIA,EAAU28E,YACHnhF,KAAK4oJ,WAAWpkJ,GAIpB,IAAI0K,IAAGlE,UAAUtL,KAAK,CACzBS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvB/G,KAAMoL,EAAU1E,QAChB6G,QAASnC,EAAUmC,QACnBpD,SAAUiB,EAAUjB,SACpB5C,SAAU6D,EAAU7D,YAK5BioJ,WAAY,SAASpkJ,GAEjB,GAA8B,uBAA1BA,EAAU6hB,aAAwC7hB,EAAU1E,SAAW0E,EAAUpL,KAEjF,GADAoL,EAAUiE,KAAOjE,EAAUlB,SACvBlD,IAAMwF,QAAQpB,EAAUjG,OACxBiG,EAAUjG,MAAQ,UAElB,GAAI2C,IAAEmE,QAAQb,EAAUjG,OAAQ,CAC5B,IAAI4qJ,EAAY,GAChB,IAAK,IAAIzvJ,KAAK8K,EAAUjG,MAAO,CAE3B,GADA4qJ,GAAanmJ,OAAOwB,EAAUjG,MAAM7E,KAC/B8K,EAAUlB,SACX,MAEJ6lJ,GAAa,KAEjB3kJ,EAAUjG,MAAQ4qJ,EAK9B,OAAO,IAAIj6I,IAAG7G,MAAM,CAChBlI,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBnD,KAAMwH,EAAUxH,KAChByL,KAAMjE,EAAUiE,KAChBD,SAAUhE,EAAUgE,SACpBF,YAAa9D,EAAU8D,YACvBS,SAAUvE,EAAUuE,SACpBpI,SAAU6D,EAAU7D,YAK5ByoJ,aAAc,SAAS5kJ,GACnB,OAAO,IAAI0K,IAAGnE,OAAOrL,KAAK,CACtBS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBM,QAA2B,SAAlB+D,EAAUxH,KACnBmkF,YAAa38E,EAAU28E,YACvB7gF,IAAKkE,EAAUlE,IACfC,IAAKiE,EAAUjE,IACfI,SAAU6D,EAAU7D,YAK5B0oJ,aAAc,SAAS7kJ,GACnB,OAAO,IAAI0K,IAAG3F,OAAO,CACjBpJ,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBokB,KAAM/f,EAAU+f,QAKxB+kI,cAAe,SAAS9kJ,GACpB,OAAO,IAAI0K,IAAG7I,YAAY3G,KAAK,CAC3BS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvB/G,KAAM,CAAC,CAAE8M,MAAO,MAAO3H,MAAO,QAAU,CAAE2H,MAAO,KAAM3H,MAAO,UAC9DoC,SAAU6D,EAAU7D,YAK5B4oJ,YAAa,SAAS/kJ,GAClB,OAAO,IAAIglJ,EAAY,CACnBrpJ,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBQ,SAAU6D,EAAU7D,YAK5B8oJ,cAAe,SAASjlJ,GACpB,OAAO,IAAIklJ,EAAchqJ,KAAK,CAC1BS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBoD,SAAUiB,EAAUjB,SACpBD,SAAUkB,EAAUlB,SACpB3C,SAAU6D,EAAU7D,YAK5BgpJ,UAAW,SAASnlJ,GAChB,OAAO,IAAIolJ,EAAUlqJ,KAAK,CACtBS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBoD,SAAUiB,EAAUjB,SACpBD,SAAUkB,EAAUlB,SACpB3C,SAAU6D,EAAU7D,YAM5BkpJ,kBAAmB,SAASrlJ,GACxB,OAAO,IAAIslJ,EAAkBpqJ,KAAK,CAC9BS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBQ,SAAU6D,EAAU7D,YAI5BopJ,gBAAiB,SAASvlJ,GACtB,OAAO,IAAIwlJ,EAAUtqJ,KAAK,CACtBS,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBQ,SAAU6D,EAAU7D,SACpBzD,OAAQsH,EAAUtH,UAK1B+sJ,aAAc,SAASzlJ,GACnB,OAAO,IAAI0K,IAAGlF,OAAO,CACjB7J,GAAE,SAAAuF,OAAWlB,EAAUrE,IACvBQ,SAAU6D,EAAU7D,cCjO5BjB,EAAOC,IAASD,KAAKE,OAAO,CAC5BC,WAAY,SAAS0nE,EAAKznE,GACtBE,KAAKunE,IAAMA,EACXvnE,KAAKy9E,OAAS39E,EAAQ29E,OACtBz9E,KAAK8mH,WAAa,IAAIojC,EACtBlqJ,KAAKa,WAAWK,IAAE,WAClBlB,KAAKkC,UAITA,OAAQ,WACJ,IAAInC,EAAOC,KACXA,KAAKe,IAAI6C,QACTc,IAAEC,KAAK3E,KAAKy9E,OAAQ,SAAA30E,GAChB/I,EAAK+M,IAAIhE,MAKjBgE,IAAK,SAAShE,GACV,IAAItE,EAAYtD,IAAEtB,OAAO,GAAIkJ,GAG7B,OAFAtE,EAAUrE,GAAKC,IAAMC,MACrBL,KAAKunE,IAAI4iF,WAAW3lJ,EAAUrE,IAAMqE,EAC5BA,EAAUxH,MACd,IAAK,cACDgD,KAAKoqJ,gBAAgB5lJ,GACrB,MACJ,IAAK,SACDxE,KAAKqqJ,WAAW7lJ,GAChB,MACJ,IAAK,UACDxE,KAAKsqJ,YAAY9lJ,GACjB,MACJ,QACIxE,KAAKuqJ,QAAQ/lJ,KAKzB4lJ,gBAAiB,SAAS5lJ,GACtB,IAAIzE,EAAOC,KACXwE,EAAU48E,WAAWjhF,GAAKqE,EAAUrE,GACpCqE,EAAU48E,WAAWr3E,UAAW,EAChC/J,KAAKunE,IAAItnE,MAAM9B,IAAI,0BAA4BqG,EAAU48E,WAAW74E,UAAW,GAC/E,IAAIw+G,EAAQ/mH,KAAKuqJ,QAAQ/lJ,EAAU48E,YAEnC,GAAI2lC,EAAM9mH,MAAO,CAEb,IAAK,IAAIvG,KAAK8K,EAAUgmJ,MAAO,CAC3B,IAAIC,EAAc,IAAI/qJ,EAAKM,KAAKunE,IAAK,CACjCkW,OAAQj5E,EAAUgmJ,MAAM9wJ,GAAG+jF,SAE/Bz9E,KAAK0qJ,QAAQD,EAAY1pJ,IAAIqB,SAAS,2BAAtC,GAAAsD,OAAqElB,EAAUrE,GAA/E,aAAAuF,OAA6FhM,IAEjGqtH,EAAM9mH,MAAMW,IAAI,WAAY,SAAArC,GACxB,IAAIosJ,EAAe5qJ,EAAKwnE,IAAInuE,KAAKwxJ,UAAUpmJ,EAAWjG,GACtD,IAAK,IAAI7E,KAAK8K,EAAUgmJ,MAAO,CAC3B,IAAIK,EAAWrmJ,EAAUgmJ,MAAM9wJ,GAC3BoxJ,EAAc/qJ,EAAKmB,EAAL,IAAAwE,OAAWlB,EAAUrE,GAArB,aAAAuF,OAAmChM,IACjDqxJ,GAAY,EAChB,IAAK,IAAInwJ,KAAKiwJ,EAASptE,OACnB,IAAKotE,EAASptE,OAAO7iF,GAAGqW,OAAQ,CAC5B85I,GAAY,EACZ,MAGJrxJ,GAAKixJ,GAAgBI,EACrBD,EAAYj7I,OAAO,QAEnBi7I,EAAYzoJ,OAGpBtC,EAAKwnE,IAAI1kE,QAAQ,YAGrBkkH,EAAMlkH,QAAQ,YAKtBwnJ,WAAY,SAAS7lJ,GACjB,IAAIzE,EAAOC,KACPgrJ,EAAc,EAGd3e,EAAS,IAAI9wE,IAAO77D,KAAK,CACzBqF,MAAOP,EAAUO,OAAS,SAC1BzE,IAAKkE,EAAUlE,IACfC,IAAKiE,EAAUjE,IACf4O,MAAO,WACHvQ,EAAO4F,EAAUi5E,QACjB19E,EAAKwnE,IAAI1kE,QAAQ,aAKzB,SAASjE,EAAO6+E,GACZ,IAAIwtE,EAAc,GAAAvlJ,OAAMlB,EAAUrE,GAAhB,aAAAuF,OAA8BslJ,KAC5CP,EAAc,IAAI/qJ,EAAKK,EAAKwnE,IAAK,CAAEkW,OAAQA,IAC/C4uD,EAAOv/H,IAAI,CACP3M,GAAI8qJ,EACJlqJ,IAAK0pJ,EAAY1pJ,IACjB0O,MAAO,WACH48H,EAAOn8H,IAAI+6I,GACXlrJ,EAAKwnE,IAAI1kE,QAAQ,aAS7B,IADA,IAAIqoJ,EAAUxmJ,IAAE2K,KAAK7K,EAAU6/C,OACtB3qD,EAAI,EAAGA,EAAIiJ,KAAKpC,IAAIoC,KAAKpC,IAAI2qJ,EAAS1mJ,EAAUlE,KAAO,GAAIkE,EAAU8lB,SAAW,GAAI5wB,IACzFkF,EAAOlF,EAAIwxJ,EAAU1mJ,EAAU6/C,MAAM3qD,GAAK8K,EAAUi5E,QAIxDz9E,KAAKunE,IAAItnE,MAAM9B,IAAI,oBAAsBkuI,EAAOh8H,cAGhD,IAAI86I,EAAgB,IAAIC,EAAaprJ,KAAKunE,IAAK,CAC3CrhE,MAAO1B,EAAUO,OAASP,EAAU1G,KACpC+jD,KAAMr9C,EAAUq9C,KAChBklE,MAAOslB,IAEXrsI,KAAK0qJ,QAAQS,EAAcpqJ,IAAKyD,EAAUrE,KAI9CmqJ,YAAa,SAAS9lJ,GAClB,IAAIkL,EAAU,IAAIC,IAAQjQ,KAAK,CAC3BqF,MAAOP,EAAUO,OAASP,EAAU1G,KACpCgK,IAAK,qBACLo4I,aAAa,EACbmL,oBAAoB,EACpBrqG,WAAYx8C,EAAU+a,WAE1B7P,EAAQ7L,OAAO,IAAInE,EAAKM,KAAKunE,IAAK,CAAEkW,OAAQj5E,EAAUi5E,SAAU18E,KAChE2O,EAAQ7L,OACJ3C,IAAE,UACGkB,SAAS,wBACT2D,KAAKvB,EAAUq9C,OAExB7hD,KAAKunE,IAAIlmE,GAAG,SAAU,SAAA29E,GAClBtvE,EAAQxO,EAAR,IAAAwE,OAAcs5E,IAAYplF,OAAS,GAAK8V,EAAQ4Q,WAEpDtgB,KAAK0qJ,QAAQh7I,EAAQ3O,IAAKyD,EAAUrE,KAIxCoqJ,QAAS,SAAS/lJ,GACd,IAAIzE,EAAOC,KACPG,EAAKqE,EAAUrE,GACnBqE,EAAU7D,SACN6D,EAAU7D,UACT,WACGZ,EAAKwnE,IAAI1kE,QAAQ,SAAU1C,IAEnC,IAAI4mH,EAAQ/mH,KAAK8mH,WAAWloH,OAAO4F,GACnCxE,KAAKunE,IAAI+jF,WAAWnrJ,GAAM4mH,EAC1B,IAAIokC,EAAgB,IAAIC,EAAaprJ,KAAKunE,IAAK,CAC3CzpE,KAAM0G,EAAU1G,KAChBoI,MAAO1B,EAAU+mJ,WAAa,GAAK/mJ,EAAU0B,OAAS1B,EAAU1G,KAChES,MAAOiG,EAAUjG,MACjBitJ,WAAYhnJ,EAAUgnJ,WACtBtqE,kBAAmB18E,EAAU08E,kBAC7BuqE,oBAAqBjnJ,EAAUinJ,oBAC/B1qE,YAAav8E,EAAUu8E,YACvBl/B,KAAMr9C,EAAUq9C,KAChB6pG,SAAUlnJ,EAAUknJ,SACpBnjJ,SAAU/D,EAAU+D,SACpBG,MAAOlE,EAAUkE,MACjBC,MAAOnE,EAAUmE,MACjBk5E,SAAUr9E,EAAUq9E,SACpB5wE,OAAQzM,EAAUyM,OAClB4tE,MAAOr6E,EAAUq6E,MACjBkoC,MAAOA,IAIX,OAFA/mH,KAAKunE,IAAI0X,aAAa9+E,GAAMgrJ,EAC5BnrJ,KAAK0qJ,QAAQS,EAAcpqJ,IAAKyD,EAAUrE,IACnC4mH,GAIX2jC,QAAS,SAAS3pJ,EAAKZ,GACnBH,KAAKe,IAAI8C,OAAO9C,EAAIqB,SAAS,eAAepB,KAAK,KAAMb,OAIhDwrJ,EAAA,CACXjsJ,KAAMA,WC9LKC,QAASD,KAAKE,OAAO,CAChCC,WAAY,SAASC,GACjBE,KAAKC,MAAQ,IAAIN,IAASO,MAAM,CAC5BsgF,gBAAgB,EAChB14E,IAAK,aACLvB,KAAM,KACN+4I,gBAAgB,EAChBx5I,OAAQ,UACRy5C,iBAAiB,EACjB5+C,SAAU,eACXC,IAAId,GACPE,KAAKa,WAAW,UAChBb,KAAKkC,UAITqC,OAAQ,SAASqnJ,GACb,IAAI7rJ,EAAOC,KACXA,KAAK5G,KAAKyyJ,WAAWD,EAAW,SAACxjF,EAAM4W,GACnC,IAAI+nC,EAAQhnH,EAAKurJ,WAAWtsE,GACxB+nC,EAAMxiH,SACNwiH,EAAMxiH,OAAO6jE,GACb2+C,EAAMlkH,QAAQ,UACD0M,cACNS,KAAKC,MAAM,sBAAlB,mBAAAvK,OAA4Ds5E,QAMxEz5E,KAAM,SAASwH,GACX,IAAK,IAAIrT,KAAKsG,KAAKmqJ,WAAY,CAC3B,IAAIpjC,EAAQ/mH,KAAKsrJ,WAAW5xJ,GAChBsG,KAAKmqJ,WAAWzwJ,GAClBoyJ,YAAc/kC,EAAMxhH,MAAQwhH,EAAMvhH,QACxCuhH,EAAMh6G,EAAS,OAAS,cAMpC+jC,UAAW,SAASkuC,EAAUl8E,EAAS8S,GACnC,IAAIu1I,EAAgBnrJ,KAAKi/E,aAAaD,GACtC,GAAImsE,IACAA,EAAchuJ,MAAM2F,GAAW,iCAC/B9C,KAAK0P,QAAQ4Q,SACbtgB,KAAK6C,QAAQ,SAAUm8E,IAClBppE,GAAQ,CACT,IAAI2hH,EAASv3H,KAAKe,IACbypC,UACAp9B,OAAO,WACJ,OAA+D,GAAxD,CAAC,OAAQ,UAAU1L,QAAQR,IAAElB,MAAMkF,IAAI,eAEjDE,QACLmyH,EAAO/zG,QACH,CACIH,UAAWk0G,EAAOl0G,YAAc8nI,EAAcpqJ,IAAIoX,SAAS2lB,IAAMy5F,EAAOtsD,WAAWntC,IAAM,KAE7F,OAOhBqoB,OAAQ,SAASrmD,GAEb,GADAE,KAAK6C,QAAQ,SACT/C,GAAWA,EAAQqmD,OAAQ,CAC3B,IAAI4lG,EAAiB/rJ,KAAK5G,KAAK4yJ,cAAclsJ,EAAQqmD,QACrD,IAAK,IAAI64B,KAAYh/E,KAAKi/E,aAClB8sE,EAAe/sE,IACfh/E,KAAK8wC,UAAUkuC,EAAU+sE,EAAe/sE,IAAW,KAOnE98E,OAAQ,WACJ,IAAInC,EAAOC,KACXA,KAAK2S,IAAI,UACT3S,KAAK2S,IAAI,SAET3S,KAAKsrJ,WAAa,GAElBtrJ,KAAKmqJ,WAAa,GAElBnqJ,KAAKi/E,aAAe,GAEpBj/E,KAAK5G,KAAO,IAAIuyI,IAASsgB,QAAQjsJ,MACjCA,KAAKksJ,cACLlsJ,KAAK5G,KAAKwF,SACNoB,KAAKC,MAAM9B,IAAI,mBACf6B,KAAKmmD,OAAOnmD,KAAKC,MAAM4B,YAG3B,IAAIsqJ,EAAgBnsJ,KAAK5G,KAAKgzJ,WAgB9B,OAfApsJ,KAAKqB,GAAG,SAAU,SAAA29E,GACd,IAAIl2E,EAAQ/I,EAAKoqJ,WAAWnrE,GAC5B,IAAKl2E,GAASA,EAAMujJ,mBAAqBtsJ,EAAKE,MAAM9B,IAAI,kBAAmB,CACvE,IAAImuJ,EAAYvsJ,EAAK3G,KAAKgzJ,WACtBE,GAAaH,IACbA,EAAgBG,EAChBvsJ,EAAKE,MAAM9B,IAAI,WAAf4B,OAIZC,KAAKqB,GAAG,QAAS,WACbqD,IAAEC,KAAK5E,EAAKk/E,aAAc,SAAAksE,GACtBA,EAAcv0I,YAGf5W,MAIXksJ,YAAa,WACThrJ,IAAE,YAAY6M,SACd,IAAIjO,EAAUE,KAAKC,MAAM4B,WACzB7B,KAAK8C,QAAU,IAAIoM,IAAG9G,iBACtBpI,KAAKusJ,QAAU,IAAIC,EAAY9sJ,KAAKM,KAAM,CACtCy9E,OAAQ39E,EAAQ29E,SAEpBz9E,KAAK0P,QAAU,IAAIC,IAAQjQ,KAAK,CAC5B6G,KAAMzG,EAAQyG,KACdxB,MAAOjF,EAAQiF,MACfw8H,SAAUzhI,EAAQyhI,SAClB3xH,YAAa9P,EAAQy/C,iBAAmBz/C,EAAQ8P,WAChD9H,IAAKhI,EAAQgI,IACbwgC,QAASxoC,EAAQwoC,QACjB43G,YAAapgJ,EAAQogJ,YACrBl/F,UAAWlhD,EAAQkhD,UACnByrG,eAAgB3sJ,EAAQ2sJ,iBAE5BzsJ,KAAK0P,QAAQ7L,OAAO7D,KAAK8C,QAAQ/B,KACjCf,KAAK0P,QAAQ7L,OAAO7D,KAAKusJ,QAAQxrJ,KACjCf,KAAKe,IAAI6C,QACL9D,EAAQ29E,QACRz9E,KAAKe,IAAI8C,OAAO7D,KAAK0P,QAAQ3O,KAE7BjB,EAAQgD,SACR9C,KAAK8C,QAAQyB,OAAO,CAChBwD,YAAY,EACZjC,OAAQhG,EAAQgG,OAChBhD,QAAShD,EAAQgD,UAGZyM,cACNS,KAAKC,MAAM,0BAA2B,iDChKrDlV,EAAA8C,EAAA+M,EAAA,sBAAAgP,IAAA7e,EAAA8C,EAAA+M,EAAA,sBAAA8hJ,IAAA,IAAAn8I,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAA4I,EAAApe,EAAA,GAAAqe,EAAAre,EAAAgE,EAAAoa,GAAAE,EAAAte,EAAA,GAAAue,EAAAve,EAAAgE,EAAAsa,GAAAszI,EAAA5xJ,EAAA,GAWI6xJ,EAAiBjtJ,IAASD,KAAKE,OAAOwS,IAASC,eAAezS,OAAO,CACrE0S,cAPe,OAafzS,WAAY,SAASgC,GAEjB7B,KAAKuf,SAAW1d,EAAW0d,WAAY,EACvCvf,KAAKka,IAAI,eAAgBla,KAAKuf,UAC9Bvf,KAAK6Z,aAAiCvc,IAAvBuE,EAAWgY,QAAwBhY,EAAWgY,QAAU7Z,KAAK6Z,SAKhFA,QAAS,OAKT3X,OAAQ,SAASmR,GACb,IAAIkJ,EAAavc,KAAKwc,kBAGtB,OAFAxc,KAAKyc,gBAAgBF,GACrBvc,KAAK0c,gBAAgBH,EAAYlJ,GAC1BrT,MAMXwc,gBAAiB,WAEb,IAAID,EAAarb,IAAElB,KAAKwU,UAAUmI,GAAG3c,KAAKC,MAAMiV,SAAUlV,OAI1D,OAHIA,KAAKuf,UACLvf,KAAK6sJ,SAAStwI,GAAYW,YAAYld,KAAK8sJ,iBAAiB3qJ,QAEzDoa,GAOXG,gBAAiB,SAASH,EAAYlJ,GAClCA,OAAkB/V,IAAV+V,EAAsBrT,KAAK6Z,QAAUxG,EAC7C,IAAIQ,EAAO7T,KAEG,IAAVqT,GACAQ,EAAK2J,eAAejB,GACpB1I,EAAKhR,QAAQ,WAAYgR,IAEzB3S,IAAE2S,GAAMwJ,MAAM,KAAM,CAChB,SAAAC,GACIzJ,EAAK9S,IAAIwc,QAAQlK,EAAOiK,IAE5B,SAAAA,GACIzJ,EAAK2J,eAAejB,GACpBe,KAEJ,SAAAA,GACIzJ,EAAK9S,IAAI8O,OAAOwD,EAAOiK,IAE3B,SAAAA,GACIzJ,EAAKhR,QAAQ,WAAYgR,GACzByJ,QAOhBE,eAAgB,SAASjB,GACrB,OAAOvc,KAAKe,IACP6C,QACA5C,KAAK,QAAS0D,IAAE2rB,WAAWrwB,KAAKuS,WAAavS,KAAKuS,YAAcvS,KAAKuS,WACrE1O,OAAO0Y,EAAWtI,aAM3BwI,gBAAiB,SAASU,IACtBA,EAASA,GAAUnd,KAAKe,KAGjBsG,KAAK,WAAWvC,QAAQ,CAAEE,UAAW,YAKhD6nJ,SAAU,SAAS1vI,GAEf,OADAA,EAASA,GAAUnd,KAAKe,KACVsG,KAAK,eAIvBylJ,eAAgB,WACZ,IAAIC,EAAc7rJ,IAAElB,KAAKwU,UAAUqG,QAAQ7a,KAAKC,MAAMiV,SAAUlV,OAEhE,OADAA,KAAKyc,gBAAgBswI,GACdA,GAOXC,eAAgB,SAAS1sI,GAOrB,OANAA,OAAoBhjB,IAAXgjB,GAAwBtgB,KAAKuf,SAAWe,GAE7CtgB,KAAKsgB,SAELtgB,KAAKwgB,WAEFxgB,MAOXsgB,OAAQ,WACJ,IAAIzM,EAAO7T,KACX,OAAO6T,EAAKo5I,qBAAqB50I,OAAO,WACpCxE,EAAKq5I,aAObD,mBAAoB,WAChB,OAAKjtJ,KAAKC,MAAM0L,aAGTzK,IAAEwQ,OAFE1R,KAAKC,MAAM+M,SAM1BkgJ,QAAS,WACL,IAAIr5I,EAAO7T,KACP+sJ,EAAcl5I,EAAKi5I,iBACvBj5I,EAAKg5I,WAAW3vI,YAAY6vI,GAE5Bl5I,EAAK0L,UAAW,EAChB1L,EAAKg5I,WAAW/rI,UAAUjN,EAAKgG,QAAS,WACpChG,EAAKhR,QAAQ,WAAYgR,MAOjC2M,SAAU,WACNxgB,KAAKiQ,MAAL,GAAAvK,OAAc1F,KAAd,8BACA,IAAI6T,EAAO7T,KACX6T,EAAK0L,UAAW,EAChBvf,KAAK6sJ,WAAWpqI,QAAQ5O,EAAKgG,QAAS,WAClChG,EAAKhR,QAAQ,YAAagR,QAiB3B+F,EAAegzI,EAAehtJ,OACrCwS,IAAS+6I,MAAM/6I,IAASg7I,oBAAqBh7I,IAASi7I,mBAAoB,CACtEzkJ,QAAS,MACT2J,UAAW,YAGX1S,WAAY,SAASgC,GACjB+qJ,EAAe5yJ,UAAU6F,WAAW3F,KAAK8F,KAAM6B,GAC/CuQ,IAASg7I,oBAAoBvtJ,WAAW3F,KAAK8F,KAAM6B,GACnDuQ,IAASi7I,mBAAmBxtJ,WAAW3F,KAAK8F,KAAM6B,GAClD7B,KAAK6V,mBAITA,gBAAiB,WAab,OAXA7V,KAAKqB,GACD,aACA,SAASisJ,GACDA,EACAttJ,KAAKkB,EAAE,oBAAoBmB,OAE3BrC,KAAKkB,EAAE,oBAAoBiB,QAGnCnC,MAEGA,MAKXwc,gBAAiB,WACb,IAAID,EAAaqwI,EAAe5yJ,UAAUwiB,gBAAgBtiB,KAAK8F,MAK/D,OAJAuc,EAAWtI,SAAS,aAAaiJ,YAAYld,KAAKutJ,mBAClDhxI,EAAWtI,SAAS,cAAciJ,YAAYld,KAAKwtJ,mBACnDjxI,EAAWtI,SAAS,oBAAoBpQ,OAAO7D,KAAKytJ,yBACpDlxI,EAAWlV,KAAK,0BAA0B6V,YAAYld,KAAK8c,mBACpDP,GAIXiB,eAAgB,SAASjB,GAQrB,OAPAqwI,EAAe5yJ,UAAUwjB,eAAetjB,KAAK8F,KAAMuc,GAC/Cvc,KAAKwf,YACLxf,KAAKuiB,aAAa,GAElBviB,KAAK0f,WACL1f,KAAK0tJ,cAEF1tJ,KAAKe,KAIhBwsJ,gBAAiB,WACb,IAAI15I,EAAO7T,KACP2tJ,EAAYzsJ,IAAE,gCACd4e,EAAOjM,EAAK5T,MAAMiV,SAKtB,OAHAxQ,IAAEC,KAAKkP,EAAKW,UAAUgQ,SAAU,SAAAopI,GAC5BD,EAAU9pJ,OAAO3C,IAAE0sJ,EAAW9tI,EAAMjM,OAEjC85I,GAIXH,gBAAiB,WACb,OAAOtsJ,IAAElB,KAAKwU,UAAU2Q,SAASnlB,KAAKC,MAAMiV,SAAUlV,QAI1DytJ,sBAAuB,WAEnB,MAAO,IAIX3wI,gBAAiB,WACb,OAAO5b,IAAElB,KAAKwU,UAAUkG,SAAS1a,KAAKC,MAAMiV,SAAUlV,QAK1D6I,OAAQ,CAEJglJ,mBAAoB,iBACpBC,qBAAsB,mBACtBC,kBAAmB,gBAIvBC,eAAgB,SAAStxJ,GACrBA,EAAMo+B,kBACFp+B,EAAMyf,QACNnc,KAAKiuJ,aAAavxJ,GACbsD,KAAKwf,YACNxf,KAAKuiB,gBAGTviB,KAAKgtJ,kBAKbkB,iBAAkB,SAASxxJ,GAKvB,OACIA,GACe,YAAfA,EAAMM,MALU,KAMfN,EAAM4mF,SAJU,KAImB5mF,EAAM4mF,UAE1CtjF,KAAKgtJ,iBACLtwJ,EAAMo+B,mBACC,IAOfnuB,SAAU,WACN,IAAIuY,EAAcllB,KAAKC,MAAL,GAAAyF,OAAgB1F,KAAKC,OAAU,aACjD,sBAAAyF,OAAuBwf,EAAvB,SAOZtL,EAAa5f,UAAUwa,UA8CZ,CACHmI,GA9CavK,IAAS0R,aAAa,CACnC,6BAEA,+BAGA,yBACA,6CACA,SAEA,sCACA,gCAGA,8BACA,WAgCAU,SA7BW,GA8BXW,SA5BmB/S,IAAS0R,aAC5B,CAEI,6CAEA,mCACA,sBACA,gDACA,SACA,+BACA,UAEJ,WAiBApJ,SAdmBtI,IAAS0R,aAAa,CAEzC,iCAaAjJ,QAVkBzI,IAAS0R,aAAa,CAExC,iCAuBD,IAoGCqqI,EApGGzB,EAAsB9yI,EAAaha,OAAO,CAKjDwuJ,aAAc,UAEdC,kBAAmB,KAMnBxuJ,WAAY,SAASgC,GACS,cAAtB7B,KAAKouJ,eACLpuJ,KAAKuf,UAAW,GAEpBvf,KAAKouJ,aAAevsJ,EAAWusJ,cAAgBpuJ,KAAKouJ,aACpDpuJ,KAAKquJ,kBAAoBxsJ,EAAWwsJ,mBAAqBruJ,KAAKquJ,kBAE9Dz0I,EAAa5f,UAAU6F,WAAW3F,KAAK8F,KAAM6B,GAC7C7B,KAAKsuJ,QAAUtuJ,KAAKuuJ,uBAIxBzB,eAAgB,WACZ,GAA0B,cAAtB9sJ,KAAKouJ,aACL,OAAOltJ,MAEX,IAAI6rJ,EAAcnzI,EAAa5f,UAAU8yJ,eAAe5yJ,KAAK8F,MAC7D,OAAOA,KAAKwuJ,eAAexuJ,KAAKsuJ,QAASvB,IAI7CwB,oBAAqB,WACjB,IAAItuJ,EAAQD,KAAKC,MACbwuJ,EAAezuJ,KAAKymB,sBAAsBxmB,GAC1CH,EAAUE,KAAK0uJ,wBAAwBzuJ,GAQ3C,OANc,IAAIwuJ,EACd/pJ,IAAE9E,OAAOE,EAAS,CACdG,MAAOA,MAQnBwmB,sBAAuB,WAEnB,OAAOzmB,KAAKquJ,mBAIhBK,wBAAyB,WACrB,MAAO,CAEHN,aAAcpuJ,KAAKouJ,aACnBv0I,QAAS7Z,KAAK6Z,UAKtB20I,eAAgB,SAASF,EAASlwI,GAI9B,OAHAA,EAAWA,GAAYpe,KAAKkB,EAAE,cAC9BlB,KAAKsuJ,QAAUA,EAAQpsJ,OAAO,GAC9BosJ,EAAQptJ,EAAE,eAAemB,OAClB+b,EAASva,OAAOyqJ,EAAQvtJ,MAInCuf,OAAQ,WACJ,IAAIzM,EAAO7T,KACX,OAAO6T,EAAKo5I,qBAAqB50I,OAAO,WACV,YAAtBxE,EAAKu6I,aACLv6I,EAAKq5I,UACwB,cAAtBr5I,EAAKu6I,cACZv6I,EAAK86I,wBASjBA,mBAAoB,WAChB,IAAI96I,EAAO7T,KAEX6T,EAAK5R,SAAS4R,EAAKy6I,QAAS,QAAS,WACjCz6I,EAAKhR,QAAQ,sBAAuBgR,EAAMA,EAAKy6I,WAEnDz6I,EAAKhR,QAAQ,qBAAsBgR,EAAMA,EAAKy6I,YAMtD5B,EAAoB1yJ,UAAUwa,WACtB25I,EAAkB/7I,IAAS0R,aAC3B,CACI,wBAEA,UAEJ,cAGGpf,IAAE9E,OAAO,GAAIga,EAAa5f,UAAUwa,UAAW,CAClDqG,QAASszI,KAKFvjJ,EAAA,GACXgiJ,eAAgBA,EAChBhzI,aAAcA,EACd8yI,oBAAqBA,oCCtfzB,IAAAn8I,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAAnC,EAAArT,EAAA,GAAAsT,EAAAtT,EAAAgE,EAAAqP,GAAAwD,EAAA7W,EAAA,GAAA8W,EAAA9W,EAAAgE,EAAA6S,GAAAg9I,EAAA7zJ,EAAA,IASI2jJ,EAAa/+I,IAASO,MAAMN,OAAO,CACnCiR,SAAU,CACN9L,MAAO,GACPiuF,WAAY,GACZC,SAAU,KACV47D,aAAc,KACdC,gBAAgB,EAChB3uJ,GAAI,KACJkkC,KAAM,KACNnnC,OAAQ,KACRykJ,SAAS,EACTx+I,SAAS,EACTiwF,eAAgB,MAOpBqrD,EAAiB9+I,IAASD,KAAKE,OAAO,CACtCC,WAAY,WAERG,KAAKC,MAAM4B,WAAWuxF,eAAiB,CAAEpuF,UAAW,UACpDhF,KAAKC,MAAMnB,KAAK,SAAUkB,KAAKkC,OAAQlC,OAG3CkC,OAAQ,WAEJlC,KAAKe,IAAI+D,QAAQ,QAEjB,IAAIiqJ,EAAW/uJ,KAAKyS,SAASzS,KAAKC,MAAMiV,UAKxC,OAHA65I,EAASjqJ,QAAQ9E,KAAKC,MAAM9B,IAAI,mBAChC6B,KAAKe,IAAImc,YAAY6xI,GACrB/uJ,KAAKa,WAAWkuJ,GACT/uJ,MAGX6I,OAAQ,CACJkV,MAAO,SAGXA,MAAO,SAASrhB,GAEZ,OAAIgI,IAAE2rB,WAAWrwB,KAAKC,MAAM9B,IAAI,eAC5B6B,KAAKC,MAAM9B,IAAI,WAAf6B,CAA2BtD,IACpB,IAOf+V,SAAU,SAAS3S,GACf,IAAIkvJ,EAAM,UAAAtpJ,OAAa5F,EAAQiF,MAArB,wBAqCV,OAnCIjF,EAAQgvJ,iBACRE,GAAU,gBAGdA,GAAM,IAAAtpJ,OAAQ5F,EAAQkzF,YAEjBlzF,EAAQ6hJ,UACTqN,GAAU,aAIdA,GAAU,IAENlvJ,EAAQK,KACR6uJ,GAAM,QAAAtpJ,OAAY5F,EAAQK,GAApB,MAGV6uJ,GAAM,UAAAtpJ,OAAc5F,EAAQukC,KAAtB,KAEFvkC,EAAQ5C,SACR8xJ,GAAM,YAAAtpJ,OAAgB5F,EAAQ5C,OAAxB,MAGL4C,EAAQqD,UACT6rJ,GAAU,2BAKVA,EADAlvJ,EAAQ6hJ,QACF,MAAAj8I,OAASspJ,EAAT,MAEA,SAAAtpJ,OAAYspJ,EAAZ,MAIH9tJ,IAAE8tJ,MAKbC,EAAuBtvJ,IAASkN,WAAWjN,OAAO,CAClDK,MAAOy+I,IAOPwQ,EAAqBvvJ,IAASD,KAAKE,OAAO,CAC1CgJ,QAAS,MAET/I,WAAY,WACRG,KAAKkC,UAGTA,OAAQ,WAEJ,IAAInC,EAAOC,KAwBX,OAvBAA,KAAK+Y,WAAWpU,KAAK,SAAAm7B,GAEjB,IAAIw2F,EAAMp1H,IAAE,QACPF,KAAK,OAAQ,sBACbA,KAAK,QAAS8+B,EAAOj+B,WAAWkD,OAChC3C,SAAS,2BACTA,SAAS09B,EAAOj+B,WAAWmxF,YAC3BhwB,SAASjjE,EAAKgB,KACdgd,MAAM+hB,EAAOj+B,WAAWoxF,UAGzBnzD,EAAOj+B,WAAWuxF,gBAClBkjC,EAAIxxH,QAAQg7B,EAAOj+B,WAAWuxF,gBAIlC,IAAIy7D,EAAe/uH,EAAO3hC,IAAI,WAC1B0wJ,GACAnsF,YAAe4zD,EAAKu4B,KAKrB7uJ,QAwBA4K,EAAA,GACX8zI,WAAYA,EACZD,eAAgBA,EAChBwQ,qBAAsBA,EACtBC,mBAAoBA,EACpBn8D,yBAnB2B,SAAC9vD,EAAQksH,GAE/BA,IAAeA,EAAgB,IAGpC,IAAI7mH,EAAU,IAAI2mH,EACdvqJ,IAAE4I,IAAI21B,EAAQ,SAAA8nE,GAAa,OAAI,IAAI2zC,EAAWh6I,IAAE9E,OAAOmrG,EAAeokD,OAI1E,OAAO,IAAID,EAAmB,CAAEn2I,WAAYuvB,uCCtKhD,IAAA/3B,EAAAxV,EAAA,GAAAyV,EAAAzV,EAAAgE,EAAAwR,GAAA6+I,EAAAr0J,EAAA,GAAA6W,EAAA7W,EAAA,GAAA8W,EAAA9W,EAAAgE,EAAA6S,GAMInH,EAAS9K,IAASD,KAAKE,OAAO,CAC9BC,WAAY,SAASC,GACjBE,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfC,GAAIC,IAAMC,MACV0E,MAAO,GACPwB,KAAM,GACNuB,IAAK,oBACLvC,MAAM,EACNlC,UAAW,aACXgsJ,SAAU,eACV9mJ,UAAU,EACV+mJ,YAAa,EACbnsJ,SAAS,IACVvC,IAAId,GACXE,KAAKa,WACDK,IAAE,aACGF,KAAK,OAAQ,UACb6C,OAAQ7D,KAAK0oF,MAAQxnF,IAAE,SACvB2C,OAAQ7D,KAAKgnC,OAAS9lC,IAAE,YACxB2C,OAAQ7D,KAAKuvJ,UAAYruJ,IAAE,UAAU2C,OAAQ7D,KAAKwvJ,cAAgBtuJ,IAAE,aAE7ElB,KAAKiC,SAASjC,KAAKC,MAAO,SAAUD,KAAKkC,OAAQlC,MACjDA,KAAKkC,UAGTA,OAAQ,WAAW,IAAAyH,EAAA3J,KACXF,EAAUE,KAAKC,MAAM4B,WACzB7B,KAAKe,IACAuB,cACAF,SAAS,qBACTA,SAAStC,EAAQyI,UAAY,YAC7BvH,KAAK,KAAMlB,EAAQK,IACnBa,KAAK,WAAYlB,EAAQyI,UACzBrD,IAAI,UAAWpF,EAAQqD,QAAU,eAAiB,QAClDwP,IAAI,SACJtR,GAAG,QAAS,WACTH,IAAE,YAAYmB,OACdvC,EAAQsE,UAAYuF,EAAKpB,UAAYzI,EAAQsE,YAEhDU,QAAQ,CAAEC,MAAOjF,EAAQgF,SAAW,GAAIE,UAAW,WACxDhF,KAAKuvJ,UAAUntJ,SAAS,YAAY8C,IAAI,WAAmC,IAAxBpF,EAAQwvJ,WAAoB,QAAU,QACzFtvJ,KAAKwvJ,cAAcptJ,SAAS,gBAAgB8C,IAAI,CAAEo6B,MAAK,GAAA55B,OAAK5F,EAAQwvJ,WAAb,OACvDtvJ,KAAK0oF,MAAMpmF,cAAcF,SAAS,WAClCpC,KAAKgnC,OAAO1kC,cAAcF,SAAS,SAC/BtC,EAAQyF,MACRvF,KAAKe,IAAIqB,SAAStC,EAAQuvJ,UAAUhrJ,KAAK,YAAY,GACrDrE,KAAK0oF,MAAMtmF,SAAS,2BACpBpC,KAAKgnC,OAAOjhC,KAAKjG,EAAQuD,aAEzBrD,KAAKe,IAAIqB,SAAStC,EAAQgI,KAC1B9H,KAAK0oF,MAAMtmF,SAAStC,EAAQyG,MACxBzG,EAAQiF,QACR/E,KAAKgnC,OAAOjhC,KAAKjG,EAAQiF,OACrBjF,EAAQyG,MACRvG,KAAK0oF,MAAMtmF,SAAS,WAOpCD,KAAM,WACFnC,KAAKC,MAAMW,IAAI,WAAW,IAI9ByB,KAAM,WACFrC,KAAKC,MAAMW,IAAI,WAAW,IAI9BkP,QAAS,WACL9P,KAAKC,MAAMW,IAAI,YAAY,IAI/BuP,OAAQ,WACJnQ,KAAKC,MAAMW,IAAI,YAAY,IAI/B2E,KAAM,WACFvF,KAAKC,MAAMW,IAAI,QAAQ,IAI3B4E,OAAQ,WACJxF,KAAKC,MAAMW,IAAI,QAAQ,IAI3B6uJ,QAAS,SAASlpJ,GACdvG,KAAKC,MAAMW,IAAI,OAAQ2F,MAK3BoE,EAAaF,EAAO7K,OAAO,CAC3BC,WAAY,SAASC,GACjBE,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfC,GAAIC,IAAMC,MACV8C,SAAS,EACT4B,MAAO,GACPwB,KAAM,GACNuB,IAAK,KACNlH,IAAId,GACXE,KAAKa,WAAWK,IAAE,QAAQ2C,OAAQ7D,KAAK0oF,MAAQxnF,IAAE,aACjDlB,KAAKiC,SAASjC,KAAKC,MAAO,SAAUD,KAAKkC,OAAQlC,MACjDA,KAAKkC,UAGTA,OAAQ,WACJ,IAAIpC,EAAUE,KAAKC,MAAM4B,WACzB7B,KAAKe,IACAuB,cACAF,SAAStC,EAAQgI,KACjB9G,KAAK,CACFb,GAAIL,EAAQK,GACZkkC,KAAMvkC,EAAQukC,MAAQ,qBACtBt/B,MAAOjF,EAAQiF,MACf7H,OAAQ4C,EAAQ5C,QAAU,OAC1BqL,SAAUzI,EAAQyI,WAErBrD,IAAI,UAAWpF,EAAQqD,QAAU,eAAiB,QAClD2B,QAAQ,CAAEE,UAAW,WACrB2N,IAAI,SACJtR,GAAG,QAAS,WACTvB,EAAQsE,UAAYtE,EAAQyI,UAAYzI,EAAQsE,YAExDpE,KAAK0oF,MAAMpmF,cAAcF,SAAStC,EAAQyG,SAK9CpC,EAAcxE,IAASD,KAAKE,OAAO,CACnCC,WAAY,SAASC,GACjBE,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfC,GAAIC,IAAMC,MACV0E,MAAO,sBACP2qJ,MAAO,CAAC,cAAe,oBAAqB,qBAC5CnxJ,MAAO,EACP4E,SAAS,EACTxC,SAAU,eACXC,IAAId,GACXE,KAAKa,WACDK,IAAE,UACGkB,SAAS,QACTyB,OAAQ7D,KAAK0oF,MAAQxnF,IAAE,YACvB2C,OAAQ7D,KAAKgnC,OAAS9lC,IAAE,aAEjClB,KAAKiC,SAASjC,KAAKC,MAAO,SAAUD,KAAKkC,OAAQlC,MACjDA,KAAKkC,UAGTA,OAAQ,SAASpC,GAAS,IAAA8N,EAAA5N,KACtBF,EAAUE,KAAKC,MAAM4B,WACrB7B,KAAKe,IACAqB,SAAS,mBACT8C,IAAI,UAAWpF,EAAQqD,QAAU,eAAiB,QAClDwP,IAAI,SACJtR,GAAG,QAAS,WACTuM,EAAK3N,MAAMW,IAAI,QAAsC,IAA5BgN,EAAK3N,MAAM9B,IAAI,SAAkB,EAAM,GAChE2B,EAAQsE,SAAWtE,EAAQsE,YAEnCpE,KAAKgnC,OAAOjhC,KAAKjG,EAAQiF,OACzB/E,KAAK0oF,MACApmF,cACAF,SAAS,gBACTA,SAAStC,EAAQ4vJ,MAAM5vJ,EAAQvB,SASxCA,MAAO,SAASgE,EAASqlG,GAQrB,YAPgBtqG,IAAZiF,IACIqlG,GAAqB,IAAZrlG,IACTA,EAAWA,IAAYqlG,EAAS,EAAM,GAE1C5nG,KAAKC,MAAMW,IAAI,QAAS2B,GACxBvC,KAAKC,MAAM9B,IAAI,WAAf6B,CAA2BA,KAAKC,MAAM9B,IAAI,WAEvC6B,KAAKC,MAAM9B,IAAI,YAK1BuM,EAAa/K,IAASD,KAAKE,OAAO,CAClCmE,MAAO,KACPlE,WAAY,SAASC,GACjBE,KAAKC,MACAH,GAAWA,EAAQG,OACpB,IAAIN,IAASO,MAAM,CACfC,GAAI,GACJ4E,MAAO,GACP4qJ,KAAM,QACNppJ,KAAM,KACNnC,QAAS,KACT0D,IAAK,gCACLhD,QAAS,GACT5H,OAAQ,GACRmnC,KAAM,GACNurH,SAAU,KACVzsJ,SAAS,EACTwlB,IAAK,KACN/nB,IAAId,GACXE,KAAK+Y,WAAa,IAAIpZ,IAASkN,WAC/B7M,KAAKa,WACDK,IAAE,UAAU2C,OACP7D,KAAK6vJ,MAAQ3uJ,IAAE,aACX2C,OAAQ7D,KAAK0oF,MAAQxnF,IAAE,SACvB2C,OAAQ7D,KAAKgnC,OAAS9lC,IAAE,cAGrClB,KAAKiC,SAASjC,KAAKC,MAAO,SAAUD,KAAKkC,OAAQlC,MACjDA,KAAKiC,SAASjC,KAAK+Y,WAAY,0BAA2B/Y,KAAKkC,OAAQlC,MACvEA,KAAKkC,UAGTA,OAAQ,WAAW,IAAA4kC,EAAA9mC,KACXF,EAAUE,KAAKC,MAAM4B,WACzB7B,KAAKe,IACAuB,cACAF,SAAS,YACTpB,KAAK,KAAMlB,EAAQK,IACnB+E,IAAI,CACDyB,QAAS7G,EAAQqD,SAAWnD,KAAK+Y,WAAWoiF,MAAM,CAAEh4F,SAAS,IAAQvJ,OAAS,EAAI,QAAU,SAEpGoG,KAAK6vJ,MACAztJ,SAAStC,EAAQgI,KACjB9G,KAAK,cAAe,YACpB8D,QAAQ,CAAEC,MAAOjF,EAAQgF,SAAW,GAAIE,UAAW,WACnD2N,IAAI,SACJtR,GAAG,QAAS,SAAA/F,GACT4F,IAAE,YAAYmB,OACd/G,EAAEmG,iBACF3B,EAAQsE,SAAWtE,EAAQsE,YAEnCpE,KAAK0oF,MACApmF,cACAF,SAAS,WACTA,SAAStC,EAAQyG,MACtBzG,EAAQiF,OACJ/E,KAAKgnC,OACA1kC,cACAF,SAAS,cACT2D,KAAKjG,EAAQiF,OACtB/E,KAAK+D,OAAS/D,KAAK+D,MAAMgK,SACrB/N,KAAK+Y,WAAWnf,OAAS,IACzBoG,KAAK+D,MAAQ7C,IAAE,SACVkB,SAAS,0CACTA,SAFQ,QAAAsD,OAES1F,KAAKC,MAAM9B,IAAI,UAChC6C,KAAK,OAAQ,QAClBhB,KAAKe,IAAI8C,OAAO7D,KAAK+D,QAEzB/D,KAAK+Y,WAAWpU,KAAK,SAAAmrJ,GACjB,IAAIC,EAAaD,EAASjuJ,WAC1B,GAAIkuJ,EAAW5sJ,QAAS,CACpB,IAAI+iC,EAAQhlC,IAAE,QACTkB,SAAS,iBACTpB,KAAK,CACFqjC,KAAM0rH,EAAW1rH,KACjBnnC,OAAQ6yJ,EAAW7yJ,SAEtB2G,OACG3C,IAAE,QACGkB,SAAS,WACTA,SAAS2tJ,EAAWxpJ,MACpBrB,IAAI,UAAW6qJ,EAAWxpJ,KAAO,eAAiB,SAE1D1C,OAAOksJ,EAAWhrJ,OAClB1D,GAAG,QAAS,SAAA/F,GACLy0J,EAAW3rJ,UACX9I,EAAEmG,iBACFsuJ,EAAW3rJ,aAGvB0iC,EAAK/iC,MAAMF,OAAO3C,IAAE,SAAS2C,OAAOqiC,IACpC6pH,EAAWjqH,SAAWgB,EAAK/iC,MAAMF,OAAO3C,IAAE,SAASkB,SAAS,gBAMxEu+C,QAAS,SAAS7gD,GACdE,KAAK+Y,WAAWjM,IACZ1M,IAAM0O,MAAMhP,EAAS,CACjBiF,MAAO,GACP7H,OAAQ,GACRmnC,KAAM,GACNjgC,QAAS,KACT0hC,SAAS,EACT3iC,SAAS,EACToD,KAAM,KACNuB,IAAK,8BAMN8C,EAAA,GACXH,OAAQA,EACRE,WAAYA,EACZxG,YAAaA,EACbuG,WAAYA,oCC/ThB,IAAA+Z,EAAA1pB,EAAA,GAAA2pB,EAAA3pB,EAAAgE,EAAA0lB,GAAAotB,EAAA92C,EAAA,GAAA+2C,EAAA/2C,EAAAgE,EAAA8yC,GAAAjgC,EAAA7W,EAAA,GAAA8W,EAAA9W,EAAAgE,EAAA6S,GAAAo+I,EAAAj1J,EAAA,IAAAk1J,EAAAl1J,EAAA,IAAAiX,EAAAjX,EAAA,GAAAm1J,EAAAn1J,EAAA,IAAAo1J,EAAAp1J,EAAA,IAAAq1J,EAAAr1J,EAAA,GAAAs1J,EAAAt1J,EAAAgE,EAAAqxJ,GAAAE,EAAAv1J,EAAA,IAAAs3C,EAAAt3C,EAAA,GAeImG,GAfJnG,EAAA,KAeQ0W,KAaJ8+I,EAA+B5wJ,IAASD,KAAKE,OAAOwS,IAASC,eAAezS,OAAO,CACnF0S,cAfe,cAkBf1J,QAAS,KACT2J,UAAW,qBAEX1S,WAAY,SAASgC,GACjB7B,KAAK8G,QAAUjF,EAAWiF,SAAW,GACrC9G,KAAK2F,SAAW9D,EAAW8D,WAAY,GAG3CzD,OAAQ,WACJlC,KAAKutB,iBAAmB7oB,IAAE5F,KAAKkB,KAAKwtB,WAAYxtB,MAChDA,KAAKytB,eAAiB/oB,IAAE5F,KAAKkB,KAAK0tB,SAAU1tB,MAC5C,IAAI2tB,EAAS3tB,KAAKe,IACbC,KAAK,kBAAmBhB,KAAK8G,QAAQ3G,IACrCa,KAAK,aAAa,GAClB+E,KAAK/F,KAAKyS,SAAS,CAAE3L,QAAS9G,KAAK8G,WACnC3I,IAAI,GAMT,OALAwvB,EAAOC,iBAAiB,YAAa5tB,KAAKutB,kBAAkB,GAC5DI,EAAOC,iBAAiB,UAAW5tB,KAAKytB,gBAAgB,GACpDztB,KAAK2F,UACL3F,KAAKe,IAAIqB,SAAS,YAEfpC,MAIXyS,SAAU/N,IAAE+N,SACR,CACI,0BACA1D,IAAG,mBACH,+BACA,sBACA,OACA,6CACAA,IAAG,qCACH,KACAA,IAAG,WACH,aACFvB,KAAK,KAIX5D,OAAQ,SAASgV,GACb5e,KAAKe,IAAI87B,YAAY,WAAYje,GACjC5e,KAAK6C,QAAQ,SAAU,CACnBoG,OAAQjJ,KACR2F,SAAU3F,KAAKe,IAAIk6B,SAAS,eAKpCu1H,QAAS,WACL,IAAI38I,EAAO7T,KACPywJ,EAAczwJ,KAAKe,IAAIkd,SAASqhB,QACpCt/B,KAAKe,IAAIyiB,QAAQ,CAAEktI,eAAgBD,GAAe,OAAQ,WACtD58I,EAAKhR,QAAQ,UAAW,CACpBoG,OAAQ4K,IAEZA,EAAKnB,aAKbA,QAAS,WACL1S,KAAK2S,MACL3S,KAAKe,IAAIgN,UAGblF,OAAQ,CACJkV,MAAO,SACP4yI,cAAe,aACfC,iBAAkB,gBAElB/iI,SAAU,gBACVC,KAAM,iBAIV+iI,OAAQ,SAAS/0I,GACbA,EAAGgf,kBACH96B,KAAK4J,OAAOkS,IAIhBg1I,WAAY,SAASh1I,GACjBA,EAAGgf,kBACHhf,EAAGra,iBAEH,IAAIyH,EAAW+zB,OAAM,GAAAv3B,OAAIqJ,IAAG,oCAAP,KAA+C/O,KAAK8G,QAAQhJ,MAE7EoL,IACAlJ,KAAK8G,QAAQhJ,KAAOoL,EACpBlJ,KAAKkC,WAMb6uJ,cAAe,SAASj1I,GACpBA,EAAGgf,kBACH96B,KAAKwwJ,WAIThjI,WAAY,SAAS1R,GACbA,EAAGmS,gBACHnS,EAAKA,EAAGmS,eAEZnS,EAAGkE,aAAakO,cAAgB,OAChCpS,EAAGkE,aAAaC,QAAQ,aAAcC,KAAKC,UAAUngB,KAAK8G,UAE1D9G,KAAKe,IAAIqB,SAAS,YAClBpC,KAAKe,IAAIkd,SAASpb,QAAQ,+BAAgC,CAAC7C,QAI/D0tB,SAAU,SAAS5R,GACf9b,KAAKe,IAAIuB,YAAY,YACrBtC,KAAKe,IAAIkd,SAASpb,QAAQ,6BAA8B,CAAC7C,QAI7DmuB,cAAe,SAASrS,GACpB9b,KAAKe,IAAIkd,SAASpb,QAAQiZ,IAI9BnP,SAAU,WACN,MAAO,oCAOXmG,EAAwBnT,IAASD,KAAKE,OAAOwS,IAASC,eACrDzS,OAAO4vB,IAAYC,wBACnB7vB,OAAO,CACJ0S,cA3JW,cA8JXU,iBAAkBu9I,EAElBt9I,gBAAiBC,IAAKC,yBACtBZ,UAAW,gEAGXy+I,YAAa,EAEbC,kBAAmB,CAGf77I,WAAY,WACR,MAAM,IAAI87I,UAAU,+BAGxB1gI,SAAU,aAEVD,SAAU,aAEVE,eAAgB,GAEhB0gI,aAAc,6BAGlBr6H,eAAgB,CACZC,kBAAmB,iBAIvBl3B,WAAY,SAASgC,GACjB7B,KAAK0vB,OAAO,mCAAoC7tB,GAChD,IAAI6R,EAAU1T,KACd0E,IAAEC,KAAK3E,KAAKixJ,kBAAmB,SAAC1yJ,EAAOM,GACnCN,EAAQsD,EAAWhD,IAAQN,EAC3BmV,EAAQ7U,GAAON,IAInBmV,EAAQ09I,gBAAkBvvJ,EAAWgT,UAAY,GAEjD7U,KAAK8wB,qBAAqBjvB,GAC1B7B,KAAKqxJ,iBACLrxJ,KAAKsxJ,iBACLtxJ,KAAKyc,mBAIT40I,eAAgB,WAEZrxJ,KAAKsxB,YAAc,GAEnBtxB,KAAK4wB,UAAY,KAEjB5wB,KAAK6wB,UAAW,GAKpBygI,eAAgB,WAGZtxJ,KAAKuxJ,gBAAkB,GAGvBvxJ,KAAKuT,gBAAkB,GAEvBvT,KAAK4T,aAAe,GAGpB5T,KAAKuT,gBAAkBvT,KAAKoxJ,gBAAgB5xJ,MAAM,GAClDQ,KAAKwxJ,oBACLxxJ,KAAKyxJ,oBACLzxJ,KAAKoT,wBACLpT,KAAK0xJ,iBAITF,kBAAmB,WAMf,OALAxxJ,KAAKuT,gBAAgB+L,QAAQ,SAAAxY,GACpBA,EAAQ7M,eAAe,QACxB6M,EAAQ3G,GAAKuE,IAAEitB,cAGhB3xB,KAAKuT,iBAIhBk+I,kBAAmB,WACf,IAAI/9I,EAAU1T,KAad,OAZA0T,EAAQ69I,gBAAkB,GAE1BvxJ,KAAKuT,gBAAkBvT,KAAKuT,gBAAgBnG,OAAO,SAAAtG,GAC/C,IAAI6qJ,EAAUj+I,EAAQk+I,kBAAkB9qJ,GAOxC,OANI6qJ,GACAj+I,EAAQ69I,gBAAgBz3J,KAAK,CACzBgN,QAASA,EACTjB,KAAM8rJ,KAGNA,IAEL3xJ,KAAKuT,iBAIhBq+I,kBAAmB,SAAS9qJ,GACxB,MAAqC,uBAAjCA,EAAQgK,qBACD/B,IAAG,wCAEGjI,EAAQ8f,QAAUC,IAAOC,IAAMpiB,IAAE+a,SAASoH,IAAOiF,iBAAkBhlB,EAAQ8f,OAIxF9f,EAAQwqG,SAAWxqG,EAAQ+qJ,OACpB9iJ,IAAG,8BAEP,KALIA,IAAG,iDASlBqE,sBAAuB,WACnB,IACIs/H,EAAU,EACVof,EAAgB,GACpB9xJ,KAAKuT,gBAAgB+L,QAAQ,SAAAxY,GAEzB,IADA,IAAIirJ,EAAWjrJ,EAAQhJ,KAChBg0J,EAAc73J,eAAe83J,IAGhC,GAFAA,EAAQ,GAAArsJ,OAAMoB,EAAQhJ,KAAd,MAAA4H,OAAuBgtI,EAAvB,MACRA,GAAW,IAPN,IASD,MAAM,IAAIt1I,MAAM,+CAGxB0J,EAAQhJ,KAAOi0J,EACfD,EAAchrJ,EAAQhJ,OAAQ,KAKtC4zJ,cAAe,SAAS7qJ,KASxB3E,OAAQ,SAASmR,EAAOC,GAEpB,OAAItT,KAAKuT,gBAAgB3Z,OAASoG,KAAKgxJ,YAC5BhxJ,KAAKwT,eAAeH,EAAOC,IAGtCtT,KAAKe,IAAI6C,QAAQmC,KAAK/F,KAAKwU,UAAUugB,QACrC/0B,KAAKg1B,cAAc3hB,GACnBrT,KAAKi1B,cAAc5hB,GACnBrT,KAAKk1B,cAAc7hB,GACnBrT,KAAKm1B,uBACLn1B,KAAKkB,EAAE,oBAAoB02B,QAC3B53B,KAAK6C,QAAQ,WAAY7C,MAClBA,OAIXwT,eAAgB,SAASH,EAAOC,GAY5B,OAVAtT,KAAKe,IAAI6C,QAAQmC,KACb/F,KAAKwU,UAAUG,eAAe,CAC1Bq9I,SAAUhyJ,KAAKuxJ,gBACf18I,SAAU7U,KAAKuT,mBAGM,mBAAlBvT,KAAKuwB,UACZvwB,KAAKkB,EAAE,sBAAsBiB,OAEjCnC,KAAK6C,QAAQ,WAAY7C,MAClBA,MAIXg1B,cAAe,SAAS3hB,EAAOC,GAC3B,IAAI8hB,EAAUp1B,KAAKkB,EAAE,WAChB0C,QACAmC,KAAK/F,KAAKwU,UAAUhN,UACpBH,KAAK,iBACL2Z,QAAQ9f,EAAElB,KAAKwU,UAAUE,gBAK9B,OAHI1U,KAAKuxJ,gBAAgB33J,QACrBoG,KAAKiyJ,wBAEF78H,GAIXH,cAAe,SAAS5hB,EAAOC,GAC3B,IAAIgiB,EAAUt1B,KAAKkB,EAAE,WAChB0C,QACAmC,KAAK/F,KAAKwU,UAAUC,UAEzB,OADAzU,KAAKyT,YAAYJ,GACViiB,GAIXH,qBAAsB,WAClBn1B,KAAKkB,EAAE,mBAAmBg2B,eAAe,sBAAuBl3B,KAAKmxJ,eAIzEc,sBAAuB,WACnBjyJ,KAAK80B,WACD90B,KAAKwU,UAAU+8I,gBAAgB,CAC3BS,SAAUhyJ,KAAKuxJ,kBAEnB,kBAIRW,sBAAuB,SAASpiJ,IAC5BA,IAAWpL,IAAE4S,YAAYxH,IAAWA,KAEhC9P,KAAKkB,EAAE,oBAAoBmD,KAAK,YAAY,GAC5CrE,KAAKkB,EAAE,sBAAsB27B,YAAY,YAAY,KAS7DztB,MAAO,WACH,OAAOpP,KAAKkB,EAAE,yBAIlBixJ,qBAAsB,WACdztJ,IAAE2K,KAAKrP,KAAKsxB,aACZtxB,KAAKkB,EAAE,mDAAmDiB,OAE1DnC,KAAKkB,EAAE,mDAAmDmB,QAKlEoR,YAAa,SAASJ,EAAOC,GAEzB,IAAII,EAAU1T,KAEV2T,EAAOlC,IAAO,UACdrC,EAAQsE,EAAQtE,QAEpB1K,IAAEC,KAAK3E,KAAK4T,aAAc,SAAAC,GACtBA,EAAKnB,UACLgB,EAAQI,kBAAkBD,KAQ9BH,EAAQH,gBAAgB+L,QAAQ,SAAAxY,GAC5B,IAAIsN,EAAcV,EAAQS,mBAAmBrN,GAC7C6M,EAAK9P,OAAOuQ,EAAYrT,OAG5B2S,EAAQy+I,uBACR/iJ,EAAMxL,QAAQC,OAAO8P,EAAKM,YAC1BvP,IAAEwP,OAAOR,EAAQE,aAAc,UAE3BxE,EAAMstB,SAAWttB,EAAMlK,IAAI,cAC3BkK,EAAMlK,IAAI,eAAgB,mBAE1BkK,EAAMlK,IAAI,eAAgB,QAKlCiP,mBAAoB,SAASrN,GACzB,IAAIsN,EAAc,IAAIpU,KAAKgT,iBAAiB,CAGxClM,QAASA,EACTnB,SAAUjB,IAAEkH,IAAI5L,KAAKsxB,YAAaxqB,EAAQ3G,MAI9C,OAFAH,KAAK4T,aAAa9Z,KAAKsa,GACvBpU,KAAKoyJ,qBAAqBh+I,GACnBA,GAIXg+I,qBAAsB,SAASv+I,GAC3B,IAAIH,EAAU1T,KACd0T,EAAQzR,SAAS4R,EAAM,CACnBjK,OAAQ,SAASxQ,GACb,IAAI0N,EAAU1N,EAAK6P,OAAOnC,QACtB1N,EAAKuM,SACL+N,EAAQ4d,YAAYxqB,EAAQ3G,KAAM,SAE3BuT,EAAQ4d,YAAYxqB,EAAQ3G,IAEvCuT,EAAQ7Q,QAAQ,kBAAmBzJ,IAEvCo3J,QAAS,SAASp3J,GACdsa,EAAQ7Q,QAAQ,mBAAoBzJ,OAMhDi5J,eAAgB,SAASvrJ,KAQzBgN,kBAAmB,SAASD,UACjB7T,KAAKsxB,YAAYzd,EAAK/M,QAAQ3G,IACrCH,KAAKmyJ,uBAELnyJ,KAAK4T,aAAelP,IAAE4X,QAAQtc,KAAK4T,aAAcC,GACjD7T,KAAKqb,cAAcxH,IAIvBy+I,sBAAuB,WACnBtyJ,KAAKkyJ,uBAAsB,GAC3BlyJ,KAAKkB,EAAE,wBAAwB2C,OAAO7D,KAAKwU,UAAU+9I,mBAWzDC,eAAgB,SAAS1rJ,GAErB,OAAOA,GAMXotB,WAAY,SAASp2B,GACjB,IAAKkC,KAAKuT,gBAAgB3Z,OAAQ,CAC9B,IAAIkJ,EAAO,GAAA4C,OAAMqJ,IAAG,oCAAT,MAKX,OAJAjM,GAAO,uDAAA4C,OAA2DqJ,IAAG,UAA9D,SACPjM,GAAWiM,IAAG,MACdjM,GAAO,gDAAA4C,OAAoDqJ,IAAG,cAAvD,cACP/O,KAAK80B,WAAWhyB,GAIpB,IAAI4Q,EAAU1T,KAEV6U,EAAW7U,KAAKuT,gBAAgBjG,IAAI,SAAAxG,GAAO,OAAI4M,EAAQ8+I,eAAe1rJ,KAG1E,OADA4M,EAAQmd,UAAW,EACZnd,EACF0B,WAAWP,EAAU/W,EAAM4V,EAAQ2gB,eACnChc,OAAO,WACJ3E,EAAQmd,UAAW,IAEtBtI,KAAK,SAAC5N,EAAK7U,EAAQhD,GAChB4Q,EAAQ7Q,QAAQ,QAAS,CACrB8X,IAAKA,EACL7U,OAAQA,EACRhD,QAASiM,IAAG,wDAGnBf,KAAK,SAAS9E,EAAUpG,EAAS6X,GAC9BjH,EAAQ7Q,QAAQ,qBAAsBqG,EAAUpG,EAAS6X,GACzDjH,EAAQgc,OAAO,qBAAsBxmB,GACL,mBAArBwK,EAAQ8c,UACf9c,EAAQ8c,SAASt2B,KAAK8F,KAAMkJ,EAAUpG,EAAS6X,MAO/D8B,gBAAiB,WAwBb,OAvBAzc,KAAKqB,GAAG,QAASrB,KAAKyyJ,eAEtBzyJ,KAAKkb,KAAK,WAAY,WAClBlb,KAAK6C,QAAQ,mBAAoB7C,QAGrCA,KAAKqB,GAAG,kBAAmB,SAASjI,GAChC4G,KAAKmyJ,yBAGTnyJ,KAAKqB,GAAG,mBAAoB,SAASjI,GACjC,IAAI0N,EAAU1N,EAAK6P,OAAOnC,QAC1B9G,KAAK8T,kBAAkB1a,EAAK6P,QAE5BjJ,KAAKuT,gBAAkB7O,IAAE4X,QAAQtc,KAAKuT,gBAAiBzM,GAClD9G,KAAKuT,gBAAgB3Z,QACtBoG,KAAKsyJ,0BAONtyJ,MAIXyyJ,cAAe,SAASr5J,GACpB4G,KAAK7C,MAAM/D,GAEX,IACIu7B,EAAUv7B,EAAK0J,SAAWiM,IAAG,qBACjC,GAAI3V,EAAKuhB,IAAK,CACV,IAAIA,EAAMvhB,EAAKuhB,IACX7X,EAAU1J,EAAK0J,QACI,IAAnB6X,EAAIia,YAAmC,IAAfja,EAAI7U,OAC5B6uB,GAAO,KAAAjvB,OAASqJ,IAAG,qDAAZrJ,OAAkEqJ,IACrE,iCAEG4L,EAAIka,aACXF,GAAO,eAAAjvB,OAAmBwa,KAAKC,UAAUxF,EAAIka,cAAtC,UAEPF,GAAO,KAAAjvB,OAAS5C,GAZV9C,KAeN80B,WAAWH,EAAS,iBAGhC9rB,OAAQ,CAEJmvB,mBAAoB,iBACpBC,mBAAoB,iBACpBC,mBAAoB,cACpBC,8BAA+B,aAE/Bu6H,eAAgB,QAChBC,wBAAyB,wBAGzBC,6BAA8B,wBAK9BC,gCAAiC,oBACjCC,4BAA6B,gBAG7BC,oDAAqD,oBACrDC,oDAAqD,kBAGrDj5H,0BAA2B,cAC3BC,2BAA4B,qBAC5BC,yBAA0B,uBAC1BC,uBAAwB,gBACxBC,2BAA4B,gBAKhCvjB,MAAO,WACH5W,KAAKqxJ,iBACLrxJ,KAAKsxJ,iBACLtxJ,KAAKkC,UAIT+wJ,sBAAuB,SAASn3I,GAC5B9b,KAAKkB,EAAE,4CAA4CoB,YAAY,YAC/DtC,KAAKkB,EAAE,mDAAmDmB,QAY9D6wJ,kBAAmB,SAASp3I,GAExBA,EAAGra,iBAEH,IAAI2N,EAAQpP,KAAKoP,QACjBpP,KAAKs9B,oBAAoBluB,EAAO0M,EAAGmS,cAAcsP,SACjD,IAAIC,EAAWx9B,KAAKmzJ,mBAAmBr3I,EAAGmS,cAAcsP,SAGxDv9B,KAAKkB,EAAE,6BAA6B6M,SACpC,IAAI2vB,EAAex8B,EAAE,gDAChBs8B,EAAS5jC,OAGV4jC,EAASG,OAAOD,GAFhBtuB,EAAMvL,OAAO65B,IAOrBJ,oBAAqB,SAASM,EAAUlR,GACpC,IACIvU,EAASylB,EAASzlB,SAClBkL,EAAYua,EAASva,YACrBwa,EAAYnR,EAAIvU,EAAO2lB,IACvBC,EAAY5lB,EAAO2lB,IAAMF,EAASI,cAAgBtR,EAClDmR,GAAa,GAAKA,EAAY79B,KAAKywB,eACnCmN,EAASva,UAAUA,EANA,GAOZ0a,GAAa,GAAKA,EAAY/9B,KAAKywB,gBAC1CmN,EAASva,UAAUA,EARA,IAe3B8vI,mBAAoB,SAASzmI,GAKzB,IAJA,IAEIuR,EAAMj+B,KAAKkB,EAAE,8CAA8Cg9B,UAEtDxkC,EAAI,EAAGA,EAAIukC,EAAIrkC,OAAQF,IAAK,CACjC,IAAIykC,EAAMj9B,EAAE+8B,EAAIvkC,IACZokC,EAAMK,EAAIhmB,SAAS2lB,IACnBM,EAAaz7B,KAAKkV,MAAMsmB,EAAIH,cAAgB,GAPvC,EAQT,GAAIF,EAAMM,EAAa1R,GAAKoR,EAAMM,EAAa1R,EAC3C,OAAOyR,EAGf,OAAOj9B,KAIXkyJ,cAAe,SAASt3I,GAChBA,EAAGmS,gBACHnS,EAAKA,EAAGmS,eAGZnS,EAAGra,iBACHqa,EAAGkE,aAAase,WAAa,OAG7B,IAAId,EAAWx9B,KAAKmzJ,mBAAmBr3I,EAAGyhB,SAS1C,OARIC,EAAS5jC,OACToG,KAAK4wB,UAAU2N,aAAaf,GAG5Bx9B,KAAK4wB,UAAU4N,YAAYx+B,KAAKkB,EAAE,4CAA4Cm1B,QAGlFr2B,KAAKqzJ,mBACE,GAIXA,gBAAiB,WACb,IAAI3/I,EAAU1T,KACVszJ,EAAc,GAElBtzJ,KAAKkB,EAAE,4CAA4CyD,KAAK,WACpD,IAAIxE,EAAKe,EAAElB,MAAMgB,KAAK,mBAElB8F,EAAUpC,IAAEs3E,UAAUtoE,EAAQH,gBAAiB,CAC/CpT,GAAIA,IAGJ2G,EACAwsJ,EAAYx5J,KAAKgN,GAEjB1H,QAAQjC,MAAM,oBAAqBgD,KAG3CH,KAAKuT,gBAAkB+/I,EACvBtzJ,KAAKyT,eAIT8/I,kBAAmB,SAASz3I,EAAIhV,GAE5BA,EAAQ8C,QAAO,GACf5J,KAAK4wB,UAAY5wB,KAAKkB,EAAE,sDAI5BsyJ,gBAAiB,SAAS13I,EAAIhV,GAC1B5F,EAAE,6BAA6B6M,SAC/B/N,KAAK4wB,UAAY,MAQrBpc,UAAW9P,IAAE9E,OAAO,GAAI4vB,IAAYC,uBAAuBsP,kBAAmB,CAE1Ev3B,OAAQ9C,IAAE+N,SACN,CACI,qCACA,mDACA1D,IAAG,aACH,OACA,6BACA,mDACAA,IAAG,QACH,OACA,SACA,SACA,wCACA,4DACA,UACAA,IAAG,4BACH,wCACA,sCACA,UACFvB,KAAK,KAIXiH,OAAQ/P,IAAE+N,SACN,CACI,6CACA,+CACA,UACA1D,IAAG,oCACH,KACAA,IAAG,cACH,OACA,wDACA,UACAA,IAAG,mCACH,KACAA,IAAG,kBACH,OACA,SACA,8DACA,UACFvB,KAAK,KAIXwxB,OAAQt6B,IAAE+N,SACN,CACI,iCACA,sBACA,6CACA1D,IAAG,0BACH,IACA,+DACA,WACA,SACA,sBACA,2DACA,gBACAA,IAAG,wCACH,OACA,mDACAA,IAAG,QACH,UACA,SACA,SAEA,gDACA,yCACA,mDACAA,IAAG,UACH,YACA,8CACA,4EACAA,IAAG,yCACH,+BACA,YACA,yCACA,mBACAA,IAAG,+BACH,YACA,mBACAA,IAAG,6CACH,YACA,QACA,SACA,SAEA,yCACA,qDACAA,IAAG,eACH,YACA,SACA,UACFvB,KAAK,KAIXkH,YAAahQ,IAAE+N,SACX,CACI,MACA1D,IACI,CACI,oGACA,sGACA,iEACFvB,KAAK,KAEX,OACA,OACA,OACAuB,IACI,CACI,8CACA,qEACFvB,KAAK,KAEX,QACA,OACAuB,IACI,CACI,mEACA,uEACFvB,KAAK,KAEX,QACA,OACAuB,IACI,CACI,+FACA,sGACA,yEACA,mEACFvB,KAAK,KAEX,QACA,OACAuB,IACI,CACI,oGACA,kBACFvB,KAAK,KAEX,QACA,OACAuB,IACI,CAAC,wFAAwFvB,KACrF,KAGR,QACA,cACA,MACAuB,IACI,CACI,4FACA,gEACFvB,KAAK,KAEX,QACFA,KAAK,KAIX+jJ,gBAAiB7sJ,IAAE+N,SACf,CACI1D,IAAG,mEACH,mDACA,mEACA,kBACFvB,KAAK,KAIX+kJ,eAAgB7tJ,IAAE+N,SACd,CACI,wCACA1D,IAAG,sBACHA,IAAG,sBACH,8CACAA,IAAG,cACH,QACA,SACFvB,KAAK,KAIXmH,eAAgBjQ,IAAE+N,SACd,CACI,wCACA,2DACA,+BACA,kCACA1D,IAAG,kEACH,IACA,mDACA,mEACA,iBACA,6CACAA,IAAG,6BACH,IACA,UACA,SACAA,IAAG,qDACH,KACAA,IAAG,oBACH,sDACAA,IAAG,UACH,QACAA,IAAG,6BACH,IACA,UACA,SACA,SACA,wCACA,gDACA,yCACA,mDACAA,IAAG,UACH,YAEA,SACA,SACA,UACFvB,KAAK,OAMfb,SAAU,WACN,MAAO,2BAIb8mJ,EAA8B,SAAsC3zJ,GACtE,IAAMo/B,EAAWztB,IAAO0tB,WAElBC,EADO7vB,cACQ6vB,OAAS,IAAIs0H,IAASh0J,KAErCi0J,EAAiBjvJ,IAAEmM,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","file":"generic.bundled.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"\" + ({\"6\":\"ruleCollectionBuilder\",\"7\":\"vendors~ruleCollectionBuilder\"}[chunkId]||chunkId) + \".chunk.js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\tvar error = new Error('Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')');\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/scripts/bundled/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([812,0,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\n\nimport Utils from \"utils/utils\";\n\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                min: null,\n                max: null,\n                step: null,\n                precise: false,\n                split: 10000,\n                value: null,\n                onchange: function() {}\n            }).set(options);\n\n        // create new element\n        this.setElement(this._template());\n        this.$el.attr(\"id\", this.model.id);\n        this.$text = this.$(\".ui-form-slider-text\");\n        this.$slider = this.$(\".ui-form-slider-element\");\n\n        // add text field event\n        var pressed = [];\n        this.$text\n            .on(\"change\", function() {\n                self.value($(this).val());\n            })\n            .on(\"keyup\", e => {\n                pressed[e.which] = false;\n            })\n            .on(\"keydown\", function(e) {\n                var v = e.which;\n                pressed[v] = true;\n                if (self.model.get(\"is_workflow\") && pressed[16] && v == 52) {\n                    self.value(\"$\");\n                    event.preventDefault();\n                } else if (\n                    !(\n                        v == 8 ||\n                        v == 9 ||\n                        v == 13 ||\n                        v == 37 ||\n                        v == 39 ||\n                        (v >= 48 && v <= 57) ||\n                        (v >= 96 && v <= 105) ||\n                        ((v == 190 || v == 110) &&\n                            $(this)\n                                .val()\n                                .indexOf(\".\") == -1 &&\n                            self.model.get(\"precise\")) ||\n                        ((v == 189 || v == 109) &&\n                            $(this)\n                                .val()\n                                .indexOf(\"-\") == -1) ||\n                        self._isParameter($(this).val()) ||\n                        pressed[91] ||\n                        pressed[17]\n                    )\n                ) {\n                    event.preventDefault();\n                }\n            });\n\n        // build slider, cannot be rebuild in render\n        var opts = this.model.attributes;\n        this.has_slider = opts.max !== null && opts.min !== null && opts.max > opts.min;\n        var step = opts.step;\n        if (!step) {\n            if (opts.precise && this.has_slider) {\n                step = (opts.max - opts.min) / opts.split;\n            } else {\n                step = 1.0;\n            }\n        }\n        if (this.has_slider) {\n            this.$slider.slider({ min: opts.min, max: opts.max, step: step }).on(\"slide\", (event, ui) => {\n                self.value(ui.value);\n            });\n        }\n\n        // add listeners\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        var value = this.model.get(\"value\");\n        if (this.has_slider) {\n            this.$slider.slider(\"value\", value);\n            this.$slider.show();\n            this.$text.addClass(\"col-3 mr-3\");\n        } else {\n            this.$slider.hide();\n            this.$text.removeClass(\"col-3 mr-3\");\n        }\n        if (value !== this.$text.val()) {\n            this.$text.val(value);\n        }\n    },\n\n    /** Set and return the current value */\n    value: function(new_val) {\n        if (new_val !== undefined) {\n            let options = this.model.attributes;\n            let original_val = new_val;\n            let is_value = new_val !== null && new_val !== \"\" && !this._isParameter(new_val);\n            if (is_value) {\n                if (isNaN(new_val)) {\n                    new_val = 0;\n                }\n                if (!options.precise) {\n                    new_val = Math.round(new_val);\n                }\n                if (options.max !== null && !isNaN(options.max)) {\n                    new_val = Math.min(new_val, options.max);\n                }\n                if (options.min !== null && !isNaN(options.min)) {\n                    new_val = Math.max(new_val, options.min);\n                }\n            }\n            this.model.set(\"value\", new_val);\n            this.model.trigger(\"change\");\n            options.onchange(new_val);\n            let has_changed = is_value && parseInt(original_val) !== parseInt(new_val);\n            let message = has_changed ? \"This value was invalid or out-of-range. It has been auto-corrected.\" : null;\n            this.model.trigger(\"error\", message);\n        }\n        return this.model.get(\"value\");\n    },\n\n    /** Return true if the field contains a workflow parameter i.e. $('name') */\n    _isParameter: function(value) {\n        return this.model.get(\"is_workflow\") && String(value).substring(0, 1) === \"$\";\n    },\n\n    /** Slider template */\n    _template: function() {\n        return `<div class=\"ui-form-slider container-fluid\">\n                    <div class=\"row\">\n                        <input class=\"ui-input ui-form-slider-text\" type=\"text\"/>\n                        <div class=\"ui-form-slider-element col mt-1\"/>\n                    </div>\n                </div>`;\n    }\n});\n\nexport default {\n    View: View\n};\n","/** Base class for options based ui elements **/\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport Utils from \"utils/utils\";\nimport Buttons from \"mvc/ui/ui-buttons\";\n\nvar Base = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                visible: true,\n                data: [],\n                id: Utils.uid(),\n                error_text: \"No options available.\",\n                wait_text: \"Please wait...\",\n                multiple: false,\n                optional: false,\n                onchange: function() {}\n            }).set(options);\n        this.listenTo(this.model, \"change:value\", this._changeValue, this);\n        this.listenTo(this.model, \"change:wait\", this._changeWait, this);\n        this.listenTo(this.model, \"change:data\", this._changeData, this);\n        this.listenTo(this.model, \"change:visible\", this._changeVisible, this);\n        this.on(\"change\", () => {\n            self.model.get(\"onchange\")(self.value());\n        });\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        this.$el\n            .empty()\n            .removeClass()\n            .addClass(\"ui-options\")\n            .append((this.$message = $(\"<div/>\").addClass(\"mt-2\")))\n            .append((this.$menu = $(\"<div/>\").addClass(\"ui-options-menu\")))\n            .append((this.$options = $(this._template())));\n\n        // add select/unselect all button\n        this.all_button = null;\n        if (this.model.get(\"multiple\")) {\n            this.all_button = new Buttons.ButtonCheck({\n                onclick: function() {\n                    self.$(\"input\").prop(\"checked\", self.all_button.value() !== 0);\n                    self.value(self._getValue());\n                    self.trigger(\"change\");\n                }\n            });\n            this.$menu.append(this.all_button.$el);\n        }\n\n        // finalize dom\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n    },\n\n    /** Update available options */\n    update: function(input_def) {\n        if (input_def.data) {\n            this.model.set(\"data\", input_def.data);\n        }\n    },\n\n    _changeData: function() {\n        var self = this;\n        this.$options.empty();\n        if (this._templateOptions) {\n            this.$options.append(this._templateOptions(this.model.get(\"data\")));\n        } else {\n            _.each(this.model.get(\"data\"), option => {\n                self.$options.append(\n                    $(self._templateOption(option))\n                        .addClass(\"ui-option\")\n                        .tooltip({\n                            title: option.tooltip || \"\",\n                            placement: \"bottom\"\n                        })\n                );\n            });\n        }\n        this.$(\"input\").on(\"change\", () => {\n            self.value(self._getValue());\n            self.trigger(\"change\");\n        });\n        this._changeValue();\n        this._changeWait();\n    },\n\n    _changeVisible: function() {\n        this.$el[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n    },\n\n    _changeWait: function() {\n        if (this.model.get(\"wait\")) {\n            if (this.length() === 0) {\n                this._messageShow(this.model.get(\"wait_text\"), \"info\");\n                this.$options.hide();\n                this.$menu.hide();\n            }\n        } else {\n            if (this.length() === 0) {\n                this._messageShow(this.model.get(\"error_text\"), \"danger\");\n                this.$options.hide();\n                this.$menu.hide();\n            } else {\n                this.$message.hide();\n                this.$options.css(\"display\", \"inline-block\");\n                this.$menu.show();\n            }\n        }\n    },\n\n    _changeValue: function() {\n        this._setValue(this.model.get(\"value\"));\n        if (this._getValue() === null && !this.model.get(\"multiple\") && !this.model.get(\"optional\")) {\n            this._setValue(this.first());\n        }\n        if (this.all_button) {\n            this.all_button.value($.isArray(this._getValue()) ? this._getValue().length : 0, this.length());\n        }\n    },\n\n    /** Return/Set current selection */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            this.model.set(\"value\", new_value);\n        }\n        return this._getValue();\n    },\n\n    /** Return first available option */\n    first: function() {\n        var options = this.$(\"input\").first();\n        return options.length > 0 ? options.val() : null;\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set(\"wait\", true);\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set(\"wait\", false);\n    },\n\n    /** Returns the number of options */\n    length: function() {\n        return this.$(\".ui-option\").length;\n    },\n\n    /** Set value to dom */\n    _setValue: function(new_value) {\n        var self = this;\n        if (new_value !== undefined) {\n            this.$(\"input\").prop(\"checked\", false);\n            if (new_value !== null) {\n                var values = $.isArray(new_value) ? new_value : [new_value];\n                _.each(values, v => {\n                    self.$(`input[value=\"${v}\"]`)\n                        .first()\n                        .prop(\"checked\", true);\n                });\n            }\n        }\n    },\n\n    /** Return current selection */\n    _getValue: function() {\n        var selected = [];\n        this.$(\":checked\").each(function() {\n            selected.push($(this).val());\n        });\n        if (Utils.isEmpty(selected)) {\n            return null;\n        }\n        return this.model.get(\"multiple\") ? selected : selected[0];\n    },\n\n    /** Show message instead if options */\n    _messageShow: function(text, status) {\n        this.$message\n            .show()\n            .removeClass()\n            .addClass(`alert alert-${status}`)\n            .html(text);\n    },\n\n    /** Main template function */\n    _template: function() {\n        return $(\"<div/>\").addClass(\"ui-options-list\");\n    }\n});\n\n/** Iconized **/\nvar BaseIcons = Base.extend({\n    _templateOption: function(pair) {\n        var id = Utils.uid();\n        return $(\"<div/>\")\n            .addClass(\"ui-option\")\n            .append(\n                $(\"<input/>\").attr({\n                    id: id,\n                    type: this.model.get(\"type\"),\n                    name: this.model.id,\n                    value: pair.value\n                })\n            )\n            .append(\n                $(\"<label/>\")\n                    .addClass(\"ui-options-label\")\n                    .attr(\"for\", id)\n                    .html(pair.label)\n            );\n    }\n});\n\n/** Radio button field **/\nvar Radio = {};\nRadio.View = BaseIcons.extend({\n    initialize: function(options) {\n        options.type = \"radio\";\n        BaseIcons.prototype.initialize.call(this, options);\n    }\n});\n\n/** Checkbox options field **/\nvar Checkbox = {};\nCheckbox.View = BaseIcons.extend({\n    initialize: function(options) {\n        options.type = \"checkbox\";\n        options.multiple = true;\n        BaseIcons.prototype.initialize.call(this, options);\n    }\n});\n\n/** Radio button options field styled as classic buttons **/\nvar RadioButton = {};\nRadioButton.View = Base.extend({\n    initialize: function(options) {\n        Base.prototype.initialize.call(this, options);\n    },\n\n    /** Set current value */\n    _setValue: function(new_value) {\n        if (new_value !== undefined) {\n            this.$(\"input\").prop(\"checked\", false);\n            this.$(\"label\").removeClass(\"active\");\n            this.$(`[value=\"${new_value}\"]`)\n                .prop(\"checked\", true)\n                .closest(\"label\")\n                .addClass(\"active\");\n        }\n    },\n\n    /** Template for a single option */\n    _templateOption: function(pair) {\n        var $el = $(\"<label/>\").addClass(\"btn btn-secondary\");\n        if (pair.icon) {\n            $el.append(\n                $(\"<i/>\")\n                    .addClass(\"fa\")\n                    .addClass(pair.icon)\n                    .addClass(!pair.label && \"no-padding\")\n            );\n        }\n        $el.append(\n            $(\"<input/>\")\n                .attr({\n                    type: \"radio\",\n                    name: this.model.id,\n                    value: pair.value\n                })\n                .hide()\n        );\n        if (pair.label) {\n            $el.append(pair.label);\n        }\n        return $el;\n    },\n\n    /** Main template function */\n    _template: function() {\n        return $(\"<div/>\").addClass(\"btn-group ui-radiobutton\");\n    }\n});\n\nexport default {\n    Base: Base,\n    BaseIcons: BaseIcons,\n    Radio: Radio,\n    RadioButton: RadioButton,\n    Checkbox: Checkbox\n};\n","/** This class creates/wraps a drill down element. */\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Utils from \"utils/utils\";\nimport Options from \"mvc/ui/ui-options\";\nvar View = Options.BaseIcons.extend({\n    initialize: function(options) {\n        options.type = options.display || \"checkbox\";\n        options.multiple = options.type == \"checkbox\";\n        Options.BaseIcons.prototype.initialize.call(this, options);\n    },\n\n    /** Update available options */\n    update: function(input_def) {\n        this.model.set(\"data\", input_def.options);\n    },\n\n    /** Set states for selected values */\n    _setValue: function(new_value) {\n        Options.BaseIcons.prototype._setValue.call(this, new_value);\n        if (new_value !== undefined && new_value !== null && this.header_index) {\n            var self = this;\n            var values = $.isArray(new_value) ? new_value : [new_value];\n            _.each(values, v => {\n                var list = self.header_index[v];\n                _.each(list, element => {\n                    self._setState(element, true);\n                });\n            });\n        }\n    },\n\n    /** Expand/collapse a sub group */\n    _setState: function(header_id, is_expanded) {\n        var $button = this.$(`.button-${header_id}`);\n        var $subgroup = this.$(`.subgroup-${header_id}`);\n        $button.data(\"is_expanded\", is_expanded);\n        if (is_expanded) {\n            $subgroup.show();\n            $button.removeClass(\"fa-plus-square\").addClass(\"fa-minus-square\");\n        } else {\n            $subgroup.hide();\n            $button.removeClass(\"fa-minus-square\").addClass(\"fa-plus-square\");\n        }\n    },\n\n    /** Template to create options tree */\n    _templateOptions: function() {\n        var self = this;\n        this.header_index = {};\n\n        // attach event handler\n        function attach($el, header_id) {\n            var $button = $el.find(`.button-${header_id}`);\n            $button.on(\"click\", () => {\n                self._setState(header_id, !$button.data(\"is_expanded\"));\n            });\n        }\n\n        // recursive function which iterates through options\n        function iterate($tmpl, options, header) {\n            header = header || [];\n            for (var i in options) {\n                var level = options[i];\n                var has_options = level.options && level.options.length > 0;\n                var new_header = header.slice(0);\n                self.header_index[level.value] = new_header.slice(0);\n                var $group = $(\"<div/>\");\n                if (has_options) {\n                    var header_id = Utils.uid();\n                    var $button = $(\"<span/>\")\n                        .addClass(`button-${header_id}`)\n                        .addClass(\"ui-drilldown-button fa fa-plus-square\");\n                    var $subgroup = $(\"<div/>\")\n                        .addClass(`subgroup-${header_id}`)\n                        .addClass(\"ui-drilldown-subgroup\");\n                    $group.append(\n                        $(\"<div/>\")\n                            .append($button)\n                            .append(\n                                self._templateOption({\n                                    label: level.name,\n                                    value: level.value\n                                })\n                            )\n                    );\n                    new_header.push(header_id);\n                    iterate($subgroup, level.options, new_header);\n                    $group.append($subgroup);\n                    attach($group, header_id);\n                } else {\n                    $group.append(\n                        self._templateOption({\n                            label: level.name,\n                            value: level.value\n                        })\n                    );\n                }\n                $tmpl.append($group);\n            }\n        }\n\n        // iterate through options and create dom\n        var $tmpl = $(\"<div/>\");\n        iterate($tmpl, this.model.get(\"data\"));\n        return $tmpl;\n    },\n\n    /** Template for drill down view */\n    _template: function() {\n        return $(\"<div/>\")\n            .addClass(\"ui-options-list drilldown-container\")\n            .attr(\"id\", this.model.id);\n    }\n});\n\nexport default {\n    View: View\n};\n","/**\n *  This class contains backbone wrappers for basic ui elements such as Images, Labels, Buttons, Input fields etc.\n */\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Select from \"mvc/ui/ui-select-default\";\nimport Slider from \"mvc/ui/ui-slider\";\nimport Options from \"mvc/ui/ui-options\";\nimport Drilldown from \"mvc/ui/ui-drilldown\";\nimport Buttons from \"mvc/ui/ui-buttons\";\nimport Modal from \"mvc/ui/ui-modal\";\n\n/** Displays messages used e.g. in the tool form */\nexport var Message = Backbone.View.extend({\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                message: null,\n                status: \"info\",\n                cls: \"\",\n                persistent: false,\n                fade: true\n            }).set(options);\n        this.listenTo(this.model, \"change\", this.render, this);\n        if (options && options.active_tab) {\n            this.active_tab = options.active_tab;\n        }\n        this.render();\n    },\n    update: function(options) {\n        this.model.set(options);\n    },\n    render: function() {\n        var status = this.model.get(\"status\");\n        this.$el\n            .removeClass()\n            .addClass(`alert alert-${status} mt-2`)\n            .addClass(this.model.get(\"cls\"));\n        if (this.model.get(\"message\")) {\n            this.$el.html(this.messageForDisplay());\n            this.$el[this.model.get(\"fade\") ? \"fadeIn\" : \"show\"]();\n            this.timeout && window.clearTimeout(this.timeout);\n            if (!this.model.get(\"persistent\")) {\n                var self = this;\n                this.timeout = window.setTimeout(() => {\n                    self.model.set(\"message\", \"\");\n                }, 3000);\n            }\n        } else {\n            this.$el.hide();\n        }\n        return this;\n    },\n    messageForDisplay: function() {\n        return _.escape(this.model.get(\"message\"));\n    }\n});\n\nexport var UnescapedMessage = Message.extend({\n    messageForDisplay: function() {\n        return this.model.get(\"message\");\n    }\n});\n\n/** Renders an input element used e.g. in the tool form */\nexport var Input = Backbone.View.extend({\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                type: \"text\",\n                placeholder: \"\",\n                disabled: false,\n                readonly: false,\n                visible: true,\n                cls: \"\",\n                area: false,\n                color: null,\n                style: null\n            }).set(options);\n        this.tagName = this.model.get(\"area\") ? \"textarea\" : \"input\";\n        this.setElement($(`<${this.tagName}/>`));\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n    events: {\n        input: \"_onchange\"\n    },\n    value: function(new_val) {\n        new_val !== undefined && this.model.set(\"value\", typeof new_val === \"string\" ? new_val : \"\");\n        return this.model.get(\"value\");\n    },\n    render: function() {\n        var self = this;\n        this.$el\n            .removeClass()\n            .addClass(`ui-${this.tagName}`)\n            .addClass(this.model.get(\"cls\"))\n            .addClass(this.model.get(\"style\"))\n            .attr(\"id\", this.model.id)\n            .attr(\"type\", this.model.get(\"type\"))\n            .attr(\"placeholder\", this.model.get(\"placeholder\"))\n            .css(\"color\", this.model.get(\"color\") || \"\")\n            .css(\"border-color\", this.model.get(\"color\") || \"\");\n        var datalist = this.model.get(\"datalist\");\n        if ($.isArray(datalist) && datalist.length > 0) {\n            this.$el.autocomplete({\n                source: function(request, response) {\n                    response(self.model.get(\"datalist\"));\n                },\n                change: function() {\n                    self._onchange();\n                }\n            });\n        }\n        if (this.model.get(\"value\") !== this.$el.val()) {\n            this.$el.val(this.model.get(\"value\"));\n        }\n        _.each([\"readonly\", \"disabled\"], attr_name => {\n            self.model.get(attr_name) ? self.$el.attr(attr_name, true) : self.$el.removeAttr(attr_name);\n        });\n        this.$el[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n        return this;\n    },\n    _onchange: function() {\n        this.value(this.$el.val());\n        this.model.get(\"onchange\") && this.model.get(\"onchange\")(this.model.get(\"value\"));\n    }\n});\n\n/** Creates a hidden element input field used e.g. in the tool form */\nexport var Hidden = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$info = $(\"<div/>\")))\n                .append((this.$hidden = $(\"<div/>\")))\n        );\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n    value: function(new_val) {\n        new_val !== undefined && this.model.set(\"value\", new_val);\n        return this.model.get(\"value\");\n    },\n    render: function() {\n        this.$el.attr(\"id\", this.model.id);\n        this.$hidden.val(this.model.get(\"value\"));\n        this.model.get(\"info\") ? this.$info.show().text(this.model.get(\"info\")) : this.$info.hide();\n        return this;\n    }\n});\n\n/** Creates an input element which switches between select and text field */\nexport var TextSelect = Backbone.View.extend({\n    initialize: function(options) {\n        this.select = new options.SelectClass.View(options);\n        this.model = this.select.model;\n        this.text = new Input({\n            onchange: this.model.get(\"onchange\")\n        });\n        this.on(\"change\", () => {\n            if (this.model.get(\"onchange\")) {\n                this.model.get(\"onchange\")(this.value());\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append(this.select.$el)\n                .append(this.text.$el)\n        );\n        this.update(options);\n    },\n    wait: function() {\n        this.select.wait();\n    },\n    unwait: function() {\n        this.select.unwait();\n    },\n    value: function(new_val) {\n        var element = this.textmode ? this.text : this.select;\n        return element.value(new_val);\n    },\n    update: function(input_def) {\n        var data = input_def.data;\n        if (!data) {\n            data = [];\n            _.each(input_def.options, option => {\n                data.push({ label: option[0], value: option[1] });\n            });\n        }\n        var v = this.value();\n        this.textmode = input_def.textable && (!$.isArray(data) || data.length === 0);\n        this.text.$el[this.textmode ? \"show\" : \"hide\"]();\n        this.select.$el[this.textmode ? \"hide\" : \"show\"]();\n        this.select.update({ data: data });\n        this.value(v);\n    }\n});\n\n/** Creates a upload element input field */\nexport var Upload = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$info = $(\"<div/>\")))\n                .append(\n                    (this.$file = $(\"<input/>\")\n                        .attr(\"type\", \"file\")\n                        .addClass(\"mb-1\"))\n                )\n                .append(\n                    (this.$text = $(\"<textarea/>\")\n                        .addClass(\"ui-textarea\")\n                        .attr(\"disabled\", true))\n                )\n                .append((this.$wait = $(\"<i/>\").addClass(\"fa fa-spinner fa-spin\")))\n        );\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.$file.on(\"change\", e => {\n            self._readFile(e);\n        });\n        this.render();\n    },\n    value: function(new_val) {\n        new_val !== undefined && this.model.set(\"value\", new_val);\n        return this.model.get(\"value\");\n    },\n    render: function() {\n        this.$el.attr(\"id\", this.model.id);\n        this.model.get(\"info\") ? this.$info.show().text(this.model.get(\"info\")) : this.$info.hide();\n        this.model.get(\"value\") ? this.$text.text(this.model.get(\"value\")).show() : this.$text.hide();\n        this.model.get(\"wait\") ? this.$wait.show() : this.$wait.hide();\n        return this;\n    },\n    _readFile: function(e) {\n        var self = this;\n        var file = e.target.files && e.target.files[0];\n        if (file) {\n            var reader = new FileReader();\n            reader.onload = function() {\n                self.model.set({ wait: false, value: this.result });\n            };\n            this.model.set({ wait: true, value: null });\n            reader.readAsText(file);\n        }\n    }\n});\n\n/* Make more Ui stuff directly available at this namespace (for backwards\n * compatibility).  We should eliminate this practice, though, and just require\n * what we need where we need it, allowing for better package optimization.\n */\n\nexport let Button = Buttons.Button;\nexport let ButtonCheck = Buttons.ButtonCheck;\nexport let ButtonMenu = Buttons.ButtonMenu;\nexport let ButtonLink = Buttons.ButtonLink;\nexport let Checkbox = Options.Checkbox;\nexport let RadioButton = Options.RadioButton;\nexport let Radio = Options.Radio;\nexport { Select, Slider, Drilldown };\n\nexport default {\n    Button: Buttons.Button,\n    ButtonCheck: Buttons.ButtonCheck,\n    ButtonMenu: Buttons.ButtonMenu,\n    ButtonLink: Buttons.ButtonLink,\n    Input: Input,\n    Message: Message,\n    UnescapedMessage: UnescapedMessage,\n    Upload: Upload,\n    Modal: Modal,\n    RadioButton: Options.RadioButton,\n    Checkbox: Options.Checkbox,\n    Radio: Options.Radio,\n    Select: Select,\n    TextSelect: TextSelect,\n    Hidden: Hidden,\n    Slider: Slider,\n    Drilldown: Drilldown\n};\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport AJAX_QUEUE from \"utils/ajax-queue\";\n\n/** ms between fetches when checking running jobs/datasets for updates */\nvar UPDATE_DELAY = 2000;\nvar NON_TERMINAL_STATES = [\"new\", \"queued\", \"running\"];\nvar ERROR_STATES = [\"error\", \"deleted\"];\n/** Fetch state on add or just wait for polling to start. */\nvar FETCH_STATE_ON_ADD = false;\nvar BATCH_FETCH_STATE = true;\n\nvar JobStatesSummary = Backbone.Model.extend({\n    url: function() {\n        return `${getAppRoot()}api/histories/${this.attributes.history_id}/contents/dataset_collections/${\n            this.attributes.collection_id\n        }/jobs_summary`;\n    },\n\n    hasDetails: function() {\n        return this.has(\"populated_state\");\n    },\n\n    new: function() {\n        return !this.hasDetails() || this.get(\"populated_state\") == \"new\";\n    },\n\n    errored: function() {\n        return this.get(\"populated_state\") === \"error\" || this.anyWithStates(ERROR_STATES);\n    },\n\n    states: function() {\n        return this.get(\"states\") || {};\n    },\n\n    anyWithState: function(queryState) {\n        return (this.states()[queryState] || 0) > 0;\n    },\n\n    anyWithStates: function(queryStates) {\n        var states = this.states();\n        for (var index in queryStates) {\n            if ((states[queryStates[index]] || 0) > 0) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    numWithStates: function(queryStates) {\n        var states = this.states();\n        var count = 0;\n        for (var index in queryStates) {\n            count += states[queryStates[index]] || 0;\n        }\n        return count;\n    },\n\n    numInError: function() {\n        return this.numWithStates(ERROR_STATES);\n    },\n\n    running: function() {\n        return this.anyWithState(\"running\");\n    },\n\n    terminal: function() {\n        if (this.new()) {\n            return false;\n        } else {\n            var anyNonTerminal = this.anyWithStates(NON_TERMINAL_STATES);\n            return !anyNonTerminal;\n        }\n    },\n\n    jobCount: function() {\n        var states = this.states();\n        var count = 0;\n        for (var index in states) {\n            count += states[index];\n        }\n        return count;\n    },\n\n    toString: function() {\n        return `JobStatesSummary(id=${this.get(\"id\")})`;\n    }\n});\n\nvar JobStatesSummaryCollection = Backbone.Collection.extend({\n    model: JobStatesSummary,\n\n    initialize: function() {\n        /* By default we wait for a polling update to do model fetch because\n           FETCH_STATE_ON_ADD is false to load the application and target components\n           as quickly as possible. that said if the polling is turned off\n           (!this.active) and collections are added - we need to fetch those still.\n           This happens for instance in the single history view where a history is\n           shown in a static way and not polled.\n        */\n        if (FETCH_STATE_ON_ADD) {\n            this.on({\n                add: model => model.fetch()\n            });\n        } else {\n            this.on({\n                add: model => {\n                    if (!this.active) {\n                        model.fetch();\n                    }\n                }\n            });\n        }\n\n        /** cached timeout id for the dataset updater */\n        this.updateTimeoutId = null;\n        // this.checkForUpdates();\n        this.active = true;\n    },\n\n    url: function() {\n        var nonTerminalModels = this.models.filter(model => {\n            return !model.terminal();\n        });\n        var ids = nonTerminalModels\n            .map(summary => {\n                return summary.get(\"id\");\n            })\n            .join(\",\");\n        var types = nonTerminalModels\n            .map(summary => {\n                return summary.get(\"model\");\n            })\n            .join(\",\");\n        return `${getAppRoot()}api/histories/${this.historyId}/jobs_summary?ids=${ids}&types=${types}`;\n    },\n\n    monitor: function() {\n        this.clearUpdateTimeout();\n        if (!this.active) {\n            return;\n        }\n\n        var _delayThenMonitorAgain = () => {\n            this.updateTimeoutId = setTimeout(() => {\n                this.monitor();\n            }, UPDATE_DELAY);\n        };\n\n        var nonTerminalModels = this.models.filter(model => {\n            return !model.terminal();\n        });\n\n        if (nonTerminalModels.length > 0 && !BATCH_FETCH_STATE) {\n            // Allow models to fetch their own details.\n            var updateFunctions = nonTerminalModels.map(summary => {\n                return () => {\n                    return summary.fetch();\n                };\n            });\n\n            return new AJAX_QUEUE.AjaxQueue(updateFunctions).done(_delayThenMonitorAgain);\n        } else if (nonTerminalModels.length > 0) {\n            // Batch fetch updated state...\n            this.fetch({ remove: false }).done(_delayThenMonitorAgain);\n        } else {\n            _delayThenMonitorAgain();\n        }\n    },\n\n    /** clear the timeout and the cached timeout id */\n    clearUpdateTimeout: function() {\n        if (this.updateTimeoutId) {\n            clearTimeout(this.updateTimeoutId);\n            this.updateTimeoutId = null;\n        }\n    },\n\n    toString: function() {\n        return `JobStatesSummaryCollection()`;\n    }\n});\n\nexport default { JobStatesSummary, JobStatesSummaryCollection, FETCH_STATE_ON_ADD, NON_TERMINAL_STATES, ERROR_STATES };\n","/** This class creates a ui component which enables the dynamic creation of portlets */\nimport _l from \"utils/localization\";\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\n\nexport var View = Backbone.View.extend({\n    initialize: function(options) {\n        this.list = {};\n        this.options = Utils.merge(options, {\n            title: _l(\"Repeat\"),\n            empty_text: \"Not available.\",\n            max: null,\n            min: null\n        });\n        this.button_new = new Ui.Button({\n            icon: \"fa-plus\",\n            title: `Insert ${this.options.title}`,\n            tooltip: `Add new ${this.options.title} block`,\n            cls: \"btn btn-secondary float-none form-repeat-add\",\n            onclick: function() {\n                if (options.onnew) {\n                    options.onnew();\n                }\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$list = $(\"<div/>\")))\n                .append($(\"<div/>\").append(this.button_new.$el))\n        );\n    },\n\n    /** Number of repeat blocks */\n    size: function() {\n        return _.size(this.list);\n    },\n\n    /** Add new repeat block */\n    add: function(options) {\n        let Galaxy = getGalaxyInstance();\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug(\"form-repeat::add()\", \"Duplicate or invalid repeat block id.\");\n            return;\n        }\n        var button_delete = new Ui.Button({\n            icon: \"fa-trash-o\",\n            tooltip: _l(\"Delete this repeat block\"),\n            cls: \"ui-button-icon-plain form-repeat-delete\",\n            onclick: function() {\n                if (options.ondel) {\n                    options.ondel();\n                }\n            }\n        });\n        var portlet = new Portlet.View({\n            id: options.id,\n            title: _l(\"placeholder\"),\n            cls: options.cls || \"ui-portlet-section\",\n            operations: { button_delete: button_delete }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass(\"section-row\").hide();\n        this.list[options.id] = portlet;\n        this.$list.append(portlet.$el.fadeIn(\"fast\"));\n        if (this.options.max > 0 && this.size() >= this.options.max) {\n            this.button_new.disable();\n        }\n        this._refresh();\n    },\n\n    /** Delete repeat block */\n    del: function(id) {\n        let Galaxy = getGalaxyInstance();\n        if (!this.list[id]) {\n            Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n            return;\n        }\n        this.$list.find(`#${id}`).remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Remove all */\n    delAll: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n\n    /** Hides add/del options */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each(this.list, portlet => {\n            portlet.hideOperation(\"button_delete\");\n        });\n        if (_.isEmpty(this.list)) {\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"form-text text-muted\")\n                    .html(this.options.empty_text)\n            );\n        }\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(`${++index}: ${this.options.title}`);\n            portlet[this.size() > this.options.min ? \"showOperation\" : \"hideOperation\"](\"button_delete\");\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n","// import _ from \"underscore\";\nimport jQuery from \"jquery\";\n// import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\n// import STATES from \"mvc/dataset/states\";\n// import BASE_MVC from \"mvc/base-mvc\";\n// import _l from \"utils/localization\";\n\nvar collectionFuzzyCountDefault = 1000;\ntry {\n    collectionFuzzyCountDefault = localStorage.getItem(\"collectionFuzzyCountDefault\") || collectionFuzzyCountDefault;\n} catch (err) {\n    console.debug(err);\n}\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n    /** default attributes for a model */\n    defaults: {\n        /** parent (containing) history */\n        history_id: null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid: null,\n        /** whether the user wants the content shown (visible) */\n        visible: true\n    },\n\n    // ........................................................................ mixed content element\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Instead, use type_id which prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute: \"type_id\",\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden: function() {\n        return !this.get(\"visible\");\n    },\n\n    //TODO: remove\n    /** based on includeDeleted, includeHidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} includeDeleted are we showing deleted hdas?\n     *  @param {Boolean} includeHidden are we showing hidden hdas?\n     */\n    isVisible: function(includeDeleted, includeHidden) {\n        var isVisible = true;\n        if (!includeDeleted && (this.get(\"deleted\") || this.get(\"purged\"))) {\n            isVisible = false;\n        }\n        if (!includeHidden && !this.get(\"visible\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n    //TODO?: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: `${getAppRoot()}api/histories/`,\n\n    /** full url spec. for this content */\n    url: function() {\n        var historyContentType = this.get(\"history_content_type\");\n        var historyId = this.get(\"history_id\");\n        var historyContentId = this.get(\"id\");\n        var url = `${this.urlRoot}${historyId}/contents/${historyContentType}s/${historyContentId}`;\n        if (historyContentType == \"dataset_collection\") {\n            // Don't fetch whole collection - just enought to render outline. Backbone will\n            // make a detailed request if any datasets are expanded beyond that point.\n            url = `${url}?view=element-reference&fuzzy_count=${collectionFuzzyCountDefault}`;\n        }\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide: function(options) {\n        if (!this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: false }, options);\n    },\n    /** save this content as visible */\n    unhide: function(options) {\n        if (this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: true }, options);\n    },\n\n    // ........................................................................ misc\n    toString: function() {\n        return [this.get(\"type_id\"), this.get(\"hid\"), this.get(\"name\")].join(\":\");\n    }\n};\n\n//==============================================================================\nexport default {\n    HistoryContentMixin: HistoryContentMixin\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport LIST_CREATOR from \"mvc/collection/list-collection-creator\";\nimport HDCA from \"mvc/history/hdca-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"collections\";\n/*==============================================================================\nTODO:\n    the paired creator doesn't really mesh with the list creator as parent\n        it may be better to make an abstract super class for both\n    composites may inherit from this (or vis-versa)\n    PairedDatasetCollectionElementView doesn't make a lot of sense\n\n==============================================================================*/\n/**  */\nvar PairedDatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function(attributes) {\n        this.element = attributes.element || {};\n        this.identifier = attributes.identifier;\n    },\n\n    render: function() {\n        this.$el.attr(\"data-element-id\", this.element.id).html(\n            this.template({\n                identifier: this.identifier,\n                element: this.element\n            })\n        );\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(\n        ['<span class=\"identifier\"><%- identifier %></span>', '<span class=\"name\"><%- element.name %></span>'].join(\"\")\n    ),\n\n    /** remove the DOM and any listeners */\n    destroy: function() {\n        this.off();\n        this.$el.remove();\n    },\n\n    /** string rep */\n    toString: function() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\nvar _super = LIST_CREATOR.ListCollectionCreator;\n\n/** An interface for building collections.\n */\nvar PairCollectionCreator = _super.extend({\n    /** the class used to display individual elements */\n    elementViewClass: PairedDatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass: HDCA.HistoryDatasetCollection,\n    className: \"pair-collection-creator collection-creator flex-row-container\",\n\n    /** override to no-op */\n    _mangleDuplicateNames: function() {},\n\n    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n    //      bad inital choices and\n    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n    /** render the entire interface */\n    render: function(speed, callback) {\n        if (this.workingElements.length === 2) {\n            return _super.prototype.render.call(this, speed, callback);\n        }\n        return this._renderInvalid(speed, callback);\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** render forward/reverse */\n    _renderList: function(speed, callback) {\n        //this.debug( '-- _renderList' );\n        //precondition: there are two valid elements in workingElements\n        var creator = this;\n\n        var $tmp = $(\"<div/>\");\n        var $list = creator.$list();\n\n        // lose the original views, create the new, append all at once, then call their renders\n        _.each(this.elementViews, view => {\n            view.destroy();\n            creator.removeElementView(view);\n        });\n        $tmp.append(creator._createForwardElementView().$el);\n        $tmp.append(creator._createReverseElementView().$el);\n        $list.empty().append($tmp.children());\n        _.invoke(creator.elementViews, \"render\");\n    },\n\n    /** create the forward element view */\n    _createForwardElementView: function() {\n        return this._createElementView(this.workingElements[0], {\n            identifier: \"forward\"\n        });\n    },\n\n    /** create the forward element view */\n    _createReverseElementView: function() {\n        return this._createElementView(this.workingElements[1], {\n            identifier: \"reverse\"\n        });\n    },\n\n    /** create an element view, cache in elementViews, and return */\n    _createElementView: function(element, options) {\n        var elementView = new this.elementViewClass(\n            _.extend(options, {\n                element: element\n            })\n        );\n        this.elementViews.push(elementView);\n        return elementView;\n    },\n\n    /** swap the forward, reverse elements and re-render */\n    swap: function() {\n        this.workingElements = [this.workingElements[1], this.workingElements[0]];\n        this._renderList();\n    },\n\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .swap\": \"swap\"\n    }),\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates: _.extend(_.clone(_super.prototype.templates), {\n        /** the middle: element list */\n        middle: _.template(\n            [\n                '<div class=\"collection-elements-controls\">',\n                '<a class=\"swap\" href=\"javascript:void(0);\" title=\"',\n                _l(\"Swap forward and reverse datasets\"),\n                '\">',\n                _l(\"Swap\"),\n                \"</a>\",\n                \"</div>\",\n                '<div class=\"collection-elements scroll-container flex-row\">',\n                \"</div>\"\n            ].join(\"\")\n        ),\n\n        /** help content */\n        helpContent: _.template(\n            [\n                \"<p>\",\n                _l(\n                    [\n                        \"Pair collections are permanent collections containing two datasets: one forward and one reverse. \",\n                        \"Often these are forward and reverse reads. The pair collections can be passed to tools and \",\n                        \"workflows in order to have analyses done on both datasets. This interface allows \",\n                        \"you to create a pair, name it, and swap which is forward and which reverse.\"\n                    ].join(\"\")\n                ),\n                \"</p>\",\n                \"<ul>\",\n                \"<li>\",\n                _l(\n                    [\n                        'Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ',\n                        \"and the reverse dataset forward.\"\n                    ].join(\"\")\n                ),\n                \"</li>\",\n                \"<li>\",\n                _l(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\"\")),\n                \"</li>\",\n                \"</ul><br />\",\n                \"<p>\",\n                _l(\n                    [\n                        'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                        'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n                    ].join(\"\")\n                ),\n                \"</p>\"\n            ].join(\"\")\n        ),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial: _.template(\n            [\n                '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                '<span class=\"alert-message\">',\n                \"<% if( _.size( problems ) ){ %>\",\n                _l(\"The following selections could not be included due to problems\"),\n                \"<ul><% _.each( problems, function( problem ){ %>\",\n                \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                \"<% }); %></ul>\",\n                \"<% } else if( _.size( elements ) === 0 ){ %>\",\n                _l(\"No datasets were selected\"),\n                \".\",\n                \"<% } else if( _.size( elements ) === 1 ){ %>\",\n                _l(\"Only one dataset was selected\"),\n                \": <%- elements[0].name %>\",\n                \"<% } else if( _.size( elements ) > 2 ){ %>\",\n                _l(\"Too many datasets were selected\"),\n                ': <%- _.pluck( elements, \"name\" ).join( \", \") %>',\n                \"<% } %>\",\n                \"<br />\",\n                _l(\"Two (and only two) elements are needed for the pair\"),\n                \". \",\n                _l(\"You may need to \"),\n                '<a class=\"cancel-create\" href=\"javascript:void(0)\">',\n                _l(\"cancel\"),\n                \"</a> \",\n                _l(\"and reselect new elements\"),\n                \".\",\n                \"</span>\",\n                \"</div>\",\n                \"</div>\",\n                '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                '<div class=\"other-options float-left\">',\n                '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                _l(\"Cancel\"),\n                \"</button>\",\n                // _l( 'Create a different kind of collection' ),\n                \"</div>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString: function() {\n        return \"PairCollectionCreator\";\n    }\n});\n\n//==============================================================================\n/** List collection flavor of collectionCreatorModal. */\nvar pairCollectionCreatorModal = function _pairCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = _l(\"Create a collection from a pair of datasets\");\n    return LIST_CREATOR.collectionCreatorModal(elements, options, PairCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a pair collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createPairCollection(contents, defaultHideSourceItems) {\n    var elements = contents.toJSON();\n    const copyElements = !defaultHideSourceItems;\n\n    var promise = pairCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function(elements, name, hideSourceItems) {\n            elements = [\n                { name: \"forward\", src: \"hda\", id: elements[0].id },\n                { name: \"reverse\", src: \"hda\", id: elements[1].id }\n            ];\n            return contents.createHDCA(elements, \"paired\", name, hideSourceItems, copyElements);\n        }\n    });\n\n    return promise;\n}\n\n//==============================================================================\nexport default {\n    PairCollectionCreator: PairCollectionCreator,\n    pairCollectionCreatorModal: pairCollectionCreatorModal,\n    createPairCollection: createPairCollection\n};\n","import jQuery from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport BASE_MVC from \"mvc/base-mvc\";\n\n//=============================================================================\n/**\n * A Collection that can be limited/offset/re-ordered/filtered.\n * @type {Backbone.Collection}\n */\nvar ControlledFetchCollection = Backbone.Collection.extend({\n    /** call setOrder on initialization to build the comparator based on options */\n    initialize: function(models, options) {\n        Backbone.Collection.prototype.initialize.call(this, models, options);\n        this.setOrder(options.order || this.order, { silent: true });\n    },\n\n    /** set up to track order changes and re-sort when changed */\n    _setUpListeners: function() {\n        return this.on({\n            \"changed-order\": this.sort\n        });\n    },\n\n    /** override to provide order and offsets based on instance vars, set limit if passed,\n     *  and set allFetched/fire 'all-fetched' when xhr returns\n     */\n    fetch: function(options) {\n        options = this._buildFetchOptions(options);\n        let Galaxy = getGalaxyInstance();\n        Galaxy.debug(\"fetch options:\", options);\n        return Backbone.Collection.prototype.fetch.call(this, options);\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function(options) {\n        let Galaxy = getGalaxyInstance();\n\n        // note: we normally want options passed in to override the defaults built here\n        // so most of these fns will generate defaults\n        options = _.clone(options) || {};\n\n        // jquery ajax option; allows multiple q/qv for filters (instead of 'q[]')\n        options.traditional = true;\n\n        // options.data\n        // we keep limit, offset, etc. in options *as well as move it into data* because:\n        // - it makes fetch calling convenient to add it to a single options map (instead of as mult. args)\n        // - it allows the std. event handlers (for fetch, etc.) to have access\n        //   to the pagination options too\n        //      (i.e. this.on( 'sync', function( options ){ if( options.limit ){ ... } }))\n        // however, when we send to xhr/jquery we copy them to data also so that they become API query params\n        options.data = options.data || this._buildFetchData(options);\n        Galaxy.debug(\"data:\", options.data);\n\n        // options.data.filters --> options.data.q, options.data.qv\n        var filters = this._buildFetchFilters(options);\n        Galaxy.debug(\"filters:\", filters);\n        if (!_.isEmpty(filters)) {\n            _.extend(options.data, this._fetchFiltersToAjaxData(filters));\n        }\n        Galaxy.debug(\"data:\", options.data);\n        return options;\n    },\n\n    /** Build the dictionary to send to fetch's XHR as data */\n    _buildFetchData: function(options) {\n        var defaults = {};\n        if (this.order) {\n            defaults.order = this.order;\n        }\n        return _.defaults(_.pick(options, this._fetchParams), defaults);\n    },\n\n    /** These attribute keys are valid params to fetch/API-index */\n    _fetchParams: [\n        /** model dependent string to control the order of models returned */\n        \"order\",\n        /** limit the number of models returned from a fetch */\n        \"limit\",\n        /** skip this number of models when fetching */\n        \"offset\",\n        /** what series of attributes to return (model dependent) */\n        \"view\",\n        /** individual keys to return for the models (see api/histories.index) */\n        \"keys\"\n    ],\n\n    /** add any needed filters here based on collection state */\n    _buildFetchFilters: function(options) {\n        // override\n        return _.clone(options.filters || {});\n    },\n\n    /** Convert dictionary filters to qqv style arrays */\n    _fetchFiltersToAjaxData: function(filters) {\n        // return as a map so ajax.data can extend from it\n        var filterMap = {\n            q: [],\n            qv: []\n        };\n        _.each(filters, (v, k) => {\n            // don't send if filter value is empty\n            if (v === undefined || v === \"\") {\n                return;\n            }\n            // json to python\n            if (v === true) {\n                v = \"True\";\n            }\n            if (v === false) {\n                v = \"False\";\n            }\n            if (v === null) {\n                v = \"None\";\n            }\n            // map to k/v arrays (q/qv)\n            filterMap.q.push(k);\n            filterMap.qv.push(v);\n        });\n        return filterMap;\n    },\n\n    /** override to reset allFetched flag to false */\n    reset: function(models, options) {\n        this.allFetched = false;\n        return Backbone.Collection.prototype.reset.call(this, models, options);\n    },\n\n    // ........................................................................ order\n    order: null,\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: {\n        update_time: BASE_MVC.buildComparator(\"update_time\", {\n            ascending: false\n        }),\n        \"update_time-asc\": BASE_MVC.buildComparator(\"update_time\", {\n            ascending: true\n        }),\n        create_time: BASE_MVC.buildComparator(\"create_time\", {\n            ascending: false\n        }),\n        \"create_time-asc\": BASE_MVC.buildComparator(\"create_time\", {\n            ascending: true\n        })\n    },\n\n    /** set the order and comparator for this collection then sort with the new order\n     *  @event 'changed-order' passed the new order and the collection\n     */\n    setOrder: function(order, options) {\n        options = options || {};\n        var collection = this;\n        var comparator = collection.comparators[order];\n        if (_.isUndefined(comparator)) {\n            throw new Error(`unknown order: ${order}`);\n        }\n        // if( _.isUndefined( comparator ) ){ return; }\n        if (comparator === collection.comparator) {\n            return;\n        }\n\n        collection.order = order;\n        collection.comparator = comparator;\n\n        if (!options.silent) {\n            collection.trigger(\"changed-order\", options);\n        }\n        return collection;\n    }\n});\n\n//=============================================================================\n/**\n *\n */\nvar PaginatedCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for each page's fetch */\n    limitPerPage: 500,\n\n    initialize: function(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        this.currentPage = options.currentPage || 0;\n    },\n\n    getTotalItemCount: function() {\n        return this.length;\n    },\n\n    shouldPaginate: function() {\n        return this.getTotalItemCount() >= this.limitPerPage;\n    },\n\n    getLastPage: function() {\n        return Math.floor(this.getTotalItemCount() / this.limitPerPage);\n    },\n\n    getPageCount: function() {\n        return this.getLastPage() + 1;\n    },\n\n    getPageLimitOffset: function(pageNum) {\n        pageNum = this.constrainPageNum(pageNum);\n        return {\n            limit: this.limitPerPage,\n            offset: pageNum * this.limitPerPage\n        };\n    },\n\n    constrainPageNum: function(pageNum) {\n        return Math.max(0, Math.min(pageNum, this.getLastPage()));\n    },\n\n    /** fetch the next page of data */\n    fetchPage: function(pageNum, options) {\n        var self = this;\n        pageNum = self.constrainPageNum(pageNum);\n        self.currentPage = pageNum;\n        options = _.defaults(options || {}, self.getPageLimitOffset(pageNum));\n\n        self.trigger(\"fetching-more\");\n        return self.fetch(options).always(() => {\n            self.trigger(\"fetching-more-done\");\n        });\n    },\n\n    fetchCurrentPage: function(options) {\n        return this.fetchPage(this.currentPage, options);\n    },\n\n    fetchPrevPage: function(options) {\n        return this.fetchPage(this.currentPage - 1, options);\n    },\n\n    fetchNextPage: function(options) {\n        return this.fetchPage(this.currentPage + 1, options);\n    }\n});\n\n//=============================================================================\n/**\n * A Collection that will load more elements without reseting.\n */\nvar InfinitelyScrollingCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: null,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 100,\n\n    initialize: function(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        /** @type {Integer} number of contents to return from the first fetch */\n        this.limitOnFirstFetch = options.limitOnFirstFetch || this.limitOnFirstFetch;\n        /** @type {Integer} limit for every fetch after the first */\n        this.limitPerFetch = options.limitPerFetch || this.limitPerFetch;\n        /** @type {Boolean} are all contents fetched? */\n        this.allFetched = false;\n        /** @type {Integer} what was the offset of the last content returned */\n        this.lastFetched = options.lastFetched || 0;\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function(options) {\n        // options (options for backbone.fetch and jquery.ajax generally)\n        // backbone option; false here to make fetching an addititive process\n        options.remove = options.remove || false;\n        return ControlledFetchCollection.prototype._buildFetchOptions.call(this, options);\n    },\n\n    /** fetch the first 'page' of data */\n    fetchFirst: function(options) {\n        let Galaxy = getGalaxyInstance();\n        Galaxy.debug(\"ControlledFetchCollection.fetchFirst:\", options);\n        options = options ? _.clone(options) : {};\n        this.allFetched = false;\n        this.lastFetched = 0;\n        return this.fetchMore(\n            _.defaults(options, {\n                reset: true,\n                limit: this.limitOnFirstFetch\n            })\n        );\n    },\n\n    /** fetch the next page of data */\n    fetchMore: function(options) {\n        let Galaxy = getGalaxyInstance();\n\n        Galaxy.debug(\"ControlledFetchCollection.fetchMore:\", options);\n        options = _.clone(options || {});\n        var collection = this;\n\n        Galaxy.debug(\"fetchMore, options.reset:\", options.reset);\n        if (!options.reset && collection.allFetched) {\n            return jQuery.when();\n        }\n\n        // TODO: this fails in the edge case where\n        //  the first fetch offset === limit (limit 4, offset 4, collection.length 4)\n        if (options.reset) {\n            options.offset = 0;\n        } else if (options.offset === undefined) {\n            options.offset = collection.lastFetched;\n        }\n        var limit = (options.limit = options.limit || collection.limitPerFetch || null);\n        Galaxy.debug(\"fetchMore, limit:\", limit, \"offset:\", options.offset);\n\n        collection.trigger(\"fetching-more\");\n        return (\n            collection\n                .fetch(options)\n                .always(() => {\n                    collection.trigger(\"fetching-more-done\");\n                })\n                // maintain allFetched flag and trigger if all were fetched this time\n                .done(function _postFetchMore(fetchedData) {\n                    var numFetched = _.isArray(fetchedData) ? fetchedData.length : 0;\n                    collection.lastFetched += numFetched;\n                    Galaxy.debug(\"fetchMore, lastFetched:\", collection.lastFetched);\n                    // anything less than a full page means we got all there is to get\n                    if (!limit || numFetched < limit) {\n                        collection.allFetched = true;\n                        collection.trigger(\"all-fetched\", this);\n                    }\n                })\n        );\n    },\n\n    /** fetch all the collection */\n    fetchAll: function(options) {\n        // whitelist options to prevent allowing limit/offset/filters\n        // (use vanilla fetch instead)\n        options = options || {};\n        var self = this;\n        options = _.pick(options, \"silent\");\n        options.filters = {};\n        return self.fetch(options).done(() => {\n            self.allFetched = true;\n            self.trigger(\"all-fetched\", self);\n        });\n    }\n});\n\n//==============================================================================\nexport default {\n    ControlledFetchCollection: ControlledFetchCollection,\n    PaginatedCollection: PaginatedCollection,\n    InfinitelyScrollingCollection: InfinitelyScrollingCollection\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport LIST_ITEM from \"mvc/list/list-item\";\nimport LoadingIndicator from \"ui/loading-indicator\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/search-input\";\n\nvar logNamespace = \"list\";\n/* ============================================================================\nTODO:\n\n============================================================================ */\n/** @class View for a list/collection of models and the sub-views of those models.\n *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n *      use ModelWithListPanel)\n *\n *  Allows for:\n *      searching collection/sub-views\n *      selecting/multi-selecting sub-views\n *\n *  Currently used:\n *      for dataset/dataset-choice\n *      as superclass of ModelListPanel\n */\nvar ListPanel = Backbone.View.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends ListPanel.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** class to use for constructing the sub-views */\n        viewClass: LIST_ITEM.ListItemView,\n        /** class to used for constructing collection of sub-view models */\n        collectionClass: Backbone.Collection,\n\n        tagName: \"div\",\n        className: \"list-panel\",\n\n        /** (in ms) that jquery effects will use */\n        fxSpeed: \"fast\",\n\n        /** string to display when the collection has no contents */\n        emptyMsg: _l(\"This list is empty\"),\n        /** displayed when no items match the search terms */\n        noneFoundMsg: _l(\"No matching items found\"),\n        /** string used for search placeholder */\n        searchPlaceholder: _l(\"search\"),\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the list\n         */\n        initialize: function(attributes, options) {\n            attributes = attributes || {};\n            // set the logger if requested\n            if (attributes.logger) {\n                this.logger = attributes.logger;\n            }\n            this.log(`${this}.initialize:`, attributes);\n\n            // ---- instance vars\n            /** how quickly should jquery fx run? */\n            this.fxSpeed = _.has(attributes, \"fxSpeed\") ? attributes.fxSpeed : this.fxSpeed;\n\n            /** filters for displaying subviews */\n            this.filters = [];\n            /** current search terms */\n            this.searchFor = attributes.searchFor || \"\";\n\n            /** loading indicator */\n            // this.indicator = new LoadingIndicator( this.$el );\n\n            /** currently showing selectors on items? */\n            this.selecting = attributes.selecting !== undefined ? attributes.selecting : true;\n            //this.selecting = false;\n\n            /** cached selected item.model.ids to persist btwn renders */\n            this.selected = attributes.selected || [];\n            /** the last selected item.model.id */\n            this.lastSelected = null;\n\n            /** are sub-views draggable */\n            this.dragItems = attributes.dragItems || false;\n\n            /** list item view class (when passed models) */\n            this.viewClass = attributes.viewClass || this.viewClass;\n\n            /** list item views */\n            this.views = [];\n            /** list item models */\n            this.collection = attributes.collection || this._createDefaultCollection();\n\n            /** filter fns run over collection items to see if they should show in the list */\n            this.filters = attributes.filters || [];\n\n            /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n            this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\n            /** @type {String} generic title */\n            this.title = attributes.title || \"\";\n            /** @type {String} generic subtitle */\n            this.subtitle = attributes.subtitle || \"\";\n\n            this._setUpListeners();\n        },\n\n        // ------------------------------------------------------------------------ listeners\n        /** create any event listeners for the list */\n        _setUpListeners: function() {\n            this.off();\n\n            //TODO: move errorHandler down into list-view from history-view or\n            //  pass to global error handler (Galaxy)\n            this.on({\n                error: function(model, xhr, options, msg, details) {\n                    //this.errorHandler( model, xhr, options, msg, details );\n                    console.error(model, xhr, options, msg, details);\n                },\n                // show hide the loading indicator\n                loading: function() {\n                    this._showLoadingIndicator(\"loading...\", 40);\n                },\n                \"loading-done\": function() {\n                    this._hideLoadingIndicator(40);\n                }\n            });\n\n            // throw the first render up as a diff namespace using once (for outside consumption)\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this._setUpCollectionListeners();\n            this._setUpViewListeners();\n            return this;\n        },\n\n        /** create and return a collection for when none is initially passed */\n        _createDefaultCollection: function() {\n            // override\n            return new this.collectionClass([]);\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            this.log(`${this}._setUpCollectionListeners`, this.collection);\n            this.stopListening(this.collection);\n\n            // bubble up error events\n            this.listenTo(this.collection, {\n                error: function(model, xhr, options, msg, details) {\n                    this.trigger(\"error\", model, xhr, options, msg, details);\n                },\n                update: function(collection, options) {\n                    var changes = options.changes;\n                    // console.info( collection + ', update:', changes, '\\noptions:', options );\n                    // more than one: render everything\n                    if (options.renderAll || changes.added.length + changes.removed.length > 1) {\n                        return this.renderItems();\n                    }\n                    // otherwise, let the single add/remove handlers do it\n                    if (changes.added.length === 1) {\n                        return this.addItemView(_.first(changes.added), collection, options);\n                    }\n                    if (changes.removed.length === 1) {\n                        return this.removeItemView(_.first(changes.removed), collection, options);\n                    }\n                }\n            });\n            return this;\n        },\n\n        /** listening for sub-view events that bubble up with the 'view:' prefix */\n        _setUpViewListeners: function() {\n            this.log(`${this}._setUpViewListeners`);\n\n            // shift to select a range\n            this.on({\n                \"view:selected\": function(view, ev) {\n                    if (ev && ev.shiftKey && this.lastSelected) {\n                        var lastSelectedView = this.viewFromModelId(this.lastSelected);\n                        if (lastSelectedView) {\n                            this.selectRange(view, lastSelectedView);\n                        }\n                    } else if (ev && ev.altKey && !this.selecting) {\n                        this.showSelectors();\n                    }\n                    this.selected.push(view.model.id);\n                    this.lastSelected = view.model.id;\n                },\n\n                \"view:de-selected\": function(view, ev) {\n                    this.selected = _.without(this.selected, view.model.id);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        /** Render this content, set up ui.\n         *  @param {Number or String} speed   the speed of the render\n         */\n        render: function(speed) {\n            this.log(`${this}.render`, speed);\n            var $newRender = this._buildNewRender();\n            this._setUpBehaviors($newRender);\n            this._queueNewRender($newRender, speed);\n            return this;\n        },\n\n        /** Build a temp div containing the new children for the view's $el. */\n        _buildNewRender: function() {\n            this.debug(`${this}(ListPanel)._buildNewRender`);\n            var $newRender = $(this.templates.el({}, this));\n            this._renderControls($newRender);\n            this._renderTitle($newRender);\n            this._renderSubtitle($newRender);\n            this._renderSearch($newRender);\n            this.renderItems($newRender);\n            return $newRender;\n        },\n\n        /** Build a temp div containing the new children for the view's $el. */\n        _renderControls: function($newRender) {\n            this.debug(`${this}(ListPanel)._renderControls`);\n            var $controls = $(this.templates.controls({}, this));\n            $newRender.find(\".controls\").replaceWith($controls);\n            return $controls;\n        },\n\n        /** return a jQuery object containing the title DOM */\n        _renderTitle: function($where) {\n            //$where = $where || this.$el;\n            //$where.find( '.title' ).replaceWith( ... )\n        },\n\n        /** return a jQuery object containing the subtitle DOM (if any) */\n        _renderSubtitle: function($where) {\n            //$where = $where || this.$el;\n            //$where.find( '.title' ).replaceWith( ... )\n        },\n\n        /** Fade out the old el, swap in the new contents, then fade in.\n         *  @param {Number or String} speed   jq speed to use for rendering effects\n         *  @fires rendered when rendered\n         */\n        _queueNewRender: function($newRender, speed) {\n            speed = speed === undefined ? this.fxSpeed : speed;\n            var panel = this;\n            panel.log(\"_queueNewRender:\", $newRender, speed);\n\n            $(panel).queue(\"fx\", [\n                next => {\n                    panel.$el.fadeOut(speed, next);\n                },\n                next => {\n                    panel._swapNewRender($newRender);\n                    next();\n                },\n                next => {\n                    panel.$el.fadeIn(speed, next);\n                },\n                next => {\n                    panel.trigger(\"rendered\", panel);\n                    next();\n                }\n            ]);\n        },\n\n        /** empty out the current el, move the $newRender's children in */\n        _swapNewRender: function($newRender) {\n            this.$el\n                .empty()\n                .attr(\"class\", this.className)\n                .append($newRender.children());\n            if (this.selecting) {\n                this.showSelectors(0);\n            }\n            return this;\n        },\n\n        /** Set up any behaviors, handlers (ep. plugins) that need to be called when the entire view has been built but\n         *  not attached to the page yet.\n         */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            this.$controls($where)\n                .find(\"[title]\")\n                .tooltip();\n            // set up the pupup for actions available when multi selecting\n            this._renderMultiselectActionMenu($where);\n            return this;\n        },\n\n        /** render a menu containing the actions available to sets of selected items */\n        _renderMultiselectActionMenu: function($where) {\n            $where = $where || this.$el;\n            var $menu = $where.find(\".list-action-menu\");\n            var actions = this.multiselectActions();\n            if (!actions.length) {\n                return $menu.empty();\n            }\n\n            var $newMenu = $(\n                [\n                    '<div class=\"list-action-menu btn-group\">',\n                    '<button class=\"list-action-menu-btn btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"For all selected\"),\n                    \"...\",\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu float-right\" role=\"menu\">',\n                    \"</ul>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n            var $actions = actions.map(action => {\n                var html = ['<li><a href=\"javascript:void(0);\">', action.html, \"</a></li>\"].join(\"\");\n                return $(html).click(ev => {\n                    ev.preventDefault();\n                    return action.func(ev);\n                });\n            });\n            $newMenu.find(\"ul\").append($actions);\n            $menu.replaceWith($newMenu);\n            return $newMenu;\n        },\n\n        /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n         *      html: an html string used as the anchor contents\n         *      func: a function called when the anchor is clicked (passed the click event)\n         */\n        multiselectActions: function() {\n            return [];\n        },\n\n        // ------------------------------------------------------------------------ sub-$element shortcuts\n        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n        $scrollContainer: function($where) {\n            // override or set via attributes.$scrollContainer\n            return ($where || this.$el).parent().parent();\n        },\n        /** convenience selector for the section that displays the list controls */\n        $controls: function($where) {\n            return ($where || this.$el).find(\"> .controls\");\n        },\n        /** list-items: where the subviews are contained in the view's dom */\n        $list: function($where) {\n            return ($where || this.$el).find(\"> .list-items\");\n        },\n        /** container where list messages are attached */\n        $messages: function($where) {\n            //TODO: controls isn't really correct here (only for ModelListPanel)\n            return ($where || this.$el).find(\"> .controls .messages\");\n        },\n        /** the message displayed when no views can be shown (no views, none matching search) */\n        $emptyMessage: function($where) {\n            return ($where || this.$el).find(\"> .empty-message\");\n        },\n\n        // ------------------------------------------------------------------------ hda sub-views\n        /** render the subviews for the list's collection */\n        renderItems: function($whereTo) {\n            $whereTo = $whereTo || this.$el;\n            var panel = this;\n            panel.log(`${this}.renderItems`, $whereTo);\n\n            var $list = panel.$list($whereTo);\n            panel.freeViews();\n            // console.log( 'views freed' );\n            //TODO:? cache and re-use views?\n            var shownModels = panel._filterCollection();\n            // console.log( 'models filtered:', shownModels );\n\n            panel.views = shownModels.map(itemModel => {\n                var view = panel._createItemView(itemModel);\n                return view;\n            });\n\n            $list.empty();\n            // console.log( 'list emptied' );\n            if (panel.views.length) {\n                panel._attachItems($whereTo);\n                // console.log( 'items attached' );\n            }\n            panel._renderEmptyMessage($whereTo).toggle(!panel.views.length);\n            panel.trigger(\"views:ready\", panel.views);\n\n            // console.log( '------------------------------------------- rendering items' );\n            return panel.views;\n        },\n\n        /** Filter the collection to only those models that should be currently viewed */\n        _filterCollection: function() {\n            // override this\n            var panel = this;\n            return panel.collection.filter(_.bind(panel._filterItem, panel));\n        },\n\n        /** Should the model be viewable in the current state?\n         *     Checks against this.filters and this.searchFor\n         */\n        _filterItem: function(model) {\n            // override this\n            var panel = this;\n            return (\n                _.every(panel.filters.map(fn => fn.call(model))) &&\n                (!panel.searchFor || model.matchesAll(panel.searchFor))\n            );\n        },\n\n        /** Create a view for a model and set up it's listeners */\n        _createItemView: function(model) {\n            var ViewClass = this._getItemViewClass(model);\n            var options = _.extend(this._getItemViewOptions(model), {\n                model: model\n            });\n            var view = new ViewClass(options);\n            this._setUpItemViewListeners(view);\n            return view;\n        },\n\n        /** Free a view for a model. Note: does not remove it from the DOM */\n        _destroyItemView: function(view) {\n            this.stopListening(view);\n            this.views = _.without(this.views, view);\n        },\n\n        _destroyItemViews: function(view) {\n            var self = this;\n            self.views.forEach(v => {\n                self.stopListening(v);\n            });\n            self.views = [];\n            return self;\n        },\n\n        /** free any sub-views the list has */\n        freeViews: function() {\n            return this._destroyItemViews();\n        },\n\n        /** Get the bbone view class based on the model */\n        _getItemViewClass: function(model) {\n            // override this\n            return this.viewClass;\n        },\n\n        /** Get the options passed to the new view based on the model */\n        _getItemViewOptions: function(model) {\n            // override this\n            return {\n                //logger      : this.logger,\n                fxSpeed: this.fxSpeed,\n                expanded: false,\n                selectable: this.selecting,\n                selected: _.contains(this.selected, model.id),\n                draggable: this.dragItems\n            };\n        },\n\n        /** Set up listeners for new models */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            // send all events to the panel, re-namspaceing them with the view prefix\n            this.listenTo(view, \"all\", function() {\n                var args = Array.prototype.slice.call(arguments, 0);\n                args[0] = `view:${args[0]}`;\n                panel.trigger.apply(panel, args);\n            });\n\n            // drag multiple - hijack ev.setData to add all selected items\n            this.listenTo(\n                view,\n                \"draggable:dragstart\",\n                function(ev, v) {\n                    //TODO: set multiple drag data here\n                    var json = {};\n\n                    var selected = this.getSelectedModels();\n                    if (selected.length) {\n                        json = selected.toJSON();\n                    } else {\n                        json = [v.model.toJSON()];\n                    }\n                    ev.dataTransfer.setData(\"text\", JSON.stringify(json));\n                    //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n                },\n                this\n            );\n\n            return panel;\n        },\n\n        /** Attach views in this.views to the model based on $whereTo */\n        _attachItems: function($whereTo) {\n            var self = this;\n            // console.log( '_attachItems:', $whereTo, this.$list( $whereTo ) );\n            //ASSUMES: $list has been emptied\n            this.$list($whereTo).append(this.views.map(view => self._renderItemView$el(view)));\n            return this;\n        },\n\n        /** get a given subview's $el (or whatever may wrap it) and return it */\n        _renderItemView$el: function(view) {\n            // useful to wrap and override\n            return view.render(0).$el;\n        },\n\n        /** render the empty/none-found message */\n        _renderEmptyMessage: function($whereTo) {\n            this.debug(\"_renderEmptyMessage\", $whereTo, this.searchFor);\n            var text = this.searchFor ? this.noneFoundMsg : this.emptyMsg;\n            return this.$emptyMessage($whereTo).text(text);\n        },\n\n        /** expand all item views */\n        expandAll: function() {\n            _.each(this.views, view => {\n                view.expand();\n            });\n        },\n\n        /** collapse all item views */\n        collapseAll: function() {\n            _.each(this.views, view => {\n                view.collapse();\n            });\n        },\n\n        // ------------------------------------------------------------------------ collection/views syncing\n        /** Add a view (if the model should be viewable) to the panel */\n        addItemView: function(model, collection, options) {\n            // console.log( this + '.addItemView:', model );\n            var panel = this;\n            // get the index of the model in the list of filtered models shown by this list\n            // in order to insert the view in the proper place\n            //TODO:? potentially expensive\n            var modelIndex = panel._filterCollection().indexOf(model);\n            if (modelIndex === -1) {\n                return undefined;\n            }\n            var view = panel._createItemView(model);\n            // console.log( 'adding and rendering:', modelIndex, view.toString() );\n\n            $(view).queue(\"fx\", [\n                next => {\n                    // hide the empty message first if only view\n                    if (panel.$emptyMessage().is(\":visible\")) {\n                        panel.$emptyMessage().fadeOut(panel.fxSpeed, next);\n                    } else {\n                        next();\n                    }\n                },\n                next => {\n                    panel._attachView(view, modelIndex);\n                    next();\n                }\n            ]);\n            return view;\n        },\n\n        /** internal fn to add view (to both panel.views and panel.$list) */\n        _attachView: function(view, modelIndex, useFx) {\n            // console.log( this + '._attachView:', view, modelIndex, useFx );\n            useFx = _.isUndefined(useFx) ? true : useFx;\n            modelIndex = modelIndex || 0;\n            var panel = this;\n\n            // use the modelIndex to splice into views and insert at the proper index in the DOM\n            panel.views.splice(modelIndex, 0, view);\n            panel._insertIntoListAt(modelIndex, panel._renderItemView$el(view).hide());\n\n            panel.trigger(\"view:attached\", view);\n            if (useFx) {\n                view.$el.slideDown(panel.fxSpeed, () => {\n                    panel.trigger(\"view:attached:rendered\");\n                });\n            } else {\n                view.$el.show();\n                panel.trigger(\"view:attached:rendered\");\n            }\n            return view;\n        },\n\n        /** insert a jq object as a child of list-items at the specified *DOM index* */\n        _insertIntoListAt: function(index, $what) {\n            // console.log( this + '._insertIntoListAt:', index, $what );\n            var $list = this.$list();\n            if (index === 0) {\n                $list.prepend($what);\n            } else {\n                $list\n                    .children()\n                    .eq(index - 1)\n                    .after($what);\n            }\n            return $what;\n        },\n\n        /** Remove a view from the panel (if found) */\n        removeItemView: function(model, collection, options) {\n            var panel = this;\n            var view = _.find(panel.views, v => v.model === model);\n            if (!view) {\n                return undefined;\n            }\n            panel.views = _.without(panel.views, view);\n            panel.trigger(\"view:removed\", view);\n\n            // potentially show the empty message if no views left\n            // use anonymous queue here - since remove can happen multiple times\n            $({}).queue(\"fx\", [\n                next => {\n                    view.$el.fadeOut(panel.fxSpeed, next);\n                },\n                next => {\n                    view.remove();\n                    panel.trigger(\"view:removed:rendered\");\n                    if (!panel.views.length) {\n                        panel._renderEmptyMessage().fadeIn(panel.fxSpeed, next);\n                    } else {\n                        next();\n                    }\n                }\n            ]);\n            return view;\n        },\n\n        /** get views based on model.id */\n        viewFromModelId: function(id) {\n            return _.find(this.views, v => v.model.id === id);\n        },\n\n        /** get views based on model */\n        viewFromModel: function(model) {\n            return model ? this.viewFromModelId(model.id) : undefined;\n        },\n\n        /** get views based on model properties */\n        viewsWhereModel: function(properties) {\n            return this.views.filter(view => _.isMatch(view.model.attributes, properties));\n        },\n\n        /** A range of views between (and including) viewA and viewB */\n        viewRange: function(viewA, viewB) {\n            if (viewA === viewB) {\n                return viewA ? [viewA] : [];\n            }\n\n            var indexA = this.views.indexOf(viewA);\n            var indexB = this.views.indexOf(viewB);\n\n            // handle not found\n            if (indexA === -1 || indexB === -1) {\n                if (indexA === indexB) {\n                    return [];\n                }\n                return indexA === -1 ? [viewB] : [viewA];\n            }\n            // reverse if indeces are\n            //note: end inclusive\n            return indexA < indexB ? this.views.slice(indexA, indexB + 1) : this.views.slice(indexB, indexA + 1);\n        },\n\n        // ------------------------------------------------------------------------ searching\n        /** render a search input for filtering datasets shown\n         *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n         *      return will start the search\n         *      esc will clear the search\n         *      clicking the clear button will clear the search\n         *      uses searchInput in ui.js\n         */\n        _renderSearch: function($where) {\n            $where.find(\".controls .search-input\").searchInput({\n                placeholder: this.searchPlaceholder,\n                initialVal: this.searchFor,\n                onfirstsearch: _.bind(this._firstSearch, this),\n                onsearch: _.bind(this.searchItems, this),\n                onclear: _.bind(this.clearSearch, this)\n            });\n            return $where;\n        },\n\n        /** What to do on the first search entered */\n        _firstSearch: function(searchFor) {\n            // override to load model details if necc.\n            this.log(\"onFirstSearch\", searchFor);\n            return this.searchItems(searchFor);\n        },\n\n        /** filter view list to those that contain the searchFor terms */\n        searchItems: function(searchFor, force) {\n            this.log(\"searchItems\", searchFor, this.searchFor, force);\n            if (!force && this.searchFor === searchFor) {\n                return this;\n            }\n            this.searchFor = searchFor;\n            this.renderItems();\n            this.trigger(\"search:searching\", searchFor, this);\n            var $search = this.$(\"> .controls .search-query\");\n            if ($search.val() !== searchFor) {\n                $search.val(searchFor);\n            }\n            return this;\n        },\n\n        /** clear the search filters and show all views that are normally shown */\n        clearSearch: function(searchFor) {\n            //this.log( 'onSearchClear', this );\n            this.searchFor = \"\";\n            this.trigger(\"search:clear\", this);\n            this.$(\"> .controls .search-query\").val(\"\");\n            this.renderItems();\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ selection\n        /** @type Integer when the number of list item views is >= to this, don't animate selectors */\n        THROTTLE_SELECTOR_FX_AT: 20,\n\n        /** show selectors on all visible itemViews and associated controls */\n        showSelectors: function(speed) {\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            this.selecting = true;\n            this.$(\".list-actions\").slideDown(speed);\n            speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n            _.each(this.views, view => {\n                view.showSelector(speed);\n            });\n            //this.selected = [];\n            //this.lastSelected = null;\n        },\n\n        /** hide selectors on all visible itemViews and associated controls */\n        hideSelectors: function(speed) {\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            this.selecting = false;\n            this.$(\".list-actions\").slideUp(speed);\n            speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n            _.each(this.views, view => {\n                view.hideSelector(speed);\n            });\n            this.selected = [];\n            this.lastSelected = null;\n        },\n\n        /** show or hide selectors on all visible itemViews and associated controls */\n        toggleSelectors: function() {\n            if (!this.selecting) {\n                this.showSelectors();\n            } else {\n                this.hideSelectors();\n            }\n        },\n\n        /** select all visible items */\n        selectAll: function(event) {\n            _.each(this.views, view => {\n                view.select(event);\n            });\n        },\n\n        /** deselect all visible items */\n        deselectAll: function(event) {\n            this.lastSelected = null;\n            _.each(this.views, view => {\n                view.deselect(event);\n            });\n        },\n\n        /** select a range of datasets between A and B */\n        selectRange: function(viewA, viewB) {\n            var range = this.viewRange(viewA, viewB);\n            _.each(range, view => {\n                view.select();\n            });\n            return range;\n        },\n\n        /** return an array of all currently selected itemViews */\n        getSelectedViews: function() {\n            return _.filter(this.views, v => v.selected);\n        },\n\n        /** return a collection of the models of all currenly selected items */\n        getSelectedModels: function() {\n            // console.log( '(getSelectedModels)' );\n            return new this.collection.constructor(_.map(this.getSelectedViews(), view => view.model));\n        },\n\n        // ------------------------------------------------------------------------ loading indicator\n        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n        _showLoadingIndicator: function(msg, speed, callback) {\n            this.debug(\"_showLoadingIndicator\", this.indicator, msg, speed, callback);\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            if (!this.indicator) {\n                this.indicator = new LoadingIndicator.LoadingIndicator(this.$el);\n                this.debug(\"\\t created\", this.indicator);\n            }\n            if (!this.$el.is(\":visible\")) {\n                this.indicator.show(0, callback);\n            } else {\n                this.$el.fadeOut(speed);\n                this.indicator.show(msg, speed, callback);\n            }\n        },\n\n        /** hide the loading indicator */\n        _hideLoadingIndicator: function(speed, callback) {\n            this.debug(\"_hideLoadingIndicator\", this.indicator, speed, callback);\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            if (this.indicator) {\n                this.indicator.hide(speed, callback);\n            }\n        },\n\n        // ------------------------------------------------------------------------ scrolling\n        /** get the current scroll position of the panel in its parent */\n        scrollPosition: function() {\n            return this.$scrollContainer().scrollTop();\n        },\n\n        /** set the current scroll position of the panel in its parent */\n        scrollTo: function(pos, speed) {\n            speed = speed || 0;\n            this.$scrollContainer().animate({ scrollTop: pos }, speed);\n            return this;\n        },\n\n        /** Scrolls the panel to the top. */\n        scrollToTop: function(speed) {\n            return this.scrollTo(0, speed);\n        },\n\n        /** scroll to the given view in list-items */\n        scrollToItem: function(view, speed) {\n            if (!view) {\n                return this;\n            }\n            return this;\n        },\n\n        /** Scrolls the panel to show the content with the given id. */\n        scrollToId: function(id, speed) {\n            return this.scrollToItem(this.viewFromModelId(id), speed);\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: {\n            \"click .select-all\": \"selectAll\",\n            \"click .deselect-all\": \"deselectAll\"\n        },\n\n        // ------------------------------------------------------------------------ misc\n        /** Return a string rep of the panel */\n        toString: function() {\n            return `ListPanel(${this.collection})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListPanel.prototype.templates = (() => {\n    var elTemplate = BASE_MVC.wrapTemplate([\n        // temp container\n        \"<div>\",\n        '<div class=\"controls\"></div>',\n        '<div class=\"list-items\"></div>',\n        '<div class=\"empty-message infomessagesmall\"></div>',\n        \"</div>\"\n    ]);\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n        '<div class=\"title\">',\n        '<div class=\"name\"><%- view.title %></div>',\n        \"</div>\",\n        '<div class=\"subtitle\"><%- view.subtitle %></div>',\n        // buttons, controls go here\n        '<div class=\"actions\"></div>',\n        // deleted msg, etc.\n        '<div class=\"messages\"></div>',\n\n        '<div class=\"search\">',\n        '<div class=\"search-input\"></div>',\n        \"</div>\",\n\n        // show when selectors are shown\n        '<div class=\"list-actions\">',\n        '<div class=\"btn-group\">',\n        '<button class=\"select-all btn btn-secondary\"',\n        'data-mode=\"select\">',\n        _l(\"All\"),\n        \"</button>\",\n        '<button class=\"deselect-all btn btn-secondary\"',\n        'data-mode=\"select\">',\n        _l(\"None\"),\n        \"</button>\",\n        \"</div>\",\n        '<div class=\"list-action-menu btn-group\">',\n        \"</div>\",\n        \"</div>\",\n        \"</div>\"\n    ]);\n\n    return {\n        el: elTemplate,\n        controls: controlsTemplate\n    };\n})();\n\n//=============================================================================\n/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n *  Allows:\n *      the model to be reset\n *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n *\n */\nvar ModelListPanel = ListPanel.extend({\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey: \"contents\",\n\n    initialize: function(attributes) {\n        ListPanel.prototype.initialize.call(this, attributes);\n        this.selecting = attributes.selecting !== undefined ? attributes.selecting : false;\n\n        this.setModel(this.model, attributes);\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel: function(model, attributes) {\n        attributes = attributes || {};\n        this.debug(`${this}.setModel:`, model, attributes);\n\n        this.freeModel();\n        this.freeViews();\n\n        if (model) {\n            var oldModelId = this.model ? this.model.get(\"id\") : null;\n\n            // set up the new model with user, logger, storage, events\n            this.model = model;\n            if (this.logger) {\n                this.model.logger = this.logger;\n            }\n            this._setUpModelListeners();\n\n            //TODO: relation btwn model, collection becoming tangled here\n            // free the collection, and assign the new collection to either\n            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n            this.stopListening(this.collection);\n            this.collection =\n                this.model[this.modelCollectionKey] || attributes.collection || this._createDefaultCollection();\n            this._setUpCollectionListeners();\n\n            if (oldModelId && model.get(\"id\") !== oldModelId) {\n                this.trigger(\"new-model\", this);\n            }\n        }\n        return this;\n    },\n\n    /** free the current model and all listeners for it, free any views for the model */\n    freeModel: function() {\n        // stop/release the previous model, and clear cache to sub-views\n        if (this.model) {\n            this.stopListening(this.model);\n            //TODO: see base-mvc\n            //this.model.free();\n            //this.model = null;\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listening\n    /** listening for model events */\n    _setUpModelListeners: function() {\n        // override\n        this.log(`${this}._setUpModelListeners`, this.model);\n        // bounce model errors up to the panel\n        this.listenTo(\n            this.model,\n            \"error\",\n            function() {\n                var args = Array.prototype.slice.call(arguments, 0);\n                //args.unshift( 'model:error' );\n                args.unshift(\"error\");\n                this.trigger.apply(this, args);\n            },\n            this\n        );\n\n        // debugging\n        if (this.logger) {\n            this.listenTo(this.model, \"all\", function(event) {\n                this.info(`${this}(model)`, event, arguments);\n            });\n        }\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls: function($newRender) {\n        this.debug(`${this}(ModelListPanel)._renderControls`);\n        var json = this.model ? this.model.toJSON() : {};\n        var $controls = $(this.templates.controls(json, this));\n        $newRender.find(\".controls\").replaceWith($controls);\n        return $controls;\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString: function() {\n        return `ModelListPanel(${this.model})`;\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nModelListPanel.prototype.templates = (() => {\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n        '<div class=\"title\">',\n        //TODO: this is really the only difference - consider factoring titlebar out\n        '<div class=\"name\"><%- model.name %></div>',\n        \"</div>\",\n        '<div class=\"subtitle\"><%- view.subtitle %></div>',\n        '<div class=\"actions\"></div>',\n        '<div class=\"messages\"></div>',\n\n        '<div class=\"search\">',\n        '<div class=\"search-input\"></div>',\n        \"</div>\",\n\n        '<div class=\"list-actions\">',\n        '<div class=\"btn-group\">',\n        '<button class=\"select-all btn btn-secondary\"',\n        'data-mode=\"select\">',\n        _l(\"All\"),\n        \"</button>\",\n        '<button class=\"deselect-all btn btn-secondary\"',\n        'data-mode=\"select\">',\n        _l(\"None\"),\n        \"</button>\",\n        \"</div>\",\n        '<div class=\"list-action-menu btn-group\">',\n        \"</div>\",\n        \"</div>\",\n        \"</div>\"\n    ]);\n\n    return _.extend(_.clone(ListPanel.prototype.templates), {\n        controls: controlsTemplate\n    });\n})();\n\n//=============================================================================\nexport default {\n    ListPanel: ListPanel,\n    ModelListPanel: ModelListPanel\n};\n","import _ from \"underscore\";\nimport DATASET_LI from \"mvc/dataset/dataset-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Read only view for HistoryDatasetAssociation.\n *      Since there are no controls on the HDAView to hide the dataset,\n *      the primary thing this class does (currently) is override templates\n *      to render the HID.\n */\nvar HDAListItemView = _super.extend(\n    /** @lends HDAListItemView.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        initialize: function(attributes, options) {\n            _super.prototype.initialize.call(this, attributes, options);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemView.prototype.templates = (() => {\n    var titleBarTemplate = dataset => `\n        <div class=\"title-bar clear\" tabindex=\"0\">\n            <span class=\"state-icon\"></span>\n            <div class=\"title\">\n                <span class=\"hid\">${dataset.hid}</span>\n                <span class=\"name\">${_.escape(dataset.name)}</span>\n            </div>\n            </br>\n            <div class=\"nametags\"></div>\n        </div>\n    `;\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: BASE_MVC.wrapTemplate(\n            [\n                // add a warning when hidden\n                \"<% if( !dataset.visible ){ %>\",\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                _l(\"This dataset has been hidden\"),\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        titleBar: titleBarTemplate,\n        warnings: warnings\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDAListItemView: HDAListItemView\n};\n","import _ from \"underscore\";\nimport STATES from \"mvc/dataset/states\";\nimport DC_LI from \"mvc/collection/collection-li\";\nimport DC_VIEW from \"mvc/collection/collection-view\";\nimport _l from \"utils/localization\";\nimport { mountNametags } from \"components/Nametags\";\n\n//==============================================================================\nvar _super = DC_LI.DCListItemView;\n/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n */\nvar HDCAListItemView = _super.extend(\n    /** @lends HDCAListItemView.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        render: function() {\n            let result = _super.prototype.render.apply(this, arguments);\n            this._mountNametags(\"initialize\");\n            return result;\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            var renderListen = (model, options) => {\n                // We want this to swap immediately without extra animations.\n                this.render(0);\n                this._mountNametags(\"listener\");\n            };\n            if (this.model.jobStatesSummary) {\n                this.listenTo(this.model.jobStatesSummary, \"change\", renderListen);\n            }\n            this.listenTo(this.model, {\n                \"change:tags change:visible change:state\": renderListen\n            });\n        },\n\n        _mountNametags(context) {\n            let container = this.$el.find(\".nametags\")[0];\n            if (container) {\n                let { id, model_class, tags } = this.model.attributes;\n                let storeKey = `${model_class}-${id}`;\n                mountNametags({ storeKey, tags }, container);\n            }\n        },\n\n        /** Override to provide the proper collections panels as the foldout */\n        _getFoldoutPanelClass: function() {\n            return DC_VIEW.CollectionView;\n        },\n\n        /** In this override, add the state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            _super.prototype._swapNewRender.call(this, $newRender);\n            //TODO: model currently has no state\n            var state;\n            var jobStatesSummary = this.model.jobStatesSummary;\n            if (jobStatesSummary) {\n                if (jobStatesSummary.new()) {\n                    state = \"loading\";\n                } else if (jobStatesSummary.errored()) {\n                    state = \"error\";\n                } else if (jobStatesSummary.terminal()) {\n                    state = \"ok\";\n                } else if (jobStatesSummary.running()) {\n                    state = \"running\";\n                } else {\n                    state = \"queued\";\n                }\n            } else if (this.model.get(\"job_source_id\")) {\n                // Initial rendering - polling will fill in more details in a bit.\n                state = \"loading\";\n            } else {\n                state = this.model.get(\"populated_state\") ? STATES.OK : STATES.RUNNING;\n            }\n            this.$el.addClass(`state-${state}`);\n            var stateDescription = this.stateDescription();\n            this.$(\".state-description\").html(stateDescription);\n            return this.$el;\n        },\n\n        stateDescription: function() {\n            var collection = this.model;\n            var jobStateSource = collection.get(\"job_source_type\");\n            var collectionTypeDescription = DC_VIEW.collectionTypeDescription(collection);\n            var simpleDescription = DC_VIEW.collectionDescription(collection);\n            var jobStatesSummary = collection.jobStatesSummary;\n            if (!jobStateSource || jobStateSource == \"Job\") {\n                return simpleDescription;\n            } else if (!jobStatesSummary || !jobStatesSummary.hasDetails()) {\n                return `\n                    <div class=\"progress state-progress\">\n                        <span class=\"note\">Loading job data for ${collectionTypeDescription}.<span class=\"blinking\">..</span></span>\n                        <div class=\"progress-bar info\" style=\"width:100%\">\n                    </div>`;\n            } else {\n                var isNew = jobStatesSummary.new();\n                var jobCount = isNew ? null : jobStatesSummary.jobCount();\n                if (isNew) {\n                    return `\n                        <div class=\"progress state-progress\">\n                            <span class=\"note\">Creating jobs.<span class=\"blinking\">..</span></span>\n                            <div class=\"progress-bar info\" style=\"width:100%\">\n                        </div>`;\n                } else if (jobStatesSummary.errored()) {\n                    var errorCount = jobStatesSummary.numInError();\n                    return `a ${collectionTypeDescription} with ${errorCount} / ${jobCount} jobs in error`;\n                } else if (jobStatesSummary.terminal()) {\n                    return simpleDescription;\n                } else {\n                    var running = jobStatesSummary.states()[\"running\"] || 0;\n                    var ok = jobStatesSummary.states()[\"ok\"] || 0;\n                    var okPercent = ok / (jobCount * 1.0);\n                    var runningPercent = running / (jobCount * 1.0);\n                    var otherPercent = 1.0 - okPercent - runningPercent;\n                    var jobsStr = jobCount && jobCount > 1 ? `${jobCount} jobs` : `a job`;\n                    return `\n                        <div class=\"progress state-progress\">\n                            <span class=\"note\">${jobsStr} generating a ${collectionTypeDescription}</span>\n                            <div class=\"progress-bar ok\" style=\"width:${okPercent * 100.0}%\"></div>\n                            <div class=\"progress-bar running\" style=\"width:${runningPercent * 100.0}%\"></div>\n                            <div class=\"progress-bar new\" style=\"width:${otherPercent * 100.0}%\">\n                        </div>`;\n                }\n            }\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDCAListItemView(${modelString})`;\n        }\n    }\n);\n\n/** underscore templates */\nHDCAListItemView.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: collection => {\n            collection.visible\n                ? \"\"\n                : `<div class=\"hidden-msg warningmessagesmall\">${_l(\"This collection has been hidden\")}</div>`;\n        }\n    });\n\n    var titleBarTemplate = collection => `\n        <div class=\"title-bar clear\" tabindex=\"0\">\n            <span class=\"state-icon\"></span>\n            <div class=\"title\">\n                <span class=\"hid\">${collection.hid}</span>\n                <span class=\"name\">${_.escape(collection.name)}</span>\n            </div>\n            <div class=\"state-description\">\n            </div>\n            <div class=\"nametags\"><!-- Nametags mount here (hdca-li) --></div>\n        </div>\n    `;\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDCAListItemView: HDCAListItemView\n};\n","import _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n// =============================================================================\n/** A view on any model that has a 'annotation' attribute\n */\nvar AnnotationEditor = Backbone.View.extend(baseMVC.LoggableMixin)\n    .extend(baseMVC.HiddenUntilActivatedViewMixin)\n    .extend({\n        tagName: \"div\",\n        className: \"annotation-display\",\n\n        /** Set up listeners, parse options */\n        initialize: function(options) {\n            options = options || {};\n            this.tooltipConfig = options.tooltipConfig || {\n                placement: \"bottom\"\n            };\n            //console.debug( this, options );\n            // only listen to the model only for changes to annotations\n            this.listenTo(this.model, \"change:annotation\", function() {\n                this.render();\n            });\n            this.hiddenUntilActivated(options.$activator, options);\n        },\n\n        /** Build the DOM elements, call select to on the created input, and set up behaviors */\n        render: function() {\n            var view = this;\n            this.$el.html(this._template());\n\n            //TODO: handle empties better\n            this.$annotation().make_text_editable({\n                use_textarea: true,\n                on_finish: function(newAnnotation) {\n                    view.$annotation().text(newAnnotation);\n                    view.model.save({ annotation: newAnnotation }, { silent: true }).fail(() => {\n                        view.$annotation().text(view.model.previous(\"annotation\"));\n                    });\n                }\n            });\n            return this;\n        },\n\n        /** @returns {String} the html text used to build the view's DOM */\n        _template: function() {\n            var annotation = this.model.get(\"annotation\");\n            return [\n                //TODO: make prompt optional\n                '<label class=\"prompt\">',\n                _l(\"Annotation\"),\n                \"</label>\",\n                // set up initial tags by adding as CSV to input vals (necc. to init select2)\n                '<div class=\"annotation\">',\n                _.escape(annotation),\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        /** @returns {jQuery} the main element for this view */\n        $annotation: function() {\n            return this.$el.find(\".annotation\");\n        },\n\n        /** shut down event listeners and remove this view's DOM */\n        remove: function() {\n            this.$annotation.off();\n            this.stopListening(this.model);\n            Backbone.View.prototype.remove.call(this);\n        },\n\n        /** string rep */\n        toString: function() {\n            return [\"AnnotationEditor(\", `${this.model}`, \")\"].join(\"\");\n        }\n    });\n// =============================================================================\nexport default {\n    AnnotationEditor: AnnotationEditor\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"nametags\",attrs:{\"title\":_vm.title}},_vm._l((_vm.nameTags),function(tag){return _c('nametag',{key:tag,attrs:{\"tag\":tag}})}),1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametag.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametag.vue?vue&type=script&lang=js&\"","<template>\n    <span class=\"badge badge-tags\" :style=\"tagStyles\" @click.prevent=\"$emit('tag-click', tag)\"> {{ tagLabel }} </span>\n</template>\n\n<script>\nimport { keyedColorScheme } from \"utils/color\";\n\nexport default {\n    props: {\n        tag: { type: String, required: true }\n    },\n    computed: {\n        tagLabel() {\n            return this.tag.startsWith(\"name:\") ? this.tag.replace(\"name:\", \"\") : this.tag;\n        },\n        tagStyles() {\n            let { primary, contrasting, darker } = keyedColorScheme(this.tag);\n            return {\n                \"background-color\": primary,\n                color: contrasting,\n                \"border-color\": darker\n            };\n        }\n    }\n};\n</script>\n\n<style lang=\"scss\">\n.badge {\n    padding: 0.2em 0.6em 0.3em;\n    border-width: 1px;\n    border-style: solid;\n    border-radius: 0.15rem;\n    text-decoration: none;\n}\n</style>\n","import { render, staticRenderFns } from \"./Nametag.vue?vue&type=template&id=0aecc6f0&\"\nimport script from \"./Nametag.vue?vue&type=script&lang=js&\"\nexport * from \"./Nametag.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Nametag.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',{staticClass:\"badge badge-tags\",style:(_vm.tagStyles),on:{\"click\":function($event){$event.preventDefault();return _vm.$emit('tag-click', _vm.tag)}}},[_vm._v(\" \"+_vm._s(_vm.tagLabel)+\" \")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"nametags\" :title=\"title\"><nametag v-for=\"tag in nameTags\" :key=\"tag\" :tag=\"tag\" /></div>\n</template>\n\n<script>\nimport Nametag from \"./Nametag\";\nimport { mapActions } from \"vuex\";\n\nexport default {\n    components: {\n        Nametag\n    },\n    props: {\n        storeKey: { type: String, required: true },\n        tags: { type: Array, required: false, default: () => [] }\n    },\n    computed: {\n        // only display tags that start with name:\n        nameTags() {\n            return this.$store.getters.getTagsById(this.storeKey).filter(tag => tag.startsWith(\"name:\"));\n        },\n        title() {\n            return `${this.nameTags.length} nametags`;\n        }\n    },\n    methods: {\n        ...mapActions([\"updateTags\", \"initializeTags\"])\n    },\n    mounted() {\n        this.initializeTags({ key: this.storeKey, tags: this.tags });\n    }\n};\n</script>\n\n<style lang=\"scss\">\n.nametags:empty {\n    display: none;\n}\n\n.nametags .badge {\n    display: inline-block;\n    margin-right: 2px;\n}\n</style>\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametags.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametags.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Nametags.vue?vue&type=template&id=328f4e83&\"\nimport script from \"./Nametags.vue?vue&type=script&lang=js&\"\nexport * from \"./Nametags.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Nametags.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Nametags from \"./Nametags\";\nimport { mountVueComponent } from \"utils/mountVueComponent\";\n\nexport { default as Nametag } from \"./Nametag.vue\";\nexport { default as Nametags } from \"./Nametags.vue\";\nexport const mountNametags = mountVueComponent(Nametags);\n","//==============================================================================\n/** Map of possible HDA/collection/job states to their string equivalents.\n *      A port of galaxy.model.Dataset.states.\n */\nvar STATES = {\n    // NOT ready states\n    /** is uploading and not ready */\n    UPLOAD: \"upload\",\n    /** the job that will produce the dataset queued in the runner */\n    QUEUED: \"queued\",\n    /** the job that will produce the dataset is running */\n    RUNNING: \"running\",\n    /** metadata for the dataset is being discovered/set */\n    SETTING_METADATA: \"setting_metadata\",\n\n    // ready states\n    /** was created without a tool */\n    NEW: \"new\",\n    /** has no data */\n    EMPTY: \"empty\",\n    /** has successfully completed running */\n    OK: \"ok\",\n\n    /** the job that will produce the dataset paused */\n    PAUSED: \"paused\",\n    /** metadata discovery/setting failed or errored (but otherwise ok) */\n    FAILED_METADATA: \"failed_metadata\",\n    //TODO: not in trans.app.model.Dataset.states - is in database\n    /** not accessible to the current user (i.e. due to permissions) */\n    NOT_VIEWABLE: \"noPermission\",\n    /** deleted while uploading */\n    DISCARDED: \"discarded\",\n    /** the tool producing this dataset failed */\n    ERROR: \"error\"\n};\n\nSTATES.READY_STATES = [\n    STATES.OK,\n    STATES.EMPTY,\n    STATES.PAUSED,\n    STATES.FAILED_METADATA,\n    STATES.NOT_VIEWABLE,\n    STATES.DISCARDED,\n    STATES.ERROR\n];\n\nSTATES.NOT_READY_STATES = [STATES.UPLOAD, STATES.QUEUED, STATES.RUNNING, STATES.SETTING_METADATA, STATES.NEW];\n\n//==============================================================================\nexport default STATES;\n","//=============================================================================\n/**\n(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\nCopyright (c) 2011 Andrei Mackenzie\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\nSoftware.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// Compute the edit distance between the two given strings\n//exports.getEditDistance = function(a, b){\nfunction levenshteinDistance(a, b) {\n    if (a.length === 0) {\n        return b.length;\n    }\n    if (b.length === 0) {\n        return a.length;\n    }\n\n    var matrix = [];\n\n    // increment along the first column of each row\n    var i;\n    for (i = 0; i <= b.length; i++) {\n        matrix[i] = [i];\n    }\n\n    // increment each column in the first row\n    var j;\n    for (j = 0; j <= a.length; j++) {\n        matrix[0][j] = j;\n    }\n\n    // Fill in the rest of the matrix\n    for (i = 1; i <= b.length; i++) {\n        for (j = 1; j <= a.length; j++) {\n            if (b.charAt(i - 1) === a.charAt(j - 1)) {\n                matrix[i][j] = matrix[i - 1][j - 1];\n            } else {\n                matrix[i][j] = Math.min(\n                    matrix[i - 1][j - 1] + 1, // substitution\n                    Math.min(\n                        matrix[i][j - 1] + 1, // insertion\n                        matrix[i - 1][j] + 1\n                    )\n                ); // deletion\n            }\n        }\n    }\n\n    //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n    return matrix[b.length][a.length];\n}\n\n//=============================================================================\nexport default levenshteinDistance;\n","// Alphanumeric/natural sort fn\nfunction naturalSort(a, b) {\n    // setup temp-scope variables for comparison evauluation\n    var re = /(-?[0-9.]+)/g;\n\n    var x = a.toString().toLowerCase() || \"\";\n    var y = b.toString().toLowerCase() || \"\";\n    var nC = String.fromCharCode(0);\n    var xN = x.replace(re, `${nC}$1${nC}`).split(nC);\n    var yN = y.replace(re, `${nC}$1${nC}`).split(nC);\n    var xD = new Date(x).getTime();\n    var yD = xD ? new Date(y).getTime() : null;\n    // natural sorting of dates\n    if (yD) {\n        if (xD < yD) {\n            return -1;\n        } else if (xD > yD) {\n            return 1;\n        }\n    }\n\n    // natural sorting through split numeric strings and default strings\n    var oFxNcL;\n\n    var oFyNcL;\n    for (var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {\n        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n        if (oFxNcL < oFyNcL) {\n            return -1;\n        } else if (oFxNcL > oFyNcL) {\n            return 1;\n        }\n    }\n    return 0;\n}\n\nexport default naturalSort;\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport levenshteinDistance from \"utils/levenshtein\";\nimport naturalSort from \"utils/natural-sort\";\nimport baseCreator from \"mvc/collection/base-creator\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/hoverhighlight\";\n\nvar logNamespace = \"collections\";\n/* ============================================================================\nTODO:\n\n\nPROGRAMMATICALLY:\ncurrPanel.once( 'rendered', function(){\n    currPanel.showSelectors();\n    currPanel.selectAll();\n    _.last( currPanel.actionsPopup.options ).func();\n});\n\n============================================================================ */\n/** A view for paired datasets in the collections creator.\n */\nvar PairView = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    tagName: \"li\",\n    className: \"dataset paired\",\n\n    initialize: function(attributes) {\n        this.pair = attributes.pair || {};\n    },\n\n    template: _.template(\n        [\n            '<span class=\"forward-dataset-name flex-column\"><%- pair.forward.name %></span>',\n            '<span class=\"pair-name-column flex-column\">',\n            '<span class=\"pair-name\"><%- pair.name %></span>',\n            \"</span>\",\n            '<span class=\"reverse-dataset-name flex-column\"><%- pair.reverse.name %></span>'\n        ].join(\"\")\n    ),\n\n    render: function() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el\n            .attr(\"draggable\", true)\n            .data(\"pair\", this.pair)\n            .html(this.template({ pair: this.pair }))\n            .addClass(\"flex-column-container\")\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        return this;\n    },\n\n    events: {\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function(ev) {\n        ev.currentTarget.style.opacity = \"0.4\";\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.pair));\n\n        this.$el.parent().trigger(\"pair.dragstart\", [this]);\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragend: function(ev) {\n        ev.currentTarget.style.opacity = \"1.0\";\n        this.$el.parent().trigger(\"pair.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function() {\n        return `PairView(${this.pair.name})`;\n    }\n});\n\n// ============================================================================\n/** returns an autopair function that uses the provided options.match function */\nfunction autoPairFnBuilder(options) {\n    options = options || {};\n    options.createPair =\n        options.createPair ||\n        function _defaultCreatePair(params) {\n            params = params || {};\n            var a = params.listA.splice(params.indexA, 1)[0];\n            var b = params.listB.splice(params.indexB, 1)[0];\n            var aInBIndex = params.listB.indexOf(a);\n            var bInAIndex = params.listA.indexOf(b);\n            if (aInBIndex !== -1) {\n                params.listB.splice(aInBIndex, 1);\n            }\n            if (bInAIndex !== -1) {\n                params.listA.splice(bInAIndex, 1);\n            }\n            return this._pair(a, b, { silent: true });\n        };\n    // compile these here outside of the loop\n    var _regexps = [];\n    function getRegExps() {\n        if (!_regexps.length) {\n            _regexps = [new RegExp(this.filters[0]), new RegExp(this.filters[1])];\n        }\n        return _regexps;\n    }\n    // mangle params as needed\n    options.preprocessMatch =\n        options.preprocessMatch ||\n        function _defaultPreprocessMatch(params) {\n            var regexps = getRegExps.call(this);\n            return _.extend(params, {\n                matchTo: params.matchTo.name.replace(regexps[0], \"\"),\n                possible: params.possible.name.replace(regexps[1], \"\")\n            });\n        };\n\n    return function _strategy(params) {\n        this.debug(\"autopair _strategy ---------------------------\");\n        params = params || {};\n        var listA = params.listA;\n        var listB = params.listB;\n        var indexA = 0;\n        var indexB;\n\n        var bestMatch = {\n            score: 0.0,\n            index: null\n        };\n\n        var paired = [];\n        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n        this.debug(\"starting list lens:\", listA.length, listB.length);\n        this.debug(\"bestMatch (starting):\", JSON.stringify(bestMatch, null, \"  \"));\n\n        while (indexA < listA.length) {\n            var matchTo = listA[indexA];\n            bestMatch.score = 0.0;\n\n            for (indexB = 0; indexB < listB.length; indexB++) {\n                var possible = listB[indexB];\n                this.debug(`${indexA}:${matchTo.name}`);\n                this.debug(`${indexB}:${possible.name}`);\n\n                // no matching with self\n                if (listA[indexA] !== listB[indexB]) {\n                    bestMatch = options.match.call(\n                        this,\n                        options.preprocessMatch.call(this, {\n                            matchTo: matchTo,\n                            possible: possible,\n                            index: indexB,\n                            bestMatch: bestMatch\n                        })\n                    );\n                    this.debug(\"bestMatch:\", JSON.stringify(bestMatch, null, \"  \"));\n                    if (bestMatch.score === 1.0) {\n                        this.debug(\"breaking early due to perfect match\");\n                        break;\n                    }\n                }\n            }\n            var scoreThreshold = options.scoreThreshold.call(this);\n            this.debug(\"scoreThreshold:\", scoreThreshold);\n            this.debug(\"bestMatch.score:\", bestMatch.score);\n\n            if (bestMatch.score >= scoreThreshold) {\n                //console.debug( 'autoPairFnBuilder.strategy', listA[ indexA ].name, listB[ bestMatch.index ].name );\n                paired.push(\n                    options.createPair.call(this, {\n                        listA: listA,\n                        indexA: indexA,\n                        listB: listB,\n                        indexB: bestMatch.index\n                    })\n                );\n                //console.debug( 'list lens now:', listA.length, listB.length );\n            } else {\n                indexA += 1;\n            }\n            if (!listA.length || !listB.length) {\n                return paired;\n            }\n        }\n        this.debug(\"paired:\", JSON.stringify(paired, null, \"  \"));\n        this.debug(\"autopair _strategy ---------------------------\");\n        return paired;\n    };\n}\n\n// ============================================================================\n/** An interface for building collections of paired datasets.\n */\nvar PairedCollectionCreator = Backbone.View.extend(baseMVC.LoggableMixin)\n    .extend(baseCreator.CollectionCreatorMixin)\n    .extend({\n        _logNamespace: logNamespace,\n\n        className: \"list-of-pairs-collection-creator collection-creator flex-row-container\",\n\n        /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n        initialize: function(attributes) {\n            this.metric(\"PairedCollectionCreator.initialize\", attributes);\n            //this.debug( '-- PairedCollectionCreator:', attributes );\n\n            attributes = _.defaults(attributes, {\n                datasets: [],\n                filters: this.DEFAULT_FILTERS,\n                automaticallyPair: true,\n                strategy: \"lcs\",\n                matchPercentage: 0.9,\n                twoPassAutopairing: true\n            });\n\n            /** unordered, original list */\n            this.initialList = attributes.datasets;\n\n            /** is this from a history? if so, what's its id? */\n            this.historyId = attributes.historyId;\n\n            /** which filters should be used initially? (String[2] or name in commonFilters) */\n            this.filters = this.commonFilters[attributes.filters] || this.commonFilters[this.DEFAULT_FILTERS];\n            if (_.isArray(attributes.filters)) {\n                this.filters = attributes.filters;\n            }\n\n            /** try to auto pair the unpaired datasets on load? */\n            this.automaticallyPair = attributes.automaticallyPair;\n\n            /** what method to use for auto pairing (will be passed aggression level) */\n            this.strategy = this.strategies[attributes.strategy] || this.strategies[this.DEFAULT_STRATEGY];\n            if (_.isFunction(attributes.strategy)) {\n                this.strategy = attributes.strategy;\n            }\n\n            /** distance/mismatch level allowed for autopairing */\n            this.matchPercentage = attributes.matchPercentage;\n\n            /** try to autopair using simple first, then this.strategy on the remainder */\n            this.twoPassAutopairing = attributes.twoPassAutopairing;\n\n            /** remove file extensions (\\.*) from created pair names? */\n            this.removeExtensions = true;\n            //this.removeExtensions = false;\n\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            this.oncancel = attributes.oncancel;\n            /** fn to call when the collection is created (scoped to this) */\n            this.oncreate = attributes.oncreate;\n\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            this.autoscrollDist = attributes.autoscrollDist || 24;\n\n            /** is the unpaired panel shown? */\n            this.unpairedPanelHidden = false;\n            /** is the paired panel shown? */\n            this.pairedPanelHidden = false;\n\n            /** DOM elements currently being dragged */\n            this.$dragging = null;\n\n            /** Used for blocking UI events during ajax/operations (don't post twice) */\n            this.blocking = false;\n\n            this._setUpCommonSettings(attributes);\n            this._setUpBehaviors();\n            this._dataSetUp();\n        },\n\n        /** map of common filter pairs by name */\n        commonFilters: {\n            illumina: [\"_1\", \"_2\"],\n            Rs: [\"_R1\", \"_R2\"]\n        },\n        /** which commonFilter to use by default */\n        DEFAULT_FILTERS: \"illumina\",\n\n        /** map of name->fn for autopairing */\n        strategies: {\n            simple: \"autopairSimple\",\n            lcs: \"autopairLCS\",\n            levenshtein: \"autopairLevenshtein\"\n        },\n        /** default autopair strategy name */\n        DEFAULT_STRATEGY: \"lcs\",\n\n        // ------------------------------------------------------------------------ process raw list\n        /** set up main data: cache initialList, sort, and autopair */\n        _dataSetUp: function() {\n            //this.debug( '-- _dataSetUp' );\n\n            this.paired = [];\n            this.unpaired = [];\n\n            this.selectedIds = [];\n\n            // sort initial list, add ids if needed, and save new working copy to unpaired\n            this._sortInitialList();\n            this._ensureIds();\n            this.unpaired = this.initialList.slice(0);\n\n            if (this.automaticallyPair) {\n                this.autoPair();\n                this.once(\"rendered:initial\", function() {\n                    this.trigger(\"autopair\");\n                });\n            }\n        },\n\n        /** sort initial list */\n        _sortInitialList: function() {\n            //this.debug( '-- _sortInitialList' );\n            this._sortDatasetList(this.initialList);\n        },\n\n        /** sort a list of datasets */\n        _sortDatasetList: function(list) {\n            // currently only natural sort by name\n            list.sort((a, b) => naturalSort(a.name, b.name));\n            return list;\n        },\n\n        /** add ids to dataset objs in initial list if none */\n        _ensureIds: function() {\n            this.initialList.forEach(dataset => {\n                if (!dataset.hasOwnProperty(\"id\")) {\n                    dataset.id = _.uniqueId();\n                }\n            });\n            return this.initialList;\n        },\n\n        /** split initial list into two lists, those that pass forward filters & those passing reverse */\n        _splitByFilters: function() {\n            var regexFilters = this.filters.map(stringFilter => new RegExp(stringFilter));\n\n            var split = [[], []];\n\n            function _filter(unpaired, filter) {\n                return filter.test(unpaired.name);\n                //return dataset.name.indexOf( filter ) >= 0;\n            }\n            this.unpaired.forEach(function _filterEach(unpaired) {\n                // 90% of the time this seems to work, but:\n                //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n                //  would need explanation in help as well\n                regexFilters.forEach((filter, i) => {\n                    if (_filter(unpaired, filter)) {\n                        split[i].push(unpaired);\n                    }\n                });\n            });\n            return split;\n        },\n\n        /** add a dataset to the unpaired list in it's proper order */\n        _addToUnpaired: function(dataset) {\n            // currently, unpaired is natural sorted by name, use binary search to find insertion point\n            var binSearchSortedIndex = (low, hi) => {\n                if (low === hi) {\n                    return low;\n                }\n\n                var mid = Math.floor((hi - low) / 2) + low;\n\n                var compared = naturalSort(dataset.name, this.unpaired[mid].name);\n\n                if (compared < 0) {\n                    return binSearchSortedIndex(low, mid);\n                } else if (compared > 0) {\n                    return binSearchSortedIndex(mid + 1, hi);\n                }\n                // walk the equal to find the last\n                while (this.unpaired[mid] && this.unpaired[mid].name === dataset.name) {\n                    mid++;\n                }\n                return mid;\n            };\n\n            this.unpaired.splice(binSearchSortedIndex(0, this.unpaired.length), 0, dataset);\n        },\n\n        // ------------------------------------------------------------------------ auto pairing\n        /** two passes to automatically create pairs:\n         *  use both simpleAutoPair, then the fn mentioned in strategy\n         */\n        autoPair: function(strategy) {\n            // split first using exact matching\n            var split = this._splitByFilters();\n\n            var paired = [];\n            if (this.twoPassAutopairing) {\n                paired = this.autopairSimple({\n                    listA: split[0],\n                    listB: split[1]\n                });\n                split = this._splitByFilters();\n            }\n\n            // uncomment to see printlns while running tests\n            //this.debug = function(){ console.log.apply( console, arguments ); };\n\n            // then try the remainder with something less strict\n            strategy = strategy || this.strategy;\n            split = this._splitByFilters();\n            paired = paired.concat(\n                this[strategy].call(this, {\n                    listA: split[0],\n                    listB: split[1]\n                })\n            );\n            return paired;\n        },\n\n        /** autopair by exact match */\n        autopairSimple: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return 0.6;\n            },\n            match: function _match(params) {\n                params = params || {};\n                if (params.matchTo === params.possible) {\n                    return {\n                        index: params.index,\n                        score: 1.0\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** autopair by levenshtein edit distance scoring */\n        autopairLevenshtein: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return this.matchPercentage;\n            },\n            match: function _matches(params) {\n                params = params || {};\n\n                var distance = levenshteinDistance(params.matchTo, params.possible);\n\n                var score = 1.0 - distance / Math.max(params.matchTo.length, params.possible.length);\n\n                if (score > params.bestMatch.score) {\n                    return {\n                        index: params.index,\n                        score: score\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** autopair by longest common substrings scoring */\n        autopairLCS: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return this.matchPercentage;\n            },\n            match: function _matches(params) {\n                params = params || {};\n\n                var match = this._naiveStartingAndEndingLCS(params.matchTo, params.possible).length;\n\n                var score = match / Math.max(params.matchTo.length, params.possible.length);\n\n                if (score > params.bestMatch.score) {\n                    return {\n                        index: params.index,\n                        score: score\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** return the concat'd longest common prefix and suffix from two strings */\n        _naiveStartingAndEndingLCS: function(s1, s2) {\n            var fwdLCS = \"\";\n            var revLCS = \"\";\n            var i = 0;\n            var j = 0;\n            while (i < s1.length && i < s2.length) {\n                if (s1[i] !== s2[i]) {\n                    break;\n                }\n                fwdLCS += s1[i];\n                i += 1;\n            }\n            if (i === s1.length) {\n                return s1;\n            }\n            if (i === s2.length) {\n                return s2;\n            }\n\n            i = s1.length - 1;\n            j = s2.length - 1;\n            while (i >= 0 && j >= 0) {\n                if (s1[i] !== s2[j]) {\n                    break;\n                }\n                revLCS = [s1[i], revLCS].join(\"\");\n                i -= 1;\n                j -= 1;\n            }\n            return fwdLCS + revLCS;\n        },\n\n        // ------------------------------------------------------------------------ pairing / unpairing\n        /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n        _pair: function(fwd, rev, options) {\n            options = options || {};\n            this.debug(\"_pair:\", fwd, rev);\n            var pair = this._createPair(fwd, rev, options.name);\n            this.paired.push(pair);\n            this.unpaired = _.without(this.unpaired, fwd, rev);\n            if (!options.silent) {\n                this.trigger(\"pair:new\", pair);\n            }\n            return pair;\n        },\n\n        /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n        _createPair: function(fwd, rev, name) {\n            // ensure existance and don't pair something with itself\n            if (!(fwd && rev) || fwd === rev) {\n                throw new Error(`Bad pairing: ${[JSON.stringify(fwd), JSON.stringify(rev)]}`);\n            }\n            name = name || this._guessNameForPair(fwd, rev);\n            return { forward: fwd, name: name, reverse: rev };\n        },\n\n        /** try to find a good pair name for the given fwd and rev datasets */\n        _guessNameForPair: function(fwd, rev, removeExtensions) {\n            removeExtensions = removeExtensions !== undefined ? removeExtensions : this.removeExtensions;\n            var fwdName = fwd.name;\n            var revName = rev.name;\n\n            var lcs = this._naiveStartingAndEndingLCS(\n                fwdName.replace(new RegExp(this.filters[0]), \"\"),\n                revName.replace(new RegExp(this.filters[1]), \"\")\n            );\n\n            /** remove url prefix if files were uploaded by url */\n            var lastSlashIndex = lcs.lastIndexOf(\"/\");\n            if (lastSlashIndex > 0) {\n                var urlprefix = lcs.slice(0, lastSlashIndex + 1);\n                lcs = lcs.replace(urlprefix, \"\");\n                fwdName = fwdName.replace(extension, \"\");\n                revName = revName.replace(extension, \"\");\n            }\n\n            if (removeExtensions) {\n                var lastDotIndex = lcs.lastIndexOf(\".\");\n                if (lastDotIndex > 0) {\n                    var extension = lcs.slice(lastDotIndex, lcs.length);\n                    lcs = lcs.replace(extension, \"\");\n                    fwdName = fwdName.replace(extension, \"\");\n                    revName = revName.replace(extension, \"\");\n                }\n            }\n            return lcs || `${fwdName} & ${revName}`;\n        },\n\n        /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n        _unpair: function(pair, options) {\n            options = options || {};\n            if (!pair) {\n                throw new Error(`Bad pair: ${JSON.stringify(pair)}`);\n            }\n            this.paired = _.without(this.paired, pair);\n            this._addToUnpaired(pair.forward);\n            this._addToUnpaired(pair.reverse);\n\n            if (!options.silent) {\n                this.trigger(\"pair:unpair\", [pair]);\n            }\n            return pair;\n        },\n\n        /** unpair all paired datasets */\n        unpairAll: function() {\n            var pairs = [];\n            while (this.paired.length) {\n                pairs.push(this._unpair(this.paired[0], { silent: true }));\n            }\n            this.trigger(\"pair:unpair\", pairs);\n        },\n\n        // ------------------------------------------------------------------------ API\n        /** convert a pair into JSON compatible with the collections API */\n        _pairToJSON: function(pair) {\n            //TODO: consider making this the pair structure when created instead\n            return {\n                collection_type: \"paired\",\n                src: \"new_collection\",\n                name: pair.name,\n                element_identifiers: [\n                    {\n                        name: \"forward\",\n                        id: pair.forward.id,\n                        src: pair.forward.src || \"hda\"\n                    },\n                    {\n                        name: \"reverse\",\n                        id: pair.reverse.id,\n                        src: pair.reverse.src || \"hda\"\n                    }\n                ]\n            };\n        },\n\n        /** create the collection via the API\n         *  @returns {jQuery.xhr Object}    the jquery ajax request\n         */\n        createList: function(name) {\n            var self = this;\n\n            var url = `${getAppRoot()}api/histories/${this.historyId}/contents/dataset_collections`;\n\n            var ajaxData = {\n                type: \"dataset_collection\",\n                collection_type: \"list:paired\",\n                hide_source_items: self.hideOriginals || false,\n                copy_elements: self.copyElements,\n                name: _.escape(name || self.$(\".collection-name\").val()),\n                element_identifiers: self.paired.map(pair => self._pairToJSON(pair))\n            };\n            //this.debug( JSON.stringify( ajaxData ) );\n            self.blocking = true;\n            return $.ajax(url, {\n                type: \"POST\",\n                contentType: \"application/json\",\n                dataType: \"json\",\n                data: JSON.stringify(ajaxData)\n            })\n                .always(() => {\n                    self.blocking = false;\n                })\n                .fail((xhr, status, message) => {\n                    self._ajaxErrHandler(xhr, status, message);\n                })\n                .done(function(response, message, xhr) {\n                    //this.info( 'ok', response, message, xhr );\n                    self.trigger(\"collection:created\", response, message, xhr);\n                    self.metric(\"collection:created\", response);\n                    if (typeof self.oncreate === \"function\") {\n                        self.oncreate.call(this, response, message, xhr);\n                    }\n                });\n        },\n\n        /** handle ajax errors with feedback and details to the user (if available) */\n        _ajaxErrHandler: function(xhr, status, message) {\n            this.error(xhr, status, message);\n            var self = this;\n            var content = _l(\"An error occurred while creating this collection\");\n            if (xhr) {\n                if (xhr.readyState === 0 && xhr.status === 0) {\n                    content += `: ${_l(\"Galaxy could not be reached and may be updating.\")}${_l(\n                        \" Try again in a few minutes.\"\n                    )}`;\n                } else if (xhr.responseJSON) {\n                    content += `<br /><pre>${JSON.stringify(xhr.responseJSON)}</pre>`;\n                } else {\n                    content += `: ${message}`;\n                }\n            }\n            self._showAlert(content, \"alert-danger\");\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        /** render the entire interface */\n        render: function(speed, callback) {\n            //this.debug( '-- _render' );\n            //this.$el.empty().html( this.templates.main() );\n            this.$el.empty().html(this.templates.main());\n            this._renderHeader(speed);\n            this._renderMiddle(speed);\n            this._renderFooter(speed);\n            this._addPluginComponents();\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render the header section */\n        _renderHeader: function(speed, callback) {\n            //this.debug( '-- _renderHeader' );\n            var $header = this.$(\".header\")\n                .empty()\n                .html(this.templates.header())\n                .find(\".help-content\")\n                .prepend($(this.templates.helpContent()));\n\n            this._renderFilters();\n            return $header;\n        },\n        /** fill the filter inputs with the filter values */\n        _renderFilters: function() {\n            return this.$(\".forward-column .column-header input\")\n                .val(this.filters[0])\n                .add(this.$(\".reverse-column .column-header input\").val(this.filters[1]));\n        },\n\n        /** render the middle including unpaired and paired sections (which may be hidden) */\n        _renderMiddle: function(speed, callback) {\n            var $middle = this.$(\".middle\")\n                .empty()\n                .html(this.templates.middle());\n\n            // (re-) hide the un/paired panels based on instance vars\n            if (this.unpairedPanelHidden) {\n                this.$(\".unpaired-columns\").hide();\n            } else if (this.pairedPanelHidden) {\n                this.$(\".paired-columns\").hide();\n            }\n\n            this._renderUnpaired();\n            this._renderPaired();\n            return $middle;\n        },\n        /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n        _renderUnpaired: function(speed, callback) {\n            //this.debug( '-- _renderUnpaired' );\n            var self = this;\n\n            var $fwd;\n            var $rev;\n            var $prd = [];\n            var split = this._splitByFilters();\n            // update unpaired counts\n            this.$(\".forward-column .title\").text([split[0].length, _l(\"unpaired forward\")].join(\" \"));\n            this.$(\".forward-column .unpaired-info\").text(\n                this._renderUnpairedDisplayStr(this.unpaired.length - split[0].length)\n            );\n            this.$(\".reverse-column .title\").text([split[1].length, _l(\"unpaired reverse\")].join(\" \"));\n            this.$(\".reverse-column .unpaired-info\").text(\n                this._renderUnpairedDisplayStr(this.unpaired.length - split[1].length)\n            );\n\n            this.$(\".unpaired-columns .column-datasets\").empty();\n\n            // show/hide the auto pair button if any unpaired are left\n            this.$(\".autopair-link\").toggle(this.unpaired.length !== 0);\n            if (this.unpaired.length === 0) {\n                this._renderUnpairedEmpty();\n                return;\n            }\n\n            // create the dataset dom arrays\n            $rev = split[1].map((dataset, i) => {\n                // if there'll be a fwd dataset across the way, add a button to pair the row\n                if (split[0][i] !== undefined && split[0][i] !== dataset) {\n                    $prd.push(self._renderPairButton());\n                }\n                return self._renderUnpairedDataset(dataset);\n            });\n            $fwd = split[0].map(dataset => self._renderUnpairedDataset(dataset));\n\n            if (!$fwd.length && !$rev.length) {\n                this._renderUnpairedNotShown();\n                return;\n            }\n            // add to appropo cols\n            //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n            //  and swapping out that\n            this.$(\".unpaired-columns .forward-column .column-datasets\")\n                .append($fwd)\n                .add(this.$(\".unpaired-columns .paired-column .column-datasets\").append($prd))\n                .add(this.$(\".unpaired-columns .reverse-column .column-datasets\").append($rev));\n            this._adjUnpairedOnScrollbar();\n        },\n        /** return a string to display the count of filtered out datasets */\n        _renderUnpairedDisplayStr: function(numFiltered) {\n            return [\"(\", numFiltered, \" \", _l(\"filtered out\"), \")\"].join(\"\");\n        },\n        /** return an unattached jQuery DOM element to represent an unpaired dataset */\n        _renderUnpairedDataset: function(dataset) {\n            //TODO: to underscore template\n            return (\n                $(\"<li/>\")\n                    .attr(\"id\", `dataset-${dataset.id}`)\n                    .addClass(\"dataset unpaired\")\n                    .attr(\"draggable\", true)\n                    .addClass(dataset.selected ? \"selected\" : \"\")\n                    .append(\n                        $(\"<span/>\")\n                            .addClass(\"dataset-name\")\n                            .text(dataset.name)\n                    )\n                    //??\n                    .data(\"dataset\", dataset)\n            );\n        },\n        /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n        _renderPairButton: function() {\n            //TODO: *not* a dataset - don't pretend like it is\n            return $(\"<li/>\")\n                .addClass(\"dataset unpaired\")\n                .append(\n                    $(\"<span/>\")\n                        .addClass(\"dataset-name\")\n                        .text(_l(\"Pair these datasets\"))\n                );\n        },\n        /** a message to display when no unpaired left */\n        _renderUnpairedEmpty: function() {\n            //this.debug( '-- renderUnpairedEmpty' );\n            var $msg = $('<div class=\"empty-message\"></div>').text(`(${_l(\"no remaining unpaired datasets\")})`);\n            this.$(\".unpaired-columns .paired-column .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n        /** a message to display when no unpaired can be shown with the current filters */\n        _renderUnpairedNotShown: function() {\n            //this.debug( '-- renderUnpairedEmpty' );\n            var $msg = $('<div class=\"empty-message\"></div>').text(\n                `(${_l(\"no datasets were found matching the current filters\")})`\n            );\n            this.$(\".unpaired-columns .paired-column .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n        /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n        _adjUnpairedOnScrollbar: function() {\n            var $unpairedColumns = this.$(\".unpaired-columns\").last();\n\n            var $firstDataset = this.$(\".unpaired-columns .reverse-column .dataset\").first();\n\n            if (!$firstDataset.length) {\n                return;\n            }\n\n            var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth();\n\n            var dsRight = $firstDataset.offset().left + $firstDataset.outerWidth();\n\n            var rightDiff = Math.floor(ucRight) - Math.floor(dsRight);\n            //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n            this.$(\".unpaired-columns .forward-column\").css(\"margin-left\", rightDiff > 0 ? rightDiff : 0);\n        },\n\n        /** render the paired section and update counts of paired datasets */\n        _renderPaired: function(speed, callback) {\n            //this.debug( '-- _renderPaired' );\n            this.$(\".paired-column-title .title\").text([this.paired.length, _l(\"paired\")].join(\" \"));\n            // show/hide the unpair all link\n            this.$(\".unpair-all-link\").toggle(this.paired.length !== 0);\n            if (this.paired.length === 0) {\n                this._renderPairedEmpty();\n                return;\n                //TODO: would be best to return here (the $columns)\n            } else {\n                // show/hide 'remove extensions link' when any paired and they seem to have extensions\n                this.$(\".remove-extensions-link\").show();\n            }\n\n            this.$(\".paired-columns .column-datasets\").empty();\n            var self = this;\n            this.paired.forEach((pair, i) => {\n                //TODO: cache these?\n                var pairView = new PairView({ pair: pair });\n                self.$(\".paired-columns .column-datasets\")\n                    .append(pairView.render().$el)\n                    .append(\n                        [\n                            '<button class=\"unpair-btn\">',\n                            '<span class=\"fa fa-unlink\" title=\"',\n                            _l(\"Unpair\"),\n                            '\"></span>',\n                            \"</button>\"\n                        ].join(\"\")\n                    );\n            });\n        },\n        /** a message to display when none paired */\n        _renderPairedEmpty: function() {\n            var $msg = $('<div class=\"empty-message\"></div>').text(`(${_l(\"no paired datasets yet\")})`);\n            this.$(\".paired-columns .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n\n        footerSettings: {\n            \".hide-originals\": \"hideOriginals\",\n            \".remove-extensions\": \"removeExtensions\"\n        },\n\n        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n        _addPluginComponents: function() {\n            this._chooseFiltersPopover(\".choose-filters-link\");\n            this.$(\".help-content i\").hoverhighlight(\".collection-creator\", \"rgba( 64, 255, 255, 1.0 )\");\n        },\n\n        /** build a filter selection popover allowing selection of common filter pairs */\n        _chooseFiltersPopover: function(selector) {\n            function filterChoice(val1, val2) {\n                return [\n                    '<button class=\"filter-choice btn\" ',\n                    'data-forward=\"',\n                    val1,\n                    '\" data-reverse=\"',\n                    val2,\n                    '\">',\n                    _l(\"Forward\"),\n                    \": \",\n                    val1,\n                    \", \",\n                    _l(\"Reverse\"),\n                    \": \",\n                    val2,\n                    \"</button>\"\n                ].join(\"\");\n            }\n            var $popoverContent = $(\n                _.template(\n                    [\n                        '<div class=\"choose-filters\">',\n                        '<div class=\"help\">',\n                        _l(\"Choose from the following filters to change which unpaired reads are shown in the display\"),\n                        \":</div>\",\n                        _.values(this.commonFilters)\n                            .map(filterSet => filterChoice(filterSet[0], filterSet[1]))\n                            .join(\"\"),\n                        \"</div>\"\n                    ].join(\"\")\n                )({})\n            );\n\n            return this.$(selector).popover({\n                container: \".collection-creator\",\n                placement: \"bottom\",\n                html: true,\n                //animation   : false,\n                content: $popoverContent\n            });\n        },\n\n        /** add (or clear if clear is truthy) a validation warning to what */\n        _validationWarning: function(what, clear) {\n            var VALIDATION_CLASS = \"validation-warning\";\n            if (what === \"name\") {\n                what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n                this.$(\".collection-name\")\n                    .focus()\n                    .select();\n            }\n            if (clear) {\n                what = what || this.$(`.${VALIDATION_CLASS}`);\n                what.removeClass(VALIDATION_CLASS);\n            } else {\n                what.addClass(VALIDATION_CLASS);\n            }\n        },\n\n        // ------------------------------------------------------------------------ events\n        /** set up event handlers on self */\n        _setUpBehaviors: function() {\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this.on(\"pair:new\", function() {\n                //TODO: ideally only re-render the columns (or even elements) involved\n                this._renderUnpaired();\n                this._renderPaired();\n\n                // scroll to bottom where new pairs are added\n                //TODO: this doesn't seem to work - innerHeight sticks at 133...\n                //  may have to do with improper flex columns\n                //var $pairedView = this.$( '.paired-columns' );\n                //$pairedView.scrollTop( $pairedView.innerHeight() );\n                //this.debug( $pairedView.height() )\n                this.$(\".paired-columns\").scrollTop(8000000);\n            });\n            this.on(\"pair:unpair\", function(pairs) {\n                //TODO: ideally only re-render the columns (or even elements) involved\n                this._renderUnpaired();\n                this._renderPaired();\n                this.splitView();\n            });\n\n            this.on(\"filter-change\", function() {\n                this.filters = [\n                    this.$(\".forward-unpaired-filter input\").val(),\n                    this.$(\".reverse-unpaired-filter input\").val()\n                ];\n                this.metric(\"filter-change\", this.filters);\n                this._renderFilters();\n                this._renderUnpaired();\n            });\n\n            this.on(\"autopair\", function() {\n                this._renderUnpaired();\n                this._renderPaired();\n\n                var message;\n                var msgClass = null;\n                if (this.paired.length) {\n                    msgClass = \"alert-success\";\n                    message = `${this.paired.length} ${_l(\"pairs created\")}`;\n                    if (!this.unpaired.length) {\n                        message += `: ${_l(\"all datasets have been successfully paired\")}`;\n                        this.hideUnpaired();\n                        this.$(\".collection-name\").focus();\n                    }\n                } else {\n                    message = _l(\n                        [\n                            \"Could not automatically create any pairs from the given dataset names.\",\n                            \"You may want to choose or enter different filters and try auto-pairing again.\",\n                            \"Close this message using the X on the right to view more help.\"\n                        ].join(\" \")\n                    );\n                }\n                this._showAlert(message, msgClass);\n            });\n\n            //this.on( 'all', function(){\n            //    this.info( arguments );\n            //});\n            return this;\n        },\n\n        events: {\n            // header\n            \"click .more-help\": \"_clickMoreHelp\",\n            \"click .less-help\": \"_clickLessHelp\",\n            \"click .main-help\": \"_toggleHelp\",\n            \"click .header .alert button\": \"_hideAlert\",\n            \"click .forward-column .column-title\": \"_clickShowOnlyUnpaired\",\n            \"click .reverse-column .column-title\": \"_clickShowOnlyUnpaired\",\n            \"click .unpair-all-link\": \"_clickUnpairAll\",\n            //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n            \"change .forward-unpaired-filter input\": function(ev) {\n                this.trigger(\"filter-change\");\n            },\n            \"focus .forward-unpaired-filter input\": function(ev) {\n                $(ev.currentTarget).select();\n            },\n            \"click .autopair-link\": \"_clickAutopair\",\n            \"click .choose-filters .filter-choice\": \"_clickFilterChoice\",\n            \"click .clear-filters-link\": \"_clearFilters\",\n            \"change .reverse-unpaired-filter input\": function(ev) {\n                this.trigger(\"filter-change\");\n            },\n            \"focus .reverse-unpaired-filter input\": function(ev) {\n                $(ev.currentTarget).select();\n            },\n            // unpaired\n            \"click .forward-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n            \"click .reverse-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n            \"click .paired-column .dataset.unpaired\": \"_clickPairRow\",\n            \"click .unpaired-columns\": \"clearSelectedUnpaired\",\n            \"mousedown .unpaired-columns .dataset\": \"_mousedownUnpaired\",\n            // divider\n            \"click .paired-column-title\": \"_clickShowOnlyPaired\",\n            \"mousedown .flexible-partition-drag\": \"_startPartitionDrag\",\n            // paired\n            \"click .paired-columns .dataset.paired\": \"selectPair\",\n            \"click .paired-columns\": \"clearSelectedPaired\",\n            \"click .paired-columns .pair-name\": \"_clickPairName\",\n            \"click .unpair-btn\": \"_clickUnpair\",\n            // paired - drop target\n            //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n            //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n            \"dragover .paired-columns .column-datasets\": \"_dragoverPairedColumns\",\n            \"drop .paired-columns .column-datasets\": \"_dropPairedColumns\",\n\n            \"pair.dragstart .paired-columns .column-datasets\": \"_pairDragstart\",\n            \"pair.dragend   .paired-columns .column-datasets\": \"_pairDragend\",\n\n            // footer\n            \"change .remove-extensions\": function(ev) {\n                this.toggleExtensions();\n            },\n            \"change .collection-name\": \"_changeName\",\n            \"keydown .collection-name\": \"_nameCheckForEnter\",\n            \"change .hide-originals\": \"_changeHideOriginals\",\n            \"click .cancel-create\": \"_cancelCreate\",\n            \"click .create-collection\": \"_clickCreate\" //,\n        },\n\n        /** toggle between showing only unpaired and split view */\n        _clickShowOnlyUnpaired: function(ev) {\n            //this.debug( 'click unpaired', ev.currentTarget );\n            if (this.$(\".paired-columns\").is(\":visible\")) {\n                this.hidePaired();\n            } else {\n                this.splitView();\n            }\n        },\n        /** toggle between showing only paired and split view */\n        _clickShowOnlyPaired: function(ev) {\n            //this.debug( 'click paired' );\n            if (this.$(\".unpaired-columns\").is(\":visible\")) {\n                this.hideUnpaired();\n            } else {\n                this.splitView();\n            }\n        },\n\n        /** hide unpaired, show paired */\n        hideUnpaired: function(speed, callback) {\n            this.unpairedPanelHidden = true;\n            this.pairedPanelHidden = false;\n            this._renderMiddle(speed, callback);\n        },\n        /** hide paired, show unpaired */\n        hidePaired: function(speed, callback) {\n            this.unpairedPanelHidden = false;\n            this.pairedPanelHidden = true;\n            this._renderMiddle(speed, callback);\n        },\n        /** show both paired and unpaired (splitting evenly) */\n        splitView: function(speed, callback) {\n            this.unpairedPanelHidden = this.pairedPanelHidden = false;\n            this._renderMiddle(speed, callback);\n            return this;\n        },\n\n        /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n        _clickUnpairAll: function(ev) {\n            this.metric(\"unpairAll\");\n            this.unpairAll();\n        },\n\n        /** attempt to autopair */\n        _clickAutopair: function(ev) {\n            var paired = this.autoPair();\n            this.metric(\"autopair\", paired.length, this.unpaired.length);\n            this.trigger(\"autopair\");\n        },\n\n        /** set the filters based on the data attributes of the button click target */\n        _clickFilterChoice: function(ev) {\n            var $selected = $(ev.currentTarget);\n            this.$(\".forward-unpaired-filter input\").val($selected.data(\"forward\"));\n            this.$(\".reverse-unpaired-filter input\").val($selected.data(\"reverse\"));\n            this._hideChooseFilters();\n            this.trigger(\"filter-change\");\n        },\n\n        /** hide the choose filters popover */\n        _hideChooseFilters: function() {\n            //TODO: update bootstrap and remove the following hack\n            //  see also: https://github.com/twbs/bootstrap/issues/10260\n            this.$(\".choose-filters-link\").popover(\"hide\");\n            this.$(\".popover\").css(\"display\", \"none\");\n        },\n\n        /** clear both filters */\n        _clearFilters: function(ev) {\n            this.$(\".forward-unpaired-filter input\").val(\"\");\n            this.$(\".reverse-unpaired-filter input\").val(\"\");\n            this.trigger(\"filter-change\");\n        },\n\n        // ........................................................................ unpaired\n        /** select an unpaired dataset */\n        _clickUnpairedDataset: function(ev) {\n            ev.stopPropagation();\n            return this.toggleSelectUnpaired($(ev.currentTarget));\n        },\n\n        /** Toggle the selection of an unpaired dataset representation.\n         *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n         *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n         */\n        toggleSelectUnpaired: function($dataset, options) {\n            options = options || {};\n            var dataset = $dataset.data(\"dataset\");\n\n            var select = options.force !== undefined ? options.force : !$dataset.hasClass(\"selected\");\n\n            //this.debug( id, options.force, $dataset, dataset );\n            if (!$dataset.length || dataset === undefined) {\n                return $dataset;\n            }\n\n            if (select) {\n                $dataset.addClass(\"selected\");\n                if (!options.waitToPair) {\n                    this.pairAllSelected();\n                }\n            } else {\n                $dataset.removeClass(\"selected\");\n                //delete dataset.selected;\n            }\n            return $dataset;\n        },\n\n        /** pair all the currently selected unpaired datasets */\n        pairAllSelected: function(options) {\n            options = options || {};\n            var self = this;\n            var fwds = [];\n            var revs = [];\n            var pairs = [];\n            self.$(\".unpaired-columns .forward-column .dataset.selected\").each(function() {\n                fwds.push($(this).data(\"dataset\"));\n            });\n            self.$(\".unpaired-columns .reverse-column .dataset.selected\").each(function() {\n                revs.push($(this).data(\"dataset\"));\n            });\n            fwds.length = revs.length = Math.min(fwds.length, revs.length);\n            //this.debug( fwds );\n            //this.debug( revs );\n            fwds.forEach((fwd, i) => {\n                try {\n                    pairs.push(self._pair(fwd, revs[i], { silent: true }));\n                } catch (err) {\n                    //TODO: preserve selected state of those that couldn't be paired\n                    //TODO: warn that some could not be paired\n                    self.error(err);\n                }\n            });\n            if (pairs.length && !options.silent) {\n                this.trigger(\"pair:new\", pairs);\n            }\n            return pairs;\n        },\n\n        /** clear the selection on all unpaired datasets */\n        clearSelectedUnpaired: function() {\n            this.$(\".unpaired-columns .dataset.selected\").removeClass(\"selected\");\n        },\n\n        /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n        _mousedownUnpaired: function(ev) {\n            if (ev.shiftKey) {\n                var self = this;\n                var $startTarget = $(ev.target).addClass(\"selected\");\n\n                var moveListener = ev => {\n                    self.$(ev.target)\n                        .filter(\".dataset\")\n                        .addClass(\"selected\");\n                };\n\n                $startTarget.parent().on(\"mousemove\", moveListener);\n\n                // on any mouseup, stop listening to the move and try to pair any selected\n                $(document).one(\"mouseup\", ev => {\n                    $startTarget.parent().off(\"mousemove\", moveListener);\n                    self.pairAllSelected();\n                });\n            }\n        },\n\n        /** attempt to pair two datasets directly across from one another */\n        _clickPairRow: function(ev) {\n            //if( !ev.currentTarget ){ return true; }\n            var rowIndex = $(ev.currentTarget).index();\n\n            var fwd = $(\".unpaired-columns .forward-column .dataset\")\n                .eq(rowIndex)\n                .data(\"dataset\");\n\n            var rev = $(\".unpaired-columns .reverse-column .dataset\")\n                .eq(rowIndex)\n                .data(\"dataset\");\n\n            //this.debug( 'row:', rowIndex, fwd, rev );\n            this._pair(fwd, rev);\n        },\n\n        // ........................................................................ divider/partition\n        /** start dragging the visible divider/partition between unpaired and paired panes */\n        _startPartitionDrag: function(ev) {\n            var self = this;\n            var startingY = ev.pageY;\n            //this.debug( 'partition drag START:', ev );\n            $(\"body\").css(\"cursor\", \"ns-resize\");\n            self.$(\".flexible-partition-drag\").css(\"color\", \"black\");\n\n            function endDrag(ev) {\n                self.$(\".flexible-partition-drag\").css(\"color\", \"\");\n                $(\"body\")\n                    .css(\"cursor\", \"\")\n                    .unbind(\"mousemove\", trackMouse);\n            }\n            function trackMouse(ev) {\n                var offset = ev.pageY - startingY;\n                if (!self.adjPartition(offset)) {\n                    $(\"body\").trigger(\"mouseup\");\n                }\n                self._adjUnpairedOnScrollbar();\n                startingY += offset;\n            }\n            $(\"body\").mousemove(trackMouse);\n            $(\"body\").one(\"mouseup\", endDrag);\n        },\n\n        /** adjust the parition up/down +/-adj pixels */\n        adjPartition: function(adj) {\n            var $unpaired = this.$(\".unpaired-columns\");\n            var $paired = this.$(\".paired-columns\");\n            var unpairedHi = parseInt($unpaired.css(\"height\"), 10);\n            var pairedHi = parseInt($paired.css(\"height\"), 10);\n            //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\n            unpairedHi = Math.max(10, unpairedHi + adj);\n            pairedHi = pairedHi - adj;\n\n            var movingUpwards = adj < 0;\n            // when the divider gets close to the top - lock into hiding the unpaired section\n            if (movingUpwards) {\n                if (this.unpairedPanelHidden) {\n                    return false;\n                } else if (unpairedHi <= 10) {\n                    this.hideUnpaired();\n                    return false;\n                }\n            } else {\n                if (this.unpairedPanelHidden) {\n                    $unpaired.show();\n                    this.unpairedPanelHidden = false;\n                }\n            }\n\n            // when the divider gets close to the bottom - lock into hiding the paired section\n            if (!movingUpwards) {\n                if (this.pairedPanelHidden) {\n                    return false;\n                } else if (pairedHi <= 15) {\n                    this.hidePaired();\n                    return false;\n                }\n            } else {\n                if (this.pairedPanelHidden) {\n                    $paired.show();\n                    this.pairedPanelHidden = false;\n                }\n            }\n\n            $unpaired.css({\n                height: `${unpairedHi}px`,\n                flex: \"0 0 auto\"\n            });\n            return true;\n        },\n\n        // ........................................................................ paired\n        /** select a pair when clicked */\n        selectPair: function(ev) {\n            ev.stopPropagation();\n            $(ev.currentTarget).toggleClass(\"selected\");\n        },\n\n        /** deselect all pairs */\n        clearSelectedPaired: function(ev) {\n            this.$(\".paired-columns .dataset.selected\").removeClass(\"selected\");\n        },\n\n        /** rename a pair when the pair name is clicked */\n        _clickPairName: function(ev) {\n            ev.stopPropagation();\n            var $name = $(ev.currentTarget);\n            var $pair = $name.parent().parent();\n            var index = $pair.index(\".dataset.paired\");\n            var pair = this.paired[index];\n            var response = prompt(\"Enter a new name for the pair:\", pair.name);\n            if (response) {\n                pair.name = response;\n                // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n                //  when adding/removing extensions\n                //hackish\n                pair.customizedName = true;\n                $name.text(pair.name);\n            }\n        },\n\n        /** unpair this pair */\n        _clickUnpair: function(ev) {\n            //if( !ev.currentTarget ){ return true; }\n            var pairIndex = Math.floor($(ev.currentTarget).index(\".unpair-btn\"));\n            //this.debug( 'pair:', pairIndex );\n            this._unpair(this.paired[pairIndex]);\n        },\n\n        // ........................................................................ paired - drag and drop re-ordering\n        //_dragenterPairedColumns : function( ev ){\n        //    this.debug( '_dragenterPairedColumns:', ev );\n        //},\n        //_dragleavePairedColumns : function( ev ){\n        //    //this.debug( '_dragleavePairedColumns:', ev );\n        //},\n        /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n        _dragoverPairedColumns: function(ev) {\n            //this.debug( '_dragoverPairedColumns:', ev );\n            ev.preventDefault();\n\n            var $list = this.$(\".paired-columns .column-datasets\");\n            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n            //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n\n            $(\".element-drop-placeholder\").remove();\n            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n            if (!$nearest.length) {\n                $list.append($placeholder);\n            } else {\n                $nearest.before($placeholder);\n            }\n        },\n\n        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n        _checkForAutoscroll: function($element, y) {\n            var AUTOSCROLL_SPEED = 2;\n            var offset = $element.offset();\n            var scrollTop = $element.scrollTop();\n            var upperDist = y - offset.top;\n            var lowerDist = offset.top + $element.outerHeight() - y;\n            //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n            }\n        },\n\n        /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n         *      If the y is at the end of the list, return an empty jQuery object.\n         */\n        _getNearestPairedDatasetLi: function(y) {\n            var WIGGLE = 4;\n            var lis = this.$(\".paired-columns .column-datasets li\").toArray();\n            for (var i = 0; i < lis.length; i++) {\n                var $li = $(lis[i]);\n                var top = $li.offset().top;\n                var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n                if (top + halfHeight > y && top - halfHeight < y) {\n                    //this.debug( y, top + halfHeight, top - halfHeight )\n                    return $li;\n                }\n            }\n            return $();\n        },\n        /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n        _dropPairedColumns: function(ev) {\n            // both required for firefox\n            ev.preventDefault();\n            ev.dataTransfer.dropEffect = \"move\";\n\n            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n            if ($nearest.length) {\n                this.$dragging.insertBefore($nearest);\n            } else {\n                // no nearest before - insert after last element (unpair button)\n                this.$dragging.insertAfter(this.$(\".paired-columns .unpair-btn\").last());\n            }\n            // resync the creator's list of paired based on the new DOM order\n            this._syncPairsToDom();\n            return false;\n        },\n        /** resync the creator's list of paired based on the DOM order of pairs */\n        _syncPairsToDom: function() {\n            var newPaired = [];\n            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n            this.$(\".paired-columns .dataset.paired\").each(function() {\n                newPaired.push($(this).data(\"pair\"));\n            });\n            //this.debug( newPaired );\n            this.paired = newPaired;\n            this._renderPaired();\n        },\n        /** drag communication with pair sub-views: dragstart */\n        _pairDragstart: function(ev, pair) {\n            //this.debug( '_pairDragstart', ev, pair )\n            // auto select the pair causing the event and move all selected\n            pair.$el.addClass(\"selected\");\n            var $selected = this.$(\".paired-columns .dataset.selected\");\n            this.$dragging = $selected;\n        },\n        /** drag communication with pair sub-views: dragend - remove the placeholder */\n        _pairDragend: function(ev, pair) {\n            //this.debug( '_pairDragend', ev, pair )\n            $(\".element-drop-placeholder\").remove();\n            this.$dragging = null;\n        },\n\n        // ........................................................................ footer\n        toggleExtensions: function(force) {\n            var self = this;\n            self.removeExtensions = force !== undefined ? force : !self.removeExtensions;\n\n            _.each(self.paired, pair => {\n                // don't overwrite custom names\n                if (pair.customizedName) {\n                    return;\n                }\n                pair.name = self._guessNameForPair(pair.forward, pair.reverse);\n            });\n\n            self._renderPaired();\n            self._renderFooter();\n        },\n\n        // ------------------------------------------------------------------------ misc\n        /** debug a dataset list */\n        _printList: function(list) {\n            var self = this;\n            _.each(list, e => {\n                if (list === self.paired) {\n                    self._printPair(e);\n                } else {\n                    self.debug(e);\n                }\n            });\n        },\n\n        /** print a pair Object */\n        _printPair: function(pair) {\n            this.debug(pair.forward.name, pair.reverse.name, \": ->\", pair.name);\n        },\n\n        /** string rep */\n        toString: function() {\n            return \"PairedCollectionCreator\";\n        },\n\n        templates: _.extend({}, baseCreator.CollectionCreatorMixin._creatorTemplates, {\n            /** the header (not including help text) */\n            header: _.template(\n                [\n                    '<div class=\"main-help well clear\">',\n                    '<a class=\"more-help\" href=\"javascript:void(0);\">',\n                    _l(\"More help\"),\n                    \"</a>\",\n                    '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">',\n                    _l(\"Less\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"alert alert-dismissable\">',\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>',\n                    '<span class=\"alert-message\"></span>',\n                    \"</div>\",\n\n                    '<div class=\"column-headers vertically-spaced flex-column-container\">',\n                    '<div class=\"forward-column flex-column column\">',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                    '<span class=\"title\">',\n                    _l(\"Unpaired forward\"),\n                    \"</span>\",\n                    '<span class=\"title-info unpaired-info\"></span>',\n                    \"</div>\",\n                    '<div class=\"unpaired-filter forward-unpaired-filter float-left\">',\n                    '<input class=\"search-query\" placeholder=\"',\n                    _l(\"Filter this list\"),\n                    '\" />',\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"paired-column flex-column no-flex column\">',\n                    '<div class=\"column-header\">',\n                    '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">',\n                    _l(\"Choose filters\"),\n                    \"</a>\",\n                    '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">',\n                    _l(\"Clear filters\"),\n                    \"</a><br />\",\n                    '<a class=\"autopair-link\" href=\"javascript:void(0);\">',\n                    _l(\"Auto-pair\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"reverse-column flex-column column\">',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                    '<span class=\"title\">',\n                    _l(\"Unpaired reverse\"),\n                    \"</span>\",\n                    '<span class=\"title-info unpaired-info\"></span>',\n                    \"</div>\",\n                    '<div class=\"unpaired-filter reverse-unpaired-filter float-left\">',\n                    '<input class=\"search-query\" placeholder=\"',\n                    _l(\"Filter this list\"),\n                    '\" />',\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** the middle: unpaired, divider, and paired */\n            middle: _.template(\n                [\n                    // contains two flex rows (rows that fill available space) and a divider btwn\n                    '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">',\n                    '<div class=\"forward-column flex-column column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    '<div class=\"paired-column flex-column no-flex column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    '<div class=\"reverse-column flex-column column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"flexible-partition\">',\n                    '<div class=\"flexible-partition-drag\" title=\"',\n                    _l(\"Drag to change\"),\n                    '\"></div>',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title paired-column-title\">',\n                    '<span class=\"title\"></span>',\n                    \"</div>\",\n                    '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">',\n                    _l(\"Unpair all\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"paired-columns flex-column-container scroll-container flex-row\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** creation and cancel controls */\n            footer: _.template(\n                [\n                    '<div class=\"attributes clear\">',\n                    '<div class=\"clear\">',\n                    '<label class=\"setting-prompt float-right\">',\n                    _l(\"Hide original elements\"),\n                    \"?\",\n                    '<input class=\"hide-originals float-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    '<label class=\"setting-prompt float-right\">',\n                    _l(\"Remove file extensions from pair names\"),\n                    \"?\",\n                    '<input class=\"remove-extensions float-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    \"</div>\",\n                    '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control float-right\" ',\n                    'placeholder=\"',\n                    _l(\"Enter a name for your new list\"),\n                    '\" />',\n                    '<div class=\"collection-name-prompt float-right\">',\n                    _l(\"Name\"),\n                    \":</div>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options float-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"Create a different kind of collection\"),\n                    ' <span class=\"caret\"></span>',\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<li><a href=\"#\">',\n                    _l(\"Create a <i>single</i> pair\"),\n                    \"</a></li>\",\n                    '<li><a href=\"#\">',\n                    _l(\"Create a list of <i>unpaired</i> datasets\"),\n                    \"</a></li>\",\n                    \"</ul>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"main-options float-right\">',\n                    '<button class=\"create-collection btn btn-primary\">',\n                    _l(\"Create list\"),\n                    \"</button>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** help content */\n            helpContent: _.template(\n                [\n                    \"<p>\",\n                    _l(\n                        [\n                            \"Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). \",\n                            \"These collections can be passed to tools and workflows in order to have analyses done on each member of \",\n                            \"the entire group. This interface allows you to create a collection, choose which datasets are paired, \",\n                            \"and re-order the final collection.\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ',\n                            \"(hover over the underlined words to highlight below). \",\n                            'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.',\n                            \"<ul>To pair datasets, you can:\",\n                            \"<li>Click a dataset in the \",\n                            '<i data-target=\".unpaired-columns .forward-column .column-datasets,',\n                            '.unpaired-columns .forward-column\">forward column</i> ',\n                            \"to select it then click a dataset in the \",\n                            '<i data-target=\".unpaired-columns .reverse-column .column-datasets,',\n                            '.unpaired-columns .reverse-column\">reverse column</i>.',\n                            \"</li>\",\n                            '<li>Click one of the \"Pair these datasets\" buttons in the ',\n                            '<i data-target=\".unpaired-columns .paired-column .column-datasets,',\n                            '.unpaired-columns .paired-column\">middle column</i> ',\n                            \"to pair the datasets in a particular row.\",\n                            \"</li>\",\n                            '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ',\n                            \"to have your datasets automatically paired based on name.\",\n                            \"</li>\",\n                            \"</ul>\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            \"<ul>You can filter what is shown in the unpaired sections by:\",\n                            \"<li>Entering partial dataset names in either the \",\n                            '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ',\n                            '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.',\n                            \"</li>\",\n                            \"<li>Choosing from a list of preset filters by clicking the \",\n                            '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.',\n                            \"</li>\",\n                            \"<li>Entering regular expressions to match dataset names. See: \",\n                            '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"',\n                            ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ',\n                            \"Note: forward slashes (\\\\) are not needed.\",\n                            \"</li>\",\n                            \"<li>Clearing the filters by clicking the \",\n                            '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.',\n                            \"</li>\",\n                            \"</ul>\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            \"To unpair individual dataset pairs, click the \",\n                            '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ',\n                            'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ',\n                            '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                            'click <i data-target=\".create-collection\">\"Create list\"</i>. ',\n                            \"(Note: you do not have to pair all unpaired datasets to finish.)\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\"\n                ].join(\"\")\n            )\n        })\n    });\n\n//=============================================================================\n/** a modal version of the paired collection creator */\nvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal(datasets, options) {\n    var Galaxy = getGalaxyInstance();\n    var deferred = $.Deferred();\n    var creator;\n\n    options = _.defaults(options || {}, {\n        datasets: datasets,\n        oncancel: function() {\n            Galaxy.modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function(creator, response) {\n            Galaxy.modal.hide();\n            deferred.resolve(response);\n        },\n        title: _l(\"Create a collection of paired datasets\")\n    });\n\n    if (!Galaxy || !Galaxy.modal) {\n        throw new Error(\"Galaxy or Galaxy.modal not found\");\n    }\n\n    creator = new PairedCollectionCreator(options);\n    Galaxy.modal.show({\n        title: options.title,\n        body: creator.$el,\n        width: \"80%\",\n        height: \"800px\",\n        closing_events: true\n    });\n    creator.render();\n    window.creator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n//=============================================================================\nfunction createListOfPairsCollection(collection, defaultHideSourceItems) {\n    var elements = collection.toJSON();\n    //TODO: validate elements\n    return pairedCollectionCreatorModal(elements, {\n        historyId: collection.historyId,\n        defaultHideSourceItems: defaultHideSourceItems,\n        copyElements: !defaultHideSourceItems\n    });\n}\n\n//=============================================================================\nexport default {\n    PairedCollectionCreator: PairedCollectionCreator,\n    pairedCollectionCreatorModal: pairedCollectionCreatorModal,\n    createListOfPairsCollection: createListOfPairsCollection\n};\n","/**\n *  This is the primary galaxy tours definition, currently only used for\n *  rendering a tour menu.\n */\nimport _l from \"utils/localization\";\n// The following must remain staged out of libs and not sourced from\n// node_modules, until TDTs are bundled.\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport \"libs/bootstrap-tour\";\n\n// bootstrap-tour configures a window.Tour object; keep a local ref.\nlet Tour = window.Tour;\n\n// For buttons to show, we need to add them to bootstrap/popper's sanitizing filters.\n$.fn.tooltip.Constructor.Default.whiteList.button = [\"data-role\"];\n\nvar gxy_root = getAppRoot();\n\nconst TOURPAGE_TEMPLATE = `\n    <h2>Galaxy Tours</h2>\n    <p>This page presents a list of interactive tours available on this Galaxy server.\n    Select any tour to get started (and remember, you can click 'End Tour' at any time).</p>\n\n<div class=\"row mb-3\">\n    <div class=\"col-12 btn-group\" role=\"group\" aria-label=\"Tag selector\">\n        <% _.each(tourtagorder, function(tag) { %>\n        <button class=\"btn btn-primary tag-selector-button\" tag-selector-button=\"<%- tag.key %>\">\n            <%- tag.name %>\n        </button>\n        <% }); %>\n    </div>\n</div>\n\n<div class=\"row mb-3\">\n    <div class=\"col-12\">\n    <h4>Tours</h4>\n    <ul class=\"list-group\">\n    <% _.each(tours, function(tour) { %>\n        <li class=\"list-group-item\" tags=\"<%- tour.attributes.tags_lc %>\">\n            <a href=\"/tours/<%- tour.id %>\" class=\"tourItem\" data-tour.id=<%- tour.id %>>\n                <%- tour.attributes.name || tour.id %>\n            </a>\n             - <%- tour.attributes.description || \"No description given.\" %>\n             <% _.each(tour.attributes.tags, function(tag) { %>\n                <span class=\"badge badge-primary\">\n                    <%- tag.charAt(0).toUpperCase() + tag.slice(1) %>\n                </span>\n             <% }); %>\n        </li>\n    <% }); %>\n    </ul>\n    </div>\n</div>`;\n\nvar tour_opts = {\n    storage: window.sessionStorage,\n    onEnd: function() {\n        window.sessionStorage.removeItem(\"activeGalaxyTour\");\n    },\n    delay: 150, // Attempts to make it look natural\n    orphan: true\n};\n\nvar hooked_tour_from_data = data => {\n    _.each(data.steps, step => {\n        if (step.preclick) {\n            step.onShow = () => {\n                _.each(step.preclick, preclick => {\n                    // TODO: click delay between clicks\n                    $(preclick).click();\n                });\n            };\n        }\n        if (step.postclick) {\n            step.onHide = () => {\n                _.each(step.postclick, postclick => {\n                    // TODO: click delay between clicks\n                    $(postclick).click();\n                });\n            };\n        }\n        if (step.textinsert) {\n            // Have to manually trigger a change here, for some\n            // elements which have additional logic, like the\n            // upload input box\n            step.onShown = () => {\n                $(step.element)\n                    .val(step.textinsert)\n                    .trigger(\"change\");\n            };\n        }\n        if (step.path) {\n            // Galaxy does *not* support automagic path navigation right now in\n            // Tours -- too many ways to get your client 'stuck' in automatic\n            // navigation loops.  We can probably re-enable this as our client\n            // routing matures.\n            console.warn(\n                \"This Galaxy Tour is attempting to use path navigation.  This is known to be unstable and can possibly get the Galaxy client 'stuck' in a tour, and at this time is not allowed.\"\n            );\n            delete step.path;\n        }\n    });\n    return data;\n};\n\nvar TourItem = Backbone.Model.extend({\n    urlRoot: `${gxy_root}api/tours`\n});\n\nvar Tours = Backbone.Collection.extend({\n    url: `${gxy_root}api/tours`,\n    model: TourItem\n});\n\nexport var ToursView = Backbone.View.extend({\n    title: _l(\"Tours\"),\n    initialize: function() {\n        var self = this;\n        this.setElement(\"<div/>\");\n        this.model = new Tours();\n        this.model.fetch({\n            success: function() {\n                self.render();\n            },\n            error: function() {\n                // Do something.\n                console.error(\"Failed to fetch tours.\");\n            }\n        });\n    },\n\n    render: function() {\n        var tpl = _.template(TOURPAGE_TEMPLATE);\n\n        var tourtags = {};\n        _.each(this.model.models, tour => {\n            tour.attributes.tags_lc = [];\n            if (tour.attributes.tags === null) {\n                if (tourtags.Untagged === undefined) {\n                    tourtags.Untagged = { name: \"Untagged\", tours: [] };\n                }\n                tourtags.Untagged.tours.push(tour);\n            } else {\n                _.each(tour.attributes.tags, otag => {\n                    var tag = otag.charAt(0).toUpperCase() + otag.slice(1);\n                    if (tourtags[tag] === undefined) {\n                        tourtags[tag] = { name: tag, tours: [] };\n                    }\n                    tour.attributes.tags_lc.push(otag.toLowerCase());\n                    tourtags[tag].tours.push(tour);\n                });\n            }\n        });\n        //var tourtagorder = Object.keys(tourtags).sort();\n        var tourtagorder = [];\n        Object.keys(tourtags).forEach(function(tag, index) {\n            tourtagorder.push({ name: tag, key: tag.toLowerCase() });\n        });\n\n        this.$el\n            .html(\n                tpl({\n                    tours: this.model.models,\n                    tourtags: tourtags,\n                    tourtagorder: tourtagorder\n                })\n            )\n            .on(\"click\", \".tourItem\", function(e) {\n                e.preventDefault();\n                giveTourById($(this).data(\"tour.id\"));\n            })\n            .on(\"click\", \".tag-selector-button\", e => {\n                var elem = $(e.target);\n                var active_tags = [];\n\n                // Switch classes for the buttons\n                elem.toggleClass(\"btn-primary\");\n                elem.toggleClass(\"btn-secondary\");\n\n                // Get all non-disabled tags\n                $(`.tag-selector-button.btn-primary`).each(function() {\n                    active_tags.push($(this).attr(\"tag-selector-button\"));\n                });\n\n                // Loop over all list items, subsequently determine these are\n                // only the tours (tags should be unique). Then use the non-disabled tags to\n                // determien whether or not to display this specific tour.\n                $(`li.list-group-item`).each(function() {\n                    if ($(this).attr(\"tags\")) {\n                        var tour_tags = [];\n                        var tour_tags_html = $(this).attr(\"tags\");\n\n                        tour_tags = tour_tags_html.split(\",\");\n                        var fil_tour_tags = tour_tags.filter(function(tag) {\n                            return active_tags.indexOf(tag.toLowerCase()) > -1;\n                        });\n\n                        $(this).css(\"display\", fil_tour_tags.length > 0 ? \"block\" : \"none\");\n                    }\n                });\n            });\n    }\n});\n\nexport function giveTourWithData(data) {\n    let hookedTourData = hooked_tour_from_data(data);\n    window.sessionStorage.setItem(\"activeGalaxyTour\", JSON.stringify(data));\n    // Store tour steps in sessionStorage to easily persist w/o hackery.\n    let tour = new Tour(_.extend({ steps: hookedTourData.steps }, tour_opts));\n    // Always clean restart, since this is a new, explicit execution.\n    tour.init();\n    tour.goTo(0);\n    tour.restart();\n    return tour;\n}\n\nexport function giveTourById(tour_id) {\n    var url = `${gxy_root}api/tours/${tour_id}`;\n    $.getJSON(url, data => {\n        giveTourWithData(data);\n    });\n}\n\nexport function activeGalaxyTourRunner() {\n    var et = JSON.parse(window.sessionStorage.getItem(\"activeGalaxyTour\"));\n    if (et) {\n        et = hooked_tour_from_data(et);\n        if (et && et.steps) {\n            if (window && window.self === window.top) {\n                // Only kick off a new tour if this is the toplevel window (non-iframe).  This\n                // functionality actually *could* be useful, but we'd need to handle it better and\n                // come up with some design guidelines for tours jumping between windows.\n                // Disabling for now.\n                var tour = new Tour(\n                    _.extend(\n                        {\n                            steps: et.steps\n                        },\n                        tour_opts\n                    )\n                );\n                tour.init();\n                tour.restart();\n            }\n        }\n    }\n}\n\nexport default {\n    ToursView: ToursView,\n    giveTourWithData: giveTourWithData,\n    giveTourById: giveTourById,\n    activeGalaxyTourRunner: activeGalaxyTourRunner\n};\n","/** Real-time Communication feature **/\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport { getGalaxyInstance } from \"app\";\n\nexport var CommunicationServerView = Backbone.View.extend({\n    initialize: function() {\n        this.modal = null;\n    },\n\n    /** makes bootstrap modal and iframe inside it */\n    makeModalIframe: function(e) {\n        let Galaxy = getGalaxyInstance();\n        // make modal\n        var host = Galaxy.config.communication_server_host;\n\n        var port = Galaxy.config.communication_server_port;\n        var username = _.escape(Galaxy.user.attributes.username);\n\n        var persistent_communication_rooms = _.escape(Galaxy.config.persistent_communication_rooms);\n\n        var query_string = `?username=${username}&persistent_communication_rooms=${persistent_communication_rooms}`;\n\n        var src = `${host}:${port}${query_string}`;\n        var $el_chat_modal_header = null;\n        var $el_chat_modal_body = null;\n\n        var iframe_template = `<iframe class=\"h-100 w-100\" src=\"${src}\"> </iframe>`;\n\n        var header_template =\n            '<i class=\"fa fa-comment\" aria-hidden=\"true\" title=\"Communicate with other users\"></i>' +\n            '<i class=\"fa fa-expand expand-compress-modal\" aria-hidden=\"true\" title=\"Maximize\"></i>' +\n            '<i class=\"fa fa-times close-modal\" aria-hidden=\"true\" title=\"Close\"></i>';\n\n        var frame_height = 350;\n        var frame_width = 600;\n        var class_names = \"ui-modal chat-modal\";\n\n        // deletes the chat modal if already present and create one\n        if ($(\".chat-modal\").length > 0) {\n            $(\".chat-modal\").remove();\n        }\n        // creates a modal\n        CommunicationServerView.modal = new Modal.View({\n            body: iframe_template,\n            height: frame_height,\n            width: frame_width,\n            closing_events: true,\n            title_separator: false,\n            cls: class_names\n        });\n\n        // shows modal\n        CommunicationServerView.modal.show();\n        $el_chat_modal_header = $(\".chat-modal .modal-header\");\n        $el_chat_modal_body = $(\".chat-modal .modal-body\");\n        // adjusts the css of bootstrap modal for chat\n        $el_chat_modal_header.addClass(\"modal-header-body\");\n        $el_chat_modal_body.addClass(\"modal-header-body\");\n        $el_chat_modal_header.find(\"h4\").remove();\n        $el_chat_modal_header.removeAttr(\"min-height padding border\");\n        $el_chat_modal_header.append(header_template);\n        // click event of the close button for chat\n        $(\".close-modal\").click(e => {\n            $(\".chat-modal\").css(\"display\", \"none\");\n        });\n        // click event of expand and compress icon\n        $(\".expand-compress-modal\").click(e => {\n            if ($(\".expand-compress-modal\").hasClass(\"fa-expand\")) {\n                $(\".chat-modal .modal-dialog\").width(\"1000px\");\n                $(\".chat-modal .modal-body\").height(\"575px\");\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-expand\")\n                    .addClass(\"fa-compress\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Minimize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"96.2%\");\n            } else {\n                $(\".chat-modal .modal-dialog\").width(`${frame_width}px`);\n                $(\".chat-modal .modal-body\").height(`${frame_height}px`);\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-compress\")\n                    .addClass(\"fa-expand\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Maximize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"93.2%\");\n            }\n        });\n        return this;\n    },\n\n    /**renders the chat icon as a nav item*/\n    render: function() {\n        var self = this;\n        var navItem = {};\n        navItem = {\n            id: \"show-chat-online\",\n            icon: \"fa-comment-o\",\n            tooltip: _l(\"Chat online\"),\n            visible: false,\n            onclick: self.makeModalIframe\n        };\n        return navItem;\n    }\n});\n","/** Masthead Collection **/\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport axios from \"axios\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport { CommunicationServerView } from \"layout/communication-server-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport Utils from \"utils/utils\";\n\nfunction logoutClick() {\n    let galaxy = getGalaxyInstance();\n    let session_csrf_token = galaxy.session_csrf_token;\n    let url = `${galaxy.root}user/logout?session_csrf_token=${session_csrf_token}`;\n    axios.get(url).then(() => {\n        if (galaxy.user) {\n            galaxy.user.clearSessionStorage();\n        }\n        window.top.location.href = `${galaxy.root}login`;\n    });\n}\n\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function(options) {\n        options = options || {};\n        this.reset();\n\n        let Galaxy = getGalaxyInstance();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new CommunicationServerView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: _l(\"Analyze Data\"),\n            url: \"\",\n            tooltip: _l(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: _l(\"Workflow\"),\n            tooltip: _l(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflows/list\",\n            target: \"__use_router__\"\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: _l(\"Visualize\"),\n            tooltip: _l(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [\n                {\n                    title: _l(\"Create Visualization\"),\n                    url: \"visualizations\",\n                    target: \"__use_router__\"\n                },\n                {\n                    title: _l(\"Interactive Environments\"),\n                    url: \"visualization/gie_list\",\n                    target: \"galaxy_main\"\n                }\n            ]\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: _l(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: _l(\"Access published resources\"),\n            menu: [\n                {\n                    title: _l(\"Data Libraries\"),\n                    url: \"library/list\"\n                },\n                {\n                    title: _l(\"Histories\"),\n                    url: \"histories/list_published\",\n                    target: \"__use_router__\"\n                },\n                {\n                    title: _l(\"Workflows\"),\n                    url: \"workflows/list_published\",\n                    target: \"__use_router__\"\n                },\n                {\n                    title: _l(\"Visualizations\"),\n                    url: \"visualizations/list_published\",\n                    target: \"__use_router__\"\n                },\n                {\n                    title: _l(\"Pages\"),\n                    url: \"pages/list_published\",\n                    target: \"__use_router__\"\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.load({\n            type: \"masthead\",\n            callback: function(webhooks) {\n                $(document).ready(() => {\n                    webhooks.each(model => {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.id,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                /*jslint evil: true */\n                                onclick: webhook.config.function && new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            let Galaxy = getGalaxyInstance();\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        if (Galaxy.user.get(\"is_admin\")) {\n            this.add({\n                id: \"admin\",\n                title: _l(\"Admin\"),\n                url: \"admin\",\n                tooltip: _l(\"Administer this Galaxy\"),\n                cls: \"admin-only\"\n            });\n        }\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: _l(\"Help\"),\n            tooltip: _l(\"Support, contact, and community\"),\n            menu: [\n                {\n                    title: _l(\"Support\"),\n                    url: options.support_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Search\"),\n                    url: options.search_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Mailing Lists\"),\n                    url: options.mailing_lists,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Videos\"),\n                    url: options.screencasts_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Wiki\"),\n                    url: options.wiki_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"How to Cite Galaxy\"),\n                    url: options.citation_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Interactive Tours\"),\n                    url: \"tours\"\n                }\n            ]\n        };\n        if (options.terms_url) {\n            helpTab.menu.push({\n                title: _l(\"Terms and Conditions\"),\n                url: options.terms_url,\n                target: \"_blank\"\n            });\n        }\n        if (options.helpsite_url) {\n            helpTab.menu.unshift({\n                title: _l(\"Galaxy Help\"),\n                url: options.helpsite_url,\n                target: \"_blank\"\n            });\n        }\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    url: \"login\",\n                    tooltip: _l(\"Account registration or login\")\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: _l(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: _l(\"Account and saved data\"),\n                menu: [\n                    {\n                        title: `${_l(\"Logged in as\")} ${Galaxy.user.get(\"email\")}`\n                    },\n                    {\n                        title: _l(\"Preferences\"),\n                        url: \"user\",\n                        target: \"__use_router__\"\n                    },\n                    {\n                        title: _l(\"Custom Builds\"),\n                        url: \"custom_builds\",\n                        target: \"__use_router__\"\n                    },\n                    {\n                        title: _l(\"Logout\"),\n                        divider: true,\n                        onclick: logoutClick\n                    },\n                    {\n                        title: _l(\"Saved Datasets\"),\n                        url: \"datasets/list\",\n                        target: \"__use_router__\"\n                    },\n                    {\n                        title: _l(\"Saved Histories\"),\n                        url: \"histories/list\",\n                        target: \"__use_router__\"\n                    },\n                    {\n                        title: _l(\"Saved Pages\"),\n                        url: \"pages/list\",\n                        target: \"__use_router__\"\n                    },\n                    {\n                        title: _l(\"Saved Visualizations\"),\n                        url: \"visualizations/list\",\n                        target: \"__use_router__\"\n                    }\n                ]\n            };\n        }\n        this.add(userTab);\n        return new $.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$link = this.$(\".nav-link\");\n        this.$note = this.$(\".nav-note\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .nav-link\": \"_toggleClick\"\n    },\n\n    render: function() {\n        $(\".tooltip\").remove();\n        this.$el\n            .removeClass()\n            .addClass(this.model.get(\"disabled\") && \"disabled\")\n            .addClass(this.model.get(\"active\") && \"active\")\n            .addClass(this.model.get(\"menu\") && \"dropdown\")\n            .attr(\"id\", this.model.id)\n            .css({\n                visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n            });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note\n            .html(this.model.get(\"note\") || \"\")\n            .removeClass()\n            .addClass(\"nav-note\")\n            .addClass(this.model.get(\"note_cls\"))\n            .css({\n                display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n            });\n        this.$link\n            .html(this.model.get(\"title\") || \"\")\n            .removeClass()\n            .addClass(\"nav-link\")\n            .addClass(this.model.get(\"cls\"))\n            .addClass(this.model.get(\"icon\") && `nav-icon fa ${this.model.get(\"icon\")}`)\n            .addClass(this.model.get(\"menu\") && \"dropdown-toggle\")\n            .addClass(this.model.get(\"toggle\") && \"toggle\")\n            .attr(\"target\", this.model.get(\"target\"))\n            .attr(\"href\", this.model.get(\"url\"))\n            .attr(\"title\", this.model.get(\"tooltip\"))\n            .tooltip(\"dispose\");\n        if (this.model.get(\"tooltip\")) {\n            this.$link.tooltip({ placement: \"bottom\" });\n        }\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\")\n                .show()\n                .off()\n                .on(\"click\", () => {\n                    $(\"#dd-helper\").hide();\n                    this.model.set(\"show_menu\", false);\n                });\n        } else {\n            this.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass();\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), menuItem => {\n                this.$menu.append(this._buildMenuItem(menuItem));\n                if (menuItem.divider) {\n                    this.$menu.append($(\"<div/>\").addClass(\"dropdown-divider\"));\n                }\n            });\n            this.$menu.addClass(\"dropdown-menu\");\n            this.$link.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function(options) {\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = this._formatUrl(options.url);\n        return $(\"<a/>\")\n            .addClass(\"dropdown-item\")\n            .attr(\"href\", options.url)\n            .attr(\"target\", options.target)\n            .html(options.title)\n            .on(\"click\", e => {\n                e.preventDefault();\n                this.model.set(\"show_menu\", false);\n                if (options.onclick) {\n                    options.onclick();\n                } else {\n                    let Galaxy = getGalaxyInstance();\n                    if (options.target == \"__use_router__\" && typeof Galaxy.page != \"undefined\") {\n                        Galaxy.page.router.executeUseRouter(options.url);\n                    } else {\n                        try {\n                            Galaxy.frame.add(options);\n                        } catch (err) {\n                            console.warn(\"Missing frame element on galaxy instance\", err);\n                        }\n                    }\n                }\n            });\n    },\n\n    buildLink: function(label, url) {\n        return $(\"<div/>\")\n            .append(\n                $(\"<a/>\")\n                    .attr(\"href\", getAppRoot() + url)\n                    .html(label)\n            )\n            .html();\n    },\n\n    /** Handle click event */\n    _toggleClick: function(e) {\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", m => {\n            if (model.id !== m.id && m.get(\"menu\")) {\n                m.set(\"show_menu\", false);\n            }\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                if (model.get(\"onclick\")) {\n                    model.get(\"onclick\")();\n                } else {\n                    let Galaxy = getGalaxyInstance();\n                    if (model.attributes.target == \"__use_router__\" && typeof Galaxy.page != \"undefined\") {\n                        Galaxy.page.router.executeUseRouter(model.attributes.url);\n                    } else {\n                        Galaxy.frame.add(model.attributes);\n                    }\n                }\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            if (this.$link.popover) {\n                this.$link.popover(\"dispose\");\n            }\n            this.$link\n                .popover({\n                    html: true,\n                    placement: \"bottom\",\n                    content: `Please ${this.buildLink(\"login or register\", \"login\")} to use this feature.`\n                })\n                .popover(\"show\");\n            window.setTimeout(() => {\n                this.$link.popover(\"dispose\");\n            }, 3000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function(url) {\n        return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? getAppRoot() + url : url;\n    },\n\n    /** body tempate */\n    _template: function() {\n        return `\n            <li class=\"nav-item\">\n                <a class=\"nav-link\"/>\n                <div class=\"nav-note\"/>\n                <div class=\"dropdown-menu\"/>\n            </li>`;\n    }\n});\n\nexport default {\n    Collection: Collection,\n    Tab: Tab\n};\n","/** Frame view */\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _l from \"utils/localization\";\nimport { getGalaxyInstance } from \"app\";\n\nvar FrameView = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.setElement($(\"<div/>\").addClass(\"corner frame\"));\n        this.$el\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-header corner\")\n                    .append($(\"<div/>\").addClass(\"f-title\"))\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"f-icon f-close fa fa-close\")\n                            .tooltip({\n                                title: _l(\"Close\"),\n                                placement: \"bottom\"\n                            })\n                    )\n            )\n            .append($(\"<div/>\").addClass(\"f-content\"))\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-resize f-icon corner fa fa-expand\")\n                    .tooltip({ title: \"Resize\" })\n            )\n            .append($(\"<div/>\").addClass(\"f-cover\"));\n        this.$header = this.$(\".f-header\");\n        this.$title = this.$(\".f-title\");\n        this.$content = this.$(\".f-content\");\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.title) || \"\");\n        this.$header.find(\".f-icon-left\").remove();\n        _.each(options.menu, option => {\n            var $option = $(\"<div/>\")\n                .addClass(\"f-icon-left\")\n                .addClass(option.icon);\n            if (_.isFunction(option.disabled) && option.disabled()) {\n                $option.attr(\"disabled\", true);\n            } else {\n                $option\n                    .on(\"click\", () => {\n                        option.onclick(self);\n                    })\n                    .tooltip({\n                        title: option.tooltip || \"\",\n                        placement: \"bottom\"\n                    });\n            }\n            self.$header.append($option);\n        });\n        if (options.url) {\n            this.$content.html(\n                $(\"<iframe/>\")\n                    .addClass(\"f-iframe\")\n                    .attr(\"scrolling\", \"auto\")\n                    .attr(\"src\", `${options.url + (options.url.indexOf(\"?\") === -1 ? \"?\" : \"&\")}widget=True`)\n            );\n        } else if (options.content) {\n            if (_.isFunction(options.content)) {\n                options.content(self.$content);\n            } else {\n                self.$content.html(options.content);\n            }\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {\n            // default frame size in cells\n            cols: 6,\n            rows: 3\n        },\n        rows: 1000, // maximum number of rows\n        cell: 130, // cell size in px\n        margin: 5, // margin between frames\n        scroll: 5, // scroll speed\n        top_min: 40, // top margin\n        frame_max: 9, // maximum number of frames\n        visible: true // initial visibility\n    },\n\n    cols: 0, // number of columns\n    top: 0, // scroll/element top\n    top_max: 0, // viewport scrolling state\n    frame_z: 0, // frame z-index\n    frame_counter: 0, // frame counter\n    frame_uid: 0, // unique frame id counter\n    frame_list: {}, // list of all frames\n    frame_shadow: null, // frame shown as placeholder when moving active frames\n    visible: false, // flag indicating if scratchbook viewer is visible or not\n    event: {}, // dictionary keeping track of current event\n\n    initialize: function(options) {\n        var self = this;\n        this.options = _.defaults(options || {}, this.defaultOptions);\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"galaxy-frame\")\n                .append($(\"<div/>\").addClass(\"frame-background\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-up fa fa-chevron-up fa-2x\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-down fa fa-chevron-down fa-2x\"))\n        );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({\n            el: $(\"<div/>\").addClass(\"corner frame-shadow\")\n        });\n        this.$el.append(this.frame_shadow.$el);\n        this._frameInit(this.frame_shadow, \"#frame-shadow\");\n        this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n        this.frame_list[\"#frame-shadow\"] = this.frame_shadow;\n\n        // initialize panel\n        if (this.visible) {\n            this.show();\n        } else {\n            this.hide();\n        }\n        this._panelRefresh();\n        $(window).resize(() => {\n            if (self.visible) {\n                self._panelRefresh();\n            }\n        });\n    },\n\n    /** Render */\n    render: function() {\n        this.$(\".frame-scroll-up\")[(this.top != this.options.top_min && \"show\") || \"hide\"]();\n        this.$(\".frame-scroll-down\")[(this.top != this.top_max && \"show\") || \"hide\"]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function(options) {\n        let Galaxy = getGalaxyInstance();\n        if (this.frame_counter >= this.options.frame_max) {\n            Galaxy.modal.show({\n                title: _l(\"Warning\"),\n                body: `You have reached the maximum number of allowed frames (${this.options.frame_max}).`,\n                buttons: {\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        } else {\n            var frame_id = `#frame-${this.frame_uid++}`;\n            if ($(frame_id).length !== 0) {\n                Galaxy.modal.show({\n                    title: _l(\"Error\"),\n                    body: \"This frame already exists. This page might contain multiple frame managers.\",\n                    buttons: {\n                        Close: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView(options);\n                this.$el.append(frame.$el);\n\n                // set dimensions\n                options.width = this._toPixelCoord(\"width\", this.options.frame.cols);\n                options.height = this._toPixelCoord(\"height\", this.options.frame.rows);\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt(frame.$el.css(\"z-index\"));\n                this.frame_list[frame_id] = frame;\n                this.frame_counter++;\n                this._frameInit(frame, frame_id);\n                this._frameResize(frame, {\n                    width: options.width,\n                    height: options.height\n                });\n                this._frameInsert(frame, { top: 0, left: 0 }, true);\n                if (!this.visible) {\n                    this.show();\n                }\n                this.trigger(\"add\");\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function(frame) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut(\"fast\", () => {\n            $frame.remove();\n            delete self.frame_list[frame.id];\n            self.frame_counter--;\n            self._panelRefresh(true);\n            self._panelAnimationComplete();\n            self.trigger(\"remove\");\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn(\"fast\");\n        this.trigger(\"show\");\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if (!this.event.type) {\n            this.visible = false;\n            this.$el.fadeOut(\"fast\", function() {\n                $(this).hide();\n            });\n            this.trigger(\"hide\");\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        mousemove: \"_eventFrameMouseMove\",\n        mouseup: \"_eventFrameMouseUp\",\n        mouseleave: \"_eventFrameMouseUp\",\n        mousewheel: \"_eventPanelScroll\",\n        DOMMouseScroll: \"_eventPanelScroll\",\n\n        // events fixed to elements\n        \"mousedown .frame\": \"_eventFrameMouseDown\",\n        \"mousedown .frame-background\": \"_eventHide\",\n        \"mousedown .frame-scroll-up\": \"_eventPanelScroll_up\",\n        \"mousedown .frame-scroll-down\": \"_eventPanelScroll_down\",\n        \"mousedown .f-close\": \"_eventFrameClose\"\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function(e) {\n        $(\".tooltip\").hide();\n        if (!this.event.type) {\n            if ($(e.target).hasClass(\"f-header\") || $(e.target).hasClass(\"f-title\")) {\n                this.event.type = \"drag\";\n            }\n            if ($(e.target).hasClass(\"f-resize\")) {\n                this.event.type = \"resize\";\n            }\n            if (this.event.type) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify(e.target);\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart(this.event.target);\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function(e) {\n        if (this.event.type) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x: e.originalEvent.pageX,\n                y: e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x: event_xy_new.x - this.event.xy.x,\n                y: event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen(this.event.target);\n\n            // drag/resize event\n            if (this.event.type == \"resize\") {\n                p.width += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max(p.width, min_dim);\n                p.height = Math.max(p.height, min_dim);\n                this._frameResize(this.event.target, p);\n                p.width = this._toGridCoord(\"width\", p.width) + 1;\n                p.height = this._toGridCoord(\"height\", p.height) + 1;\n                p.width = this._toPixelCoord(\"width\", p.width);\n                p.height = this._toPixelCoord(\"height\", p.height);\n                this._frameResize(this.frame_shadow, p);\n                this._frameInsert(this.frame_shadow, {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                });\n            } else if (this.event.type == \"drag\") {\n                p.left += event_xy_delta.x;\n                p.top += event_xy_delta.y;\n                this._frameOffset(this.event.target, p);\n                var l = {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                };\n                if (l.left !== 0) {\n                    l.left++;\n                }\n                this._frameInsert(this.frame_shadow, l);\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function(e) {\n        if (this.event.type) {\n            this._frameDragStop(this.event.target);\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this.del(this._frameIdentify(e.target));\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function(e) {\n        if (!this.event.type) {\n            this.hide();\n        }\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function(e) {\n        if (!this.event.type && this.visible) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $(e.srcElement).parents(\".frame\");\n            if (frames.length !== 0) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(-this.options.scroll);\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(this.options.scroll);\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function(target) {\n        return this.frame_list[\n            `#${$(target)\n                .closest(\".frame\")\n                .attr(\"id\")}`\n        ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart: function(frame) {\n        this._frameFocus(frame, true);\n        var p = this._frameScreen(frame);\n        this._frameResize(this.frame_shadow, p);\n        this._frameGrid(this.frame_shadow, frame.grid_location);\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $(\".f-cover\").show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop: function(frame) {\n        this._frameFocus(frame, false);\n        var p = this._frameScreen(this.frame_shadow);\n        this._frameResize(frame, p);\n        this._frameGrid(frame, this.frame_shadow.grid_location, true);\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $(\".f-cover\").hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function(type, px) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        if (type == \"top\") {\n            px -= this.top;\n        }\n        return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n    },\n\n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function(type, g) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        var px = g * this.options.cell - sign * this.options.margin;\n        if (type == \"top\") {\n            px += this.top;\n        }\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function(px) {\n        return {\n            top: this._toGridCoord(\"top\", px.top),\n            left: this._toGridCoord(\"left\", px.left),\n            width: this._toGridCoord(\"width\", px.width),\n            height: this._toGridCoord(\"height\", px.height)\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function(g) {\n        return {\n            top: this._toPixelCoord(\"top\", g.top),\n            left: this._toPixelCoord(\"left\", g.left),\n            width: this._toPixelCoord(\"width\", g.width),\n            height: this._toPixelCoord(\"height\", g.height)\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function(g) {\n        function is_collision_pair(a, b) {\n            return !(\n                a.left > b.left + b.width - 1 ||\n                a.left + a.width - 1 < b.left ||\n                a.top > b.top + b.height - 1 ||\n                a.top + a.height - 1 < b.top\n            );\n        }\n        for (var i in this.frame_list) {\n            var frame = this.frame_list[i];\n            if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function(loc) {\n        return loc.top * this.cols + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function(animate) {\n        this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n        this._frameInsert(null, null, animate);\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $(\".frame\")\n            .promise()\n            .done(() => {\n                self._panelScroll(0, true);\n            });\n    },\n\n    /** Scroll panel */\n    _panelScroll: function(delta, animate) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max(top_new, this.top_max);\n        top_new = Math.min(top_new, this.options.top_min);\n        if (this.top != top_new) {\n            for (var i in this.frame_list) {\n                var frame = this.frame_list[i];\n                if (frame.grid_location !== null) {\n                    var screen_location = {\n                        top: frame.screen_location.top - (this.top - top_new),\n                        left: frame.screen_location.left\n                    };\n                    this._frameOffset(frame, screen_location, animate);\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function(frame, id) {\n        frame.id = id;\n        frame.screen_location = {};\n        frame.grid_location = {};\n        frame.grid_rank = null;\n        frame.$el.attr(\"id\", id.substring(1));\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function(frame, new_loc, animate) {\n        var self = this;\n        var place_list = [];\n        if (frame) {\n            frame.grid_location = null;\n            place_list.push([frame, this._locationRank(new_loc)]);\n        }\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                f.grid_location = null;\n                place_list.push([f, f.grid_rank]);\n            }\n        });\n        place_list.sort((a, b) => (a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0));\n        _.each(place_list, place => {\n            self._framePlace(place[0], animate);\n        });\n        this.top_max = 0;\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n            }\n        });\n        this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min(this.top_max, this.options.top_min);\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function(frame, animate) {\n        frame.grid_location = null;\n        var g = this._toGrid(this._frameScreen(frame));\n        var done = false;\n        for (var i = 0; i < this.options.rows; i++) {\n            for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n                g.top = i;\n                g.left = j;\n                if (!this._isCollision(g)) {\n                    done = true;\n                    break;\n                }\n            }\n            if (done) {\n                break;\n            }\n        }\n        if (done) {\n            this._frameGrid(frame, g, animate);\n        } else {\n            console.log(\"Grid dimensions exceeded.\");\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function(frame, has_focus) {\n        frame.$el.css(\"z-index\", this.frame_z + (has_focus ? 1 : 0));\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function(frame, p, animate) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if (animate) {\n            this._frameFocus(frame, true);\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, \"fast\", () => {\n                self._frameFocus(frame, false);\n            });\n        } else {\n            frame.$el.css({ top: p.top, left: p.left });\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function(frame, p) {\n        frame.$el.css({ width: p.width, height: p.height });\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function(frame, l, animate) {\n        frame.grid_location = l;\n        this._frameOffset(frame, this._toPixel(l), animate);\n        frame.grid_rank = this._locationRank(l);\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function(frame) {\n        var p = frame.screen_location;\n        return {\n            top: p.top,\n            left: p.left,\n            width: p.width,\n            height: p.height\n        };\n    }\n});\n\nexport default {\n    View: View\n};\n","/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport Frames from \"mvc/ui/ui-frames\";\nimport { Dataset, createTabularDatasetChunkedView, TabularDataset } from \"mvc/dataset/data\";\nimport visualization from \"viz/visualization\";\nimport { TracksterUI } from \"viz/trackster\";\nimport _l from \"utils/localization\";\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        options = options || {};\n        this.frames = new Frames.View({ visible: false });\n        this.setElement(this.frames.$el);\n        this.active = false;\n        this.buttonActive = options.collection.add({\n            id: \"enable-scratchbook\",\n            icon: \"fa-th\",\n            tooltip: _l(\"Enable/Disable Scratchbook\"),\n            onclick: () => {\n                this.active = !this.active;\n                this.buttonActive.set({\n                    toggle: this.active,\n                    show_note: this.active,\n                    note_cls: this.active && \"fa fa-check\"\n                });\n                if (!this.active) {\n                    this.frames.hide();\n                }\n            },\n            onbeforeunload: () => {\n                if (this.frames.length() > 0) {\n                    return `You opened ${this.frames.length()} frame(s) which will be lost.`;\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id: \"show-scratchbook\",\n            icon: \"fa-eye\",\n            tooltip: _l(\"Show/Hide Scratchbook\"),\n            show_note: true,\n            visible: false,\n            onclick: e => {\n                if (this.frames.visible) {\n                    this.frames.hide();\n                } else {\n                    this.frames.show();\n                }\n            }\n        });\n        this.frames\n            .on(\"add remove\", () => {\n                if (this.frames.visible && this.frames.length() === 0) {\n                    this.frames.hide();\n                }\n                this.buttonLoad.set({\n                    note: this.frames.length(),\n                    visible: this.frames.length() > 0\n                });\n            })\n            .on(\"show hide \", () => {\n                this.buttonLoad.set({\n                    toggle: this.frames.visible,\n                    icon: (this.frames.visible && \"fa-eye\") || \"fa-eye-slash\"\n                });\n            });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function(dataset_id) {\n        var self = this;\n        var current_dataset = null;\n        let Galaxy = getGalaxyInstance();\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[history_id] = {\n                name: Galaxy.currHistoryPanel.model.get(\"name\"),\n                dataset_ids: []\n            };\n            Galaxy.currHistoryPanel.collection.each(model => {\n                if (!model.get(\"deleted\") && model.get(\"visible\")) {\n                    self.history_cache[history_id].dataset_ids.push(model.get(\"id\"));\n                }\n            });\n        }\n        var _findDataset = (dataset, offset) => {\n            if (dataset) {\n                var history_details = self.history_cache[dataset.get(\"history_id\")];\n                if (history_details && history_details.dataset_ids) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf(dataset.get(\"id\"));\n                    if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n                        return dataset_list[pos + offset];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = (dataset, offset, frame) => {\n            var new_dataset_id = _findDataset(dataset, offset);\n            if (new_dataset_id) {\n                self._loadDataset(new_dataset_id, (new_dataset, config) => {\n                    current_dataset = new_dataset;\n                    frame.model.set(config);\n                });\n            } else {\n                frame.model.trigger(\"change\");\n            }\n        };\n        this._loadDataset(dataset_id, (dataset, config) => {\n            current_dataset = dataset;\n            self.add(\n                _.extend(\n                    {\n                        menu: [\n                            {\n                                icon: \"fa fa-chevron-circle-left\",\n                                tooltip: _l(\"Previous in History\"),\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, -1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, -1);\n                                }\n                            },\n                            {\n                                icon: \"fa fa-chevron-circle-right\",\n                                tooltip: _l(\"Next in History\"),\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, 1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, 1);\n                                }\n                            }\n                        ]\n                    },\n                    config\n                )\n            );\n        });\n    },\n\n    _loadDataset: function(dataset_id, callback) {\n        var self = this;\n        var dataset = new Dataset({ id: dataset_id });\n        $.when(dataset.fetch()).then(() => {\n            var is_tabular = _.find(\n                [\"tabular\", \"interval\"],\n                data_type => dataset.get(\"data_type\").indexOf(data_type) !== -1\n            );\n            var title = dataset.get(\"name\");\n            var history_details = self.history_cache[dataset.get(\"history_id\")];\n            if (history_details) {\n                title = `${history_details.name}: ${title}`;\n            }\n            callback(\n                dataset,\n                is_tabular\n                    ? {\n                          title: title,\n                          url: null,\n                          content: createTabularDatasetChunkedView({\n                              model: new TabularDataset(dataset.toJSON()),\n                              embedded: true,\n                              height: \"100%\"\n                          }).$el\n                      }\n                    : {\n                          title: title,\n                          url: `${getAppRoot()}datasets/${dataset_id}/display/?preview=True`,\n                          content: null\n                      }\n            );\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function(viz_id) {\n        var self = this;\n        var viz = new visualization.Visualization({ id: viz_id });\n        $.when(viz.fetch()).then(() => {\n            var ui = new TracksterUI(getAppRoot());\n\n            // Construct frame config based on dataset's type.\n            var frame_config = {\n                title: viz.get(\"name\"),\n                type: \"other\",\n                content: function(parent_elt) {\n                    // Create view config.\n                    var view_config = {\n                        container: parent_elt,\n                        name: viz.get(\"title\"),\n                        id: viz.id,\n                        // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                        dbkey: viz.get(\"dbkey\"),\n                        stand_alone: false\n                    };\n\n                    var latest_revision = viz.get(\"latest_revision\");\n                    var drawables = latest_revision.config.view.drawables;\n\n                    // Set up datasets in drawables.\n                    _.each(drawables, d => {\n                        d.dataset = {\n                            hda_ldda: d.hda_ldda,\n                            id: d.dataset_id\n                        };\n                    });\n                    ui.create_visualization(\n                        view_config,\n                        latest_revision.config.viewport,\n                        latest_revision.config.view.drawables,\n                        latest_revision.config.bookmarks,\n                        false\n                    );\n                }\n            };\n            self.add(frame_config);\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function(options) {\n        if (options.target == \"_blank\") {\n            window.open(options.url);\n        } else if (options.target == \"_top\" || options.target == \"_parent\" || options.target == \"_self\") {\n            window.location = options.url;\n        } else if (!this.active || options.noscratchbook) {\n            var $galaxy_main = $(window.parent.document).find(\"#galaxy_main\");\n            if (options.target == \"galaxy_main\" || options.target == \"center\") {\n                if ($galaxy_main.length === 0) {\n                    window.location = this._build_url(options.url, { use_panels: true });\n                } else {\n                    $galaxy_main.attr(\"src\", options.url);\n                }\n            } else window.location = options.url;\n        } else {\n            options.url = this._build_url(options.url, { hide_panels: true, hide_masthead: true });\n            this.frames.add(options);\n        }\n    },\n\n    /** Url helper */\n    _build_url: function(url, options) {\n        if (url) {\n            url += url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            url += $.param(options, true);\n            return url;\n        }\n    }\n});\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class View to display a user's disk/storage usage\n *      either as a progress bar representing the percentage of a quota used\n *      or a simple text element displaying the human readable size used.\n *  @name UserQuotaMeter\n *  @augments Backbone.View\n */\nvar UserQuotaMeter = Backbone.View.extend(baseMVC.LoggableMixin).extend(\n    /** @lends UserQuotaMeter.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** Defaults for optional settings passed to initialize */\n        options: {\n            warnAtPercent: 85,\n            errorAtPercent: 100\n        },\n\n        /** Set up, accept options, and bind events */\n        initialize: function(options) {\n            this.log(`${this}.initialize:`, options);\n            _.extend(this.options, options);\n\n            //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n            this.listenTo(this.model, \"change:quota_percent change:total_disk_usage\", this.render);\n        },\n\n        /** Re-load user model data from the api */\n        update: function(options) {\n            this.log(`${this} updating user data...`, options);\n            this.model.loadFromApi(this.model.get(\"id\"), options);\n            return this;\n        },\n\n        /** Is the user over their quota (if there is one)?\n         * @returns {Boolean} true if over quota, false if no quota or under quota\n         */\n        isOverQuota: function() {\n            return (\n                this.model.get(\"quota_percent\") !== null &&\n                this.model.get(\"quota_percent\") >= this.options.errorAtPercent\n            );\n        },\n\n        /** Render the meter when they have an applicable quota. Will render as a progress bar\n         *      with their percentage of that quota in text over the bar.\n         *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n         *  @fires quota:under when user is under quota\n         *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n         *  @fires quota:under:ok when user is below this.warnAtPercent\n         *  @returns {jQuery} the rendered meter\n         */\n        _render_quota: function() {\n            var modelJson = this.model.toJSON();\n\n            var //prevPercent = this.model.previous( 'quota_percent' ),\n                percent = modelJson.quota_percent;\n\n            var //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n                $meter = $(this._templateQuotaMeter(modelJson));\n\n            var $bar = $meter.find(\".progress-bar\");\n            //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\n            // OVER QUOTA: color the quota bar and show the quota error message\n            if (this.isOverQuota()) {\n                //this.log( '\\t over quota' );\n                $bar.attr(\"class\", \"progress-bar bg-danger\");\n                $meter.find(\".quota-meter-text\").css(\"color\", \"white\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:over\", modelJson);\n\n                // APPROACHING QUOTA: color the quota bar\n            } else if (percent >= this.options.warnAtPercent) {\n                //this.log( '\\t approaching quota' );\n                $bar.attr(\"class\", \"progress-bar bg-warning\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:under quota:under:approaching\", modelJson);\n\n                // otherwise, hide/don't use the msg box\n            } else {\n                $bar.attr(\"class\", \"progress-bar bg-success\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:under quota:under:ok\", modelJson);\n            }\n            return $meter;\n        },\n\n        /** Render the meter when the user has NO applicable quota. Will render as text\n         *      showing the human readable sum storage their data is using.\n         *  @returns {jQuery} the rendered text\n         */\n        _render_usage: function() {\n            //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n            var usage = $(this._templateUsage(this.model.toJSON()));\n            this.log(`${this}.rendering usage:`, usage);\n            return usage;\n        },\n\n        /** Render either the quota percentage meter or the human readable disk usage\n         *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n         *  @returns {Object} this UserQuotaMeter\n         */\n        render: function() {\n            //this.log( this + '.rendering' );\n            var meterHtml = null;\n\n            // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n            this.log(`${this}.model.quota_percent:`, this.model.get(\"quota_percent\"));\n            if (this.model.get(\"quota_percent\") === null || this.model.get(\"quota_percent\") === undefined) {\n                meterHtml = this._render_usage();\n\n                // otherwise, render percent of quota (and warning, error)\n            } else {\n                meterHtml = this._render_quota();\n                //TODO: add the original text for unregistered quotas\n                //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n            }\n\n            this.$el.html(meterHtml);\n            this.$el.find(\".quota-meter-text\").tooltip();\n            return this;\n        },\n\n        _templateQuotaMeter: function(data) {\n            return [\n                '<div id=\"quota-meter\" class=\"quota-meter progress\">',\n                '<div class=\"progress-bar\" style=\"width: ',\n                data.quota_percent,\n                '%\"></div>',\n                '<div class=\"quota-meter-text\" data-placement=\"left\" style=\"top: 6px\"',\n                data.nice_total_disk_usage ? ` title=\"Using ${data.nice_total_disk_usage}. Click for details.\">` : \">\",\n                '<a href=\"https://galaxyproject.org/support/account-quotas/\" target=\"_blank\">',\n                _l(\"Using\"),\n                \" \",\n                data.quota_percent,\n                \"%\",\n                \"</a>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        _templateUsage: function(data) {\n            return [\n                '<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">',\n                '<div class=\"quota-meter-text\" data-placement=\"left\" data-original-title=\"This value is recalculated when you log out.\" style=\"top: 6px; color: white\">',\n                data.nice_total_disk_usage ? _l(\"Using \") + data.nice_total_disk_usage : \"\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        toString: function() {\n            return `UserQuotaMeter(${this.model})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    UserQuotaMeter: UserQuotaMeter\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Menu from \"layout/menu\";\nimport Scratchbook from \"layout/scratchbook\";\nimport QuotaMeter from \"mvc/user/user-quotameter\";\nimport { getGalaxyInstance } from \"app\";\n\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        let Galaxy = getGalaxyInstance();\n\n        var self = this;\n        this.options = options;\n        this.setElement(this._template());\n        this.$navbarBrandLink = this.$(\".navbar-brand\");\n        this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n        this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n        this.$navbarTabs = this.$(\".navbar-nav\");\n        this.$quoteMeter = this.$(\".quota-meter-container\");\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection\n            .on(\"add\", model => {\n                self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n            })\n            .on(\"reset\", () => {\n                self.$navbarTabs.empty();\n            })\n            .on(\"dispatch\", callback => {\n                self.collection.each(m => {\n                    callback(m);\n                });\n            })\n            .fetch(this.options);\n\n        // highlight initial active view\n        this.highlight(options.active_view);\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook({\n            collection: this.collection\n        });\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model: Galaxy.user,\n            el: this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $(window)\n            .on(\"click\", e => {\n                var $download_link = $(e.target).closest(\"a[download]\");\n                if ($download_link.length == 1) {\n                    if ($(\"iframe[id=download]\").length === 0) {\n                        $(\"body\").append(\n                            $(\"<iframe/>\")\n                                .attr(\"id\", \"download\")\n                                .hide()\n                        );\n                    }\n                    $(\"iframe[id=download]\").attr(\"src\", $download_link.attr(\"href\"));\n                    e.preventDefault();\n                }\n            })\n            .on(\"beforeunload\", () => {\n                var text = \"\";\n                self.collection.each(model => {\n                    var q = model.get(\"onbeforeunload\") && model.get(\"onbeforeunload\")();\n                    if (q) {\n                        text += `${q} `;\n                    }\n                });\n                if (text !== \"\") {\n                    return text;\n                }\n            });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html(`Galaxy ${(this.options.brand && `/ ${this.options.brand}`) || \"\"}`);\n        this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n        this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n        this.quotaMeter.render();\n        return this;\n    },\n\n    highlight: function(id) {\n        this.collection.forEach(function(model) {\n            model.set(\"active\", model.id == id);\n        });\n    },\n\n    /** body template */\n    _template: function() {\n        return `\n            <nav id=\"masthead\" class=\"navbar navbar-expand justify-content-center navbar-dark\">\n                <a class=\"navbar-brand\">\n                    <img class=\"navbar-brand-image\"/>\n                    <span class=\"navbar-brand-title\"/>\n                </a>\n                <ul class=\"navbar-nav\"/>\n                <div class=\"quota-meter-container\"/>\n            </nav>`;\n    }\n});\n\nexport default {\n    View: View\n};\n","export default {\n    tool: \"fa-wrench\",\n    data_input: \"fa-file-o\",\n    data_collection_input: \"fa-folder-o\",\n    subworkflow: \"fa-sitemap fa-rotate-270\",\n    parameter_input: \"fa-pencil\",\n    pause: \"fa-pause\"\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport _l from \"utils/localization\";\nimport { Dataset } from \"mvc/dataset/data\";\nimport util_mod from \"viz/trackster/util\";\nimport config_mod from \"utils/config\";\nimport GridView from \"mvc/grid/grid-view\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport { getGalaxyInstance } from \"app\";\n\n/**\n * Mixin for returning custom JSON representation from toJSON. Class attribute to_json_keys defines a set of attributes\n * to include in the representation; to_json_mappers defines mappers for returned objects.\n */\nvar CustomToJSON = {\n    /**\n     * Returns JSON representation of object using to_json_keys and to_json_mappers.\n     */\n    toJSON: function() {\n        var self = this;\n        var json = {};\n        _.each(self.constructor.to_json_keys, k => {\n            var val = self.get(k);\n            if (k in self.constructor.to_json_mappers) {\n                val = self.constructor.to_json_mappers[k](val, self);\n            }\n            json[k] = val;\n        });\n        return json;\n    }\n};\n\n/**\n * Model, view, and controller objects for Galaxy visualization framework.\n *\n * Models have no references to views, instead using events to indicate state\n * changes; this is advantageous because multiple views can use the same object\n * and models can be used without views.\n */\n\n/**\n * Use a popup grid to select datasets from histories or libraries. After datasets are selected,\n * track definitions are obtained from the server and the success_fn is called with the list of\n * definitions for selected datasets.\n */\nvar select_datasets = (filters, success_fn) => {\n    // history dataset selection tab\n    var history_grid = new GridView({\n        url_base: `${getAppRoot()}visualization/list_history_datasets`,\n        filters: filters,\n        embedded: true\n    });\n\n    // library dataset selection tab\n    var library_grid = new GridView({\n        url_base: `${getAppRoot()}visualization/list_library_datasets`,\n        embedded: true\n    });\n\n    // build tabs\n    var tabs = new Tabs.View();\n    tabs.add({\n        id: \"histories\",\n        title: _l(\"Histories\"),\n        $el: $(\"<div/>\").append(history_grid.$el)\n    });\n    tabs.add({\n        id: \"libraries\",\n        title: _l(\"Libraries\"),\n        $el: $(\"<div/>\").append(library_grid.$el)\n    });\n\n    // modal\n    let Galaxy = getGalaxyInstance();\n    Galaxy.modal.show({\n        title: _l(\"Select datasets for new tracks\"),\n        body: tabs.$el,\n        closing_events: true,\n        buttons: {\n            Cancel: function() {\n                Galaxy.modal.hide();\n            },\n            Add: function() {\n                var requests = [];\n                tabs.$(\"input.grid-row-select-checkbox[name=id]:checked\").each(function() {\n                    window.console.log($(this).val());\n                    requests[requests.length] = $.ajax({\n                        url: `${getAppRoot()}api/datasets/${$(this).val()}`,\n                        dataType: \"json\",\n                        data: {\n                            data_type: \"track_config\",\n                            hda_ldda: tabs.current() == \"histories\" ? \"hda\" : \"ldda\"\n                        }\n                    });\n                });\n                // To preserve order, wait until there are definitions for all tracks and then add\n                // them sequentially.\n                $.when.apply($, requests).then(function() {\n                    // jQuery always returns an Array for arguments, so need to look at first element\n                    // to determine whether multiple requests were made and consequently how to\n                    // map arguments to track definitions.\n                    var track_defs = arguments[0] instanceof Array ? $.map(arguments, arg => arg[0]) : [arguments[0]];\n                    success_fn(track_defs);\n                });\n                Galaxy.modal.hide();\n            }\n        }\n    });\n};\n\n// --------- Models ---------\n\n/**\n * Canvas manager is used to create canvases for browsers as well as providing a pattern cache\n */\nvar CanvasManager = function(default_font) {\n    this.default_font = default_font !== undefined ? default_font : \"9px Monaco, Lucida Console, monospace\";\n\n    this.dummy_canvas = this.new_canvas();\n    this.dummy_context = this.dummy_canvas.getContext(\"2d\");\n    this.dummy_context.font = this.default_font;\n\n    this.char_width_px = this.dummy_context.measureText(\"A\").width;\n\n    this.patterns = {};\n\n    // FIXME: move somewhere to make this more general\n    this.load_pattern(\"right_strand\", \"/visualization/strand_right.png\");\n    this.load_pattern(\"left_strand\", \"/visualization/strand_left.png\");\n    this.load_pattern(\"right_strand_inv\", \"/visualization/strand_right_inv.png\");\n    this.load_pattern(\"left_strand_inv\", \"/visualization/strand_left_inv.png\");\n};\n\n_.extend(CanvasManager.prototype, {\n    load_pattern: function(key, path) {\n        var patterns = this.patterns;\n        var dummy_context = this.dummy_context;\n        var image = new Image();\n        image.src = `${getAppRoot()}static/images${path}`;\n        image.onload = () => {\n            patterns[key] = dummy_context.createPattern(image, \"repeat\");\n        };\n    },\n    get_pattern: function(key) {\n        return this.patterns[key];\n    },\n    new_canvas: function() {\n        var canvas = $(\"<canvas/>\")[0];\n        // Keep a reference back to the manager\n        canvas.manager = this;\n        return canvas;\n    }\n});\n\n/**\n * Generic cache that handles key/value pairs. Keys can be any object that can be\n * converted to a String and compared.\n */\nvar Cache = Backbone.Model.extend({\n    defaults: {\n        num_elements: 20,\n        // Objects in cache; indexes into cache are strings of keys.\n        obj_cache: null,\n        // key_ary contains keys for objects in cache.\n        key_ary: null\n    },\n\n    initialize: function(options) {\n        this.clear();\n    },\n\n    /**\n     * Get an element from the cache using its key.\n     */\n    get_elt: function(key) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n\n        var index = _.indexOf(key_ary, k => k.toString() === key_str);\n\n        // Update cache.\n        if (index !== -1) {\n            // Object is in cache, so update it.\n            if (obj_cache[key_str].stale) {\n                // Object is stale: remove key and object.\n                key_ary.splice(index, 1);\n                delete obj_cache[key_str];\n            } else {\n                // Move key to back because it is most recently used.\n                this.move_key_to_end(key, index);\n            }\n        }\n\n        return obj_cache[key_str];\n    },\n\n    /**\n     * Put an element into the cache.\n     */\n    set_elt: function(key, value) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n        var num_elements = this.attributes.num_elements;\n\n        // Update keys, objects.\n        if (!obj_cache[key_str]) {\n            // Add object to cache.\n\n            if (key_ary.length >= num_elements) {\n                // Cache full, so remove first element.\n                var deleted_key = key_ary.shift();\n                delete obj_cache[deleted_key.toString()];\n            }\n\n            // Add key.\n            key_ary.push(key);\n        }\n\n        // Add object.\n        obj_cache[key_str] = value;\n        return value;\n    },\n\n    /**\n     * Move key to end of cache. Keys are removed from the front, so moving a key to the end\n     * delays the key's removal.\n     */\n    move_key_to_end: function(key, index) {\n        this.attributes.key_ary.splice(index, 1);\n        this.attributes.key_ary.push(key);\n    },\n\n    /**\n     * Clear all elements from the cache.\n     */\n    clear: function() {\n        this.attributes.obj_cache = {};\n        this.attributes.key_ary = [];\n    },\n\n    /** Returns the number of elements in the cache. */\n    size: function() {\n        return this.attributes.key_ary.length;\n    },\n\n    /** Returns key most recently added to cache. */\n    most_recently_added: function() {\n        return this.size() === 0\n            ? null\n            : // Most recent key is at the end of key array.\n              this.attributes.key_ary[this.attributes.key_ary.length - 1];\n    }\n});\n\n/**\n * Data manager for genomic data. Data is connected to and queryable by genomic regions.\n */\nvar GenomeDataManager = Cache.extend({\n    defaults: _.extend({}, Cache.prototype.defaults, {\n        dataset: null,\n        genome: null,\n        init_data: null,\n        min_region_size: 200,\n        filters_manager: null,\n        data_type: \"data\",\n        data_mode_compatible: function(entry, mode) {\n            return true;\n        },\n        can_subset: function(entry) {\n            return false;\n        }\n    }),\n\n    /**\n     * Initialization.\n     */\n    initialize: function(options) {\n        Cache.prototype.initialize.call(this);\n\n        // Set initial entries in data manager.\n        var initial_entries = this.get(\"init_data\");\n        if (initial_entries) {\n            this.add_data(initial_entries);\n        }\n    },\n\n    /**\n     * Add data entries to manager; each entry should be a dict with attributes region (key), data, and data_type.\n     * If necessary, manager size is increased to hold all data.\n     */\n    add_data: function(entries) {\n        // Increase size to accomodate all entries.\n        if (this.get(\"num_elements\") < entries.length) {\n            this.set(\"num_elements\", entries.length);\n        }\n\n        // Put data into manager.\n        var self = this;\n        _.each(entries, entry => {\n            self.set_data(entry.region, entry);\n        });\n    },\n\n    /**\n     * Returns deferred that resolves to true when dataset is ready (or false if dataset\n     * cannot be used).\n     */\n    data_is_ready: function() {\n        var dataset = this.get(\"dataset\");\n        var ready_deferred = $.Deferred();\n\n        var // If requesting raw data, query dataset state; if requesting (converted) data,\n            // need to query converted datasets state.\n            query_type =\n                this.get(\"data_type\") === \"raw_data\"\n                    ? \"state\"\n                    : this.get(\"data_type\") === \"data\"\n                    ? \"converted_datasets_state\"\n                    : \"error\";\n\n        var ss_deferred = new util_mod.ServerStateDeferred({\n            ajax_settings: {\n                url: this.get(\"dataset\").url(),\n                data: {\n                    hda_ldda: dataset.get(\"hda_ldda\"),\n                    data_type: query_type\n                },\n                dataType: \"json\"\n            },\n            interval: 5000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        $.when(ss_deferred.go()).then(response => {\n            ready_deferred.resolve(response === \"ok\" || response === \"data\");\n        });\n        return ready_deferred;\n    },\n\n    /**\n     * Perform a feature search from server; returns Deferred object that resolves when data is available.\n     */\n    search_features: function(query) {\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            query: query,\n            hda_ldda: dataset.get(\"hda_ldda\"),\n            data_type: \"features\"\n        };\n\n        return $.getJSON(dataset.url(), params);\n    },\n\n    /**\n     * Load data from server and manages data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function(region, mode, resolution, extra_params) {\n        // Setup data request params.\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            data_type: this.get(\"data_type\"),\n            chrom: region.get(\"chrom\"),\n            low: region.get(\"start\"),\n            high: region.get(\"end\"),\n            mode: mode,\n            resolution: resolution,\n            hda_ldda: dataset.get(\"hda_ldda\")\n        };\n\n        $.extend(params, extra_params);\n\n        // Add track filters to params.\n        var filters_manager = this.get(\"filters_manager\");\n        if (filters_manager) {\n            var filter_names = [];\n            var filters = filters_manager.filters;\n            for (var i = 0; i < filters.length; i++) {\n                filter_names.push(filters[i].name);\n            }\n            params.filter_cols = JSON.stringify(filter_names);\n        }\n\n        // Do request.\n        var manager = this;\n\n        var entry = $.getJSON(dataset.url(), params, result => {\n            // Add region to the result.\n            result.region = region;\n            manager.set_data(region, result);\n        });\n\n        this.set_data(region, entry);\n        return entry;\n    },\n\n    /**\n     * Get data from dataset.\n     */\n    get_data: function(region, mode, resolution, extra_params) {\n        // Look for entry and return if it's a deferred or if data available is compatible with mode.\n        var entry = this.get_elt(region);\n        if (entry && (util_mod.is_deferred(entry) || this.get(\"data_mode_compatible\")(entry, mode))) {\n            return entry;\n        }\n\n        //\n        // Look in cache for data that can be used.\n        // TODO: this logic could be improved if the visualization knew whether\n        // the data was \"index\" or \"data.\"\n        //\n        var key_ary = this.get(\"key_ary\");\n\n        var obj_cache = this.get(\"obj_cache\");\n        var entry_region;\n        var is_subregion;\n        for (var i = 0; i < key_ary.length; i++) {\n            entry_region = key_ary[i];\n\n            if (entry_region.contains(region)) {\n                is_subregion = true;\n\n                // This entry has data in the requested range. Return if data\n                // is compatible and can be subsetted.\n                entry = obj_cache[entry_region.toString()];\n                if (\n                    util_mod.is_deferred(entry) ||\n                    (this.get(\"data_mode_compatible\")(entry, mode) && this.get(\"can_subset\")(entry))\n                ) {\n                    this.move_key_to_end(entry_region, i);\n\n                    // If there's data, subset it.\n                    if (!util_mod.is_deferred(entry)) {\n                        var subset_entry = this.subset_entry(entry, region);\n                        this.set_data(region, subset_entry);\n                        entry = subset_entry;\n                    }\n\n                    return entry;\n                }\n            }\n        }\n\n        // FIXME: There _may_ be instances where region is a subregion of another entry but cannot be\n        // subsetted. For these cases, do not increase length because region will never be found (and\n        // an infinite loop will occur.)\n        // If needed, extend region to make it minimum size.\n        if (!is_subregion && region.length() < this.attributes.min_region_size) {\n            // IDEA: alternative heuristic is to find adjacent cache entry to region and use that to extend.\n            // This would prevent bad extensions when zooming in/out while still preserving the behavior\n            // below.\n\n            // Use copy of region to avoid changing actual region.\n            region = region.copy();\n\n            // Use heuristic to extend region: extend relative to last data request.\n            var last_request = this.most_recently_added();\n            if (!last_request || region.get(\"start\") > last_request.get(\"start\")) {\n                // This request is after the last request, so extend right.\n                region.set(\"end\", region.get(\"start\") + this.attributes.min_region_size);\n            } else {\n                // This request is after the last request, so extend left.\n                region.set(\"start\", region.get(\"end\") - this.attributes.min_region_size);\n            }\n\n            // Trim region to avoid invalid coordinates.\n            region.set(\"genome\", this.attributes.genome);\n            region.trim();\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Alias for set_elt for readbility.\n     */\n    set_data: function(region, entry) {\n        this.set_elt(region, entry);\n    },\n\n    /** \"Deep\" data request; used as a parameter for DataManager.get_more_data() */\n    DEEP_DATA_REQ: \"deep\",\n\n    /** \"Broad\" data request; used as a parameter for DataManager.get_more_data() */\n    BROAD_DATA_REQ: \"breadth\",\n\n    /**\n     * Gets more data for a region using either a depth-first or a breadth-first approach.\n     */\n    get_more_data: function(region, mode, resolution, extra_params, req_type) {\n        var cur_data = this._mark_stale(region);\n        if (!(cur_data && this.get(\"data_mode_compatible\")(cur_data, mode))) {\n            console.log(\"ERROR: problem with getting more data: current data is not compatible\");\n            return;\n        }\n\n        //\n        // Set parameters based on request type.\n        //\n        var query_low = region.get(\"start\");\n        if (req_type === this.DEEP_DATA_REQ) {\n            // Use same interval but set start_val to skip data that's already in cur_data.\n            $.extend(extra_params, {\n                start_val: cur_data.data.length + 1\n            });\n        } else if (req_type === this.BROAD_DATA_REQ) {\n            // To get past an area of extreme feature depth, set query low to be after either\n            // (a) the maximum high or HACK/FIXME (b) the end of the last feature returned.\n            query_low = (cur_data.max_high ? cur_data.max_high : cur_data.data[cur_data.data.length - 1][2]) + 1;\n        }\n        var query_region = region.copy().set(\"start\", query_low);\n\n        //\n        // Get additional data, append to current data, and set new data. Use a custom deferred object\n        // to signal when new data is available.\n        //\n        var data_manager = this;\n\n        var new_data_request = this.load_data(query_region, mode, resolution, extra_params);\n\n        var new_data_available = $.Deferred();\n        // load_data sets cache to new_data_request, but use custom deferred object so that signal and data\n        // is all data, not just new data.\n        this.set_data(region, new_data_available);\n        $.when(new_data_request).then(result => {\n            // Update data and message.\n            if (result.data) {\n                result.data = cur_data.data.concat(result.data);\n                if (result.max_low) {\n                    result.max_low = cur_data.max_low;\n                }\n                if (result.message) {\n                    // HACK: replace number in message with current data length. Works but is ugly.\n                    result.message = result.message.replace(/[0-9]+/, result.data.length);\n                }\n            }\n            data_manager.set_data(region, result);\n            new_data_available.resolve(result);\n        });\n        return new_data_available;\n    },\n\n    /**\n     * Returns true if more detailed data can be obtained for entry.\n     */\n    can_get_more_detailed_data: function(region) {\n        var cur_data = this.get_elt(region);\n\n        // Can only get more detailed data for bigwig data that has less than 8000 data points.\n        // Summary tree returns *way* too much data, and 8000 data points ~ 500KB.\n        return cur_data.dataset_type === \"bigwig\" && cur_data.data.length < 8000;\n    },\n\n    /**\n     * Returns more detailed data for an entry.\n     */\n    get_more_detailed_data: function(region, mode, resolution, detail_multiplier, extra_params) {\n        // Mark current entry as stale.\n        var cur_data = this._mark_stale(region);\n        if (!cur_data) {\n            console.log(\"ERROR getting more detailed data: no current data\");\n            return;\n        }\n\n        if (!extra_params) {\n            extra_params = {};\n        }\n\n        // Use additional parameters to get more detailed data.\n        if (cur_data.dataset_type === \"bigwig\") {\n            // FIXME: constant should go somewhere.\n            extra_params.num_samples = 1000 * detail_multiplier;\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Marks cache data as stale.\n     */\n    _mark_stale: function(region) {\n        var entry = this.get_elt(region);\n        if (!entry) {\n            console.log(\"ERROR: no data to mark as stale: \", this.get(\"dataset\"), region.toString());\n        }\n        entry.stale = true;\n        return entry;\n    },\n\n    /**\n     * Returns an array of data with each entry representing one chromosome/contig\n     * of data or, if data is not available, returns a Deferred that resolves to the\n     * data when it becomes available.\n     */\n    get_genome_wide_data: function(genome) {\n        // -- Get all data. --\n\n        var self = this;\n\n        var all_data_available = true;\n\n        var //  Map chromosome info into genome data.\n            gw_data = _.map(genome.get(\"chroms_info\").chrom_info, chrom_info => {\n                var chrom_data = self.get_elt(\n                    new GenomeRegion({\n                        chrom: chrom_info.chrom,\n                        start: 0,\n                        end: chrom_info.len\n                    })\n                );\n\n                // Set flag if data is not available.\n                if (!chrom_data) {\n                    all_data_available = false;\n                }\n\n                return chrom_data;\n            });\n\n        // -- If all data is available, return it. --\n        if (all_data_available) {\n            return gw_data;\n        }\n\n        // -- All data is not available, so load from server. --\n\n        var deferred = $.Deferred();\n        $.getJSON(this.get(\"dataset\").url(), { data_type: \"genome_data\" }, genome_wide_data => {\n            self.add_data(genome_wide_data.data);\n            deferred.resolve(genome_wide_data.data);\n        });\n\n        return deferred;\n    },\n\n    /**\n     * Returns entry with only data in the subregion.\n     */\n    subset_entry: function(entry, subregion) {\n        // Dictionary from entry type to function for subsetting data.\n        var subset_fns = {\n            bigwig: function(data, subregion) {\n                return _.filter(\n                    data,\n                    data_point => data_point[0] >= subregion.get(\"start\") && data_point[0] <= subregion.get(\"end\")\n                );\n            },\n            refseq: function(data, subregion) {\n                var seq_start = subregion.get(\"start\") - entry.region.get(\"start\");\n                return entry.data.slice(seq_start, seq_start + subregion.length());\n            }\n        };\n\n        // Subset entry if there is a function for subsetting and regions are not the same.\n        var subregion_data = entry.data;\n        if (!entry.region.same(subregion) && entry.dataset_type in subset_fns) {\n            subregion_data = subset_fns[entry.dataset_type](entry.data, subregion);\n        }\n\n        // Return entry with subregion's data.\n        return {\n            region: subregion,\n            data: subregion_data,\n            dataset_type: entry.dataset_type\n        };\n    }\n});\n\nvar GenomeReferenceDataManager = GenomeDataManager.extend({\n    initialize: function(options) {\n        // Use generic object in place of dataset and set urlRoot to fetch data.\n        var dataset_placeholder = new Backbone.Model();\n        dataset_placeholder.urlRoot = options.data_url;\n        this.set(\"dataset\", dataset_placeholder);\n    },\n\n    load_data: function(region, mode, resolution, extra_params) {\n        // Fetch data if region is not too large.\n        return region.length() <= 100000\n            ? GenomeDataManager.prototype.load_data.call(this, region, mode, resolution, extra_params)\n            : { data: null, region: region };\n    }\n});\n\n/**\n * A genome build.\n */\nvar Genome = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        key: null,\n        chroms_info: null\n    },\n\n    initialize: function(options) {\n        this.id = options.dbkey;\n    },\n\n    /**\n     * Shorthand for getting to chromosome information.\n     */\n    get_chroms_info: function() {\n        return this.attributes.chroms_info.chrom_info;\n    },\n\n    /**\n     * Returns a GenomeRegion object denoting a complete chromosome.\n     */\n    get_chrom_region: function(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        var chrom_info = _.find(this.get_chroms_info(), chrom_info => chrom_info.chrom === chr_name);\n        return new GenomeRegion({\n            chrom: chrom_info.chrom,\n            end: chrom_info.len\n        });\n    },\n\n    /** Returns the length of a chromosome. */\n    get_chrom_len: function(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        return _.find(this.get_chroms_info(), chrom_info => chrom_info.chrom === chr_name).len;\n    }\n});\n\n/**\n * A genomic region.\n */\nvar GenomeRegion = Backbone.Model.extend(\n    {\n        defaults: {\n            chrom: null,\n            start: 0,\n            end: 0,\n            str_val: null,\n            genome: null\n        },\n\n        /**\n         * Returns true if this region is the same as a given region.\n         * It does not test the genome right now.\n         */\n        same: function(region) {\n            return (\n                this.attributes.chrom === region.get(\"chrom\") &&\n                this.attributes.start === region.get(\"start\") &&\n                this.attributes.end === region.get(\"end\")\n            );\n        },\n\n        /**\n         * If from_str specified, use it to initialize attributes.\n         */\n        initialize: function(options) {\n            if (options.from_str) {\n                var pieces = options.from_str.split(\":\");\n                var chrom = pieces[0];\n                var start_end = pieces[1].split(\"-\");\n                this.set({\n                    chrom: chrom,\n                    start: parseInt(start_end[0], 10),\n                    end: parseInt(start_end[1], 10)\n                });\n            }\n\n            // Keep a copy of region's string value for fast lookup.\n            this.attributes.str_val = `${this.get(\"chrom\")}:${this.get(\"start\")}-${this.get(\"end\")}`;\n\n            // Set str_val on attribute change.\n            this.on(\n                \"change\",\n                function() {\n                    this.attributes.str_val = `${this.get(\"chrom\")}:${this.get(\"start\")}-${this.get(\"end\")}`;\n                },\n                this\n            );\n        },\n\n        copy: function() {\n            return new GenomeRegion({\n                chrom: this.get(\"chrom\"),\n                start: this.get(\"start\"),\n                end: this.get(\"end\")\n            });\n        },\n\n        length: function() {\n            return this.get(\"end\") - this.get(\"start\");\n        },\n\n        /** Returns region in canonical form chrom:start-end */\n        toString: function() {\n            return this.attributes.str_val;\n        },\n\n        toJSON: function() {\n            return {\n                chrom: this.get(\"chrom\"),\n                start: this.get(\"start\"),\n                end: this.get(\"end\")\n            };\n        },\n\n        /**\n         * Compute the type of overlap between this region and another region. The overlap is computed relative to the given/second region;\n         * hence, OVERLAP_START indicates that the first region overlaps the start (but not the end) of the second region.\n         */\n        compute_overlap: function(a_region) {\n            var first_chrom = this.get(\"chrom\");\n            var second_chrom = a_region.get(\"chrom\");\n            var first_start = this.get(\"start\");\n            var second_start = a_region.get(\"start\");\n            var first_end = this.get(\"end\");\n            var second_end = a_region.get(\"end\");\n            var overlap;\n\n            // Compare chroms.\n            if (first_chrom && second_chrom && first_chrom !== second_chrom) {\n                return GenomeRegion.overlap_results.DIF_CHROMS;\n            }\n\n            // Compare regions.\n            if (first_start < second_start) {\n                if (first_end < second_start) {\n                    overlap = GenomeRegion.overlap_results.BEFORE;\n                } else if (first_end < second_end) {\n                    overlap = GenomeRegion.overlap_results.OVERLAP_START;\n                } else {\n                    // first_end >= second_end\n                    overlap = GenomeRegion.overlap_results.CONTAINS;\n                }\n            } else if (first_start > second_start) {\n                if (first_start > second_end) {\n                    overlap = GenomeRegion.overlap_results.AFTER;\n                } else if (first_end <= second_end) {\n                    overlap = GenomeRegion.overlap_results.CONTAINED_BY;\n                } else {\n                    overlap = GenomeRegion.overlap_results.OVERLAP_END;\n                }\n            } else {\n                // first_start === second_start\n                overlap =\n                    first_end >= second_end\n                        ? GenomeRegion.overlap_results.CONTAINS\n                        : GenomeRegion.overlap_results.CONTAINED_BY;\n            }\n\n            return overlap;\n        },\n\n        /**\n         * Trim a region to match genome's constraints.\n         */\n        trim: function(genome) {\n            // Assume that all chromosome/contigs start at 0.\n            if (this.attributes.start < 0) {\n                this.attributes.start = 0;\n            }\n\n            // Only try to trim the end if genome is set.\n            if (this.attributes.genome) {\n                var chrom_len = this.attributes.genome.get_chrom_len(this.attributes.chrom);\n                if (this.attributes.end > chrom_len) {\n                    this.attributes.end = chrom_len - 1;\n                }\n            }\n\n            return this;\n        },\n\n        /**\n         * Returns true if this region contains a given region.\n         */\n        contains: function(a_region) {\n            return this.compute_overlap(a_region) === GenomeRegion.overlap_results.CONTAINS;\n        },\n\n        /**\n         * Returns true if regions overlap.\n         */\n        overlaps: function(a_region) {\n            return (\n                _.intersection(\n                    [this.compute_overlap(a_region)],\n                    [\n                        GenomeRegion.overlap_results.DIF_CHROMS,\n                        GenomeRegion.overlap_results.BEFORE,\n                        GenomeRegion.overlap_results.AFTER\n                    ]\n                ).length === 0\n            );\n        }\n    },\n    {\n        overlap_results: {\n            DIF_CHROMS: 1000,\n            BEFORE: 1001,\n            CONTAINS: 1002,\n            OVERLAP_START: 1003,\n            OVERLAP_END: 1004,\n            CONTAINED_BY: 1005,\n            AFTER: 1006\n        }\n    }\n);\n\nvar GenomeRegionCollection = Backbone.Collection.extend({\n    model: GenomeRegion\n});\n\n/**\n * A genome browser bookmark.\n */\nvar BrowserBookmark = Backbone.Model.extend({\n    defaults: {\n        region: null,\n        note: \"\"\n    },\n\n    initialize: function(options) {\n        this.set(\"region\", new GenomeRegion(options.region));\n    }\n});\n\n/**\n * Bookmarks collection.\n */\nvar BrowserBookmarkCollection = Backbone.Collection.extend({\n    model: BrowserBookmark\n});\n\n/**\n * A track of data in a genome visualization.\n */\n// TODO: rename to Track and merge with Trackster's Track object.\nvar BackboneTrack = Backbone.Model.extend(CustomToJSON).extend(\n    {\n        defaults: {\n            mode: \"Auto\"\n        },\n\n        initialize: function(options) {\n            this.set(\"dataset\", new Dataset(options.dataset));\n\n            // -- Set up config settings. --\n            var models = [\n                {\n                    key: \"name\",\n                    default_value: this.get(\"dataset\").get(\"name\")\n                },\n                { key: \"color\" },\n                {\n                    key: \"min_value\",\n                    label: \"Min Value\",\n                    type: \"float\",\n                    default_value: 0\n                },\n                {\n                    key: \"max_value\",\n                    label: \"Max Value\",\n                    type: \"float\",\n                    default_value: 1\n                }\n            ];\n\n            this.set(\"config\", config_mod.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n            // -- Set up data manager. --\n            var preloaded_data = this.get(\"preloaded_data\");\n            if (preloaded_data) {\n                preloaded_data = preloaded_data.data;\n            } else {\n                preloaded_data = [];\n            }\n            this.set(\n                \"data_manager\",\n                new GenomeDataManager({\n                    dataset: this.get(\"dataset\"),\n                    init_data: preloaded_data\n                })\n            );\n        }\n    },\n    {\n        // This definition matches that produced by to_dict() methods in tracks.js\n        to_json_keys: [\"track_type\", \"dataset\", \"prefs\", \"mode\", \"filters\", \"tool_state\"],\n        to_json_mappers: {\n            prefs: function(p, self) {\n                if (_.size(p) === 0) {\n                    p = {\n                        name: self\n                            .get(\"config\")\n                            .get(\"name\")\n                            .get(\"value\"),\n                        color: self\n                            .get(\"config\")\n                            .get(\"color\")\n                            .get(\"value\")\n                    };\n                }\n                return p;\n            },\n            dataset: function(d) {\n                return {\n                    id: d.id,\n                    hda_ldda: d.get(\"hda_ldda\")\n                };\n            }\n        }\n    }\n);\n\nvar BackboneTrackCollection = Backbone.Collection.extend({\n    model: BackboneTrack\n});\n\n/**\n * A visualization.\n */\nvar Visualization = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        type: \"\"\n    },\n\n    urlRoot: `${getAppRoot()}api/visualizations`,\n\n    /**\n     * POSTs visualization's JSON to its URL using the parameter 'vis_json'\n     * Note: This is necessary because (a) Galaxy requires keyword args and\n     * (b) Galaxy does not handle PUT now.\n     */\n    save: function() {\n        return $.ajax({\n            url: this.url(),\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                vis_json: JSON.stringify(this)\n            }\n        });\n    }\n});\n\n/**\n * A visualization of genome data.\n */\nvar GenomeVisualization = Visualization.extend(CustomToJSON).extend(\n    {\n        defaults: _.extend({}, Visualization.prototype.defaults, {\n            dbkey: \"\",\n            drawables: null,\n            bookmarks: null,\n            viewport: null\n        }),\n\n        initialize: function(options) {\n            // Replace drawables with tracks.\n            this.set(\"drawables\", new BackboneTrackCollection(options.tracks));\n\n            var models = [];\n            this.set(\"config\", config_mod.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n            // Clear track and data definitions to avoid storing large objects.\n            this.unset(\"tracks\");\n            this.get(\"drawables\").each(d => {\n                d.unset(\"preloaded_data\");\n            });\n        },\n\n        /**\n         * Add a track or array of tracks to the visualization.\n         */\n        add_tracks: function(tracks) {\n            this.get(\"drawables\").add(tracks);\n        }\n    },\n    {\n        // This definition matches that produced by to_dict() methods in tracks.js\n        to_json_keys: [\"view\", \"viewport\", \"bookmarks\"],\n\n        to_json_mappers: {\n            view: function(dummy, self) {\n                return {\n                    obj_type: \"View\",\n                    prefs: {\n                        name: self.get(\"title\"),\n                        content_visible: true\n                    },\n                    drawables: self.get(\"drawables\")\n                };\n            }\n        }\n    }\n);\n\n/**\n * -- Routers --\n */\n\n/**\n * Router for track browser.\n */\nvar TrackBrowserRouter = Backbone.Router.extend({\n    initialize: function(options) {\n        this.view = options.view;\n\n        // Can't put regular expression in routes dictionary.\n        // NOTE: parentheses are used to denote parameters returned to callback.\n        this.route(/([\\w]+)$/, \"change_location\");\n        this.route(/([\\w+]+:[\\d,]+-[\\d,]+)$/, \"change_location\");\n\n        // Handle navigate events from view.\n        this.view.on(\"navigate\", new_loc => {\n            this.navigate(new_loc);\n        });\n    },\n\n    change_location: function(new_loc) {\n        this.view.go_to(new_loc);\n    }\n});\n\nexport default {\n    BackboneTrack: BackboneTrack,\n    BrowserBookmark: BrowserBookmark,\n    BrowserBookmarkCollection: BrowserBookmarkCollection,\n    Cache: Cache,\n    CanvasManager: CanvasManager,\n    Genome: Genome,\n    GenomeDataManager: GenomeDataManager,\n    GenomeRegion: GenomeRegion,\n    GenomeRegionCollection: GenomeRegionCollection,\n    GenomeVisualization: GenomeVisualization,\n    GenomeReferenceDataManager: GenomeReferenceDataManager,\n    TrackBrowserRouter: TrackBrowserRouter,\n    Visualization: Visualization,\n    select_datasets: select_datasets\n};\n","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\nvar _l = window._l || (s => s);\n\n//TODO: consolidate with tool menu functionality, use there\n\n/** searchInput: (jQuery plugin)\n *      Creates a search input, a clear button, and loading indicator\n *      within the selected node.\n *\n *      When the user either presses return or enters some minimal number\n *      of characters, a callback is called. Pressing ESC when the input\n *      is focused will clear the input and call a separate callback.\n */\nfunction searchInput(parentNode, options) {\n    var KEYCODE_ESC = 27;\n    var KEYCODE_RETURN = 13;\n    var $parentNode = $(parentNode);\n    var firstSearch = true;\n\n    var defaults = {\n        initialVal: \"\",\n        name: \"search\",\n        placeholder: \"search\",\n        classes: \"\",\n        onclear: function() {},\n        onfirstsearch: null,\n        onsearch: function(inputVal) {},\n        minSearchLen: 0,\n        escWillClear: true,\n        oninit: function() {}\n    };\n\n    // .................................................................... input rendering and events\n    // visually clear the search, trigger an event, and call the callback\n    function clearSearchInput(event) {\n        var $input = $(this)\n            .parent()\n            .children(\"input\");\n        $input\n            .val(\"\")\n            .trigger(\"searchInput.clear\")\n            .blur();\n        options.onclear();\n    }\n\n    // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n    function search(event, searchTerms) {\n        if (!searchTerms) {\n            return clearSearchInput();\n        }\n        $(this).trigger(\"search.search\", searchTerms);\n        if (typeof options.onfirstsearch === \"function\" && firstSearch) {\n            firstSearch = false;\n            options.onfirstsearch(searchTerms);\n        } else {\n            options.onsearch(searchTerms);\n        }\n    }\n\n    // .................................................................... input rendering and events\n    function inputTemplate() {\n        // class search-query is bootstrap 2.3 style that now lives in base.less\n        return [\n            '<input type=\"text\" name=\"',\n            options.name,\n            '\" placeholder=\"',\n            options.placeholder,\n            '\" ',\n            'class=\"search-query ',\n            options.classes,\n            '\" ',\n            \"/>\"\n        ].join(\"\");\n    }\n\n    // the search input that responds to keyboard events and displays the search value\n    function $input() {\n        return (\n            $(inputTemplate())\n                // select all text on a focus\n                .focus(function(event) {\n                    $(this).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup(function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n\n                    // esc key will clear if desired\n                    if (event.which === KEYCODE_ESC && options.escWillClear) {\n                        clearSearchInput.call(this, event);\n                    } else {\n                        var searchTerms = $(this).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if (\n                            event.which === KEYCODE_RETURN ||\n                            (options.minSearchLen && searchTerms.length >= options.minSearchLen)\n                        ) {\n                            search.call(this, event, searchTerms);\n                        }\n                    }\n                })\n                .val(options.initialVal)\n        );\n    }\n\n    // .................................................................... clear button rendering and events\n    // a button for clearing the search bar, placed on the right hand side\n    function $clearBtn() {\n        return $(\n            ['<span class=\"search-clear fa fa-times-circle\" ', 'title=\"', _l(\"clear search (esc)\"), '\"></span>'].join(\n                \"\"\n            )\n        )\n            .tooltip({ placement: \"bottom\" })\n            .click(function(event) {\n                clearSearchInput.call(this, event);\n            });\n    }\n\n    // .................................................................... loadingIndicator rendering\n    // a button for clearing the search bar, placed on the right hand side\n    function $loadingIndicator() {\n        return $(\n            ['<span class=\"search-loading fa fa-spinner fa-spin\" ', 'title=\"', _l(\"loading...\"), '\"></span>'].join(\"\")\n        )\n            .hide()\n            .tooltip({ placement: \"bottom\" });\n    }\n\n    // .................................................................... commands\n    // visually swap the load, clear buttons\n    function toggleLoadingIndicator() {\n        $parentNode.find(\".search-loading\").toggle();\n        $parentNode.find(\".search-clear\").toggle();\n    }\n\n    // .................................................................... init\n    // string command (not constructor)\n    if (jQuery.type(options) === \"string\") {\n        if (options === \"toggle-loading\") {\n            toggleLoadingIndicator();\n        }\n        return $parentNode;\n    }\n\n    // initial render\n    if (jQuery.type(options) === \"object\") {\n        options = jQuery.extend(true, {}, defaults, options);\n    }\n    //NOTE: prepended\n    return $parentNode.addClass(\"search-input\").prepend([$input(), $clearBtn(), $loadingIndicator()]);\n}\n\n// as jq plugin\njQuery.fn.extend({\n    searchInput: function $searchInput(options) {\n        return this.each(function() {\n            return searchInput(this, options);\n        });\n    }\n});\n","/**\n    This is the base class of the tool form plugin. This class is e.g. inherited by the regular and the workflow tool form.\n*/\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\n// import Utils from \"utils/utils\";\nimport Deferred from \"utils/deferred\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport FormBase from \"mvc/form/form-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport Citations from \"components/Citations.vue\";\nimport Vue from \"vue\";\nimport axios from \"axios\";\n\nexport default FormBase.extend({\n    initialize: function(options) {\n        let Galaxy = getGalaxyInstance();\n        var self = this;\n        this.deferred = new Deferred();\n        FormBase.prototype.initialize.call(this, options);\n\n        // optional model update\n        this._update(this.model.get(\"initialmodel\"));\n\n        // listen to history panel\n        if (this.model.get(\"listen_to_history\") && Galaxy && Galaxy.currHistoryPanel) {\n            this.listenTo(Galaxy.currHistoryPanel.collection, \"change\", () => {\n                self.model.get(\"onchange\")();\n            });\n        }\n        // destroy dom elements\n        this.$el.on(\"remove\", () => {\n            self._destroy();\n        });\n    },\n\n    /** Allows tool form variation to update tool model */\n    _update: function(callback) {\n        var self = this;\n        callback = callback || this.model.get(\"buildmodel\");\n        if (callback) {\n            this.deferred.reset();\n            this.deferred.execute(process => {\n                callback(process, self);\n                process.then(() => {\n                    self._render();\n                });\n            });\n        } else {\n            this._render();\n        }\n    },\n\n    /** Wait for deferred build processes before removal */\n    _destroy: function() {\n        var self = this;\n        this.$el.off().hide();\n        this.deferred.execute(() => {\n            FormBase.prototype.remove.call(self);\n            let Galaxy = getGalaxyInstance();\n            Galaxy.emit.debug(\"tool-form-base::_destroy()\", \"Destroy view.\");\n        });\n    },\n\n    /** Build form */\n    _render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.model.set({\n            title:\n                options.fixed_title ||\n                `<b>${options.name}</b> ${options.description} (Galaxy Version ${options.version})`,\n            operations: !options.hide_operations && this._operations(),\n            onchange: function() {\n                let Galaxy = getGalaxyInstance();\n                self.deferred.reset();\n                self.deferred.execute(process => {\n                    self.model.get(\"postchange\")(process, self);\n                    if (self.model.get(\"listen_to_history\")) {\n                        process.then(() => {\n                            self.stopListening(Galaxy.currHistoryPanel.collection);\n                        });\n                    }\n                });\n            }\n        });\n        this.render();\n        if (!this.model.get(\"collapsible\")) {\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"mt-2\")\n                    .append(this._footer())\n            );\n        }\n        options.tool_errors &&\n            this.message.update({\n                status: \"danger\",\n                message: options.tool_errors,\n                persistent: true\n            });\n        this.show_message &&\n            this.message.update({\n                status: \"success\",\n                message: `Now you are using '${options.name}' version ${options.version}, id '${options.id}'.`,\n                persistent: false\n            });\n        this.show_message = true;\n    },\n\n    /** Create tool operation menu */\n    _operations: function() {\n        var self = this;\n        var options = this.model.attributes;\n        let Galaxy = getGalaxyInstance();\n\n        // Buttons for adding and removing favorite.\n        let in_favorites = Galaxy.user.getFavorites().tools.indexOf(options.id) >= 0;\n        var favorite_button = new Ui.Button({\n            icon: \"fa-star-o\",\n            title: options.narrow ? null : \"Favorite\",\n            tooltip: \"Add to favorites\",\n            visible: !Galaxy.user.isAnonymous() && !in_favorites,\n            onclick: () => {\n                axios\n                    .put(`${Galaxy.root}api/users/${Galaxy.user.id}/favorites/tools`, { object_id: options.id })\n                    .then(response => {\n                        favorite_button.hide();\n                        remove_favorite_button.show();\n                        Galaxy.user.updateFavorites(\"tools\", response.data);\n                    });\n            }\n        });\n\n        var remove_favorite_button = new Ui.Button({\n            icon: \"fa-star\",\n            title: options.narrow ? null : \"Added\",\n            tooltip: \"Remove from favorites\",\n            visible: !Galaxy.user.isAnonymous() && in_favorites,\n            onclick: () => {\n                axios\n                    .delete(\n                        `${Galaxy.root}api/users/${Galaxy.user.id}/favorites/tools/${encodeURIComponent(options.id)}`\n                    )\n                    .then(response => {\n                        remove_favorite_button.hide();\n                        favorite_button.show();\n                        Galaxy.user.updateFavorites(\"tools\", response.data);\n                    });\n            }\n        });\n\n        // button for version selection\n        var versions_button = new Ui.ButtonMenu({\n            icon: \"fa-cubes\",\n            title: options.narrow ? null : \"Versions\",\n            tooltip: \"Select another tool version\"\n        });\n\n        if (!options.sustain_version && options.versions && options.versions.length > 1) {\n            for (var i in options.versions) {\n                var version = options.versions[i];\n                if (version != options.version) {\n                    versions_button.addMenu({\n                        title: `Switch to ${version}`,\n                        version: version,\n                        icon: \"fa-cube\",\n                        onclick: function() {\n                            // here we update the tool version (some tools encode the version also in the id)\n                            self.model.set(\"id\", options.id.replace(options.version, this.version));\n                            self.model.set(\"version\", this.version);\n                            self._update();\n                        }\n                    });\n                }\n            }\n        } else {\n            versions_button.$el.hide();\n        }\n\n        // button for options e.g. search, help\n        var menu_button = new Ui.ButtonMenu({\n            id: \"options\",\n            icon: \"fa-caret-down\",\n            title: options.narrow ? null : \"Options\",\n            tooltip: \"View available options\"\n        });\n        menu_button.addMenu({\n            icon: \"fa-share\",\n            title: _l(\"Share\"),\n            onclick: function() {\n                prompt(\n                    \"Copy to clipboard: Ctrl+C, Enter\",\n                    `${window.location.origin + getAppRoot()}root?tool_id=${options.id}`\n                );\n            }\n        });\n\n        // add admin operations\n        if (Galaxy.user && Galaxy.user.get(\"is_admin\")) {\n            menu_button.addMenu({\n                icon: \"fa-download\",\n                title: _l(\"Download\"),\n                onclick: function() {\n                    window.location.href = `${getAppRoot()}api/tools/${options.id}/download`;\n                }\n            });\n        }\n\n        // button for version selection\n        if (options.requirements && options.requirements.length > 0) {\n            menu_button.addMenu({\n                icon: \"fa-info-circle\",\n                title: _l(\"Requirements\"),\n                onclick: function() {\n                    if (!this.requirements_visible || self.portlet.collapsed) {\n                        this.requirements_visible = true;\n                        self.portlet.expand();\n                        self.message.update({\n                            persistent: true,\n                            message: self._templateRequirements(options),\n                            status: \"info\"\n                        });\n                    } else {\n                        this.requirements_visible = false;\n                        self.message.update({ message: \"\" });\n                    }\n                }\n            });\n        }\n\n        // add toolshed url\n        if (options.sharable_url) {\n            menu_button.addMenu({\n                icon: \"fa-external-link\",\n                title: _l(\"See in Tool Shed\"),\n                onclick: function() {\n                    window.open(options.sharable_url);\n                }\n            });\n        }\n\n        // add tool menu webhooks\n        Webhooks.load({\n            type: \"tool-menu\",\n            callback: function(webhooks) {\n                webhooks.each(model => {\n                    var webhook = model.toJSON();\n                    if (webhook.activate && webhook.config.function) {\n                        menu_button.addMenu({\n                            icon: webhook.config.icon,\n                            title: webhook.config.title,\n                            onclick: function() {\n                                var func = new Function(\"options\", webhook.config.function);\n                                func(options);\n                            }\n                        });\n                    }\n                });\n            }\n        });\n\n        return {\n            menu: menu_button,\n            versions: versions_button,\n            favorite: favorite_button,\n            remove_favorite: remove_favorite_button\n        };\n    },\n\n    /** Create footer */\n    _footer: function() {\n        var options = this.model.attributes;\n        var $el = $(\"<div/>\").append(this._templateHelp(options));\n        if (options.citations) {\n            var citationInstance = Vue.extend(Citations);\n            var vm = document.createElement(\"div\");\n            $el.append(vm);\n            new citationInstance({\n                propsData: {\n                    id: options.id,\n                    source: \"tools\"\n                }\n            }).$mount(vm);\n        }\n        return $el;\n    },\n\n    /** Templates */\n    _templateHelp: function(options) {\n        var $tmpl = $(\"<div/>\")\n            .addClass(\"form-help form-text mt-4\")\n            .append(options.help);\n        $tmpl.find(\"a\").attr(\"target\", \"_blank\");\n        $tmpl.find(\"img\").each(function() {\n            var img_src = $(this).attr(\"src\");\n            if (img_src.indexOf(\"admin_toolshed\") !== -1) {\n                $(this).attr(\"src\", getAppRoot() + img_src);\n            }\n        });\n        return $tmpl;\n    },\n\n    _templateRequirements: function(options) {\n        var nreq = options.requirements.length;\n        if (nreq > 0) {\n            var requirements_message = \"This tool requires \";\n            _.each(options.requirements, (req, i) => {\n                requirements_message +=\n                    req.name +\n                    (req.version ? ` (Version ${req.version})` : \"\") +\n                    (i < nreq - 2 ? \", \" : i == nreq - 2 ? \" and \" : \"\");\n            });\n            var requirements_link = $(\"<a/>\")\n                .attr(\"target\", \"_blank\")\n                .attr(\"href\", \"https://galaxyproject.org/tools/requirements/\")\n                .text(\"here\");\n            return $(\"<span/>\")\n                .append(`${requirements_message}. Click `)\n                .append(requirements_link)\n                .append(\" for more information.\");\n        }\n        return \"No requirements found.\";\n    }\n});\n","/*global window, jQuery, console */\n/*=============================================================================\nTODO:\n    while anon: logs saved to 'logs-null' - this will never post\n        unless we manually do so at/after login\n        OR prepend when userId and localStorage has 'logs-null'\n    wire up _delayPost and test\n\n=============================================================================*/\n/** @class MetricsLogger\n *\n *  Object to cache, output, and post log/metric messages to the server.\n *  Meant to be attached to the Galaxy object.\n *\n *  Log from objects by either attaching logger directly:\n *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n *  or using the LoggableMixin or addLogging function:\n *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n *      addLogging( MyBackboneModel, 'my-backbone-model' )\n *\n *  Log from templates by calling directly from Galaxy object:\n *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n *\n *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n *  appropriately, a warning will be shown when this happens:\n *      > panel.metric( 'something weird with window', { window : window })\n *      !'Metrics logger could not stringify logArguments: ...'\n */\nfunction MetricsLogger(options) {\n    options = options || {};\n    var self = this;\n\n    ///** get the current user's id from bootstrapped data or options */\n    self.userId = window.bootstrapped && window.bootstrapped.user ? window.bootstrapped.user.id : null;\n    self.userId = self.userId || options.userId || null;\n\n    /** the (optional) console to emit logs to */\n    self.consoleLogger = options.consoleLogger || null;\n\n    self._init(options);\n    return self;\n}\n\n//----------------------------------------------------------------------------- defaults and constants\n// see: python std lib, logging\nMetricsLogger.ALL = 0;\nMetricsLogger.LOG = 0;\nMetricsLogger.DEBUG = 10;\nMetricsLogger.INFO = 20;\nMetricsLogger.WARN = 30;\nMetricsLogger.ERROR = 40;\n// metrics levels here?\n//MetricsLogger.MinorEvent  = 45;\n//MetricsLogger.MajorEvent  = 50;\nMetricsLogger.METRIC = 50;\nMetricsLogger.NONE = 100;\n\n/** default options - override these through the constructor */\nMetricsLogger.defaultOptions = {\n    /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n    logLevel: MetricsLogger.NONE,\n    /** if an incoming message has a level >= this, it will be output to the console */\n    consoleLevel: MetricsLogger.NONE,\n    /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n    defaultNamespace: \"Galaxy\",\n    /** the namespaces output to the console (all namespaces will be output if this is falsy)\n     *  note: applies only to the console (not the event/metrics log/cache)\n     */\n    consoleNamespaceWhitelist: null,\n    /** Force all messages into simple strings. */\n    consoleFlattenMessages: false,\n    /** the prefix attached to client-side logs to distinguish them in the metrics db */\n    clientPrefix: \"client.\",\n\n    /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n    maxCacheSize: 3000,\n    /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n    postSize: 1000,\n    /** T/F whether to add a timestamp to incoming cached messages */\n    addTime: true,\n    /** string to prefix to userid for cache web storage */\n    cacheKeyPrefix: \"logs-\",\n\n    /** the relative url to post messages to */\n    postUrl: \"/api/metrics\",\n    /** delay before trying post again after two failures */\n    delayPostInMs: 1000 * 60 * 10,\n\n    /** an (optional) function that should return an object; used to send additional data with the metrics */\n    getPingData: undefined,\n    /** an (optional) function that will handle the servers response after successfully posting messages */\n    onServerResponse: undefined\n};\n\n//----------------------------------------------------------------------------- set up\n/** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\nMetricsLogger.prototype._init = function _init(options) {\n    var self = this;\n    self.options = {};\n    for (var k in MetricsLogger.defaultOptions) {\n        if (MetricsLogger.defaultOptions.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : MetricsLogger.defaultOptions[k];\n        }\n    }\n    self.options.logLevel = self._parseLevel(self.options.logLevel);\n    self.options.consoleLevel = self._parseLevel(self.options.consoleLevel);\n    //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\n    /** is the logger currently sending? */\n    self._sending = false;\n    /** the setTimeout id if the logger POST has failed more than once */\n    self._waiting = null;\n    /** the current number of entries to send in a POST */\n    self._postSize = self.options.postSize;\n\n    self._initCache();\n\n    return self;\n};\n\n/** initialize the cache */\nMetricsLogger.prototype._initCache = function _initCache() {\n    try {\n        this.cache = new LoggingCache({\n            maxSize: this.options.maxCacheSize,\n            key: this.options.cacheKeyPrefix + this.userId\n        });\n    } catch (err) {\n        this._emitToConsole(\"warn\", \"MetricsLogger\", [\"Could not intitialize logging cache:\", err]);\n        this.options.logLevel = MetricsLogger.NONE;\n    }\n};\n\n/** return the numeric log level if level in 'none, debug, log, info, warn, error' */\nMetricsLogger.prototype._parseLevel = function _parseLevel(level) {\n    var type = typeof level;\n    if (type === \"number\") {\n        return level;\n    }\n    if (type === \"string\") {\n        var upper = level.toUpperCase();\n        if (MetricsLogger.hasOwnProperty(upper)) {\n            return MetricsLogger[upper];\n        }\n    }\n    throw new Error(`Unknown log level: ${level}`);\n};\n\n//----------------------------------------------------------------------------- main entry point\n/** record a log/message's arguments to the cache and/or the console based on level and namespace */\nMetricsLogger.prototype.emit = function emit(level, namespace, logArguments) {\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n    var self = this;\n    namespace = namespace || self.options.defaultNamespace;\n    if (!level || !logArguments) {\n        return self;\n    }\n    // add to cache if proper level\n    //TODO: respect do not track?\n    //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n    level = self._parseLevel(level);\n    if (level >= self.options.logLevel) {\n        self._addToCache(level, namespace, logArguments);\n    }\n    // also emit to consoleLogger if proper level for that\n    if (self.consoleLogger && level >= self.options.consoleLevel) {\n        self._emitToConsole(level, namespace, logArguments);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- cache\n/** add a message to the cache and if messages.length is high enough post them to the server */\nMetricsLogger.prototype._addToCache = function _addToCache(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\n        \"_addToCache:\",\n        arguments,\n        this.options.addTime,\n        this.cache.length()\n    ]);\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n    var self = this;\n    // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n    try {\n        var newLength = self.cache.add(self._buildEntry(level, namespace, logArguments));\n        if (newLength >= self._postSize) {\n            self._postCache();\n        }\n        // discard entry if an error occurs, but warn if level set to do so\n    } catch (err) {\n        self._emitToConsole(\"warn\", \"MetricsLogger\", [\n            \"Metrics logger could not stringify logArguments:\",\n            namespace,\n            logArguments\n        ]);\n        self._emitToConsole(\"error\", \"MetricsLogger\", [err]);\n    }\n    return self;\n};\n\n/** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\nMetricsLogger.prototype._buildEntry = function _buildEntry(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\"_buildEntry:\", arguments]);\n    var entry = {\n        level: level,\n        namespace: this.options.clientPrefix + namespace,\n        args: logArguments\n    };\n    if (this.options.addTime) {\n        entry.time = new Date().toISOString();\n    }\n    return entry;\n};\n\n/** post _postSize messages from the cache to the server, removing them if successful\n *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n *      onServerResponse will be called (if set) with any response from the server\n */\nMetricsLogger.prototype._postCache = function _postCache(options) {\n    options = options || {};\n    this._emitToConsole(\"info\", \"MetricsLogger\", [\"_postCache\", options, this._postSize]);\n\n    // short circuit if we're already sending\n    if (!this.options.postUrl || this._sending) {\n        return jQuery.when({});\n    }\n\n    var self = this;\n    var postSize = options.count || self._postSize;\n\n    var // do not splice - remove after *successful* post\n        entries = self.cache.get(postSize);\n\n    var entriesLength = entries.length;\n\n    var // use the optional getPingData to add any extra info we may want to send\n        postData = typeof self.options.getPingData === \"function\" ? self.options.getPingData() : {};\n\n    //console.debug( postSize, entriesLength );\n\n    // add the metrics and send\n    postData.metrics = JSON.stringify(entries);\n    //console.debug( postData.metrics );\n    self._sending = true;\n    return jQuery\n        .post(self.options.postUrl, postData)\n        .always(() => {\n            self._sending = false;\n        })\n        .fail((xhr, status, message) => {\n            // if we failed the previous time, set the next post target to the max num of entries\n            self._postSize = self.options.maxCacheSize;\n            //TODO:??\n            // log this failure to explain any gap in metrics\n            self.emit(\"error\", \"MetricsLogger\", [\n                \"_postCache error:\",\n                xhr.readyState,\n                xhr.status,\n                xhr.responseJSON || xhr.responseText\n            ]);\n            //TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n            //TODO: see _delayPost\n        })\n        .done(response => {\n            if (typeof self.options.onServerResponse === \"function\") {\n                self.options.onServerResponse(response);\n            }\n            // only remove if post successful\n            self.cache.remove(entriesLength);\n            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n            // if we succeeded, reset the post target to the normal num of entries\n            self._postSize = self.options.postSize;\n        });\n    // return the xhr promise\n};\n\n/** set _waiting to true and, after delayPostInMs, set it back to false */\nMetricsLogger.prototype._delayPost = function _delayPost() {\n    //TODO: this won't work between pages\n    var self = this;\n    self._waiting = setTimeout(() => {\n        self._waiting = null;\n    }, self.options.delayPostInMs);\n};\n\nfunction usefulToString(arg) {\n    var asStr = String(arg);\n    if (asStr == \"[object Object]\") {\n        asStr = JSON.stringify(arg);\n    }\n    return asStr;\n}\n\n//----------------------------------------------------------------------------- console\n/** output message to console based on level and consoleLogger type */\nMetricsLogger.prototype._emitToConsole = function _emitToConsole(level, namespace, logArguments) {\n    //console.debug( '_emitToConsole:', level, namespace, logArguments );\n    var self = this;\n\n    var whitelist = self.options.consoleNamespaceWhitelist;\n    if (!self.consoleLogger) {\n        return self;\n    }\n    // if a whitelist for namespaces is set, bail if this namespace is not in the list\n    if (whitelist && whitelist.indexOf(namespace) === -1) {\n        return self;\n    }\n\n    var args = Array.prototype.slice.call(logArguments, 0);\n    args.unshift(namespace);\n    if (self.options.consoleFlattenMessages) {\n        args = [args.map(usefulToString).join(\" \")];\n    }\n    //TODO: script location and/or source maps?\n    //TODO: branch on navigator.userAgent == AIIEEE - it only has log\n    if (level >= MetricsLogger.METRIC && typeof self.consoleLogger.info === \"function\") {\n        return self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.ERROR && typeof self.consoleLogger.error === \"function\") {\n        return self.consoleLogger.error.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.WARN && typeof self.consoleLogger.warn === \"function\") {\n        self.consoleLogger.warn.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.INFO && typeof self.consoleLogger.info === \"function\") {\n        self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.DEBUG && typeof self.consoleLogger.debug === \"function\") {\n        self.consoleLogger.debug.apply(self.consoleLogger, args);\n    } else if (typeof self.consoleLogger.log === \"function\") {\n        self.consoleLogger.log.apply(self.consoleLogger, args);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- shortcuts\n// generic functions when logging from non-namespaced object (e.g. templates)\n/** log to default namespace */\nMetricsLogger.prototype.log = function log() {\n    this.emit(1, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** debug to default namespace */\nMetricsLogger.prototype.debug = function debug() {\n    this.emit(MetricsLogger.DEBUG, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** info to default namespace */\nMetricsLogger.prototype.info = function info() {\n    this.emit(MetricsLogger.INFO, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** warn to default namespace */\nMetricsLogger.prototype.warn = function warn() {\n    this.emit(MetricsLogger.WARN, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** error to default namespace */\nMetricsLogger.prototype.error = function error() {\n    this.emit(MetricsLogger.ERROR, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** metric to default namespace */\nMetricsLogger.prototype.metric = function metric() {\n    this.emit(MetricsLogger.METRIC, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/* ============================================================================\nTODO:\n    need a performance pass - the JSON un/parsing is a bit much\n\n============================================================================ */\n/** @class LoggingCache\n *  Simple implementation of cache wrapping an array.\n *\n *  Formats an entry before it's cached and only keeps options.maxSize number\n *  of entries. Older entries are deleted first.\n */\nfunction LoggingCache(options) {\n    var self = this;\n    return self._init(options || {});\n}\n\n/** default options */\nLoggingCache.defaultOptions = {\n    /** maximum number of entries to keep before discarding oldest */\n    maxSize: 5000\n};\n\n/** initialize with options */\nLoggingCache.prototype._init = function _init(options) {\n    if (!this._hasStorage()) {\n        //TODO: fall back to local storage\n        throw new Error(\"LoggingCache needs localStorage\");\n    }\n    if (!options.key) {\n        throw new Error(\"LoggingCache needs key for localStorage\");\n    }\n    this.key = options.key;\n    this._initStorage();\n\n    this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n    return this;\n};\n\n/** tests for localStorage fns */\nLoggingCache.prototype._hasStorage = function _hasStorage() {\n    //TODO: modernizr\n    var test = \"test\";\n    try {\n        localStorage.setItem(test, test);\n        localStorage.removeItem(test);\n        return true;\n    } catch (e) {\n        return false;\n    }\n};\n\n/** if no localStorage set for key, initialize to empty array */\nLoggingCache.prototype._initStorage = function _initStorage() {\n    if (localStorage.getItem(this.key) === null) {\n        return this.empty();\n    }\n    return this;\n};\n\n/** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\nLoggingCache.prototype.add = function add(entry) {\n    var self = this;\n    var _cache = self._fetchAndParse();\n    var overage = _cache.length + 1 - self.maxSize;\n    if (overage > 0) {\n        _cache.splice(0, overage);\n    }\n    _cache.push(entry);\n    self._unparseAndStore(_cache);\n    return _cache.length;\n};\n\n/** get the entries from localStorage and parse them */\nLoggingCache.prototype._fetchAndParse = function _fetchAndParse() {\n    var self = this;\n    return JSON.parse(localStorage.getItem(self.key));\n};\n\n/** stringify the entries and put them in localStorage */\nLoggingCache.prototype._unparseAndStore = function _unparseAndStore(entries) {\n    var self = this;\n    return localStorage.setItem(self.key, JSON.stringify(entries));\n};\n\n///** process the entry before caching */\n//LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n//    return JSON.stringify( entry );\n//};\n\n/** return the length --- oh, getters where are you? */\nLoggingCache.prototype.length = function length() {\n    return this._fetchAndParse().length;\n};\n\n/** get count number of entries starting with the oldest */\nLoggingCache.prototype.get = function get(count) {\n    return this._fetchAndParse().slice(0, count);\n};\n\n/** remove count number of entries starting with the oldest */\nLoggingCache.prototype.remove = function remove(count) {\n    var _cache = this._fetchAndParse();\n    var removed = _cache.splice(0, count);\n    this._unparseAndStore(_cache);\n    return removed;\n};\n\n/** empty/clear the entire cache */\nLoggingCache.prototype.empty = function empty() {\n    localStorage.setItem(this.key, \"[]\");\n    return this;\n};\n\n/** stringify count number of entries (but do not remove) */\nLoggingCache.prototype.stringify = function stringify(count) {\n    return JSON.stringify(this.get(count));\n};\n\n/** outputs entire cache to console */\nLoggingCache.prototype.print = function print() {\n    // popup? (really, carl? a popup?) - easier to copy/paste\n    console.log(JSON.stringify(this._fetchAndParse(), null, \"  \"));\n};\n\n//=============================================================================\nexport default {\n    MetricsLogger: MetricsLogger,\n    LoggingCache: LoggingCache\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('b-card',[_c('h4',{staticClass:\"mb-0\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_vm._v(\"\\n        Citations\\n        \"),(_vm.viewRender)?_c('b-button',{staticClass:\"citations-to-bibtex\",attrs:{\"title\":\"Show all in BibTeX format.\"},on:{\"click\":_vm.toggleViewRender}},[_c('i',{staticClass:\"fa fa-pencil-square-o\"}),_vm._v(\" Show BibTeX\\n        \")]):_c('b-button',{attrs:{\"title\":\"Return to formatted citation list.\"},on:{\"click\":_vm.toggleViewRender}},[_c('i',{staticClass:\"fa fa-times\"}),_vm._v(\" Hide BibTeX\\n        \")])],1),_vm._v(\" \"),(_vm.source === 'histories')?_c('div',{staticClass:\"infomessage\"},[_vm._v(\"\\n        When writing up your analysis, remember to include all references that should be cited in order to\\n        completely describe your work. Also, please remember to\\n        \"),_c('a',{attrs:{\"href\":\"https://galaxyproject.org/citing-galaxy\"}},[_vm._v(\"cite Galaxy\")]),_vm._v(\".\\n    \")]):_vm._e(),_vm._v(\" \"),(_vm.viewRender)?_c('span',{staticClass:\"citations-formatted\"},[_c('p',{domProps:{\"innerHTML\":_vm._s(_vm.formattedReferences)}})]):_c('pre',[_vm._v(\"        \"),_c('code',{staticClass:\"citations-bibtex\"},[_vm._v(\"\\n            \"+_vm._s(_vm.content)+\"\\n        \")]),_vm._v(\"\\n    \")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--1!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Citations.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--1!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Citations.vue?vue&type=script&lang=js&\"","<template>\n    <b-card>\n        <h4 slot=\"header\" class=\"mb-0\">\n            Citations\n            <b-button\n                v-if=\"viewRender\"\n                @click=\"toggleViewRender\"\n                title=\"Show all in BibTeX format.\"\n                class=\"citations-to-bibtex\"\n            >\n                <i class=\"fa fa-pencil-square-o\"></i> Show BibTeX\n            </b-button>\n            <b-button v-else @click=\"toggleViewRender\" title=\"Return to formatted citation list.\">\n                <i class=\"fa fa-times\"></i> Hide BibTeX\n            </b-button>\n        </h4>\n        <div v-if=\"source === 'histories'\" class=\"infomessage\">\n            When writing up your analysis, remember to include all references that should be cited in order to\n            completely describe your work. Also, please remember to\n            <a href=\"https://galaxyproject.org/citing-galaxy\">cite Galaxy</a>.\n        </div>\n        <span v-if=\"viewRender\" class=\"citations-formatted\"> <p v-html=\"formattedReferences\"></p> </span>\n        <pre v-else>\n            <code class=\"citations-bibtex\">\n                {{ content }}\n            </code>\n        </pre>\n    </b-card>\n</template>\n<script>\nimport _ from \"underscore\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport axios from \"axios\";\nimport * as bibtexParse from \"libs/bibtexParse\";\nimport { convertLaTeX } from \"latex-to-unicode-converter\";\nimport { stringifyLaTeX } from \"latex-parser\";\n\nexport default {\n    props: {\n        source: {\n            type: String,\n            required: true\n        },\n        id: {\n            type: String,\n            required: true\n        },\n        viewRender: {\n            type: Boolean,\n            requried: false,\n            default: true\n        }\n    },\n    data() {\n        return {\n            citations: [],\n            content: \"\",\n            errors: []\n        };\n    },\n    computed: {\n        formattedReferences: function() {\n            return this.citations.reduce(\n                (a, b) => a.concat(`<p class=\"formatted-reference\">${this.formattedReference(b)}</p>`),\n                \"\"\n            );\n        }\n    },\n    created: function() {\n        axios\n            .get(`${getAppRoot()}api/${this.source}/${this.id}/citations`)\n            .then(response => {\n                this.content = \"\";\n                for (var rawCitation of response.data) {\n                    try {\n                        var citation = {\n                            fields: {},\n                            entryType: undefined\n                        };\n                        var parsed = bibtexParse.toJSON(rawCitation.content);\n                        if (parsed) {\n                            parsed = _.first(parsed);\n                            citation.entryType = parsed.entryType || undefined;\n                            for (var key in parsed.entryTags) {\n                                citation.fields[key.toLowerCase()] = parsed.entryTags[key];\n                            }\n                        }\n                        this.citations.push(citation);\n                        this.content += rawCitation.content;\n                    } catch (err) {\n                        console.warn(\"Error parsing bibtex: \" + err);\n                    }\n                }\n            })\n            .catch(e => {\n                console.error(e);\n            });\n    },\n    methods: {\n        formattedReference: function(citation) {\n            var entryType = citation.entryType;\n            var fields = citation.fields;\n\n            var ref = \"\";\n            var authorsAndYear = `${this._asSentence(\n                (fields.author ? fields.author : \"\") + (fields.year ? ` (${fields.year})` : \"\")\n            )} `;\n            var title = fields.title || \"\";\n            var pages = fields.pages ? `pp. ${fields.pages}` : \"\";\n            var address = fields.address;\n            if (entryType == \"article\") {\n                var volume =\n                    (fields.volume ? fields.volume : \"\") +\n                    (fields.number ? ` (${fields.number})` : \"\") +\n                    (pages ? `, ${pages}` : \"\");\n                ref = `${authorsAndYear +\n                    this._asSentence(title) +\n                    (fields.journal ? `In <em>${fields.journal}, ` : \"\") +\n                    this._asSentence(volume) +\n                    this._asSentence(fields.address)}</em>`;\n            } else if (entryType == \"inproceedings\" || entryType == \"proceedings\") {\n                ref = `${authorsAndYear +\n                    this._asSentence(title) +\n                    (fields.booktitle ? `In <em>${fields.booktitle}, ` : \"\") +\n                    (pages ? pages : \"\") +\n                    (address ? `, ${address}` : \"\")}.</em>`;\n            } else if (entryType == \"mastersthesis\" || entryType == \"phdthesis\") {\n                ref =\n                    authorsAndYear +\n                    this._asSentence(title) +\n                    (fields.howpublished ? `${fields.howpublished}. ` : \"\") +\n                    (fields.note ? `${fields.note}.` : \"\");\n            } else if (entryType == \"techreport\") {\n                ref =\n                    authorsAndYear +\n                    this._asSentence(title) +\n                    this._asSentence(fields.institution) +\n                    this._asSentence(fields.number) +\n                    this._asSentence(fields.type);\n            } else if (entryType == \"book\" || entryType == \"inbook\" || entryType == \"incollection\") {\n                ref = `${authorsAndYear} ${this._formatBookInfo(fields)}`;\n            } else {\n                ref = `${authorsAndYear} ${this._asSentence(title)}${this._asSentence(\n                    fields.howpublished\n                )}${this._asSentence(fields.note)}`;\n            }\n            var doiUrl = \"\";\n            if (fields.doi) {\n                doiUrl = `https://doi.org/${fields.doi}`;\n                ref += `[<a href=\"${doiUrl}\" target=\"_blank\">doi:${fields.doi}</a>]`;\n            }\n            var url = fields.url || doiUrl;\n            if (url) {\n                ref += `[<a href=\"${url}\" target=\"_blank\">Link</a>]`;\n            }\n            return convertLaTeX({ onError: (error, latex) => `{${stringifyLaTeX(latex)}}` }, ref);\n        },\n        _formatBookInfo: function(fields) {\n            var info = \"\";\n            if (fields.chapter) {\n                info += `${fields.chapter} in `;\n            }\n            if (fields.title) {\n                info += `<em>${fields.title}</em>`;\n            }\n            if (fields.editor) {\n                info += `, Edited by ${fields.editor}, `;\n            }\n            if (fields.publisher) {\n                info += `, ${fields.publisher}`;\n            }\n            if (fields.pages) {\n                info += `, pp. ${fields.pages}`;\n            }\n            if (fields.series) {\n                info += `, <em>${fields.series}</em>`;\n            }\n            if (fields.volume) {\n                info += `, Vol.${fields.volume}`;\n            }\n            if (fields.issn) {\n                info += `, ISBN: ${fields.issn}`;\n            }\n            return `${info}.`;\n        },\n        _asSentence: function(str) {\n            return str && str.trim() ? `${str}. ` : \"\";\n        },\n        toggleViewRender: function() {\n            this.viewRender = !this.viewRender;\n        }\n    }\n};\n</script>\n<style>\npre code {\n    white-space: pre-wrap;\n}\n</style>\n","import { render, staticRenderFns } from \"./Citations.vue?vue&type=template&id=f3e7c8d0&\"\nimport script from \"./Citations.vue?vue&type=script&lang=js&\"\nexport * from \"./Citations.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Citations.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n//=============================================================================\n\njQuery.fn.extend({\n    hoverhighlight: function $hoverhighlight(scope, color) {\n        scope = scope || \"body\";\n        if (!this.length) {\n            return this;\n        }\n\n        $(this).each(function() {\n            var $this = $(this);\n            var targetSelector = $this.data(\"target\");\n\n            if (targetSelector) {\n                $this\n                    .mouseover(ev => {\n                        $(targetSelector, scope).css({\n                            background: color\n                        });\n                    })\n                    .mouseout(ev => {\n                        $(targetSelector).css({\n                            background: \"\"\n                        });\n                    });\n            }\n        });\n        return this;\n    }\n});\n","// legacy grid model, used by reports and toolshed\nexport default Backbone.Model.extend({\n    defaults: {\n        url_base: \"\",\n        async: false,\n        async_ops: [],\n        categorical_filters: [],\n        filters: {},\n        sort_key: null,\n        show_item_checkboxes: false,\n        advanced_search: false,\n        cur_page: 1,\n        num_pages: 1,\n        operation: undefined,\n        item_ids: undefined\n    },\n\n    /**\n     * Return true if operation can be done asynchronously.\n     */\n    can_async_op: function(op) {\n        return _.indexOf(this.attributes.async_ops, op) !== -1;\n    },\n\n    /**\n     * Add filtering criterion.\n     */\n    add_filter: function(key, value, append) {\n        // Update URL arg with new condition.\n        if (append) {\n            // Update or append value.\n            var cur_val = this.attributes.filters[key];\n\n            var new_val;\n            if (cur_val === null || cur_val === undefined) {\n                new_val = value;\n            } else if (typeof cur_val == \"string\") {\n                if (cur_val == \"All\" || cur_val == value) {\n                    new_val = value;\n                } else {\n                    // Replace string with array.\n                    var values = [];\n                    values[0] = cur_val;\n                    values[1] = value;\n                    new_val = values;\n                }\n            } else {\n                // Current value is an array.\n                new_val = cur_val;\n                if (new_val.indexOf(value) === -1) {\n                    new_val.push(value);\n                }\n            }\n            this.attributes.filters[key] = new_val;\n        } else {\n            // Replace value.\n            this.attributes.filters[key] = value;\n        }\n    },\n\n    /**\n     * Remove filtering criterion.\n     */\n    remove_filter: function(key, condition) {\n        var cur_val = this.attributes.filters[key];\n        if (cur_val === null || cur_val === undefined) {\n            return false;\n        }\n\n        if (typeof cur_val === \"string\") {\n            // overwrite/remove condition.\n            this.attributes.filters[key] = \"\";\n        } else {\n            // filter contains an array of conditions.\n            var condition_index = _.indexOf(cur_val, condition);\n            if (condition_index !== -1) {\n                cur_val[condition_index] = \"\";\n            }\n        }\n    },\n\n    /**\n     * Returns URL data for obtaining a new grid.\n     */\n    get_url_data: function() {\n        var url_data = {\n            async: this.attributes.async,\n            sort: this.attributes.sort_key,\n            page: this.attributes.cur_page,\n            show_item_checkboxes: this.attributes.show_item_checkboxes,\n            advanced_search: this.attributes.advanced_search\n        };\n\n        // Add operation, item_ids only if they have values.\n        if (this.attributes.operation) {\n            url_data.operation = this.attributes.operation;\n        }\n        if (this.attributes.item_ids) {\n            url_data.id = this.attributes.item_ids;\n        }\n\n        // Add filter arguments to data, placing \"f-\" in front of all arguments.\n        var self = this;\n        _.each(_.pairs(self.attributes.filters), k => {\n            url_data[`f-${k[0]}`] = k[1];\n        });\n        return url_data;\n    },\n\n    // Return URL for obtaining a new grid\n    get_url: function(args) {\n        return `${this.get(\"url_base\")}?${$.param(this.get_url_data())}&${$.param(args)}`;\n    }\n});\n","import Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport Utils from \"utils/utils\";\n/**\n * A plugin for initializing select2 input items.\n * Make sure the select2 library itself is loaded beforehand.\n * Also the element to which select2 will be appended has to\n * be created before select2 initialization (and passed as option).\n */\nvar View = Backbone.View.extend({\n    // options\n    optionsDefault: {\n        css: \"\",\n        placeholder: \"No data available\",\n        data: [],\n        value: null,\n        multiple: false,\n        minimumInputLength: 0,\n        maximumTextLength: 100,\n        // example format of initial data: \"id:name,55:anotherrole@role.com,27:role@role.com\"\n        initialData: \"\"\n    },\n\n    // initialize\n    initialize: function(options) {\n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n\n        // create new element\n        this.setElement(this._template(this.options));\n\n        // check if container exists\n        if (!this.options.container) {\n            console.log(\"ui-select::initialize() : container not specified.\");\n            return;\n        }\n\n        // add to dom\n        this.options.container.append(this.$el);\n\n        // link selection dictionary\n        this.select_data = this.options.data;\n\n        // refresh\n        this._refresh();\n\n        if (!this.options.multiple) {\n            // initial value\n            if (this.options.value) {\n                this._setValue(this.options.value);\n            }\n\n            // add change event\n            var self = this;\n            if (this.options.onchange) {\n                this.$el.on(\"change\", () => {\n                    self.options.onchange(self.value());\n                });\n            }\n        }\n    },\n\n    // value\n    value: function(new_value) {\n        // get current id/value\n        var before = this._getValue();\n\n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        }\n\n        // get current id/value\n        var after = this._getValue();\n\n        // fire onchange\n        if (after != before && this.options.onchange) {\n            this.options.onchange(after);\n        }\n\n        // return current value\n        return after;\n    },\n\n    // label\n    text: function() {\n        return this.$el.select2(\"data\").text;\n    },\n\n    // disabled\n    disabled: function() {\n        return !this.$el.select2(\"enable\");\n    },\n\n    // enable\n    enable: function() {\n        this.$el.select2(\"enable\", true);\n    },\n\n    // disable\n    disable: function() {\n        this.$el.select2(\"enable\", false);\n    },\n\n    // add\n    add: function(options) {\n        // add options\n        this.select_data.push({\n            id: options.id,\n            text: options.text\n        });\n\n        // refresh\n        this._refresh();\n    },\n\n    // remove\n    del: function(id) {\n        // search option\n        var index = this._getIndex(id);\n\n        // check if found\n        if (index != -1) {\n            // remove options\n            this.select_data.splice(index, 1);\n\n            // refresh\n            this._refresh();\n        }\n    },\n\n    // remove\n    remove: function() {\n        this.$el.select2(\"destroy\");\n    },\n\n    // update\n    update: function(options) {\n        // copy options\n        this.select_data = [];\n        for (var key in options.data) {\n            this.select_data.push(options.data[key]);\n        }\n\n        // refresh\n        this._refresh();\n    },\n\n    // refresh\n    _refresh: function() {\n        let select_opt;\n        // add select2 data based on type of input\n        if (!this.options.multiple) {\n            if (this.select_data) {\n                this.select_data.map(value => {\n                    let mx = this.options.maximumTextLength + 3;\n                    if (value.text && value.text.length > mx) {\n                        let pos = value.text.indexOf(`(${value.id})`);\n                        pos = pos != -1 && pos < mx ? pos : mx;\n                        let sub = value.text.substring(0, pos).replace(/[ .]*$/, \"\");\n                        value.text = `${sub}...(${value.id})`;\n                    }\n                });\n            }\n            var selected = this._getValue();\n            select_opt = {\n                data: this.select_data,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                dropdownAutoWidth: true\n            };\n            this.$el.select2(select_opt);\n            // select previous value (if exists)\n            this._setValue(selected);\n        } else {\n            select_opt = {\n                multiple: this.options.multiple,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                minimumInputLength: this.options.minimumInputLength,\n                ajax: this.options.ajax,\n                dropdownCssClass: this.options.dropdownCssClass,\n                escapeMarkup: this.options.escapeMarkup,\n                formatResult: this.options.formatResult,\n                formatSelection: this.options.formatSelection,\n                initSelection: this.options.initSelection,\n                initialData: this.options.initialData\n            };\n            this.$el.select2(select_opt);\n        }\n    },\n\n    // get index\n    _getIndex: function(value) {\n        // returns the index of the searched value\n        _.findIndex(this.select_data, { id: value });\n    },\n\n    // get value\n    _getValue: function() {\n        return this.$el.select2(\"val\");\n    },\n\n    // set value\n    _setValue: function(new_value) {\n        var index = this._getIndex(new_value);\n        if (index == -1) {\n            if (this.select_data.length > 0) {\n                new_value = this.select_data[0].id;\n            }\n        }\n        this.$el.select2(\"val\", new_value);\n    },\n\n    // element\n    _template: function(options) {\n        return `<input type=\"hidden\" value=\"${this.options.initialData}\"/>`;\n    }\n});\n\nexport default {\n    View: View\n};\n","/**\n    Perform feature inference and redirect if below some minimum (must have canvas, etc.)\n    and polyfill for non-standard features.\n */\n\nimport \"@babel/polyfill\";\nimport _ from \"underscore\";\n\n(() => {\n    /* TODO: move to modernizr or something besides us doing this...\n     * These are across all of our apps (reports, tool shed), but:\n     *     these should be configurable via options because they all need different things.\n     * So, analysis-polyfills.js, reports-polyfills.js (or analysis/polyfills)\n     */\n    \"use strict\";\n    /*globals window, clearTimeout */\n\n    // ------------------------------------------------------------------ polyfills\n    // console protection needed in some versions of IE (at this point (IE>=9), shouldn't be needed)\n    window.console = window.console || {\n        log: function() {},\n        debug: function() {},\n        info: function() {},\n        warn: function() {},\n        error: function() {},\n        assert: function() {}\n    };\n\n    console.debug(\"Polyfills are running\");\n\n    // phantomjs: does not have the native extend fn assign\n    Object.assign = Object.assign || _.extend;\n\n    // requestAnimationFrame polyfill\n    var lastTime = 0;\n    var vendors = [\"ms\", \"moz\", \"webkit\", \"o\"];\n    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[`${vendors[x]}RequestAnimationFrame`];\n        window.cancelRequestAnimationFrame = window[`${vendors[x]}CancelRequestAnimationFrame`];\n    }\n\n    if (!window.requestAnimationFrame)\n        window.requestAnimationFrame = (callback, element) => {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(() => {\n                callback(currTime + timeToCall);\n            }, timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n\n    if (!window.cancelAnimationFrame)\n        window.cancelAnimationFrame = id => {\n            clearTimeout(id);\n        };\n\n    // ------------------------------------------------------------------ can't/won't polyfill\n    var features = [\n        {\n            name: \"canvas\",\n            compatible: function() {\n                return window.CanvasRenderingContext2D;\n            }\n        },\n        {\n            name: \"sessionStorage\",\n            compatible: function() {\n                try {\n                    return window.sessionStorage.length >= 0;\n                } catch (err) {\n                    console.debug(err);\n                }\n                return false;\n            }\n        }\n    ];\n    // build a list of feature names for features that were not found\n    var incompatibilities = features.filter(feature => !feature.compatible()).map(feature => feature.name);\n\n    // if there are needed features missing, follow the index link to the static incompat warning\n    if (incompatibilities.length) {\n        var root = document.querySelectorAll('link[rel=\"index\"]').item(0);\n        if (root) {\n            window.location = `${root.href}static/incompatible-browser.html`;\n        }\n        console.log(`incompatible browser:\\n${incompatibilities.join(\"\\n\")}`);\n    }\n})();\n","/**\n * The big list of horrible globals we expose on window.bundleEntries.\n *\n * Everything that is exposed on this global variable is something that the python templates\n * require for their hardcoded initializations. These objects are going to have to continue\n * to exist until such time as we replace the overall application with a Vue component which\n * will handle initializations for components individually.\n */\n\nimport $ from \"jquery\";\nimport \"bootstrap\";\nexport { getGalaxyInstance, setGalaxyInstance } from \"app\";\nimport WorkflowView from \"mvc/workflow/workflow-view\";\nimport { TracksterUIView } from \"viz/trackster\";\nexport { TracksterUI } from \"viz/trackster\";\nimport Circster from \"viz/circster\";\nexport { PhylovizView as phyloviz } from \"viz/phyloviz\";\nexport { SweepsterVisualization, SweepsterVisualizationView } from \"viz/sweepster\";\nimport GalaxyLibrary from \"galaxy.library\";\nimport AdminToolshed from \"admin.toolshed\";\nexport { default as pages } from \"galaxy.pages\";\nexport { createTabularDatasetChunkedView } from \"mvc/dataset/data\";\nimport { HistoryCollection } from \"mvc/history/history-model\";\nexport { History } from \"mvc/history/history-model\";\nexport { HistoryContents } from \"mvc/history/history-contents\";\nimport MultiPanel from \"mvc/history/multi-panel\";\nexport { historyEntry as history } from \"mvc/history/history-view\";\nexport { default as HistoryViewAnnotated } from \"mvc/history/history-view-annotated\";\nexport { default as HistoryCopyDialog } from \"mvc/history/copy-dialog\";\nexport { default as HDAListItemEdit } from \"mvc/history/hda-li-edit\";\nexport { default as HDAModel } from \"mvc/history/hda-model\";\nexport { default as LegacyGridView } from \"legacy/grid/grid-view\";\nexport { create_chart, create_histogram } from \"reports/run_stats\";\nexport { default as ToolshedGroups } from \"toolshed/toolshed.groups\";\n\nexport function adminToolshed(options) {\n    new AdminToolshed.GalaxyApp(options);\n}\n\nexport function trackster(options) {\n    new TracksterUIView(options);\n}\n\nexport function circster(options) {\n    new Circster.GalaxyApp(options);\n}\n\nexport function workflow(options) {\n    new WorkflowView(options);\n}\n\nexport function library(options) {\n    new GalaxyLibrary.GalaxyApp(options);\n}\n\nexport function multiHistory(options) {\n    let histories = new HistoryCollection([], {\n        includeDeleted: options.includingDeleted,\n        order: options.order,\n        limitOnFirstFetch: options.limit,\n        limitPerFetch: options.limit,\n        currentHistoryId: options.current_history_id\n    });\n    let multipanel = new MultiPanel.MultiPanelColumns({\n        el: $(\"#center\").get(0),\n        histories: histories\n    });\n\n    histories.fetchFirst({ silent: true }).done(function() {\n        multipanel.createColumns();\n        multipanel.render(0);\n    });\n}\n\n// Previously wandering around as window.thing = thing in the onload script\nexport { default as panels } from \"layout/panel\";\nexport { show_in_overlay, hide_modal, show_message, show_modal, Modal } from \"layout/modal\";\nexport { make_popupmenu, make_popup_menus } from \"ui/popupmenu\";\nexport { default as async_save_text } from \"utils/async-save-text\";\n\n// Previously \"chart\"\nimport Client from \"mvc/visualization/chart/chart-client\";\nimport Datasets from \"mvc/visualization/chart/utilities/datasets\";\nimport Series from \"mvc/visualization/chart/utilities/series\";\nimport Jobs from \"mvc/visualization/chart/utilities/jobs\";\n\nexport function chart(options) {\n    return new Client(options);\n}\n\nexport let chartUtilities = {\n    Datasets: Datasets,\n    Jobs: Jobs,\n    Series: Series\n};\n\nexport { initMasthead } from \"components/Masthead/initMasthead\";\nexport { panelManagement } from \"onload/globalInits/panelManagement\";\nexport { mountMakoTags } from \"components/Tags\";\n\n// Used in common.mako\nexport { default as store } from \"storemodern\";\n","var amdi18n={\"__root\":{\"Analyze Data\":false,\"Workflow\":false,\"Shared Data\":false,\"Data Libraries\":false,\"Histories\":false,\"Workflows\":false,\"Visualizations\":false,\"Pages\":false,\"Visualization\":false,\"New Track Browser\":false,\"Saved Visualizations\":false,\"Interactive Environments\":false,\"Admin\":false,\"Help\":false,\"Support\":false,\"Search\":false,\"Mailing Lists\":false,\"Videos\":false,\"Wiki\":false,\"How to Cite Galaxy\":false,\"Interactive Tours\":false,\"User\":false,\"Login\":false,\"Register\":false,\"Login or Register\":false,\"Logged in as\":false,\"Preferences\":false,\"Custom Builds\":false,\"Logout\":false,\"Saved Histories\":false,\"Saved Datasets\":false,\"Saved Pages\":false,\"Account and saved data\":false,\"Account registration or login\":false,\"Support, contact, and community\":false,\"Administer this Galaxy\":false,\"Visualize datasets\":false,\"Access published resources\":false,\"Chain tools into workflows\":false,\"Analysis home view\":false,\"History Lists\":false,\"Histories Shared with Me\":false,\"Current History\":false,\"Create New\":false,\"Copy History\":false,\"Share or Publish\":false,\"Show Structure\":false,\"Extract Workflow\":false,\"Delete Permanently\":false,\"Dataset Actions\":false,\"Copy Datasets\":false,\"Dataset Security\":false,\"Resume Paused Jobs\":false,\"Collapse Expanded Datasets\":false,\"Unhide Hidden Datasets\":false,\"Delete Hidden Datasets\":false,\"Purge Deleted Datasets\":false,\"Downloads\":false,\"Export Tool Citations\":false,\"Export History to File\":false,\"Other Actions\":false,\"Import from File\":false,\"Webhooks\":false,\"This history is empty\":false,\"No matching datasets found\":false,\"An error occurred while getting updates from the server\":false,\"Please contact a Galaxy administrator if the problem persists\":false,\"search datasets\":false,\"You are currently viewing a deleted history!\":false,\"You are over your disk quota\":false,\"Tool execution is on hold until your disk usage drops below your allocated quota\":false,\"All\":false,\"None\":false,\"For all selected\":false,\"Edit history tags\":false,\"Edit history Annotation\":false,\"Click to rename history\":false,\"Operations on multiple datasets\":false,\"Hide datasets\":false,\"Unhide datasets\":false,\"Delete datasets\":false,\"Undelete datasets\":false,\"Permanently delete datasets\":false,\"This will permanently remove the data in your datasets. Are you sure?\":false,\"Dataset\":false,\"Annotation\":false,\"This history is empty. Click 'Get Data' on the left tool menu to start\":false,\"You must be logged in to create histories\":false,\"Unable to purge dataset\":false,\"Cannot display datasets removed from disk\":false,\"This dataset must finish uploading before it can be viewed\":false,\"This dataset is not yet viewable\":false,\"View data\":false,\"Download\":false,\"Download dataset\":false,\"Additional files\":false,\"View details\":false,\"This is a new dataset and not all of its data are available yet\":false,\"You do not have permission to view this dataset\":false,\"The job creating this dataset was cancelled before completion\":false,\"This job is waiting to run\":false,\"This dataset is currently uploading\":false,\"Metadata is being auto-detected\":false,\"This job is currently running\":false,\"This job is paused. Use the \\\"Resume Paused Jobs\\\" in the history menu to resume\":false,\"An error occurred with this dataset\":false,\"No data\":false,\"An error occurred setting the metadata for this dataset\":false,\"There was an error getting the data for this dataset\":false,\"This dataset has been deleted and removed from disk\":false,\"This dataset has been deleted\":false,\"This dataset has been hidden\":false,\"format\":false,\"database\":false,\"Edit attributes\":false,\"Cannot edit attributes of datasets removed from disk\":false,\"Undelete dataset to edit attributes\":false,\"This dataset must finish uploading before it can be edited\":false,\"This dataset is not yet editable\":false,\"Delete\":false,\"Dataset is already deleted\":false,\"View or report this error\":false,\"Run this job again\":false,\"Visualize\":false,\"Visualize in\":false,\"Undelete it\":false,\"Permanently remove it from disk\":false,\"Unhide it\":false,\"You may be able to\":false,\"set it manually or retry auto-detection\":false,\"Edit dataset tags\":false,\"Edit dataset annotation\":false,\"Tool Help\":false,\"Reset passwords\":false,\"Search Tool Shed\":false,\"Monitor installing repositories\":false,\"Manage installed tools\":false,\"Reset metadata\":false,\"Download local tool\":false,\"Tool lineage\":false,\"Reload a tool's configuration\":false,\"Review tool migration stages\":false,\"View Tool Error Logs\":false,\"Manage Display Whitelist\":false,\"Manage Tool Dependencies\":false,\"Users\":false,\"Groups\":false,\"API keys\":false,\"Impersonate a user\":false,\"Data\":false,\"Quotas\":false,\"Roles\":false,\"Local data\":false,\"Form Definitions\":false,\"Enable/Disable Scratchbook\":false,\"Show/Hide Scratchbook\":false,\"Tags\":false,\"Edit annotation\":false,\"Subscript\":false,\"Superscript\":false,\"Trackster\":false,\"Any additional comments you can provide regarding what you were doing at the time of the bug.\":false,\"Your email address\":false,\"Report\":false,\"Error Report\":false,\"Dataset details\":false,\"Save permissions.\":false,\"Change the datatype to a new type.\":false,\"Convert the datatype to a new format.\":false,\"Save attributes of the dataset.\":false,\"Change data type\":false,\"Edit dataset attributes\":false,\"Save permissions\":false,\"Manage dataset permissions\":false,\"Change datatype\":false,\"Convert datatype\":false,\"Convert to new format\":false,\"Save\":false,\"Permissions\":false,\"Datatypes\":false,\"Convert\":false,\"Attributes\":false,\"Import into History\":false,\"Location Details\":false,\"Deleting selected items\":false,\"Please select folders or files\":false,\"Please enter paths to import\":false,\"Adding datasets from your history\":false,\"Create New Folder\":false,\"Create New Library\":false,\"Tours\":false,\"Click here to sign out of all sessions.\":false,\"Add or remove custom builds using history datasets.\":false,\"Associate OpenIDs with your account.\":false,\"Customize your Toolbox by displaying or omitting sets of Tools.\":false,\"Access your current API key or create a new one.\":false,\"Enable or disable the communication feature to chat with other users.\":false,\"Allows you to change your login credentials.\":false,\"User Preferences\":false,\"Sign out\":false,\"Manage custom builds\":false,\"Manage OpenIDs\":false,\"Manage Toolbox filters\":false,\"Manage API key\":false,\"Set dataset permissions for new histories\":false,\"Change communication settings\":false,\"Change password\":false,\"Manage information\":false,\"Configured Galaxy Tool Sheds\":false,\"Repository Installation Queue\":false,\"Repository Status\":false,\"Workflows Missing Tools\":false,\"See in Tool Shed\":false,\"Requirements\":false,\"Share\":false,\"Workflow submission failed\":false,\"Run workflow\":false,\"Job submission failed\":false,\"Execute\":false,\"Tool request failed\":false,\"Copy and insert individual steps\":false,\"Warning\":false,\"An email notification will be sent when the job has completed.\":false,\"Add a step label.\":false,\"Assign columns\":false,\"Delete this repeat block\":false,\"placeholder\":false,\"Repeat\":false,\"Browse GenomeSpace\":false,\"Browse\":false,\"Error\":false,\"Close\":false,\"Download from web or upload from disk\":false,\"Collection\":false,\"Composite\":false,\"Regular\":false,\"Upload configuration\":false,\"FTP files\":false,\"Reset\":false,\"Pause\":false,\"Start\":false,\"Choose FTP file\":false,\"Choose local file\":false,\"Build\":false,\"Choose FTP files\":false,\"Choose local files\":false,\"Select\":false,\"Create a collection of paired datasets\":false,\"View all histories\":false,\"History options\":false,\"Refresh history\":false,\"View error logs\":false,\"View migration stages\":false,\"View lineage\":false,\"Manage dependencies\":false,\"Manage whitelist\":false,\"Manage metadata\":false,\"Manage tools\":false,\"Monitor installation\":false,\"Install new tools\":false,\"Tool Management\":false,\"Forms\":false,\"User Management\":false,\"Manage jobs\":false,\"Display applications\":false,\"Data tables\":false,\"Data types\":false,\"Server\":false,\"Could Not Save\":false,\"Saving...\":false,\"Settings\":false,\"Add tracks\":false,\"New Visualization\":false,\"Add Data to Saved Visualization\":false,\"Close visualization\":false,\"Circster\":false,\"Bookmarks\":false,\"Add group\":false,\"Remove parameter from tree\":false,\"Add parameter to tree\":false,\"Remove\":false,\"Select datasets for new tracks\":false,\"Libraries\":false,\"Zoom out\":false,\"Zoom in\":false,\"Phyloviz Help\":false,\"Save visualization\":false,\"PhyloViz Settings\":false,\"Title\":false,\"Filtering Dataset\":false,\"Filter Dataset\":false,\"Show individual tracks\":false,\"Trackster Error\":false,\"Tool parameter space visualization\":false,\"Tool\":false,\"Set as overview\":false,\"Set display mode\":false,\"Filters\":false,\"Show composite track\":false,\"Edit settings\":false,\"Test title\":false,\"Test Title\":false,\"Test button\":false,\"title\":false,\"Create new Build\":false,\"Delete custom build.\":false,\"Provide the data source.\":false,\"Next in History\":false,\"Previous in History\":false,\"Chat online\":false,\"Multiple collections\":false,\"Dataset collections\":false,\"Dataset collection\":false,\"Multiple datasets\":false,\"Single dataset\":false,\"Download from URL or upload files from disk\":false,\"tool tooltip\":false},\"__ja\":{\"Analyze Data\":\"\",\"Workflow\":\"\",\"Shared Data\":\"\",\"Data Libraries\":\"\",\"Histories\":\"\",\"Workflows\":\"\",\"Visualizations\":\"\",\"Pages\":\"\",\"Visualization\":\"\",\"New Track Browser\":\" Track Browser\",\"Saved Visualizations\":\"\",\"Interactive Environments\":\"\",\"Admin\":\"\",\"Help\":\"\",\"Support\":\"\",\"Search\":\"\",\"Mailing Lists\":\"\",\"Videos\":\"\",\"How to Cite Galaxy\":\"Galaxy \",\"Interactive Tours\":\"\",\"User\":\"\",\"Login\":\"\",\"Register\":\"\",\"Login or Register\":\"/\",\"Preferences\":\"\",\"Custom Builds\":\"\",\"Logout\":\"\",\"Saved Histories\":\"\",\"Saved Datasets\":\"\",\"Saved Pages\":\"\",\"Account and saved data\":\"\",\"Account registration or login\":\"\",\"Support, contact, and community\":\"\",\"Administer this Galaxy\":\" Galaxy \",\"Visualize datasets\":\"\",\"Access published resources\":\"\",\"Chain tools into workflows\":\"\",\"Analysis home view\":\"\",\"History Lists\":\"\",\"Histories Shared with Me\":\"\",\"Current History\":\"\",\"Create New\":\"\",\"Copy History\":\"\",\"Share or Publish\":\"\",\"Show Structure\":\"\",\"Extract Workflow\":\"\",\"Delete Permanently\":\"\",\"Dataset Actions\":\"\",\"Copy Datasets\":\"\",\"Dataset Security\":\"\",\"Resume Paused Jobs\":\"\",\"Collapse Expanded Datasets\":\"\",\"Unhide Hidden Datasets\":\"\",\"Delete Hidden Datasets\":\"\",\"Purge Deleted Datasets\":\"\",\"Downloads\":\"\",\"Export Tool Citations\":\"\",\"Export History to File\":\"\",\"Other Actions\":\"\",\"Import from File\":\"\",\"Webhooks\":\"Webhooks\",\"This history is empty\":\"\",\"No matching datasets found\":\"\",\"Search datasets\":\"\",\"You are currently viewing a deleted history!\":\"\",\"You are over your disk quota\":\"\",\"All\":\"\",\"None\":\"\",\"For all selected\":\"\",\"Edit history tags\":\"\",\"Edit history annotation\":\"\",\"Click to rename history\":\"\",\"Operations on multiple datasets\":\"\",\"Permanently delete datasets\":\"\",\"This will permanently remove the data in your datasets. Are you sure?\":\"\",\"Dataset\":\"\",\"This history is empty. Click 'Get Data' on the left tool menu to start\":\" '' \",\"You must be logged in to create histories\":\"\",\"View data\":\"\",\"Download\":\"\",\"Download dataset\":\"\",\"View details\":\"\",\"This job is waiting to run\":\"\",\"This job is currently running\":\"\",\"An error occurred with this dataset\":\"\",\"No data\":\"\",\"This dataset has been deleted and removed from disk\":\"\",\"This dataset has been deleted\":\"\",\"This dataset has been hidden\":\"\",\"format\":\"\",\"database\":\"\",\"Edit attributes\":\"\",\"Delete\":\"\",\"View or report this error\":\"\",\"Run this job again\":\"\",\"Visualize\":\"\",\"Undelete it\":\"\",\"Permanently remove it from disk\":\"\",\"Unhide it\":\"\",\"Search Tool Shed\":\"Tool Shed \",\"Search Tool Shed (Beta)\":\"Tool Shed (Beta) \",\"Monitor installing repositories\":\"\",\"Manage installed tools\":\"\",\"Reset metadata\":\"\",\"Download local tool\":\"\",\"Tool lineage\":\"\",\"Reload a tool's configuration\":\"\",\"Review tool migration stages\":\"\",\"View Tool Error Logs\":\"\",\"Manage Display Whitelist\":\"\",\"Manage Tool Dependencies\":\"\",\"Users\":\"\",\"Groups\":\"\",\"API keys\":\"API \",\"Impersonate a user\":\"\",\"Data\":\"\",\"Quotas\":\"\",\"Roles\":\"\",\"Local data\":\"\",\"Form definitions\":\"\",\"Administration\":\"\",\"Server\":\"\",\"Tools and Tool Shed\":\" Tool Shed\",\"User Management\":\"\",\"Form Definitions\":\"\",\"Your workflows\":\"\"},\"__fr\":{\"Analyze Data\":\"Analyse de donnes\",\"Workflow\":\"Workflow\",\"Shared Data\":\"Donnes partages\",\"Data Libraries\":\"Bibliothque de donnes\",\"Histories\":false,\"Workflows\":false,\"Visualizations\":\"Visualisations\",\"Pages\":\"Pages\",\"Visualization\":false,\"New Track Browser\":\"Nouveau Navigateur de Tracks/Pistes\",\"Saved Visualizations\":\"Visualisations sauvegardes\",\"Interactive Environments\":\"Environnements interactifs\",\"Admin\":\"Admin\",\"Help\":\"Aide\",\"Support\":\"Assistance\",\"Search\":false,\"Mailing Lists\":\"Liste de diffusion\",\"Videos\":\"Vidos\",\"Wiki\":\"Documentations\",\"How to Cite Galaxy\":\"Comment citer Galaxy\",\"Interactive Tours\":\"Guides interactifs\",\"User\":\"Utilisateur\",\"Login\":\"Authentification\",\"Register\":\"Enregistrement\",\"Login or Register\":\"Authentification et Enregistrement\",\"Logged in as\":\"Authentifi en tant que\",\"Preferences\":\"Prfrences\",\"Custom Builds\":\"Mes gnomes Builds de rfrence\",\"Logout\":\"Dconnexion\",\"Saved Histories\":\"Historiques sauvegards\",\"Saved Datasets\":\"Jeux de donnes sauvegards\",\"Saved Pages\":\"Pages sauvegardes\",\"Account and saved data\":\"Compte et donnes sauvegardes\",\"Account registration or login\":\"Enregistrement ou authentification\",\"Support, contact, and community\":\"Support,contact et communaut\",\"Administer this Galaxy\":\"Outils Admin\",\"Visualize datasets\":\"Visualiser les jeux de donnes\",\"Access published resources\":\"Accder aux donnes partages\",\"Chain tools into workflows\":\"Relier outils dans un workflow\",\"Analysis home view\":\"Accueil analyse de donnes\",\"History Lists\":\"Tableaux des historiques\",\"Histories Shared with Me\":\"Historiques partags avec moi\",\"Current History\":\"Cet Historique\",\"Create New\":\"Crer un nouveau\",\"Copy History\":\"Copier l'Historique\",\"Share or Publish\":\"Partager et publier\",\"Show Structure\":\"Montrer la structure\",\"Extract Workflow\":\"Extraire un Workflow\",\"Delete Permanently\":\"Supprimer dfinitivement\",\"Dataset Actions\":\"Actions sur les jeux de donnes\",\"Copy Datasets\":\"Copier des jeux de donnes\",\"Dataset Security\":\"Permissions/Scurit\",\"Resume Paused Jobs\":\"Reprendre les processus en pause\",\"Collapse Expanded Datasets\":\"Rduire les donnes tendues\",\"Unhide Hidden Datasets\":\"Afficher les donnes caches\",\"Delete Hidden Datasets\":\"Supprimer les donnes caches\",\"Purge Deleted Datasets\":\"Purger les donnes supprimes\",\"Downloads\":\"Tlcharger\",\"Export Tool Citations\":\"Exporter les citations des outils\",\"Export History to File\":\"Exporter l'Historique dans un fichier\",\"Other Actions\":\"Autres actions\",\"Import from File\":\"Importer depuis un fichier\",\"Webhooks\":\"Webhooks\",\"This history is empty\":\"Cet historique est vide\",\"No matching datasets found\":\"Aucunes donnes correspondantes n'ont t trouves\",\"An error occurred while getting updates from the server\":\"Une erreur s'est produite lors de la rception des donnes depuis le serveur\",\"Please contact a Galaxy administrator if the problem persists\":\"Veuillez contacter un administrateur de l'instance Galaxy si ce problme persiste\",\"search datasets\":\"Rechercher des donnes\",\"You are currently viewing a deleted history!\":\"Vous consultez actuellement un historique supprim!\",\"You are over your disk quota\":\"Vous avez dpass votre quota d'espace disque\",\"Tool execution is on hold until your disk usage drops below your allocated quota\":\"L'excution de l'outil est en attente tant que votre utilisation d'espace disque dpasse le quota attribu\",\"All\":\"Tout\",\"None\":\"Aucun\",\"For all selected\":\"Pour toute la slection\",\"Edit history tags\":\"Editer les mots-cls de l'historique\",\"Edit history Annotation\":\"Editer l'annotation de l'historique\",\"Click to rename history\":\"Cliquer pour renommer l'historique\",\"Operations on multiple datasets\":\"Oprer sur plusieurs jeux de donnes en mme temps\",\"Hide datasets\":\"Cacher les jeux de donnes\",\"Unhide datasets\":\"Afficher les jeux de donnes cachs\",\"Delete datasets\":\"Supprimer les jeux de donnes\",\"Undelete datasets\":\"Restaurer les jeux de donnes supprims\",\"Permanently delete datasets\":\"Supprimer dfinitivement les jeux de donnes\",\"This will permanently remove the data in your datasets. Are you sure?\":\"Cela supprimera de manire permanente les donnes de votre historique. tes-vous certain?\",\"Dataset\":\"Jeu de donnes\",\"Annotation\":\"Annotation\",\"This history is empty. Click 'Get Data' on the left tool menu to start\":\"Cet historique est vide. Cliquer sur 'Get Data' au niveau du menu d'outils  gauche pour dmarrer\",\"You must be logged in to create histories\":\"Vous devez tre connect pour crer un historique\",\"load your own data\":\"Charger vos propres donnes\",\"get data from an external source\":\"Charger des donnes depuis une source externe\",\"Include Deleted Datasets\":\"Inclure les jeux de donnes supprims\",\"Include Hidden Datasets\":\"Inclure les jeux de donnes cachs\",\"Unable to purge dataset\":\"Impossible de purger le jeu de donnes\",\"Cannot display datasets removed from disk\":\"Impossible de visualiser les jeux de donnes supprims du disque\",\"This dataset must finish uploading before it can be viewed\":\"Le jeu de donnes doit tre totalement tlvers avant de pouvoir tre visualiser\",\"This dataset is not yet viewable\":\"Ce jeu de donnes n'est pas visualisable\",\"View data\":\"Voir les donnes\",\"Download\":false,\"Download dataset\":\"Tlcharger le jeu de donnes\",\"Additional files\":\"Fichiers additionnels\",\"View details\":\"Voir les dtails\",\"This is a new dataset and not all of its data are available yet\":\"Il s'agit d'un nouveau jeu de donnes et seule une partie des donnes est accessible pour le moment\",\"You do not have permission to view this dataset\":\"Vous n'avez pas la permission de voir ce jeu de donnes\",\"The job creating this dataset was cancelled before completion\":\"Le processus  l'origine de ce jeu de donnes a t annul prmaturment\",\"This job is waiting to run\":\"Ce calcul est en attente de traitement\",\"This dataset is currently uploading\":\"Ce jeu de donnes est en cours de tlversement\",\"Metadata is being auto-detected\":\"Les mtadonnes sont auto-dtectes\",\"This job is currently running\":\"Le traitement est en cours\",\"This job is paused. Use the \\\"Resume Paused Jobs\\\" in the history menu to resume\":\"Ce traitement est en pause. Utilisez le \\\"Relancer les traitements en pause\\\" dans le menu d'historique pour le relancer\",\"An error occurred with this dataset\":\"Une erreur est survenue avec ce jeu de donnes\",\"No data\":\"Aucune donne\",\"An error occurred setting the metadata for this dataset\":\"Une erreur est survenue pendant la rcupration des mtadonnes de ce jeu de donnes\",\"There was an error getting the data for this dataset\":\"Il est survenu une erreur durant la rcupration du contenu de ce jeu de donnes\",\"This dataset has been deleted and removed from disk\":\"Ce jeu de donnes a t supprim et effac du disque\",\"This dataset has been deleted\":\"Ce jeu de donnes a t supprim\",\"This dataset has been hidden\":\"Ce jeu de donnes a t cach\",\"format\":\"format\",\"database\":\"gnome de rfrence\",\"Edit attributes\":\"Editer les attributs\",\"Cannot edit attributes of datasets removed from disk\":\"Impossible d'diter les attributs de jeux de donnes effacs du disque\",\"Undelete dataset to edit attributes\":\"Restaurer le jeu de donnes pour en diter les attributs\",\"This dataset must finish uploading before it can be edited\":\"Ce jeu de donnes doit tre entirement tlvers avant toute modification\",\"This dataset is not yet editable\":\"Ce jeu de donnes n'est pas encore ditable\",\"Delete\":\"Supprimer\",\"Dataset is already deleted\":\"Le jeu de donnes est dj supprim\",\"View or report this error\":\"Voir ou remonter cette erreur\",\"Run this job again\":\"Excuter ce traitement  nouveau\",\"Visualize\":false,\"Visualize in\":\"Visualiser via\",\"Undelete it\":\"Restaurer\",\"Permanently remove it from disk\":\"Supprimer dfinitivement du disque\",\"Unhide it\":\"Rendre visible\",\"You may be able to\":\"Vous devriez tre en mesure de\",\"set it manually or retry auto-detection\":\"Traitez le manuellement ou retenter la dtection automatique\",\"Edit dataset tags\":\"Editer les mots-cls du jeu de donnes\",\"Edit dataset annotation\":\"Editer les annotations du jeu de donnes\",\"Tool Help\":\"Aide outil\",\"Reset passwords\":\"Rinitialiser les mots de passe\",\"Search Tool Shed\":\"Chercher via un Tool Shed\",\"Monitor installing repositories\":\"Contrler les dpts installs\",\"Manage installed tools\":\"Grer les outils installs\",\"Reset metadata\":\"Rinitialiser les mtadonnes\",\"Download local tool\":\"Tlcharger un outil en local\",\"Tool lineage\":\"Affiliation des outils\",\"Reload a tool's configuration\":\"Recharger une configuration d'outils\",\"Review tool migration stages\":\"Vrifier les tapes de migration d'outils\",\"View Tool Error Logs\":\"Voir les logs d'erreur d'outils\",\"Manage Display Whitelist\":\"Grer la liste blanche d'outils graphiques\",\"Manage Tool Dependencies\":\"Grer les dpendances d'outils\",\"Users\":false,\"Groups\":false,\"API keys\":\"Cl d'API\",\"Impersonate a user\":\"Prendre la place d'un utilisateur\",\"Data\":false,\"Quotas\":false,\"Roles\":false,\"Local data\":\"Donnes locales\",\"Form Definitions\":\"Dfinitions de formulaires\",\"Enable/Disable Scratchbook\":\"Activer/Dsactiver la visu Scratchbook\",\"Show/Hide Scratchbook\":\"Montrer/cacher la visu Scratchbook\",\"Tags\":\"Mots-cls\",\"Edit annotation\":\"Editer les annotations\",\"Subscript\":false,\"Superscript\":false,\"Trackster\":false,\"Any additional comments you can provide regarding what you were doing at the time of the bug.\":\"N'importe quel commentaire que vous pouvez fournir concernant ce que vous faisiez lorsque le bug est apparu\",\"Your email address\":\"Votre adresse e-mail\",\"Report\":false,\"Error Report\":\"Rapport d'erreur\",\"Dataset details\":\"Dtails du jeu de donnes\",\"Save permissions.\":\"Sauvegarder les permissions\",\"Change the datatype to a new type.\":\"Changer en un nouveau format de donnes\",\"Convert the datatype to a new format.\":\"Convertir le format de donnes\",\"Save attributes of the dataset.\":\"Sauvegarder les attributs du jeu de donnes\",\"Change data type\":\"Changer le format de donnes\",\"Edit dataset attributes\":\"Modifier les attributs du jeu de donnes\",\"Save permissions\":\"Sauvegarder les permissions\",\"Manage dataset permissions\":\"Grer les permissions sur les jeux de donnes\",\"Change datatype\":\"Changer le format de donnes\",\"Convert datatype\":\"Convertir le format de donnes\",\"Convert to new format\":\"Convertir en un nouveau format de donnes\",\"Save\":false,\"Permissions\":false,\"Datatypes\":false,\"Convert\":false,\"Attributes\":false,\"Import into History\":\"Importer dans l'historique\",\"Location Details\":\"Dtails de localisation\",\"Deleting selected items\":\"Suppression des objets slectionns\",\"Please select folders or files\":\"S'il vous plat slectionnez des dossiers ou fichiers\",\"Please enter paths to import\":\"S'il vous plat entrer des chemins/URLs  importer\",\"Adding datasets from your history\":\"Ajouts de jeux de donnes  partir de votre historique\",\"Create New Folder\":\"Crer un nouveau dossier\",\"Create New Library\":\"Crer une nouvelle bibliothque\",\"Tours\":false,\"Click here to sign out of all sessions.\":false,\"Add or remove custom builds using history datasets.\":false,\"Associate OpenIDs with your account.\":false,\"Customize your Toolbox by displaying or omitting sets of Tools.\":false,\"Access your current API key or create a new one.\":false,\"Enable or disable the communication feature to chat with other users.\":false,\"Allows you to change your login credentials.\":false,\"User Preferences\":false,\"Sign out\":false,\"Manage custom builds\":false,\"Manage OpenIDs\":false,\"Manage Toolbox filters\":false,\"Manage API key\":false,\"Set dataset permissions for new histories\":false,\"Change communication settings\":false,\"Change password\":false,\"Manage information\":false,\"Configured Galaxy Tool Sheds\":false,\"Repository Installation Queue\":false,\"Repository Status\":false,\"Workflows Missing Tools\":false,\"See in Tool Shed\":false,\"Requirements\":false,\"Share\":false,\"Workflow submission failed\":false,\"Run workflow\":false,\"Job submission failed\":false,\"Execute\":false,\"Tool request failed\":false,\"Copy and insert individual steps\":false,\"Warning\":false,\"An email notification will be sent when the job has completed.\":false,\"Add a step label.\":false,\"Assign columns\":false,\"Delete this repeat block\":false,\"placeholder\":false,\"Repeat\":false,\"Browse GenomeSpace\":false,\"Browse\":false,\"Error\":false,\"Close\":false,\"Download from web or upload from disk\":false,\"Collection\":false,\"Composite\":false,\"Regular\":false,\"Upload configuration\":false,\"FTP files\":false,\"Reset\":false,\"Pause\":false,\"Start\":false,\"Choose FTP file\":false,\"Choose local file\":false,\"Build\":false,\"Choose FTP files\":false,\"Choose local files\":false,\"Select\":false,\"Create a collection of paired datasets\":false,\"View all histories\":false,\"History options\":false,\"Refresh history\":false,\"View error logs\":false,\"View migration stages\":false,\"View lineage\":false,\"Manage dependencies\":false,\"Manage whitelist\":false,\"Manage metadata\":false,\"Manage tools\":false,\"Monitor installation\":false,\"Install new tools\":false,\"Tool Management\":false,\"Forms\":false,\"User Management\":false,\"Manage jobs\":false,\"Display applications\":false,\"Data tables\":false,\"Data types\":false,\"Server\":false,\"Could Not Save\":false,\"Saving...\":false,\"Settings\":false,\"Add tracks\":false,\"New Visualization\":false,\"Add Data to Saved Visualization\":false,\"Close visualization\":false,\"Circster\":false,\"Bookmarks\":false,\"Add group\":false,\"Remove parameter from tree\":false,\"Add parameter to tree\":false,\"Remove\":false,\"Select datasets for new tracks\":false,\"Libraries\":false,\"Zoom out\":false,\"Zoom in\":false,\"Phyloviz Help\":false,\"Save visualization\":false,\"PhyloViz Settings\":false,\"Title\":false,\"Filtering Dataset\":false,\"Filter Dataset\":false,\"Show individual tracks\":false,\"Trackster Error\":false,\"Tool parameter space visualization\":false,\"Tool\":false,\"Set as overview\":false,\"Set display mode\":false,\"Filters\":false,\"Show composite track\":false,\"Edit settings\":false,\"Test title\":false,\"Test Title\":false,\"Test button\":false,\"title\":false,\"Create new Build\":false,\"Delete custom build.\":false,\"Provide the data source.\":false,\"Next in History\":false,\"Previous in History\":false,\"Chat online\":false,\"Multiple collections\":false,\"Dataset collections\":false,\"Dataset collection\":false,\"Multiple datasets\":false,\"Single dataset\":false,\"Download from URL or upload files from disk\":false,\"tool tooltip\":false},\"__zh\":{\"Analyze Data\":\"\",\"Workflow\":\"\",\"Shared Data\":\"\",\"Data Libraries\":\"\",\"Histories\":\"\",\"Workflows\":\"\",\"Visualizations\":\"\",\"Pages\":\"\",\"Visualization\":\"\",\"New Track Browser\":\" Track Browser\",\"Saved Visualizations\":\"\",\"Interactive Environments\":\"\",\"Admin\":\"\",\"Help\":\"\",\"Support\":\"\",\"Search\":\"\",\"Mailing Lists\":\"\",\"Videos\":\"\",\"Wiki\":false,\"How to Cite Galaxy\":\"\",\"Interactive Tours\":\"\",\"User\":\"\",\"Login\":\"\",\"Register\":\"\",\"Login or Register\":\"\",\"Logged in as\":\"\",\"Preferences\":\"\",\"Custom Builds\":\"\",\"Logout\":\"\",\"Saved Histories\":\"\",\"Saved Datasets\":\"\",\"Saved Pages\":\"\",\"Tools\":\"\",\"Account and saved data\":\"\",\"Account registration or login\":\"\",\"Support, contact, and community\":\"\",\"Administer this Galaxy\":\"Galaxy\",\"Visualize datasets\":\"\",\"Access published resources\":\"\",\"Chain tools into workflows\":\"\",\"Analysis home view\":\"\",\"History\":\"\",\"History Lists\":\"\",\"Histories Shared with Me\":\"\",\"Current History\":\"\",\"Create New\":\"\",\"Copy History\":\"\",\"Share or Publish\":\"\",\"Show Structure\":\"\",\"Extract Workflow\":\"\",\"Delete\":\"\",\"Delete Permanently\":\"\",\"Dataset Actions\":\"\",\"Copy Datasets\":\"\",\"Dataset Security\":\"\",\"Resume Paused Jobs\":\"\",\"Collapse Expanded Datasets\":false,\"Unhide Hidden Datasets\":\"\",\"Delete Hidden Datasets\":\"\",\"Purge Deleted Datasets\":\"\",\"Downloads\":\"\",\"Export Tool Citations\":\"\",\"Export History to File\":\"\",\"Other Actions\":\"\",\"Import from File\":\"\",\"Webhooks\":false,\"This history is empty\":\"\",\"No matching datasets found\":\"\",\"An error occurred while getting updates from the server\":\"\",\"Please contact a Galaxy administrator if the problem persists\":\"Galaxy\",\"An error was encountered while <% where %>\":\": <% where %>\",\"search datasets\":\"\",\"You are currently viewing a deleted history!\":\"\",\"You are over your disk quota\":\"\",\"Tool execution is on hold until your disk usage drops below your allocated quota\":\"\",\"All\":\"\",\"None\":\"\",\"For all selected\":\"\",\"Edit history tags\":\"\",\"Edit history Annotation\":\"\",\"Click to rename history\":\"\",\"Operations on multiple datasets\":\"\",\"Hide datasets\":\"\",\"Unhide datasets\":\"\",\"Delete datasets\":\"\",\"Undelete datasets\":\"\",\"Permanently delete datasets\":\"\",\"This will permanently remove the data in your datasets. Are you sure?\":\"\",\"Dataset\":\"\",\"Annotation\":\"\",\"This history is empty. Click 'Get Data' on the left tool menu to start\":\"\",\"You must be logged in to create histories\":\"\",\"You can \":\" \",\" or \":\"  \",\"load your own data\":\"\",\"get data from an external source\":\"\",\"Unable to purge dataset\":\"\",\"Cannot display datasets removed from disk\":\"\",\"This dataset must finish uploading before it can be viewed\":\", \",\"This dataset is not yet viewable\":\"\",\"View data\":\"\",\"Download\":\"\",\"Download dataset\":\"\",\"Additional files\":\"\",\"View details\":\"\",\"This is a new dataset and not all of its data are available yet\":\"\",\"You do not have permission to view this dataset\":\"\",\"The job creating this dataset was cancelled before completion\":\"\",\"This job is waiting to run\":\"\",\"This dataset is currently uploading\":\"\",\"Metadata is being auto-detected\":\"\",\"This job is currently running\":\"\",\"This job is paused. Use the \\\"Resume Paused Jobs\\\" in the history menu to resume\":\" \\\"\\\" \",\"An error occurred with this dataset\":\"\",\"No data\":\"\",\"An error occurred setting the metadata for this dataset\":\"\",\"There was an error getting the data for this dataset\":\"\",\"This dataset has been deleted and removed from disk\":\"\",\"This dataset has been deleted\":\"\",\"This dataset has been hidden\":\"\",\"format\":\"\",\"database\":\"\",\"Edit attributes\":\"\",\"Cannot edit attributes of datasets removed from disk\":\"\",\"Undelete dataset to edit attributes\":\"\",\"This dataset must finish uploading before it can be edited\":\", \",\"This dataset is not yet editable\":\"\",\"Dataset is already deleted\":\"\",\"View or report this error\":\"\",\"Run this job again\":\"\",\"Visualize\":\"\",\"Visualize in\":\"\",\"Undelete it\":\"\",\"Permanently remove it from disk\":\"\",\"Unhide it\":\"\",\"You may be able to\":\"\",\"set it manually or retry auto-detection\":\"\",\"Edit dataset tags\":\"\",\"Edit dataset annotation\":\"\",\"Tool Help\":\"\",\"Search Tool Shed\":\" Tool Shed\",\"Monitor installing repositories\":\"\",\"Manage installed tools\":\"\",\"Reset metadata\":\"\",\"Download local tool\":\"\",\"Tool lineage\":false,\"Reload a tool's configuration\":\"\",\"Review tool migration stages\":\"\",\"View Tool Error Logs\":\"\",\"Manage Display Whitelist\":\"\",\"Manage Tool Dependencies\":\"\",\"Users\":\"\",\"Groups\":\"\",\"API keys\":false,\"Impersonate a user\":\"\",\"Data\":\"\",\"Quotas\":\"\",\"Roles\":\"\",\"Local data\":\"\",\"Form Definitions\":\"\",\"Enable/Disable Scratchbook\":\"/ Scratchbook\",\"Show/Hide Scratchbook\":\"/ Scratchbook\",\"Tags\":\"\",\"Edit annotation\":\"\",\"ja\":true,\"fr\":true,\"zh\":true}};amdi18n.init=function(language){\n\t\t// get the default language\n\t\tif(!language){\n\t\t\tif(typeof window !== 'undefined' && window._i18n && window._i18n.locale){\n\t\t\t\tlanguage = window._i18n.locale;\n\t\t\t}else if(typeof document !== 'undefined' && document.documentElement.lang){\n\t\t\t\tlanguage = document.documentElement.lang;\n\t\t\t}else if(typeof navigator !== 'undefined' && (navigator.languages || navigator.language || navigator.userLanguage)){\n\t\t\t\t// navigator.languages does not exist in IE 11\n\t\t\t\tlanguage = (navigator.languages && navigator.languages[0]) ||\n\t\t\t\t\tnavigator.language ||\n\t\t\t\t\tnavigator.userLanguage;\n\t\t\t\tlanguage = (language || 'root').toLowerCase();\n\t\t\t}else{\n\t\t\t\tlanguage = 'root';\n\t\t\t}\n\t\t}\n\t\tvar target = this['__' + language] || this.__root;\n\n\t\t// copy definition to root level\n\t\tif (target) {\n\t\t\tfor (var name in target) {\n\t\t\t\tthis[name] = target[name];\n\t\t\t}\n\t\t}\n\n\t\t// fallback to root\n\t\tfor(var name in this.__root){\n\t\t\tif(typeof this[name] === 'undefined'){\n\t\t\t\tthis[name] = this.__root[name];\n\t\t\t}\n\t\t}\n\t};amdi18n.init();module.exports=amdi18n;","import jQuery from \"jquery\";\nimport _ from \"underscore\";\nvar $ = jQuery;\n\n// ============================================================================\n// TODO: unify popup menus and/or eliminate this\n/**\n * Sets up popupmenu rendering and binds options functions to the appropriate links.\n * initial_options is a dict with text describing the option pointing to either (a) a\n * function to perform; or (b) another dict with two required keys, 'url' and 'action' (the\n * function to perform. (b) is useful for exposing the underlying URL of the option.\n */\nexport function make_popupmenu(button_element, initial_options) {\n    /*  Use the $.data feature to store options with the link element.\n        This allows options to be changed at a later time\n    */\n    var element_menu_exists = button_element.data(\"menu_options\");\n    button_element.data(\"menu_options\", initial_options);\n\n    // If element already has menu, nothing else to do since HTML and actions are already set.\n    if (element_menu_exists) {\n        return;\n    }\n\n    button_element.bind(\"click.show_popup\", e => {\n        // Close existing visible menus\n        $(\".popmenu-wrapper\").remove();\n\n        // Need setTimeouts so clicks don't interfere with each other\n        setTimeout(() => {\n            // Dynamically generate the wrapper holding all the selectable options of the menu.\n            var menu_element = $(`<ul class='dropdown-menu' id='${button_element.attr(\"id\")}-menu'></ul>`);\n            var options = button_element.data(\"menu_options\");\n            if (_.size(options) <= 0) {\n                $(\"<li>No Options.</li>\").appendTo(menu_element);\n            }\n            $.each(options, (k, v) => {\n                if (v) {\n                    // Action can be either an anonymous function and a mapped dict.\n                    var action = v.action || v;\n                    menu_element.append(\n                        $(\"<li></li>\").append(\n                            $(\"<a>\")\n                                .attr(\"href\", v.url)\n                                .html(k)\n                                .click(action)\n                        )\n                    );\n                } else {\n                    menu_element.append(\n                        $(\"<li></li>\")\n                            .addClass(\"head\")\n                            .append($(\"<a href='#'></a>\").html(k))\n                    );\n                }\n            });\n            var wrapper = $(\"<div class='popmenu-wrapper' style='position: absolute;left: 0; top: -1000;'></div>\")\n                .append(menu_element)\n                .appendTo(\"body\");\n\n            var x = e.pageX - wrapper.width() / 2;\n            x = Math.min(x, $(document).scrollLeft() + $(window).width() - $(wrapper).width() - 5);\n            x = Math.max(x, $(document).scrollLeft() + 5);\n\n            wrapper.css({\n                top: e.pageY,\n                left: x\n            });\n        }, 10);\n\n        setTimeout(() => {\n            // Bind click event to current window and all frames to remove any visible menus\n            // Bind to document object instead of window object for IE compat\n            var close_popup = el => {\n                $(el).bind(\"click.close_popup\", () => {\n                    $(\".popmenu-wrapper\").remove();\n                    el.unbind(\"click.close_popup\");\n                });\n            };\n            close_popup($(window.document)); // Current frame\n            close_popup($(window.top.document)); // Parent frame\n            for (var frame_id = window.top.frames.length; frame_id--; ) {\n                // Sibling frames\n                var frame = $(window.top.frames[frame_id].document);\n                close_popup(frame);\n            }\n        }, 50);\n\n        return false;\n    });\n}\n\n/**\n *  Convert two seperate (often adjacent) divs into galaxy popupmenu\n *  - div 1 contains a number of anchors which become the menu options\n *  - div 1 should have a 'popupmenu' attribute\n *  - this popupmenu attribute contains the id of div 2\n *  - div 2 becomes the 'face' of the popupmenu\n *\n *  NOTE: make_popup_menus finds and operates on all divs with a popupmenu attr (no need to point it at something)\n *  NOTE: make_popup_menus, and make_popupmenu are horrible names\n */\nexport function make_popup_menus() {\n    $(\"div[popupmenu]\").each(function() {\n        var options = {};\n        var menu = $(this);\n\n        // find each anchor in the menu, convert them into an options map: { a.text : click_function }\n        menu.find(\"a\").each(function() {\n            var link = $(this);\n            var link_dom = link.get(0);\n            var confirmtext = link_dom.getAttribute(\"confirm\");\n            var href = link_dom.getAttribute(\"href\");\n            var target = link_dom.getAttribute(\"target\");\n\n            // no href - no function (gen. a label)\n            if (!href) {\n                options[link.text()] = null;\n            } else {\n                options[link.text()] = {\n                    url: href,\n                    action: function(event) {\n                        // if theres confirm text, send the dialog\n                        if (!confirmtext || confirm(confirmtext)) {\n                            // link.click() doesn't use target for some reason,\n                            // so manually do it here.\n                            if (target) {\n                                window.open(href, target);\n                                return false;\n                            } else {\n                                // For all other links, do the default action.\n                                link.click();\n                            }\n                        } else {\n                            event.preventDefault();\n                        }\n                    }\n                };\n            }\n        });\n        // locate the element with the id corresponding to the menu's popupmenu attr\n        var box = $(`#${menu.attr(\"popupmenu\")}`);\n\n        // For menus with clickable link text, make clicking on the link go through instead\n        // of activating the popup menu\n        box.find(\"a\").bind(\"click\", e => {\n            e.stopPropagation(); // Stop bubbling so clicking on the link goes through\n            return true;\n        });\n\n        // attach the click events and menu box building to the box element\n        make_popupmenu(box, options);\n        box.addClass(\"popup\");\n        menu.remove();\n    });\n}\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js??ref--7-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Citations.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js??ref--7-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Citations.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametag.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametag.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametags.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Nametags.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StatelessTags.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StatelessTags.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../node_modules/css-loader/dist/cjs.js??ref--8-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/sass-loader/lib/loader.js??ref--8-2!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=scss&\"","import $ from \"jquery\";\n\nimport { Toast } from \"ui/toast\";\n\nfunction Connector(handle1, handle2) {\n    this.canvas = null;\n    this.dragging = false;\n    this.inner_color = \"#FFFFFF\";\n    this.outer_color = \"#25537b\";\n    if (handle1 && handle2) {\n        this.connect(handle1, handle2);\n    }\n}\n$.extend(Connector.prototype, {\n    connect: function(t1, t2) {\n        this.handle1 = t1;\n        if (this.handle1) {\n            this.handle1.connect(this);\n        }\n        this.handle2 = t2;\n        if (this.handle2) {\n            this.handle2.connect(this);\n        }\n    },\n    destroy: function() {\n        if (this.handle1) {\n            this.handle1.disconnect(this);\n        }\n        if (this.handle2) {\n            this.handle2.disconnect(this);\n        }\n        $(this.canvas).remove();\n    },\n    destroyIfInvalid: function(warn) {\n        if (this.handle1 && this.handle2 && !this.handle2.attachable(this.handle1).canAccept) {\n            if (warn) {\n                Toast.warning(\"Destroying a connection because collection type has changed.\");\n            }\n            this.destroy();\n        }\n    },\n    redraw: function() {\n        const handle1 = this.handle1;\n        const handle2 = this.handle2;\n        const startRibbon = handle1 && handle1.isMappedOver();\n        const endRibbon = handle2 && handle2.isMappedOver();\n        const canvasClass = `${startRibbon ? \"start-ribbon\" : \"\"} ${endRibbon ? \"end-ribbon\" : \"\"}`;\n        var canvas_container = $(\"#canvas-container\");\n        // FIXME: global\n        var canvasZoom = window.workflow_globals.canvas_manager.canvasZoom;\n        if (!this.canvas) {\n            this.canvas = document.createElement(\"canvas\");\n            canvas_container.append($(this.canvas));\n            if (this.dragging) {\n                this.canvas.style.zIndex = \"300\";\n            }\n        }\n        this.canvas.setAttribute(\n            \"handle1-id\",\n            handle1 && handle1.element.getAttribute ? handle1.element.getAttribute(\"id\") : \"\"\n        );\n        this.canvas.setAttribute(\n            \"handle2-id\",\n            handle2 && handle2.element.getAttribute ? handle2.element.getAttribute(\"id\") : \"\"\n        );\n        var relativeLeft = e => ($(e).offset().left - canvas_container.offset().left) / canvasZoom;\n        var relativeTop = e => ($(e).offset().top - canvas_container.offset().top) / canvasZoom;\n        if (!handle1 || !handle2) {\n            return;\n        }\n        // Find the position of each handle\n        var start_x = relativeLeft(handle1.element) + 5;\n        var start_y = relativeTop(handle1.element) + 5;\n        var end_x = relativeLeft(handle2.element) + 5;\n        var end_y = relativeTop(handle2.element) + 5;\n        // Calculate canvas area\n        var canvas_extra = 100;\n        var canvas_min_x = Math.min(start_x, end_x);\n        var canvas_max_x = Math.max(start_x, end_x);\n        var canvas_min_y = Math.min(start_y, end_y);\n        var canvas_max_y = Math.max(start_y, end_y);\n        var cp_shift = Math.min(Math.max(Math.abs(canvas_max_y - canvas_min_y) / 2, 100), 300);\n        var canvas_left = canvas_min_x - canvas_extra;\n        var canvas_top = canvas_min_y - canvas_extra;\n        var canvas_width = canvas_max_x - canvas_min_x + 2 * canvas_extra;\n        var canvas_height = canvas_max_y - canvas_min_y + 2 * canvas_extra;\n        // Place the canvas\n        this.canvas.style.left = `${canvas_left}px`;\n        this.canvas.style.top = `${canvas_top}px`;\n        this.canvas.setAttribute(\"width\", canvas_width);\n        this.canvas.setAttribute(\"height\", canvas_height);\n        this.canvas.setAttribute(\"class\", canvasClass);\n        // Adjust points to be relative to the canvas\n        start_x -= canvas_left;\n        start_y -= canvas_top;\n        end_x -= canvas_left;\n        end_y -= canvas_top;\n\n        // Draw the line\n\n        var start_offsets = null;\n        var end_offsets = null;\n        var num_offsets = 1;\n        if (startRibbon) {\n            start_offsets = [-6, -3, 0, 3, 6];\n            num_offsets = 5;\n        } else {\n            start_offsets = [0];\n        }\n        if (endRibbon) {\n            end_offsets = [-6, -3, 0, 3, 6];\n            num_offsets = 5;\n        } else {\n            end_offsets = [0];\n        }\n        var connector = this;\n        for (var i = 0; i < num_offsets; i++) {\n            var inner_width = 5;\n            var outer_width = 7;\n            if (start_offsets.length > 1 || end_offsets.length > 1) {\n                // We have a multi-run, using many lines, make them small.\n                inner_width = 1;\n                outer_width = 3;\n            }\n            connector.draw_outlined_curve(\n                start_x,\n                start_y,\n                end_x,\n                end_y,\n                cp_shift,\n                inner_width,\n                outer_width,\n                start_offsets[i % start_offsets.length],\n                end_offsets[i % end_offsets.length]\n            );\n        }\n    },\n    draw_outlined_curve: function(\n        start_x,\n        start_y,\n        end_x,\n        end_y,\n        cp_shift,\n        inner_width,\n        outer_width,\n        offset_start,\n        offset_end\n    ) {\n        var c = this.canvas.getContext(\"2d\");\n        offset_start = offset_start || 0;\n        offset_end = offset_end || 0;\n        c.lineCap = \"round\";\n        c.strokeStyle = this.outer_color;\n        c.lineWidth = outer_width;\n        c.beginPath();\n        c.moveTo(start_x, start_y + offset_start);\n        c.bezierCurveTo(\n            start_x + cp_shift,\n            start_y + offset_start,\n            end_x - cp_shift,\n            end_y + offset_end,\n            end_x,\n            end_y + offset_end\n        );\n        c.stroke();\n        // Inner line\n        c.strokeStyle = this.inner_color;\n        c.lineWidth = inner_width;\n        c.beginPath();\n        c.moveTo(start_x, start_y + offset_start);\n        c.bezierCurveTo(\n            start_x + cp_shift,\n            start_y + offset_start,\n            end_x - cp_shift,\n            end_y + offset_end,\n            end_x,\n            end_y + offset_end\n        );\n        c.stroke();\n    }\n});\nexport default Connector;\n","import $ from \"jquery\";\nimport Connector from \"mvc/workflow/workflow-connector\";\nimport { Toast } from \"ui/toast\";\n\nclass Workflow {\n    constructor(app, canvas_container) {\n        this.app = app;\n        this.canvas_container = canvas_container;\n        this.id_counter = 0;\n        this.nodes = {};\n        this.name = null;\n        this.has_changes = false;\n        this.active_form_has_changes = false;\n        this.workflowOutputLabels = {};\n        this.workflow_version = 0;\n    }\n    canLabelOutputWith(label) {\n        if (label) {\n            return !(label in this.workflowOutputLabels);\n        } else {\n            // empty labels are non-exclusive, so allow this one.\n            return true;\n        }\n    }\n    registerOutputLabel(label) {\n        if (label) {\n            this.workflowOutputLabels[label] = true;\n        }\n    }\n    unregisterOutputLabel(label) {\n        if (label) {\n            delete this.workflowOutputLabels[label];\n        }\n    }\n    updateOutputLabel(fromLabel, toLabel) {\n        if (fromLabel) {\n            this.unregisterOutputLabel(fromLabel);\n        }\n        if (!this.canLabelOutputWith(toLabel)) {\n            Toast.warning(\n                `Workflow contains duplicate workflow output labels ${toLabel}. This must be fixed before it can be saved.`\n            );\n        }\n        if (toLabel) {\n            this.registerOutputLabel(toLabel);\n        }\n    }\n    attemptUpdateOutputLabel(node, outputName, label) {\n        if (this.canLabelOutputWith(label)) {\n            node.labelWorkflowOutput(outputName, label);\n            node.nodeView.redrawWorkflowOutputs();\n            return true;\n        } else {\n            return false;\n        }\n    }\n    create_node(type, title_text, content_id) {\n        var node = this.app.prebuildNode(type, title_text, content_id);\n        this.add_node(node);\n        this.fit_canvas_to_nodes();\n        this.app.canvas_manager.draw_overview();\n        this.activate_node(node);\n        return node;\n    }\n    add_node(node) {\n        node.id = this.id_counter;\n        node.element.attr(\"id\", `wf-node-step-${node.id}`);\n        node.element.attr(\"node-label\", node.label);\n        this.id_counter++;\n        this.nodes[node.id] = node;\n        this.has_changes = true;\n        node.workflow = this;\n    }\n    remove_node(node) {\n        if (this.active_node == node) {\n            this.clear_active_node();\n        }\n        delete this.nodes[node.id];\n        this.has_changes = true;\n    }\n    remove_all() {\n        var wf = this;\n        $.each(this.nodes, (k, v) => {\n            v.destroy();\n            wf.remove_node(v);\n        });\n    }\n    rectify_workflow_outputs() {\n        // Find out if we're using workflow_outputs or not.\n        var using_workflow_outputs = false;\n        var has_existing_pjas = false;\n        $.each(this.nodes, (k, node) => {\n            if (node.type === \"tool\" && node.workflow_outputs && node.workflow_outputs.length > 0) {\n                using_workflow_outputs = true;\n            }\n            $.each(node.post_job_actions, (pja_id, pja) => {\n                if (pja.action_type === \"HideDatasetAction\") {\n                    has_existing_pjas = true;\n                }\n            });\n        });\n        if (using_workflow_outputs !== false || has_existing_pjas !== false) {\n            // Using workflow outputs, or has existing pjas.  Remove all PJAs and recreate based on outputs.\n            $.each(this.nodes, (k, node) => {\n                var node_changed = false;\n                if (node.post_job_actions === null) {\n                    node.post_job_actions = {};\n                    node_changed = true;\n                }\n                var pjas_to_rem = [];\n                $.each(node.post_job_actions, (pja_id, pja) => {\n                    if (pja.action_type == \"HideDatasetAction\") {\n                        pjas_to_rem.push(pja_id);\n                    }\n                });\n                if (pjas_to_rem.length > 0) {\n                    $.each(pjas_to_rem, (i, pja_name) => {\n                        node_changed = true;\n                        delete node.post_job_actions[pja_name];\n                    });\n                }\n                if (using_workflow_outputs) {\n                    $.each(node.output_terminals, (ot_id, ot) => {\n                        var create_pja = !node.isWorkflowOutput(ot.name);\n                        if (create_pja === true) {\n                            node_changed = true;\n                            var pja = {\n                                action_type: \"HideDatasetAction\",\n                                output_name: ot.name,\n                                action_arguments: {}\n                            };\n                            node.post_job_actions[`HideDatasetAction${ot.name}`] = null;\n                            node.post_job_actions[`HideDatasetAction${ot.name}`] = pja;\n                        }\n                    });\n                }\n                // lastly, if this is the active node, and we made changes, reload the display at right.\n                if (this.active_node == node && node_changed === true) {\n                    this.reload_active_node();\n                }\n            });\n        }\n    }\n    to_simple() {\n        var nodes = {};\n        $.each(this.nodes, (i, node) => {\n            var input_connections = {};\n            $.each(node.input_terminals, (k, t) => {\n                input_connections[t.name] = null;\n                // There should only be 0 or 1 connectors, so this is\n                // really a sneaky if statement\n                var cons = [];\n                $.each(t.connectors, (i, c) => {\n                    if (c.handle1) {\n                        var con_dict = {\n                            id: c.handle1.node.id,\n                            output_name: c.handle1.name\n                        };\n                        var input_subworkflow_step_id = t.attributes.input.input_subworkflow_step_id;\n                        if (input_subworkflow_step_id !== undefined) {\n                            con_dict.input_subworkflow_step_id = input_subworkflow_step_id;\n                        }\n                        cons[i] = con_dict;\n                        input_connections[t.name] = cons;\n                    }\n                });\n            });\n            var post_job_actions = {};\n            if (node.post_job_actions) {\n                $.each(node.post_job_actions, (i, act) => {\n                    var pja = {\n                        action_type: act.action_type,\n                        output_name: act.output_name,\n                        action_arguments: act.action_arguments\n                    };\n                    post_job_actions[act.action_type + act.output_name] = null;\n                    post_job_actions[act.action_type + act.output_name] = pja;\n                });\n            }\n            if (!node.workflow_outputs) {\n                node.workflow_outputs = [];\n                // Just in case.\n            }\n            var node_data = {\n                id: node.id,\n                type: node.type,\n                content_id: node.content_id,\n                tool_version: node.config_form ? node.config_form.version : null,\n                tool_state: node.tool_state,\n                errors: node.errors,\n                input_connections: input_connections,\n                position: $(node.element).position(),\n                annotation: node.annotation,\n                post_job_actions: node.post_job_actions,\n                uuid: node.uuid,\n                label: node.label,\n                workflow_outputs: node.workflow_outputs\n            };\n            nodes[node.id] = node_data;\n        });\n        return { steps: nodes };\n    }\n    from_simple(data, initialImport_) {\n        var initialImport = initialImport_ === undefined ? true : initialImport_;\n        var wf = this;\n        var offset = 0;\n        if (initialImport) {\n            wf.name = data.name;\n        } else {\n            offset = Object.keys(wf.nodes).length;\n        }\n        var max_id = offset;\n        // First pass, nodes\n        var using_workflow_outputs = false;\n        wf.workflow_version = data.version;\n        $.each(data.steps, (id, step) => {\n            var node = wf.app.prebuildNode(step.type, step.name, step.content_id);\n            // If workflow being copied into another, wipe UUID and let\n            // Galaxy assign new ones.\n            if (!initialImport) {\n                step.uuid = null;\n                $.each(step.workflow_outputs, (name, workflow_output) => {\n                    workflow_output.uuid = null;\n                });\n            }\n            node.init_field_data(step);\n            if (step.position) {\n                node.element.css({\n                    top: step.position.top,\n                    left: step.position.left\n                });\n            }\n            node.id = parseInt(step.id) + offset;\n            node.element.attr(\"id\", `wf-node-step-${node.id}`);\n            node.element.attr(\"node-label\", step.label);\n            wf.nodes[node.id] = node;\n            max_id = Math.max(max_id, parseInt(id) + offset);\n            // For older workflows, it's possible to have HideDataset PJAs, but not WorkflowOutputs.\n            // Check for either, and then add outputs in the next pass.\n            if (!using_workflow_outputs) {\n                if (node.workflow_outputs.length > 0) {\n                    using_workflow_outputs = true;\n                } else {\n                    $.each(node.post_job_actions || [], (pja_id, pja) => {\n                        if (pja.action_type === \"HideDatasetAction\") {\n                            using_workflow_outputs = true;\n                        }\n                    });\n                }\n            }\n        });\n        wf.id_counter = max_id + 1;\n        // Second pass, connections\n        $.each(data.steps, (id, step) => {\n            var node = wf.nodes[parseInt(id) + offset];\n            $.each(step.input_connections, (k, v) => {\n                if (v) {\n                    if (!$.isArray(v)) {\n                        v = [v];\n                    }\n                    $.each(v, (l, x) => {\n                        var other_node = wf.nodes[parseInt(x.id) + offset];\n                        var c = new Connector();\n                        c.connect(other_node.output_terminals[x.output_name], node.input_terminals[k]);\n                        c.redraw();\n                    });\n                }\n            });\n            if (using_workflow_outputs) {\n                // Ensure that every output terminal has a WorkflowOutput or HideDatasetAction.\n                $.each(node.output_terminals, (ot_id, ot) => {\n                    if (node.post_job_actions[`HideDatasetAction${ot.name}`] === undefined) {\n                        node.addWorkflowOutput(ot.name);\n                        var callout = $(node.element).find(`.callout-terminal.${ot.name.replace(/(?=[()])/g, \"\\\\\")}`);\n                        callout.find(\"icon\").addClass(\"mark-terminal-active\");\n                        wf.has_changes = true;\n                    }\n                });\n            }\n        });\n    }\n    check_changes_in_active_form() {\n        // If active form has changed, save it\n        if (this.active_form_has_changes) {\n            this.has_changes = true;\n            // Submit form.\n            $(\"#right-content\")\n                .find(\"form\")\n                .submit();\n            this.active_form_has_changes = false;\n        }\n    }\n    reload_active_node() {\n        if (this.active_node) {\n            var node = this.active_node;\n            this.clear_active_node();\n            this.activate_node(node);\n        }\n    }\n    clear_active_node() {\n        if (this.active_node) {\n            this.active_node.make_inactive();\n            this.active_node = null;\n        }\n        document.activeElement.blur();\n        this.app.showAttributes();\n    }\n    activate_node(node) {\n        if (this.active_node != node) {\n            this.check_changes_in_active_form();\n            this.clear_active_node();\n            this.app.showForm(node.config_form, node);\n            node.make_active();\n            this.active_node = node;\n        }\n    }\n    node_changed(node, force) {\n        this.has_changes = true;\n        if (this.active_node == node && force) {\n            // Force changes to be saved even on new connection (previously dumped)\n            this.check_changes_in_active_form();\n            this.app.showForm(node.config_form, node);\n        }\n        this.app.showWorkflowParameters();\n    }\n    layout() {\n        this.check_changes_in_active_form();\n        this.has_changes = true;\n        // Prepare predecessor / successor tracking\n        var n_pred = {};\n        var successors = {};\n        // First pass to initialize arrays even for nodes with no connections\n        $.each(this.nodes, (id, node) => {\n            if (n_pred[id] === undefined) {\n                n_pred[id] = 0;\n            }\n            if (successors[id] === undefined) {\n                successors[id] = [];\n            }\n        });\n        // Second pass to count predecessors and successors\n        $.each(this.nodes, (id, node) => {\n            $.each(node.input_terminals, (j, t) => {\n                $.each(t.connectors, (k, c) => {\n                    // A connection exists from `other` to `node`\n                    var other = c.handle1.node;\n                    // node gains a predecessor\n                    n_pred[node.id] += 1;\n                    // other gains a successor\n                    successors[other.id].push(node.id);\n                });\n            });\n        });\n        // Assemble order, tracking levels\n        var node_ids_by_level = [];\n        for (;;) {\n            // Everything without a predecessor\n            var level_parents = [];\n            for (var pred_k in n_pred) {\n                if (n_pred[pred_k] === 0) {\n                    level_parents.push(pred_k);\n                }\n            }\n            if (level_parents.length === 0) {\n                break;\n            }\n            node_ids_by_level.push(level_parents);\n            // Remove the parents from this level, and decrement the number\n            // of predecessors for each successor\n            for (var k in level_parents) {\n                var v = level_parents[k];\n                delete n_pred[v];\n                for (var sk in successors[v]) {\n                    n_pred[successors[v][sk]] -= 1;\n                }\n            }\n        }\n        if (n_pred.length) {\n            // ERROR: CYCLE! Currently we do nothing\n            return;\n        }\n        // Layout each level\n        var all_nodes = this.nodes;\n        var h_pad = 80;\n        var v_pad = 30;\n        var left = h_pad;\n        $.each(node_ids_by_level, (i, ids) => {\n            // We keep nodes in the same order in a level to give the user\n            // some control over ordering\n            ids.sort((a, b) => $(all_nodes[a].element).position().top - $(all_nodes[b].element).position().top);\n            // Position each node\n            var max_width = 0;\n            var top = v_pad;\n            $.each(ids, (j, id) => {\n                var node = all_nodes[id];\n                var element = $(node.element);\n                $(element).css({ top: top, left: left });\n                max_width = Math.max(max_width, $(element).width());\n                top += $(element).height() + v_pad;\n            });\n            left += max_width + h_pad;\n        });\n        // Need to redraw all connectors\n        $.each(all_nodes, (_, node) => {\n            node.redraw();\n        });\n    }\n    bounds_for_all_nodes() {\n        var xmin = Infinity;\n        var xmax = -Infinity;\n        var ymin = Infinity;\n        var ymax = -Infinity;\n        var p;\n        $.each(this.nodes, (id, node) => {\n            var e = $(node.element);\n            p = e.position();\n            xmin = Math.min(xmin, p.left);\n            xmax = Math.max(xmax, p.left + e.width());\n            ymin = Math.min(ymin, p.top);\n            ymax = Math.max(ymax, p.top + e.width());\n        });\n        return { xmin: xmin, xmax: xmax, ymin: ymin, ymax: ymax };\n    }\n    fit_canvas_to_nodes() {\n        // Math utils\n        function round_up(x, n) {\n            return Math.ceil(x / n) * n;\n        }\n        function fix_delta(x, n) {\n            if (x < n || x > 3 * n) {\n                var new_pos = (Math.ceil((x % n) / n) + 1) * n;\n                return -(x - new_pos);\n            }\n            return 0;\n        }\n        // Span of all elements\n        var canvasZoom = this.app.canvas_manager.canvasZoom;\n        var bounds = this.bounds_for_all_nodes();\n        var position = this.canvas_container.position();\n        var parent = this.canvas_container.parent();\n        // Determine amount we need to expand on top/left\n        var xmin_delta = fix_delta(bounds.xmin, 100);\n        var ymin_delta = fix_delta(bounds.ymin, 100);\n        // May need to expand farther to fill viewport\n        xmin_delta = Math.max(xmin_delta, position.left);\n        ymin_delta = Math.max(ymin_delta, position.top);\n        var left = position.left - xmin_delta;\n        var top = position.top - ymin_delta;\n        // Same for width/height\n        var width = round_up(bounds.xmax + 100, 100) + xmin_delta;\n        var height = round_up(bounds.ymax + 100, 100) + ymin_delta;\n        width = Math.max(width, -left + parent.width());\n        height = Math.max(height, -top + parent.height());\n        // Grow the canvas container\n        this.canvas_container.css({\n            left: left / canvasZoom,\n            top: top / canvasZoom,\n            width: width,\n            height: height\n        });\n        // Move elements back if needed\n        this.canvas_container.children().each(function() {\n            var p = $(this).position();\n            $(this).css(\"left\", (p.left + xmin_delta) / canvasZoom);\n            $(this).css(\"top\", (p.top + ymin_delta) / canvasZoom);\n        });\n    }\n}\n\nexport default Workflow;\n","import $ from \"jquery\";\n\n// FIXME: merge scroll panel into CanvasManager, clean up hardcoded stuff.\nclass ScrollPanel {\n    constructor(panel) {\n        this.panel = panel;\n    }\n    test(e, onmove) {\n        window.clearTimeout(this.timeout);\n        var x = e.pageX;\n        var y = e.pageY;\n        // Panel size and position\n        var panel = $(this.panel);\n        var panel_pos = panel.position();\n        var panel_w = panel.width();\n        var panel_h = panel.height();\n        // Viewport size and offset\n        var viewport = panel.parent();\n        var viewport_w = viewport.width();\n        var viewport_h = viewport.height();\n        var viewport_offset = viewport.offset();\n        // Edges of viewport (in page coordinates)\n        var min_x = viewport_offset.left;\n        var min_y = viewport_offset.top;\n        var max_x = min_x + viewport.width();\n        var max_y = min_y + viewport.height();\n        // Legal panel range\n        var p_min_x = -(panel_w - viewport_w / 2);\n        var p_min_y = -(panel_h - viewport_h / 2);\n        var p_max_x = viewport_w / 2;\n        var p_max_y = viewport_h / 2;\n        // Did the panel move?\n        var moved = false;\n        // Constants\n        var close_dist = 5;\n        var nudge = 23;\n        var t = 0;\n        if (x - close_dist < min_x) {\n            if (panel_pos.left < p_max_x) {\n                t = Math.min(nudge, p_max_x - panel_pos.left);\n                panel.css(\"left\", panel_pos.left + t);\n                moved = true;\n            }\n        } else if (x + close_dist > max_x) {\n            if (panel_pos.left > p_min_x) {\n                t = Math.min(nudge, panel_pos.left - p_min_x);\n                panel.css(\"left\", panel_pos.left - t);\n                moved = true;\n            }\n        } else if (y - close_dist < min_y) {\n            if (panel_pos.top < p_max_y) {\n                t = Math.min(nudge, p_max_y - panel_pos.top);\n                panel.css(\"top\", panel_pos.top + t);\n                moved = true;\n            }\n        } else if (y + close_dist > max_y) {\n            if (panel_pos.top > p_min_y) {\n                t = Math.min(nudge, panel_pos.top - p_min_x);\n                panel.css(\"top\", `${panel_pos.top - t}px`);\n                moved = true;\n            }\n        }\n        if (moved) {\n            // Keep moving even if mouse doesn't move\n            onmove();\n            this.timeout = window.setTimeout(() => {\n                this.test(e, onmove);\n            }, 50);\n        }\n    }\n    stop() {\n        window.clearTimeout(this.timeout);\n    }\n}\n\n// Zoom levels to use for zooming the workflow canvas\nconst zoomLevels = [0.25, 0.33, 0.5, 0.67, 0.75, 0.8, 0.9, 1, 1.1, 1.25, 1.5, 1.75, 2, 2.5, 3, 4];\n\n// Default zoome level (1)\nconst defaultZoomLevel = 7;\n\nclass CanvasManager {\n    constructor(app, canvas_viewport, overview) {\n        this.app = app;\n        this.cv = canvas_viewport;\n        this.cc = this.cv.find(\"#canvas-container\");\n        this.overview = overview;\n        this.oc = overview.find(\"#overview-canvas\");\n        this.ov = overview.find(\"#overview-viewport\");\n        // Initialize zooming\n        this.zoomLevel = defaultZoomLevel;\n        this.canvasZoom = zoomLevels[defaultZoomLevel];\n        this.initZoomControls();\n        // Make overview box draggable\n        this.init_drag();\n        // Initialize Copy & Paste events\n        this.init_copy_paste();\n    }\n    setZoom(zoomLevel) {\n        this.zoomLevel = Math.min(Math.max(0, zoomLevel), zoomLevels.length);\n        this.canvasZoom = zoomLevels[this.zoomLevel];\n        // Set CSS transform to appropriate zoom level\n        this.cv.css(\"transform-origin\", \"top left\");\n        this.cv.css(\"transform\", \"scale(\" + this.canvasZoom + \")\");\n        // Modify canvas size to account for scale\n        this.cv.css(\"width\", `${100 / this.canvasZoom}%`);\n        this.cv.css(\"height\", `${100 / this.canvasZoom}%`);\n        // Update canvas size\n        this.app.workflow.fit_canvas_to_nodes();\n    }\n    initZoomControls() {\n        var zoomControl = $('<div class=\"btn-group-vertical\"/>').css({\n            position: \"absolute\",\n            left: \"1rem\",\n            bottom: \"1rem\"\n        });\n        zoomControl.append(\n            $('<div class=\"btn btn-secondary fa fa-plus\"/>').click(() => this.setZoom(this.zoomLevel + 1))\n        );\n        zoomControl.append(\n            $('<div class=\"btn btn-secondary fa fa-minus\"/>').click(() => this.setZoom(this.zoomLevel - 1))\n        );\n        this.cv.closest(\"#workflow-canvas-body\").append(zoomControl);\n    }\n\n    init_drag() {\n        var self = this;\n        var move = (x, y) => {\n            x = Math.min(x, self.cv.width() / 2);\n            x = Math.max(x, -self.cc.width() + self.cv.width() / 2);\n            y = Math.min(y, self.cv.height() / 2);\n            y = Math.max(y, -self.cc.height() + self.cv.height() / 2);\n            self.cc.css({\n                left: x,\n                top: y\n            });\n            self.cv.css({\n                \"background-position-x\": x,\n                \"background-position-y\": y\n            });\n            self.update_viewport_overlay();\n        };\n        // Dragging within canvas background\n        this.cc.each(function() {\n            this.scroll_panel = new ScrollPanel(this);\n        });\n        var x_adjust;\n        var y_adjust;\n        this.cv\n            .bind(\"click\", function() {\n                document.activeElement.blur();\n            })\n            .bind(\"dragstart\", function() {\n                var o = $(this).offset();\n                var p = self.cc.position();\n                y_adjust = p.top - o.top;\n                x_adjust = p.left - o.left;\n            })\n            .bind(\"drag\", (e, d) => {\n                move((d.offsetX + x_adjust) / this.canvasZoom, (d.offsetY + y_adjust) / this.canvasZoom);\n            })\n            .bind(\"dragend\", () => {\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            });\n        this.overview.click(e => {\n            if (self.overview.hasClass(\"blockaclick\")) {\n                self.overview.removeClass(\"blockaclick\");\n            } else {\n                var in_w = self.cc.width();\n                var in_h = self.cc.height();\n                var o_w = self.oc.width();\n                var o_h = self.oc.height();\n                var new_x_offset = e.pageX - self.oc.offset().left - self.ov.width() / 2;\n                var new_y_offset = e.pageY - self.oc.offset().top - self.ov.height() / 2;\n                move(-((new_x_offset / o_w) * in_w), -((new_y_offset / o_h) * in_h));\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            }\n        });\n        // Dragging for overview pane\n        this.ov\n            .bind(\"drag\", (e, d) => {\n                var in_w = self.cc.width();\n                var in_h = self.cc.height();\n                var o_w = self.oc.width();\n                var o_h = self.oc.height();\n                var new_x_offset = d.offsetX - self.overview.offset().left;\n                var new_y_offset = d.offsetY - self.overview.offset().top;\n                move(-((new_x_offset / o_w) * in_w), -((new_y_offset / o_h) * in_h));\n            })\n            .bind(\"dragend\", () => {\n                self.overview.addClass(\"blockaclick\");\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            });\n        // Dragging for overview border (resize)\n        $(\".workflow-overview\").bind(\"drag\", function(e, d) {\n            var op = $(this).offsetParent();\n            var opo = op.offset();\n            var new_size = Math.max(op.width() - (d.offsetX - opo.left), op.height() - (d.offsetY - opo.top));\n            $(this).css({\n                width: new_size,\n                height: new_size\n            });\n            self.draw_overview();\n        });\n        /*  Disable dragging for child element of the panel so that resizing can\n                only be done by dragging the borders */\n        $(\".workflow-overview div\").bind(\"drag\", () => {});\n    }\n    init_copy_paste() {\n        document.addEventListener(\"copy\", e => {\n            // If it appears that the user is trying to copy/paste text, we\n            // pass that through.\n            if (window.getSelection().toString() === \"\") {\n                if (this.app.workflow.active_node && this.app.workflow.active_node.type !== \"subworkflow\") {\n                    e.clipboardData.setData(\n                        \"application/json\",\n                        JSON.stringify({\n                            nodeId: this.app.workflow.active_node.id\n                        })\n                    );\n                }\n                e.preventDefault();\n            }\n        });\n\n        document.addEventListener(\"paste\", e => {\n            // If it appears that the user is trying to paste into a text box,\n            // pass that through and skip the workflow copy/paste logic.\n            if (\n                document.activeElement &&\n                document.activeElement.type !== \"textarea\" &&\n                document.activeElement.type !== \"text\"\n            ) {\n                var nodeId;\n                try {\n                    nodeId = JSON.parse(e.clipboardData.getData(\"application/json\")).nodeId;\n                } catch (error) {\n                    console.debug(error);\n                }\n                if (nodeId && this.app.workflow.nodes.hasOwnProperty(nodeId)) {\n                    this.app.workflow.nodes[nodeId].clone();\n                }\n                e.preventDefault();\n            }\n        });\n    }\n    update_viewport_overlay() {\n        var cc = this.cc;\n        var cv = this.cv;\n        var oc = this.oc;\n        var ov = this.ov;\n        var in_w = cc.width();\n        var in_h = cc.height();\n        var o_w = oc.width();\n        var o_h = oc.height();\n        var cc_pos = cc.position();\n        ov.css({\n            left: -((cc_pos.left / in_w) * o_w),\n            top: -((cc_pos.top / in_h) * o_h),\n            // Subtract 2 to account for borders (maybe just change box sizing style instead?)\n            width: (cv.width() / in_w) * o_w - 2,\n            height: (cv.height() / in_h) * o_h - 2\n        });\n    }\n    draw_overview() {\n        var canvas_el = $(\"#overview-canvas\");\n        var size = canvas_el\n            .parent()\n            .parent()\n            .width();\n\n        var c = canvas_el.get(0).getContext(\"2d\");\n        var in_w = $(\"#canvas-container\").width();\n        var in_h = $(\"#canvas-container\").height();\n        var o_h;\n        var shift_h;\n        var o_w;\n        var shift_w;\n        // Fit canvas into overview area\n        var cv_w = this.cv.width();\n        var cv_h = this.cv.height();\n        if (in_w < cv_w && in_h < cv_h) {\n            // Canvas is smaller than viewport\n            o_w = (in_w / cv_w) * size;\n            shift_w = (size - o_w) / 2;\n            o_h = (in_h / cv_h) * size;\n            shift_h = (size - o_h) / 2;\n        } else if (in_w < in_h) {\n            // Taller than wide\n            shift_h = 0;\n            o_h = size;\n            o_w = Math.ceil((o_h * in_w) / in_h);\n            shift_w = (size - o_w) / 2;\n        } else {\n            // Wider than tall\n            o_w = size;\n            shift_w = 0;\n            o_h = Math.ceil((o_w * in_h) / in_w);\n            shift_h = (size - o_h) / 2;\n        }\n        canvas_el.parent().css({\n            left: shift_w,\n            top: shift_h,\n            width: o_w,\n            height: o_h\n        });\n        canvas_el.attr(\"width\", o_w);\n        canvas_el.attr(\"height\", o_h);\n        // Draw overview\n        $.each(this.app.workflow.nodes, (id, node) => {\n            c.fillStyle = \"gray\";\n            var node_element = $(node.element);\n            var position = node_element.position();\n            var x = (position.left / in_w) * o_w;\n            var y = (position.top / in_h) * o_h;\n            var w = (node_element.width() / in_w) * o_w;\n            var h = (node_element.height() / in_h) * o_h;\n            if (node.errors) {\n                c.fillStyle = \"#e31a1e\";\n            }\n            c.fillRect(x, y, w, h);\n        });\n        this.update_viewport_overlay();\n    }\n}\n\nexport default CanvasManager;\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\nfunction CollectionTypeDescription(collectionType) {\n    this.collectionType = collectionType;\n    this.isCollection = true;\n    this.rank = collectionType.split(\":\").length;\n}\n\nfunction ConnectionAcceptable(canAccept, reason) {\n    this.canAccept = canAccept;\n    this.reason = reason;\n}\n\nvar NULL_COLLECTION_TYPE_DESCRIPTION = {\n    isCollection: false,\n    canMatch: function() {\n        return false;\n    },\n    canMapOver: function() {\n        return false;\n    },\n    toString: function() {\n        return \"NullCollectionType[]\";\n    },\n    append: function(otherCollectionType) {\n        return otherCollectionType;\n    },\n    equal: function(other) {\n        return other === this;\n    }\n};\n\nvar ANY_COLLECTION_TYPE_DESCRIPTION = {\n    isCollection: true,\n    canMatch: function(other) {\n        return NULL_COLLECTION_TYPE_DESCRIPTION !== other;\n    },\n    canMapOver: function() {\n        return false;\n    },\n    toString: function() {\n        return \"AnyCollectionType[]\";\n    },\n    append: function() {\n        return ANY_COLLECTION_TYPE_DESCRIPTION;\n    },\n    equal: function(other) {\n        return other === this;\n    }\n};\n\n$.extend(CollectionTypeDescription.prototype, {\n    append: function(otherCollectionTypeDescription) {\n        if (otherCollectionTypeDescription === NULL_COLLECTION_TYPE_DESCRIPTION) {\n            return this;\n        }\n        if (otherCollectionTypeDescription === ANY_COLLECTION_TYPE_DESCRIPTION) {\n            return otherCollectionTypeDescription;\n        }\n        return new CollectionTypeDescription(`${this.collectionType}:${otherCollectionTypeDescription.collectionType}`);\n    },\n    canMatch: function(otherCollectionTypeDescription) {\n        if (otherCollectionTypeDescription === NULL_COLLECTION_TYPE_DESCRIPTION) {\n            return false;\n        }\n        if (otherCollectionTypeDescription === ANY_COLLECTION_TYPE_DESCRIPTION) {\n            return true;\n        }\n        return otherCollectionTypeDescription.collectionType == this.collectionType;\n    },\n    canMapOver: function(otherCollectionTypeDescription) {\n        if (otherCollectionTypeDescription === NULL_COLLECTION_TYPE_DESCRIPTION) {\n            return false;\n        }\n        if (otherCollectionTypeDescription === ANY_COLLECTION_TYPE_DESCRIPTION) {\n            return false;\n        }\n        if (this.rank <= otherCollectionTypeDescription.rank) {\n            // Cannot map over self...\n            return false;\n        }\n        var requiredSuffix = otherCollectionTypeDescription.collectionType;\n        return this._endsWith(this.collectionType, requiredSuffix);\n    },\n    effectiveMapOver: function(otherCollectionTypeDescription) {\n        var otherCollectionType = otherCollectionTypeDescription.collectionType;\n        var effectiveCollectionType = this.collectionType.substring(\n            0,\n            this.collectionType.length - otherCollectionType.length - 1\n        );\n        return new CollectionTypeDescription(effectiveCollectionType);\n    },\n    equal: function(otherCollectionTypeDescription) {\n        return otherCollectionTypeDescription.collectionType == this.collectionType;\n    },\n    toString: function() {\n        return `CollectionType[${this.collectionType}]`;\n    },\n    _endsWith: function(str, suffix) {\n        return str.indexOf(suffix, str.length - suffix.length) !== -1;\n    }\n});\n\nvar TerminalMapping = Backbone.Model.extend({\n    initialize: function(attr) {\n        this.mapOver = attr.mapOver || NULL_COLLECTION_TYPE_DESCRIPTION;\n        this.terminal = attr.terminal;\n        this.terminal.terminalMapping = this;\n    },\n    disableMapOver: function() {\n        this.setMapOver(NULL_COLLECTION_TYPE_DESCRIPTION);\n    },\n    setMapOver: function(collectionTypeDescription) {\n        // TODO: Can I use \"attributes\" or something to auto trigger \"change\"\n        // event?\n        this.mapOver = collectionTypeDescription;\n        this.trigger(\"change\");\n    }\n});\n\nvar Terminal = Backbone.Model.extend({\n    initialize: function(attr) {\n        this.element = attr.element;\n        this.connectors = [];\n    },\n    connect: function(connector) {\n        this.connectors.push(connector);\n        if (this.node) {\n            this.node.markChanged();\n        }\n    },\n    disconnect: function(connector) {\n        this.connectors.splice($.inArray(connector, this.connectors), 1);\n        if (this.node) {\n            this.node.markChanged();\n            this.resetMappingIfNeeded();\n            if (!connector.dragging) {\n                connector.handle2.resetCollectionTypeSource();\n            }\n        }\n    },\n    redraw: function() {\n        $.each(this.connectors, (_, c) => {\n            c.redraw();\n        });\n    },\n    destroy: function() {\n        $.each(this.connectors.slice(), (_, c) => {\n            c.destroy();\n        });\n    },\n    destroyInvalidConnections: function() {\n        _.each(this.connectors, connector => {\n            if (connector) {\n                connector.destroyIfInvalid();\n            }\n        });\n    },\n    setMapOver: function(val) {\n        let output_val = val;\n        if (this.multiple) {\n            // emulate list input\n            let description = new CollectionTypeDescription(\"list\");\n            if (val.collectionType === description.collectionType) {\n                // No mapping over necessary\n                return;\n            }\n            output_val = val.effectiveMapOver ? val.effectiveMapOver(description) : val;\n        }\n\n        if (!this.mapOver().equal(val)) {\n            this.terminalMapping.setMapOver(val);\n            _.each(this.node.output_terminals, outputTerminal => {\n                outputTerminal.setMapOver(output_val);\n            });\n        }\n    },\n    mapOver: function() {\n        if (!this.terminalMapping) {\n            return NULL_COLLECTION_TYPE_DESCRIPTION;\n        } else {\n            return this.terminalMapping.mapOver;\n        }\n    },\n    isMappedOver: function() {\n        return this.terminalMapping && this.terminalMapping.mapOver.isCollection;\n    },\n    resetMapping: function() {\n        this.terminalMapping.disableMapOver();\n    },\n\n    resetCollectionTypeSource: function() {\n        let node = this.node;\n        _.each(node.output_terminals, function(output_terminal) {\n            let type_source = output_terminal.attributes.collection_type_source;\n            if (type_source && output_terminal.attributes.collection_type) {\n                output_terminal.attributes.collection_type = null;\n                output_terminal.update(output_terminal.attributes);\n            }\n        });\n    },\n\n    resetMappingIfNeeded: function() {} // Subclasses should override this...\n});\n\nvar OutputTerminal = Terminal.extend({\n    initialize: function(attr) {\n        Terminal.prototype.initialize.call(this, attr);\n        this.datatypes = attr.datatypes;\n    },\n\n    resetMappingIfNeeded: function() {\n        // If inputs were only mapped over to preserve\n        // an output just disconnected reset these...\n        if (!this.node.hasConnectedOutputTerminals() && !this.node.hasConnectedMappedInputTerminals()) {\n            _.each(this.node.mappedInputTerminals(), mappedInput => {\n                mappedInput.resetMappingIfNeeded();\n            });\n        }\n\n        var noMappedInputs = !this.node.hasMappedOverInputTerminals();\n        if (noMappedInputs) {\n            this.resetMapping();\n        }\n    },\n\n    resetMapping: function() {\n        this.terminalMapping.disableMapOver();\n        _.each(this.connectors, connector => {\n            var connectedInput = connector.handle2;\n            if (connectedInput) {\n                // Not exactly right because this is still connected.\n                // Either rewrite resetMappingIfNeeded or disconnect\n                // and reconnect if valid.\n                connectedInput.resetMappingIfNeeded();\n                connector.destroyIfInvalid();\n            }\n        });\n    }\n});\n\nvar BaseInputTerminal = Terminal.extend({\n    initialize: function(attr) {\n        Terminal.prototype.initialize.call(this, attr);\n        this.update(attr.input); // subclasses should implement this...\n    },\n    canAccept: function(other) {\n        if (this._inputFilled()) {\n            return new ConnectionAcceptable(\n                false,\n                \"Input already filled with another connection, delete it before connecting another output.\"\n            );\n        } else {\n            return this.attachable(other);\n        }\n    },\n    resetMappingIfNeeded: function() {\n        var mapOver = this.mapOver();\n        if (!mapOver.isCollection) {\n            return;\n        }\n        // No output terminals are counting on this being mapped\n        // over if connected inputs are still mapped over or if none\n        // of the outputs are connected...\n        var reset = this.node.hasConnectedMappedInputTerminals() || !this.node.hasConnectedOutputTerminals();\n        if (reset) {\n            this.resetMapping();\n        }\n    },\n    resetMapping: function() {\n        this.terminalMapping.disableMapOver();\n        if (!this.node.hasMappedOverInputTerminals()) {\n            _.each(this.node.output_terminals, terminal => {\n                // This shouldn't be called if there are mapped over\n                // outputs.\n                terminal.resetMapping();\n            });\n        }\n    },\n    connected: function() {\n        return this.connectors.length !== 0;\n    },\n    _inputFilled: function() {\n        var inputFilled;\n        if (!this.connected()) {\n            inputFilled = false;\n        } else {\n            if (this.multiple) {\n                if (this._collectionAttached()) {\n                    // Can only attach one collection to multiple input\n                    // data parameter.\n                    inputFilled = true;\n                } else {\n                    inputFilled = false;\n                }\n            } else {\n                inputFilled = true;\n            }\n        }\n        return inputFilled;\n    },\n    _collectionAttached: function() {\n        if (!this.connected()) {\n            return false;\n        } else {\n            var firstOutput = this.connectors[0].handle1;\n            if (!firstOutput) {\n                return false;\n            } else {\n                if (\n                    firstOutput.isCollection ||\n                    firstOutput.isMappedOver() ||\n                    firstOutput.datatypes.indexOf(\"input_collection\") > 0\n                ) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n        }\n    },\n    _mappingConstraints: function() {\n        // If this is a connected terminal, return list of collection types\n        // other terminals connected to node are constraining mapping to.\n        if (!this.node) {\n            return []; // No node - completely unconstrained\n        }\n        var mapOver = this.mapOver();\n        if (mapOver.isCollection) {\n            return [mapOver];\n        }\n\n        var constraints = [];\n        if (!this.node.hasConnectedOutputTerminals()) {\n            _.each(this.node.connectedMappedInputTerminals(), inputTerminal => {\n                constraints.push(inputTerminal.mapOver());\n            });\n        } else {\n            // All outputs should have same mapOver status - least specific.\n            constraints.push(_.first(_.values(this.node.output_terminals)).mapOver());\n        }\n        return constraints;\n    },\n    _producesAcceptableDatatype: function(other) {\n        // other is a non-collection output...\n        for (var t in this.datatypes) {\n            var thisDatatype = this.datatypes[t];\n            if (thisDatatype == \"input\") {\n                return new ConnectionAcceptable(true, null);\n            }\n            var cat_outputs = [];\n            cat_outputs = cat_outputs.concat(other.datatypes);\n            if (other.node.post_job_actions) {\n                for (var pja_i in other.node.post_job_actions) {\n                    var pja = other.node.post_job_actions[pja_i];\n                    if (\n                        pja.action_type == \"ChangeDatatypeAction\" &&\n                        (pja.output_name === \"\" || pja.output_name == other.name) &&\n                        pja.action_arguments\n                    ) {\n                        cat_outputs.push(pja.action_arguments.newtype);\n                    }\n                }\n            }\n            // FIXME: No idea what to do about case when datatype is 'input'\n            for (var other_datatype_i in cat_outputs) {\n                var other_datatype = cat_outputs[other_datatype_i];\n                if (\n                    other_datatype == \"input\" ||\n                    other_datatype == \"_sniff_\" ||\n                    other_datatype == \"input_collection\" ||\n                    window.workflow_globals.app.isSubType(cat_outputs[other_datatype_i], thisDatatype)\n                ) {\n                    return new ConnectionAcceptable(true, null);\n                }\n            }\n        }\n        return new ConnectionAcceptable(\n            false,\n            `Effective output data type(s) [${cat_outputs}] do not appear to match input type(s) [${this.datatypes}].`\n        );\n    },\n    _otherCollectionType: function(other) {\n        var otherCollectionType = NULL_COLLECTION_TYPE_DESCRIPTION;\n        if (other.isCollection) {\n            otherCollectionType = other.collectionType;\n        }\n        var otherMapOver = other.mapOver();\n        if (otherMapOver.isCollection) {\n            otherCollectionType = otherMapOver.append(otherCollectionType);\n        }\n        return otherCollectionType;\n    }\n});\n\nvar InputTerminal = BaseInputTerminal.extend({\n    update: function(input) {\n        this.datatypes = input.extensions;\n        this.multiple = input.multiple;\n        this.collection = false;\n    },\n    connect: function(connector) {\n        BaseInputTerminal.prototype.connect.call(this, connector);\n        var other_output = connector.handle1;\n        if (!other_output) {\n            return;\n        }\n        var otherCollectionType = this._otherCollectionType(other_output);\n        if (otherCollectionType.isCollection) {\n            this.setMapOver(otherCollectionType);\n        }\n    },\n    attachable: function(other) {\n        var otherCollectionType = this._otherCollectionType(other);\n        var thisMapOver = this.mapOver();\n        if (otherCollectionType.isCollection) {\n            if (this.multiple) {\n                if (this.connected() && !this._collectionAttached()) {\n                    return new ConnectionAcceptable(\n                        false,\n                        \"Cannot attach collections to data parameters with individual data inputs already attached.\"\n                    );\n                }\n                if (otherCollectionType.collectionType.endsWith(\"paired\")) {\n                    return new ConnectionAcceptable(\n                        false,\n                        \"Cannot attach paired inputs to multiple data parameters, only lists may be treated this way.\"\n                    );\n                }\n            }\n            if (thisMapOver.isCollection && thisMapOver.canMatch(otherCollectionType)) {\n                return this._producesAcceptableDatatype(other);\n            } else {\n                //  Need to check if this would break constraints...\n                var mappingConstraints = this._mappingConstraints();\n                if (mappingConstraints.every(_.bind(otherCollectionType.canMatch, otherCollectionType))) {\n                    return this._producesAcceptableDatatype(other);\n                } else {\n                    if (thisMapOver.isCollection) {\n                        // incompatible collection type attached\n                        if (this.node.hasConnectedMappedInputTerminals()) {\n                            return new ConnectionAcceptable(\n                                false,\n                                \"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry.\"\n                            );\n                        } else {\n                            return new ConnectionAcceptable(\n                                false,\n                                \"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry.\"\n                            );\n                        }\n                    } else {\n                        return new ConnectionAcceptable(\n                            false,\n                            \"Can't map over this input with output collection type - an output of this tool is not mapped over constraining this input. Disconnect output(s) and retry.\"\n                        );\n                    }\n                }\n            }\n        } else if (thisMapOver.isCollection) {\n            return new ConnectionAcceptable(\n                false,\n                \"Cannot attach non-collection outputs to mapped over inputs, consider disconnecting inputs and outputs to reset this input's mapping.\"\n            );\n        }\n        return this._producesAcceptableDatatype(other);\n    }\n});\n\nvar InputParameterTerminal = BaseInputTerminal.extend({\n    update: function(input) {\n        this.type = input.type;\n    },\n    connect: function(connector) {\n        BaseInputTerminal.prototype.connect.call(this, connector);\n    },\n    attachable: function(other) {\n        return new ConnectionAcceptable(this.type == other.attributes.type, \"\");\n    }\n});\n\nvar InputCollectionTerminal = BaseInputTerminal.extend({\n    update: function(input) {\n        this.multiple = false;\n        this.collection = true;\n        this.collection_type = input.collection_type;\n        this.datatypes = input.extensions;\n        var collectionTypes = [];\n        if (input.collection_types) {\n            _.each(input.collection_types, collectionType => {\n                collectionTypes.push(new CollectionTypeDescription(collectionType));\n            });\n        } else {\n            collectionTypes.push(ANY_COLLECTION_TYPE_DESCRIPTION);\n        }\n        this.collectionTypes = collectionTypes;\n    },\n    connect: function(connector) {\n        BaseInputTerminal.prototype.connect.call(this, connector);\n        var other = connector.handle1;\n        if (!other) {\n            return;\n        } else {\n            let node = this.node;\n            _.each(node.output_terminals, function(output_terminal) {\n                if (output_terminal.attributes.collection_type_source && !connector.dragging) {\n                    if (other.isMappedOver()) {\n                        if (other.isCollection) {\n                            output_terminal.attributes.collection_type = other.terminalMapping.mapOver.append(\n                                other.collectionType\n                            ).collectionType;\n                        } else {\n                            output_terminal.attributes.collection_type = other.terminalMapping.mapOver.collectionType;\n                        }\n                    } else {\n                        output_terminal.attributes.collection_type = other.attributes.collection_type;\n                    }\n                    output_terminal.update(output_terminal.attributes);\n                }\n            });\n        }\n\n        var effectiveMapOver = this._effectiveMapOver(other);\n        this.setMapOver(effectiveMapOver);\n    },\n    _effectiveMapOver: function(other) {\n        var collectionTypes = this.collectionTypes;\n        var otherCollectionType = this._otherCollectionType(other);\n        var canMatch = _.some(collectionTypes, collectionType => collectionType.canMatch(otherCollectionType));\n\n        if (!canMatch) {\n            for (var collectionTypeIndex in collectionTypes) {\n                var collectionType = collectionTypes[collectionTypeIndex];\n                if (otherCollectionType.canMapOver(collectionType)) {\n                    var effectiveMapOver = otherCollectionType.effectiveMapOver(collectionType);\n                    if (effectiveMapOver != NULL_COLLECTION_TYPE_DESCRIPTION) {\n                        return effectiveMapOver;\n                    }\n                }\n            }\n        }\n        return NULL_COLLECTION_TYPE_DESCRIPTION;\n    },\n    _effectiveCollectionTypes: function() {\n        var thisMapOver = this.mapOver();\n        return _.map(this.collectionTypes, t => thisMapOver.append(t));\n    },\n    attachable: function(other) {\n        var otherCollectionType = this._otherCollectionType(other);\n        if (otherCollectionType.isCollection) {\n            var effectiveCollectionTypes = this._effectiveCollectionTypes();\n            var thisMapOver = this.mapOver();\n            var canMatch = _.some(effectiveCollectionTypes, effectiveCollectionType =>\n                effectiveCollectionType.canMatch(otherCollectionType)\n            );\n            if (canMatch) {\n                // Only way a direct match...\n                return this._producesAcceptableDatatype(other);\n                // Otherwise we need to mapOver\n            } else if (thisMapOver.isCollection) {\n                // In this case, mapOver already set and we didn't match skipping...\n                if (this.node.hasConnectedMappedInputTerminals()) {\n                    return new ConnectionAcceptable(\n                        false,\n                        \"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry.\"\n                    );\n                } else {\n                    return new ConnectionAcceptable(\n                        false,\n                        \"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry.\"\n                    );\n                }\n            } else if (_.some(this.collectionTypes, collectionType => otherCollectionType.canMapOver(collectionType))) {\n                // we're not mapped over - but hey maybe we could be... lets check.\n                var effectiveMapOver = this._effectiveMapOver(other);\n                if (!effectiveMapOver.isCollection) {\n                    return new ConnectionAcceptable(false, \"Incompatible collection type(s) for attachment.\");\n                }\n                //  Need to check if this would break constraints...\n                var mappingConstraints = this._mappingConstraints();\n                if (mappingConstraints.every(d => effectiveMapOver.canMatch(d))) {\n                    return this._producesAcceptableDatatype(other);\n                } else {\n                    if (this.node.hasConnectedMappedInputTerminals()) {\n                        return new ConnectionAcceptable(\n                            false,\n                            \"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry.\"\n                        );\n                    } else {\n                        return new ConnectionAcceptable(\n                            false,\n                            \"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry.\"\n                        );\n                    }\n                }\n            } else {\n                return new ConnectionAcceptable(false, \"Incompatible collection type(s) for attachment.\");\n            }\n        } else {\n            return new ConnectionAcceptable(false, \"Cannot attach a data output to a collection input.\");\n        }\n    }\n});\n\nvar OutputCollectionTerminal = Terminal.extend({\n    initialize: function(attr) {\n        Terminal.prototype.initialize.call(this, attr);\n        this.datatypes = attr.datatypes;\n        if (attr.collection_type) {\n            this.collectionType = new CollectionTypeDescription(attr.collection_type);\n        } else {\n            var collectionTypeSource = attr.collection_type_source;\n            if (!collectionTypeSource) {\n                console.log(\"Warning: No collection type or collection type source defined.\");\n            }\n            this.collectionType = ANY_COLLECTION_TYPE_DESCRIPTION;\n        }\n        this.isCollection = true;\n    },\n    update: function(output) {\n        var newCollectionType;\n        if (output.collection_type) {\n            newCollectionType = new CollectionTypeDescription(output.collection_type);\n        } else {\n            var collectionTypeSource = output.collection_type_source;\n            if (!collectionTypeSource) {\n                console.log(\"Warning: No collection type or collection type source defined.\");\n            }\n            newCollectionType = ANY_COLLECTION_TYPE_DESCRIPTION;\n        }\n\n        let oldCollectionType = this.collectionType;\n        this.collectionType = newCollectionType;\n        // we need to iterate over a copy, as we slice this.connectors in the process of destroying connections\n        var connectors = this.connectors.slice(0);\n        if (newCollectionType.collectionType != oldCollectionType.collectionType) {\n            _.each(connectors, connector => {\n                connector.destroyIfInvalid(true);\n            });\n        }\n    }\n});\n\nvar OutputParameterTerminal = Terminal.extend({});\n\nexport default {\n    InputTerminal: InputTerminal,\n    InputParameterTerminal: InputParameterTerminal,\n    OutputTerminal: OutputTerminal,\n    OutputParameterTerminal: OutputParameterTerminal,\n    InputCollectionTerminal: InputCollectionTerminal,\n    OutputCollectionTerminal: OutputCollectionTerminal,\n    TerminalMapping: TerminalMapping,\n\n    // test export\n    CollectionTypeDescription: CollectionTypeDescription,\n    NULL_COLLECTION_TYPE_DESCRIPTION: NULL_COLLECTION_TYPE_DESCRIPTION,\n    ANY_COLLECTION_TYPE_DESCRIPTION: ANY_COLLECTION_TYPE_DESCRIPTION\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Terminals from \"mvc/workflow/workflow-terminals\";\nimport Connector from \"mvc/workflow/workflow-connector\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\nvar TerminalMappingView = Backbone.View.extend({\n    tagName: \"div\",\n    className: \"fa-icon-button fa fa-folder-o\",\n    initialize: function(options) {\n        var mapText = \"Run tool in parallel over collection\";\n        this.$el.tooltip({ delay: 500, title: mapText });\n        this.model.bind(\"change\", _.bind(this.render, this));\n    },\n    render: function() {\n        if (this.model.mapOver.isCollection) {\n            this.$el.show();\n        } else {\n            this.$el.hide();\n        }\n    }\n});\n\nvar InputTerminalMappingView = TerminalMappingView.extend({\n    events: {\n        click: \"onClick\",\n        mouseenter: \"onMouseEnter\",\n        mouseleave: \"onMouseLeave\"\n    },\n    onMouseEnter: function(e) {\n        var model = this.model;\n        if (!model.terminal.connected() && model.mapOver.isCollection) {\n            this.$el.css(\"color\", \"red\");\n        }\n    },\n    onMouseLeave: function(e) {\n        this.$el.css(\"color\", \"black\");\n    },\n    onClick: function(e) {\n        var model = this.model;\n        if (!model.terminal.connected() && model.mapOver.isCollection) {\n            // TODO: Consider prompting...\n            model.terminal.resetMapping();\n        }\n    }\n});\n\nvar TerminalView = Backbone.View.extend({\n    setupMappingView: function(terminal) {\n        var terminalMapping = new this.terminalMappingClass({\n            terminal: terminal\n        });\n        var terminalMappingView = new this.terminalMappingViewClass({\n            model: terminalMapping\n        });\n        terminalMappingView.render();\n        terminal.terminalMappingView = terminalMappingView;\n        this.terminalMappingView = terminalMappingView;\n    },\n    terminalElements: function() {\n        if (this.terminalMappingView) {\n            return [this.terminalMappingView.el, this.el];\n        } else {\n            return [this.el];\n        }\n    }\n});\n\nvar BaseInputTerminalView = TerminalView.extend({\n    className: \"terminal input-terminal\",\n    initialize: function(options) {\n        const node = options.node;\n        const input = options.input;\n        const name = input.name;\n        const id = `node-${node.cid}-input-${name}`;\n        const terminal = this.terminalForInput(input);\n        this.setupMappingView(terminal);\n        this.el.terminal = terminal;\n        this.$el.attr(\"input-name\", name);\n        this.$el.attr(\"id\", id);\n        this.$el.append($(\"<icon/>\"));\n        this.id = id;\n\n        terminal.node = node;\n        terminal.name = name;\n        terminal.label = input.label;\n        node.input_terminals[name] = terminal;\n    },\n    events: {\n        dropinit: \"onDropInit\",\n        dropstart: \"onDropStart\",\n        dropend: \"onDropEnd\",\n        drop: \"onDrop\",\n        hover: \"onHover\"\n    },\n    onDropInit: function(e, d) {\n        var terminal = this.el.terminal;\n        // Accept a dragable if it is an output terminal and has a\n        // compatible type\n        var connectionAcceptable = $(d.drag).hasClass(\"output-terminal\") && terminal.canAccept(d.drag.terminal);\n        if (connectionAcceptable.canAccept) {\n            this.$el.addClass(\"can-accept\");\n            this.$el.removeClass(\"cannot-accept\");\n            this.reason = null;\n        } else {\n            this.$el.addClass(\"cannot-accept\");\n            this.$el.removeClass(\"can-accept\");\n            this.reason = connectionAcceptable.reason;\n        }\n\n        return true;\n    },\n    onDropStart: function(e, d) {\n        if (d.proxy.terminal) {\n            if (this.$el.hasClass(\"can-accept\")) {\n                d.proxy.terminal.connectors[0].inner_color = \"#BBFFBB\";\n                d.proxy.dropTooltip = \"\";\n            } else {\n                d.proxy.terminal.connectors[0].inner_color = \"#fe7f02\";\n                if (this.reason) {\n                    d.proxy.dropTooltip = this.reason;\n                    $(d.proxy).tooltip(\"show\");\n                } else {\n                    d.proxy.dropTooltip = \"\";\n                }\n            }\n        }\n    },\n    onDropEnd: function(e, d) {\n        d.proxy.dropTooltip = \"\";\n        if (d.proxy.terminal) {\n            d.proxy.terminal.connectors[0].inner_color = \"#FFFFFF\";\n        }\n    },\n    onDrop: function(e, d) {\n        d.proxy.dropTooltip = \"\";\n        if (this.$el.hasClass(\"can-accept\")) {\n            const terminal = this.el.terminal;\n            new Connector(d.drag.terminal, terminal).redraw();\n        }\n    },\n    onHover: function() {\n        let element = this.el;\n        let terminal = element.terminal;\n        // If connected, create a popup to allow disconnection\n        if (terminal.connectors.length > 0) {\n            let t = $(\"<div/>\")\n                .addClass(\"delete-terminal\")\n                .click(() => {\n                    $.each(terminal.connectors, (_, x) => {\n                        if (x) {\n                            x.destroy();\n                        }\n                    });\n                    t.remove();\n                })\n                .on(\"mouseleave\", () => {\n                    t.remove();\n                });\n            $(element)\n                .parent()\n                .append(t);\n        }\n    }\n});\n\nvar InputTerminalView = BaseInputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: InputTerminalMappingView,\n    terminalForInput: function(input) {\n        return new Terminals.InputTerminal({\n            element: this.el,\n            input: input\n        });\n    }\n});\n\nvar InputParameterTerminalView = BaseInputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: InputTerminalMappingView,\n    terminalForInput: function(input) {\n        return new Terminals.InputParameterTerminal({\n            element: this.el,\n            input: input\n        });\n    }\n});\n\nvar InputCollectionTerminalView = BaseInputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: InputTerminalMappingView,\n    terminalForInput: function(input) {\n        return new Terminals.InputCollectionTerminal({\n            element: this.el,\n            input: input\n        });\n    }\n});\n\nvar BaseOutputTerminalView = TerminalView.extend({\n    className: \"terminal output-terminal\",\n    initialize: function(options) {\n        const node = options.node;\n        const output = options.output;\n        const name = output.name;\n        const id = `node-${node.cid}-output-${name}`;\n        const terminal = this.terminalForOutput(output);\n        this.setupMappingView(terminal);\n        this.el.terminal = terminal;\n        this.$el.attr(\"output-name\", name);\n        this.$el.attr(\"id\", id);\n        this.$el.append($(\"<icon/>\"));\n        terminal.node = node;\n        terminal.name = name;\n        terminal.label = output.label;\n        node.output_terminals[name] = terminal;\n    },\n    events: {\n        drag: \"onDrag\",\n        dragstart: \"onDragStart\",\n        dragend: \"onDragEnd\"\n    },\n    onDrag: function(e, d) {\n        var onmove = () => {\n            // FIXME: global\n            var canvasZoom = window.workflow_globals.canvas_manager.canvasZoom;\n            var po = $(d.proxy)\n                .offsetParent()\n                .offset();\n\n            var x = d.offsetX - po.left;\n            var y = d.offsetY - po.top;\n            $(d.proxy).css({ left: x / canvasZoom, top: y / canvasZoom });\n            d.proxy.terminal.redraw();\n            // FIXME: global\n            window.workflow_globals.canvas_manager.update_viewport_overlay();\n        };\n        onmove();\n        $(\"#canvas-container\")\n            .get(0)\n            .scroll_panel.test(e, onmove);\n    },\n    onDragStart: function(e, d) {\n        $(d.available).addClass(\"input-terminal-active\");\n        // Save PJAs in the case of change datatype actions.\n        window.workflow_globals.workflow.check_changes_in_active_form();\n        // Drag proxy div\n        var h = $(\"<div class='drag-terminal'/>\")\n            .appendTo(\"#canvas-container\")\n            .get(0);\n\n        h.dropTooltip = \"\";\n\n        // Terminal and connection to display noodle while dragging\n        $(h).tooltip({\n            title: function() {\n                return h.dropTooltip || \"\";\n            }\n        });\n        h.terminal = new Terminals.OutputTerminal({ element: h });\n        var c = new Connector();\n        c.dragging = true;\n        c.connect(this.el.terminal, h.terminal);\n        return h;\n    },\n    onDragEnd: function(e, d) {\n        var connector = d.proxy.terminal.connectors[0];\n        // check_changes_in_active_form may change the state and cause a\n        // the connection to have already been destroyed. There must be better\n        // ways to handle this but the following check fixes some serious GUI\n        // bugs for now.\n        if (connector) {\n            connector.destroy();\n        }\n        $(d.proxy).tooltip(\"dispose\");\n        $(d.proxy).remove();\n        $(d.available).removeClass(\"input-terminal-active\");\n        $(\"#canvas-container\")\n            .get(0)\n            .scroll_panel.stop();\n    }\n});\n\nvar OutputTerminalView = BaseOutputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: TerminalMappingView,\n    terminalForOutput: function(output) {\n        var type = output.extensions;\n        var terminal = new Terminals.OutputTerminal({\n            element: this.el,\n            datatypes: type\n        });\n        return terminal;\n    }\n});\n\nvar OutputCollectionTerminalView = BaseOutputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: TerminalMappingView,\n    terminalForOutput: function(output) {\n        var collection_type = output.collection_type;\n        var collection_type_source = output.collection_type_source;\n        var terminal = new Terminals.OutputCollectionTerminal({\n            element: this.el,\n            collection_type: collection_type,\n            collection_type_source: collection_type_source,\n            datatypes: output.extensions\n        });\n        return terminal;\n    }\n});\n\nvar OutputParameterTerminalView = BaseOutputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: TerminalMappingView,\n    terminalForOutput: function(output) {\n        var terminal = new Terminals.OutputCollectionTerminal({\n            element: this.el,\n            type: output.type\n        });\n        return terminal;\n    }\n});\n\nexport default {\n    InputTerminalView: InputTerminalView,\n    InputParameterTerminalView: InputParameterTerminalView,\n    OutputTerminalView: OutputTerminalView,\n    OutputParameterTerminalView: OutputParameterTerminalView,\n    InputCollectionTerminalView: InputCollectionTerminalView,\n    OutputCollectionTerminalView: OutputCollectionTerminalView\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\n// import { getAppRoot } from \"onload/loadConfig\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\nvar DataInputView = Backbone.View.extend({\n    className: \"form-row dataRow input-data-row\",\n\n    initialize: function(options) {\n        this.input = options.input;\n        this.nodeView = options.nodeView;\n        this.terminalElement = options.terminalElement;\n\n        this.$el.attr(\"name\", this.input.name).html(this.input.label || this.input.name);\n\n        if (!options.skipResize) {\n            this.$el.css({\n                position: \"absolute\",\n                left: -1000,\n                top: -1000,\n                display: \"none\"\n            });\n            $(\"body\").append(this.el);\n            this.nodeView.updateMaxWidth(this.$el.outerWidth());\n            this.$el.css({\n                position: \"\",\n                left: \"\",\n                top: \"\",\n                display: \"\"\n            });\n            this.$el.remove();\n        }\n    }\n});\n\nvar DataOutputView = Backbone.View.extend({\n    className: \"form-row dataRow\",\n\n    initialize: function(options) {\n        this.output = options.output;\n        this.terminalElement = options.terminalElement;\n        this.nodeView = options.nodeView;\n\n        var output = this.output;\n        var label = output.label || output.name;\n        var node = this.nodeView.node;\n\n        var isInput = output.extensions.indexOf(\"input\") >= 0 || output.extensions.indexOf(\"input_collection\") >= 0;\n        if (!isInput) {\n            label = `${label} (${output.extensions.join(\", \")})`;\n        }\n        this.$el.html(label);\n        this.calloutView = null;\n        if ([\"tool\", \"subworkflow\"].indexOf(node.type) >= 0) {\n            var calloutView = new OutputCalloutView({\n                label: label,\n                output: output,\n                node: node\n            });\n            this.calloutView = calloutView;\n            this.$el.append(calloutView.el);\n        }\n        this.$el.css({\n            position: \"absolute\",\n            left: -1000,\n            top: -1000,\n            display: \"none\"\n        });\n        $(\"body\").append(this.el);\n        this.nodeView.updateMaxWidth(this.$el.outerWidth() + 17);\n        this.$el\n            .css({\n                position: \"\",\n                left: \"\",\n                top: \"\",\n                display: \"\"\n            })\n            .detach();\n    },\n    redrawWorkflowOutput: function() {\n        if (this.calloutView) {\n            this.calloutView.resetImage();\n        }\n    }\n});\n\nvar ParameterOutputView = Backbone.View.extend({\n    className: \"form-row dataRow\",\n\n    initialize: function(options) {\n        this.output = options.output;\n        this.terminalElement = options.terminalElement;\n        this.nodeView = options.nodeView;\n\n        var output = this.output;\n        var label = output.label || output.name;\n        var node = this.nodeView.node;\n\n        this.$el.html(label);\n        this.calloutView = null;\n        if ([\"tool\", \"subworkflow\"].indexOf(node.type) >= 0) {\n            var calloutView = new OutputCalloutView({\n                label: label,\n                output: output,\n                node: node\n            });\n            this.calloutView = calloutView;\n            this.$el.append(calloutView.el);\n            this.$el.hover(\n                () => {\n                    calloutView.hoverImage();\n                },\n                () => {\n                    calloutView.resetImage();\n                }\n            );\n        }\n        this.$el.css({\n            position: \"absolute\",\n            left: -1000,\n            top: -1000,\n            display: \"none\"\n        });\n        $(\"body\").append(this.el);\n        this.nodeView.updateMaxWidth(this.$el.outerWidth() + 17);\n        this.$el\n            .css({\n                position: \"\",\n                left: \"\",\n                top: \"\",\n                display: \"\"\n            })\n            .detach();\n    },\n    redrawWorkflowOutput: function() {\n        if (this.calloutView) {\n            this.calloutView.resetImage();\n        }\n    }\n});\n\nvar OutputCalloutView = Backbone.View.extend({\n    tagName: \"div\",\n\n    initialize: function(options) {\n        this.label = options.label;\n        this.node = options.node;\n        this.output = options.output;\n        var view = this;\n        var node = this.node;\n        this.$el\n            .attr(\"class\", `callout-terminal ${this.label}`)\n            .css({ display: \"none\" })\n            .append(\n                $(\"<icon class='mark-terminal fa fa-asterisk'/>\").click(() => {\n                    var outputName = view.output.name;\n                    if (node.isWorkflowOutput(outputName)) {\n                        node.removeWorkflowOutput(outputName);\n                        view.$(\"icon\").removeClass(\"mark-terminal-active\");\n                    } else {\n                        node.addWorkflowOutput(outputName);\n                        view.$(\"icon\").addClass(\"mark-terminal-active\");\n                    }\n                    window.workflow_globals.workflow.has_changes = true;\n                    window.workflow_globals.canvas_manager.draw_overview();\n                })\n            )\n            .tooltip({\n                delay: 500,\n                title: \"Mark dataset as a workflow output. All unmarked datasets will be hidden.\"\n            });\n\n        this.$el.css({\n            top: \"50%\",\n            margin: \"-8px 0px 0px 0px\",\n            right: 8\n        });\n        this.$el.show();\n        this.resetImage();\n    },\n\n    resetImage: function() {\n        if (!this.node.isWorkflowOutput(this.output.name)) {\n            this.$(\"icon\").removeClass(\"mark-terminal-active\");\n        } else {\n            this.$(\"icon\").addClass(\"mark-terminal-active\");\n        }\n    }\n});\n\nexport default {\n    DataInputView: DataInputView,\n    DataOutputView: DataOutputView,\n    ParameterOutputView: ParameterOutputView\n};\n","import $ from \"jquery\";\nimport _ from \"libs/underscore\";\nimport Backbone from \"backbone\";\nimport TerminalViews from \"mvc/workflow/workflow-view-terminals\";\nimport DataViews from \"mvc/workflow/workflow-view-data\";\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        this.node = options.node;\n        this.output_width = Math.max(150, this.$el.width());\n        this.tool_body = this.$el.find(\".toolFormBody\");\n        this.tool_body.find(\"div\").remove();\n        this.newInputsDiv().appendTo(this.tool_body);\n        this.terminalViews = {};\n        this.outputViews = {};\n    },\n\n    render: function() {\n        this.renderToolLabel();\n        this.renderToolErrors();\n        this.$el.css(\"width\", Math.min(250, Math.max(this.$el.width(), this.output_width)));\n    },\n\n    renderToolLabel: function() {\n        this.$(\".nodeTitle\").text(this.node.label || this.node.name);\n        this.$el.attr(\"node-label\", this.node.label);\n    },\n\n    renderToolErrors: function() {\n        this.node.errors ? this.$el.addClass(\"tool-node-error\") : this.$el.removeClass(\"tool-node-error\");\n    },\n\n    newInputsDiv: function() {\n        return $(\"<div/>\").addClass(\"inputs\");\n    },\n\n    updateMaxWidth: function(newWidth) {\n        this.output_width = Math.max(this.output_width, newWidth);\n    },\n\n    addRule: function() {\n        this.tool_body.append($(\"<div/>\").addClass(\"rule\"));\n    },\n\n    addDataInput: function(input, body) {\n        var skipResize = true;\n        if (!body) {\n            body = this.$(\".inputs\");\n            // initial addition to node - resize input to help calculate node\n            // width.\n            skipResize = false;\n        }\n        var terminalView = this.terminalViews[input.name];\n        var terminalViewClass = TerminalViews.InputTerminalView;\n        if (input.input_type == \"dataset_collection\") {\n            terminalViewClass = TerminalViews.InputCollectionTerminalView;\n        } else if (input.input_type == \"parameter\") {\n            terminalViewClass = TerminalViews.InputParameterTerminalView;\n        }\n        if (terminalView && !(terminalView instanceof terminalViewClass)) {\n            terminalView.el.terminal.destroy();\n            terminalView = null;\n        }\n        if (!terminalView) {\n            terminalView = new terminalViewClass({\n                node: this.node,\n                input: input\n            });\n        } else {\n            var terminal = terminalView.el.terminal;\n            terminal.update(input);\n            terminal.destroyInvalidConnections();\n        }\n        this.terminalViews[input.name] = terminalView;\n        var terminalElement = terminalView.el;\n        var inputView = new DataViews.DataInputView({\n            terminalElement: terminalElement,\n            input: input,\n            nodeView: this,\n            skipResize: skipResize\n        });\n        var ib = inputView.$el;\n        body.append(ib.prepend(terminalView.terminalElements()));\n        return terminalView;\n    },\n\n    addDataOutput: function(output) {\n        var terminalViewClass = TerminalViews.OutputTerminalView;\n        var outputViewClass = DataViews.DataOutputView;\n        if (output.collection) {\n            terminalViewClass = TerminalViews.OutputCollectionTerminalView;\n        } else if (output.parameter) {\n            terminalViewClass = TerminalViews.OutputParameterTerminalView;\n            outputViewClass = DataViews.ParameterOutputView;\n        }\n        var terminalView = new terminalViewClass({\n            node: this.node,\n            output: output\n        });\n        var outputView = new outputViewClass({\n            output: output,\n            terminalElement: terminalView.el,\n            nodeView: this\n        });\n        this.outputViews[output.name] = outputView;\n        this.tool_body.append(outputView.$el.append(terminalView.terminalElements()));\n    },\n\n    redrawWorkflowOutputs: function() {\n        _.each(this.outputViews, outputView => {\n            outputView.redrawWorkflowOutput();\n        });\n    },\n\n    updateDataOutput: function(output) {\n        var outputTerminal = this.node.output_terminals[output.name];\n        outputTerminal.update(output);\n    }\n});\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\nimport NodeView from \"mvc/workflow/workflow-view-node\";\n\n// unused\n//var StepParameterTypes = [\"text\", \"integer\", \"float\", \"boolean\", \"color\"];\n\nvar Node = Backbone.Model.extend({\n    initialize: function(app, attr) {\n        this.app = app;\n        this.element = attr.element;\n        this.input_terminals = {};\n        this.output_terminals = {};\n        this.errors = {};\n        this.workflow_outputs = [];\n    },\n    getWorkflowOutput: function(outputName) {\n        return _.findWhere(this.workflow_outputs, {\n            output_name: outputName\n        });\n    },\n    isWorkflowOutput: function(outputName) {\n        return this.getWorkflowOutput(outputName) !== undefined;\n    },\n    removeWorkflowOutput: function(outputName) {\n        while (this.isWorkflowOutput(outputName)) {\n            const target = this.getWorkflowOutput(outputName);\n            this.workflow_outputs.splice(_.indexOf(this.workflow_outputs, target), 1);\n        }\n    },\n    addWorkflowOutput: function(outputName, label) {\n        if (!this.isWorkflowOutput(outputName)) {\n            var output = { output_name: outputName };\n            if (label) {\n                output.label = label;\n            }\n            this.workflow_outputs.push(output);\n            return true;\n        }\n        return false;\n    },\n    labelWorkflowOutput: function(outputName, label) {\n        var changed = false;\n        var oldLabel = null;\n        if (this.isWorkflowOutput(outputName)) {\n            var workflowOutput = this.getWorkflowOutput(outputName);\n            oldLabel = workflowOutput.label;\n            workflowOutput.label = label;\n            changed = oldLabel != label;\n        } else {\n            changed = this.addWorkflowOutput(outputName, label);\n        }\n        if (changed) {\n            this.app.workflow.updateOutputLabel(oldLabel, label);\n            this.markChanged();\n            this.nodeView.redrawWorkflowOutputs();\n        }\n        return changed;\n    },\n    connectedOutputTerminals: function() {\n        return this._connectedTerminals(this.output_terminals);\n    },\n    _connectedTerminals: function(terminals) {\n        var connectedTerminals = [];\n        $.each(terminals, (_, t) => {\n            if (t.connectors.length > 0) {\n                connectedTerminals.push(t);\n            }\n        });\n        return connectedTerminals;\n    },\n    hasConnectedOutputTerminals: function() {\n        // return this.connectedOutputTerminals().length > 0; <- optimized this\n        var outputTerminals = this.output_terminals;\n        for (var outputName in outputTerminals) {\n            if (outputTerminals[outputName].connectors.length > 0) {\n                return true;\n            }\n        }\n        return false;\n    },\n    connectedMappedInputTerminals: function() {\n        return this._connectedMappedTerminals(this.input_terminals);\n    },\n    hasConnectedMappedInputTerminals: function() {\n        // return this.connectedMappedInputTerminals().length > 0; <- optimized this\n        var inputTerminals = this.input_terminals;\n        for (var inputName in inputTerminals) {\n            var inputTerminal = inputTerminals[inputName];\n            if (inputTerminal.connectors.length > 0 && inputTerminal.isMappedOver()) {\n                return true;\n            }\n        }\n        return false;\n    },\n    _connectedMappedTerminals: function(terminals) {\n        var mapped_outputs = [];\n        $.each(terminals, (_, t) => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                if (t.connectors.length > 0) {\n                    mapped_outputs.push(t);\n                }\n            }\n        });\n        return mapped_outputs;\n    },\n    mappedInputTerminals: function() {\n        return this._mappedTerminals(this.input_terminals);\n    },\n    _mappedTerminals: function(terminals) {\n        var mappedTerminals = [];\n        $.each(terminals, (_, t) => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                mappedTerminals.push(t);\n            }\n        });\n        return mappedTerminals;\n    },\n    hasMappedOverInputTerminals: function() {\n        var found = false;\n        _.each(this.input_terminals, t => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                found = true;\n            }\n        });\n        return found;\n    },\n    redraw: function() {\n        $.each(this.input_terminals, (_, t) => {\n            t.redraw();\n        });\n        $.each(this.output_terminals, (_, t) => {\n            t.redraw();\n        });\n    },\n    clone: function() {\n        var copiedData = {\n            name: this.name,\n            label: this.label,\n            annotation: this.annotation,\n            post_job_actions: this.post_job_actions\n        };\n        var node = this.app.workflow.create_node(this.type, this.name, this.content_id);\n\n        Utils.request({\n            type: \"POST\",\n            url: `${getAppRoot()}api/workflows/build_module`,\n            data: {\n                type: this.type,\n                tool_id: this.content_id,\n                tool_state: this.tool_state\n            },\n            success: data => {\n                var newData = Object.assign({}, data, copiedData);\n                node.init_field_data(newData);\n                node.update_field_data(newData);\n                this.app.workflow.activate_node(node);\n            }\n        });\n    },\n    destroy: function() {\n        $.each(this.input_terminals, (k, t) => {\n            t.destroy();\n        });\n        $.each(this.output_terminals, (k, t) => {\n            t.destroy();\n        });\n        this.app.workflow.remove_node(this);\n        $(this.element).remove();\n    },\n    make_active: function() {\n        $(this.element).addClass(\"toolForm-active\");\n    },\n    make_inactive: function() {\n        // Keep inactive nodes stacked from most to least recently active\n        // by moving element to the end of parent's node list\n        var element = this.element.get(0);\n        (p => {\n            p.removeChild(element);\n            p.appendChild(element);\n        })(element.parentNode);\n        // Remove active class\n        $(element).removeClass(\"toolForm-active\");\n    },\n    set_tool_version: function() {\n        if (this.type === \"tool\" && this.config_form) {\n            this.tool_version = this.config_form.version;\n            this.content_id = this.config_form.id;\n        }\n    },\n\n    init_field_data: function(data) {\n        //console.debug(\"init_field_data: \", data);\n        if (data.type) {\n            this.type = data.type;\n        }\n        this.name = data.name;\n        this.config_form = data.config_form;\n        this.set_tool_version();\n        this.tool_state = data.tool_state;\n        this.errors = data.errors;\n        this.tooltip = data.tooltip ? data.tooltip : \"\";\n        this.annotation = data.annotation;\n        this.post_job_actions = data.post_job_actions ? data.post_job_actions : {};\n        this.label = data.label;\n        this.uuid = data.uuid;\n        this.workflow_outputs = data.workflow_outputs ? data.workflow_outputs : [];\n        var node = this;\n        var nodeView = new NodeView({\n            el: this.element[0],\n            node: node\n        });\n        node.nodeView = nodeView;\n        $.each(data.inputs, (i, input) => {\n            nodeView.addDataInput(input);\n        });\n\n        if (data.inputs.length > 0 && data.outputs.length > 0) {\n            nodeView.addRule();\n        }\n        $.each(data.outputs, (i, output) => {\n            nodeView.addDataOutput(output);\n        });\n        nodeView.render();\n        this.app.workflow.node_changed(this, true);\n    },\n    update_field_data: function(data) {\n        var node = this;\n        var nodeView = node.nodeView;\n        // remove unused output views and remove pre-existing output views from data.outputs,\n        // so that these are not added twice.\n        var unused_outputs = [];\n        // nodeView.outputViews contains pre-existing outputs,\n        // while data.data_output contains what should be displayed.\n        // Now we gather the unused outputs\n        $.each(nodeView.outputViews, (i, output_view) => {\n            var cur_name = output_view.output.name;\n            var data_names = data.outputs;\n            var cur_name_in_data_outputs = false;\n            _.each(data_names, data_name => {\n                if (data_name.name == cur_name) {\n                    cur_name_in_data_outputs = true;\n                }\n            });\n            if (cur_name_in_data_outputs === false) {\n                unused_outputs.push(cur_name);\n            }\n        });\n\n        // Remove the unused outputs\n        _.each(unused_outputs, unused_output => {\n            _.each(nodeView.outputViews[unused_output].terminalElement.terminal.connectors, x => {\n                if (x) {\n                    x.destroy(); // Removes the noodle connectors\n                }\n            });\n            nodeView.outputViews[unused_output].remove(); // removes the rendered output\n            delete nodeView.outputViews[unused_output]; // removes the reference to the output\n            delete node.output_terminals[unused_output]; // removes the output terminal\n        });\n        $.each(node.workflow_outputs, (i, wf_output) => {\n            if (wf_output && !node.output_terminals[wf_output.output_name]) {\n                node.workflow_outputs.splice(i, 1); // removes output from list of workflow outputs\n            }\n        });\n        $.each(data.outputs, (i, output) => {\n            if (!nodeView.outputViews[output.name]) {\n                nodeView.addDataOutput(output); // add data output if it does not yet exist\n            } else {\n                // the output already exists, but the output formats may have changed.\n                // Therefore we update the datatypes and destroy invalid connections.\n                node.output_terminals[output.name].datatypes = output.extensions;\n                node.output_terminals[output.name].destroyInvalidConnections();\n            }\n        });\n        this.tool_state = data.tool_state;\n        this.config_form = data.config_form;\n        this.set_tool_version();\n        this.errors = data.errors;\n        this.annotation = data.annotation;\n        this.label = data.label;\n        if (\"post_job_actions\" in data) {\n            // Won't be present in response for data inputs\n            var pja_in = data.post_job_actions;\n            this.post_job_actions = pja_in ? pja_in : {};\n        }\n        node.nodeView.renderToolErrors();\n        // Update input rows\n        var old_body = nodeView.$(\"div.inputs\");\n        var new_body = nodeView.newInputsDiv();\n        var newTerminalViews = {};\n        _.each(data.inputs, input => {\n            var terminalView = node.nodeView.addDataInput(input, new_body);\n            newTerminalViews[input.name] = terminalView;\n        });\n        // Cleanup any leftover terminals\n        _.each(_.difference(_.values(nodeView.terminalViews), _.values(newTerminalViews)), unusedView => {\n            unusedView.el.terminal.destroy();\n        });\n        nodeView.terminalViews = newTerminalViews;\n        node.nodeView.render();\n        // In general workflow editor assumes tool outputs don't change in # or\n        // type (not really valid right?) but adding special logic here for\n        // data collection input parameters that can have their collection\n        // change.\n        var data_outputs = data.outputs;\n        if (data_outputs.length == 1 && \"collection_type\" in data_outputs[0]) {\n            nodeView.updateDataOutput(data_outputs[0]);\n        }\n        old_body.replaceWith(new_body);\n        if (\"workflow_outputs\" in data) {\n            // Won't be present in response for data inputs\n            this.workflow_outputs = data.workflow_outputs ? data.workflow_outputs : [];\n        }\n        // If active, reactivate with new config_form\n        this.markChanged();\n        this.redraw();\n    },\n    error: function(text) {\n        var b = $(this.element).find(\".toolFormBody\");\n        b.find(\"div\").remove();\n        var tmp = `<div style='color: red; text-style: italic;'>${text}</div>`;\n        this.config_form = tmp;\n        b.html(tmp);\n        this.app.workflow.node_changed(this);\n    },\n    markChanged: function() {\n        this.app.workflow.node_changed(this);\n    }\n});\nexport default Node;\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nimport Form from \"mvc/form/form-view\";\nimport ToolFormBase from \"mvc/tool/tool-form-base\";\n\n/** Default form wrapper for non-tool modules in the workflow editor. */\nvar Default = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        var node = options.node;\n        this.form = new Form(\n            Utils.merge(options, {\n                onchange: function() {\n                    Utils.request({\n                        type: \"POST\",\n                        url: `${getAppRoot()}api/workflows/build_module`,\n                        data: {\n                            id: node.id,\n                            type: node.type,\n                            content_id: node.content_id,\n                            inputs: self.form.data.create()\n                        },\n                        success: function(data) {\n                            node.update_field_data(data);\n                        }\n                    });\n                }\n            })\n        );\n        _addLabelAnnotation(this.form);\n        this.form.render();\n    }\n});\n\n/** Tool form wrapper for the workflow editor. */\nvar Tool = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        var node = options.node;\n        this.form = new ToolFormBase(\n            Utils.merge(options, {\n                text_enable: \"Set in Advance\",\n                text_disable: \"Set at Runtime\",\n                narrow: true,\n                initial_errors: true,\n                cls: \"ui-portlet-section\",\n                initialmodel: function(process, form) {\n                    self._customize(form);\n                    process.resolve();\n                },\n                buildmodel: function(process, form) {\n                    form.model.get(\"postchange\")(process, form);\n                },\n                postchange: function(process, form) {\n                    let Galaxy = getGalaxyInstance();\n                    var options = form.model.attributes;\n                    var current_state = {\n                        tool_id: options.id,\n                        tool_version: options.version,\n                        type: \"tool\",\n                        inputs: $.extend(true, {}, form.data.create())\n                    };\n                    Galaxy.emit.debug(\"tool-form-workflow::postchange()\", \"Sending current state.\", current_state);\n                    Utils.request({\n                        type: \"POST\",\n                        url: `${getAppRoot()}api/workflows/build_module`,\n                        data: current_state,\n                        success: function(data) {\n                            form.model.set(data.config_form);\n                            self._customize(form);\n                            form.update(data.config_form);\n                            form.errors(data.config_form);\n                            // This hasn't modified the workflow, just returned\n                            // module information for the tool to update the workflow\n                            // state stored on the client with. User needs to save\n                            // for this to take effect.\n                            node.update_field_data(data);\n                            Galaxy.emit.debug(\"tool-form-workflow::postchange()\", \"Received new model.\", data);\n                            process.resolve();\n                        },\n                        error: function(response) {\n                            Galaxy.emit.debug(\"tool-form-workflow::postchange()\", \"Refresh request failed.\", response);\n                            process.reject();\n                        }\n                    });\n                }\n            })\n        );\n    },\n\n    _customize: function(form) {\n        var options = form.model.attributes;\n        Utils.deepeach(options.inputs, input => {\n            if (input.type) {\n                input.connectable = true;\n                if ([\"data\", \"data_collection\"].indexOf(input.type) != -1) {\n                    input.type = \"hidden\";\n                    input.info = `Data input '${input.name}' (${Utils.textify(input.extensions)})`;\n                    input.value = { __class__: \"RuntimeValue\" };\n                } else if (!input.fixed) {\n                    input.collapsible_value = {\n                        __class__: \"RuntimeValue\"\n                    };\n                    input.is_workflow =\n                        (input.options && input.options.length === 0) || [\"integer\", \"float\"].indexOf(input.type) != -1;\n                }\n            }\n        });\n        Utils.deepeach(options.inputs, input => {\n            if (input.type === \"conditional\") {\n                input.connectable = false;\n                input.test_param.collapsible_value = undefined;\n            }\n        });\n        _addSections(form);\n        _addLabelAnnotation(form);\n    }\n});\n\n/** Augments the module form definition by adding label and annotation fields */\nfunction _addLabelAnnotation(form) {\n    var options = form.model.attributes;\n    var workflow = options.workflow;\n    var node = options.node;\n    options.inputs.unshift({\n        type: \"text\",\n        name: \"__annotation\",\n        label: \"Annotation\",\n        fixed: true,\n        value: node.annotation,\n        area: true,\n        help: \"Add an annotation or notes to this step. Annotations are available when a workflow is viewed.\"\n    });\n    options.inputs.unshift({\n        type: \"text\",\n        name: \"__label\",\n        label: \"Label\",\n        value: node.label,\n        help: _l(\"Add a step label.\"),\n        fixed: true,\n        onchange: function(new_label) {\n            var duplicate = false;\n            for (var i in workflow.nodes) {\n                var n = workflow.nodes[i];\n                if (n.label && n.label == new_label && n.id != node.id) {\n                    duplicate = true;\n                    break;\n                }\n            }\n            var input_id = form.data.match(\"__label\");\n            var input_element = form.element_list[input_id];\n            input_element.model.set(\n                \"error_text\",\n                duplicate && \"Duplicate label. Please fix this before saving the workflow.\"\n            );\n            form.trigger(\"change\");\n        }\n    });\n}\n\n/** Visit input nodes and enrich by name/value pairs from server data */\nfunction _visit(head, head_list, output_id, options) {\n    var post_job_actions = options.node.post_job_actions;\n    head_list = head_list || [];\n    head_list.push(head);\n    for (var i in head.inputs) {\n        var input = head.inputs[i];\n        var action = input.action;\n        if (action) {\n            input.name = `pja__${output_id}__${input.action}`;\n            if (input.pja_arg) {\n                input.name += `__${input.pja_arg}`;\n            }\n            if (input.payload) {\n                for (var p_id in input.payload) {\n                    input.payload[`${input.name}__${p_id}`] = input.payload[p_id];\n                    delete input.payload[p_id];\n                }\n            }\n            var d = post_job_actions[input.action + output_id];\n            if (d) {\n                for (var j in head_list) {\n                    head_list[j].expanded = true;\n                }\n                if (input.pja_arg) {\n                    input.value = (d.action_arguments && d.action_arguments[input.pja_arg]) || input.value;\n                } else {\n                    input.value = \"true\";\n                }\n            }\n        }\n        if (input.inputs) {\n            _visit(input, head_list.slice(0), output_id, options);\n        }\n    }\n}\n\nfunction _makeRenameHelp(name_labels) {\n    let help_section = `This action will rename the output dataset. Click <a href=\"https://galaxyproject.org/learn/advanced-workflow/variables/\">here</a> for more information. Valid input variables are:`;\n    let li = `\n        <ul>\n            ${name_labels\n                .map(\n                    name_label => `<li><strong>${name_label.name.replace(/\\|/g, \".\")}</strong>\n                                                         ${name_label.label ? `(${name_label.label})` : \"\"}\n                                             </li>`\n                )\n                .join(\"\")}\n        </ul>\n    `;\n    help_section += li;\n    return help_section;\n}\n\n/** Builds sub section with step actions/annotation */\nfunction _makeSection(output_id, label, options) {\n    var extensions = [];\n    var name_label_map = [];\n    var datatypes = options.datatypes;\n    var node = options.node;\n    var workflow = options.workflow;\n\n    for (let key in datatypes) {\n        extensions.push({ 0: datatypes[key], 1: datatypes[key] });\n    }\n    for (let key in node.input_terminals) {\n        name_label_map.push({ name: node.input_terminals[key].name, label: node.input_terminals[key].label });\n    }\n    var rename_help = _makeRenameHelp(name_label_map);\n    extensions.sort((a, b) => (a.label > b.label ? 1 : a.label < b.label ? -1 : 0));\n    extensions.unshift({\n        0: \"Sequences\",\n        1: \"Sequences\"\n    });\n    extensions.unshift({\n        0: \"Roadmaps\",\n        1: \"Roadmaps\"\n    });\n    extensions.unshift({\n        0: \"Leave unchanged\",\n        1: \"__empty__\"\n    });\n    var output;\n    var input_config = {\n        title: `Configure Output: '${label}'`,\n        type: \"section\",\n        flat: true,\n        inputs: [\n            {\n                label: \"Label\",\n                type: \"text\",\n                value: ((output = node.getWorkflowOutput(output_id)) && output.label) || \"\",\n                help: \"This will provide a short name to describe the output - this must be unique across workflows.\",\n                onchange: function(new_value) {\n                    workflow.attemptUpdateOutputLabel(node, output_id, new_value);\n                }\n            },\n            {\n                action: \"RenameDatasetAction\",\n                pja_arg: \"newname\",\n                label: \"Rename dataset\",\n                type: \"text\",\n                value: \"\",\n                ignore: \"\",\n                help: rename_help\n            },\n            {\n                action: \"ChangeDatatypeAction\",\n                pja_arg: \"newtype\",\n                label: \"Change datatype\",\n                type: \"select\",\n                ignore: \"__empty__\",\n                value: \"__empty__\",\n                options: extensions,\n                help: \"This action will change the datatype of the output to the indicated value.\"\n            },\n            {\n                action: \"TagDatasetAction\",\n                pja_arg: \"tags\",\n                label: \"Add Tags\",\n                type: \"text\",\n                value: \"\",\n                ignore: \"\",\n                help: \"This action will set tags for the dataset.\"\n            },\n            {\n                action: \"RemoveTagDatasetAction\",\n                pja_arg: \"tags\",\n                label: \"Remove Tags\",\n                type: \"text\",\n                value: \"\",\n                ignore: \"\",\n                help: \"This action will remove tags for the dataset.\"\n            },\n            {\n                title: _l(\"Assign columns\"),\n                type: \"section\",\n                flat: true,\n                inputs: [\n                    {\n                        action: \"ColumnSetAction\",\n                        pja_arg: \"chromCol\",\n                        label: \"Chrom column\",\n                        type: \"integer\",\n                        value: \"\",\n                        ignore: \"\"\n                    },\n                    {\n                        action: \"ColumnSetAction\",\n                        pja_arg: \"startCol\",\n                        label: \"Start column\",\n                        type: \"integer\",\n                        value: \"\",\n                        ignore: \"\"\n                    },\n                    {\n                        action: \"ColumnSetAction\",\n                        pja_arg: \"endCol\",\n                        label: \"End column\",\n                        type: \"integer\",\n                        value: \"\",\n                        ignore: \"\"\n                    },\n                    {\n                        action: \"ColumnSetAction\",\n                        pja_arg: \"strandCol\",\n                        label: \"Strand column\",\n                        type: \"integer\",\n                        value: \"\",\n                        ignore: \"\"\n                    },\n                    {\n                        action: \"ColumnSetAction\",\n                        pja_arg: \"nameCol\",\n                        label: \"Name column\",\n                        type: \"integer\",\n                        value: \"\",\n                        ignore: \"\"\n                    }\n                ],\n                help: \"This action will set column assignments in the output dataset. Blank fields are ignored.\"\n            }\n        ]\n    };\n    _visit(input_config, [], output_id, options);\n    return input_config;\n}\n\n/** Builds all sub sections */\nfunction _addSections(form) {\n    var options = form.model.attributes;\n    var inputs = options.inputs;\n    var node = options.node;\n    var post_job_actions = node.post_job_actions;\n    var output_id = node.output_terminals && Object.keys(node.output_terminals)[0];\n\n    if (output_id) {\n        inputs.push({\n            name: `pja__${output_id}__EmailAction`,\n            label: \"Email notification\",\n            type: \"boolean\",\n            value: String(Boolean(post_job_actions[`EmailAction${output_id}`])),\n            ignore: \"false\",\n            help: _l(\"An email notification will be sent when the job has completed.\"),\n            payload: {\n                host: window.location.host\n            }\n        });\n        inputs.push({\n            name: `pja__${output_id}__DeleteIntermediatesAction`,\n            label: \"Output cleanup\",\n            type: \"boolean\",\n            value: String(Boolean(post_job_actions[`DeleteIntermediatesAction${output_id}`])),\n            ignore: \"false\",\n            help:\n                \"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs.\"\n        });\n        for (let output_id in node.output_terminals) {\n            let label = node.output_terminals[output_id].label || output_id;\n            inputs.push(_makeSection(output_id, label, options));\n        }\n    }\n}\n\nexport default {\n    Default: Default,\n    Tool: Tool\n};\n","import $ from \"jquery\";\n\n// Modal dialog boxes\nexport const Modal = function(options) {\n    this.$overlay = options.overlay;\n    this.$dialog = options.dialog;\n    this.$header = this.$dialog.find(\".modal-header\");\n    this.$body = this.$dialog.find(\".modal-body\");\n    this.$footer = this.$dialog.find(\".modal-footer\");\n    this.$backdrop = options.backdrop;\n    // Close button\n    this.$header.find(\".close\").on(\"click\", $.proxy(this.hide, this));\n};\n\n$.extend(Modal.prototype, {\n    setContent: function(options) {\n        this.$header.hide();\n        // Title\n        if (options.title) {\n            this.$header.find(\".title\").html(options.title);\n            this.$header.show();\n        }\n        if (options.closeButton) {\n            this.$header.find(\".close\").show();\n            this.$header.show();\n        } else {\n            this.$header.find(\".close\").hide();\n        }\n        // Buttons\n        this.$footer.hide();\n        var $buttons = this.$footer.find(\".buttons\").html(\"\");\n        if (options.buttons) {\n            $.each(options.buttons, (name, value) => {\n                $buttons\n                    .append(\n                        $(\"<button></button> \")\n                            .text(name)\n                            .click(value)\n                    )\n                    .append(\" \");\n            });\n            this.$footer.show();\n        }\n        var $extraButtons = this.$footer.find(\".extra_buttons\").html(\"\");\n        if (options.extra_buttons) {\n            $.each(options.extra_buttons, (name, value) => {\n                $extraButtons\n                    .append(\n                        $(\"<button></button>\")\n                            .text(name)\n                            .click(value)\n                    )\n                    .append(\" \");\n            });\n            this.$footer.show();\n        }\n        // Body\n        var body = options.body;\n        if (body == \"progress\") {\n            body = $(\n                \"<div class='progress progress-striped active'><div class='progress-bar' style='width: 100%'></div></div>\"\n            );\n        }\n        this.$body.html(body);\n    },\n    show: function(options, callback) {\n        if (options.backdrop) {\n            this.$backdrop.addClass(\"in\");\n        } else {\n            this.$backdrop.removeClass(\"in\");\n        }\n        this.$overlay.show();\n        this.$dialog.show();\n        this.$overlay.addClass(\"in\");\n        // Fix min-width so that modal cannot shrink considerably if new content is loaded.\n        this.$body.css(\"min-width\", this.$body.width());\n        // Set max-height so that modal does not exceed window size and is in middle of page.\n        // TODO: this could perhaps be handled better using CSS.\n        this.$body.css(\"max-height\", $(window).height() / 1.5);\n        // Callback on init\n        if (callback) {\n            callback();\n        }\n    },\n    hide: function() {\n        var modal = this;\n        modal.$dialog.fadeOut(() => {\n            modal.$overlay.hide();\n            modal.$backdrop.removeClass(\"in\");\n            modal.$body.children().remove();\n            // Clear min-width to allow for modal to take size of new body.\n            modal.$body.css(\"min-width\", undefined);\n        });\n    }\n});\n\nvar modal;\n\n// TODO: move into init chain\n$(() => {\n    modal = new Modal({\n        overlay: $(\"#top-modal\"),\n        dialog: $(\"#top-modal-dialog\"),\n        backdrop: $(\"#top-modal-backdrop\")\n    });\n});\n\n// Backward compatibility\nexport function hide_modal() {\n    modal.hide();\n}\n\nexport function show_modal(title, body, buttons, extra_buttons, init_fn) {\n    modal.setContent({\n        title: title,\n        body: body,\n        buttons: buttons,\n        extra_buttons: extra_buttons\n    });\n    modal.show({ backdrop: true }, init_fn);\n}\n\nexport function show_message(title, body, buttons, extra_buttons, init_fn) {\n    modal.setContent({\n        title: title,\n        body: body,\n        buttons: buttons,\n        extra_buttons: extra_buttons\n    });\n    modal.show({ backdrop: false }, init_fn);\n}\n\nexport function show_in_overlay(options) {\n    var width = options.width || \"600\";\n    var height = options.height || \"400\";\n    var scroll = options.scroll || \"auto\";\n    $(\"#overlay-background\").bind(\"click.overlay\", () => {\n        hide_modal();\n        $(\"#overlay-background\").unbind(\"click.overlay\");\n    });\n    modal.setContent({\n        closeButton: true,\n        title: \"&nbsp;\",\n        body: $(\n            `<div style='margin: -5px;'><iframe style='margin: 0; padding: 0;' src='${\n                options.url\n            }' width='${width}' height='${height}' scrolling='${scroll}' frameborder='0'></iframe></div>`\n        )\n    });\n    modal.show({ backdrop: true });\n}\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nimport Workflow from \"mvc/workflow/workflow-manager\";\nimport WorkflowCanvas from \"mvc/workflow/workflow-canvas\";\nimport Node from \"mvc/workflow/workflow-node\";\nimport WorkflowIcons from \"mvc/workflow/workflow-icons\";\nimport FormWrappers from \"mvc/workflow/workflow-forms\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport async_save_text from \"utils/async-save-text\";\nimport \"ui/editable-text\";\n\nimport { hide_modal, show_message, show_modal } from \"layout/modal\";\nimport { make_popupmenu } from \"ui/popupmenu\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\n// Reset tool search to start state.\nfunction reset_tool_search(initValue) {\n    // Function may be called in top frame or in tool_menu_frame;\n    // in either case, get the tool menu frame.\n    var tool_menu_frame = $(\"#galaxy_tools\").contents();\n    if (tool_menu_frame.length === 0) {\n        tool_menu_frame = $(document);\n        // Remove classes that indicate searching is active.\n        $(this).removeClass(\"search_active\");\n        tool_menu_frame.find(\".toolTitle\").removeClass(\"search_match\");\n\n        // Reset visibility of tools and labels.\n        tool_menu_frame.find(\".toolSectionBody\").hide();\n        tool_menu_frame.find(\".toolTitle\").show();\n        tool_menu_frame.find(\".toolPanelLabel\").show();\n        tool_menu_frame.find(\".toolSectionWrapper\").each(function() {\n            if ($(this).attr(\"id\") !== \"recently_used_wrapper\") {\n                // Default action.\n                $(this).show();\n            } else if ($(this).hasClass(\"user_pref_visible\")) {\n                $(this).show();\n            }\n        });\n        tool_menu_frame.find(\"#search-no-results\").hide();\n\n        // Reset search input.\n        tool_menu_frame.find(\"#search-spinner\").hide();\n        if (initValue) {\n            var search_input = tool_menu_frame.find(\"#tool-search-query\");\n            search_input.val(\"search tools\");\n        }\n    }\n}\n\nfunction add_node_icon($to_el, nodeType) {\n    var iconStyle = WorkflowIcons[nodeType];\n    if (iconStyle) {\n        var $icon = $('<i class=\"icon fa\">&nbsp;</i>').addClass(iconStyle);\n        $to_el.before($icon);\n    }\n}\n\n// create form view\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = (window.workflow_globals.app = this);\n        this.options = options;\n        this.urls = (options && options.urls) || {};\n        var close_editor = () => {\n            self.workflow.check_changes_in_active_form();\n            if (self.workflow && self.workflow.has_changes) {\n                var do_close = () => {\n                    window.onbeforeunload = undefined;\n                    window.document.location = self.urls.workflow_index;\n                };\n                show_modal(\n                    \"Close workflow editor\",\n                    \"There are unsaved changes to your workflow which will be lost.\",\n                    {\n                        Cancel: hide_modal,\n                        \"Save Changes\": function() {\n                            save_current_workflow(null, do_close);\n                        }\n                    },\n                    {\n                        \"Don't Save\": do_close\n                    }\n                );\n            } else {\n                window.document.location = self.urls.workflow_index;\n            }\n        };\n        var workflow_index = self.urls.workflow_index;\n        var save_current_workflow = (eventObj, success_callback) => {\n            show_message(\"Saving workflow\", \"progress\");\n            self.workflow.check_changes_in_active_form();\n            if (!self.workflow.has_changes) {\n                hide_modal();\n                if (success_callback) {\n                    success_callback();\n                }\n                return;\n            }\n            self.workflow.rectify_workflow_outputs();\n            Utils.request({\n                url: `${getAppRoot()}api/workflows/${self.options.id}`,\n                type: \"PUT\",\n                data: { workflow: self.workflow.to_simple() },\n                success: function(data) {\n                    var body = $(\"<div/>\").text(data.message);\n                    if (data.errors) {\n                        body.addClass(\"warningmark\");\n                        var errlist = $(\"<ul/>\");\n                        $.each(data.errors, (i, v) => {\n                            $(\"<li/>\")\n                                .text(v)\n                                .appendTo(errlist);\n                        });\n                        body.append(errlist);\n                    } else {\n                        body.addClass(\"donemark\");\n                    }\n                    self.workflow.name = data.name;\n                    self.workflow.has_changes = false;\n                    self.workflow.stored = true;\n                    self.workflow.workflow_version = data.version;\n                    self.showWorkflowParameters();\n                    self.build_version_select();\n                    if (data.errors) {\n                        show_modal(\"Saving workflow\", body, {\n                            Ok: hide_modal\n                        });\n                    } else {\n                        if (success_callback) {\n                            success_callback();\n                        }\n                        hide_modal();\n                    }\n                },\n                error: function(response) {\n                    show_modal(\"Saving workflow failed.\", response.err_msg, { Ok: hide_modal });\n                }\n            });\n        };\n\n        // Clear search by clicking X button\n        $(\"#search-clear-btn\").click(function() {\n            $(\"#tool-search-query\").val(\"\");\n            reset_tool_search(false);\n        });\n\n        // Init searching.\n        $(\"#tool-search-query\")\n            .click(function() {\n                $(this).focus();\n                $(this).select();\n            })\n            .keyup(function(e) {\n                // If ESC is pressed clear the search field\n                if (e.keyCode == 27) {\n                    this.value = \"\";\n                }\n                // Remove italics.\n                $(this).css(\"font-style\", \"normal\");\n                // Don't update if same value as last time\n                if (this.value.length < 3) {\n                    reset_tool_search(false);\n                } else if (this.value != this.lastValue) {\n                    // Add class to denote that searching is active.\n                    $(this).addClass(\"search_active\");\n                    // input.addClass(config.loadingClass);\n                    // Add '*' to facilitate partial matching.\n                    var q = this.value;\n                    // Stop previous ajax-request\n                    if (this.timer) {\n                        window.clearTimeout(this.timer);\n                    }\n                    // Start a new ajax-request in X ms\n                    $(\"#search-spinner\").show();\n                    this.timer = window.setTimeout(() => {\n                        $.get(\n                            self.urls.tool_search,\n                            { q: q },\n                            data => {\n                                // input.removeClass(config.loadingClass);\n                                // Show live-search if results and search-term aren't empty\n                                $(\"#search-no-results\").hide();\n                                // Hide all tool sections.\n                                $(\".toolSectionWrapper\").hide();\n                                // This hides all tools but not workflows link (which is in a .toolTitle div).\n                                $(\".toolSectionWrapper\")\n                                    .find(\".toolTitle\")\n                                    .hide();\n                                if (data.length !== 0) {\n                                    // Map tool ids to element ids and join them.\n                                    var s = $.map(data, (n, i) => `link-${n}`);\n                                    // First pass to show matching tools and their parents.\n                                    $(s).each((index, id) => {\n                                        // Add class to denote match.\n                                        $(`[id='${id}']`)\n                                            .parent()\n                                            .addClass(\"search_match\");\n                                        $(`[id='${id}']`)\n                                            .parent()\n                                            .show()\n                                            .parent()\n                                            .parent()\n                                            .show()\n                                            .parent()\n                                            .show();\n                                    });\n                                    // Hide labels that have no visible children.\n                                    $(\".toolPanelLabel\").each(function() {\n                                        var this_label = $(this);\n                                        var next = this_label.next();\n                                        var no_visible_tools = true;\n                                        // Look through tools following label and, if none are visible, hide label.\n                                        while (next.length !== 0 && next.hasClass(\"toolTitle\")) {\n                                            if (next.is(\":visible\")) {\n                                                no_visible_tools = false;\n                                                break;\n                                            } else {\n                                                next = next.next();\n                                            }\n                                        }\n                                        if (no_visible_tools) {\n                                            this_label.hide();\n                                        }\n                                    });\n                                } else {\n                                    $(\"#search-no-results\").show();\n                                }\n                                $(\"#search-spinner\").hide();\n                            },\n                            \"json\"\n                        );\n                    }, 400);\n                }\n                this.lastValue = this.value;\n            });\n\n        // Canvas overview management\n        this.canvas_manager = window.workflow_globals.canvas_manager = new WorkflowCanvas(\n            this,\n            $(\"#canvas-viewport\"),\n            $(\"#overview\")\n        );\n\n        // Initialize workflow state\n        this.reset();\n\n        // get available datatypes for post job action options\n        this.datatypes = JSON.parse(\n            $.ajax({\n                url: `${getAppRoot()}api/datatypes`,\n                async: false\n            }).responseText\n        );\n\n        // get datatype mapping options\n        this.datatypes_mapping = JSON.parse(\n            $.ajax({\n                url: `${getAppRoot()}api/datatypes/mapping`,\n                async: false\n            }).responseText\n        );\n\n        // set mapping sub lists\n        this.ext_to_type = this.datatypes_mapping.ext_to_class_name;\n        this.type_to_type = this.datatypes_mapping.class_to_classes;\n\n        this.get_workflow_versions = function() {\n            let _workflow_version_dropdown = {};\n            let workflow_versions = JSON.parse(\n                $.ajax({\n                    url: `${getAppRoot()}api/workflows/${self.options.id}/versions`,\n                    async: false\n                }).responseText\n            );\n\n            for (let i = 0; i < workflow_versions.length; i++) {\n                let current_wf = workflow_versions[i];\n                let version_text = `Version ${current_wf[\"version\"]}, ${current_wf[\"steps\"]} steps`;\n                let selected = false;\n                if (i == self.workflow.workflow_version) {\n                    version_text = `${version_text} (active)`;\n                    selected = true;\n                }\n                _workflow_version_dropdown[version_text] = {\n                    version: i,\n                    selected: selected\n                };\n            }\n            return _workflow_version_dropdown;\n        };\n\n        this.build_version_select = function() {\n            let versions = this.get_workflow_versions();\n            $(\"#workflow-version-switch\").empty();\n            $.each(versions, function(k, v) {\n                $(\"#workflow-version-switch\").append(\n                    $(\"<option></option>\")\n                        .html(k)\n                        .val(v.version)\n                        .selected(v.selected)\n                );\n            });\n            $(\"#workflow-version-switch\").on(\"change\", function() {\n                $(\"#workflow-version-switch\").unbind(\"change\");\n                if (this.value != self.workflow.workflow_version) {\n                    if (self.workflow && self.workflow.has_changes) {\n                        let r = confirm(\"There are unsaved changes to your workflow which will be lost. Continue ?\");\n                        if (r == false) {\n                            // We rebuild the version select list, to reset the selected version\n                            self.build_version_select();\n                            return;\n                        }\n                    }\n                    self.load_workflow(self.options.id, this.value);\n                }\n            });\n        };\n\n        this.load_workflow = function load_workflow(id, version) {\n            this._workflowLoadAjax(id, version, {\n                success: function(data) {\n                    self.reset();\n                    self.workflow.from_simple(data, true);\n                    self.workflow.has_changes = false;\n                    self.workflow.fit_canvas_to_nodes();\n                    self.scroll_to_nodes();\n                    self.canvas_manager.draw_overview();\n                    self.build_version_select();\n\n                    // Determine if any parameters were 'upgraded' and provide message\n                    var upgrade_message = \"\";\n                    _.each(data.steps, (step, step_id) => {\n                        var details = \"\";\n                        if (step.errors) {\n                            details += `<li>${step.errors}</li>`;\n                        }\n                        _.each(data.upgrade_messages[step_id], m => {\n                            details += `<li>${m}</li>`;\n                        });\n                        if (details) {\n                            upgrade_message += `<li>Step ${parseInt(step_id, 10) + 1}: ${\n                                self.workflow.nodes[step_id].name\n                            }<ul>${details}</ul></li>`;\n                        }\n                    });\n                    if (upgrade_message) {\n                        show_modal(\n                            \"Issues loading this workflow\",\n                            `Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>${upgrade_message}</ul></p>`,\n                            { Continue: hide_modal }\n                        );\n                    } else {\n                        hide_modal();\n                    }\n                    self.showWorkflowParameters();\n                },\n                error: function(response) {\n                    show_modal(\"Loading workflow failed.\", response.err_msg, {\n                        Ok: function(response) {\n                            window.onbeforeunload = undefined;\n                            window.document.location = workflow_index;\n                        }\n                    });\n                },\n                beforeSubmit: function(data) {\n                    show_message(\"Loading workflow\", \"progress\");\n                }\n            });\n        };\n\n        // Load workflow definition\n        this.load_workflow(self.options.id, self.options.version);\n        if (make_popupmenu) {\n            make_popupmenu($(\"#workflow-options-button\"), {\n                Save: save_current_workflow,\n                \"Save As\": workflow_save_as,\n                Run: function() {\n                    window.location = `${getAppRoot()}workflows/run?id=${self.options.id}`;\n                },\n                \"Edit Attributes\": function() {\n                    self.workflow.clear_active_node();\n                },\n                \"Auto Re-layout\": layout_editor,\n                Download: {\n                    url: `${getAppRoot()}api/workflows/${self.options.id}/download?format=json-download`,\n                    action: function() {}\n                },\n                Close: close_editor\n            });\n        }\n\n        /******************************************** Issue 3000*/\n        function workflow_save_as() {\n            var body = $(\n                '<form><label style=\"display:inline-block; width: 100%;\">Save as name: </label><input type=\"text\" id=\"workflow_rename\" style=\"width: 80%;\" autofocus/>' +\n                    '<br><label style=\"display:inline-block; width: 100%;\">Annotation: </label><input type=\"text\" id=\"wf_annotation\" style=\"width: 80%;\" /></form>'\n            );\n            show_modal(\"Save As a New Workflow\", body, {\n                OK: function() {\n                    var rename_name =\n                        $(\"#workflow_rename\").val().length > 0\n                            ? $(\"#workflow_rename\").val()\n                            : `SavedAs_${self.workflow.name}`;\n                    var rename_annotation = $(\"#wf_annotation\").val().length > 0 ? $(\"#wf_annotation\").val() : \"\";\n                    $.ajax({\n                        url: self.urls.workflow_save_as,\n                        type: \"POST\",\n                        data: {\n                            workflow_name: rename_name,\n                            workflow_annotation: rename_annotation,\n                            workflow_data: function() {\n                                return JSON.stringify(self.workflow.to_simple());\n                            }\n                        }\n                    })\n                        .done(id => {\n                            window.onbeforeunload = undefined;\n                            window.location = `${getAppRoot()}workflow/editor?id=${id}`;\n                            hide_modal();\n                        })\n                        .fail(() => {\n                            hide_modal();\n                            alert(\"Saving this workflow failed. Please contact this site's administrator.\");\n                        });\n                },\n                Cancel: hide_modal\n            });\n        }\n\n        function layout_editor() {\n            self.workflow.layout();\n            self.workflow.fit_canvas_to_nodes();\n            self.scroll_to_nodes();\n            self.canvas_manager.draw_overview();\n        }\n\n        // On load, set the size to the pref stored in local storage if it exists\n        var overview_size = localStorage.getItem(\"overview-size\");\n        if (overview_size !== undefined) {\n            $(\".workflow-overview\").css({\n                width: overview_size,\n                height: overview_size\n            });\n        }\n\n        // Stores the size of the overview into local storage when it's resized\n        $(\".workflow-overview\").bind(\"dragend\", function(e, d) {\n            var op = $(this).offsetParent();\n            var opo = op.offset();\n            var new_size = Math.max(op.width() - (d.offsetX - opo.left), op.height() - (d.offsetY - opo.top));\n            localStorage.setItem(\"overview-size\", `${new_size}px`);\n        });\n\n        // Unload handler\n        window.onbeforeunload = () => {\n            if (self.workflow && self.workflow.has_changes) {\n                return \"There are unsaved changes to your workflow which will be lost.\";\n            }\n        };\n\n        if (this.options.workflows.length > 0) {\n            $(\"#left\")\n                .find(\".toolMenu\")\n                .append(this._buildToolPanelWorkflows());\n        }\n\n        // Tool menu\n        $(\"div.toolSectionBody\").hide();\n        $(\"div.toolSectionTitle > span\").wrap(\"<a href='#'></a>\");\n        var last_expanded = null;\n        $(\"div.toolSectionTitle\").each(function() {\n            var body = $(this).next(\"div.toolSectionBody\");\n            $(this).click(() => {\n                if (body.is(\":hidden\")) {\n                    if (last_expanded) last_expanded.slideUp(\"fast\");\n                    last_expanded = body;\n                    body.slideDown(\"fast\");\n                } else {\n                    body.slideUp(\"fast\");\n                    last_expanded = null;\n                }\n            });\n        });\n\n        // Rename async.\n        async_save_text(\"workflow-name\", \"workflow-name\", self.urls.rename_async, \"new_name\");\n\n        // Tag async. Simply have the workflow edit element generate a click on the tag element to activate tagging.\n        $(\"#workflow-tag\").click(() => {\n            $(\".tag-area\").click();\n            return false;\n        });\n        // Annotate async.\n        async_save_text(\n            \"workflow-annotation\",\n            \"workflow-annotation\",\n            self.urls.annotate_async,\n            \"new_annotation\",\n            25,\n            true,\n            4\n        );\n    },\n\n    _buildToolPanelWorkflows: function() {\n        var self = this;\n        var $section = $(\n            '<div class=\"toolSectionWrapper\">' +\n                '<div class=\"toolSectionTitle\">' +\n                '<a href=\"#\"><span>Workflows</span></a>' +\n                \"</div>\" +\n                '<div class=\"toolSectionBody\">' +\n                '<div class=\"toolSectionBg\"/>' +\n                \"</div>\" +\n                \"</div>\"\n        );\n        _.each(this.options.workflows, workflow => {\n            if (workflow.id !== self.options.id) {\n                var copy = new Ui.Button({\n                    icon: \"fa fa-copy\",\n                    cls: \"ui-button-icon-plain\",\n                    tooltip: _l(\"Copy and insert individual steps\"),\n                    onclick: function() {\n                        let Galaxy = getGalaxyInstance();\n                        if (workflow.step_count < 2) {\n                            self.copy_into_workflow(workflow.id, workflow.name);\n                        } else {\n                            // don't ruin the workflow by adding 50 steps unprompted.\n                            Galaxy.modal.show({\n                                title: _l(\"Warning\"),\n                                body: `This will copy ${workflow.step_count} new steps into your workflow.`,\n                                buttons: {\n                                    Cancel: function() {\n                                        Galaxy.modal.hide();\n                                    },\n                                    Copy: function() {\n                                        Galaxy.modal.hide();\n                                        self.copy_into_workflow(workflow.id, workflow.name);\n                                    }\n                                }\n                            });\n                        }\n                    }\n                });\n                var $add = $(\"<a/>\")\n                    .attr(\"href\", \"#\")\n                    .html(workflow.name)\n                    .on(\"click\", () => {\n                        self.add_node_for_subworkflow(workflow.latest_id, workflow.name);\n                    });\n                $section.find(\".toolSectionBg\").append(\n                    $(\"<div/>\")\n                        .addClass(\"toolTitle\")\n                        .append($add)\n                        .append(copy.$el)\n                );\n            }\n        });\n        return $section;\n    },\n\n    copy_into_workflow: function(workflowId) {\n        // Load workflow definition\n        var self = this;\n        this._workflowLoadAjax(workflowId, null, {\n            success: function(data) {\n                self.workflow.from_simple(data, false);\n                // Determine if any parameters were 'upgraded' and provide message\n                var upgrade_message = \"\";\n                $.each(data.upgrade_messages, (k, v) => {\n                    upgrade_message += `<li>Step ${parseInt(k, 10) + 1}: ${self.workflow.nodes[k].name}<ul>`;\n                    $.each(v, (i, vv) => {\n                        upgrade_message += `<li>${vv}</li>`;\n                    });\n                    upgrade_message += \"</ul></li>\";\n                });\n                if (upgrade_message) {\n                    show_modal(\n                        \"Subworkflow embedded with changes\",\n                        `Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>${upgrade_message}</ul>`,\n                        { Continue: hide_modal }\n                    );\n                } else {\n                    hide_modal();\n                }\n            },\n            beforeSubmit: function(data) {\n                show_message(\"Importing workflow\", \"progress\");\n            }\n        });\n    },\n\n    // Global state for the whole workflow\n    reset: function() {\n        if (this.workflow) {\n            this.workflow.remove_all();\n        }\n        this.workflow = window.workflow_globals.workflow = new Workflow(this, $(\"#canvas-container\"));\n    },\n\n    scroll_to_nodes: function() {\n        var cv = $(\"#canvas-viewport\");\n        var cc = $(\"#canvas-container\");\n        var top;\n        var left;\n        if (cc.width() < cv.width()) {\n            left = (cv.width() - cc.width()) / 2;\n        } else {\n            left = 0;\n        }\n        if (cc.height() < cv.height()) {\n            top = (cv.height() - cc.height()) / 2;\n        } else {\n            top = 0;\n        }\n        cc.css({ left: left, top: top });\n    },\n\n    _workflowLoadAjax: function(workflowId, version, options) {\n        $.ajax(\n            Utils.merge(options, {\n                url: this.urls.load_workflow,\n                data: { id: workflowId, _: \"true\", version: version },\n                dataType: \"json\",\n                cache: false\n            })\n        );\n    },\n\n    _moduleInitAjax: function(node, request_data) {\n        var self = this;\n        Utils.request({\n            type: \"POST\",\n            url: `${getAppRoot()}api/workflows/build_module`,\n            data: request_data,\n            success: function(data) {\n                const Galaxy = getGalaxyInstance();\n                node.init_field_data(data);\n                node.update_field_data(data);\n                // Post init/update, for new modules we want to default to\n                // nodes being outputs\n                // TODO: Overhaul the handling of all this when we modernize\n                // the editor, replace callout image manipulation with a simple\n                // class toggle, etc.\n                $.each(node.output_terminals, (ot_id, ot) => {\n                    node.addWorkflowOutput(ot.name);\n                    var callout = $(node.element).find(`.callout.${ot.name.replace(/(?=[()])/g, \"\\\\\")}`);\n                    callout.find(\"img\").attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small.png`);\n                });\n                self.workflow.activate_node(node);\n            }\n        });\n    },\n\n    // Add a new step to the workflow by tool id\n    add_node_for_tool: function(id, title) {\n        var node = this.workflow.create_node(\"tool\", title, id);\n        this._moduleInitAjax(node, {\n            type: \"tool\",\n            tool_id: id,\n            _: \"true\"\n        });\n    },\n\n    // Add a new step to the workflow by tool id\n    add_node_for_subworkflow: function(id, title) {\n        var node = this.workflow.create_node(\"subworkflow\", title, id);\n        this._moduleInitAjax(node, {\n            type: \"subworkflow\",\n            content_id: id,\n            _: \"true\"\n        });\n    },\n\n    add_node_for_module: function(type, title) {\n        var node = this.workflow.create_node(type, title);\n        this._moduleInitAjax(node, { type: type, _: \"true\" });\n    },\n\n    display_file_list: function(node) {\n        var addlist = \"<select id='node_data_list' name='node_data_list'>\";\n        for (var out_terminal in node.output_terminals) {\n            addlist += `<option value='${out_terminal}'>${out_terminal}</option>`;\n        }\n        addlist += \"</select>\";\n        return addlist;\n    },\n\n    showWorkflowParameters: function() {\n        var parameter_re = /\\$\\{.+?\\}/g;\n        var workflow_parameters = [];\n        var wf_parm_container = $(\"#workflow-parameters-container\");\n        var wf_parm_box = $(\"#workflow-parameters-box\");\n        var new_parameter_content = \"\";\n        var matches = [];\n        $.each(this.workflow.nodes, (k, node) => {\n            if (node.config_form && node.config_form.inputs) {\n                Utils.deepeach(node.config_form.inputs, d => {\n                    if (typeof d.value == \"string\") {\n                        var form_matches = d.value.match(parameter_re);\n                        if (form_matches) {\n                            matches = matches.concat(form_matches);\n                        }\n                    }\n                });\n            }\n            if (node.post_job_actions) {\n                $.each(node.post_job_actions, (k, pja) => {\n                    if (pja.action_arguments) {\n                        $.each(pja.action_arguments, (k, action_argument) => {\n                            if (typeof action_argument === \"string\") {\n                                let arg_matches = action_argument.match(parameter_re);\n                                if (arg_matches) {\n                                    matches = matches.concat(arg_matches);\n                                }\n                            }\n                        });\n                    }\n                });\n            }\n            if (matches) {\n                $.each(matches, (k, element) => {\n                    if ($.inArray(element, workflow_parameters) === -1) {\n                        workflow_parameters.push(element);\n                    }\n                });\n            }\n        });\n        if (workflow_parameters && workflow_parameters.length !== 0) {\n            $.each(workflow_parameters, (k, element) => {\n                new_parameter_content += `<div>${element.substring(2, element.length - 1)}</div>`;\n            });\n            wf_parm_container.html(new_parameter_content);\n            wf_parm_box.show();\n        } else {\n            wf_parm_container.html(new_parameter_content);\n            wf_parm_box.hide();\n        }\n    },\n\n    showAttributes: function() {\n        $(\".right-content\").hide();\n        $(\"#edit-attributes\").show();\n    },\n\n    showForm: function(content, node) {\n        const cls = \"right-content\";\n        var id = `${cls}-${node.id}`;\n        var $container = $(`#${cls}`);\n        let Galaxy = getGalaxyInstance();\n        if (content && $container.find(`#${id}`).length === 0) {\n            var $el = $(`<div id=\"${id}\" class=\"${cls}\"/>`);\n            content.node = node;\n            content.workflow = this.workflow;\n            content.datatypes = this.datatypes;\n            content.icon = WorkflowIcons[node.type];\n            content.cls = \"ui-portlet-section\";\n            if (node) {\n                var form_type = node.type == \"tool\" ? \"Tool\" : \"Default\";\n                $el.append(new FormWrappers[form_type](content).form.$el);\n                $container.append($el);\n            } else {\n                Galaxy.emit.debug(\"workflow-view::initialize()\", \"Node not found in workflow.\");\n            }\n        }\n        $(`.${cls}`).hide();\n        $container.find(`#${id}`).show();\n        $container.show();\n        $container.scrollTop();\n    },\n\n    isSubType: function(child, parent) {\n        child = this.ext_to_type[child];\n        parent = this.ext_to_type[parent];\n        return this.type_to_type[child] && parent in this.type_to_type[child];\n    },\n\n    prebuildNode: function(type, title_text, content_id) {\n        var self = this;\n        var $f = $(\"<div class='toolForm toolFormInCanvas'/>\");\n        var $title = $(`<div class='toolFormTitle unselectable'><span class='nodeTitle'>${title_text}</div></div>`);\n        add_node_icon($title.find(\".nodeTitle\"), type);\n        $f.append($title);\n        $f.css(\"left\", $(window).scrollLeft() + 20);\n        $f.css(\"top\", $(window).scrollTop() + 20);\n        $f.append($(\"<div class='toolFormBody'></div>\"));\n        var node = new Node(this, { element: $f });\n        node.type = type;\n        node.content_id = content_id;\n        var tmp = `<div><img height='16' align='middle' src='${getAppRoot()}static/images/loading_small_white_bg.gif'/> loading tool info...</div>`;\n        $f.find(\".toolFormBody\").append(tmp);\n        // Fix width to computed width\n        // Now add floats\n        var buttons = $(\"<div class='buttons' style='float: right;'></div>\");\n        if (type !== \"subworkflow\") {\n            buttons.append(\n                $(\"<div/>\")\n                    .addClass(\"fa-icon-button fa fa-files-o node-clone\")\n                    .click(e => {\n                        node.clone();\n                    })\n            );\n        }\n        buttons.append(\n            $(\"<div/>\")\n                .addClass(\"fa-icon-button fa fa-times node-destroy\")\n                .click(e => {\n                    node.destroy();\n                })\n        );\n        // Place inside container\n        $f.appendTo(\"#canvas-container\");\n        // Position in container\n        var o = $(\"#canvas-container\").position();\n        var p = $(\"#canvas-container\").parent();\n        var width = $f.width();\n        var height = $f.height();\n        $f.css({\n            left: -o.left + p.width() / 2 - width / 2,\n            top: -o.top + p.height() / 2 - height / 2\n        });\n        buttons.prependTo($f.find(\".toolFormTitle\"));\n        width += buttons.width() + 10;\n        $f.css(\"width\", width);\n        $f.bind(\"dragstart\", () => {\n            self.workflow.activate_node(node);\n        })\n            .bind(\"dragend\", function() {\n                self.workflow.node_changed(this);\n                self.workflow.fit_canvas_to_nodes();\n                self.canvas_manager.draw_overview();\n            })\n            .bind(\"dragclickonly\", () => {\n                self.workflow.activate_node(node);\n            })\n            .bind(\"drag\", function(e, d) {\n                // Move\n                var po = $(this)\n                    .offsetParent()\n                    .offset();\n                // Find relative offset and scale by zoom\n                var x = (d.offsetX - po.left) / self.canvas_manager.canvasZoom;\n                var y = (d.offsetY - po.top) / self.canvas_manager.canvasZoom;\n                $(this).css({ left: x, top: y });\n                // Redraw\n                $(this)\n                    .find(\".terminal\")\n                    .each(function() {\n                        this.terminal.redraw();\n                    });\n            });\n        return node;\n    }\n});\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport * as d3 from \"d3\";\nimport { event as currentEvent } from \"d3\";\nimport visualization from \"viz/visualization\";\nimport mod_utils from \"utils/utils\";\nimport config from \"utils/config\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\nimport \"libs/farbtastic\";\n\n/**\n * Utility class for working with SVG.\n */\n\nvar SVGUtils = Backbone.Model.extend({\n    /**\n     * Returns true if element is visible.\n     */\n    is_visible: function(svg_elt, svg) {\n        var eltBRect = svg_elt.getBoundingClientRect();\n        var svgBRect = $(\"svg\")[0].getBoundingClientRect();\n\n        if (\n            // To the left of screen?\n            eltBRect.right < 0 ||\n            // To the right of screen?\n            eltBRect.left > svgBRect.right ||\n            // Above screen?\n            eltBRect.bottom < 0 ||\n            // Below screen?\n            eltBRect.top > svgBRect.bottom\n        ) {\n            return false;\n        }\n        return true;\n    }\n});\n\n/**\n * Mixin for using ticks.\n */\nvar UsesTicks = {\n    drawTicks: function(parent_elt, data, dataHandler, textTransform, horizontal) {\n        // Set up group elements for chroms and for each tick.\n        var ticks = parent_elt\n            .append(\"g\")\n            .selectAll(\"g\")\n            .data(data)\n            .enter()\n            .append(\"g\")\n            .selectAll(\"g\")\n            .data(dataHandler)\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"tick\")\n            .attr(\"transform\", d => `rotate(${(d.angle * 180) / Math.PI - 90})translate(${d.radius},0)`);\n\n        // Add line + text for ticks.\n        var tick_coords = [];\n\n        var text_coords = [];\n\n        var text_anchor = d => (d.angle > Math.PI ? \"end\" : null);\n\n        if (horizontal) {\n            tick_coords = [0, 0, 0, -4];\n            text_coords = [4, 0, \"\", \".35em\"];\n            text_anchor = null;\n        } else {\n            tick_coords = [1, 0, 4, 0];\n            text_coords = [0, 4, \".35em\", \"\"];\n        }\n\n        ticks\n            .append(\"line\")\n            .attr(\"x1\", tick_coords[0])\n            .attr(\"y1\", tick_coords[1])\n            .attr(\"x2\", tick_coords[2])\n            .attr(\"y1\", tick_coords[3])\n            .style(\"stroke\", \"#000\");\n\n        return ticks\n            .append(\"text\")\n            .attr(\"x\", text_coords[0])\n            .attr(\"y\", text_coords[1])\n            .attr(\"dx\", text_coords[2])\n            .attr(\"dy\", text_coords[3])\n            .attr(\"text-anchor\", text_anchor)\n            .attr(\"transform\", textTransform)\n            .text(d => d.label);\n    },\n\n    /**\n     * Format number for display at a tick.\n     */\n    formatNum: function(num, sigDigits) {\n        // Use default of 2 sig. digits.\n        if (sigDigits === undefined) sigDigits = 2;\n\n        // Verify input number\n        if (num === null) return null;\n\n        // Calculate return value\n        var rval = null;\n        if (Math.abs(num) < 1) {\n            rval = num.toPrecision(sigDigits);\n        } else {\n            // Use round to turn string from toPrecision() back into a number.\n            var roundedNum = Math.round(num.toPrecision(sigDigits));\n\n            // Use abbreviations.\n            num = Math.abs(num);\n            if (num < 1000) {\n                rval = roundedNum;\n            } else if (num < 1000000) {\n                // Use K.\n                rval = `${Math.round((roundedNum / 1000).toPrecision(3)).toFixed(0)}K`;\n            } else if (num < 1000000000) {\n                // Use M.\n                rval = `${Math.round((roundedNum / 1000000).toPrecision(3)).toFixed(0)}M`;\n            }\n        }\n\n        return rval;\n    }\n};\n\n/**\n * A label track.\n */\nvar CircsterLabelTrack = Backbone.Model.extend({});\n\n/**\n * Renders a full circster visualization.\n */\nvar CircsterView = Backbone.View.extend({\n    className: \"circster\",\n\n    initialize: function(options) {\n        this.genome = options.genome;\n        this.label_arc_height = 50;\n        this.scale = 1;\n        this.circular_views = null;\n        this.chords_views = null;\n\n        // When tracks added to/removed from model, update view.\n        this.model.get(\"drawables\").on(\"add\", this.add_track, this);\n        this.model.get(\"drawables\").on(\"remove\", this.remove_track, this);\n\n        // When config settings change, update view.\n        var vis_config = this.model.get(\"config\");\n        vis_config.get(\"arc_dataset_height\").on(\"change:value\", this.update_track_bounds, this);\n        vis_config.get(\"track_gap\").on(\"change:value\", this.update_track_bounds, this);\n    },\n\n    // HACKs: using track_type for circular/chord distinction in the functions below for now.\n\n    /**\n     * Returns tracks to be rendered using circular view.\n     */\n    get_circular_tracks: function() {\n        return this.model.get(\"drawables\").filter(track => track.get(\"track_type\") !== \"DiagonalHeatmapTrack\");\n    },\n\n    /**\n     * Returns tracks to be rendered using chords view.\n     */\n    get_chord_tracks: function() {\n        return this.model.get(\"drawables\").filter(track => track.get(\"track_type\") === \"DiagonalHeatmapTrack\");\n    },\n\n    /**\n     * Returns a list of circular tracks' radius bounds.\n     */\n    get_tracks_bounds: function() {\n        var circular_tracks = this.get_circular_tracks();\n\n        var dataset_arc_height = this.model.get(\"config\").get_value(\"arc_dataset_height\");\n\n        var track_gap = this.model.get(\"config\").get_value(\"track_gap\");\n\n        var // Subtract 20 to make sure chrom labels are on screen.\n            min_dimension = Math.min(this.$el.width(), this.$el.height()) - 20;\n\n        var // Compute radius start based on model, will be centered\n            // and fit entirely inside element by default.\n            radius_start =\n                min_dimension / 2 -\n                circular_tracks.length * (dataset_arc_height + track_gap) +\n                // Add track_gap back in because no gap is needed for last track.\n                track_gap -\n                this.label_arc_height;\n\n        var // Compute range of track starting radii.\n            tracks_start_radii = d3.range(radius_start, min_dimension / 2, dataset_arc_height + track_gap);\n\n        // Map from track start to bounds.\n        return _.map(tracks_start_radii, radius => [radius, radius + dataset_arc_height]);\n    },\n\n    /**\n     * Renders circular tracks, chord tracks, and label tracks.\n     */\n    render: function() {\n        var self = this;\n        var width = self.$el.width();\n        var height = self.$el.height();\n        var circular_tracks = this.get_circular_tracks();\n        var chords_tracks = this.get_chord_tracks();\n        var total_gap = self.model.get(\"config\").get_value(\"total_gap\");\n        var tracks_bounds = this.get_tracks_bounds();\n\n        var // Set up SVG element.\n            svg = d3\n                .select(self.$el[0])\n                .append(\"svg\")\n                .attr(\"width\", width)\n                .attr(\"height\", height)\n                .attr(\"pointer-events\", \"all\")\n                // Set up zooming, dragging.\n                .append(\"svg:g\")\n                .call(\n                    d3.behavior.zoom().on(\"zoom\", () => {\n                        // Do zoom, drag.\n                        var scale = currentEvent.scale;\n                        svg.attr(\"transform\", `translate(${currentEvent.translate}) scale(${scale})`);\n\n                        // Propagate scale changes to views.\n                        if (self.scale !== scale) {\n                            // Use timeout to wait for zooming/dragging to stop before rendering more detail.\n                            if (self.zoom_drag_timeout) {\n                                clearTimeout(self.zoom_drag_timeout);\n                            }\n                            self.zoom_drag_timeout = setTimeout(() => {\n                                // Render more detail in tracks' visible elements.\n                                // FIXME: do not do this right now; it is not fully implemented--e.g. data bounds\n                                // are not updated when new data is fetched--and fetching more detailed quantitative\n                                // data is not that useful.\n                                /*\n                        _.each(self.circular_views, function(view) {\n                            view.update_scale(scale);\n                        });\n                        */\n                            }, 400);\n                        }\n                    })\n                )\n                .attr(\"transform\", `translate(${width / 2},${height / 2})`)\n                .append(\"svg:g\")\n                .attr(\"class\", \"tracks\");\n\n        // -- Render circular tracks. --\n\n        // Create a view for each track in the visualization and render.\n        this.circular_views = circular_tracks.map((track, index) => {\n            var view = new CircsterBigWigTrackView({\n                el: svg.append(\"g\")[0],\n                track: track,\n                radius_bounds: tracks_bounds[index],\n                genome: self.genome,\n                total_gap: total_gap\n            });\n\n            view.render();\n\n            return view;\n        });\n\n        // -- Render chords tracks. --\n\n        this.chords_views = chords_tracks.map(track => {\n            var view = new CircsterChromInteractionsTrackView({\n                el: svg.append(\"g\")[0],\n                track: track,\n                radius_bounds: tracks_bounds[0],\n                genome: self.genome,\n                total_gap: total_gap\n            });\n\n            view.render();\n\n            return view;\n        });\n\n        // -- Render label track. --\n\n        // Track bounds are:\n        // (a) outer radius of last circular track;\n        // (b)\n        var outermost_radius = this.circular_views[this.circular_views.length - 1].radius_bounds[1];\n\n        var track_bounds = [outermost_radius, outermost_radius + this.label_arc_height];\n\n        this.label_track_view = new CircsterChromLabelTrackView({\n            el: svg.append(\"g\")[0],\n            track: new CircsterLabelTrack(),\n            radius_bounds: track_bounds,\n            genome: self.genome,\n            total_gap: total_gap\n        });\n\n        this.label_track_view.render();\n    },\n\n    /**\n     * Render a single track on the outside of the current visualization.\n     */\n    add_track: function(new_track) {\n        var total_gap = this.model.get(\"config\").get_value(\"total_gap\");\n\n        if (new_track.get(\"track_type\") === \"DiagonalHeatmapTrack\") {\n            // Added chords track.\n            var innermost_radius_bounds = this.circular_views[0].radius_bounds;\n\n            var new_view = new CircsterChromInteractionsTrackView({\n                el: d3.select(\"g.tracks\").append(\"g\")[0],\n                track: new_track,\n                radius_bounds: innermost_radius_bounds,\n                genome: this.genome,\n                total_gap: total_gap\n            });\n\n            new_view.render();\n            this.chords_views.push(new_view);\n        } else {\n            // Added circular track.\n\n            // Recompute and update circular track bounds.\n            var new_track_bounds = this.get_tracks_bounds();\n            _.each(this.circular_views, (track_view, i) => {\n                track_view.update_radius_bounds(new_track_bounds[i]);\n            });\n\n            // Update chords tracks.\n            _.each(this.chords_views, track_view => {\n                track_view.update_radius_bounds(new_track_bounds[0]);\n            });\n\n            // Render new track.\n            var track_index = this.circular_views.length;\n\n            var track_view = new CircsterBigWigTrackView({\n                el: d3.select(\"g.tracks\").append(\"g\")[0],\n                track: new_track,\n                radius_bounds: new_track_bounds[track_index],\n                genome: this.genome,\n                total_gap: total_gap\n            });\n\n            track_view.render();\n            this.circular_views.push(track_view);\n\n            // Update label track.\n            /*\n            FIXME: should never have to update label track because vis always expands to fit area\n            within label track.\n            var track_bounds = new_track_bounds[ new_track_bounds.length-1 ];\n            track_bounds[1] = track_bounds[0];\n            this.label_track_view.update_radius_bounds(track_bounds);\n            */\n        }\n    },\n\n    /**\n     * Remove a track from the view.\n     */\n    remove_track: function(track, tracks, options) {\n        // -- Remove track from view. --\n        var track_view = this.circular_views[options.index];\n        this.circular_views.splice(options.index, 1);\n        track_view.$el.remove();\n\n        // Recompute and update track bounds.\n        var new_track_bounds = this.get_tracks_bounds();\n        _.each(this.circular_views, (track_view, i) => {\n            track_view.update_radius_bounds(new_track_bounds[i]);\n        });\n    },\n\n    update_track_bounds: function() {\n        // Recompute and update track bounds.\n        var new_track_bounds = this.get_tracks_bounds();\n        _.each(this.circular_views, (track_view, i) => {\n            track_view.update_radius_bounds(new_track_bounds[i]);\n        });\n\n        // Update chords tracks.\n        _.each(this.chords_views, track_view => {\n            track_view.update_radius_bounds(new_track_bounds[0]);\n        });\n    }\n});\n\n/**\n * Renders a track in a Circster visualization.\n */\nvar CircsterTrackView = Backbone.View.extend({\n    tagName: \"g\",\n\n    /* ----------------------- Public Methods ------------------------- */\n\n    initialize: function(options) {\n        this.bg_stroke = \"#ddd\";\n        // Fill color when loading data.\n        this.loading_bg_fill = \"#ffc\";\n        // Fill color when data has been loaded.\n        this.bg_fill = \"#ddd\";\n        this.total_gap = options.total_gap;\n        this.track = options.track;\n        this.radius_bounds = options.radius_bounds;\n        this.genome = options.genome;\n        this.chroms_layout = this._chroms_layout();\n        this.data_bounds = [];\n        this.scale = 1;\n        this.parent_elt = d3.select(this.$el[0]);\n    },\n\n    /**\n     * Get fill color from config.\n     */\n    get_fill_color: function() {\n        var color = this.track.get(\"config\").get_value(\"block_color\");\n        if (!color) {\n            color = this.track.get(\"config\").get_value(\"color\");\n        }\n        return color;\n    },\n\n    /**\n     * Render track's data by adding SVG elements to parent.\n     */\n    render: function() {\n        // -- Create track group element. --\n        var track_parent_elt = this.parent_elt;\n\n        // -- Render background arcs. --\n        var genome_arcs = this.chroms_layout;\n\n        var arc_gen = d3.svg\n            .arc()\n            .innerRadius(this.radius_bounds[0])\n            .outerRadius(this.radius_bounds[1]);\n\n        var // Attach data to group element.\n            chroms_elts = track_parent_elt\n                .selectAll(\"g\")\n                .data(genome_arcs)\n                .enter()\n                .append(\"svg:g\");\n\n        var // Draw chrom arcs/paths.\n            chroms_paths = chroms_elts\n                .append(\"path\")\n                .attr(\"d\", arc_gen)\n                .attr(\"class\", \"chrom-background\")\n                .style(\"stroke\", this.bg_stroke)\n                .style(\"fill\", this.loading_bg_fill);\n\n        // Append titles to paths.\n        chroms_paths.append(\"title\").text(d => d.data.chrom);\n\n        // -- Render track data and, when track data is rendered, apply preferences and update chrom_elts fill. --\n\n        var self = this;\n\n        var data_manager = self.track.get(\"data_manager\");\n\n        var // If track has a data manager, get deferred that resolves when data is ready.\n            data_ready_deferred = data_manager ? data_manager.data_is_ready() : true;\n\n        // When data is ready, render track.\n        $.when(data_ready_deferred).then(() => {\n            $.when(self._render_data(track_parent_elt)).then(() => {\n                chroms_paths.style(\"fill\", self.bg_fill);\n\n                // Render labels after data is available so that data attributes are available.\n                self.render_labels();\n            });\n        });\n    },\n\n    /**\n     * Render track labels.\n     */\n    render_labels: function() {},\n\n    /**\n     * Update radius bounds.\n     */\n    update_radius_bounds: function(radius_bounds) {\n        // Update bounds.\n        this.radius_bounds = radius_bounds;\n\n        // -- Update background arcs. --\n        var new_d = d3.svg\n            .arc()\n            .innerRadius(this.radius_bounds[0])\n            .outerRadius(this.radius_bounds[1]);\n\n        this.parent_elt\n            .selectAll(\"g>path.chrom-background\")\n            .transition()\n            .duration(1000)\n            .attr(\"d\", new_d);\n\n        this._transition_chrom_data();\n\n        this._transition_labels();\n    },\n\n    /**\n     * Update view scale. This fetches more data if scale is increased.\n     */\n    update_scale: function(new_scale) {\n        // -- Update scale and return if new scale is less than old scale. --\n\n        var old_scale = this.scale;\n        this.scale = new_scale;\n        if (new_scale <= old_scale) {\n            return;\n        }\n\n        // -- Scale increased, so render visible data with more detail. --\n\n        var self = this;\n\n        var utils = new SVGUtils();\n\n        // Select all chrom data and filter to operate on those that are visible.\n        this.parent_elt\n            .selectAll(\"path.chrom-data\")\n            .filter(function(d, i) {\n                return utils.is_visible(this);\n            })\n            .each(function(d, i) {\n                // -- Now operating on a single path element representing chromosome data. --\n\n                var path_elt = d3.select(this);\n\n                var chrom = path_elt.attr(\"chrom\");\n                var chrom_region = self.genome.get_chrom_region(chrom);\n                var data_manager = self.track.get(\"data_manager\");\n                var data_deferred;\n\n                // If can't get more detailed data, return.\n                if (!data_manager.can_get_more_detailed_data(chrom_region)) {\n                    return;\n                }\n\n                // -- Get more detailed data. --\n                data_deferred = self.track\n                    .get(\"data_manager\")\n                    .get_more_detailed_data(chrom_region, \"Coverage\", 0, new_scale);\n\n                // When more data is available, use new data to redraw path.\n                $.when(data_deferred).then(data => {\n                    // Remove current data path.\n                    path_elt.remove();\n\n                    // Update data bounds with new data.\n                    self._update_data_bounds();\n\n                    // Find chromosome arc to draw data on.\n                    var chrom_arc = _.find(self.chroms_layout, layout => layout.data.chrom === chrom);\n\n                    // Add new data path and apply preferences.\n                    var color = self.get_fill_color();\n                    self._render_chrom_data(self.parent_elt, chrom_arc, data)\n                        .style(\"stroke\", color)\n                        .style(\"fill\", color);\n                });\n            });\n\n        return self;\n    },\n\n    /* ----------------------- Internal Methods ------------------------- */\n\n    /**\n     * Transitions chrom data to new values (e.g new radius or data bounds).\n     */\n    _transition_chrom_data: function() {\n        var track = this.track;\n        var chrom_arcs = this.chroms_layout;\n        var chrom_data_paths = this.parent_elt.selectAll(\"g>path.chrom-data\");\n        var num_paths = chrom_data_paths[0].length;\n\n        if (num_paths > 0) {\n            var self = this;\n            $.when(track.get(\"data_manager\").get_genome_wide_data(this.genome)).then(genome_wide_data => {\n                // Map chrom data to path data, filtering out null values.\n                var path_data = _.reject(\n                    _.map(genome_wide_data, (chrom_data, i) => {\n                        var rval = null;\n\n                        var path_fn = self._get_path_function(chrom_arcs[i], chrom_data);\n\n                        if (path_fn) {\n                            rval = path_fn(chrom_data.data);\n                        }\n                        return rval;\n                    }),\n                    p_data => p_data === null\n                );\n\n                // Transition each path for data and color.\n                var color = track.get(\"config\").get_value(\"color\");\n                chrom_data_paths.each(function(path, index) {\n                    d3.select(this)\n                        .transition()\n                        .duration(1000)\n                        .style(\"stroke\", color)\n                        .style(\"fill\", color)\n                        .attr(\"d\", path_data[index]);\n                });\n            });\n        }\n    },\n\n    /**\n     * Transition labels to new values (e.g new radius or data bounds).\n     */\n    _transition_labels: function() {},\n\n    /**\n     * Update data bounds. If there are new_bounds, use them; otherwise use\n     * default data bounds.\n     */\n    _update_data_bounds: function(new_bounds) {\n        this.data_bounds =\n            new_bounds || this.get_data_bounds(this.track.get(\"data_manager\").get_genome_wide_data(this.genome));\n        this._transition_chrom_data();\n    },\n\n    /**\n     * Render data as elements attached to svg.\n     */\n    _render_data: function(svg) {\n        var self = this;\n        var chrom_arcs = this.chroms_layout;\n        var track = this.track;\n        var rendered_deferred = $.Deferred();\n\n        // When genome-wide data is available, render data.\n        $.when(track.get(\"data_manager\").get_genome_wide_data(this.genome)).then(genome_wide_data => {\n            // Set bounds.\n            self.data_bounds = self.get_data_bounds(genome_wide_data);\n\n            // Set min, max value in config so that they can be adjusted. Make this silent\n            // because these attributes are watched for changes and the viz is updated\n            // accordingly (set up in initialize). Because we are setting up, we don't want\n            // the watch to trigger events here.\n            track.get(\"config\").set_value(\"min_value\", self.data_bounds[0], {\n                silent: true\n            });\n            track.get(\"config\").set_value(\"max_value\", self.data_bounds[1], {\n                silent: true\n            });\n\n            // Merge chroms layout with data.\n            var layout_and_data = _.zip(chrom_arcs, genome_wide_data);\n\n            // Render each chromosome's data.\n            _.each(layout_and_data, chrom_info => {\n                var chrom_arc = chrom_info[0];\n                var data = chrom_info[1];\n                return self._render_chrom_data(svg, chrom_arc, data);\n            });\n\n            // Apply prefs to all track data.\n            var color = self.get_fill_color();\n            self.parent_elt\n                .selectAll(\"path.chrom-data\")\n                .style(\"stroke\", color)\n                .style(\"fill\", color);\n\n            rendered_deferred.resolve(svg);\n        });\n\n        return rendered_deferred;\n    },\n\n    /**\n     * Render a chromosome data and attach elements to svg.\n     */\n    _render_chrom_data: function(svg, chrom_arc, data) {},\n\n    /**\n     * Returns data for creating a path for the given data using chrom_arc and data bounds.\n     */\n    _get_path_function: function(chrom_arc, chrom_data) {},\n\n    /**\n     * Returns arc layouts for genome's chromosomes/contigs. Arcs are arranged in a circle\n     * separated by gaps.\n     */\n    _chroms_layout: function() {\n        // Setup chroms layout using pie.\n        var chroms_info = this.genome.get_chroms_info();\n\n        var pie_layout = d3.layout\n            .pie()\n            .value(d => d.len)\n            .sort(null);\n\n        var init_arcs = pie_layout(chroms_info);\n        var gap_per_chrom = (2 * Math.PI * this.total_gap) / chroms_info.length;\n\n        var chrom_arcs = _.map(init_arcs, (arc, index) => {\n            // For short chroms, endAngle === startAngle.\n            var new_endAngle = arc.endAngle - gap_per_chrom;\n            arc.endAngle = new_endAngle > arc.startAngle ? new_endAngle : arc.startAngle;\n            return arc;\n        });\n\n        return chrom_arcs;\n    }\n});\n\n/**\n * Render chromosome labels.\n */\nvar CircsterChromLabelTrackView = CircsterTrackView.extend({\n    initialize: function(options) {\n        CircsterTrackView.prototype.initialize.call(this, options);\n        // Use a single arc for rendering data.\n        this.innerRadius = this.radius_bounds[0];\n        this.radius_bounds[0] = this.radius_bounds[1];\n        this.bg_stroke = \"#fff\";\n        this.bg_fill = \"#fff\";\n\n        // Minimum arc distance for labels to be applied.\n        this.min_arc_len = 0.05;\n    },\n\n    /**\n     * Render labels.\n     */\n    _render_data: function(svg) {\n        // -- Add chromosome label where it will fit; an alternative labeling mechanism\n        // would be nice for small chromosomes. --\n        var self = this;\n\n        var chrom_arcs = svg.selectAll(\"g\");\n\n        chrom_arcs.selectAll(\"path\").attr(\"id\", d => `label-${d.data.chrom}`);\n\n        chrom_arcs\n            .append(\"svg:text\")\n            .filter(d => d.endAngle - d.startAngle > self.min_arc_len)\n            .attr(\"text-anchor\", \"middle\")\n            .append(\"svg:textPath\")\n            .attr(\"class\", \"chrom-label\")\n            .attr(\"xlink:href\", d => `#label-${d.data.chrom}`)\n            .attr(\"startOffset\", \"25%\")\n            .text(d => d.data.chrom);\n\n        // -- Add ticks to denote chromosome length. --\n\n        /** Returns an array of tick angles and labels, given a chrom arc. */\n        var chromArcTicks = d => {\n            var k = (d.endAngle - d.startAngle) / d.value;\n\n            var ticks = d3.range(0, d.value, 25000000).map((v, i) => ({\n                radius: self.innerRadius,\n                angle: v * k + d.startAngle,\n                label: i === 0 ? 0 : i % 3 ? null : self.formatNum(v)\n            }));\n\n            // If there are fewer that 4 ticks, label last tick so that at least one non-zero tick is labeled.\n            if (ticks.length < 4) {\n                ticks[ticks.length - 1].label = self.formatNum(\n                    Math.round((ticks[ticks.length - 1].angle - d.startAngle) / k)\n                );\n            }\n\n            return ticks;\n        };\n\n        /** Rotate and move text as needed. */\n        var textTransform = d => (d.angle > Math.PI ? \"rotate(180)translate(-16)\" : null);\n\n        // Filter chroms for only those large enough for display.\n        var visibleChroms = _.filter(this.chroms_layout, c => c.endAngle - c.startAngle > self.min_arc_len);\n\n        this.drawTicks(this.parent_elt, visibleChroms, chromArcTicks, textTransform);\n    }\n});\n_.extend(CircsterChromLabelTrackView.prototype, UsesTicks);\n\n/**\n * View for quantitative track in Circster.\n */\nvar CircsterQuantitativeTrackView = CircsterTrackView.extend({\n    initialize: function(options) {\n        CircsterTrackView.prototype.initialize.call(this, options);\n\n        // When config settings change, update view.\n        var track_config = this.track.get(\"config\");\n        track_config.get(\"min_value\").on(\"change:value\", this._update_min_max, this);\n        track_config.get(\"max_value\").on(\"change:value\", this._update_min_max, this);\n        track_config.get(\"color\").on(\"change:value\", this._transition_chrom_data, this);\n    },\n\n    /**\n     * Update track when min and/or max are changed.\n     */\n    _update_min_max: function() {\n        var track_config = this.track.get(\"config\");\n\n        var new_bounds = [track_config.get_value(\"min_value\"), track_config.get_value(\"max_value\")];\n\n        this._update_data_bounds(new_bounds);\n\n        // FIXME: this works to update tick/text bounds, but there's probably a better way to do this\n        // by updating the data itself.\n        this.parent_elt.selectAll(\".min_max\").text((d, i) => new_bounds[i]);\n    },\n\n    /**\n     * Returns quantile for an array of numbers.\n     */\n    _quantile: function(numbers, quantile) {\n        numbers.sort(d3.ascending);\n        return d3.quantile(numbers, quantile);\n    },\n\n    /**\n     * Renders quantitative data with the form [x, value] and assumes data is equally spaced across\n     * chromosome. Attachs a dict with track and chrom name information to DOM element.\n     */\n    _render_chrom_data: function(svg, chrom_arc, chrom_data) {\n        var path_data = this._get_path_function(chrom_arc, chrom_data);\n\n        if (!path_data) {\n            return null;\n        }\n\n        // There is path data, so render as path.\n        var parent = svg.datum(chrom_data.data);\n\n        var path = parent\n            .append(\"path\")\n            .attr(\"class\", \"chrom-data\")\n            .attr(\"chrom\", chrom_arc.data.chrom)\n            .attr(\"d\", path_data);\n\n        return path;\n    },\n\n    /**\n     * Returns function for creating a path across the chrom arc.\n     */\n    _get_path_function: function(chrom_arc, chrom_data) {\n        // If no chrom data, return null.\n        if (typeof chrom_data === \"string\" || !chrom_data.data || chrom_data.data.length === 0) {\n            return null;\n        }\n\n        // Radius scaler.\n        var radius = d3.scale\n            .linear()\n            .domain(this.data_bounds)\n            .range(this.radius_bounds)\n            .clamp(true);\n\n        // Scaler for placing data points across arc.\n        var angle = d3.scale\n            .linear()\n            .domain([0, chrom_data.data.length])\n            .range([chrom_arc.startAngle, chrom_arc.endAngle]);\n\n        // Use line generator to create area.\n        var line = d3.svg.line\n            .radial()\n            .interpolate(\"linear\")\n            .radius(d => radius(d[1]))\n            .angle((d, i) => angle(i));\n\n        return d3.svg.area\n            .radial()\n            .interpolate(line.interpolate())\n            .innerRadius(radius(0))\n            .outerRadius(line.radius())\n            .angle(line.angle());\n    },\n\n    /**\n     * Render track min, max using ticks.\n     */\n    render_labels: function() {\n        var self = this;\n\n        var // Keep counter of visible chroms.\n            textTransform = () => \"rotate(90)\";\n\n        // FIXME:\n        // (1) using min_max class below is needed for _update_min_max, which could be improved.\n        // (2) showing config on tick click should be replaced by proper track config icon.\n\n        // Draw min, max on first chrom only.\n        var ticks = this.drawTicks(\n            this.parent_elt,\n            [this.chroms_layout[0]],\n            this._data_bounds_ticks_fn(),\n            textTransform,\n            true\n        ).classed(\"min_max\", true);\n\n        // Show config when ticks are clicked on.\n        _.each(ticks, tick => {\n            $(tick).click(() => {\n                var view = new config.ConfigSettingCollectionView({\n                    collection: self.track.get(\"config\")\n                });\n                view.render_in_modal(\"Configure Track\");\n            });\n        });\n\n        /*\n        // Filter for visible chroms, then for every third chrom so that labels attached to only every\n        // third chrom.\n        var visibleChroms = _.filter(this.chroms_layout, function(c) { return c.endAngle - c.startAngle > 0.08; }),\n            labeledChroms = _.filter(visibleChroms, function(c, i) { return i % 3 === 0; });\n        this.drawTicks(this.parent_elt, labeledChroms, this._data_bounds_ticks_fn(), textTransform, true);\n        */\n    },\n\n    /**\n     * Transition labels to new values (e.g new radius or data bounds).\n     */\n    _transition_labels: function() {\n        // FIXME: (a) pull out function for getting labeled chroms? and (b) function used in transition below\n        // is copied from UseTicks mixin, so pull out and make generally available.\n\n        // If there are no data bounds, nothing to transition.\n        if (this.data_bounds.length === 0) {\n            return;\n        }\n\n        // Transition labels to new radius bounds.\n        var self = this;\n\n        var visibleChroms = _.filter(this.chroms_layout, c => c.endAngle - c.startAngle > 0.08);\n\n        var labeledChroms = _.filter(visibleChroms, (c, i) => i % 3 === 0);\n\n        var new_data = _.flatten(_.map(labeledChroms, c => self._data_bounds_ticks_fn()(c)));\n\n        this.parent_elt\n            .selectAll(\"g.tick\")\n            .data(new_data)\n            .transition()\n            .attr(\"transform\", d => `rotate(${(d.angle * 180) / Math.PI - 90})translate(${d.radius},0)`);\n    },\n\n    /**\n     * Get function for locating data bounds ticks.\n     */\n    _data_bounds_ticks_fn: function() {\n        // Closure vars.\n        var self = this;\n\n        // Return function for locating ticks based on chrom arc data.\n        return (\n            d // Set up data to display min, max ticks.\n        ) => [\n            {\n                radius: self.radius_bounds[0],\n                angle: d.startAngle,\n                label: self.formatNum(self.data_bounds[0])\n            },\n            {\n                radius: self.radius_bounds[1],\n                angle: d.startAngle,\n                label: self.formatNum(self.data_bounds[1])\n            }\n        ];\n    },\n\n    /**\n     * Returns an array with two values denoting the minimum and maximum\n     * values for the track.\n     */\n    get_data_bounds: function(data) {}\n});\n_.extend(CircsterQuantitativeTrackView.prototype, UsesTicks);\n\n/**\n * Bigwig track view in Circster.\n */\nvar CircsterBigWigTrackView = CircsterQuantitativeTrackView.extend({\n    get_data_bounds: function(data) {\n        // Set max across dataset by extracting all values, flattening them into a\n        // single array, and getting third quartile.\n        var values = _.flatten(\n            _.map(data, d => {\n                if (d) {\n                    // Each data point has the form [position, value], so return all values.\n                    return _.map(\n                        d.data,\n                        (\n                            p // Null is used for a lack of data; resolve null to 0 for comparison.\n                        ) => parseInt(p[1], 10) || 0\n                    );\n                } else {\n                    return 0;\n                }\n            })\n        );\n\n        // For max, use 98% quantile in attempt to avoid very large values. However, this max may be 0\n        // for sparsely populated data, so use max in that case.\n        return [_.min(values), this._quantile(values, 0.98) || _.max(values)];\n    }\n});\n\n/**\n * Chromosome interactions track view in Circster.\n */\nvar CircsterChromInteractionsTrackView = CircsterTrackView.extend({\n    render: function() {\n        var self = this;\n\n        // When data is ready, render track.\n        $.when(self.track.get(\"data_manager\").data_is_ready()).then(() => {\n            // When data has been fetched, render track.\n            $.when(self.track.get(\"data_manager\").get_genome_wide_data(self.genome)).then(genome_wide_data => {\n                var chord_data = [];\n                var chroms_info = self.genome.get_chroms_info();\n                // Convert chromosome data into chord data.\n                _.each(genome_wide_data, (chrom_data, index) => {\n                    // Map each interaction into chord data.\n                    var cur_chrom = chroms_info[index].chrom;\n                    var chrom_chord_data = _.map(chrom_data.data, datum => {\n                        // Each datum is an interaction/chord.\n                        var source_angle = self._get_region_angle(cur_chrom, datum[1]);\n\n                        var target_angle = self._get_region_angle(datum[3], datum[4]);\n\n                        return {\n                            source: {\n                                startAngle: source_angle,\n                                endAngle: source_angle + 0.01\n                            },\n                            target: {\n                                startAngle: target_angle,\n                                endAngle: target_angle + 0.01\n                            }\n                        };\n                    });\n\n                    chord_data = chord_data.concat(chrom_chord_data);\n                });\n\n                self.parent_elt\n                    .append(\"g\")\n                    .attr(\"class\", \"chord\")\n                    .selectAll(\"path\")\n                    .data(chord_data)\n                    .enter()\n                    .append(\"path\")\n                    .style(\"fill\", self.get_fill_color())\n                    .attr(\"d\", d3.svg.chord().radius(self.radius_bounds[0]))\n                    .style(\"opacity\", 1);\n            });\n        });\n    },\n\n    update_radius_bounds: function(radius_bounds) {\n        this.radius_bounds = radius_bounds;\n        this.parent_elt\n            .selectAll(\"path\")\n            .transition()\n            .attr(\"d\", d3.svg.chord().radius(this.radius_bounds[0]));\n    },\n\n    /**\n     * Returns radians for a genomic position.\n     */\n    _get_region_angle: function(chrom, position) {\n        // Find chrom angle data\n        var chrom_angle_data = _.find(this.chroms_layout, chrom_layout => chrom_layout.data.chrom === chrom);\n\n        // Return angle at position.\n        return (\n            chrom_angle_data.endAngle -\n            ((chrom_angle_data.endAngle - chrom_angle_data.startAngle) * (chrom_angle_data.data.len - position)) /\n                chrom_angle_data.data.len\n        );\n    }\n});\n\n// circster app loader\nvar Circster = Backbone.View.extend({\n    initialize: function() {\n        // load css\n        mod_utils.cssLoadFile(\"static/style/circster.css\");\n        // -- Configure visualization --\n        var genome = new visualization.Genome(window.galaxy_config.app.genome);\n\n        var vis = new visualization.GenomeVisualization(window.galaxy_config.app.viz_config);\n\n        // Add Circster-specific config options.\n        vis.get(\"config\").add([\n            {\n                key: \"arc_dataset_height\",\n                label: \"Arc Dataset Height\",\n                type: \"int\",\n                value: 25,\n                view: \"circster\"\n            },\n            {\n                key: \"track_gap\",\n                label: \"Gap Between Tracks\",\n                type: \"int\",\n                value: 5,\n                view: \"circster\"\n            },\n            {\n                key: \"total_gap\",\n                label: \"Gap [0-1]\",\n                type: \"float\",\n                value: 0.4,\n                view: \"circster\",\n                hidden: true\n            }\n        ]);\n\n        var viz_view = new CircsterView({\n            // view pane\n            el: $(\"#center .unified-panel-body\"),\n            genome: genome,\n            model: vis\n        });\n\n        // Render vizualization\n        viz_view.render();\n\n        // setup title\n        $(\"#center .unified-panel-header-inner\").append(\n            `${window.galaxy_config.app.viz_config.title} ${window.galaxy_config.app.viz_config.dbkey}`\n        );\n\n        // setup menu\n        var menu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                {\n                    icon_class: \"plus-button\",\n                    title: _l(\"Add tracks\"),\n                    on_click: function() {\n                        visualization.select_datasets({ dbkey: vis.get(\"dbkey\") }, tracks => {\n                            vis.add_tracks(tracks);\n                        });\n                    }\n                },\n                {\n                    icon_class: \"gear\",\n                    title: _l(\"Settings\"),\n                    on_click: function() {\n                        var view = new config.ConfigSettingCollectionView({\n                            collection: vis.get(\"config\")\n                        });\n                        view.render_in_modal(\"Configure Visualization\");\n                    }\n                },\n                {\n                    icon_class: \"disk--arrow\",\n                    title: _l(\"Save\"),\n                    on_click: function() {\n                        let Galaxy = getGalaxyInstance();\n\n                        // show saving dialog box\n                        Galaxy.modal.show({\n                            title: _l(\"Saving...\"),\n                            body: \"progress\"\n                        });\n\n                        // send to server\n                        $.ajax({\n                            url: `${getAppRoot()}visualization/save`,\n                            type: \"POST\",\n                            dataType: \"json\",\n                            data: {\n                                id: vis.get(\"vis_id\"),\n                                title: vis.get(\"title\"),\n                                dbkey: vis.get(\"dbkey\"),\n                                type: \"trackster\",\n                                vis_json: JSON.stringify(vis)\n                            }\n                        })\n                            .success(vis_info => {\n                                Galaxy.modal.hide();\n                                vis.set(\"vis_id\", vis_info.vis_id);\n                            })\n                            .error(() => {\n                                // show dialog\n                                Galaxy.modal.show({\n                                    title: _l(\"Could Not Save\"),\n                                    body: \"Could not save visualization. Please try again later.\",\n                                    buttons: {\n                                        Cancel: function() {\n                                            Galaxy.modal.hide();\n                                        }\n                                    }\n                                });\n                            });\n                    }\n                },\n                {\n                    icon_class: \"cross-circle\",\n                    title: _l(\"Close\"),\n                    on_click: function() {\n                        window.top.location = `${getAppRoot()}visualizations/list`;\n                    }\n                }\n            ],\n            { tooltip_config: { placement: \"bottom\" } }\n        );\n\n        // add menu\n        menu.$el.attr(\"style\", \"float: right\");\n        $(\"#center .unified-panel-header-inner\").append(menu.$el);\n\n        // manual tooltip config because default gravity is S and cannot be changed\n        $(\".menu-button\").tooltip({ placement: \"bottom\" });\n    }\n});\n\n// Module exports.\nexport default {\n    GalaxyApp: Circster\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _l from \"utils/localization\";\nimport * as d3 from \"d3\";\nimport visualization_mod from \"viz/visualization\";\nimport { Dataset } from \"mvc/dataset/data\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\nimport { show_message, hide_modal } from \"layout/modal\";\n\n/**\n * Base class of any menus that takes in user interaction. Contains checking methods.\n */\nvar UserMenuBase = Backbone.View.extend({\n    className: \"UserMenuBase\",\n\n    /**\n     * Check if an input value is a number and falls within max min.\n     */\n    isAcceptableValue: function($inputKey, min, max) {\n        //TODO: use better feedback than alert\n        var value = $inputKey.val();\n\n        var fieldName = $inputKey.attr(\"displayLabel\") || $inputKey.attr(\"id\").replace(\"phyloViz\", \"\");\n\n        function isNumeric(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        if (!isNumeric(value)) {\n            alert(`${fieldName} is not a number!`);\n            return false;\n        }\n\n        if (value > max) {\n            alert(`${fieldName} is too large.`);\n            return false;\n        } else if (value < min) {\n            alert(`${fieldName} is too small.`);\n            return false;\n        }\n        return true;\n    },\n\n    /**\n     * Check if any user string inputs has illegal characters that json cannot accept\n     */\n    hasIllegalJsonCharacters: function($inputKey) {\n        if ($inputKey.val().search(/\"|'|\\\\/) !== -1) {\n            alert(\n                \"Named fields cannot contain these illegal characters: \" +\n                    \"double quote(\\\"), single guote('), or back slash(\\\\). \"\n            );\n            return true;\n        }\n        return false;\n    }\n});\n\n/**\n * -- Custom Layout call for phyloViz to suit the needs of a phylogenetic tree.\n * -- Specifically: 1) Nodes have a display display of (= evo dist X depth separation) from their parent\n *                  2) Nodes must appear in other after they have expand and contracted\n */\nfunction PhyloTreeLayout() {\n    var self = this; // maximum length of the text labels\n\n    var hierarchy = d3.layout\n        .hierarchy()\n        .sort(null)\n        .value(null);\n\n    var // ! represents both the layout angle and the height of the layout, in px\n        height = 360;\n\n    var layoutMode = \"Linear\";\n\n    var // height of each individual leaf node\n        leafHeight = 18;\n\n    var // separation between nodes of different depth, in px\n        depthSeparation = 200;\n\n    var // change to recurssive call\n        leafIndex = 0;\n\n    var // tree defaults to 0.5 dist if no dist is specified\n        defaultDist = 0.5;\n\n    var maxTextWidth = 50;\n\n    self.leafHeight = inputLeafHeight => {\n        if (typeof inputLeafHeight === \"undefined\") {\n            return leafHeight;\n        } else {\n            leafHeight = inputLeafHeight;\n            return self;\n        }\n    };\n\n    self.layoutMode = mode => {\n        if (typeof mode === \"undefined\") {\n            return layoutMode;\n        } else {\n            layoutMode = mode;\n            return self;\n        }\n    };\n\n    // changes the layout angle of the display, which is really changing the height\n    self.layoutAngle = angle => {\n        if (typeof angle === \"undefined\") {\n            return height;\n        }\n        // to use default if the user puts in strange values\n        if (isNaN(angle) || angle < 0 || angle > 360) {\n            return self;\n        } else {\n            height = angle;\n            return self;\n        }\n    };\n\n    self.separation = dist => {\n        // changes the dist between the nodes of different depth\n        if (typeof dist === \"undefined\") {\n            return depthSeparation;\n        } else {\n            depthSeparation = dist;\n            return self;\n        }\n    };\n\n    self.links = (\n        nodes // uses d3 native method to generate links. Done.\n    ) => d3.layout.tree().links(nodes);\n\n    // -- Custom method for laying out phylogeny tree in a linear fashion\n    self.nodes = (d, i) => {\n        //TODO: newick and phyloxml return arrays. where should this go (client (here, else), server)?\n        if (toString.call(d) === \"[object Array]\") {\n            // if d is an array, replate with the first object (newick, phyloxml)\n            d = d[0];\n        }\n\n        // self is to find the depth of all the nodes, assumes root is passed in\n        var _nodes = hierarchy.call(self, d, i);\n\n        var nodes = [];\n        var maxDepth = 0;\n        var numLeaves = 0;\n        //console.debug( JSON.stringify( _nodes, null, 2 ) )\n        window._d = d;\n        window._nodes = _nodes;\n\n        //TODO: remove dbl-touch loop\n        // changing from hierarchy's custom format for data to usable format\n        _nodes.forEach(node => {\n            maxDepth = node.depth > maxDepth ? node.depth : maxDepth; //finding max depth of tree\n            nodes.push(node);\n        });\n        // counting the number of leaf nodes and assigning max depth\n        //  to nodes that do not have children to flush all the leave nodes\n        nodes.forEach(node => {\n            if (!node.children) {\n                //&& !node._children\n                numLeaves += 1;\n                node.depth = maxDepth; // if a leaf has no child it would be assigned max depth\n            }\n        });\n\n        leafHeight = layoutMode === \"Circular\" ? height / numLeaves : leafHeight;\n        leafIndex = 0;\n        layout(nodes[0], maxDepth, leafHeight, null);\n\n        return nodes;\n    };\n\n    /**\n     * -- Function with side effect of adding x0, y0 to all child; take in the root as starting point\n     *  assuming that the leave nodes would be sorted in presented order\n     *          horizontal(y0) is calculated according to (= evo dist X depth separation) from their parent\n     *          vertical (x0) - if leave node: find its order in all of the  leave node === node.id,\n     *                              then multiply by verticalSeparation\n     *                  - if parent node: is place in the mid point all of its children nodes\n     * -- The layout will first calculate the y0 field going towards the leaves, and x0 when returning\n     */\n    function layout(node, maxDepth, vertSeparation, parent) {\n        var children = node.children;\n        var sumChildVertSeparation = 0;\n\n        // calculation of node's dist from parents, going down.\n        var dist = node.dist || defaultDist;\n        dist = dist > 1 ? 1 : dist; // We constrain all dist to be less than one\n        node.dist = dist;\n        if (parent !== null) {\n            node.y0 = parent.y0 + dist * depthSeparation;\n        } else {\n            //root node\n            node.y0 = maxTextWidth;\n        }\n\n        // if a node have no children, we will treat it as a leaf and start laying it out first\n        if (!children) {\n            node.x0 = leafIndex * vertSeparation;\n            leafIndex += 1;\n        } else {\n            // if it has children, we will visit all its children and calculate its position from its children\n            children.forEach(child => {\n                child.parent = node;\n                sumChildVertSeparation += layout(child, maxDepth, vertSeparation, node);\n            });\n            node.x0 = sumChildVertSeparation / children.length;\n        }\n\n        // adding properties to the newly created node\n        node.x = node.x0;\n        node.y = node.y0;\n        return node.x0;\n    }\n    return self;\n}\n\n/**\n * -- PhyloTree Model --\n */\nvar PhyloTree = visualization_mod.Visualization.extend({\n    defaults: {\n        layout: \"Linear\",\n        separation: 250, // px dist between nodes of different depth to represent 1 evolutionary until\n        leafHeight: 18,\n        type: \"phyloviz\", // visualization type\n        title: _l(\"Title\"),\n        scaleFactor: 1,\n        translate: [0, 0],\n        fontSize: 12, //fontSize of node label\n        selectedNode: null,\n        nodeAttrChangedTime: 0\n    },\n\n    initialize: function(options) {\n        this.set(\n            \"dataset\",\n            new Dataset({\n                id: options.dataset_id\n            })\n        );\n    },\n\n    root: {}, // Root has to be its own independent object because it is not part of the viz_config\n\n    /**\n     * Mechanism to expand or contract a single node. Expanded nodes have a children list, while for\n     * contracted nodes the list is stored in _children. Nodes with their children data stored in _children will not\n     * have their children rendered.\n     */\n    toggle: function(d) {\n        if (typeof d === \"undefined\") {\n            return;\n        }\n        if (d.children) {\n            d._children = d.children;\n            d.children = null;\n        } else {\n            d.children = d._children;\n            d._children = null;\n        }\n    },\n\n    /**\n     *  Contracts the phylotree to a single node by repeatedly calling itself to place all the list\n     *  of children under _children.\n     */\n    toggleAll: function(d) {\n        if (d.children && d.children.length !== 0) {\n            d.children.forEach(this.toggleAll);\n            this.toggle(d);\n        }\n    },\n\n    /**\n     *  Return the data of the tree. Used for preserving state.\n     */\n    getData: function() {\n        return this.root;\n    },\n\n    /**\n     * Overriding the default save mechanism to do some clean of circular reference of the\n     * phyloTree and to include phyloTree in the saved json\n     */\n    save: function() {\n        var root = this.root;\n        cleanTree(root);\n        //this.set(\"root\", root);\n\n        function cleanTree(node) {\n            // we need to remove parent to delete circular reference\n            delete node.parent;\n\n            // removing unnecessary attributes\n            if (node._selected) {\n                delete node._selected;\n            }\n\n            if (node.children) {\n                node.children.forEach(cleanTree);\n            }\n            if (node._children) {\n                node._children.forEach(cleanTree);\n            }\n        }\n\n        var config = $.extend(true, {}, this.attributes);\n        config.selectedNode = null;\n\n        show_message(\"Saving to Galaxy\", \"progress\");\n\n        return $.ajax({\n            url: this.url(),\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                config: JSON.stringify(config),\n                type: \"phyloviz\"\n            },\n            success: function(res) {\n                hide_modal();\n            }\n        });\n    }\n});\n\n// -- Views --\n/**\n *  Stores the default variable for setting up the visualization\n */\nvar PhylovizLayoutBase = Backbone.View.extend({\n    defaults: {\n        nodeRadius: 4.5 // radius of each node in the diagram\n    },\n\n    /**\n     *  Common initialization in layouts\n     */\n    stdInit: function(options) {\n        var self = this;\n        self.model.on(\n            \"change:separation change:leafHeight change:fontSize change:nodeAttrChangedTime\",\n            self.updateAndRender,\n            self\n        );\n\n        self.vis = options.vis;\n        self.i = 0;\n        self.maxDepth = -1; // stores the max depth of the tree\n\n        self.width = options.width;\n        self.height = options.height;\n    },\n\n    /**\n     *  Updates the visualization whenever there are changes in the expansion and contraction of nodes\n     *  AND possibly when the tree is edited.\n     */\n    updateAndRender: function(source) {\n        var self = this;\n        source = source || self.model.root;\n\n        self.renderNodes(source);\n        self.renderLinks(source);\n        self.addTooltips();\n    },\n\n    /**\n     * Renders the links for the visualization.\n     */\n    renderLinks: function(source) {\n        var self = this;\n        var link = self.vis.selectAll(\"g.completeLink\").data(self.tree.links(self.nodes), d => d.target.id);\n\n        var calcalateLinePos = d => {\n            // position of the source node <=> starting location of the line drawn\n            d.pos0 = `${d.source.y0} ${d.source.x0}`;\n            // position where the line makes a right angle bend\n            d.pos1 = `${d.source.y0} ${d.target.x0}`;\n            // point where the horizontal line becomes a dotted line\n            d.pos2 = `${d.target.y0} ${d.target.x0}`;\n        };\n\n        var linkEnter = link\n            .enter()\n            .insert(\"svg:g\", \"g.node\")\n            .attr(\"class\", \"completeLink\");\n\n        linkEnter\n            .append(\"svg:path\")\n            .attr(\"class\", \"link\")\n            .attr(\"d\", d => {\n                calcalateLinePos(d);\n                return `M ${d.pos0} L ${d.pos1}`;\n            });\n\n        var linkUpdate = link.transition().duration(500);\n\n        linkUpdate.select(\"path.link\").attr(\"d\", d => {\n            calcalateLinePos(d);\n            return `M ${d.pos0} L ${d.pos1} L ${d.pos2}`;\n        });\n\n        link.exit().remove();\n    },\n\n    // User Interaction methods below\n\n    /**\n     *  Displays the information for editing\n     */\n    selectNode: function(node) {\n        var self = this;\n        d3.selectAll(\"g.node\").classed(\"selectedHighlight\", d => {\n            if (node.id === d.id) {\n                if (node._selected) {\n                    // for de=selecting node.\n                    delete node._selected;\n                    return false;\n                } else {\n                    node._selected = true;\n                    return true;\n                }\n            }\n            return false;\n        });\n\n        self.model.set(\"selectedNode\", node);\n        $(\"#phyloVizSelectedNodeName\").val(node.name);\n        $(\"#phyloVizSelectedNodeDist\").val(node.dist);\n        $(\"#phyloVizSelectedNodeAnnotation\").val(node.annotation || \"\");\n    },\n\n    /**\n     *  Creates bootstrap tooltip for the visualization. Has to be called repeatedly due to newly generated\n     *  enterNodes\n     */\n    addTooltips: function() {\n        $(\".tooltip\").remove(); //clean up tooltip, just in case its listeners are removed by d3\n        $(\".node\")\n            .attr(\"data-original-title\", function() {\n                var d = this.__data__;\n                var annotation = d.annotation || \"None\";\n                return d\n                    ? `${d.name ? `${d.name}<br/>` : \"\"}Dist: ${d.dist} <br/>Annotation1: ${annotation}${\n                          d.bootstrap ? `<br/>Confidence level: ${Math.round(100 * d.bootstrap)}` : \"\"\n                      }`\n                    : \"\";\n            })\n            .tooltip({ placement: \"top\", trigger: \"hover\" });\n    }\n});\n\n/**\n * Linea layout class of Phyloviz, is responsible for rendering the nodes\n * calls PhyloTreeLayout to determine the positions of the nodes\n */\nvar PhylovizLinearView = PhylovizLayoutBase.extend({\n    initialize: function(options) {\n        // Default values of linear layout\n        var self = this;\n        self.margins = options.margins;\n        self.layoutMode = \"Linear\";\n\n        self.stdInit(options);\n\n        self.layout();\n        self.updateAndRender(self.model.root);\n    },\n\n    /**\n     * Creates the basic layout of a linear tree by precalculating fixed values.\n     * One of calculations are also made here\n     */\n    layout: function() {\n        var self = this;\n        self.tree = new PhyloTreeLayout().layoutMode(\"Linear\");\n        self.diagonal = d3.svg.diagonal().projection(d => [d.y, d.x]);\n    },\n\n    /**\n     * Renders the nodes base on Linear layout.\n     */\n    renderNodes: function(source) {\n        var self = this;\n        var fontSize = `${self.model.get(\"fontSize\")}px`;\n\n        // assigning properties from models\n        self.tree.separation(self.model.get(\"separation\")).leafHeight(self.model.get(\"leafHeight\"));\n\n        var duration = 500;\n\n        var nodes = self.tree.separation(self.model.get(\"separation\")).nodes(self.model.root);\n\n        var node = self.vis.selectAll(\"g.node\").data(nodes, d => d.name + d.id || (d.id = ++self.i));\n\n        // These variables has to be passed into update links which are in the base methods\n        self.nodes = nodes;\n        self.duration = duration;\n\n        // ------- D3 ENTRY --------\n        // Enter any new nodes at the parent's previous position.\n        var nodeEnter = node\n            .enter()\n            .append(\"svg:g\")\n            .attr(\"class\", \"node\")\n            .on(\"dblclick\", () => {\n                d3.event.stopPropagation();\n            })\n            .on(\"click\", d => {\n                if (d3.event.altKey) {\n                    self.selectNode(d); // display info if alt is pressed\n                } else {\n                    if (d.children && d.children.length === 0) {\n                        return;\n                    } // there is no need to toggle leaves\n                    self.model.toggle(d); // contract/expand nodes at data level\n                    self.updateAndRender(d); // re-render the tree\n                }\n            });\n        //TODO: newick and phyloxml return arrays. where should this go (client (here, else), server)?\n        if (toString.call(source) === \"[object Array]\") {\n            // if d is an array, replate with the first object (newick, phyloxml)\n            source = source[0];\n        }\n        nodeEnter.attr(\"transform\", d => `translate(${source.y0},${source.x0})`);\n\n        nodeEnter\n            .append(\"svg:circle\")\n            .attr(\"r\", 1e-6)\n            .style(\"fill\", d => (d._children ? \"lightsteelblue\" : \"#fff\"));\n\n        nodeEnter\n            .append(\"svg:text\")\n            .attr(\"class\", \"nodeLabel\")\n            .attr(\"x\", d => (d.children || d._children ? -10 : 10))\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", d => (d.children || d._children ? \"end\" : \"start\"))\n            .style(\"fill-opacity\", 1e-6);\n\n        // ------- D3 TRANSITION --------\n        // Transition nodes to their new position.\n        var nodeUpdate = node.transition().duration(duration);\n\n        nodeUpdate.attr(\"transform\", d => `translate(${d.y},${d.x})`);\n\n        nodeUpdate\n            .select(\"circle\")\n            .attr(\"r\", self.defaults.nodeRadius)\n            .style(\"fill\", d => (d._children ? \"lightsteelblue\" : \"#fff\"));\n\n        nodeUpdate\n            .select(\"text\")\n            .style(\"fill-opacity\", 1)\n            .style(\"font-size\", fontSize)\n            .text(d => (d.name && d.name !== \"\" ? d.name : d.bootstrap ? Math.round(100 * d.bootstrap) : \"\"));\n\n        // ------- D3 EXIT --------\n        // Transition exiting nodes to the parent's new position.\n        var nodeExit = node\n            .exit()\n            .transition()\n            .duration(duration)\n            .remove();\n\n        nodeExit.select(\"circle\").attr(\"r\", 1e-6);\n\n        nodeExit.select(\"text\").style(\"fill-opacity\", 1e-6);\n\n        // Stash the old positions for transition.\n        nodes.forEach(d => {\n            d.x0 = d.x; // we need the x0, y0 for parents with children\n            d.y0 = d.y;\n        });\n    }\n});\n\nexport var PhylovizView = Backbone.View.extend({\n    className: \"phyloviz\",\n\n    initialize: function(options) {\n        var self = this;\n        // -- Default values of the vis\n        self.MIN_SCALE = 0.05; //for zooming\n        self.MAX_SCALE = 5;\n        self.MAX_DISPLACEMENT = 500;\n        self.margins = [10, 60, 10, 80];\n\n        self.width = $(\"#PhyloViz\").width();\n        self.height = $(\"#PhyloViz\").height();\n        self.radius = self.width;\n        self.data = options.data;\n\n        // -- Events Phyloviz view responses to\n        $(window).resize(() => {\n            self.width = $(\"#PhyloViz\").width();\n            self.height = $(\"#PhyloViz\").height();\n            self.render();\n        });\n\n        // -- Create phyloTree model\n        self.phyloTree = new PhyloTree(options.config);\n        self.phyloTree.root = self.data;\n\n        // -- Set up UI functions of main view\n        self.zoomFunc = d3.behavior.zoom().scaleExtent([self.MIN_SCALE, self.MAX_SCALE]);\n        self.zoomFunc.translate(self.phyloTree.get(\"translate\"));\n        self.zoomFunc.scale(self.phyloTree.get(\"scaleFactor\"));\n\n        // -- set up header buttons, search and settings menu\n        self.navMenu = new HeaderButtons(self);\n        self.settingsMenu = new SettingsMenu({\n            phyloTree: self.phyloTree\n        });\n        self.nodeSelectionView = new NodeSelectionView({\n            phyloTree: self.phyloTree\n        });\n        self.search = new PhyloVizSearch();\n\n        // using settimeout to call the zoomAndPan function according to the stored attributes in viz_config\n        setTimeout(() => {\n            self.zoomAndPan();\n        }, 1000);\n    },\n\n    render: function() {\n        // -- Creating helper function for vis. --\n        var self = this;\n        $(\"#PhyloViz\").empty();\n\n        // -- Layout viz. --\n        self.mainSVG = d3\n            .select(\"#PhyloViz\")\n            .append(\"svg:svg\")\n            .attr(\"width\", self.width)\n            .attr(\"height\", self.height)\n            .attr(\"pointer-events\", \"all\")\n            .call(\n                self.zoomFunc.on(\"zoom\", () => {\n                    self.zoomAndPan();\n                })\n            );\n\n        self.boundingRect = self.mainSVG\n            .append(\"svg:rect\")\n            .attr(\"class\", \"boundingRect\")\n            .attr(\"width\", self.width)\n            .attr(\"height\", self.height)\n            .attr(\"stroke\", \"black\")\n            .attr(\"fill\", \"white\");\n\n        self.vis = self.mainSVG.append(\"svg:g\").attr(\"class\", \"vis\");\n\n        self.layoutOptions = {\n            model: self.phyloTree,\n            width: self.width,\n            height: self.height,\n            vis: self.vis,\n            margins: self.margins\n        };\n\n        // -- Creating Title\n        $(\"#title\").text(`Phylogenetic Tree from ${self.phyloTree.get(\"title\")}:`);\n\n        // -- Create Linear view instance --\n        new PhylovizLinearView(self.layoutOptions);\n    },\n\n    /**\n     * Function to zoom and pan the svg element which the entire tree is contained within\n     * Uses d3.zoom events, and extend them to allow manual updates and keeping states in model\n     */\n    zoomAndPan: function(event) {\n        var zoomParams;\n        var translateParams;\n        if (typeof event !== \"undefined\") {\n            zoomParams = event.zoom;\n            translateParams = event.translate;\n        }\n\n        var self = this;\n        var scaleFactor = self.zoomFunc.scale();\n        var translationCoor = self.zoomFunc.translate();\n        var zoomStatement = \"\";\n        var translateStatement = \"\";\n\n        // Do manual scaling.\n        switch (zoomParams) {\n            case \"reset\":\n                scaleFactor = 1.0;\n                translationCoor = [0, 0];\n                break;\n            case \"+\":\n                scaleFactor *= 1.1;\n                break;\n            case \"-\":\n                scaleFactor *= 0.9;\n                break;\n            default:\n                if (typeof zoomParams === \"number\") {\n                    scaleFactor = zoomParams;\n                } else if (d3.event !== null) {\n                    scaleFactor = d3.event.scale;\n                }\n        }\n        if (scaleFactor < self.MIN_SCALE || scaleFactor > self.MAX_SCALE) {\n            return;\n        }\n        self.zoomFunc.scale(scaleFactor); //update scale Factor\n        zoomStatement = `translate(${self.margins[3]},${self.margins[0]}) scale(${scaleFactor})`;\n\n        // Do manual translation.\n        if (d3.event !== null) {\n            translateStatement = `translate(${d3.event.translate})`;\n        } else {\n            if (typeof translateParams !== \"undefined\") {\n                var x = translateParams.split(\",\")[0];\n                var y = translateParams.split(\",\")[1];\n                if (!isNaN(x) && !isNaN(y)) {\n                    translationCoor = [translationCoor[0] + parseFloat(x), translationCoor[1] + parseFloat(y)];\n                }\n            }\n            self.zoomFunc.translate(translationCoor); // update zoomFunc\n            translateStatement = `translate(${translationCoor})`;\n        }\n\n        self.phyloTree.set(\"scaleFactor\", scaleFactor);\n        self.phyloTree.set(\"translate\", translationCoor);\n        //refers to the view that we are actually zooming\n        self.vis.attr(\"transform\", translateStatement + zoomStatement);\n    },\n\n    /**\n     * Primes the Ajax URL to load another Nexus tree\n     */\n    reloadViz: function() {\n        var self = this;\n        var treeIndex = $(\"#phylovizNexSelector :selected\").val();\n        $.getJSON(\n            self.phyloTree.get(\"dataset\").url(),\n            {\n                tree_index: treeIndex,\n                data_type: \"raw_data\"\n            },\n            packedJson => {\n                self.data = packedJson.data;\n                self.config = packedJson;\n                self.render();\n            }\n        );\n    }\n});\n\nvar HeaderButtons = Backbone.View.extend({\n    initialize: function(phylovizView) {\n        var self = this;\n        self.phylovizView = phylovizView;\n\n        // Clean up code - if the class initialized more than once\n        $(\"#panelHeaderRightBtns\").empty();\n        $(\"#phyloVizNavBtns\").empty();\n        $(\"#phylovizNexSelector\").off();\n\n        self.initNavBtns();\n        self.initRightHeaderBtns();\n\n        // Initial a tree selector in the case of nexus\n        $(\"#phylovizNexSelector\")\n            .off()\n            .on(\"change\", () => {\n                self.phylovizView.reloadViz();\n            });\n    },\n\n    initRightHeaderBtns: function() {\n        var self = this;\n\n        var rightMenu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                {\n                    icon_class: \"gear\",\n                    title: _l(\"PhyloViz Settings\"),\n                    on_click: function() {\n                        $(\"#SettingsMenu\").show();\n                        self.settingsMenu.updateUI();\n                    }\n                },\n                {\n                    icon_class: \"disk\",\n                    title: _l(\"Save visualization\"),\n                    on_click: function() {\n                        var nexSelected = $(\"#phylovizNexSelector option:selected\").text();\n                        if (nexSelected) {\n                            self.phylovizView.phyloTree.set(\"title\", nexSelected);\n                        }\n                        self.phylovizView.phyloTree.save();\n                    }\n                },\n                {\n                    icon_class: \"chevron-expand\",\n                    title: \"Search / Edit Nodes\",\n                    on_click: function() {\n                        $(\"#nodeSelectionView\").show();\n                    }\n                },\n                {\n                    icon_class: \"information\",\n                    title: _l(\"Phyloviz Help\"),\n                    on_click: function() {\n                        window.open(\"https://galaxyproject.org/learn/visualization/phylogenetic-tree/\");\n                        // https://docs.google.com/document/d/1AXFoJgEpxr21H3LICRs3EyMe1B1X_KFPouzIgrCz3zk/edit\n                    }\n                }\n            ],\n            {\n                tooltip_config: { placement: \"bottom\" }\n            }\n        );\n        $(\"#panelHeaderRightBtns\").append(rightMenu.$el);\n    },\n\n    initNavBtns: function() {\n        var self = this;\n\n        var navMenu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                {\n                    icon_class: \"zoom-in\",\n                    title: _l(\"Zoom in\"),\n                    on_click: function() {\n                        self.phylovizView.zoomAndPan({ zoom: \"+\" });\n                    }\n                },\n                {\n                    icon_class: \"zoom-out\",\n                    title: _l(\"Zoom out\"),\n                    on_click: function() {\n                        self.phylovizView.zoomAndPan({ zoom: \"-\" });\n                    }\n                },\n                {\n                    icon_class: \"arrow-circle\",\n                    title: \"Reset Zoom/Pan\",\n                    on_click: function() {\n                        self.phylovizView.zoomAndPan({\n                            zoom: \"reset\"\n                        });\n                    }\n                }\n            ],\n            {\n                tooltip_config: { placement: \"bottom\" }\n            }\n        );\n\n        $(\"#phyloVizNavBtns\").append(navMenu.$el);\n    }\n});\n\nvar SettingsMenu = UserMenuBase.extend({\n    className: \"Settings\",\n\n    initialize: function(options) {\n        // settings needs to directly interact with the phyloviz model so it will get access to it.\n        var self = this;\n        self.phyloTree = options.phyloTree;\n        self.el = $(\"#SettingsMenu\");\n        self.inputs = {\n            separation: $(\"#phyloVizTreeSeparation\"),\n            leafHeight: $(\"#phyloVizTreeLeafHeight\"),\n            fontSize: $(\"#phyloVizTreeFontSize\")\n        };\n\n        //init all buttons of settings\n        $(\"#settingsCloseBtn\")\n            .off()\n            .on(\"click\", () => {\n                self.el.hide();\n            });\n        $(\"#phylovizResetSettingsBtn\")\n            .off()\n            .on(\"click\", () => {\n                self.resetToDefaults();\n            });\n        $(\"#phylovizApplySettingsBtn\")\n            .off()\n            .on(\"click\", () => {\n                self.apply();\n            });\n    },\n\n    /**\n     * Applying user values to phylotree model.\n     */\n    apply: function() {\n        var self = this;\n        if (\n            !self.isAcceptableValue(self.inputs.separation, 50, 2500) ||\n            !self.isAcceptableValue(self.inputs.leafHeight, 5, 30) ||\n            !self.isAcceptableValue(self.inputs.fontSize, 5, 20)\n        ) {\n            return;\n        }\n        $.each(self.inputs, (key, $input) => {\n            self.phyloTree.set(key, $input.val());\n        });\n    },\n    /**\n     * Called to update the values input to that stored in the model\n     */\n    updateUI: function() {\n        var self = this;\n        $.each(self.inputs, (key, $input) => {\n            $input.val(self.phyloTree.get(key));\n        });\n    },\n    /**\n     * Resets the value of the phyloTree model to its default\n     */\n    resetToDefaults: function() {\n        $(\".tooltip\").remove(); // just in case the tool tip was not removed\n        var self = this;\n        $.each(self.phyloTree.defaults, (key, value) => {\n            self.phyloTree.set(key, value);\n        });\n        self.updateUI();\n    },\n\n    render: function() {}\n});\n\n/**\n * View for inspecting node properties and editing them\n */\nvar NodeSelectionView = UserMenuBase.extend({\n    className: \"Settings\",\n\n    initialize: function(options) {\n        var self = this;\n        self.el = $(\"#nodeSelectionView\");\n        self.phyloTree = options.phyloTree;\n\n        self.UI = {\n            enableEdit: $(\"#phylovizEditNodesCheck\"),\n            saveChanges: $(\"#phylovizNodeSaveChanges\"),\n            cancelChanges: $(\"#phylovizNodeCancelChanges\"),\n            name: $(\"#phyloVizSelectedNodeName\"),\n            dist: $(\"#phyloVizSelectedNodeDist\"),\n            annotation: $(\"#phyloVizSelectedNodeAnnotation\")\n        };\n\n        // temporarily stores the values in case user change their mind\n        self.valuesOfConcern = {\n            name: null,\n            dist: null,\n            annotation: null\n        };\n\n        //init UI buttons\n        $(\"#nodeSelCloseBtn\")\n            .off()\n            .on(\"click\", () => {\n                self.el.hide();\n            });\n        self.UI.saveChanges.off().on(\"click\", () => {\n            self.updateNodes();\n        });\n        self.UI.cancelChanges.off().on(\"click\", () => {\n            self.cancelChanges();\n        });\n\n        ($ => {\n            // extending jquery fxn for enabling and disabling nodes.\n            $.fn.enable = function(isEnabled) {\n                return $(this).each(function() {\n                    if (isEnabled) {\n                        $(this).removeAttr(\"disabled\");\n                    } else {\n                        $(this).attr(\"disabled\", \"disabled\");\n                    }\n                });\n            };\n        })($);\n\n        self.UI.enableEdit.off().on(\"click\", () => {\n            self.toggleUI();\n        });\n    },\n\n    /**\n     * For turning on and off the child elements\n     */\n    toggleUI: function() {\n        var self = this;\n        var checked = self.UI.enableEdit.is(\":checked\");\n\n        if (!checked) {\n            self.cancelChanges();\n        }\n\n        $.each(self.valuesOfConcern, (key, value) => {\n            self.UI[key].enable(checked);\n        });\n        if (checked) {\n            self.UI.saveChanges.show();\n            self.UI.cancelChanges.show();\n        } else {\n            self.UI.saveChanges.hide();\n            self.UI.cancelChanges.hide();\n        }\n    },\n\n    /**\n     * Reverting to previous values in case user change their minds\n     */\n    cancelChanges: function() {\n        var self = this;\n        var node = self.phyloTree.get(\"selectedNode\");\n        if (node) {\n            $.each(self.valuesOfConcern, (key, value) => {\n                self.UI[key].val(node[key]);\n            });\n        }\n    },\n\n    /**\n     * Changing the data in the underlying tree with user-specified values\n     */\n    updateNodes: function() {\n        var self = this;\n        var node = self.phyloTree.get(\"selectedNode\");\n        if (node) {\n            if (\n                !self.isAcceptableValue(self.UI.dist, 0, 1) ||\n                self.hasIllegalJsonCharacters(self.UI.name) ||\n                self.hasIllegalJsonCharacters(self.UI.annotation)\n            ) {\n                return;\n            }\n            $.each(self.valuesOfConcern, (key, value) => {\n                node[key] = self.UI[key].val();\n            });\n            self.phyloTree.set(\"nodeAttrChangedTime\", new Date());\n        } else {\n            alert(\"No node selected\");\n        }\n    }\n});\n\n/**\n * Initializes the search panel on phyloviz and handles its user interaction\n * It allows user to search the entire free based on some qualifer, like dist <= val.\n */\nvar PhyloVizSearch = UserMenuBase.extend({\n    initialize: function() {\n        var self = this;\n\n        $(\"#phyloVizSearchBtn\").on(\"click\", () => {\n            var searchTerm = $(\"#phyloVizSearchTerm\");\n\n            var searchConditionVal = $(\"#phyloVizSearchCondition\")\n                .val()\n                .split(\"-\");\n\n            var attr = searchConditionVal[0];\n            var condition = searchConditionVal[1];\n            self.hasIllegalJsonCharacters(searchTerm);\n\n            if (attr === \"dist\") {\n                self.isAcceptableValue(searchTerm, 0, 1);\n            }\n            self.searchTree(attr, condition, searchTerm.val());\n        });\n    },\n\n    /**\n     * Searches the entire tree and will highlight the nodes that match the condition in green\n     */\n    searchTree: function(attr, condition, val) {\n        d3.selectAll(\"g.node\").classed(\"searchHighlight\", d => {\n            var attrVal = d[attr];\n            if (typeof attrVal !== \"undefined\" && attrVal !== null) {\n                if (attr === \"dist\") {\n                    switch (condition) {\n                        case \"greaterEqual\":\n                            return attrVal >= +val;\n                        case \"lesserEqual\":\n                            return attrVal <= +val;\n                        default:\n                            return;\n                    }\n                } else if (attr === \"name\" || attr === \"annotation\") {\n                    return attrVal.toLowerCase().indexOf(val.toLowerCase()) !== -1;\n                }\n            }\n        });\n    }\n});\n","/**\n * Visualization and components for Sweepster, a visualization for exploring a tool's parameter space via\n * genomic visualization.\n */\n\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport _l from \"utils/localization\";\nimport * as d3 from \"d3\";\nimport visualization from \"viz/visualization\";\nimport tracks from \"viz/trackster/tracks\";\nimport tools from \"mvc/tool/tools\";\nimport { Dataset } from \"mvc/dataset/data\";\nimport config from \"utils/config\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\nimport { make_popupmenu } from \"ui/popupmenu\";\nimport { show_modal, hide_modal } from \"layout/modal\";\n\n/**\n * A collection of tool input settings. Object is useful for keeping a list of settings\n * for future use without changing the input's value and for preserving inputs order.\n */\nvar ToolInputsSettings = Backbone.Model.extend({\n    defaults: {\n        inputs: null,\n        values: null\n    }\n});\n\n/**\n * Tree for a tool's parameters.\n */\nvar ToolParameterTree = Backbone.Model.extend({\n    defaults: {\n        tool: null,\n        tree_data: null\n    },\n\n    initialize: function(options) {\n        // Set up tool parameters to work with tree.\n        var self = this;\n        this.get(\"tool\")\n            .get(\"inputs\")\n            .each(input => {\n                // Listen for changes to input's attributes.\n                input.on(\n                    \"change:min change:max change:num_samples\",\n                    input => {\n                        if (input.get(\"in_ptree\")) {\n                            self.set_tree_data();\n                        }\n                    },\n                    self\n                );\n                input.on(\n                    \"change:in_ptree\",\n                    input => {\n                        if (input.get(\"in_ptree\")) {\n                            self.add_param(input);\n                        } else {\n                            self.remove_param(input);\n                        }\n                        self.set_tree_data();\n                    },\n                    self\n                );\n            });\n\n        // If there is a config, use it.\n        if (options.config) {\n            _.each(options.config, input_config => {\n                var input = self\n                    .get(\"tool\")\n                    .get(\"inputs\")\n                    .find(input => input.get(\"name\") === input_config.name);\n                self.add_param(input);\n                input.set(input_config);\n            });\n        }\n    },\n\n    add_param: function(param) {\n        // If parameter already present, do not add it.\n        if (param.get(\"ptree_index\")) {\n            return;\n        }\n\n        param.set(\"in_ptree\", true);\n        param.set(\"ptree_index\", this.get_tree_params().length);\n    },\n\n    remove_param: function(param) {\n        // Remove param from tree.\n        param.set(\"in_ptree\", false);\n        param.set(\"ptree_index\", null);\n\n        // Update ptree indices for remaining params.\n        _(this.get_tree_params()).each((input, index) => {\n            // +1 to use 1-based indexing.\n            input.set(\"ptree_index\", index + 1);\n        });\n    },\n\n    /**\n     * Sets tree data using tool's inputs.\n     */\n    set_tree_data: function() {\n        // Get samples for each parameter.\n        var params_samples = _.map(this.get_tree_params(), param => ({\n            param: param,\n            samples: param.get_samples()\n        }));\n        var node_id = 0;\n\n        var // Creates tree data recursively.\n            create_tree_data = (params_samples, index) => {\n                var param_samples = params_samples[index],\n                    param = param_samples.param,\n                    settings = param_samples.samples;\n\n                // Create leaves when last parameter setting is reached.\n                if (params_samples.length - 1 === index) {\n                    return _.map(settings, setting => ({\n                        id: node_id++,\n                        name: setting,\n                        param: param,\n                        value: setting\n                    }));\n                }\n\n                // Recurse to handle other parameters.\n                return _.map(settings, setting => ({\n                    id: node_id++,\n                    name: setting,\n                    param: param,\n                    value: setting,\n                    children: create_tree_data(params_samples, index + 1)\n                }));\n            };\n\n        this.set(\"tree_data\", {\n            name: \"Root\",\n            id: node_id++,\n            children: params_samples.length !== 0 ? create_tree_data(params_samples, 0) : null\n        });\n    },\n\n    get_tree_params: function() {\n        // Filter and sort parameters to get list in tree.\n        return _(\n            this.get(\"tool\")\n                .get(\"inputs\")\n                .where({ in_ptree: true })\n        ).sortBy(input => input.get(\"ptree_index\"));\n    },\n\n    /**\n     * Returns number of leaves in tree.\n     */\n    get_num_leaves: function() {\n        return this.get_tree_params().reduce((memo, param) => memo * param.get_samples().length, 1);\n    },\n\n    /**\n     * Returns array of ToolInputsSettings objects based on a node and its subtree.\n     */\n    get_node_settings: function(target_node) {\n        // -- Get fixed settings from tool and parent nodes.\n\n        // Start with tool's settings.\n        var fixed_settings = this.get(\"tool\").get_inputs_dict();\n\n        // Get fixed settings using node's parents.\n        var cur_node = target_node.parent;\n        if (cur_node) {\n            while (cur_node.depth !== 0) {\n                fixed_settings[cur_node.param.get(\"name\")] = cur_node.value;\n                cur_node = cur_node.parent;\n            }\n        }\n\n        // Walk subtree starting at clicked node to get full list of settings.\n        var self = this;\n\n        var get_settings = (node, settings) => {\n            // Add setting for this node. Root node does not have a param,\n            // however.\n            if (node.param) {\n                settings[node.param.get(\"name\")] = node.value;\n            }\n\n            if (!node.children) {\n                // At leaf node, so return settings.\n                return new ToolInputsSettings({\n                    inputs: self.get(\"tool\").get(\"inputs\"),\n                    values: settings\n                });\n            } else {\n                // At interior node: return list of subtree settings.\n                return _.flatten(_.map(node.children, c => get_settings(c, _.clone(settings))));\n            }\n        };\n\n        var all_settings = get_settings(target_node, fixed_settings);\n\n        // If user clicked on leaf, settings is a single dict. Convert to array for simplicity.\n        if (!_.isArray(all_settings)) {\n            all_settings = [all_settings];\n        }\n\n        return all_settings;\n    },\n\n    /**\n     * Returns all nodes connected a particular node; this includes parents and children of the node.\n     */\n    get_connected_nodes: function(node) {\n        var get_subtree_nodes = a_node => {\n            if (!a_node.children) {\n                return a_node;\n            } else {\n                // At interior node: return subtree nodes.\n                return _.flatten([a_node, _.map(a_node.children, c => get_subtree_nodes(c))]);\n            }\n        };\n\n        // Get node's parents.\n        var parents = [];\n\n        var cur_parent = node.parent;\n        while (cur_parent) {\n            parents.push(cur_parent);\n            cur_parent = cur_parent.parent;\n        }\n\n        return _.flatten([parents, get_subtree_nodes(node)]);\n    },\n\n    /**\n     * Returns the leaf that corresponds to a settings collection.\n     */\n    get_leaf: function(settings) {\n        var cur_node = this.get(\"tree_data\");\n\n        var find_child = children => _.find(children, child => settings[child.param.get(\"name\")] === child.value);\n\n        while (cur_node.children) {\n            cur_node = find_child(cur_node.children);\n        }\n        return cur_node;\n    },\n\n    /**\n     * Returns a list of parameters used in tree.\n     */\n    toJSON: function() {\n        // FIXME: returning and jsonifying complete param causes trouble on the server side,\n        // so just use essential attributes for now.\n        return this.get_tree_params().map(param => ({\n            name: param.get(\"name\"),\n            min: param.get(\"min\"),\n            max: param.get(\"max\"),\n            num_samples: param.get(\"num_samples\")\n        }));\n    }\n});\n\nvar SweepsterTrack = Backbone.Model.extend({\n    defaults: {\n        track: null,\n        mode: \"Pack\",\n        settings: null,\n        regions: null\n    },\n\n    initialize: function(options) {\n        this.set(\"regions\", options.regions);\n        if (options.track) {\n            // FIXME: find a better way to deal with needed URLs:\n            var track_config = _.extend(\n                {\n                    data_url: `${getAppRoot()}dummy1`,\n                    converted_datasets_state_url: `${getAppRoot()}dummy2`\n                },\n                options.track\n            );\n            this.set(\"track\", tracks.object_from_template(track_config, {}, null));\n        }\n    },\n\n    same_settings: function(a_track) {\n        var this_settings = this.get(\"settings\");\n        var other_settings = a_track.get(\"settings\");\n        for (var prop in this_settings) {\n            if (!other_settings[prop] || this_settings[prop] !== other_settings[prop]) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    toJSON: function() {\n        return {\n            track: this.get(\"track\").to_dict(),\n            settings: this.get(\"settings\"),\n            regions: this.get(\"regions\")\n        };\n    }\n});\n\nvar TrackCollection = Backbone.Collection.extend({\n    model: SweepsterTrack\n});\n\n/**\n * Sweepster visualization model.\n */\nexport var SweepsterVisualization = visualization.Visualization.extend({\n    defaults: _.extend({}, visualization.Visualization.prototype.defaults, {\n        dataset: null,\n        tool: null,\n        parameter_tree: null,\n        regions: null,\n        tracks: null,\n        default_mode: \"Pack\"\n    }),\n\n    initialize: function(options) {\n        this.set(\"dataset\", new Dataset(options.dataset));\n        this.set(\"tool\", new tools.Tool(options.tool));\n        this.set(\"regions\", new visualization.GenomeRegionCollection(options.regions));\n        this.set(\"tracks\", new TrackCollection(options.tracks));\n\n        var tool_with_samplable_inputs = this.get(\"tool\");\n        this.set(\"tool_with_samplable_inputs\", tool_with_samplable_inputs);\n        // Remove complex parameters for now.\n        tool_with_samplable_inputs.remove_inputs([\"data\", \"hidden_data\", \"conditional\", \"text\"]);\n\n        this.set(\n            \"parameter_tree\",\n            new ToolParameterTree({\n                tool: tool_with_samplable_inputs,\n                config: options.tree_config\n            })\n        );\n    },\n\n    add_track: function(track) {\n        this.get(\"tracks\").add(track);\n    },\n\n    toJSON: function() {\n        return {\n            id: this.get(\"id\"),\n            title: `Parameter exploration for dataset '${this.get(\"dataset\").get(\"name\")}'`,\n            type: \"sweepster\",\n            dataset_id: this.get(\"dataset\").id,\n            tool_id: this.get(\"tool\").id,\n            regions: this.get(\"regions\").toJSON(),\n            tree_config: this.get(\"parameter_tree\").toJSON(),\n            tracks: this.get(\"tracks\").toJSON()\n        };\n    }\n});\n\n/**\n * --- Views ---\n */\n\n/**\n * Sweepster track view.\n */\nvar SweepsterTrackView = Backbone.View.extend({\n    tagName: \"tr\",\n\n    TILE_LEN: 250,\n\n    initialize: function(options) {\n        this.canvas_manager = options.canvas_manager;\n        this.render();\n        this.model.on(\"change:track change:mode\", this.draw_tiles, this);\n    },\n\n    render: function() {\n        // Render settings icon and popup.\n        // TODO: use template.\n        var settings = this.model.get(\"settings\");\n\n        var values = settings.get(\"values\");\n\n        var settings_td = $(\"<td/>\")\n            .addClass(\"settings\")\n            .appendTo(this.$el);\n\n        var settings_div = $(\"<div/>\")\n            .addClass(\"track-info\")\n            .hide()\n            .appendTo(settings_td);\n\n        settings_div.append(\n            $(\"<div/>\")\n                .css(\"font-weight\", \"bold\")\n                .text(\"Track Settings\")\n        );\n        settings.get(\"inputs\").each(input => {\n            settings_div.append(`${input.get(\"label\")}: ${values[input.get(\"name\")]}<br/>`);\n        });\n        var self = this;\n\n        $(\"<button/>\")\n            .appendTo(settings_div)\n            .text(\"Run on complete dataset\")\n            .click(() => {\n                settings_div.toggle();\n                self.trigger(\"run_on_dataset\", settings);\n            });\n\n        var icon_menu = mod_icon_btn.create_icon_buttons_menu([\n            {\n                title: _l(\"Settings\"),\n                icon_class: \"gear track-settings\",\n                on_click: function() {\n                    settings_div.toggle();\n                }\n            },\n            {\n                title: _l(\"Remove\"),\n                icon_class: \"cross-circle\",\n                on_click: function() {\n                    self.$el.remove();\n                    $(\".tooltip\").remove();\n                    // TODO: remove track from viz collection.\n                }\n            }\n        ]);\n        settings_td.prepend(icon_menu.$el);\n\n        // Render tile placeholders.\n        this.model.get(\"regions\").each(() => {\n            self.$el.append(\n                $(\"<td/>\")\n                    .addClass(\"tile\")\n                    .html($(\"<img/>\").attr(\"src\", `${getAppRoot()}images/loading_large_white_bg.gif`))\n            );\n        });\n\n        if (this.model.get(\"track\")) {\n            this.draw_tiles();\n        }\n    },\n\n    /**\n     * Draw tiles for regions.\n     */\n    draw_tiles: function() {\n        var self = this;\n        var track = this.model.get(\"track\");\n        var regions = this.model.get(\"regions\");\n        var tile_containers = this.$el.find(\"td.tile\");\n\n        // Do nothing if track is not defined.\n        if (!track) {\n            return;\n        }\n\n        // When data is ready, draw tiles.\n        $.when(track.data_manager.data_is_ready()).then(data_ok => {\n            // Draw tile for each region.\n            regions.each((region, index) => {\n                var resolution = region.length() / self.TILE_LEN;\n                var w_scale = 1 / resolution;\n                var mode = self.model.get(\"mode\");\n                $.when(track.data_manager.get_data(region, mode, resolution, {})).then(tile_data => {\n                    var canvas = self.canvas_manager.new_canvas();\n                    canvas.width = self.TILE_LEN;\n                    canvas.height = track.get_canvas_height(tile_data, mode, w_scale, canvas.width);\n                    track.draw_tile(tile_data, canvas.getContext(\"2d\"), mode, region, w_scale);\n                    $(tile_containers[index])\n                        .empty()\n                        .append(canvas);\n                });\n            });\n        });\n    }\n});\n\n/**\n * Tool input (parameter) that enables both value and sweeping inputs. View is unusual as\n * it augments an existing input form row rather than creates a completely new HTML element.\n */\nvar ToolInputValOrSweepView = Backbone.View.extend({\n    // Template for rendering sweep inputs:\n    number_input_template:\n        '<div class=\"form-row-input sweep\">' +\n        '<input class=\"min\" type=\"text\" size=\"6\" value=\"<%= min %>\"> - ' +\n        '<input class=\"max\" type=\"text\" size=\"6\" value=\"<%= max %>\">' +\n        ' samples: <input class=\"num_samples\" type=\"text\" size=\"1\" value=\"<%= num_samples %>\">' +\n        \"</div>\",\n\n    select_input_template: '<div class=\"form-row-input sweep\"><%= options %></div>',\n\n    initialize: function(options) {\n        this.$el = options.tool_row;\n        this.render();\n    },\n\n    render: function() {\n        var input = this.model;\n        var single_input_row = this.$el.find(\".form-row-input\");\n        var sweep_inputs_row = null;\n\n        // Update tool inputs as single input changes.\n        single_input_row.find(\":input\").change(function() {\n            input.set(\"value\", $(this).val());\n        });\n\n        // Add row for parameter sweep inputs.\n        if (input instanceof tools.IntegerToolParameter) {\n            sweep_inputs_row = $(_.template(this.number_input_template)(this.model.toJSON()));\n        } else if (input instanceof tools.SelectToolParameter) {\n            var options = _.map(this.$el.find(\"select option\"), option => $(option).val());\n\n            var options_text = options.join(\", \");\n            sweep_inputs_row = $(\n                _.template(this.select_input_template)({\n                    options: options_text\n                })\n            );\n        }\n        sweep_inputs_row.insertAfter(single_input_row);\n\n        // Add buttons for adding/removing parameter.\n        var self = this;\n\n        var menu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                {\n                    title: _l(\"Add parameter to tree\"),\n                    icon_class: \"plus-button\",\n                    on_click: function() {\n                        input.set(\"in_ptree\", true);\n                        single_input_row.hide();\n                        sweep_inputs_row.show();\n                        $(this).hide();\n                        self.$el.find(\".icon-button.toggle\").show();\n                    }\n                },\n                {\n                    title: _l(\"Remove parameter from tree\"),\n                    icon_class: \"toggle\",\n                    on_click: function() {\n                        // Remove parameter from tree params where name matches clicked paramter.\n                        input.set(\"in_ptree\", false);\n                        sweep_inputs_row.hide();\n                        single_input_row.show();\n                        $(this).hide();\n                        self.$el.find(\".icon-button.plus-button\").show();\n                    }\n                }\n            ],\n            {}\n        );\n\n        this.$el.prepend(menu.$el);\n\n        // Show/hide input rows and icons depending on whether parameter is in the tree.\n        if (input.get(\"in_ptree\")) {\n            single_input_row.hide();\n            self.$el.find(\".icon-button.plus-button\").hide();\n        } else {\n            self.$el.find(\".icon-button.toggle\").hide();\n            sweep_inputs_row.hide();\n        }\n\n        // Update input's min, max, number of samples as values change.\n        _.each([\"min\", \"max\", \"num_samples\"], attr => {\n            sweep_inputs_row.find(`.${attr}`).change(function() {\n                input.set(attr, parseFloat($(this).val()));\n            });\n        });\n    }\n});\n\nvar ToolParameterTreeDesignView = Backbone.View.extend({\n    className: \"tree-design\",\n\n    initialize: function(options) {\n        this.render();\n    },\n\n    render: function() {\n        // Start with tool form view.\n        var tool_form_view = new tools.ToolFormView({\n            model: this.model.get(\"tool\")\n        });\n        tool_form_view.render();\n        this.$el.append(tool_form_view.$el);\n\n        // Set up views for each tool input.\n        var self = this;\n\n        var inputs = self.model.get(\"tool\").get(\"inputs\");\n        this.$el\n            .find(\".form-row\")\n            .not(\".form-actions\")\n            .each(function(i) {\n                new ToolInputValOrSweepView({\n                    model: inputs.at(i),\n                    tool_row: $(this)\n                });\n            });\n    }\n});\n\n/**\n * Displays and updates parameter tree.\n */\nvar ToolParameterTreeView = Backbone.View.extend({\n    className: \"tool-parameter-tree\",\n\n    initialize: function(options) {\n        // When tree data changes, re-render.\n        this.model.on(\"change:tree_data\", this.render, this);\n    },\n\n    render: function() {\n        // Start fresh.\n        this.$el.children().remove();\n\n        var tree_params = this.model.get_tree_params();\n        if (!tree_params.length) {\n            return;\n        }\n\n        // Set width, height based on params and samples.\n        this.width = 100 * (2 + tree_params.length);\n        this.height = 15 * this.model.get_num_leaves();\n\n        var self = this;\n\n        // Layout tree.\n        var cluster = d3.layout.cluster().size([this.height, this.width - 160]);\n\n        var diagonal = d3.svg.diagonal().projection(d => [d.y, d.x]);\n\n        // Layout nodes.\n        var nodes = cluster.nodes(this.model.get(\"tree_data\"));\n\n        // Setup and add labels for tree levels.\n        var param_depths = _.uniq(_.pluck(nodes, \"y\"));\n        _.each(tree_params, (param, index) => {\n            var x = param_depths[index + 1];\n            var center_left = $(\"#center\").position().left;\n            self.$el.append(\n                $(\"<div>\")\n                    .addClass(\"label\")\n                    .text(param.get(\"label\"))\n                    .css(\"left\", x + center_left)\n            );\n        });\n\n        // Set up vis element.\n        var vis = d3\n            .select(this.$el[0])\n            .append(\"svg\")\n            .attr(\"width\", this.width)\n            .attr(\"height\", this.height + 30)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(40, 20)\");\n\n        // Draw links.\n        vis.selectAll(\"path.link\")\n            .data(cluster.links(nodes))\n            .enter()\n            .append(\"path\")\n            .attr(\"class\", \"link\")\n            .attr(\"d\", diagonal);\n\n        // Draw nodes.\n        var node = vis\n            .selectAll(\"g.node\")\n            .data(nodes)\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"node\")\n            .attr(\"transform\", d => `translate(${d.y},${d.x})`)\n            .on(\"mouseover\", a_node => {\n                var connected_node_ids = _.pluck(self.model.get_connected_nodes(a_node), \"id\");\n                // TODO: probably can use enter() to do this more easily.\n                node.filter(d => _.find(connected_node_ids, id => id === d.id) !== undefined).style(\"fill\", \"#f00\");\n            })\n            .on(\"mouseout\", () => {\n                node.style(\"fill\", \"#000\");\n            });\n\n        node.append(\"circle\").attr(\"r\", 9);\n\n        node.append(\"text\")\n            .attr(\"dx\", d => (d.children ? -12 : 12))\n            .attr(\"dy\", 3)\n            .attr(\"text-anchor\", d => (d.children ? \"end\" : \"start\"))\n            .text(d => d.name);\n    }\n});\n\n/**\n * Sweepster visualization view. View requires rendering in 3-panel setup for now.\n */\nexport var SweepsterVisualizationView = Backbone.View.extend({\n    className: \"Sweepster\",\n\n    helpText:\n        \"<div><h4>Getting Started</h4>\" +\n        \"<ol><li>Create a parameter tree by using the icons next to the tool's parameter names to add or remove parameters.\" +\n        \"<li>Adjust the tree by using parameter inputs to select min, max, and number of samples\" +\n        \"<li>Run the tool with different settings by clicking on tree nodes\" +\n        \"</ol></div>\",\n\n    initialize: function(options) {\n        this.canvas_manager = new visualization.CanvasManager(this.$el.parents(\"body\"));\n        this.tool_param_tree_view = new ToolParameterTreeView({\n            model: this.model.get(\"parameter_tree\")\n        });\n        this.track_collection_container = $(\"<table/>\").addClass(\"tracks\");\n\n        // Handle node clicks for tree data.\n        this.model.get(\"parameter_tree\").on(\"change:tree_data\", this.handle_node_clicks, this);\n\n        // Each track must have a view so it has a canvas manager.\n        var self = this;\n        this.model.get(\"tracks\").each(track => {\n            track.get(\"track\").view = self;\n        });\n\n        // Set block, reverse strand block colors; these colors will be used for all tracks.\n        this.config = config.ConfigSettingCollection.from_models_and_saved_values(\n            [\n                {\n                    key: \"name\",\n                    label: \"Name\",\n                    type: \"text\",\n                    default_value: \"\"\n                },\n                {\n                    key: \"a_color\",\n                    label: \"A Color\",\n                    type: \"color\",\n                    default_value: \"#FF0000\"\n                },\n                {\n                    key: \"c_color\",\n                    label: \"C Color\",\n                    type: \"color\",\n                    default_value: \"#00FF00\"\n                },\n                {\n                    key: \"g_color\",\n                    label: \"G Color\",\n                    type: \"color\",\n                    default_value: \"#0000FF\"\n                },\n                {\n                    key: \"t_color\",\n                    label: \"T Color\",\n                    type: \"color\",\n                    default_value: \"#FF00FF\"\n                },\n                {\n                    key: \"n_color\",\n                    label: \"N Color\",\n                    type: \"color\",\n                    default_value: \"#AAAAAA\"\n                },\n                {\n                    key: \"block_color\",\n                    label: \"Block color\",\n                    type: \"color\"\n                },\n                {\n                    key: \"reverse_strand_color\",\n                    label: \"Antisense strand color\",\n                    type: \"color\"\n                }\n            ],\n            {}\n        );\n    },\n\n    render: function() {\n        // Render tree design view in left panel.\n        var tree_design_view = new ToolParameterTreeDesignView({\n            model: this.model.get(\"parameter_tree\")\n        });\n\n        $(\"#left\").append(tree_design_view.$el);\n\n        // Render track collection container/view in right panel.\n        var self = this;\n\n        var regions = self.model.get(\"regions\");\n        var tr = $(\"<tr/>\").appendTo(this.track_collection_container);\n\n        regions.each(region => {\n            tr.append($(\"<th>\").text(region.toString()));\n        });\n        tr.children()\n            .first()\n            .attr(\"colspan\", 2);\n\n        var tracks_div = $(\"<div>\").addClass(\"tiles\");\n        $(\"#right\").append(tracks_div.append(this.track_collection_container));\n\n        self.model.get(\"tracks\").each(track => {\n            self.add_track(track);\n        });\n\n        // -- Render help and tool parameter tree in center panel. --\n\n        // Help includes text and a close button.\n        var help_div = $(this.helpText).addClass(\"help\");\n\n        var close_button = mod_icon_btn.create_icon_buttons_menu([\n            {\n                title: _l(\"Close\"),\n                icon_class: \"cross-circle\",\n                on_click: function() {\n                    $(\".tooltip\").remove();\n                    help_div.remove();\n                }\n            }\n        ]);\n\n        help_div.prepend(close_button.$el.css(\"float\", \"right\"));\n        $(\"#center\").append(help_div);\n\n        // Parameter tree:\n        this.tool_param_tree_view.render();\n        $(\"#center\").append(this.tool_param_tree_view.$el);\n\n        // Set up handler for tree node clicks.\n        this.handle_node_clicks();\n\n        // Set up visualization menu.\n        var menu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                // Save.\n                /*\n                { icon_class: 'disk--arrow', title: 'Save', on_click: function() {\n                    // Show saving dialog box\n                    show_modal(\"Saving...\", \"progress\");\n\n                    viz.save().success(function(vis_info) {\n                        hide_modal();\n                        viz.set({\n                            'id': vis_info.vis_id,\n                            'has_changes': false\n                        });\n                    })\n                    .error(function() {\n                        show_modal( \"Could Not Save\", \"Could not save visualization. Please try again later.\",\n                                    { \"Close\" : hide_modal } );\n                    });\n                } },\n                */\n                // Change track modes.\n                {\n                    icon_class: \"chevron-expand\",\n                    title: \"Set display mode\"\n                },\n                // Close viz.\n                {\n                    icon_class: \"cross-circle\",\n                    title: _l(\"Close\"),\n                    on_click: function() {\n                        window.top.location = `${getAppRoot()}visualizations/list`;\n                    }\n                }\n            ],\n            {\n                tooltip_config: { placement: \"bottom\" }\n            }\n        );\n\n        // Create mode selection popup. Mode selection changes default mode and mode for all tracks.\n        var modes = [\"Squish\", \"Pack\"];\n\n        var mode_mapping = {};\n        _.each(modes, mode => {\n            mode_mapping[mode] = () => {\n                self.model.set(\"default_mode\", mode);\n                self.model.get(\"tracks\").each(track => {\n                    track.set(\"mode\", mode);\n                });\n            };\n        });\n\n        make_popupmenu(menu.$el.find(\".chevron-expand\"), mode_mapping);\n\n        menu.$el.attr(\"style\", \"float: right\");\n        $(\"#right .unified-panel-header-inner\").append(menu.$el);\n    },\n\n    get_base_color: function(base) {\n        return this.config.get_value(`${base.toLowerCase()}_color`) || this.config.get_value(\"n_color\");\n    },\n\n    run_tool_on_dataset: function(settings) {\n        var tool = this.model.get(\"tool\");\n        var tool_name = tool.get(\"name\");\n        var dataset = this.model.get(\"dataset\");\n        tool.set_input_values(settings.get(\"values\"));\n        $.when(tool.rerun(dataset)).then(outputs => {\n            // TODO.\n        });\n\n        show_modal(\n            `Running ${tool_name} on complete dataset`,\n            `${tool_name} is running on dataset '${dataset.get(\"name\")}'. Outputs are in the dataset's history.`,\n            {\n                Ok: function() {\n                    hide_modal();\n                }\n            }\n        );\n    },\n\n    /**\n     * Add track to model and view.\n     */\n    add_track: function(pm_track) {\n        var self = this;\n        var param_tree = this.model.get(\"parameter_tree\");\n\n        // Add track to model.\n        self.model.add_track(pm_track);\n\n        var track_view = new SweepsterTrackView({\n            model: pm_track,\n            canvas_manager: self.canvas_manager\n        });\n        track_view.on(\"run_on_dataset\", self.run_tool_on_dataset, self);\n        self.track_collection_container.append(track_view.$el);\n        track_view.$el.hover(\n            () => {\n                var settings_leaf = param_tree.get_leaf(pm_track.get(\"settings\").get(\"values\"));\n                var connected_node_ids = _.pluck(param_tree.get_connected_nodes(settings_leaf), \"id\");\n\n                // TODO: can do faster with enter?\n                d3.select(self.tool_param_tree_view.$el[0])\n                    .selectAll(\"g.node\")\n                    .filter(d => _.find(connected_node_ids, id => id === d.id) !== undefined)\n                    .style(\"fill\", \"#f00\");\n            },\n            () => {\n                d3.select(self.tool_param_tree_view.$el[0])\n                    .selectAll(\"g.node\")\n                    .style(\"fill\", \"#000\");\n            }\n        );\n        return pm_track;\n    },\n\n    /**\n     * Sets up handling when tree nodes are clicked. When a node is clicked, the tool is run for each of\n     * the settings defined by the node's subtree and tracks are added for each run.\n     */\n    handle_node_clicks: function() {\n        // When node clicked in tree, run tool and add tracks to model.\n        var self = this;\n\n        var param_tree = this.model.get(\"parameter_tree\");\n        var regions = this.model.get(\"regions\");\n\n        var node = d3.select(this.tool_param_tree_view.$el[0]).selectAll(\"g.node\");\n\n        node.on(\"click\", (d, i) => {\n            // Get all settings corresponding to node.\n            var tool = self.model.get(\"tool\");\n\n            var dataset = self.model.get(\"dataset\");\n            var all_settings = param_tree.get_node_settings(d);\n            var run_jobs_deferred = $.Deferred();\n\n            // Do not allow 10+ jobs to be run.\n            if (all_settings.length >= 10) {\n                show_modal(\n                    \"Whoa there cowboy!\",\n                    `You clicked on a node to try ${self.model.get(\"tool\").get(\"name\")} with ${\n                        all_settings.length\n                    } different combinations of settings. You can only run 10 jobs at a time.`,\n                    {\n                        Ok: function() {\n                            hide_modal();\n                            run_jobs_deferred.resolve(false);\n                        }\n                    }\n                );\n            } else {\n                run_jobs_deferred.resolve(true);\n            }\n\n            // Take action when deferred resolves.\n            $.when(run_jobs_deferred).then(run_jobs => {\n                if (!run_jobs) {\n                    return;\n                }\n\n                // Create and add tracks for each settings group.\n                var new_tracks = _.map(all_settings, settings => {\n                    var pm_track = new SweepsterTrack({\n                        settings: settings,\n                        regions: regions,\n                        mode: self.model.get(\"default_mode\")\n                    });\n                    self.add_track(pm_track);\n                    return pm_track;\n                });\n\n                // For each track, run tool using track's settings and update track.\n                _.each(new_tracks, (pm_track, index) => {\n                    setTimeout(() => {\n                        // Set inputs and run tool.\n                        tool.set_input_values(pm_track.get(\"settings\").get(\"values\"));\n                        $.when(tool.rerun(dataset, regions)).then(output => {\n                            // HACKish: output is an HDA with track config attribute. To create a track\n                            // that works correctly with Backbone relational, it is necessary to\n                            // use a modified version of the track config.\n                            var dataset = output.first();\n\n                            var track_config = dataset.get(\"track_config\");\n                            // Set dataset to be the tool's output.\n                            track_config.dataset = dataset;\n                            // Set tool to null so that it is not unpacked; unpacking it messes with\n                            // the tool parameters and parameter tree.\n                            track_config.tool = null;\n\n                            track_config.prefs = self.config.to_key_value_dict();\n\n                            // Create and add track for output dataset.\n                            var track_obj = tracks.object_from_template(track_config, self, null);\n                            track_obj.init_for_tool_data();\n\n                            pm_track.set(\"track\", track_obj);\n                        });\n                    }, index * 10000);\n                });\n            });\n        });\n    }\n});\n","/**\n * Create alphabetical based two-argument comparator\n * that takes into account that Folder comes before Dataset.\n * If sort_key is not present it is set to ''.\n * @param  {str} sort_key   key to sort by\n * @param  {str} sort_order order to sort by (asc, desc)\n * @return {function} two-argument comparator function\n */\nvar generateFolderComparator = (sort_key, sort_order) => (itemA, itemB) => {\n    if (itemA.get(\"type\") === itemB.get(\"type\")) {\n        if (!itemA.has(sort_key) && !itemB.has(sort_key)) {\n            return 0;\n        } else if (!itemA.has(sort_key)) {\n            return 1;\n        } else if (!itemB.has(sort_key)) {\n            return -1;\n        }\n        if (itemA.get(sort_key).toLowerCase() > itemB.get(sort_key).toLowerCase()) {\n            return sort_order === \"asc\" ? 1 : -1;\n        }\n        if (itemB.get(sort_key).toLowerCase() > itemA.get(sort_key).toLowerCase()) {\n            return sort_order === \"asc\" ? -1 : 1;\n        }\n        return 0; // equal\n    } else {\n        if (itemA.get(\"type\") === \"folder\") {\n            return -1; // folder is always before dataset\n        }\n        return 1;\n    }\n};\n/**\n * Create alphabetical based two-argument comparator\n * @param  {str} sort_key   key to sort by\n * @param  {str} sort_order order to sort by (asc, desc)\n * @return {function} two-argument comparator function\n */\nvar generateLibraryComparator = (sort_key, sort_order) => (libraryA, libraryB) => {\n    if (libraryA.get(sort_key).toLowerCase() > libraryB.get(sort_key).toLowerCase()) {\n        return sort_order === \"asc\" ? 1 : -1;\n    }\n    if (libraryB.get(sort_key).toLowerCase() > libraryA.get(sort_key).toLowerCase()) {\n        return sort_order === \"asc\" ? -1 : 1;\n    }\n    return 0; // equal\n};\nexport default {\n    generateFolderComparator: generateFolderComparator,\n    generateLibraryComparator: generateLibraryComparator\n};\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport mod_util from \"mvc/library/library-util\";\n\n// ============================================================================\n// LIBRARY RELATED MODELS\n\nvar Library = Backbone.Model.extend({\n    urlRoot: `${getAppRoot()}api/libraries/`,\n\n    /** based on show_deleted would this lib show in the list of lib's?\n     *  @param {Boolean} show_deleted are we including deleted libraries?\n     */\n    isVisible: function(show_deleted) {\n        var isVisible = true;\n        if (!show_deleted && this.get(\"deleted\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    }\n});\n\nvar Libraries = Backbone.Collection.extend({\n    urlRoot: `${getAppRoot()}api/libraries`,\n\n    model: Library,\n\n    initialize: function(options) {\n        options = options || {};\n    },\n\n    search: function(search_term) {\n        /**\n         * Search the collection and return only the models that have\n         * the search term in their names.\n         * [the term to search]\n         * @type {string}\n         */\n        if (search_term == \"\") return this;\n        var lowercase_term = search_term.toLowerCase();\n        return this.filter(data => {\n            var lowercase_name = data.get(\"name\").toLowerCase();\n            return lowercase_name.indexOf(lowercase_term) !== -1;\n        });\n    },\n\n    /** Get every 'shown' library in this collection based on deleted filter\n     *  @param {Boolean} show_deleted are we including deleted libraries?\n     *  @returns array of library models\n     */\n    getVisible: function(show_deleted, filters) {\n        filters = filters || [];\n        var filteredLibraries = new Libraries(this.filter(item => item.isVisible(show_deleted)));\n\n        return filteredLibraries;\n    },\n\n    sortLibraries: function(sort_key, sort_order) {\n        this.comparator = mod_util.generateLibraryComparator(sort_key, sort_order);\n        this.sort();\n    }\n});\n\n// ============================================================================\n// FOLDER RELATED MODELS\n\nvar LibraryItem = Backbone.Model.extend({});\n\nvar Ldda = LibraryItem.extend({\n    urlRoot: `${getAppRoot()}api/libraries/datasets/`\n});\n\nvar FolderAsModel = LibraryItem.extend({\n    urlRoot: `${getAppRoot()}api/folders/`\n});\n\nvar Folder = Backbone.Collection.extend({\n    model: LibraryItem,\n\n    sortFolder: function(sort_key, sort_order) {\n        this.comparator = mod_util.generateFolderComparator(sort_key, sort_order);\n        this.sort();\n    }\n});\n\nvar FolderContainer = Backbone.Model.extend({\n    defaults: {\n        folder: new Folder(),\n        urlRoot: `${getAppRoot()}api/folders/`,\n        id: \"unknown\"\n    },\n    parse: function(obj) {\n        let Galaxy = getGalaxyInstance();\n        // empty the collection\n        this.get(\"folder\").reset();\n        // response is not a simple array, it contains metadata\n        // this will update the inner collection\n        for (var i = 0; i < obj.folder_contents.length; i++) {\n            if (obj.folder_contents[i].type === \"folder\") {\n                var folder_item = new FolderAsModel(obj.folder_contents[i]);\n                this.get(\"folder\").add(folder_item);\n            } else if (obj.folder_contents[i].type === \"file\") {\n                var file_item = new Ldda(obj.folder_contents[i]);\n                this.get(\"folder\").add(file_item);\n            } else {\n                Galaxy.emit.error(\"Unknown folder item type encountered while parsing response.\");\n            }\n        }\n        return obj;\n    }\n});\n\n// ============================================================================\n// HISTORY RELATED MODELS\n// TODO UNITE\n\nvar HistoryItem = Backbone.Model.extend({\n    urlRoot: `${getAppRoot()}api/histories/`\n});\n\nvar HistoryContents = Backbone.Collection.extend({\n    urlRoot: `${getAppRoot()}api/histories/`,\n    initialize: function(options) {\n        this.id = options.id;\n    },\n    url: function() {\n        return `${this.urlRoot + this.id}/contents`;\n    },\n    model: HistoryItem\n});\n\nvar GalaxyHistory = Backbone.Model.extend({\n    urlRoot: `${getAppRoot()}api/histories/`\n});\n\nvar GalaxyHistories = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/histories`,\n    model: GalaxyHistory\n});\n\n// ============================================================================\n// JSTREE MODEL\n/** Represents folder structure parsable by the jstree component.\n *\n */\n\nvar Jstree = Backbone.Model.extend({\n    urlRoot: `${getAppRoot()}api/remote_files`\n});\n\nexport default {\n    Library: Library,\n    Libraries: Libraries,\n    Item: Ldda,\n    Ldda: Ldda,\n    FolderAsModel: FolderAsModel,\n    Folder: Folder,\n    FolderContainer: FolderContainer,\n    HistoryItem: HistoryItem,\n    HistoryContents: HistoryContents,\n    GalaxyHistory: GalaxyHistory,\n    GalaxyHistories: GalaxyHistories,\n    Jstree: Jstree\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_utils from \"utils/utils\";\nimport mod_select from \"mvc/ui/ui-select\";\n\nvar LibraryDatasetView = Backbone.View.extend({\n    el: \"#center\",\n\n    model: null,\n\n    options: {},\n\n    defaults: {\n        edit_mode: false\n    },\n\n    events: {\n        \"click .toolbtn_modify_dataset\": \"enableModification\",\n        \"click .toolbtn_cancel_modifications\": \"render\",\n        \"click .toolbtn-download-dataset\": \"downloadDataset\",\n        \"click .toolbtn-import-dataset\": \"importIntoHistory\",\n        \"click .copy-link-to-clipboard\": \"copyToClipboard\",\n        \"click .make-private\": \"makeDatasetPrivate\",\n        \"click .remove-restrictions\": \"removeDatasetRestrictions\",\n        \"click .toolbtn_save_permissions\": \"savePermissions\",\n        \"click .toolbtn_save_modifications\": \"saveModifications\",\n        \"click .toolbtn_detect_datatype\": \"detectDatatype\"\n    },\n\n    // genome select\n    select_genome: null,\n\n    // extension select\n    select_extension: null,\n\n    // extension types\n    list_extensions: [],\n\n    // datatype placeholder for extension auto-detection\n    auto: {\n        id: \"auto\",\n        text: \"Auto-detect\",\n        description:\n            \"This system will try to detect the file type automatically.\" +\n            \" If your file is not detected properly as one of the known formats,\" +\n            \" it most likely means that it has some format problems (e.g., different\" +\n            \" number of columns on different rows). You can still coerce the system\" +\n            \" to set your data to the format you think it should be.\" +\n            \" You can also upload compressed files, which will automatically be decompressed.\"\n    },\n\n    // genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        this.options = _.extend(this.options, options);\n        this.fetchExtAndGenomes();\n        if (this.options.id) {\n            this.fetchDataset();\n        }\n    },\n\n    fetchDataset: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n        this.model = new mod_library_model.Item({\n            id: this.options.id\n        });\n        var self = this;\n        this.model.fetch({\n            success: function() {\n                if (self.options.show_permissions) {\n                    self.showPermissions();\n                } else if (self.options.show_version) {\n                    self.fetchVersion();\n                } else {\n                    self.render();\n                }\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`${response.responseJSON.err_msg} Click this to go back.`, \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                } else {\n                    Toast.error(\"An error occurred. Click this to go back.\", \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n        var template = this.templateDataset();\n        this.$el.html(template({ item: this.model }));\n        $(\".peek\").html(this.model.get(\"peek\"));\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    fetchVersion: function(options) {\n        this.options = _.extend(this.options, options);\n        var self = this;\n        if (!this.options.ldda_id) {\n            this.render();\n            Toast.error(\"Library dataset version requested but no id provided.\");\n        } else {\n            this.ldda = new mod_library_model.Ldda({\n                id: this.options.ldda_id\n            });\n            this.ldda.url = `${this.ldda.urlRoot + this.model.id}/versions/${this.ldda.id}`;\n            this.ldda.fetch({\n                success: function() {\n                    self.renderVersion();\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    renderVersion: function() {\n        $(\".tooltip\").remove();\n        var template = this.templateVersion();\n        this.$el.html(template({ item: this.model, ldda: this.ldda }));\n        $(\".peek\").html(this.ldda.get(\"peek\"));\n    },\n\n    enableModification: function() {\n        $(\".tooltip\").remove();\n        var template = this.templateModifyDataset();\n        this.$el.html(template({ item: this.model }));\n        this.renderSelectBoxes({\n            genome_build: this.model.get(\"genome_build\"),\n            file_ext: this.model.get(\"file_ext\")\n        });\n        $(\".peek\").html(this.model.get(\"peek\"));\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    downloadDataset: function() {\n        var url = `${getAppRoot()}api/libraries/datasets/download/uncompressed`;\n        var data = { ld_ids: this.id };\n        this.processDownload(url, data);\n    },\n\n    processDownload: function(url, data, method) {\n        //url and data options required\n        if (url && data) {\n            //data can be string of parameters or array/object\n            data = typeof data == \"string\" ? data : $.param(data);\n            //split params into form inputs\n            var inputs = \"\";\n            $.each(data.split(\"&\"), function() {\n                var pair = this.split(\"=\");\n                inputs += `<input type=\"hidden\" name=\"${pair[0]}\" value=\"${pair[1]}\" />`;\n            });\n            //send request\n            $(`<form action=\"${url}\" method=\"${method || \"post\"}\">${inputs}</form>`)\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n\n            Toast.info(\"Your download will begin soon.\");\n        }\n    },\n\n    importIntoHistory: function() {\n        this.refreshUserHistoriesList(self => {\n            let Galaxy = getGalaxyInstance();\n            var template = self.templateBulkImportInModal();\n            self.modal = Galaxy.modal;\n            self.modal.show({\n                closing_events: true,\n                title: _l(\"Import into History\"),\n                body: template({ histories: self.histories.models }),\n                buttons: {\n                    Import: function() {\n                        self.importCurrentIntoHistory();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    },\n\n    refreshUserHistoriesList: function(callback) {\n        var self = this;\n        this.histories = new mod_library_model.GalaxyHistories();\n        this.histories.fetch({\n            success: function(histories) {\n                if (histories.length === 0) {\n                    Toast.warning(\"You have to create history first. Click this to do so.\", \"\", {\n                        onclick: function() {\n                            window.location = getAppRoot();\n                        }\n                    });\n                } else {\n                    callback(self);\n                }\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    importCurrentIntoHistory: function() {\n        this.modal.disableButton(\"Import\");\n        var new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        var self = this;\n        if (new_history_name !== \"\") {\n            $.post(`${getAppRoot()}api/histories`, {\n                name: new_history_name\n            })\n                .done(new_history => {\n                    self.processImportToHistory(new_history.id);\n                })\n                .fail((xhr, status, error) => {\n                    Toast.error(\"An error occurred.\");\n                })\n                .always(() => {\n                    self.modal.enableButton(\"Import\");\n                });\n        } else {\n            var history_id = $(this.modal.$el)\n                .find(\"select[name=dataset_import_single] option:selected\")\n                .val();\n            this.processImportToHistory(history_id);\n            this.modal.enableButton(\"Import\");\n        }\n    },\n\n    processImportToHistory: function(history_id) {\n        let Galaxy = getGalaxyInstance();\n        var historyItem = new mod_library_model.HistoryItem();\n        historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n        // set the used history as current so user will see the last one\n        // that he imported into in the history panel on the 'analysis' page\n        $.getJSON(`${getAppRoot()}history/set_as_current?id=${history_id}`);\n        // save the dataset into selected history\n        historyItem.save(\n            { content: this.id, source: \"library\" },\n            {\n                success: function() {\n                    Galaxy.modal.hide();\n                    Toast.success(\"Dataset imported. Click this to start analyzing it.\", \"\", {\n                        onclick: function() {\n                            window.location = getAppRoot();\n                        }\n                    });\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(`Dataset not imported. ${response.responseJSON.err_msg}`);\n                    } else {\n                        Toast.error(\"An error occurred. Dataset not imported. Please try again.\");\n                    }\n                }\n            }\n        );\n    },\n\n    showPermissions: function(options) {\n        let Galaxy = getGalaxyInstance();\n        var template = this.templateDatasetPermissions();\n        var self = this;\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n        if (this.options.fetched_permissions !== undefined) {\n            if (this.options.fetched_permissions.access_dataset_roles.length === 0) {\n                this.model.set({ is_unrestricted: true });\n            } else {\n                this.model.set({ is_unrestricted: false });\n            }\n        }\n        this.$el.html(\n            template({\n                item: this.model,\n                is_admin: Galaxy.config.is_admin_user\n            })\n        );\n        $.get(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?scope=current`)\n            .done(fetched_permissions => {\n                self.prepareSelectBoxes({\n                    fetched_permissions: fetched_permissions,\n                    is_admin: Galaxy.config.is_admin_user\n                });\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to fetch dataset permissions.\");\n            });\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    _serializeRoles: function(role_list) {\n        var selected_roles = [];\n        for (var i = 0; i < role_list.length; i++) {\n            // Replace the : and , in role's name since these are select2 separators for initialData\n            selected_roles.push(`${role_list[i][1]}:${role_list[i][0].replace(\":\", \" \").replace(\",\", \" &\")}`);\n        }\n        return selected_roles;\n    },\n\n    prepareSelectBoxes: function(options) {\n        this.options = _.extend(this.options, options);\n        this.accessSelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"access_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)\n            })\n        );\n        this.modifySelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"modify_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.modify_item_roles)\n            })\n        );\n        this.manageSelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"manage_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)\n            })\n        );\n    },\n\n    _generate_select_options: function(options) {\n        var select_options = {\n            minimumInputLength: 0,\n            multiple: true,\n            placeholder: \"Click to select a role\",\n            formatResult: function roleFormatResult(role) {\n                return `${role.name} type: ${role.type}`;\n            },\n            formatSelection: function roleFormatSelection(role) {\n                return role.name;\n            },\n            initSelection: function(element, callback) {\n                // the input tag has a value attribute preloaded that points to a preselected role's id\n                // this function resolves that id attribute to an object that select2 can render\n                // using its formatResult renderer - that way the role name is shown preselected\n                var data = [];\n                $(element.val().split(\",\")).each(function() {\n                    var item = this.split(\":\");\n                    data.push({\n                        id: item[0],\n                        name: item[1]\n                    });\n                });\n                callback(data);\n            },\n            dropdownCssClass: \"bigdrop\" // apply css that makes the dropdown taller\n        };\n        select_options.container = this.$el.find(`#${options.selector}`);\n        select_options.css = options.selector;\n        select_options.initialData = options.initialData.join(\",\");\n        select_options.ajax = {\n            url: `${getAppRoot()}api/libraries/datasets/${this.id}/permissions?scope=available`,\n            dataType: \"json\",\n            quietMillis: 100,\n            data: function(term, page) {\n                // page is the one-based page number tracked by Select2\n                return {\n                    q: term, //search term\n                    page_limit: 10, // page size, should be same as used in 'more' variable below\n                    page: page // page number\n                };\n            },\n            results: function(data, page) {\n                var more = page * 10 < data.total; // whether or not there are more results available\n                // notice we return the value of more so Select2 knows if more results can be loaded\n                return { results: data.roles, more: more };\n            }\n        };\n        return select_options;\n    },\n\n    detectDatatype: function(options) {\n        let ld = this.model;\n        ld.set(\"file_ext\", \"auto\");\n        this._submitModification(ld);\n    },\n\n    /**\n     * Save the changes made to the library dataset.\n     */\n    saveModifications: function(options) {\n        var is_changed = false;\n        var ld = this.model;\n        var new_name = this.$el.find(\".input_dataset_name\").val();\n        if (typeof new_name !== \"undefined\" && new_name !== ld.get(\"name\")) {\n            if (new_name.length > 0) {\n                ld.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                Toast.warning(\"Library dataset name has to be at least 1 character long.\");\n                return;\n            }\n        }\n        var new_info = this.$el.find(\".input_dataset_misc_info\").val();\n        if (typeof new_info !== \"undefined\" && new_info !== ld.get(\"misc_info\")) {\n            ld.set(\"misc_info\", new_info);\n            is_changed = true;\n        }\n        var new_message = this.$el.find(\".input_dataset_message\").val();\n        if (typeof new_message !== \"undefined\" && new_message !== ld.get(\"message\")) {\n            ld.set(\"message\", new_message);\n            is_changed = true;\n        }\n        var new_genome_build = this.select_genome.$el.select2(\"data\").id;\n        if (typeof new_genome_build !== \"undefined\" && new_genome_build !== ld.get(\"genome_build\")) {\n            ld.set(\"genome_build\", new_genome_build);\n            is_changed = true;\n        }\n        var new_ext = this.select_extension.$el.select2(\"data\").id;\n        if (typeof new_ext !== \"undefined\" && new_ext !== ld.get(\"file_ext\")) {\n            ld.set(\"file_ext\", new_ext);\n            is_changed = true;\n        }\n        if (is_changed) {\n            this._submitModification(ld);\n        } else {\n            this.render();\n            Toast.info(\"Nothing has changed.\");\n        }\n    },\n\n    _submitModification(library_dataset) {\n        library_dataset.save(null, {\n            patch: true,\n            success: library_dataset => {\n                this.render();\n                Toast.success(\"Changes to library dataset saved.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred while attempting to update the library dataset.\");\n                }\n            }\n        });\n    },\n\n    copyToClipboard: function(e) {\n        e.preventDefault();\n        var href = Backbone.history.location.href;\n        if (href.lastIndexOf(\"/permissions\") !== -1) {\n            href = href.substr(0, href.lastIndexOf(\"/permissions\"));\n        }\n        window.prompt(\"Copy to clipboard: Ctrl+C, Enter\", href);\n    },\n\n    makeDatasetPrivate: function() {\n        var self = this;\n        $.post(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?action=make_private`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: false });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"The dataset is now private to you.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to make dataset private.\");\n            });\n    },\n\n    removeDatasetRestrictions: function() {\n        var self = this;\n        $.post(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?action=remove_restrictions`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: true });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"Access to this dataset is now unrestricted.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to make dataset unrestricted.\");\n            });\n    },\n\n    /**\n     * Extract the role ids from Select2 elements's 'data'\n     */\n    _extractIds: function(roles_list) {\n        var ids_list = [];\n        for (var i = roles_list.length - 1; i >= 0; i--) {\n            ids_list.push(roles_list[i].id);\n        }\n        return ids_list;\n    },\n\n    /**\n     * Save the permissions for roles entered in the select boxes.\n     */\n    savePermissions: function(event) {\n        var self = this;\n        var access_ids = this._extractIds(this.accessSelectObject.$el.select2(\"data\"));\n        var manage_ids = this._extractIds(this.manageSelectObject.$el.select2(\"data\"));\n        var modify_ids = this._extractIds(this.modifySelectObject.$el.select2(\"data\"));\n        $.post(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?action=set_permissions`, {\n            \"access_ids[]\": access_ids,\n            \"manage_ids[]\": manage_ids,\n            \"modify_ids[]\": modify_ids\n        })\n            .done(fetched_permissions => {\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"Permissions saved.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to set dataset permissions.\");\n            });\n    },\n\n    /**\n     * If needed request all extensions and/or genomes from Galaxy\n     * and save them in sorted arrays.\n     */\n    fetchExtAndGenomes: function() {\n        var self = this;\n        if (this.list_genomes.length == 0) {\n            mod_utils.get({\n                url: `${getAppRoot()}api/datatypes?extension_only=False`,\n                success: function(datatypes) {\n                    for (var key in datatypes) {\n                        self.list_extensions.push({\n                            id: datatypes[key].extension,\n                            text: datatypes[key].extension,\n                            description: datatypes[key].description,\n                            description_url: datatypes[key].description_url\n                        });\n                    }\n                    self.list_extensions.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                    self.list_extensions.unshift(self.auto);\n                }\n            });\n        }\n        if (this.list_extensions.length == 0) {\n            mod_utils.get({\n                url: `${getAppRoot()}api/genomes`,\n                success: function(genomes) {\n                    for (var key in genomes) {\n                        self.list_genomes.push({\n                            id: genomes[key][1],\n                            text: genomes[key][0]\n                        });\n                    }\n                    self.list_genomes.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                }\n            });\n        }\n    },\n\n    renderSelectBoxes: function(options) {\n        // This won't work properly unlesss we already have the data fetched.\n        // See this.fetchExtAndGenomes()\n        // TODO switch to common resources:\n        // https://trello.com/c/dIUE9YPl/1933-ui-common-resources-and-data-into-galaxy-object\n        var self = this;\n        var current_genome = \"?\";\n        var current_ext = \"auto\";\n        if (typeof options !== \"undefined\") {\n            if (typeof options.genome_build !== \"undefined\") {\n                current_genome = options.genome_build;\n            }\n            if (typeof options.file_ext !== \"undefined\") {\n                current_ext = options.file_ext;\n            }\n        }\n        this.select_genome = new mod_select.View({\n            css: \"dataset-genome-select\",\n            data: self.list_genomes,\n            container: self.$el.find(\"#dataset_genome_select\"),\n            value: current_genome\n        });\n        this.select_extension = new mod_select.View({\n            css: \"dataset-extension-select\",\n            data: self.list_extensions,\n            container: self.$el.find(\"#dataset_extension_select\"),\n            value: current_ext\n        });\n    },\n\n    templateDataset: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Download dataset\" class=\"btn btn-secondary toolbtn-download-dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-download\"></span>',\n                \"&nbsp;Download\",\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Import dataset into history\" class=\"btn btn-secondary toolbtn-import-dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-book\"></span>',\n                \"&nbsp;to History\",\n                \"</button>\",\n                '<% if (item.get(\"can_user_modify\")) { %>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify library item\" class=\"btn btn-secondary toolbtn_modify_dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-pencil\"></span>',\n                \"&nbsp;Modify\",\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Attempt to detect the format of dataset\" class=\"btn btn-secondary toolbtn_detect_datatype toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-undo\"></span>',\n                \"&nbsp;Auto-detect datatype\",\n                \"</button>\",\n                \"<% } %>\",\n                '<% if (item.get(\"can_user_manage\")) { %>',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>/permissions\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Manage permissions\" class=\"btn btn-secondary toolbtn_change_permissions toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-group\"></span>',\n                \"&nbsp;Permissions\",\n                \"</button>\",\n                \"</a>\",\n                \"<% } %>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<% if (item.get(\"is_unrestricted\")) { %>',\n                \"<div>\",\n                'This dataset is unrestricted so everybody with the link can access it. Just share <span class=\"copy-link-to-clipboard\"><a href=\"\"a>this page</a></span>.',\n                \"</div>\",\n                \"<% } %>\",\n\n                // TABLE START\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th class=\"dataset-first-column\" scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(item.get(\"ldda_id\")) %>\">Name</th>',\n                '<td><%= _.escape(item.get(\"name\")) %></td>',\n                \"</tr>\",\n                '<% if (item.get(\"file_ext\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                '<td><%= _.escape(item.get(\"file_ext\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"genome_build\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                '<td><%= _.escape(item.get(\"genome_build\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"file_size\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(item.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"date_uploaded\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(item.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"uploaded_by\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(item.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_data_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_comment_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_comment_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_columns\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_column_types\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"message\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"message\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"misc_blurb\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Misc. blurb</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"misc_info\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Misc. info</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_info\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if ( item.get(\"uuid\") !== \"ok\" ) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">UUID</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"uuid\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if ( item.get(\"state\") !== \"ok\" ) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">State</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"state\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n\n                '<% if (item.get(\"job_stderr\")) { %>',\n                \"<h4>Job Standard Error</h4>\",\n                '<pre class=\"code\">',\n                '<%= _.escape(item.get(\"job_stderr\")) %>',\n                \"</pre>\",\n                \"<% } %>\",\n\n                '<% if (item.get(\"job_stdout\")) { %>',\n                \"<h4>Job Standard Output</h4>\",\n                '<pre class=\"code\">',\n                '<%= _.escape(item.get(\"job_stdout\")) %>',\n                \"</pre>\",\n                \"<% } %>\",\n\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n\n                '<% if (item.get(\"has_versions\")) { %>',\n                \"<div>\",\n                \"<h3>Expired versions:</h3>\",\n                \"<ul>\",\n                '<% _.each(item.get(\"expired_versions\"), function(version) { %>',\n                '<li><a title=\"See details of this version\" href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>/versions/<%- version[0] %>\"><%- version[1] %></a></li>',\n                \"<% }) %>\",\n                \"<ul>\",\n                \"</div>\",\n                \"<% } %>\",\n                // TABLE END\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateVersion: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go to latest dataset\" class=\"btn btn-secondary toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-caret-left fa-lg\"></span>',\n                \"&nbsp;Latest dataset\",\n                \"</button>\",\n                \"<a>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<div class=\"alert alert-warning\">This is an expired version of the library dataset: <%= _.escape(item.get(\"name\")) %></div>',\n                // DATASET START\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(ldda.id) %>\">Name</th>',\n                '<td><%= _.escape(ldda.get(\"name\")) %></td>',\n                \"</tr>\",\n                '<% if (ldda.get(\"file_ext\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                '<td><%= _.escape(ldda.get(\"file_ext\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"genome_build\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                '<td><%= _.escape(ldda.get(\"genome_build\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"file_size\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(ldda.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"date_uploaded\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(ldda.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"uploaded_by\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(ldda.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_data_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_comment_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_comment_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_columns\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_column_types\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"message\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"message\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"misc_blurb\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Miscellaneous blurb</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"misc_info\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Miscellaneous information</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"misc_info\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n                // DATASET END\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateModifyDataset: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th class=\"dataset-first-column\" scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(item.get(\"ldda_id\")) %>\">Name</th>',\n                '<td><input class=\"input_dataset_name form-control\" type=\"text\" placeholder=\"name\" value=\"<%= _.escape(item.get(\"name\")) %>\"></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                \"<td>\",\n                '<span id=\"dataset_extension_select\" class=\"dataset-extension-select\" />',\n                \"</td>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                \"<td>\",\n                '<span id=\"dataset_genome_select\" class=\"dataset-genome-select\" />',\n                \"</td>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(item.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(item.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(item.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                '<tr scope=\"row\">',\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<% if (item.get(\"metadata_comment_lines\") === \"\") { %>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_comment_lines\")) %></td>',\n                \"<% } else { %>\",\n                '<td scope=\"row\">unknown</td>',\n                \"<% } %>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><input class=\"input_dataset_message form-control\" type=\"text\" placeholder=\"message\" value=\"<%= _.escape(item.get(\"message\")) %>\"></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Misc. blurb</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Misc. information</th>',\n                '<td><input class=\"input_dataset_misc_info form-control\" type=\"text\" placeholder=\"info\" value=\"<%= _.escape(item.get(\"misc_info\")) %>\"></td>',\n                \"</tr>\",\n                //TODO: add functionality to modify tags here\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n                \"</div>\",\n\n                '<div class=\"d-flex\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Cancel modifications\" class=\"btn btn-secondary toolbtn_cancel_modifications toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-times\"></span>',\n                \"&nbsp;Cancel\",\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications\" class=\"btn btn-secondary toolbtn_save_modifications toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"></span>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateDatasetPermissions: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go back to dataset\" class=\"btn btn-secondary toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-file-o\"></span>',\n                \"&nbsp;Dataset Details\",\n                \"</button>\",\n                \"<a>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<h1>Dataset: <%= _.escape(item.get(\"name\")) %></h1>',\n                '<div class=\"alert alert-warning\">',\n                \"<% if (is_admin) { %>\",\n                \"You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.\",\n                \"<% } else { %>\",\n                \"You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.\",\n                \"<% } %>\",\n                \"</div>\",\n                '<div class=\"dataset_table\">',\n                \"<h2>Library-related permissions</h2>\",\n                \"<h4>Roles that can modify the library item</h4>\",\n                '<div id=\"modify_perm\" class=\"modify_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',\n                \"<hr/>\",\n                \"<h2>Dataset-related permissions</h2>\",\n                '<div class=\"alert alert-warning\">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>',\n                '<% if (!item.get(\"is_unrestricted\")) { %>',\n                '<p>You can <span class=\"remove-restrictions\"><a href=\"\">remove all access restrictions</a></span> on this dataset.</p>',\n                \"<% } else { %>\",\n                '<p>You can <span class=\"make-private\"><a href=\"\">make this dataset private</a></span> to you.</p>',\n                \"<% } %>\",\n                \"<h4>Roles that can access the dataset</h4>\",\n                '<div id=\"access_perm\" class=\"access_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User has to have <strong>all these roles</strong> in order to access this dataset.\",\n                \" Users without access permission <strong>cannot</strong> have other permissions on this dataset.\",\n                \" If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.\",\n                \"</div>\",\n                \"<h4>Roles that can manage permissions on the dataset</h4>\",\n                '<div id=\"manage_perm\" class=\"manage_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.\",\n                \"</div>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications made on this page\" class=\"btn btn-secondary toolbtn_save_permissions  type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"></span>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateBulkImportInModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<div class=\"library-modal-item\">',\n                \"Select history: \",\n                '<select id=\"dataset_import_single\" name=\"dataset_import_single\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n                \"<% _.each(histories, function(history) { %>\",\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                '<div class=\"library-modal-item\">',\n                \"or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\">',\n                \"</input>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryDatasetView: LibraryDatasetView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_library_dataset_view from \"mvc/library/library-dataset-view\";\n\nvar FolderRowView = Backbone.View.extend({\n    events: {\n        \"click .undelete_dataset_btn\": \"undeleteDataset\",\n        \"click .undelete_folder_btn\": \"undeleteFolder\",\n        \"click .edit_folder_btn\": \"startModifications\",\n        \"click .cancel_folder_btn\": \"cancelModifications\",\n        \"click .save_folder_btn\": \"saveModifications\"\n    },\n\n    defaults: {\n        type: null,\n        visibility_config: {\n            edit_folder_btn: false,\n            save_folder_btn: false,\n            cancel_folder_btn: false,\n            permission_folder_btn: false\n        },\n        edit_mode: false\n    },\n\n    initialize: function(options) {\n        this.options = _.defaults(options || {}, this.defaults);\n        this.render(this.options);\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var folder_item = this.options.model;\n        var template = null;\n        let Galaxy = getGalaxyInstance();\n\n        if (folder_item.get(\"type\") === \"folder\" || folder_item.get(\"model_class\") === \"LibraryFolder\") {\n            this.options.type = \"folder\";\n            this.prepareButtons(folder_item);\n            if (folder_item.get(\"deleted\")) {\n                template = this.templateRowDeletedFolder();\n            } else {\n                template = this.templateRowFolder();\n            }\n        } else if (\n            folder_item.get(\"type\") === \"file\" ||\n            folder_item.get(\"model_class\") === \"LibraryDatasetDatasetAssociation\" ||\n            folder_item.get(\"model_class\") === \"LibraryDataset\"\n        ) {\n            this.options.type = \"file\";\n            if (folder_item.get(\"deleted\")) {\n                template = this.templateRowDeletedFile();\n            } else {\n                template = this.templateRowFile();\n            }\n        } else {\n            Galaxy.emit.error(\"Unknown library item type found.\");\n            Galaxy.emit.error(folder_item.get(\"type\") || folder_item.get(\"model_class\"));\n        }\n        this.setElement(\n            template({\n                content_item: folder_item,\n                edit_mode: this.options.edit_mode,\n                button_config: this.options.visibility_config\n            })\n        );\n        this.$el.show();\n        return this;\n    },\n\n    /**\n     * Modify the visibility of buttons for\n     * the filling of the row template of a given folder.\n     */\n    prepareButtons: function(folder) {\n        var vis_config = this.options.visibility_config;\n        if (this.options.edit_mode === false) {\n            vis_config.save_folder_btn = false;\n            vis_config.cancel_folder_btn = false;\n            if (folder.get(\"deleted\") === true) {\n                vis_config.edit_folder_btn = false;\n                vis_config.permission_folder_btn = false;\n            } else if (folder.get(\"deleted\") === false) {\n                vis_config.save_folder_btn = false;\n                vis_config.cancel_folder_btn = false;\n                if (folder.get(\"can_modify\") === true) {\n                    vis_config.edit_folder_btn = true;\n                }\n                if (folder.get(\"can_manage\") === true) {\n                    vis_config.permission_folder_btn = true;\n                }\n            }\n        } else if (this.options.edit_mode === true) {\n            vis_config.edit_folder_btn = false;\n            vis_config.permission_folder_btn = false;\n            vis_config.save_folder_btn = true;\n            vis_config.cancel_folder_btn = true;\n        }\n        this.options.visibility_config = vis_config;\n    },\n\n    /* Show the page with dataset details. */\n    showDatasetDetails: function() {\n        let Galaxy = getGalaxyInstance();\n        Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({ id: this.id });\n    },\n\n    /* Undelete the dataset on server and render the row again. */\n    undeleteDataset: function(event) {\n        $(\".tooltip\").hide();\n        let Galaxy = getGalaxyInstance();\n        var that = this;\n        var dataset_id = $(event.target)\n            .closest(\"tr\")\n            .data(\"id\");\n        var dataset = Galaxy.libraries.folderListView.collection.get(dataset_id);\n        dataset.url = `${dataset.urlRoot + dataset.id}?undelete=true`;\n        dataset.destroy({\n            success: function(model, response) {\n                Galaxy.libraries.folderListView.collection.remove(dataset_id);\n                var updated_dataset = new mod_library_model.Item(response);\n                Galaxy.libraries.folderListView.collection.add(updated_dataset);\n                Galaxy.libraries.folderListView.collection.sortFolder(\"name\", \"asc\");\n                Toast.success(\"Dataset undeleted. Click this to see it.\", \"\", {\n                    onclick: function() {\n                        var folder_id = that.model.get(\"folder_id\");\n                        window.location = `${getAppRoot()}library/list#folders/${folder_id}/datasets/${that.id}`;\n                    }\n                });\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`Dataset was not undeleted. ${response.responseJSON.err_msg}`);\n                } else {\n                    Toast.error(\"An error occurred! Dataset was not undeleted. Please try again.\");\n                }\n            }\n        });\n    },\n\n    /* Undelete the folder on server and render the row again. */\n    undeleteFolder: function(event) {\n        let Galaxy = getGalaxyInstance();\n        $(\".tooltip\").hide();\n        var folder_id = $(event.target)\n            .closest(\"tr\")\n            .data(\"id\");\n        var folder = Galaxy.libraries.folderListView.collection.get(folder_id);\n        folder.url = `${folder.urlRoot + folder.id}?undelete=true`;\n        folder.destroy({\n            success: function(model, response) {\n                Galaxy.libraries.folderListView.collection.remove(folder_id);\n                var updated_folder = new mod_library_model.FolderAsModel(response);\n                Galaxy.libraries.folderListView.collection.add(updated_folder);\n                Galaxy.libraries.folderListView.collection.sortFolder(\"name\", \"asc\");\n                Toast.success(\"Folder undeleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`Folder was not undeleted. ${response.responseJSON.err_msg}`);\n                } else {\n                    Toast.error(\"An error occurred! Folder was not undeleted. Please try again.\");\n                }\n            }\n        });\n    },\n\n    /* User clicked the 'edit' button on row so render the row as editable. */\n    startModifications: function() {\n        this.options.edit_mode = true;\n        this.repaint();\n    },\n\n    /* User clicked the 'cancel' button so render normal row */\n    cancelModifications: function() {\n        this.options.edit_mode = false;\n        this.repaint();\n    },\n\n    saveModifications: function() {\n        let Galaxy = getGalaxyInstance();\n        var folder = Galaxy.libraries.folderListView.collection.get(this.$el.data(\"id\"));\n        var is_changed = false;\n        var new_name = this.$el.find(\".input_folder_name\").val();\n        if (typeof new_name !== \"undefined\" && new_name !== folder.get(\"name\")) {\n            if (new_name.length > 2) {\n                folder.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                Toast.warning(\"Folder name has to be at least 3 characters long.\");\n                return;\n            }\n        }\n        var new_description = this.$el.find(\".input_folder_description\").val();\n        if (typeof new_description !== \"undefined\" && new_description !== folder.get(\"description\")) {\n            folder.set(\"description\", new_description);\n            is_changed = true;\n        }\n        if (is_changed) {\n            var row_view = this;\n            folder.save(null, {\n                patch: true,\n                success: function(folder) {\n                    row_view.options.edit_mode = false;\n                    row_view.repaint(folder);\n                    Toast.success(\"Changes to folder saved.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred while attempting to update the folder.\");\n                    }\n                }\n            });\n        } else {\n            this.options.edit_mode = false;\n            this.repaint(folder);\n            Toast.info(\"Nothing has changed.\");\n        }\n    },\n\n    repaint: function() {\n        /* need to hide manually because of the element removal in setElement\n    invoked in render() */\n        $(\".tooltip\").hide();\n        /* we need to store the old element to be able to replace it with\n    new one */\n        var old_element = this.$el;\n        /* if user canceled the folder param is undefined,\n      if user saved and succeeded the updated folder is rendered */\n        this.render();\n        old_element.replaceWith(this.$el);\n        /* now we attach new tooltips to the newly created row element */\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    templateRowFolder: function() {\n        return _.template(\n            [\n                '<tr class=\"folder_row light library-row\" data-id=\"<%- content_item.id %>\">',\n                '<td class=\"mid\">',\n                '<span title=\"Folder\" class=\"fa fa-folder-o\"/>',\n                \"</td>\",\n                '<td class=\"mid\"><input style=\"margin: 0;\" type=\"checkbox\"></td>',\n                \"<% if(!edit_mode) { %>\",\n                \"<td>\",\n                '<a href=\"#folders/<%- content_item.id %>\"><%- content_item.get(\"name\") %></a>',\n                \"</td>\",\n                \"<td>\",\n                '<%- content_item.get(\"description\") %>',\n                \"</td>\",\n                \"<% } else if(edit_mode){ %>\",\n                '<td><textarea rows=\"4\" class=\"form-control input_folder_name\" placeholder=\"name\" ><%- content_item.get(\"name\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_folder_description\" placeholder=\"description\" ><%- content_item.get(\"description\") %></textarea></td>',\n                \"<% } %>\",\n                \"<td>folder</td>\",\n                \"<td></td>\",\n                \"<td>\",\n                '<%= _.escape(content_item.get(\"update_time\")) %>',\n                \"</td>\",\n                \"<td></td>\",\n                \"<td>\",\n                \"<% if(edit_mode) { %>\", // start edit mode\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save changes\" class=\"primary-button btn-sm save_folder_btn\" type=\"button\" style=\"<% if(button_config.save_folder_btn === false) { print(\"display:none;\") } %>\">',\n                '<span class=\"fa fa-floppy-o\"/> Save',\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Discard changes\" class=\"primary-button btn-sm cancel_folder_btn\" type=\"button\" style=\"<% if(button_config.cancel_folder_btn === false) { print(\"display:none;\") } %>\">',\n                '<span class=\"fa fa-times\"/> Cancel',\n                \"</button>\",\n                \"<% } else if (!edit_mode){%>\", // start no edit mode\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify \\'<%- content_item.get(\"name\") %>\\'\" class=\"primary-button btn-sm edit_folder_btn\" type=\"button\" style=\"<% if(button_config.edit_folder_btn === false) { print(\"display:none;\") } %>\">',\n                '<span class=\"fa fa-pencil\"/> Edit',\n                \"</button>\",\n                '<a href=\"#/folders/<%- content_item.id %>/permissions\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" class=\"primary-button btn-sm permission_folder_btn\" title=\"Permissions of \\'<%- content_item.get(\"name\") %>\\'\" style=\"<% if(button_config.permission_folder_btn === false) { print(\"display:none;\") } %>\">',\n                '<span class=\"fa fa-group\"/> Manage',\n                \"</button>\",\n                \"</a>\",\n                \"<% } %>\", //end no edit mode\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    },\n\n    templateRowFile: function() {\n        return _.template(\n            [\n                '<tr class=\"dataset_row light library-row\" data-id=\"<%- content_item.id %>\">',\n                '<td class=\"mid\">',\n                '<span title=\"Dataset\" class=\"fa fa-file-o\"/>',\n                \"</td>\",\n                '<td class=\"mid\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\">',\n                \"</td>\",\n                \"<td>\",\n                '<a href=\"#folders/<%- content_item.get(\"folder_id\") %>/datasets/<%- content_item.id %>\" class=\"library-dataset\">',\n                '<%- content_item.get(\"name\") %>',\n                \"<a>\",\n                \"</td>\",\n                '<td><%- content_item.get(\"message\") %></td>',\n                '<td><%= _.escape(content_item.get(\"file_ext\")) %></td>',\n                '<td><%= _.escape(content_item.get(\"file_size\")) %></td>',\n                '<td><%= _.escape(content_item.get(\"update_time\")) %></td>',\n                \"<td>\",\n                '<% if ( content_item.get(\"state\") !== \"ok\" ) { %>',\n                '<%= _.escape(content_item.get(\"state\")) %>',\n                \"<% } %>\",\n                \"</td>\",\n                \"<td>\",\n                '<% if (content_item.get(\"is_unrestricted\")) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Unrestricted dataset\" style=\"color:grey;\" class=\"fa fa-globe\"/>',\n                \"<% } %>\",\n                '<% if (content_item.get(\"is_private\")) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Private dataset\" style=\"color:grey;\" class=\"fa fa-key\"/>',\n                \"<% } %>\",\n                '<% if ((content_item.get(\"is_unrestricted\") === false) && (content_item.get(\"is_private\") === false)) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Restricted dataset\" style=\"color:grey;\" class=\"fa fa-shield\"/>',\n                \"<% } %>\",\n                '<% if (content_item.get(\"can_manage\")) { %>',\n                '<a href=\"#folders/<%- content_item.get(\"folder_id\") %>/datasets/<%- content_item.id %>/permissions\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" class=\"primary-button btn-sm permissions-dataset-btn\" title=\"Permissions of \\'<%- content_item.get(\"name\") %>\\'\">',\n                '<span class=\"fa fa-group\"/> Manage',\n                \"</button>\",\n                \"</a>\",\n                \"<% } %>\",\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    },\n\n    templateRowDeletedFile: function() {\n        return _.template(\n            [\n                '<tr class=\"active deleted_dataset library-row\" data-id=\"<%- content_item.id %>\">',\n                '<td class=\"mid\">',\n                '<span title=\"Dataset\" class=\"fa fa-file-o\"/>',\n                \"</td>\",\n                \"<td></td>\",\n                '<td style=\"color:grey;\">',\n                '<%- content_item.get(\"name\") %>',\n                \"</td>\",\n                \"<td>\",\n                '<%- content_item.get(\"message\") %>',\n                \"</td>\",\n                \"<td>\",\n                '<%= _.escape(content_item.get(\"file_ext\")) %>',\n                \"</td>\",\n                \"<td>\",\n                '<%= _.escape(content_item.get(\"file_size\")) %>',\n                \"</td>\",\n                \"<td>\",\n                '<%= _.escape(content_item.get(\"update_time\")) %>',\n                \"</td>\",\n                \"<td>\",\n                '<% if ( content_item.get(\"state\") !== \"ok\" ) { %>',\n                '<%= _.escape(content_item.get(\"state\")) %>',\n                \"<% } %>\",\n                \"</td>\",\n                \"<td>\",\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Marked deleted\" style=\"color:grey;\" class=\"fa fa-ban\"/>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Undelete \\'<%- content_item.get(\"name\") %>\\'\" class=\"primary-button btn-sm undelete_dataset_btn\" type=\"button\" style=\"margin-left:1em;\">',\n                '<span class=\"fa fa-unlock\"/> Undelete',\n                \"</button>\",\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    },\n\n    templateRowDeletedFolder: function() {\n        return _.template(\n            [\n                '<tr class=\"active deleted_folder light library-row\" data-id=\"<%- content_item.id %>\">',\n                '<td class=\"mid\">',\n                '<span title=\"Folder\" class=\"fa fa-folder-o\"/>',\n                \"</td>\",\n                \"<td></td>\",\n                '<td style=\"color:grey;\">',\n                '<%- content_item.get(\"name\") %>',\n                \"</td>\",\n                \"<td>\",\n                '<%- content_item.get(\"description\") %>',\n                \"</td>\",\n                \"<td>\",\n                \"folder\",\n                \"</td>\",\n                \"<td></td>\",\n                \"<td>\",\n                '<%= _.escape(content_item.get(\"update_time\")) %>',\n                \"</td>\",\n                \"<td></td>\",\n                \"<td>\",\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Marked deleted\" style=\"color:grey;\" class=\"fa fa-ban\"/>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Undelete \\'<%- content_item.get(\"name\") %>\\'\" class=\"primary-button btn-sm undelete_folder_btn\" type=\"button\" style=\"margin-left:1em;\">',\n                '<span class=\"fa fa-unlock\"/> Undelete',\n                \"</button>\",\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderRowView: FolderRowView\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_library_folderrow_view from \"mvc/library/library-folderrow-view\";\nimport { getGalaxyInstance } from \"app\";\n\nvar FolderListView = Backbone.View.extend({\n    el: \"#folder_items_element\",\n    // progress percentage\n    progress: 0,\n    // progress rate per one item\n    progressStep: 1,\n\n    folderContainer: null,\n\n    current_sort_order: \"asc\",\n\n    current_sort_key: \"name\",\n\n    events: {\n        \"click #select-all-checkboxes\": \"selectAll\",\n        \"click .dataset_row\": \"selectClickedRow\",\n        \"click .folder_row\": \"selectClickedRow\",\n        \"click .sort-folder-name\": \"sortColumnClicked\",\n        \"click .sort-folder-file_ext\": \"sortColumnClicked\",\n        \"click .sort-folder-description\": \"sortColumnClicked\",\n        \"click .sort-folder-state\": \"sortColumnClicked\"\n    },\n\n    collection: null,\n\n    defaults: {\n        include_deleted: false,\n        page_count: null,\n        show_page: null\n    },\n\n    /**\n     * Initialize and fetch the folder from the server.\n     * @param  {object} options an object with options\n     */\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, this.defaults, options);\n        this.modal = null;\n        // map of folder item ids to item views = cache\n        this.rowViews = {};\n\n        // create a collection of folder items for this view\n        this.collection = new mod_library_model.Folder();\n\n        // start to listen if someone modifies the collection\n        this.listenTo(this.collection, \"add\", this.renderOne);\n        this.listenTo(this.collection, \"remove\", this.removeOne);\n        this.listenTo(this.collection, \"sort\", this.rePaint);\n        this.listenTo(this.collection, \"reset\", this.rePaint);\n\n        this.fetchFolder();\n    },\n\n    fetchFolder: function(options = {}) {\n        this.options.include_deleted = options.include_deleted;\n        var self = this;\n\n        this.folderContainer = new mod_library_model.FolderContainer({\n            id: this.options.id\n        });\n        this.folderContainer.url = `${this.folderContainer.attributes.urlRoot + this.options.id}/contents`;\n\n        if (this.options.include_deleted) {\n            this.folderContainer.url = `${this.folderContainer.url}?include_deleted=true`;\n        }\n        this.folderContainer.fetch({\n            success: function(folder_container) {\n                self.folder_container = folder_container;\n                self.render();\n            },\n            error: function(model, response) {\n                let Galaxy = getGalaxyInstance();\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`${response.responseJSON.err_msg} Click this to go back.`, \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                } else {\n                    Toast.error(\"An error occurred. Click this to go back.\", \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var template = this.templateFolder();\n        $(\".tooltip\").hide();\n\n        // find the upper id in the full path\n        var path = this.folderContainer.attributes.metadata.full_path;\n        var upper_folder_id;\n        if (path.length === 1) {\n            // the library is above us\n            upper_folder_id = 0;\n        } else {\n            upper_folder_id = path[path.length - 2][0];\n        }\n\n        this.$el.html(\n            template({\n                path: this.folderContainer.attributes.metadata.full_path,\n                parent_library_id: this.folderContainer.attributes.metadata.parent_library_id,\n                id: this.options.id,\n                upper_folder_id: upper_folder_id,\n                order: this.current_sort_order\n            })\n        );\n\n        // when dataset_id is present render its details too\n        if (this.options.dataset_id) {\n            var row = _.findWhere(self.rowViews, {\n                id: this.options.dataset_id\n            });\n            if (row) {\n                row.showDatasetDetails();\n            } else {\n                Toast.error(\"Requested dataset not found. Showing folder instead.\");\n            }\n        } else {\n            if (this.options.show_page === null || this.options.show_page < 1) {\n                this.options.show_page = 1;\n            }\n            this.paginate();\n        }\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    paginate: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n\n        if (this.options.show_page === null || this.options.show_page < 1) {\n            this.options.show_page = 1;\n        }\n        this.options.total_items_count = this.folder_container.get(\"folder\").models.length;\n        this.options.page_count = Math.ceil(\n            this.options.total_items_count / Galaxy.libraries.preferences.get(\"folder_page_size\")\n        );\n        var page_start = Galaxy.libraries.preferences.get(\"folder_page_size\") * (this.options.show_page - 1);\n        var items_to_render = null;\n        items_to_render = this.folder_container\n            .get(\"folder\")\n            .models.slice(page_start, page_start + Galaxy.libraries.preferences.get(\"folder_page_size\"));\n        this.options.items_shown = items_to_render.length;\n        // User requests page with no items\n        if (\n            Galaxy.libraries.preferences.get(\"folder_page_size\") * this.options.show_page >\n            this.options.total_items_count + Galaxy.libraries.preferences.get(\"folder_page_size\")\n        ) {\n            items_to_render = [];\n        }\n        Galaxy.libraries.folderToolbarView.renderPaginator(this.options);\n        this.collection.reset(items_to_render);\n    },\n\n    rePaint: function(options) {\n        this.options = _.extend(this.options, options);\n        this.removeAllRows();\n        this.renderAll();\n        this.checkEmptiness();\n    },\n\n    /**\n     * Adds all given models to the collection.\n     * @param {array of Item or FolderAsModel} array of models that should\n     *  be added to the view's collection.\n     */\n    addAll: function(models) {\n        let Galaxy = getGalaxyInstance();\n        _.each(models, model => {\n            Galaxy.libraries.folderListView.collection.add(model, {\n                current_sort_order: false\n            });\n        });\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        this.checkEmptiness();\n        this.postRender();\n    },\n\n    /**\n     * Call this after all models are added to the collection\n     * to ensure that the folder toolbar will show proper options\n     * and that event will be bound on all subviews.\n     */\n    postRender: function() {\n        let Galaxy = getGalaxyInstance();\n        var fetched_metadata = this.folderContainer.attributes.metadata;\n        fetched_metadata.contains_file_or_folder =\n            typeof this.collection.findWhere({ type: \"file\" }) !== \"undefined\" ||\n            typeof this.collection.findWhere({ type: \"folder\" }) !== \"undefined\";\n        Galaxy.libraries.folderToolbarView.configureElements(fetched_metadata);\n    },\n\n    /**\n     * Iterates this view's collection and calls the render\n     * function for each. Also binds the hover behavior.\n     */\n    renderAll: function() {\n        var self = this;\n        _.each(this.collection.models.reverse(), model => {\n            self.renderOne(model);\n        });\n        this.postRender();\n    },\n\n    /**\n     * Creates a view for the given model and adds it to the folder view.\n     * @param {Item or FolderAsModel} model of the view that will be rendered\n     */\n    renderOne: function(model) {\n        this.options.contains_file_or_folder = true;\n        //if (model.get('type') !== 'folder'){\n        // model.set('readable_size', this.size_to_string(model.get('file_size')));\n        //}\n        model.set(\"folder_id\", this.id);\n        var rowView = new mod_library_folderrow_view.FolderRowView({\n            model: model\n        });\n\n        // save new rowView to cache\n        this.rowViews[model.get(\"id\")] = rowView;\n\n        this.$el.find(\"#first_folder_item\").after(rowView.el);\n    },\n\n    /**\n     * Remove the view of the given model from the DOM.\n     * @param {Item or FolderAsModel} model of the view that will be removed\n     */\n    removeOne: function(model) {\n        this.$el\n            .find(\"tr\")\n            .filter(function() {\n                return $(this).data(\"id\") && $(this).data(\"id\") === model.id;\n            })\n            .remove();\n    },\n\n    /**\n     * Remove all dataset and folder row elements from the DOM.\n     */\n    removeAllRows: function() {\n        $(\".library-row\").remove();\n    },\n\n    /** Checks whether the list is empty and adds/removes the message */\n    checkEmptiness: function() {\n        if (this.$el.find(\".dataset_row\").length === 0 && this.$el.find(\".folder_row\").length === 0) {\n            this.$el.find(\".empty-folder-message\").show();\n        } else {\n            this.$el.find(\".empty-folder-message\").hide();\n        }\n    },\n\n    sortColumnClicked: function(event) {\n        event.preventDefault();\n        this.current_sort_order = this.current_sort_order === \"asc\" ? \"desc\" : \"asc\";\n        this.current_sort_key = event.currentTarget.className.replace(\"sort-folder-\", \"\");\n        this.collection.sortFolder(this.current_sort_key, this.current_sort_order);\n        this.renderSortIcon();\n    },\n\n    /**\n     * User clicked the checkbox in the table heading\n     * @param  {context} event\n     */\n    selectAll: function(event) {\n        var selected = event.target.checked;\n        var self = this;\n        // Iterate each checkbox\n        $(\":checkbox\", \"#folder_list_body\").each(function() {\n            this.checked = selected;\n            var $row = $(this).closest(\"tr\");\n            // Change color of selected/unselected\n            if (selected) {\n                self.makeDarkRow($row);\n            } else {\n                self.makeWhiteRow($row);\n            }\n        });\n    },\n\n    /**\n     * Check checkbox if user clicks on the whole row or\n     *  on the checkbox itself\n     */\n    selectClickedRow: function(event) {\n        var checkbox = \"\";\n        var $row;\n        var source;\n        $row = $(event.target).closest(\"tr\");\n        if (event.target.localName === \"input\") {\n            checkbox = event.target;\n            source = \"input\";\n        } else if (event.target.localName === \"td\") {\n            checkbox = $row.find(\":checkbox\")[0];\n            source = \"td\";\n        }\n        if (checkbox.checked) {\n            if (source === \"td\") {\n                checkbox.checked = \"\";\n                this.makeWhiteRow($row);\n            } else if (source === \"input\") {\n                this.makeDarkRow($row);\n            }\n        } else {\n            if (source === \"td\") {\n                checkbox.checked = \"selected\";\n                this.makeDarkRow($row);\n            } else if (source === \"input\") {\n                this.makeWhiteRow($row);\n            }\n        }\n    },\n\n    makeDarkRow: function($row) {\n        $row.removeClass(\"light\").addClass(\"dark\");\n        $row.find(\"a\")\n            .removeClass(\"light\")\n            .addClass(\"dark\");\n        $row.find(\".fa-file-o\")\n            .removeClass(\"fa-file-o\")\n            .addClass(\"fa-file\");\n        $row.find(\".fa-folder-o\")\n            .removeClass(\"fa-folder-o\")\n            .addClass(\"fa-folder\");\n    },\n\n    makeWhiteRow: function($row) {\n        $row.removeClass(\"dark\").addClass(\"light\");\n        $row.find(\"a\")\n            .removeClass(\"dark\")\n            .addClass(\"light\");\n        $row.find(\".fa-file\")\n            .removeClass(\"fa-file\")\n            .addClass(\"fa-file-o\");\n        $row.find(\".fa-folder\")\n            .removeClass(\"fa-folder\")\n            .addClass(\"fa-folder-o\");\n    },\n\n    renderSortIcon: function() {\n        if (this.current_sort_order === \"asc\") {\n            $('[class*=\"sort-icon\"]')\n                .removeClass(\"fa-sort-alpha-desc\")\n                .removeClass(\"fa-sort-alpha-asc\");\n            $(`.sort-icon-${this.current_sort_key}`).addClass(\"fa-sort-alpha-asc\");\n        } else {\n            $(`.sort-icon-${this.current_sort_key}`).addClass(\"fa-sort-alpha-desc\");\n        }\n    },\n\n    templateFolder: function() {\n        return _.template(\n            [\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                \"<% _.each(path, function(path_item) { %>\",\n                \"<% if (path_item[0] != id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are in this folder\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                // FOLDER CONTENT\n                '<table data-library-id=\"<%- parent_library_id  %>\" class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th class=\"button_heading\"></th>',\n                '<th class=\"mid\" style=\"width: 20px; \" title=\"Check to select all datasets\"><input id=\"select-all-checkboxes\" style=\"margin: 0;\" type=\"checkbox\"></th>',\n                '<th><a class=\"sort-folder-name\" title=\"Click to reverse order\" href=\"#\">name</a> <span title=\"Sorted alphabetically\" class=\"sort-icon-name fa fa-sort-alpha-<%- order %>\"></span></th>',\n                '<th style=\"width:20%;\"><a class=\"sort-folder-description\" title=\"Click to reverse order\" href=\"#\">description</a> <span title=\"Sorted alphabetically\" class=\"sort-icon-description fa\"></span></th>',\n                '<th style=\"width:5%;\"><a class=\"sort-folder-file_ext\" title=\"Click to reverse order\" href=\"#\">data type</a> <span title=\"Sorted alphabetically\" class=\"sort-icon-file_ext fa\"></span></th>',\n                '<th style=\"width:10%;\">size</th>',\n                '<th style=\"width:160px;\">time updated (UTC)</th>',\n                '<th style=\"width:5%;\"><a class=\"sort-folder-state\" title=\"Click to reverse order\" href=\"#\">state</a> <span title=\"Sorted alphabetically\" class=\"sort-icon-state fa\"></span></th>',\n                '<th style=\"width:150px;\"></th> ',\n                \"</thead>\",\n                '<tbody id=\"folder_list_body\">',\n                '<tr id=\"first_folder_item\">',\n                \"<td>\",\n                '<a href=\"#<% if (upper_folder_id !== 0){ print(\"folders/\" + upper_folder_id)} %>\" title=\"Go to parent folder\" class=\"btn_open_folder btn btn-secondary btn-sm\">..<a>',\n                \"</td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"<td></td>\",\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                '<div class=\"empty-folder-message\" style=\"display:none;\">',\n                \"This folder is either empty or you do not have proper access permissions to see the contents. If you expected something to show up\",\n                ' please consult the <a href=\"https://galaxyproject.org/data-libraries/#permissions\" target=\"_blank\">library security wikipage</a>.',\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderListView: FolderListView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { Toast } from \"ui/toast\";\nimport { getGalaxyInstance } from \"app\";\n\n// galaxy library row view\nvar LibraryRowView = Backbone.View.extend({\n    events: {\n        \"click .edit_library_btn\": \"edit_button_clicked\",\n        \"click .cancel_library_btn\": \"cancel_library_modification\",\n        \"click .save_library_btn\": \"save_library_modification\",\n        \"click .delete_library_btn\": \"delete_library\",\n        \"click .undelete_library_btn\": \"undelete_library\"\n    },\n\n    edit_mode: false,\n\n    element_visibility_config: {\n        upload_library_btn: false,\n        edit_library_btn: false,\n        permission_library_btn: false,\n        save_library_btn: false,\n        cancel_library_btn: false,\n        delete_library_btn: false,\n        undelete_library_btn: false\n    },\n\n    initialize: function(library) {\n        this.render(library);\n    },\n\n    render: function(library) {\n        if (typeof library === \"undefined\") {\n            let Galaxy = getGalaxyInstance();\n            library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n            console.log(library);\n        }\n        this.prepareButtons(library);\n        var tmpl = this.templateRow();\n        this.setElement(\n            tmpl({\n                library: library,\n                button_config: this.element_visibility_config,\n                edit_mode: this.edit_mode\n            })\n        );\n        this.$el.show();\n        return this;\n    },\n\n    repaint: function(library) {\n        /* need to dispose manually because of the element removal in setElement\n    invoked in render() */\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip(\"dispose\");\n        /* we need to store the old element to be able to replace it with\n    new one */\n        var old_element = this.$el;\n        /* if user canceled the library param is undefined,\n      if user saved and succeeded the updated library is rendered */\n        this.render();\n        old_element.replaceWith(this.$el);\n        /* now we attach new tooltips to the newly created row element */\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    /**\n     * Function modifies the visibility of buttons for\n     * the filling of the row template of given library.\n     */\n    prepareButtons: function(library) {\n        var vis_config = this.element_visibility_config;\n\n        if (this.edit_mode === false) {\n            vis_config.save_library_btn = false;\n            vis_config.cancel_library_btn = false;\n            vis_config.delete_library_btn = false;\n            if (library.get(\"deleted\") === true) {\n                vis_config.undelete_library_btn = true;\n                vis_config.upload_library_btn = false;\n                vis_config.edit_library_btn = false;\n                vis_config.permission_library_btn = false;\n            } else if (library.get(\"deleted\") === false) {\n                vis_config.save_library_btn = false;\n                vis_config.cancel_library_btn = false;\n                vis_config.undelete_library_btn = false;\n                if (library.get(\"can_user_add\") === true) {\n                    vis_config.upload_library_btn = true;\n                }\n                if (library.get(\"can_user_modify\") === true) {\n                    vis_config.edit_library_btn = true;\n                }\n                if (library.get(\"can_user_manage\") === true) {\n                    vis_config.permission_library_btn = true;\n                }\n            }\n        } else if (this.edit_mode === true) {\n            vis_config.upload_library_btn = false;\n            vis_config.edit_library_btn = false;\n            vis_config.permission_library_btn = false;\n            vis_config.save_library_btn = true;\n            vis_config.cancel_library_btn = true;\n            vis_config.delete_library_btn = true;\n            vis_config.undelete_library_btn = false;\n        }\n\n        this.element_visibility_config = vis_config;\n    },\n\n    /* User clicked the 'edit' button on row so we render a new row\n    that allows editing */\n    edit_button_clicked: function() {\n        this.edit_mode = true;\n        this.repaint();\n    },\n\n    /* User clicked the 'cancel' button so we render normal rowView */\n    cancel_library_modification: function() {\n        // Toast.info('Modifications canceled');\n        this.edit_mode = false;\n        this.repaint();\n    },\n\n    save_library_modification: function() {\n        let Galaxy = getGalaxyInstance();\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var is_changed = false;\n\n        var new_name = this.$el.find(\".input_library_name\").val();\n        if (typeof new_name !== \"undefined\" && new_name !== library.get(\"name\")) {\n            if (new_name.length > 2) {\n                library.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                Toast.warning(\"Library name has to be at least 3 characters long.\");\n                return;\n            }\n        }\n\n        var new_description = this.$el.find(\".input_library_description\").val();\n        if (typeof new_description !== \"undefined\" && new_description !== library.get(\"description\")) {\n            library.set(\"description\", new_description);\n            is_changed = true;\n        }\n\n        var new_synopsis = this.$el.find(\".input_library_synopsis\").val();\n        if (typeof new_synopsis !== \"undefined\" && new_synopsis !== library.get(\"synopsis\")) {\n            library.set(\"synopsis\", new_synopsis);\n            is_changed = true;\n        }\n\n        if (is_changed) {\n            var row_view = this;\n            library.save(null, {\n                patch: true,\n                success: function(library) {\n                    row_view.edit_mode = false;\n                    row_view.repaint(library);\n                    Toast.success(\"Changes to library saved.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred while attempting to update the library.\");\n                    }\n                }\n            });\n        } else {\n            this.edit_mode = false;\n            this.repaint(library);\n            Toast.info(\"Nothing has changed.\");\n        }\n    },\n\n    delete_library: function() {\n        let Galaxy = getGalaxyInstance();\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var row_view = this;\n        // mark the library deleted\n        library.destroy({\n            success: function(library) {\n                library.set(\"deleted\", true);\n                // add the new deleted library back to the collection (Galaxy specialty)\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                if (Galaxy.libraries.preferences.get(\"with_deleted\") === false) {\n                    $(\".tooltip\").hide();\n                    row_view.repaint(library);\n                    row_view.$el.remove();\n                } else if (Galaxy.libraries.preferences.get(\"with_deleted\") === true) {\n                    row_view.repaint(library);\n                }\n                Toast.success(\"Library has been marked deleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred during deleting the library.\");\n                }\n            }\n        });\n    },\n\n    undelete_library: function() {\n        let Galaxy = getGalaxyInstance();\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var row_view = this;\n\n        // mark the library undeleted\n        library.url = `${library.urlRoot + library.id}?undelete=true`;\n        library.destroy({\n            success: function(library) {\n                // add the newly undeleted library back to the collection\n                // backbone does not accept changes through destroy, so update it too\n                library.set(\"deleted\", false);\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                row_view.repaint(library);\n                Toast.success(\"Library has been undeleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred while undeleting the library.\");\n                }\n            }\n        });\n    },\n\n    templateRow: function() {\n        return _.template(\n            [\n                '<tr class=\"<% if(library.get(\"deleted\") === true) { print(\"active\") } %>\" style=\"display:none;\" data-id=\"<%- library.get(\"id\") %>\">',\n                \"<% if(!edit_mode) { %>\",\n                '<% if(library.get(\"deleted\")) { %>',\n                '<td style=\"color:grey;\"><%- library.get(\"name\") %></td>',\n                \"<% } else { %>\",\n                '<td><a href=\"#folders/<%- library.get(\"root_folder_id\") %>\"><%- library.get(\"name\") %></a></td>',\n                \"<% } %>\",\n                '<% if(library.get(\"description\")) { %>',\n                '<% if( (library.get(\"description\")).length> 80 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"description\")) %>\"><%= _.escape(library.get(\"description\")).substring(0, 80) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"description\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\")) { %>',\n                '<% if( (library.get(\"synopsis\")).length> 120 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"synopsis\")) %>\"><%= _.escape(library.get(\"synopsis\")).substring(0, 120) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"synopsis\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                \"<% } else if(edit_mode){ %>\",\n                '<td><textarea rows=\"4\" class=\"form-control input_library_name\" placeholder=\"name\" ><%- library.get(\"name\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_description\" placeholder=\"description\" ><%- library.get(\"description\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_synopsis\" placeholder=\"synopsis\" ><%- library.get(\"synopsis\") %></textarea></td>',\n                \"<% } %>\",\n                '<td class=\"right-center\">',\n                '<% if( (library.get(\"public\")) && (library.get(\"deleted\") === false) ) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"left\" title=\"Unrestricted library\" style=\"color:grey;\" class=\"fa fa-globe fa-lg\"> </span>',\n                \"<% }%>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"left\" title=\"Modify \\'<%- library.get(\"name\") %>\\'\" class=\"btn btn-sm edit_library_btn\" type=\"button\" style=\"<% if(button_config.edit_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-pencil\"></span> Edit</button>',\n                '<a data-toggle=\"tooltip\" data-placement=\"left\" title=\"Permissions of \\'<%- library.get(\"name\") %>\\'\" href=\"#library/<%- library.get(\"id\") %>/permissions\"><button class=\"btn btn-sm permission_library_btn\" type=\"button\" style=\"<% if(button_config.permission_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-group\"></span> Manage</button></a>',\n                '<button data-toggle=\"tooltip\" data-placement=\"left\" title=\"Save changes\" class=\"btn btn-sm save_library_btn\" type=\"button\" style=\"<% if(button_config.save_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-floppy-o\"></span> Save</button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"left\" title=\"Discard changes\" class=\"btn btn-sm cancel_library_btn\" type=\"button\" style=\"<% if(button_config.cancel_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-times\"></span> Cancel</button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"left\" title=\"Delete \\'<%- library.get(\"name\") %>\\'\" class=\"btn btn-sm delete_library_btn\" type=\"button\" style=\"<% if(button_config.delete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-trash-o\"></span> Delete</button>',\n                // For deleted libraries\n                '<span data-toggle=\"tooltip\" data-placement=\"left\" title=\"Marked deleted\" style=\"color:grey; <% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\" class=\"fa fa-ban fa-lg\"></span>',\n                '<button data-toggle=\"tooltip\" data-placement=\"left\" title=\"Undelete \\'<%- library.get(\"name\") %>\\' \" class=\"btn btn-sm undelete_library_btn\" type=\"button\" style=\"<% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-unlock\"></span> Undelete</button>',\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryRowView: LibraryRowView\n};\n","import $ from \"jquery\";\nimport _ from \"libs/underscore\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_library_libraryrow_view from \"mvc/library/library-libraryrow-view\";\n\nvar LibraryListView = Backbone.View.extend({\n    el: \"#libraries_element\",\n\n    events: {\n        \"click .sort-libraries-link\": \"sort_clicked\"\n    },\n\n    defaults: {\n        page_count: null,\n        show_page: null,\n        all_fetched: false\n    },\n\n    /**\n     * Initialize and fetch the libraries from server.\n     * Async render afterwards.\n     * @param  {object} options an object with options\n     */\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, options, this.defaults);\n        var that = this;\n        this.modal = null;\n        // collection of {Item}s\n        this.collection = new mod_library_model.Libraries();\n        this.collection.url = `${this.collection.urlRoot}?deleted=false`;\n        this.collection.fetch({\n            success: function() {\n                that.render();\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Render the libraries table either from the object's own collection,\n     * or from a given array of library models,\n     * or render an empty list in case no data is given.\n     */\n    render: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n        this.setElement(\"#libraries_element\");\n        var template = this.templateLibraryList();\n        var libraries_to_render = null;\n        var models = null;\n        var is_public = model => model.get(\"public\") === true;\n        $(\".tooltip\").hide();\n        if (typeof options !== \"undefined\") {\n            models = typeof options.models !== \"undefined\" ? options.models : null;\n        }\n        if (this.collection !== null && models === null) {\n            this.sortLibraries();\n            if (Galaxy.libraries.preferences.get(\"with_deleted\")) {\n                libraries_to_render = this.collection.models;\n            } else {\n                libraries_to_render = this.collection.where({\n                    deleted: false\n                });\n            }\n            if (Galaxy.libraries.preferences.get(\"without_restricted\")) {\n                libraries_to_render = _.filter(libraries_to_render, is_public);\n            }\n        } else if (models !== null) {\n            if (Galaxy.libraries.preferences.get(\"with_deleted\")) {\n                libraries_to_render = models;\n            } else {\n                var is_deleted = model => model.get(\"deleted\") === false;\n                libraries_to_render = _.filter(models, is_deleted);\n            }\n            if (Galaxy.libraries.preferences.get(\"without_restricted\")) {\n                libraries_to_render = _.filter(libraries_to_render, is_public);\n            }\n        } else {\n            libraries_to_render = [];\n        }\n\n        // pagination\n        if (this.options.show_page === null || this.options.show_page < 1) {\n            this.options.show_page = 1;\n        }\n        this.options.total_libraries_count = libraries_to_render.length;\n        var page_start = Galaxy.libraries.preferences.get(\"library_page_size\") * (this.options.show_page - 1);\n        this.options.page_count = Math.ceil(\n            this.options.total_libraries_count / Galaxy.libraries.preferences.get(\"library_page_size\")\n        );\n        if (this.options.total_libraries_count > 0 && page_start < this.options.total_libraries_count) {\n            libraries_to_render = libraries_to_render.slice(\n                page_start,\n                page_start + Galaxy.libraries.preferences.get(\"library_page_size\")\n            );\n            this.options.libraries_shown = libraries_to_render.length;\n            // User requests page with no libraries\n            if (\n                Galaxy.libraries.preferences.get(\"library_page_size\") * this.options.show_page >\n                this.options.total_libraries_count + Galaxy.libraries.preferences.get(\"library_page_size\")\n            ) {\n                libraries_to_render = [];\n            }\n            this.$el.html(\n                template({\n                    length: 1,\n                    order: Galaxy.libraries.preferences.get(\"sort_order\"),\n                    search_term: Galaxy.libraries.libraryToolbarView.options.search_term\n                })\n            );\n            Galaxy.libraries.libraryToolbarView.renderPaginator(this.options);\n            this.renderRows(libraries_to_render);\n        } else {\n            this.$el.html(\n                template({\n                    length: 0,\n                    order: Galaxy.libraries.preferences.get(\"sort_order\"),\n                    search_term: Galaxy.libraries.libraryToolbarView.options.search_term\n                })\n            );\n            Galaxy.libraries.libraryToolbarView.renderPaginator(this.options);\n        }\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    fetchDeleted: function() {\n        if (this.options.all_fetched) {\n            this.render();\n        } else {\n            var that = this;\n            this.collection.url = `${this.collection.urlRoot}?deleted=true`;\n            this.collection.fetch({\n                remove: false,\n                success: function() {\n                    that.options.all_fetched = true;\n                    that.render();\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    /**\n     * Render all given models as rows in the library list\n     * @param  {array} libraries_to_render array of library models to render\n     */\n    renderRows: function(libraries_to_render) {\n        for (var i = 0; i < libraries_to_render.length; i++) {\n            var library = libraries_to_render[i];\n            this.renderOne({ library: library });\n        }\n    },\n\n    /**\n     * Create a view for the given model and add it to the libraries view.\n     * @param {Library} model of the view that will be rendered\n     */\n    renderOne: function(options) {\n        var library = options.library;\n        var rowView = new mod_library_libraryrow_view.LibraryRowView(library);\n        this.$el.find(\"#library_list_body\").append(rowView.el);\n    },\n\n    /**\n     * Table heading was clicked, update sorting preferences and re-render.\n     * @return {[type]} [description]\n     */\n    sort_clicked: function() {\n        let Galaxy = getGalaxyInstance();\n        if (Galaxy.libraries.preferences.get(\"sort_order\") === \"asc\") {\n            Galaxy.libraries.preferences.set({ sort_order: \"desc\" });\n        } else {\n            Galaxy.libraries.preferences.set({ sort_order: \"asc\" });\n        }\n        this.render();\n    },\n\n    /**\n     * Sort the underlying collection according to the parameters received.\n     * Currently supports only sorting by name.\n     */\n    sortLibraries: function() {\n        let Galaxy = getGalaxyInstance();\n        if (Galaxy.libraries.preferences.get(\"sort_by\") === \"name\") {\n            if (Galaxy.libraries.preferences.get(\"sort_order\") === \"asc\") {\n                this.collection.sortLibraries(\"name\", \"asc\");\n            } else if (Galaxy.libraries.preferences.get(\"sort_order\") === \"desc\") {\n                this.collection.sortLibraries(\"name\", \"desc\");\n            }\n        }\n    },\n\n    /**\n     * In case the search_term is not empty perform the search and render\n     * the result. Render all visible libraries otherwise.\n     * @param  {string} search_term string to search for\n     */\n    searchLibraries: function(search_term) {\n        var trimmed_term = $.trim(search_term);\n        if (trimmed_term !== \"\") {\n            var results = null;\n            results = this.collection.search(search_term);\n            this.options.searching = true;\n            this.render({ models: results, show_page: 1 });\n        } else {\n            this.options.searching = false;\n            this.render();\n        }\n    },\n\n    // MMMMMMMMMMMMMMMMMM\n    // === TEMPLATES ====\n    // MMMMMMMMMMMMMMMMMM\n\n    templateLibraryList: function() {\n        return _.template(\n            [\n                '<div class=\"library_container table-responsive\">',\n                \"<% if(length === 0) { %>\",\n                \"<% if(search_term.length > 0) { %>\",\n                \"<div>\",\n                \"There are no libraries matching your search. Try different keyword.\",\n                \"</div>\",\n                \"<% } else{ %>\",\n                \"<div>\",\n                \"There are no libraries visible to you here. If you expected some to show up please consult the\",\n                ' <a href=\"https://galaxyproject.org/data-libraries/#permissions\" target=\"_blank\">library security wikipage</a>.',\n                \"</div>\",\n                \"<% }%>\",\n                \"<% } else{ %>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width:30%;\">',\n                '<a class=\"sort-libraries-link\" title=\"Click to reverse order\" href=\"#\">',\n                \"name\",\n                \"</a>\",\n                '<span title=\"Sorted alphabetically\" class=\"fa fa-sort-alpha-<%- order %>\"/>',\n                \"</th>\",\n                '<th style=\"width:22%;\">description</th>',\n                '<th style=\"width:22%;\">synopsis</th> ',\n                '<th style=\"width:26%;\"></th>',\n                \"</thead>\",\n                '<tbody id=\"library_list_body\">',\n                // library item views will attach here\n                \"</tbody>\",\n                \"</table>\",\n                \"<% }%>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryListView: LibraryListView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _l from \"utils/localization\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport { getGalaxyInstance } from \"app\";\n\n/**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\nvar LibraryToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: {\n        search_term: \"\"\n    },\n\n    events: {\n        \"click #create_new_library_btn\": \"createLibraryFromModal\",\n        \"click #include_deleted_chk\": \"includeDeletedChecked\",\n        \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n        \"click .page_size_prompt\": \"showPageSizePrompt\",\n        \"keyup .library-search-input\": \"searchLibraries\"\n    },\n\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, options, this.defaults);\n        this.render();\n    },\n\n    render: function() {\n        let Galaxy = getGalaxyInstance();\n        var toolbar_template = this.templateToolBar();\n        var is_admin = false;\n        var is_anonym = true;\n        if (Galaxy.user) {\n            is_admin = Galaxy.user.isAdmin();\n            is_anonym = Galaxy.user.isAnonymous();\n        }\n        this.$el.html(toolbar_template({ admin_user: is_admin, anon_user: is_anonym }));\n        if (is_admin) {\n            this.$el.find(\"#include_deleted_chk\")[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n            this.$el.find(\"#exclude_restricted_chk\")[0].checked = Galaxy.libraries.preferences.get(\n                \"without_restricted\"\n            );\n        }\n    },\n\n    /**\n     * Renders the element that shows pages into its div within the toolbar.\n     */\n    renderPaginator: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n        var paginator_template = this.templatePaginator();\n        this.$el.find(\".library-paginator\").html(\n            paginator_template({\n                show_page: parseInt(this.options.show_page),\n                page_count: parseInt(this.options.page_count),\n                total_libraries_count: this.options.total_libraries_count,\n                libraries_shown: this.options.libraries_shown,\n                library_page_size: Galaxy.libraries.preferences.get(\"library_page_size\")\n            })\n        );\n    },\n\n    /**\n     * User clicked on 'New library' button. Show modal to\n     * satisfy the wish.\n     */\n    createLibraryFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        let Galaxy = getGalaxyInstance();\n        var self = this;\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Create New Library\"),\n            body: this.templateNewLibraryInModal(),\n            buttons: {\n                Create: function() {\n                    self.createNewLibrary();\n                },\n                Close: function() {\n                    self.modal.hide();\n                }\n            }\n        });\n    },\n\n    /**\n     * Create the new library using the API asynchronously.\n     */\n    createNewLibrary: function() {\n        let Galaxy = getGalaxyInstance();\n        var libraryDetails = this.serializeNewLibrary();\n        if (this.validateNewLibrary(libraryDetails)) {\n            var library = new mod_library_model.Library();\n            var self = this;\n            library.save(libraryDetails, {\n                success: function(library) {\n                    Galaxy.libraries.libraryListView.collection.add(library);\n                    self.modal.hide();\n                    self.clearLibraryModal();\n                    Galaxy.libraries.libraryListView.render();\n                    Toast.success(\"Library created.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                }\n            });\n        } else {\n            Toast.error(\"Library's name is missing.\");\n        }\n        return false;\n    },\n\n    /**\n     * Show user the propmpt to change the number of libs shown on page.\n     */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        let Galaxy = getGalaxyInstance();\n        var library_page_size = prompt(\n            \"How many libraries per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"library_page_size\")\n        );\n        if (library_page_size != null && library_page_size == parseInt(library_page_size)) {\n            Galaxy.libraries.preferences.set({\n                library_page_size: parseInt(library_page_size)\n            });\n            Galaxy.libraries.libraryListView.render({ show_page: 1 });\n        }\n    },\n\n    /**\n     * Clear the library modal once it is saved.\n     */\n    clearLibraryModal: function() {\n        $(\"input[name='Name']\").val(\"\");\n        $(\"input[name='Description']\").val(\"\");\n        $(\"input[name='Synopsis']\").val(\"\");\n    },\n\n    /**\n     * Prepare new library variables to be submitted to API.\n     */\n    serializeNewLibrary: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val(),\n            synopsis: $(\"input[name='Synopsis']\").val()\n        };\n    },\n\n    /**\n     * Check whether entered values are valid.\n     */\n    validateNewLibrary: function(libraryDetails) {\n        return libraryDetails.name !== \"\";\n    },\n\n    /**\n     * Include or exclude deleted libraries in the view.\n     */\n    includeDeletedChecked: function(event) {\n        let Galaxy = getGalaxyInstance();\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ with_deleted: true });\n            Galaxy.libraries.libraryListView.fetchDeleted();\n        } else {\n            Galaxy.libraries.preferences.set({ with_deleted: false });\n            Galaxy.libraries.libraryListView.render();\n        }\n    },\n\n    /**\n     * Include or exclude restricted libraries in the view.\n     */\n    excludeRestrictedChecked: function(event) {\n        let Galaxy = getGalaxyInstance();\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ without_restricted: true });\n        } else {\n            Galaxy.libraries.preferences.set({ without_restricted: false });\n        }\n        Galaxy.libraries.libraryListView.render();\n    },\n\n    /**\n     * Take the contents of the search field and send it to the list view\n     * to query the collection of libraries.\n     */\n    searchLibraries: function(event) {\n        let Galaxy = getGalaxyInstance();\n        var search_term = $(\".library-search-input\").val();\n        this.options.search_term = search_term;\n        Galaxy.libraries.libraryListView.searchLibraries(search_term);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            `<div class=\"library_style_container\">\n                <div class=\"d-flex align-items-center mb-2\">\n                    <a class=\"btn btn-secondary mr-1\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go to first page\" href=\"#\">\n                        <span class=\"fa fa-home\"/>\n                    </a>\n                    <a class=\"library-help-button btn btn-secondary mr-1\" data-toggle=\"tooltip\" title=\"See this screen annotated\" href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">\n                        <span class=\"fa fa-question\"/>\n                    </a>\n                    <% if(admin_user === true) { %>\n                        <button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create new library\" id=\"create_new_library_btn\" class=\"mr-1 btn btn-secondary\" type=\"button\">\n                            <span class=\"fa fa-plus\"/>\n                        </button>\n                    <% } %>\n                    <div class=\"d-flex align-items-center library-paginator mr-1\" />\n                        <form class=\"form-inline mr-1\">\n                            <input type=\"text\" class=\"form-control library-search-input mr-1\" placeholder=\"Great Library\" size=\"15\">\n                            <% if(admin_user === true) { %>\n                                <div class=\"form-check mr-1\">\n                                    <input class=\"form-check-input\" id=\"include_deleted_chk\" type=\"checkbox\"/>\n                                    <label class=\"form-check-label\" for=\"include_deleted_chk\">include deleted</label>\n                                </div>\n                                <div class=\"form-check mr-1\">\n                                    <input class=\"form-check-input\" id=\"exclude_restricted_chk\" type=\"checkbox\"/>\n                                    <label class=\"form-check-label\" for=\"exclude_restricted_chk\">exclude restricted</label>\n                                </div>\n                            <% } %>\n                        </form>\n                    </div>\n                    <div id=\"libraries_element\" />\n                </div>\n            </div>`\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination mr-1\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"page-item active\">',\n                '<a class=\"page-link\" href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                '<span class=\"mr-1\">',\n                ' <%- libraries_shown %> libraries shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- library_page_size %> per page\" class=\"page_size_prompt\">(change)</a>',\n                \"</span>\",\n                '<span class=\"mr-1\">',\n                \" <%- total_libraries_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewLibraryInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_library_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryToolbarView: LibraryToolbarView\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport mod_utils from \"utils/utils\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_select from \"mvc/ui/ui-select\";\nimport LIST_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport PAIRED_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport HDCA_MODEL from \"mvc/history/hdca-model\";\nimport \"libs/jquery/jstree\";\n\nvar FolderToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    events: {\n        \"click .toolbtn-create-folder\": \"createFolderFromModal\",\n        \"click .toolbtn-bulk-import\": \"importToHistoryModal\",\n        \"click .include-deleted-datasets-chk\": \"checkIncludeDeleted\",\n        \"click .toolbtn-bulk-delete\": \"deleteSelectedItems\",\n        \"click .toolbtn-show-locinfo\": \"showLocInfo\",\n        \"click .page-size-prompt\": \"showPageSizePrompt\",\n        \"click .toolbtn-collection-import\": \"showCollectionSelect\"\n    },\n\n    defaults: {\n        can_add_library_item: false,\n        contains_file_or_folder: false,\n        chain_call_control: {\n            total_number: 0,\n            failed_number: 0\n        },\n        disabled_jstree_element: \"folders\"\n    },\n\n    modal: null,\n\n    // directory browsing object\n    jstree: null,\n\n    // user's histories\n    histories: null,\n\n    // genome select\n    select_genome: null,\n\n    // extension select\n    select_extension: null,\n\n    // extension types\n    list_extensions: [],\n\n    // datatype placeholder for extension auto-detection\n    auto: {\n        id: \"auto\",\n        text: \"Auto-detect\",\n        description:\n            \"This system will try to detect the file type automatically.\" +\n            \" If your file is not detected properly as one of the known formats,\" +\n            \" it most likely means that it has some format problems (e.g., different\" +\n            \" number of columns on different rows). You can still coerce the system\" +\n            \" to set your data to the format you think it should be.\" +\n            \" You can also upload compressed files, which will automatically be decompressed.\"\n    },\n\n    // genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        this.options = _.defaults(options || {}, this.defaults);\n        this.fetchExtAndGenomes();\n        this.render();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        let Galaxy = getGalaxyInstance();\n        var toolbar_template = this.templateToolBar();\n        var template_defaults = {\n            id: this.options.id,\n            is_admin: false,\n            is_anonym: true,\n            multiple_add_dataset_options: false,\n            Galaxy: Galaxy\n        };\n        if (Galaxy.user) {\n            template_defaults.is_admin = Galaxy.user.isAdmin();\n            template_defaults.is_anonym = Galaxy.user.isAnonymous();\n            if (\n                Galaxy.config.user_library_import_dir !== null ||\n                Galaxy.config.allow_library_path_paste !== false ||\n                Galaxy.config.library_import_dir !== null\n            ) {\n                template_defaults.multiple_add_dataset_options = true;\n            }\n        }\n        this.$el.html(toolbar_template(template_defaults));\n    },\n\n    /**\n     * Called from FolderListView when needed.\n     * @param  {object} options common options\n     */\n    renderPaginator: function(options) {\n        this.options = _.extend(this.options, options);\n        let Galaxy = getGalaxyInstance();\n        var paginator_template = this.templatePaginator();\n        $(\"body\")\n            .find(\".folder-paginator\")\n            .html(\n                paginator_template({\n                    id: this.options.id,\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_items_count: this.options.total_items_count,\n                    items_shown: this.options.items_shown,\n                    folder_page_size: Galaxy.libraries.preferences.get(\"folder_page_size\")\n                })\n            );\n    },\n\n    configureElements: function(options) {\n        this.options = _.extend(this.options, options);\n        let Galaxy = getGalaxyInstance();\n\n        if (this.options.can_add_library_item === true) {\n            $(\".add-library-items\").show();\n        } else {\n            $(\".add-library-items\").hide();\n        }\n        if (this.options.contains_file_or_folder === true) {\n            if (Galaxy.user) {\n                if (!Galaxy.user.isAnonymous()) {\n                    $(\".logged-dataset-manipulation\").show();\n                    $(\".dataset-manipulation\").show();\n                } else {\n                    $(\".dataset-manipulation\").show();\n                    $(\".logged-dataset-manipulation\").hide();\n                }\n            } else {\n                $(\".logged-dataset-manipulation\").hide();\n                $(\".dataset-manipulation\").hide();\n            }\n        } else {\n            $(\".logged-dataset-manipulation\").hide();\n            $(\".dataset-manipulation\").hide();\n        }\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    createFolderFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        let Galaxy = getGalaxyInstance();\n        var template = this.templateNewFolderInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Create New Folder\"),\n            body: template(),\n            buttons: {\n                Create: () => {\n                    this.createNewFolderEvent();\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    createNewFolderEvent: function() {\n        let Galaxy = getGalaxyInstance();\n        var folderDetails = this.serializeNewFolder();\n        if (this.validateNewFolder(folderDetails)) {\n            var folder = new mod_library_model.FolderAsModel();\n            var url_items = Backbone.history.fragment.split(\"/\");\n            var current_folder_id;\n            if (url_items.indexOf(\"page\") > -1) {\n                current_folder_id = url_items[url_items.length - 3];\n            } else {\n                current_folder_id = url_items[url_items.length - 1];\n            }\n            folder.url = folder.urlRoot + current_folder_id;\n\n            folder.save(folderDetails, {\n                success: function(folder) {\n                    Galaxy.modal.hide();\n                    Toast.success(\"Folder created.\");\n                    folder.set({ type: \"folder\" });\n                    Galaxy.libraries.folderListView.collection.add(folder);\n                },\n                error: function(model, response) {\n                    Galaxy.modal.hide();\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                }\n            });\n        } else {\n            Toast.error(\"Folder's name is missing.\");\n        }\n        return false;\n    },\n\n    serializeNewFolder: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val()\n        };\n    },\n\n    validateNewFolder: function(folderDetails) {\n        return folderDetails.name !== \"\";\n    },\n\n    importToHistoryModal: function(e) {\n        e.preventDefault();\n        let Galaxy = getGalaxyInstance();\n        var $checkedValues = this.findCheckedRows();\n        var template = this.templateImportIntoHistoryModal();\n        if ($checkedValues.length === 0) {\n            Toast.info(\"You must select some datasets first.\");\n        } else {\n            var promise = this.fetchUserHistories();\n            promise\n                .done(() => {\n                    this.modal = Galaxy.modal;\n                    this.modal.show({\n                        closing_events: true,\n                        title: _l(\"Import into History\"),\n                        body: template({\n                            histories: this.histories.models\n                        }),\n                        buttons: {\n                            Import: () => {\n                                this.importAllIntoHistory();\n                            },\n                            Close: () => {\n                                Galaxy.modal.hide();\n                            }\n                        }\n                    });\n                })\n                .fail((model, response) => {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                });\n        }\n    },\n\n    fetchUserHistories: function() {\n        this.histories = new mod_library_model.GalaxyHistories();\n        var promise = this.histories.fetch();\n        return promise;\n    },\n\n    importAllIntoHistory: function() {\n        this.modal.disableButton(\"Import\");\n        var new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    this.processImportToHistory(new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    Toast.error(\"An error occurred.\");\n                })\n                .always(() => {\n                    this.modal.enableButton(\"Import\");\n                });\n        } else {\n            var history_id = $(\"select[name=import_to_history] option:selected\").val();\n            var history_name = $(\"select[name=import_to_history] option:selected\").text();\n            this.processImportToHistory(history_id, history_name);\n            this.modal.enableButton(\"Import\");\n        }\n    },\n\n    createNewHistory: function(new_history_name) {\n        var promise = $.post(`${getAppRoot()}api/histories`, { name: new_history_name });\n        return promise;\n    },\n\n    processImportToHistory: function(history_id, history_name) {\n        var checked_items = this.findCheckedItems();\n        var items_to_import = [];\n        // prepare the dataset objects to be imported\n        for (let i = checked_items.dataset_ids.length - 1; i >= 0; i--) {\n            let library_dataset_id = checked_items.dataset_ids[i];\n            let historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_dataset_id;\n            historyItem.source = \"library\";\n            items_to_import.push(historyItem);\n        }\n        // prepare the folder objects to be imported\n        for (let i = checked_items.folder_ids.length - 1; i >= 0; i--) {\n            let library_folder_id = checked_items.folder_ids[i];\n            let historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_folder_id;\n            historyItem.source = \"library_folder\";\n            items_to_import.push(historyItem);\n        }\n        this.initChainCallControl({\n            length: items_to_import.length,\n            action: \"to_history\",\n            history_name: history_name\n        });\n        // set the used history as current so user will see the last one\n        // that he imported into in the history panel on the 'analysis' page\n        $.getJSON(`${getAppRoot()}history/set_as_current?id=${history_id}`);\n        this.chainCallImportingIntoHistory(items_to_import, history_name);\n    },\n\n    /**\n     * Update progress bar in modal.\n     */\n    updateProgress: function() {\n        this.progress += this.progressStep;\n        $(\".progress-bar-import\").width(`${Math.round(this.progress)}%`);\n        var txt_representation = `${Math.round(this.progress)}% Complete`;\n        $(\".completion_span\").text(txt_representation);\n    },\n\n    /**\n     * Download selected datasets. Called from the router.\n     * @param  {str} format    requested archive format\n     */\n    download: function(format) {\n        var checked_items = this.findCheckedItems();\n        var url = `${getAppRoot()}api/libraries/datasets/download/${format}`;\n        var data = { ld_ids: checked_items.dataset_ids, folder_ids: checked_items.folder_ids };\n        this.processDownload(url, data, \"get\");\n    },\n\n    /**\n     * Create hidden form and submit it through POST\n     * to initialize the download.\n     * @param  {str} url    url to call\n     * @param  {obj} data   data to include in the request\n     * @param  {str} method method of the request\n     */\n    processDownload: function(url, data, method) {\n        if (url && data) {\n            // data can be string of parameters or array/object\n            data = typeof data === \"string\" ? data : $.param(data);\n            // split params into form inputs\n            var inputs = \"\";\n            $.each(data.split(\"&\"), function() {\n                var pair = this.split(\"=\");\n                inputs += `<input type=\"hidden\" name=\"${pair[0]}\" value=\"${pair[1]}\" />`;\n            });\n            // send request\n            $(`<form action=\"${url}\" method=\"${method || \"post\"}\">${inputs}</form>`)\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n            Toast.info(\"Your download will begin soon.\");\n        } else {\n            Toast.error(\"An error occurred.\");\n        }\n    },\n\n    addFilesFromHistoryModal: function() {\n        let Galaxy = getGalaxyInstance();\n        this.histories = new mod_library_model.GalaxyHistories();\n        this.histories\n            .fetch()\n            .done(() => {\n                this.modal = Galaxy.modal;\n                var template_modal = this.templateAddFilesFromHistory();\n                this.modal.show({\n                    closing_events: true,\n                    title: _l(\"Adding datasets from your history\"),\n                    body: template_modal({\n                        histories: this.histories.models\n                    }),\n                    buttons: {\n                        Add: () => {\n                            this.addAllDatasetsFromHistory();\n                        },\n                        Close: () => {\n                            Galaxy.modal.hide();\n                        }\n                    },\n                    closing_callback: () => {\n                        Galaxy.libraries.library_router.navigate(`folders/${this.id}`, { trigger: true });\n                    }\n                });\n                this.fetchAndDisplayHistoryContents(this.histories.models[0].id);\n                $(\"#dataset_add_bulk\").change(event => {\n                    this.fetchAndDisplayHistoryContents(event.target.value);\n                });\n            })\n            .fail((model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            });\n    },\n\n    /**\n     * Create modal for importing from Galaxy path.\n     */\n    importFilesFromPathModal: function() {\n        let Galaxy = getGalaxyInstance();\n        this.modal = Galaxy.modal;\n        var template_modal = this.templateImportPathModal();\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please enter paths to import\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromPathsClicked(this);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n        this.renderSelectBoxes();\n    },\n\n    /**\n     * Request all extensions and genomes from Galaxy\n     * and save them in sorted arrays.\n     */\n    fetchExtAndGenomes: function() {\n        mod_utils.get({\n            url: `${getAppRoot()}api/datatypes?extension_only=False`,\n            success: datatypes => {\n                this.list_extensions = [];\n                for (let key in datatypes) {\n                    this.list_extensions.push({\n                        id: datatypes[key].extension,\n                        text: datatypes[key].extension,\n                        description: datatypes[key].description,\n                        description_url: datatypes[key].description_url\n                    });\n                }\n                this.list_extensions.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                this.list_extensions.unshift(this.auto);\n            },\n            cache: true\n        });\n        mod_utils.get({\n            url: `${getAppRoot()}api/genomes`,\n            success: genomes => {\n                this.list_genomes = [];\n                for (let key in genomes) {\n                    this.list_genomes.push({\n                        id: genomes[key][1],\n                        text: genomes[key][0]\n                    });\n                }\n                this.list_genomes.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n            },\n            cache: true\n        });\n    },\n\n    renderSelectBoxes: function() {\n        let Galaxy = getGalaxyInstance();\n        // This won't work properly unlesss we already have the data fetched.\n        // See this.fetchExtAndGenomes()\n        this.select_genome = new mod_select.View({\n            css: \"library-genome-select\",\n            data: this.list_genomes,\n            container: Galaxy.modal.$el.find(\"#library_genome_select\"),\n            value: \"?\"\n        });\n        this.select_extension = new mod_select.View({\n            css: \"library-extension-select\",\n            data: this.list_extensions,\n            container: Galaxy.modal.$el.find(\"#library_extension_select\"),\n            value: \"auto\"\n        });\n    },\n\n    /**\n     * Create modal for importing from given directory\n     * on Galaxy. Bind jQuery events.\n     */\n    importFilesFromGalaxyFolderModal: function(options) {\n        var template_modal = this.templateBrowserModal();\n        let Galaxy = getGalaxyInstance();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please select folders or files\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromJstreePath(this, options);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n\n        $(\".libimport-select-all\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"check_all\");\n        });\n        $(\".libimport-select-none\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"uncheck_all\");\n        });\n\n        this.renderSelectBoxes();\n        options.disabled_jstree_element = \"folders\";\n        this.renderJstree(options);\n\n        $(\"input[type=radio]\").change(event => {\n            if (event.target.value === \"jstree-disable-folders\") {\n                options.disabled_jstree_element = \"folders\";\n                this.renderJstree(options);\n                $(\".jstree-folders-message\").hide();\n                $(\".jstree-preserve-structure\").hide();\n                $(\".jstree-files-message\").show();\n            } else if (event.target.value === \"jstree-disable-files\") {\n                $(\".jstree-files-message\").hide();\n                $(\".jstree-folders-message\").show();\n                $(\".jstree-preserve-structure\").show();\n                options.disabled_jstree_element = \"files\";\n                this.renderJstree(options);\n            }\n        });\n    },\n\n    /**\n     * Fetch the contents of user directory on Galaxy\n     * and render jstree component based on received\n     * data.\n     * @param  {[type]} options [description]\n     */\n    renderJstree: function(options) {\n        this.options = _.extend(this.options, options);\n        var target = options.source || \"userdir\";\n        var disabled_jstree_element = this.options.disabled_jstree_element;\n        this.jstree = new mod_library_model.Jstree();\n        this.jstree.url = `${this.jstree.urlRoot}?target=${target}&format=jstree&disable=${disabled_jstree_element}`;\n        this.jstree.fetch({\n            success: (model, response) => {\n                $(\"#jstree_browser\").jstree(\"destroy\");\n                $(\"#jstree_browser\").jstree({\n                    core: {\n                        data: model\n                    },\n                    plugins: [\"types\", \"checkbox\"],\n                    types: {\n                        folder: {\n                            icon: \"jstree-folder\"\n                        },\n                        file: {\n                            icon: \"jstree-file\"\n                        }\n                    },\n                    checkbox: {\n                        three_state: false\n                    }\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    if (response.responseJSON.err_code === 404001) {\n                        Toast.warning(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(response.responseJSON.err_msg);\n                    }\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Take the paths from the textarea, split it, create\n     * a request queue and call a function that starts sending\n     * one by one to be imported on the server.\n     */\n    importFromPathsClicked: function() {\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var paths = $(\"textarea#import_paths\").val();\n        var valid_paths = [];\n        if (!paths) {\n            Toast.info(\"Please enter a path relative to Galaxy root.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            paths = paths.split(\"\\n\");\n            for (let i = paths.length - 1; i >= 0; i--) {\n                var trimmed = paths[i].trim();\n                if (trimmed.length !== 0) {\n                    valid_paths.push(trimmed);\n                }\n            }\n            this.initChainCallControl({\n                length: valid_paths.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallImportingFolders({\n                paths: valid_paths,\n                preserve_dirs: preserve_dirs,\n                link_data: link_data,\n                space_to_tab: space_to_tab,\n                to_posix_lines: to_posix_lines,\n                source: \"admin_path\",\n                file_type: file_type,\n                tag_using_filenames: tag_using_filenames,\n                dbkey: dbkey\n            });\n        }\n    },\n\n    /**\n     * Initialize the control of chaining requests\n     * in the current modal.\n     * @param {int} length The number of items in the chain call.\n     */\n    initChainCallControl: function(options) {\n        let Galaxy = getGalaxyInstance();\n        var template;\n        switch (options.action) {\n            case \"adding_datasets\":\n                template = this.templateAddingDatasetsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(\n                    template({\n                        folder_name: this.options.folder_name\n                    })\n                );\n                break;\n            case \"deleting_datasets\":\n                template = this.templateDeletingItemsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template());\n                break;\n            case \"to_history\":\n                template = this.templateImportIntoHistoryProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template({ history_name: options.history_name }));\n                break;\n            default:\n                Galaxy.emit.error(\"Wrong action specified.\", \"datalibs\");\n                break;\n        }\n\n        // var progress_bar_tmpl = this.templateAddingDatasetsProgressBar();\n        // this.modal.$el.find( '.modal-body' ).html( progress_bar_tmpl( { folder_name : this.options.folder_name } ) );\n        this.progress = 0;\n        this.progressStep = 100 / options.length;\n        this.options.chain_call_control.total_number = options.length;\n        this.options.chain_call_control.failed_number = 0;\n    },\n\n    /**\n     * Take the selected items from the jstree, create a request queue\n     * and send them one by one to the server for importing into\n     * the current folder.\n     *\n     * jstree.js has to be loaded before\n     * @see renderJstree\n     */\n    importFromJstreePath: function(that, options) {\n        var all_nodes = $(\"#jstree_browser\")\n            .jstree()\n            .get_selected(true);\n        // remove the disabled elements that could have been trigerred with the 'select all'\n        var selected_nodes = _.filter(all_nodes, node => node.state.disabled == false);\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var selection_type = selected_nodes[0].type;\n        var paths = [];\n        if (selected_nodes.length < 1) {\n            Toast.info(\"Please select some items first.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            for (let i = selected_nodes.length - 1; i >= 0; i--) {\n                if (selected_nodes[i].li_attr.full_path !== undefined) {\n                    paths.push(selected_nodes[i].li_attr.full_path);\n                }\n            }\n            this.initChainCallControl({\n                length: paths.length,\n                action: \"adding_datasets\"\n            });\n            if (selection_type === \"folder\") {\n                let full_source = `${options.source}_folder`;\n                this.chainCallImportingFolders({\n                    paths: paths,\n                    preserve_dirs: preserve_dirs,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    tag_using_filenames: tag_using_filenames\n                });\n            } else if (selection_type === \"file\") {\n                let full_source = `${options.source}_file`;\n                this.chainCallImportingUserdirFiles({\n                    paths: paths,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    tag_using_filenames: tag_using_filenames\n                });\n            }\n        }\n    },\n\n    fetchAndDisplayHistoryContents: function(history_id) {\n        var history_contents = new mod_library_model.HistoryContents({\n            id: history_id\n        });\n        history_contents.fetch({\n            success: history_contents => {\n                var history_contents_template = this.templateHistoryContents();\n                this.histories.get(history_id).set({ contents: history_contents });\n                this.modal.$el.find(\".library_selected_history_content\").html(\n                    history_contents_template({\n                        history_contents: history_contents.models.reverse()\n                    })\n                );\n                this.modal.$el.find(\".history-import-select-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", true);\n                });\n                this.modal.$el.find(\".history-import-unselect-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", false);\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Import all selected datasets from history into the current folder.\n     */\n    addAllDatasetsFromHistory: function() {\n        var checked_hdas = this.modal.$el.find(\".library_selected_history_content\").find(\":checked\");\n        var history_item_ids = []; // can be hda or hdca\n        var history_item_types = [];\n        var items_to_add = [];\n        if (checked_hdas.length < 1) {\n            Toast.info(\"You must select some datasets first.\");\n        } else {\n            this.modal.disableButton(\"Add\");\n            checked_hdas.each(function() {\n                var hid = $(this)\n                    .closest(\"li\")\n                    .data(\"id\");\n                if (hid) {\n                    var item_type = $(this)\n                        .closest(\"li\")\n                        .data(\"name\");\n                    history_item_ids.push(hid);\n                    history_item_types.push(item_type);\n                }\n            });\n            for (let i = history_item_ids.length - 1; i >= 0; i--) {\n                var history_item_id = history_item_ids[i];\n                var folder_item = new mod_library_model.Item();\n                folder_item.url = `${getAppRoot()}api/folders/${this.options.id}/contents`;\n                if (history_item_types[i] === \"collection\") {\n                    folder_item.set({ from_hdca_id: history_item_id });\n                } else {\n                    folder_item.set({ from_hda_id: history_item_id });\n                }\n                items_to_add.push(folder_item);\n            }\n            this.initChainCallControl({\n                length: items_to_add.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallAddingHdas(items_to_add);\n        }\n    },\n\n    /**\n     * Take array of empty history items and make request for each of them\n     * to create it on server. Update progress in between calls.\n     * @param  {array} history_item_set array of empty history items\n     * @param  {str} history_name     name of the history to import to\n     */\n    chainCallImportingIntoHistory: function(history_item_set, history_name) {\n        let Galaxy = getGalaxyInstance();\n        var popped_item = history_item_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                Toast.success(\"Selected datasets imported into history. Click this to start analyzing it.\", \"\", {\n                    onclick: () => {\n                        window.location = getAppRoot();\n                    }\n                });\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                Toast.error(\"There was an error and no datasets were imported into history.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                Toast.warning(\n                    \"Some of the datasets could not be imported into history. Click this to see what was imported.\",\n                    \"\",\n                    {\n                        onclick: () => {\n                            window.location = getAppRoot();\n                        }\n                    }\n                );\n            }\n            Galaxy.modal.hide();\n            return true;\n        }\n        var promise = $.when(\n            popped_item.save({\n                content: popped_item.content,\n                source: popped_item.source\n            })\n        );\n\n        promise\n            .done(() => {\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in chain. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to user folder on Galaxy\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingUserdirFiles: function(options) {\n        let Galaxy = getGalaxyInstance();\n        let popped_item = options.paths.pop();\n        if (typeof popped_item === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                Toast.success(\"Selected files imported into the current folder\");\n                Galaxy.modal.hide();\n            } else {\n                Toast.error(\"An error occurred.\");\n            }\n            return true;\n        }\n        let post_url = `${getAppRoot()}api/libraries/datasets`;\n        let post_data = {\n            encoded_folder_id: this.id,\n            source: options.source,\n            path: popped_item,\n            file_type: options.file_type,\n            link_data: options.link_data,\n            space_to_tab: options.space_to_tab,\n            to_posix_lines: options.to_posix_lines,\n            dbkey: options.dbkey,\n            tag_using_filenames: options.tag_using_filenames\n        };\n        let promise = $.when($.post(post_url, post_data));\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in series. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to Galaxy root folder\n     * @param  {boolean} preserve_dirs          indicates whether to preserve folder structure\n     * @param  {boolean} link_data              copy files to Galaxy or link instead\n     * @param  {boolean} to_posix_lines         convert line endings to POSIX standard\n     * @param  {boolean} space_to_tab           convert spaces to tabs\n     * @param  {str} source                     string representing what type of folder\n     *                                          is the source of import\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingFolders: function(options) {\n        let Galaxy = getGalaxyInstance();\n        // TODO need to check which paths to call\n        let popped_item = options.paths.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                Toast.success(\"Selected folders and their contents imported into the current folder.\");\n                Galaxy.modal.hide();\n            } else {\n                // TODO better error report\n                Toast.error(\"An error occurred.\");\n            }\n            return true;\n        }\n        let post_url = `${getAppRoot()}api/libraries/datasets`;\n        let post_data = {\n            encoded_folder_id: this.id,\n            source: options.source,\n            path: popped_item,\n            preserve_dirs: options.preserve_dirs,\n            link_data: options.link_data,\n            to_posix_lines: options.to_posix_lines,\n            space_to_tab: options.space_to_tab,\n            file_type: options.file_type,\n            dbkey: options.dbkey,\n            tag_using_filenames: options.tag_using_filenames\n        };\n        let promise = $.when($.post(post_url, post_data));\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            });\n    },\n\n    /**\n     * Take the array of hdas and create a request for each.\n     * Call them in chain and update progress bar in between each.\n     * @param  {array} hdas_set array of empty hda objects\n     */\n    chainCallAddingHdas: function(hdas_set) {\n        let Galaxy = getGalaxyInstance();\n        this.added_hdas = new mod_library_model.Folder();\n        var popped_item = hdas_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                Toast.success(\"Selected datasets from history added to the folder\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                Toast.error(\"There was an error and no datasets were added to the folder.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                Toast.warning(\"Some of the datasets could not be added to the folder\");\n            }\n            Galaxy.modal.hide();\n            return this.added_hdas;\n        }\n        var promise = $.when(\n            popped_item.save({\n                from_hda_id: popped_item.get(\"from_hda_id\")\n            })\n        );\n\n        promise\n            .done(model => {\n                Galaxy.libraries.folderListView.collection.add(model);\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            });\n    },\n\n    /**\n     * Take the array of lddas, create request for each and\n     * call them in chain. Update progress bar in between each.\n     * @param  {array} lddas_set array of lddas to delete\n     */\n    chainCallDeletingItems: function(items_to_delete) {\n        let Galaxy = getGalaxyInstance();\n        this.deleted_items = new mod_library_model.Folder();\n        var item_to_delete = items_to_delete.pop();\n        if (typeof item_to_delete === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                Toast.success(\"Selected items were deleted.\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                Toast.error(\n                    \"There was an error and no items were deleted. Please make sure you have sufficient permissions.\"\n                );\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                Toast.warning(\n                    \"Some of the items could not be deleted. Please make sure you have sufficient permissions.\"\n                );\n            }\n            Galaxy.modal.hide();\n            return this.deleted_items;\n        }\n        item_to_delete\n            .destroy()\n            .done(item => {\n                Galaxy.libraries.folderListView.collection.remove(item_to_delete.id);\n                this.updateProgress();\n                // add the deleted item to collection, triggers rendering\n                if (Galaxy.libraries.folderListView.options.include_deleted) {\n                    var updated_item = null;\n                    if (item.type === \"folder\" || item.model_class === \"LibraryFolder\") {\n                        updated_item = new mod_library_model.FolderAsModel(item);\n                    } else if (item.type === \"file\" || item.model_class === \"LibraryDataset\") {\n                        updated_item = new mod_library_model.Item(item);\n                    } else {\n                        Galaxy.emit.error(\"Unknown library item type found.\", \"datalibs\");\n                        Galaxy.emit.error(item.type || item.model_class, \"datalibs\");\n                    }\n                    Galaxy.libraries.folderListView.collection.add(updated_item);\n                }\n                this.chainCallDeletingItems(items_to_delete);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallDeletingItems(items_to_delete);\n            });\n    },\n\n    /**\n     * Handles the click on 'show deleted' checkbox\n     */\n    checkIncludeDeleted: function(event) {\n        let Galaxy = getGalaxyInstance();\n        if (event.target.checked) {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: true\n            });\n        } else {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: false\n            });\n        }\n    },\n\n    /**\n     * Delete the selected items. Atomic. One by one.\n     */\n    deleteSelectedItems: function() {\n        let Galaxy = getGalaxyInstance();\n        var dataset_ids = [];\n        var folder_ids = [];\n        var $checkedValues = this.findCheckedRows();\n        if ($checkedValues.length === 0) {\n            Toast.info(\"You must select at least one item for deletion.\");\n        } else {\n            var template = this.templateDeletingItemsProgressBar();\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: _l(\"Deleting selected items\"),\n                body: template({}),\n                buttons: {\n                    Close: () => {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n            // init the control counters\n            this.options.chain_call_control.total_number = 0;\n            this.options.chain_call_control.failed_number = 0;\n            $checkedValues.each(function() {\n                var row_id = $(this)\n                    .closest(\"tr\")\n                    .data(\"id\")\n                    .toString();\n                if (row_id !== undefined) {\n                    if (row_id.substring(0, 1) == \"F\") {\n                        folder_ids.push(row_id);\n                    } else {\n                        dataset_ids.push(row_id);\n                    }\n                }\n            });\n            // init the progress bar\n            var items_total = dataset_ids.length + folder_ids.length;\n            this.progressStep = 100 / items_total;\n            this.progress = 0;\n\n            // prepare the dataset items to be added\n            var items_to_delete = [];\n            for (let i = dataset_ids.length - 1; i >= 0; i--) {\n                var dataset = new mod_library_model.Item({\n                    id: dataset_ids[i]\n                });\n                items_to_delete.push(dataset);\n            }\n            for (let i = folder_ids.length - 1; i >= 0; i--) {\n                var folder = new mod_library_model.FolderAsModel({\n                    id: folder_ids[i]\n                });\n                items_to_delete.push(folder);\n            }\n\n            this.options.chain_call_control.total_number = items_total;\n            // call the recursive function to call ajax one after each other (request FIFO queue)\n            this.chainCallDeletingItems(items_to_delete);\n        }\n    },\n\n    showLocInfo: function() {\n        let Galaxy = getGalaxyInstance();\n        var library = null;\n        if (Galaxy.libraries.libraryListView !== null) {\n            library = Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id);\n            this.showLocInfoModal(library);\n        } else {\n            library = new mod_library_model.Library({\n                id: this.options.parent_library_id\n            });\n            library.fetch({\n                success: () => {\n                    this.showLocInfoModal(library);\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        Toast.error(response.responseJSON.err_msg);\n                    } else {\n                        Toast.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    showLocInfoModal: function(library) {\n        let Galaxy = getGalaxyInstance();\n        var template = this.templateLocInfoInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Location Details\"),\n            body: template({ library: library, options: this.options }),\n            buttons: {\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    showImportModal: function(options) {\n        let Galaxy = getGalaxyInstance();\n        switch (options.source) {\n            case \"history\":\n                this.addFilesFromHistoryModal();\n                break;\n            case \"importdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"importdir\"\n                });\n                break;\n            case \"path\":\n                this.importFilesFromPathModal();\n                break;\n            case \"userdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"userdir\"\n                });\n                break;\n            default:\n                Galaxy.libraries.library_router.back();\n                Toast.error(\"Invalid import source.\");\n                break;\n        }\n    },\n\n    /**\n     * Show user the prompt to change the number of items shown on page.\n     */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        let Galaxy = getGalaxyInstance();\n        var folder_page_size = prompt(\n            \"How many items per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"folder_page_size\")\n        );\n        if (folder_page_size != null && folder_page_size == parseInt(folder_page_size)) {\n            Galaxy.libraries.preferences.set({\n                folder_page_size: parseInt(folder_page_size)\n            });\n            Galaxy.libraries.folderListView.render({\n                id: this.options.id,\n                show_page: 1\n            });\n        }\n    },\n\n    findCheckedRows: function() {\n        return $(\"#folder_list_body\").find(\":checked\");\n    },\n\n    findCheckedItems: function() {\n        var folder_ids = [];\n        var dataset_ids = [];\n        this.findCheckedRows().each(function() {\n            var row_id = $(this)\n                .closest(\"tr\")\n                .data(\"id\")\n                .toString();\n            if (row_id.substring(0, 1) == \"F\") {\n                folder_ids.push(row_id);\n            } else {\n                dataset_ids.push(row_id);\n            }\n        });\n        return { folder_ids: folder_ids, dataset_ids: dataset_ids };\n    },\n\n    showCollectionSelect: function(e) {\n        e.preventDefault();\n        let Galaxy = getGalaxyInstance();\n        var checked_items = this.findCheckedItems();\n        var template = this.templateCollectionSelectModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: \"Create History Collection from Datasets\",\n            body: template({ selected_datasets: checked_items.dataset_ids.length }),\n            buttons: {\n                Continue: () => {\n                    this.showCollectionBuilder(checked_items.dataset_ids);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n        this.prepareCollectionTypeSelect();\n        this.prepareHistoryTypeSelect();\n    },\n\n    prepareCollectionTypeSelect: function() {\n        this.collectionType = \"list\";\n        this.select_collection_type = new mod_select.View({\n            css: \"library-collection-type-select\",\n            container: this.modal.$el.find(\".library-collection-type-select\"),\n            data: [\n                { id: \"list\", text: \"List\" },\n                { id: \"paired\", text: \"Paired\" },\n                { id: \"list:paired\", text: \"List of Pairs\" },\n                { id: \"rules\", text: \"From Rules\" }\n            ],\n            value: \"list\",\n            onchange: collectionType => {\n                this.updateCollectionType(collectionType);\n            }\n        });\n    },\n\n    prepareHistoryTypeSelect: function() {\n        var promise = this.fetchUserHistories();\n        promise.done(() => {\n            var history_options = [];\n            for (let i = this.histories.length - 1; i >= 0; i--) {\n                history_options.unshift({\n                    id: this.histories.models[i].id,\n                    text: this.histories.models[i].get(\"name\")\n                });\n            }\n            this.select_collection_history = new mod_select.View({\n                css: \"library-collection-history-select\",\n                container: this.modal.$el.find(\".library-collection-history-select\"),\n                data: history_options,\n                value: history_options[0].id\n            });\n        });\n    },\n\n    /** Update collection type */\n    updateCollectionType: function(collectionType) {\n        this.collectionType = collectionType;\n    },\n\n    /**\n     * Note: The collection creation process expects ldda_ids as ids\n     * in the collection_elements array but we operate on ld_ids in libraries.\n     * The code below overwrites the id with ldda_id for this reason.\n     */\n    showCollectionBuilder: function(checked_items) {\n        let Galaxy = getGalaxyInstance();\n        let collection_elements = [];\n        let elements_source = this.modal.$('input[type=\"radio\"]:checked').val();\n        if (elements_source === \"selection\") {\n            for (let i = checked_items.length - 1; i >= 0; i--) {\n                let collection_item = {};\n                let dataset = Galaxy.libraries.folderListView.folder_container.get(\"folder\").get(checked_items[i]);\n                collection_item.id = dataset.get(\"ldda_id\");\n                collection_item.name = dataset.get(\"name\");\n                collection_item.deleted = dataset.get(\"deleted\");\n                collection_item.state = dataset.get(\"state\");\n                collection_elements.push(collection_item);\n            }\n        } else if (elements_source === \"folder\") {\n            let all_datasets = Galaxy.libraries.folderListView.folder_container.get(\"folder\").where({ type: \"file\" });\n            collection_elements = new Backbone.Collection(all_datasets).toJSON();\n            for (var i = collection_elements.length - 1; i >= 0; i--) {\n                collection_elements[i].id = collection_elements[i].ldda_id;\n            }\n        }\n        let new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    Toast.success(\"History created\");\n                    this.collectionImport(collection_elements, new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    Toast.error(\"An error occurred.\");\n                });\n        } else {\n            let selected_history_id = this.select_collection_history.value();\n            let selected_history_name = this.select_collection_history.text();\n            this.collectionImport(collection_elements, selected_history_id, selected_history_name);\n        }\n    },\n\n    collectionImport: function(collection_elements, history_id, history_name) {\n        let modal_title = `Creating Collection in ${history_name}`;\n        let creator_class;\n        let creationFn;\n        if (this.collectionType === \"list\") {\n            creator_class = LIST_CREATOR.ListCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = elements.map(element => ({\n                    id: element.id,\n                    name: element.name,\n                    src: \"ldda\"\n                }));\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"paired\") {\n            creator_class = PAIR_CREATOR.PairCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = [\n                    { name: \"forward\", src: \"ldda\", id: elements[0].id },\n                    { name: \"reverse\", src: \"ldda\", id: elements[1].id }\n                ];\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"list:paired\") {\n            let elements = collection_elements.map(element => ({\n                id: element.id,\n                name: element.name,\n                src: \"ldda\"\n            }));\n            PAIRED_CREATOR.pairedCollectionCreatorModal(elements, {\n                historyId: history_id,\n                title: modal_title,\n                defaultHideSourceItems: true\n            });\n        } else if (this.collectionType === \"rules\") {\n            const creationFn = (elements, collectionType, name, hideSourceItems) => {\n                return this.createHDCA(elements, collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.ruleBasedCollectionCreatorModal(collection_elements, \"library_datasets\", \"collections\", {\n                creationFn: creationFn,\n                defaultHideSourceItems: true\n            });\n        }\n    },\n\n    createHDCA: function(elementIdentifiers, collectionType, name, hideSourceItems, history_id, options) {\n        let hdca = new HDCA_MODEL.HistoryDatasetCollection({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: history_id,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            element_identifiers: elementIdentifiers\n        });\n        return hdca.save(options);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            `<div class=\"library_style_container\">\n                <div class=\"d-flex align-items-center mb-2\">\n                    <a class=\"mr-1 btn btn-secondary\" href=\"list\" data-toggle=\"tooltip\" title=\"Go to first page\">\n                        <span class=\"fa fa-home\"/>\n                    </a>\n                    <a class=\"mr-1 btn btn-secondary\" data-toggle=\"tooltip\" title=\"See this screen annotated\" href=\"https://galaxyproject.org/data-libraries/screen/folder-contents/\" target=\"_blank\">\n                        <span class=\"fa fa-question\"/>\n                    </a>\n                    <div>\n                        <form class=\"form-inline\">\n                            <div class=\"form-check logged-dataset-manipulation mr-1\" style=\"display:none;\">\n                                <input class=\"form-check-input include-deleted-datasets-chk\" id=\"include_deleted_datasets_chk\" type=\"checkbox\">\n                                <label class=\"form-check-label\" for=\"include_deleted_datasets_chk\">include deleted</label>\n                            </div>\n                            <button style=\"display:none;\" title=\"Create new folder\" class=\"btn btn-secondary toolbtn-create-folder add-library-items add-library-items-folder mr-1\" type=\"button\">\n                            <span class=\"fa fa-folder\"/> Create Folder</button>\n                            <% if(multiple_add_dataset_options) { %>\n                                <div title=\"Add datasets to current folder\" class=\"dropdown add-library-items add-library-items-datasets mr-1\" style=\"display:none;\">\n                                <button type=\"button\" class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">\n                                    <span class=\"fa fa-file\"/> Add Datasets <span class=\"caret\"/>\n                                </button>\n                                <div class=\"dropdown-menu\">\n                                    <a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/history\"> from History</a>\n                                    <% if(Galaxy.config.user_library_import_dir !== null) { %>\n                                        <a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/userdir\"> from User Directory</a>\n                                    <% } %>\n                                    <% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>\n                                        <h5 class=\"dropdown-header\">Admins only</h5>\n                                        <% if(Galaxy.config.library_import_dir !== null) { %>\n                                            <a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/importdir\">from Import Directory</a>\n                                        <% } %>\n                                        <% if(Galaxy.config.allow_library_path_paste) { %>\n                                            <a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/path\">from Path</a>\n                                        <% } %>\n                                    <% } %>\n                                </div>\n                            </div>\n                            <% } else { %>\n                                <a title=\"Add Datasets to Current Folder\" style=\"display:none;\" class=\"btn btn-secondary add-library-items add-library-items-datasets mr-1\" href=\"#folders/<%= id %>/import/history\" role=\"button\">\n                                    <span class=\"fa fa-file\"/> Add Datasets\n                                </a>\n                            <% } %>\n                            <div class=\"dropdown mr-1\">\n                                <button type=\"button\" class=\"primary-button dropdown-toggle add-to-history\" data-toggle=\"dropdown\">\n                                    <span class=\"fa fa-book\"></span> Export to History <span class=\"caret\"/>\n                                </button>\n                                <div class=\"dropdown-menu\" role=\"menu\">\n                                    <a href=\"#\" class=\"toolbtn-bulk-import add-to-history-datasets dropdown-item\">as Datasets</a>\n                                    <a href=\"#\" class=\"toolbtn-collection-import add-to-history-collection dropdown-item\">as a Collection</a>\n                                </div>\n                            </div>\n                            <div title=\"Download items as archive\" class=\"dropdown dataset-manipulation mr-1\" style=\"display:none; \">\n                                <button type=\"button\" class=\"primary-button dropdown-toggle\" data-toggle=\"dropdown\">\n                                    <span class=\"fa fa-save\"/> Download <span class=\"caret\"/>\n                                </button>\n                                <div class=\"dropdown-menu\" role=\"menu\">\n                                    <a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tgz\">.tar.gz</a>\n                                    <a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tbz\">.tar.bz</a>\n                                    <a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/zip\">.zip</a>\n                                </div>\n                            </div>\n                            <button data-toggle=\"tooltip\" title=\"Mark items deleted\" class=\"primary-button toolbtn-bulk-delete logged-dataset-manipulation mr-1\" style=\"display:none;\" type=\"button\">\n                                <span class=\"fa fa-trash\"/> Delete\n                            </button>\n                            <span class=\"mr-1\" data-toggle=\"tooltip\" title=\"Show location details\">\n                                <button data-id=\"<%- id %>\" class=\"primary-button toolbtn-show-locinfo\" type=\"button\">\n                                    <span class=\"fa fa-info-circle\"/>&nbsp;Details\n                                </button>\n                            </span>\n                        </form>\n                    </div>\n                </div>\n                <div id=\"folder_items_element\" />\n                <div class=\"d-flex justify-content-center align-items-center folder-paginator mt-2 mb-2\" />\n            </div>`\n        );\n    },\n\n    templateLocInfoInModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">library</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                '<td><%- library.get(\"name\") %></td>',\n                \"</tr>\",\n                '<% if(library.get(\"description\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                '<td><%- library.get(\"description\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>synopsis</td>\",\n                '<td><%- library.get(\"synopsis\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"create_time_pretty\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>created</td>\",\n                '<td><span title=\"<%- library.get(\"create_time\") %>\"><%- library.get(\"create_time_pretty\") %></span></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                '<td><%- library.get(\"id\") %></td>',\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">folder</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                \"<td><%- options.folder_name %></td>\",\n                \"</tr>\",\n                '<% if(options.folder_description !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                \"<td><%- options.folder_description %></td>\",\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                \"<td><%- options.id %></td>\",\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewFolderInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_folder_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<div class=\"library-modal-item\">',\n                \"Select history: \",\n                '<select name=\"import_to_history\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n                \"<% _.each(histories, function(history) { %>\",\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                '<div class=\"library-modal-item\">',\n                \"or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Importing selected items to history <b><%= _.escape(history_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddingDatasetsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateDeletingItemsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateBrowserModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label title=\"Switch to selecting files\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-folders\" checked=\"checked\"> Choose Files',\n                \"</label>\",\n                '<label title=\"Switch to selecting folders\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-files\"> Choose Folders',\n                \"</label>\",\n                \"</div>\",\n                '<div class=\"alert alert-info jstree-files-message\">All files you select will be imported into the current folder ignoring their folder structure.</div>',\n                '<div class=\"alert alert-info jstree-folders-message\" style=\"display:none;\">All files within the selected folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label class=\"checkbox-inline jstree-preserve-structure\" style=\"display:none;\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<button title=\"Select all files\" type=\"button\" class=\"button primary-button libimport-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select no files\" type=\"button\" class=\"button primary-button libimport-select-none\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"<hr />\",\n                // append jstree object here\n                '<div id=\"jstree_browser\">',\n                \"</div>\",\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<br>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportPathModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div class=\"alert alert-info jstree-folders-message\">All files within the given folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom: 0.5em;\">',\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                \"<br>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<textarea id=\"import_paths\" class=\"form-control\" rows=\"5\" placeholder=\"Absolute paths (or paths relative to Galaxy root) separated by newline\" autofocus></textarea>',\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddFilesFromHistory: function() {\n        return _.template(\n            [\n                '<div id=\"add_files_modal\">',\n                \"<div>\",\n                \"1.&nbsp;Select history:&nbsp;\",\n                '<select id=\"dataset_add_bulk\" name=\"dataset_add_bulk\" style=\"width:66%; \"> ',\n                \"<% _.each(histories, function(history) { %>\", //history select box\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                \"<br/>\",\n                '<div class=\"library_selected_history_content\">',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateHistoryContents: function() {\n        return _.template(\n            [\n                \"<p>2.&nbsp;Choose the datasets to import:</p>\",\n                \"<div>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-unselect-all\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"</div>\",\n                \"<br>\",\n                \"<ul>\",\n                \"<% _.each(history_contents, function(history_item) { %>\",\n                '<% if (history_item.get(\"deleted\") != true ) { %>',\n                '<% var item_name = history_item.get(\"name\") %>',\n                '<% if (history_item.get(\"type\") === \"collection\") { %>',\n                '<% var collection_type = history_item.get(\"collection_type\") %>',\n                '<% if (collection_type === \"list\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                \"<label>\",\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',\n                \"</label>\",\n                \"</li>\",\n                \"<% } else { %>\",\n                '<li><input style=\"margin: 0;\" type=\"checkbox\" onclick=\"return false;\" disabled=\"disabled\">',\n                '<span title=\"You can convert this collection into a collection of type list using the Collection Tools\">',\n                '<%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',\n                \"</span>\",\n                \"</li>\",\n                \"<% } %>\",\n                '<% } else if (history_item.get(\"visible\") === true && history_item.get(\"state\") === \"ok\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %>',\n                \"</label>\",\n                \"</li>\",\n                \"<% } %>\",\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ul>\"\n            ].join(\"\")\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination mr-1\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"page-item active\">',\n                '<a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                '<span class=\"mr-1\">',\n                ' <%- items_shown %> items shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- folder_page_size %> per page\" class=\"page-size-prompt\">(change)</a>',\n                \"</span>\",\n                '<span class=\"mr-1\">',\n                \" <%- total_items_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateCollectionSelectModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                // elements selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Which datasets?</h4>\",\n                '<form class=\"form-inline\">',\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"selection_radio\" value=\"selection\" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',\n                \"<% if (selected_datasets) { %>\",\n                \" (<%- selected_datasets %>)\",\n                \"<% } %>\",\n                \"</label>\",\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"folder_radio\" value=\"folder\" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',\n                \"</label>\",\n                \"</form>\",\n                \"</div>\",\n                // type selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Collection type</h4>\",\n                '<span class=\"library-collection-type-select\"/>',\n                \"<h5>Which type to choose?</h5>\",\n                \"<ul>\",\n                \"<li>\",\n                \"List: Generic collection which groups any number of datasets into a set; similar to file system folder.\",\n                \"</li>\",\n                \"<li>\",\n                \"Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.\",\n                \"</li>\",\n                \"<li>\",\n                \"List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.\",\n                \"</li>\",\n                \"<li>\",\n                \"From Rules: Use Galaxy's rule builder to describe collections. This is more of an advanced feature that allows building any number of collections or any type.\",\n                \"</li>\",\n                \"</ul>\",\n                \"</div>\",\n                // history selection/creation\n                '<div class=\"library-modal-item\">',\n                \"<h4>Select history</h4>\",\n                '<span class=\"library-collection-history-select\"/>',\n                \" or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderToolbarView: FolderToolbarView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_select from \"mvc/ui/ui-select\";\n\nvar LibraryView = Backbone.View.extend({\n    el: \"#center\",\n\n    model: null,\n\n    options: {},\n\n    events: {\n        \"click .toolbtn_save_permissions\": \"savePermissions\"\n    },\n\n    initialize: function(options) {\n        this.options = _.extend(this.options, options);\n        if (this.options.id) {\n            this.fetchLibrary();\n        }\n    },\n\n    fetchLibrary: function(options) {\n        this.options = _.extend(this.options, options);\n        this.model = new mod_library_model.Library({\n            id: this.options.id\n        });\n        var that = this;\n        this.model.fetch({\n            success: function() {\n                if (that.options.show_permissions) {\n                    that.showPermissions();\n                }\n            },\n            error: function(model, response) {\n                let Galaxy = getGalaxyInstance();\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`${response.responseJSON.err_msg} Click this to go back.`, \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                } else {\n                    Toast.error(\"An error occurred. Click this to go back.\", \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    showPermissions: function(options) {\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n\n        if (this.options.fetched_permissions !== undefined) {\n            if (this.options.fetched_permissions.access_library_role_list.length === 0) {\n                this.model.set({ is_unrestricted: true });\n            } else {\n                this.model.set({ is_unrestricted: false });\n            }\n        }\n        var is_admin = false;\n        let Galaxy = getGalaxyInstance();\n        if (Galaxy.user) {\n            is_admin = Galaxy.user.isAdmin();\n        }\n        var template = this.templateLibraryPermissions();\n        this.$el.html(template({ library: this.model, is_admin: is_admin }));\n\n        var self = this;\n        $.get(`${getAppRoot()}api/libraries/${self.id}/permissions?scope=current`)\n            .done(fetched_permissions => {\n                self.prepareSelectBoxes({\n                    fetched_permissions: fetched_permissions\n                });\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to fetch library permissions.\");\n            });\n\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        //hack to show scrollbars\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    _serializeRoles: function(role_list) {\n        var selected_roles = [];\n        for (var i = 0; i < role_list.length; i++) {\n            selected_roles.push(`${role_list[i][1]}:${role_list[i][0]}`);\n        }\n        return selected_roles;\n    },\n\n    prepareSelectBoxes: function(options) {\n        this.options = _.extend(this.options, options);\n        var fetched_permissions = this.options.fetched_permissions;\n        var self = this;\n\n        var selected_access_library_roles = this._serializeRoles(fetched_permissions.access_library_role_list);\n        var selected_add_item_roles = this._serializeRoles(fetched_permissions.add_library_item_role_list);\n        var selected_manage_library_roles = this._serializeRoles(fetched_permissions.manage_library_role_list);\n        var selected_modify_library_roles = this._serializeRoles(fetched_permissions.modify_library_role_list);\n\n        self.accessSelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"access_perm\", selected_access_library_roles, true)\n        );\n        self.addSelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"add_perm\", selected_add_item_roles, false)\n        );\n        self.manageSelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"manage_perm\", selected_manage_library_roles, false)\n        );\n        self.modifySelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"modify_perm\", selected_modify_library_roles, false)\n        );\n    },\n\n    _createSelectOptions: function(self, id, init_data, is_library_access) {\n        is_library_access = is_library_access === true ? is_library_access : false;\n        var select_options = {\n            minimumInputLength: 0,\n            css: id,\n            multiple: true,\n            placeholder: \"Click to select a role\",\n            container: self.$el.find(`#${id}`),\n            ajax: {\n                url: `${getAppRoot()}api/libraries/${\n                    self.id\n                }/permissions?scope=available&is_library_access=${is_library_access}`,\n                dataType: \"json\",\n                quietMillis: 100,\n                data: function(term, page) {\n                    // page is the one-based page number tracked by Select2\n                    return {\n                        q: term, //search term\n                        page_limit: 10, // page size\n                        page: page // page number\n                    };\n                },\n                results: function(data, page) {\n                    var more = page * 10 < data.total; // whether or not there are more results available\n                    // notice we return the value of more so Select2 knows if more results can be loaded\n                    return { results: data.roles, more: more };\n                }\n            },\n            formatResult: function roleFormatResult(role) {\n                return `${role.name} type: ${role.type}`;\n            },\n\n            formatSelection: function roleFormatSelection(role) {\n                return role.name;\n            },\n            initSelection: function(element, callback) {\n                // the input tag has a value attribute preloaded that points to a preselected role's id\n                // this function resolves that id attribute to an object that select2 can render\n                // using its formatResult renderer - that way the role name is shown preselected\n                var data = [];\n                $(element.val().split(\",\")).each(function() {\n                    var item = this.split(\":\");\n                    data.push({\n                        id: item[0],\n                        name: item[1]\n                    });\n                });\n                callback(data);\n            },\n            // initialData: init_data.join(','),\n            initialData: init_data,\n            dropdownCssClass: \"bigdrop\" // apply css that makes the dropdown taller\n        };\n\n        return select_options;\n    },\n\n    makeDatasetPrivate: function() {\n        var self = this;\n        $.post(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?action=make_private`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: false });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"The dataset is now private to you.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to make dataset private.\");\n            });\n    },\n\n    removeDatasetRestrictions: function() {\n        var self = this;\n        $.post(`${getAppRoot()}api/libraries/datasets/${self.id}/permissions?action=remove_restrictions`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: true });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"Access to this dataset is now unrestricted.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to make dataset unrestricted.\");\n            });\n    },\n\n    _extractIds: function(roles_list) {\n        var ids_list = [];\n        for (var i = roles_list.length - 1; i >= 0; i--) {\n            ids_list.push(roles_list[i].id);\n        }\n        return ids_list;\n    },\n    savePermissions: function(event) {\n        var self = this;\n\n        var access_ids = this._extractIds(this.accessSelectObject.$el.select2(\"data\"));\n        var add_ids = this._extractIds(this.addSelectObject.$el.select2(\"data\"));\n        var manage_ids = this._extractIds(this.manageSelectObject.$el.select2(\"data\"));\n        var modify_ids = this._extractIds(this.modifySelectObject.$el.select2(\"data\"));\n\n        $.post(`${getAppRoot()}api/libraries/${self.id}/permissions?action=set_permissions`, {\n            \"access_ids[]\": access_ids,\n            \"add_ids[]\": add_ids,\n            \"manage_ids[]\": manage_ids,\n            \"modify_ids[]\": modify_ids\n        })\n            .done(fetched_permissions => {\n                //fetch dataset again\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"Permissions saved.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to set library permissions.\");\n            });\n    },\n\n    templateLibraryPermissions: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">',\n                \"<div>\",\n                '<a href=\"#\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go back to the list of Libraries\" class=\"btn btn-secondary primary-button\" type=\"button\">',\n                '<span class=\"fa fa-list\"/>',\n                \"&nbsp;Libraries\",\n                \"</button>\",\n                \"</a>\",\n                \"</div>\",\n                \"<h1>\",\n                'Library: <%= _.escape(library.get(\"name\")) %>',\n                \"</h1>\",\n                '<div class=\"alert alert-warning\">',\n                \"<% if (is_admin) { %>\",\n                \"You are logged in as an <strong>administrator</strong> therefore you can manage any library on this Galaxy instance. Please make sure you understand the consequences.\",\n                \"<% } else { %>\",\n                \"You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.\",\n                \"<% }%>\",\n                \"</div>\",\n                '<div class=\"dataset_table\">',\n                \"<h2>Library permissions</h2>\",\n                \"<h4>Roles that can access the library</h4>\",\n                '<div id=\"access_perm\" class=\"access_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can access this library. If there are no access roles set on the library it is considered <strong>unrestricted</strong>.\",\n                \"</div>\",\n                \"<h4>Roles that can manage permissions on this library</h4>\",\n                '<div id=\"manage_perm\" class=\"manage_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can manage permissions on this library (includes giving access).\",\n                \"</div>\",\n                \"<h4>Roles that can add items to this library</h4>\",\n                '<div id=\"add_perm\" class=\"add_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can add items to this library (folders and datasets).\",\n                \"</div>\",\n                \"<h4>Roles that can modify this library</h4>\",\n                '<div id=\"modify_perm\" class=\"modify_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can modify this library (name, synopsis, etc.).\",\n                \"</div>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications made on this page\" class=\"btn btn-secondary toolbtn_save_permissions primary-button\" type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"/>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryView: LibraryView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { Toast } from \"ui/toast\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_select from \"mvc/ui/ui-select\";\n\nvar FolderView = Backbone.View.extend({\n    el: \"#center\",\n\n    model: null,\n\n    options: {},\n\n    events: {\n        \"click .toolbtn_save_permissions\": \"savePermissions\"\n    },\n\n    initialize: function(options) {\n        this.options = _.extend(this.options, options);\n        if (this.options.id) {\n            this.fetchFolder();\n        }\n    },\n\n    fetchFolder: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n        this.model = new mod_library_model.FolderAsModel({\n            id: this.options.id\n        });\n        var that = this;\n        this.model.fetch({\n            success: function() {\n                if (that.options.show_permissions) {\n                    that.showPermissions();\n                }\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(`${response.responseJSON.err_msg} Click this to go back.`, \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                } else {\n                    Toast.error(\"An error occurred. Click this to go back.\", \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    showPermissions: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n\n        var is_admin = false;\n        if (Galaxy.user) {\n            is_admin = Galaxy.user.isAdmin();\n        }\n        var template = this.templateFolderPermissions();\n        this.$el.html(template({ folder: this.model, is_admin: is_admin }));\n\n        var self = this;\n        $.get(`${getAppRoot()}api/folders/${self.id}/permissions?scope=current`)\n            .done(fetched_permissions => {\n                self.prepareSelectBoxes({\n                    fetched_permissions: fetched_permissions\n                });\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to fetch folder permissions.\");\n            });\n\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        //hack to show scrollbars\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    _serializeRoles: function(role_list) {\n        var selected_roles = [];\n        for (var i = 0; i < role_list.length; i++) {\n            selected_roles.push(`${role_list[i][1]}:${role_list[i][0]}`);\n        }\n        return selected_roles;\n    },\n\n    prepareSelectBoxes: function(options) {\n        this.options = _.extend(this.options, options);\n        var fetched_permissions = this.options.fetched_permissions;\n        var self = this;\n\n        var selected_add_item_roles = this._serializeRoles(fetched_permissions.add_library_item_role_list);\n        var selected_manage_folder_roles = this._serializeRoles(fetched_permissions.manage_folder_role_list);\n        var selected_modify_folder_roles = this._serializeRoles(fetched_permissions.modify_folder_role_list);\n\n        self.addSelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"add_perm\", selected_add_item_roles, false)\n        );\n        self.manageSelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"manage_perm\", selected_manage_folder_roles, false)\n        );\n        self.modifySelectObject = new mod_select.View(\n            this._createSelectOptions(this, \"modify_perm\", selected_modify_folder_roles, false)\n        );\n    },\n\n    _createSelectOptions: function(self, id, init_data) {\n        var select_options = {\n            minimumInputLength: 0,\n            css: id,\n            multiple: true,\n            placeholder: \"Click to select a role\",\n            container: self.$el.find(`#${id}`),\n            ajax: {\n                url: `${getAppRoot()}api/folders/${self.id}/permissions?scope=available`,\n                dataType: \"json\",\n                quietMillis: 100,\n                data: function(term, page) {\n                    // page is the one-based page number tracked by Select2\n                    return {\n                        q: term, //search term\n                        page_limit: 10, // page size\n                        page: page // page number\n                    };\n                },\n                results: function(data, page) {\n                    var more = page * 10 < data.total; // whether or not there are more results available\n                    // notice we return the value of more so Select2 knows if more results can be loaded\n                    return { results: data.roles, more: more };\n                }\n            },\n            formatResult: function roleFormatResult(role) {\n                return `${role.name} type: ${role.type}`;\n            },\n\n            formatSelection: function roleFormatSelection(role) {\n                return role.name;\n            },\n            initSelection: function(element, callback) {\n                // the input tag has a value attribute preloaded that points to a preselected role's id\n                // this function resolves that id attribute to an object that select2 can render\n                // using its formatResult renderer - that way the role name is shown preselected\n                var data = [];\n                $(element.val().split(\",\")).each(function() {\n                    var item = this.split(\":\");\n                    data.push({\n                        id: item[0],\n                        name: item[1]\n                    });\n                });\n                callback(data);\n            },\n            initialData: init_data.join(\",\"),\n            dropdownCssClass: \"bigdrop\" // apply css that makes the dropdown taller\n        };\n\n        return select_options;\n    },\n\n    /**\n     * Extract the role ids from Select2 elements's 'data'\n     */\n    _extractIds: function(roles_list) {\n        var ids_list = [];\n        for (var i = roles_list.length - 1; i >= 0; i--) {\n            ids_list.push(roles_list[i].id);\n        }\n        return ids_list;\n    },\n\n    /**\n     * Save the permissions for roles entered in the select boxes.\n     */\n    savePermissions: function(event) {\n        var self = this;\n        var add_ids = this._extractIds(this.addSelectObject.$el.select2(\"data\"));\n        var manage_ids = this._extractIds(this.manageSelectObject.$el.select2(\"data\"));\n        var modify_ids = this._extractIds(this.modifySelectObject.$el.select2(\"data\"));\n        $.post(`${getAppRoot()}api/folders/${self.id}/permissions?action=set_permissions`, {\n            \"add_ids[]\": add_ids,\n            \"manage_ids[]\": manage_ids,\n            \"modify_ids[]\": modify_ids\n        })\n            .done(fetched_permissions => {\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                Toast.success(\"Permissions saved.\");\n            })\n            .fail(() => {\n                Toast.error(\"An error occurred while attempting to set folder permissions.\");\n            });\n    },\n\n    templateFolderPermissions: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">',\n                \"<div>\",\n                '<a href=\"#/folders/<%= folder.get(\"parent_id\") %>\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go back to the parent folder\" class=\"btn btn-secondary primary-button\" type=\"button\">',\n                '<span class=\"fa fa-caret-left fa-lg\"/>',\n                \"&nbsp;Parent folder\",\n                \"</button>\",\n                \"</a>\",\n                \"</div>\",\n                \"<h1>\",\n                'Folder: <%= _.escape(folder.get(\"name\")) %>',\n                \"</h1>\",\n                '<div class=\"alert alert-warning\">',\n                \"<% if (is_admin) { %>\",\n                \"You are logged in as an <strong>administrator</strong> therefore you can manage any folder on this Galaxy instance. Please make sure you understand the consequences.\",\n                \"<% } else { %>\",\n                \"You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.\",\n                \"<% }%>\",\n                \"</div>\",\n                '<div class=\"dataset_table\">',\n                \"<h2>Folder permissions</h2>\",\n                \"<h4>\",\n                \"Roles that can manage permissions on this folder\",\n                \"</h4>\",\n                '<div id=\"manage_perm\" class=\"manage_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can manage permissions on this folder.\",\n                \"</div>\",\n                \"<h4>\",\n                \"Roles that can add items to this folder\",\n                \"</h4>\",\n                '<div id=\"add_perm\" class=\"add_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can add items to this folder (folders and datasets).\",\n                \"</div>\",\n                \"<h4>\",\n                \"Roles that can modify this folder\",\n                \"</h4>\",\n                '<div id=\"modify_perm\" class=\"modify_perm roles-selection\"/>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can modify this folder (name, etc.).\",\n                \"</div>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications\" class=\"btn btn-secondary toolbtn_save_permissions primary-button\" type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"/>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderView: FolderView\n};\n","// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n// === MAIN GALAXY LIBRARY MODULE ====\n// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n\n/* global ga */\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\n// import mod_utils from \"utils/utils\";\nimport { Toast } from \"ui/toast\";\nimport mod_baseMVC from \"mvc/base-mvc\";\n// import mod_library_model from \"mvc/library/library-model\";\nimport mod_folderlist_view from \"mvc/library/library-folderlist-view\";\nimport mod_librarylist_view from \"mvc/library/library-librarylist-view\";\nimport mod_librarytoolbar_view from \"mvc/library/library-librarytoolbar-view\";\nimport mod_foldertoolbar_view from \"mvc/library/library-foldertoolbar-view\";\nimport mod_library_dataset_view from \"mvc/library/library-dataset-view\";\nimport mod_library_library_view from \"mvc/library/library-library-view\";\nimport mod_library_folder_view from \"mvc/library/library-folder-view\";\n// ============================================================================\n/**\n * The Data Libraries router. Takes care about triggering routes\n * and sends users to proper pieces of the application.\n */\nvar LibraryRouter = Backbone.Router.extend({\n    initialize: function() {\n        this.routesHit = 0;\n        // keep count of number of routes handled by the application\n        Backbone.history.on(\n            \"route\",\n            function() {\n                this.routesHit++;\n            },\n            this\n        );\n\n        this.bind(\"route\", this.trackPageview);\n    },\n\n    routes: {\n        \"\": \"libraries\",\n        \"page/:show_page\": \"libraries_page\",\n        \"library/:library_id/permissions\": \"library_permissions\",\n        \"folders/:folder_id/permissions\": \"folder_permissions\",\n        \"folders/:id\": \"folder_content\",\n        \"folders/:id/page/:show_page\": \"folder_page\",\n        \"folders/:folder_id/datasets/:dataset_id\": \"dataset_detail\",\n        \"folders/:folder_id/datasets/:dataset_id/permissions\": \"dataset_permissions\",\n        \"folders/:folder_id/datasets/:dataset_id/versions/:ldda_id\": \"dataset_version\",\n        \"folders/:folder_id/download/:format\": \"download\",\n        \"folders/:folder_id/import/:source\": \"import_datasets\"\n    },\n\n    /**\n     * If more than one route has been hit the user did not land on current\n     * page directly so we can go back safely. Otherwise go to the home page.\n     * Use replaceState if available so the navigation doesn't create an\n     * extra history entry\n     */\n    back: function() {\n        if (this.routesHit > 1) {\n            window.history.back();\n        } else {\n            this.navigate(\"#\", { trigger: true, replace: true });\n        }\n    },\n\n    /**\n     * Track every route change as a page view in Google Analytics.\n     */\n    trackPageview: function() {\n        var url = Backbone.history.getFragment();\n        //prepend slash\n        if (!/^\\//.test(url) && url != \"\") {\n            url = `/${url}`;\n        }\n        if (typeof ga !== \"undefined\") {\n            ga(\"send\", \"pageview\", `${getAppRoot()}library/list${url}`);\n        }\n    }\n});\n\n// ============================================================================\n/** session storage for library preferences */\nvar LibraryPrefs = mod_baseMVC.SessionStorageModel.extend({\n    defaults: {\n        with_deleted: false,\n        without_restricted: false,\n        sort_order: \"asc\",\n        sort_by: \"name\",\n        library_page_size: 20,\n        folder_page_size: 15\n    }\n});\n\n// ============================================================================\n/**\n * Main view of the Galaxy Data Libraries. Stores pointers to other subviews\n * and defines what router should do on the route triggers.\n */\nvar GalaxyLibrary = Backbone.View.extend({\n    libraryToolbarView: null,\n    libraryListView: null,\n    library_router: null,\n    libraryView: null,\n    folderToolbarView: null,\n    folderListView: null,\n    datasetView: null,\n\n    initialize: function() {\n        // This should go upstream in the js app once available\n        let Galaxy = getGalaxyInstance();\n        if (Galaxy.config.ga_code) {\n            ((i, s, o, g, r, a, m) => {\n                i[\"GoogleAnalyticsObject\"] = r;\n                (i[r] =\n                    i[r] ||\n                    function() {\n                        (i[r].q = i[r].q || []).push(arguments);\n                    }),\n                    (i[r].l = 1 * new Date());\n                (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);\n                a.async = 1;\n                a.src = g;\n                m.parentNode.insertBefore(a, m);\n            })(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n            ga(\"create\", Galaxy.config.ga_code, \"auto\");\n            ga(\"send\", \"pageview\");\n        }\n\n        Galaxy.libraries = this;\n\n        this.preferences = new LibraryPrefs({ id: \"global-lib-prefs\" });\n\n        this.library_router = new LibraryRouter();\n\n        this.library_router.on(\"route:libraries\", () => {\n            if (Galaxy.libraries.libraryToolbarView) {\n                Galaxy.libraries.libraryToolbarView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n            Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView();\n        });\n\n        this.library_router.on(\"route:libraries_page\", show_page => {\n            if (Galaxy.libraries.libraryToolbarView === null) {\n                Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n                Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView({ show_page: show_page });\n            } else {\n                Galaxy.libraries.libraryListView.render({\n                    show_page: show_page\n                });\n            }\n        });\n\n        this.library_router.on(\"route:folder_content\", id => {\n            if (Galaxy.libraries.folderToolbarView) {\n                Galaxy.libraries.folderToolbarView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView({ id: id });\n            Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView({ id: id });\n        });\n\n        this.library_router.on(\"route:folder_page\", (id, show_page) => {\n            if (Galaxy.libraries.folderToolbarView === null) {\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView({ id: id });\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView({\n                    id: id,\n                    show_page: show_page\n                });\n            } else {\n                Galaxy.libraries.folderListView.render({\n                    id: id,\n                    show_page: parseInt(show_page)\n                });\n            }\n        });\n\n        this.library_router.on(\"route:download\", (folder_id, format) => {\n            if ($(\"#folder_list_body\").find(\":checked\").length === 0) {\n                Toast.info(\"You must select at least one dataset to download\");\n                Galaxy.libraries.library_router.navigate(`folders/${folder_id}`, { trigger: true, replace: true });\n            } else {\n                Galaxy.libraries.folderToolbarView.download(format);\n                Galaxy.libraries.library_router.navigate(`folders/${folder_id}`, { trigger: false, replace: true });\n            }\n        });\n\n        this.library_router.on(\"route:dataset_detail\", (folder_id, dataset_id) => {\n            if (Galaxy.libraries.datasetView) {\n                Galaxy.libraries.datasetView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({\n                id: dataset_id,\n                show_version: false,\n                show_permissions: false\n            });\n        });\n\n        this.library_router.on(\"route:dataset_version\", (folder_id, dataset_id, ldda_id) => {\n            if (Galaxy.libraries.datasetView) {\n                Galaxy.libraries.datasetView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({\n                id: dataset_id,\n                ldda_id: ldda_id,\n                show_version: true\n            });\n        });\n\n        this.library_router.on(\"route:dataset_permissions\", (folder_id, dataset_id) => {\n            if (Galaxy.libraries.datasetView) {\n                Galaxy.libraries.datasetView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({\n                id: dataset_id,\n                show_permissions: true\n            });\n        });\n\n        this.library_router.on(\"route:library_permissions\", library_id => {\n            if (Galaxy.libraries.libraryView) {\n                Galaxy.libraries.libraryView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.libraryView = new mod_library_library_view.LibraryView({\n                id: library_id,\n                show_permissions: true\n            });\n        });\n\n        this.library_router.on(\"route:folder_permissions\", folder_id => {\n            if (Galaxy.libraries.folderView) {\n                Galaxy.libraries.folderView.$el.unbind(\"click\");\n            }\n            Galaxy.libraries.folderView = new mod_library_folder_view.FolderView({\n                id: folder_id,\n                show_permissions: true\n            });\n        });\n\n        this.library_router.on(\"route:import_datasets\", (folder_id, source) => {\n            if (Galaxy.libraries.folderToolbarView && Galaxy.libraries.folderListView) {\n                Galaxy.libraries.folderToolbarView.showImportModal({\n                    source: source\n                });\n            } else {\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView({ id: folder_id });\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView({ id: folder_id });\n                Galaxy.libraries.folderToolbarView.showImportModal({\n                    source: source\n                });\n            }\n        });\n\n        Backbone.history.start({ pushState: false });\n    }\n});\n\nexport default {\n    GalaxyApp: GalaxyLibrary\n};\n","import _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\n\nvar ToolShedModel = Backbone.Model.extend({\n    defaults: {\n        url: \"https://toolshed.g2.bx.psu.edu/\",\n        name: \"Galaxy Main Tool Shed\"\n    },\n    urlRoot: `${getAppRoot()}api/tool_shed`\n});\n\nvar ToolShedsCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/tool_shed`,\n    model: ToolShedModel\n});\n\nvar ToolShedCategoriesModel = Backbone.Model.extend({\n    defaults: [{}],\n    urlRoot: `${getAppRoot()}api/tool_shed/contents`\n});\n\nvar ToolShedCategoriesCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/tool_shed/contents`,\n    model: ToolShedCategoriesModel\n});\n\nvar ToolShedCategoryModel = Backbone.Model.extend({\n    defaults: [{}],\n    urlRoot: `${getAppRoot()}api/tool_shed/category`\n});\n\nvar ToolShedCategoryCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/tool_shed/category`,\n    model: ToolShedCategoryModel\n});\n\nvar ToolShedRepositoryModel = Backbone.Model.extend({\n    defaults: [{}],\n    urlRoot: `${getAppRoot()}api/tool_shed/repository`\n});\n\nvar ToolShedRepositoryCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/tool_shed/repository`,\n    model: ToolShedRepositoryModel\n});\n\nvar RepoQueueModel = Backbone.Model.extend({\n    url: \"#\"\n});\n\nvar RepoQueueCollection = Backbone.Collection.extend({\n    url: \"#\",\n    model: RepoQueueModel,\n    fetch: function() {\n        var repositories = Array();\n        var repositories_enc;\n        if (window.localStorage.hasOwnProperty(\"repositories\")) {\n            repositories_enc = JSON.parse(window.localStorage.repositories);\n        } else {\n            repositories_enc = [];\n        }\n        var queue_keys = Object.keys(repositories_enc);\n        _.each(queue_keys, key => {\n            var repo = repositories_enc[key];\n            repo.queue_key = key;\n            repositories.push(repo);\n        });\n        this.reset(repositories);\n        return Backbone.Collection.prototype.fetch.call(this);\n    }\n});\n\nvar RepoStatusModel = Backbone.Model.extend({\n    defaults: [{}],\n    urlRoot: `${getAppRoot()}api/tool_shed/status`\n});\n\nvar RepoStatusCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/tool_shed/status`,\n    model: RepoStatusModel\n});\n\nvar WorkflowToolsModel = Backbone.Model.extend({\n    defaults: [{}],\n    urlRoot: `${getAppRoot()}api/workflows?missing_tools=True`\n});\n\nvar WorkflowToolsCollection = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/workflows?missing_tools=True`,\n    model: WorkflowToolsModel\n});\n\nexport default {\n    ShedModel: ToolShedModel,\n    ShedsCollection: ToolShedsCollection,\n    Category: ToolShedCategoriesModel,\n    Categories: ToolShedCategoriesCollection,\n    CategoryModel: ToolShedCategoryModel,\n    CategoryCollection: ToolShedCategoryCollection,\n    RepositoryModel: ToolShedRepositoryModel,\n    RepositoryCollection: ToolShedRepositoryCollection,\n    RepoQueue: RepoQueueCollection,\n    RepoStatus: RepoStatusCollection,\n    WorkflowTools: WorkflowToolsCollection\n};\n","import $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\n\nvar searchShed = function(request, response) {\n    var shed_url = this.shed_url;\n    var base_url = `${getAppRoot()}api/tool_shed/search`;\n    $.get(base_url, { term: request.term, tool_shed_url: shed_url }, data => {\n        var result_list = this.shedParser(data);\n        response(result_list);\n    });\n};\n\nvar shedParser = jsondata => {\n    var results = [];\n    var hits = jsondata.hits;\n    $.each(hits, hit => {\n        var record = hits[hit];\n        var label = `${record.repository.name} by ${record.repository.repo_owner_username}: ${\n            record.repository.description\n        }`;\n        var result = { value: record.repository.id, label: label };\n        results.push(result);\n    });\n    return results;\n};\n\nvar addToQueue = metadata => {\n    if (metadata.tool_shed_url.substr(-1) == \"/\") {\n        metadata.tool_shed_url = metadata.tool_shed_url.substr(0, metadata.tool_shed_url.length - 1);\n    }\n    var key = `${metadata.tool_shed_url}|${metadata.repository_id}|${metadata.changeset_revision}`;\n    var queued_repos = {};\n    if (window.localStorage.repositories) {\n        queued_repos = JSON.parse(window.localStorage.repositories);\n    }\n    queued_repos[key] = metadata;\n    window.localStorage.repositories = JSON.stringify(queued_repos);\n};\n\nvar queueLength = () => {\n    if (window.localStorage.hasOwnProperty(\"repositories\")) {\n        var repo_queue = JSON.parse(window.localStorage.repositories);\n        var queue_length = Object.keys(repo_queue).length;\n        return queue_length;\n    } else {\n        return 0;\n    }\n};\n\nvar toolByGuid = function(guid, changeset, tools) {\n    var returned_tool;\n    tools.forEach(function(tool) {\n        if (tool.guid == guid.value) {\n            returned_tool = tool;\n        }\n    });\n    return returned_tool;\n};\n\nexport default {\n    searchShed: searchShed,\n    shedParser: shedParser,\n    addToQueue: addToQueue,\n    queueLength: queueLength,\n    toolByGuid: toolByGuid\n};\n","import Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\n\nvar View = Backbone.View.extend({\n    defaults: {\n        tool_sheds: [\n            {\n                url: \"https://toolshed.g2.bx.psu.edu/\",\n                name: \"Galaxy Main Tool Shed\"\n            }\n        ]\n    },\n\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, this.defaults);\n        this.model = new toolshed_model.ShedsCollection();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.fetch();\n    },\n\n    el: \"#center\",\n\n    render: function(options) {\n        this.options = _.defaults(this.options || {}, options, this.defaults);\n        var toolshed_list_template = this.templateToolshedList;\n        this.$el.html(\n            toolshed_list_template({\n                title: _l(\"Configured Galaxy Tool Sheds\"),\n                tool_sheds: this.model.models,\n                queue: toolshed_util.queueLength()\n            })\n        );\n    },\n\n    templateToolshedList: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_toolsheds\">',\n            '<div class=\"form-row\">',\n            '<table class=\"grid\">',\n            \"<% _.each(tool_sheds, function(shed) { %>\",\n            '<tr class=\"libraryTitle\">',\n            \"<td>\",\n            '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n            '<a class=\"view-info shed-selector\" href=\"#/categories/s/<%= shed.get(\"url\") %>\"><%= shed.get(\"name\") %></a>',\n            \"</div>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            '<div style=\"clear: both\"></div>',\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    ShedListView: View\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nimport \"libs/jquery/jquery-ui\";\n\nvar ToolShedCategories = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: {\n        tool_shed: \"https://toolshed.g2.bx.psu.edu/\"\n    },\n\n    initialize: function(options) {\n        var shed = options.tool_shed.replace(/\\//g, \"%2f\");\n        this.options = _.defaults(this.options || options, this.defaults);\n        this.model = new toolshed_model.Categories();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.url = `${this.model.url}?tool_shed_url=${this.options.tool_shed}`;\n        this.model.tool_shed = shed;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        this.options.categories = this.model.models;\n        this.options.queue = toolshed_util.queueLength();\n        var category_list_template = this.templateCategoryList;\n        this.$el.html(category_list_template(this.options));\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        $(\"#search_box\").autocomplete({\n            source: (request, response) => {\n                var shed_url = this.model.tool_shed.replace(/%2f/g, \"/\");\n                var base_url = `${getAppRoot()}api/tool_shed/search`;\n                var params = {\n                    term: request.term,\n                    tool_shed_url: shed_url\n                };\n                $.post(base_url, params, data => {\n                    console.log(data);\n                    var result_list = toolshed_util.shedParser(data);\n                    response(result_list);\n                });\n            },\n            minLength: 3,\n            select: (event, ui) => {\n                var tsr_id = ui.item.value;\n                var new_route = `repository/s/${this.model.tool_shed}/r/${tsr_id}`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            }\n        });\n    },\n\n    templateCategoryList: _.template(\n        [\n            '<style type=\"text/css\">',\n            \".ui-autocomplete { background-color: #fff; }\",\n            \"li.ui-menu-item { list-style-type: none; }\",\n            \"</style>\",\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\" style=\"layout: inline;\">Categories in <%= tool_shed.replace(/%2f/g, \"/\") %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_categories\">',\n            '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n            '<span class=\"ui-widget\" >',\n            '<input class=\"search-box-input\" id=\"search_box\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" name=\"search\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n            \"</span>\",\n            \"</div>\",\n            '<div style=\"clear: both; margin-top: 1em;\">',\n            '<table class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            \"<th>Name</th>\",\n            \"<th>Description</th>\",\n            \"<th>Repositories</th>\",\n            \"</tr>\",\n            \"</thead>\",\n            \"<% _.each(categories, function(category) { %>\",\n            \"<tr>\",\n            \"<td>\",\n            '<a href=\"#/category/s/<%= tool_shed %>/c/<%= category.get(\"id\") %>/k/name/p/1/t/asc\"><%= category.get(\"name\") %></a>',\n            \"</td>\",\n            '<td><%= category.get(\"description\") %></td>',\n            '<td><%= category.get(\"repositories\") %></td>',\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    CategoryView: ToolShedCategories\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nimport \"libs/jquery/jquery-ui\";\n\nvar ToolShedCategoryContentsView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(params) {\n        this.params = params;\n        this.model = new toolshed_model.CategoryCollection();\n        this.listenTo(this.model, \"sync\", this.render);\n        var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n        this.model.url += `?tool_shed_url=${shed}&category_id=${params.category_id}&sort_key=${\n            params.sort_key\n        }&sort_order=${params.sort_order}&page=${params.page}`;\n        this.model.tool_shed = shed;\n        this.model.category = params.category_id;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        this.options = _.defaults(this.options || {}, options);\n        var category_contents_template = this.templateCategoryContents;\n        var page_navigation_template = this.templatePageNavigation;\n        var sorting = {\n            class: { owner: \"fa-sort\", description: \"fa-sort\", name: \"fa-sort\" },\n            direction: { owner: \"asc\", description: \"asc\", name: \"asc\" }\n        };\n        sorting.class[this.params.sort_key] = this.params.sort_order == \"desc\" ? \"fa-sort-down\" : \"fa-sort-up\";\n        sorting.direction[this.params.sort_key] = this.params.sort_order == \"asc\" ? \"desc\" : \"asc\";\n        var previous_page = Math.max(this.params.page - 1, 1);\n        var pages = parseInt(this.model.models[0].get(\"repository_count\") % 25) + 1;\n        var next_page = Math.min(parseInt(this.params.page) + 1, pages);\n        var pagination_params = {\n            page: this.params.page,\n            next: next_page,\n            previous: previous_page,\n            pages: pages\n        };\n        if (pages > 5) {\n            var page = parseInt(this.params.page);\n            var page_slice = Array();\n            var slice_start = Math.max(page - 2, 2);\n            var i = slice_start;\n            var slice_end = Math.min(Math.min(page + 2, slice_start + 4), pages);\n            for (i = slice_start; i <= slice_end; i++) {\n                page_slice.push(i);\n            }\n            pagination_params[\"page_slice\"] = page_slice;\n        }\n        this.$el.html(\n            category_contents_template({\n                page_navigation: page_navigation_template(pagination_params),\n                category: this.model.models[0],\n                tool_shed: this.model.tool_shed,\n                queue: toolshed_util.queueLength(),\n                sorting: sorting,\n                page: this.params.page\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        $(\"#search_box\").autocomplete({\n            source: (request, response) => {\n                var shed_url = this.model.tool_shed.replace(/%2f/g, \"/\");\n                var base_url = `${getAppRoot()}api/tool_shed/search`;\n                var params = {\n                    term: request.term,\n                    tool_shed_url: shed_url\n                };\n                $.post(base_url, params, data => {\n                    var result_list = toolshed_util.shedParser(data);\n                    response(result_list);\n                });\n            },\n            minLength: 3,\n            select: function(event, ui) {\n                var tsr_id = ui.item.value;\n                var new_route = `repository/s/${this.model.tool_shed}/r/${tsr_id}`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            }\n        });\n        $(\".fa-fw\").on(\"click\", ev => {\n            var parameters = {};\n            parameters.field = $(ev.target).attr(\"data-field\");\n            parameters.direction = $(ev.target).attr(\"data-direction\");\n            var new_route = `category/s/${this.model.tool_shed}/c/${this.model.category}/k/${parameters.field}/p/${\n                this.params.page\n            }/t/${parameters.direction}`;\n            Backbone.history.navigate(new_route, {\n                trigger: true,\n                replace: true\n            });\n        });\n        $(\".pagenav\").on(\"click\", ev => {\n            var page = $(ev.target).attr(\"data-page\");\n            var new_route = `category/s/${this.model.tool_shed}/c/${this.model.category}/k/${\n                this.params.sort_key\n            }/p/${page}/t/${this.params.sort_order}`;\n            Backbone.history.navigate(new_route, {\n                trigger: true,\n                replace: true\n            });\n        });\n    },\n\n    templatePageNavigation: _.template(\n        [\n            '<div class=\"navigation\">',\n            \"<% if (page != 1) { %>\",\n            '<a data-page=\"1\" class=\"pagenav fa fa-fast-backward\" />',\n            '<a data-page=\"<%= previous %>\" class=\"pagenav fa fa-step-backward\" />',\n            \"<% } else { %>\",\n            '<a data-page=\"1\" class=\"pagenav-inactive fa fa-fast-backward\" />',\n            '<a data-page=\"<%= previous %>\" class=\"pagenav-inactive fa fa-step-backward\" />',\n            \"<% } %>\",\n            \"<% if (pages > 5) { %>\",\n            \"<% if (page != 1) { %>\",\n            '<a data-page=\"1\" class=\"pagenav fa\"><a>1</a>',\n            \"<% if (page != 2) { %>\",\n            '<a class=\"fa\">&hellip;</a>',\n            \"<% } %>\",\n            \"<% } else { %>\",\n            '<a data-page=\"1\" class=\"pagenav-inactive fa\"><a>1</a>',\n            \"<% } %>\",\n            \"<% _.each(page_slice, function(i) { %>\",\n            \"<% if (i == page) { %>\",\n            '<a data-page=\"<%= i %>\" class=\"fa\"><strong><%= i %></strong></a>',\n            \"<% } else { %>\",\n            '<a data-page=\"<%= i %>\" class=\"pagenav fa\"><%= i %></a>',\n            \"<% } %>\",\n            \"<% }); %>\",\n            \"<% var last_pages = [pages - 2, pages - 1, pages]; %>\",\n            \"<% if (last_pages.indexOf(parseInt(page)) == -1) { %>\",\n            '<a class=\"fa\">&hellip;</a>',\n            '<a data-page=\"<%= pages %>\" class=\"pagenav fa\"><%= pages %></a>',\n            \"<% } %>\",\n            \"<% } else { %>\",\n            \"<% for (i = 1; i <= pages; i++) { %>\",\n            \"<% if (i == page) { %>\",\n            '<a data-page=\"<%= i %>\" class=\"fa\"><strong><%= i %></strong></a>',\n            \"<% } else { %>\",\n            '<a data-page=\"<%= i %>\" class=\"pagenav fa\"><%= i %></a>',\n            \"<% } %>\",\n            \"<% } %>\",\n            \"<% } %>\",\n            \"<% if (page < pages) { %>\",\n            '<a data-page=\"<%= next %>\" class=\"pagenav fa fa-step-forward\" />',\n            '<a data-page=\"<%= pages %>\" class=\"pagenav fa fa-fast-forward\" />',\n            \"<% } else { %>\",\n            '<a data-page=\"<%= next %>\" class=\"pagenav-inactive fa fa-step-forward\" />',\n            '<a data-page=\"<%= pages %>\" class=\"pagenav-inactive fa fa-fast-forward\" />',\n            \"<% } %>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateCategoryContents: _.template(\n        [\n            '<style type=\"text/css\">',\n            \".ui-autocomplete { background-color: #fff; }\",\n            \"li.ui-menu-item { list-style-type: none; }\",\n            \"div.navigation { width: 100%; text-align: center; }\",\n            \"div.navigation a { margin-left: 0.5em; margin-right: 0.5em; display: inline; text-decoration: underline; }\",\n            \"a.pagenav-inactive { opacity: 0.5; }\",\n            \"</style>\",\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n            '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n            '<span class=\"ui-widget\" >',\n            '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n            \"</span>\",\n            \"</div>\",\n            \"<% if (category.get('repository_count') > 25) { %>\",\n            \"<%= page_navigation %>\",\n            \"<% } %>\",\n            '<div style=\"clear: both; margin-top: 1em;\">',\n            '<table class=\"grid table-striped\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th style=\"width: 10%;\"><a class=\"fa fa-fw <%= sorting.class.owner %>\" data-direction=\"<%= sorting.direction.owner %>\" data-field=\"owner\">Owner</a></th>',\n            '<th style=\"width: 15%;\"><a class=\"fa fa-fw <%= sorting.class.name %>\" data-direction=\"<%= sorting.direction.name %>\" data-field=\"name\">Name</a></th>',\n            '<th><a class=\"fa fa-fw <%= sorting.class.description %>\" data-direction=\"<%= sorting.direction.description %>\" data-field=\"description\">Synopsis</a></th>',\n            '<th style=\"width: 10%;\">Type</th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n            \"<tr>\",\n            \"<td><%= repository.owner %></td>\",\n            \"<td>\",\n            '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n            '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n            \"</div>\",\n            \"</td>\",\n            \"<td><%= repository.description %></td>\",\n            \"<td><%= repository.type %></td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Category: ToolShedCategoryContentsView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport \"libs/jquery/jstree\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport Utils from \"utils/utils\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport FormView from \"mvc/form/form-view\";\nimport toolshed_util from \"mvc/toolshed/util\";\n\nvar ToolShedRepositoryView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(params) {\n        this.options = _.defaults(this.options || {}, this.defaults);\n        this.model = new toolshed_model.RepositoryCollection();\n        this.listenTo(this.model, \"sync\", this.render);\n        var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n        this.model.url += `?tool_shed_url=${shed}&repository_id=${params.repository_id}`;\n        this.model.tool_shed_url = params.tool_shed.replace(/%2f/g, \"/\");\n        this.model.tool_shed = shed;\n        this.model.category = params.repository_id;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        var repo_details_template = this.templateRepoDetails;\n        var models = this.model.models[0];\n        this.options = {\n            repository: models.get(\"repository\"),\n            tool_shed: this.model.tool_shed,\n            queue: toolshed_util.queueLength()\n        };\n        var changesets = Object.keys(this.options.repository.metadata).sort(function(a, b) {\n            return parseInt(a.split(\":\")[0] - b.split(\":\")[0]);\n        });\n        var ordered_metadata = {};\n        var unordered_metadata = this.options.repository.metadata;\n        changesets.forEach(function(key) {\n            ordered_metadata[key] = unordered_metadata[key];\n        });\n        this.options.repository.metadata = ordered_metadata;\n        this.options.current_changeset = this.options.current_changeset || changesets[changesets.length - 1];\n        this.options.current_metadata = this.options.repository.metadata[this.options.current_changeset];\n        this.options.current_metadata.tool_shed_url = this.model.tool_shed_url;\n        this.options.tools = this.options.current_metadata.tools;\n        this.options.repository_dependencies_template = this.templateRepoDependencies;\n        this.options.repository_dependency_template = this.templateRepoDependency;\n        this.options.tps_template_global_select = this.templateGlobalSectionSelect;\n        this.options.tps_template_global_create = this.templateGlobalSectionCreate;\n        this.options.tps_template_tool_select = this.templateToolSectionSelect;\n        this.options.tps_template_tool_create = this.templateToolSectionCreate;\n        this.options.panel_section_options = this.templatePanelSelectOptions;\n        this.options.tool_dependencies = models.get(\"tool_dependencies\");\n        this.options.shed_tool_conf = this.templateShedToolConf({\n            shed_tool_confs: models.get(\"shed_conf\")\n        });\n        this.options.panel_section_dict = models.get(\"panel_section_dict\");\n        this.options.api_url = `${getAppRoot()}api/tool_shed_repositories/install?async=True`;\n        this.options = _.extend(this.options, options);\n        this.$el.html(repo_details_template(this.options));\n        this.checkInstalled(this.options.current_metadata);\n        this.bindEvents();\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    bindEvents: function() {\n        $(\"#changeset\").on(\"change\", () => {\n            this.options.current_changeset = $(\"#changeset\")\n                .find(\"option:selected\")\n                .text();\n            this.options.current_metadata = this.options.repository.metadata[this.options.current_changeset];\n            this.checkInstalled(this.options.current_metadata);\n            this.reDraw(this.options);\n        });\n        $(\"#tool_panel_section_select\").on(\"change\", () => {\n            this.tpsSelection();\n        });\n        $(\"#install_repository\").on(\"click\", ev => {\n            ev.preventDefault();\n            var params = {};\n            params.repositories = JSON.stringify([\n                [\n                    $(\"#install_repository\").attr(\"data-tsrid\"),\n                    $(\"#changeset\")\n                        .find(\"option:selected\")\n                        .val()\n                ]\n            ]);\n            params.tool_shed_repository_ids = JSON.stringify([$(\"#install_repository\").attr(\"data-tsrid\")]);\n            params.tool_shed_url = this.model.tool_shed_url;\n            params.install_tool_dependencies = $(\"#install_tool_dependencies\").val();\n            params.install_repository_dependencies = $(\"#install_repository_dependencies\").val();\n            params.install_resolver_dependencies = $(\"#install_resolver_dependencies\").val();\n            params.tool_panel_section = JSON.stringify(this.panelSelect(params));\n            params.shed_tool_conf = $(\"select[name='shed_tool_conf']\")\n                .find(\"option:selected\")\n                .val();\n            params.changeset = $(\"#changeset\")\n                .find(\"option:selected\")\n                .val();\n            var url = $(\"#repository_installation\").attr(\"action\");\n            this.prepareInstall(params, url);\n        });\n        $(\"#queue_install\").on(\"click\", ev => {\n            this.options.current_changeset = $(\"#changeset\")\n                .find(\"option:selected\")\n                .text();\n            this.options.current_metadata = this.options.repository.metadata[this.options.current_changeset];\n            var repository_metadata = {};\n            _.each(Object.keys(this.options.current_metadata), key => {\n                if (!repository_metadata[key]) {\n                    repository_metadata[key] = this.options.current_metadata[key];\n                }\n            });\n            repository_metadata.install_tool_dependencies = $(\"#install_tool_dependencies\").val();\n            repository_metadata.install_repository_dependencies = $(\"#install_repository_dependencies\").val();\n            repository_metadata.install_resolver_dependencies = $(\"#install_resolver_dependencies\").val();\n            repository_metadata.tool_panel_section = JSON.stringify(this.panelSelect({}));\n            repository_metadata.shed_tool_conf = $(\"select[name='shed_tool_conf']\")\n                .find(\"option:selected\")\n                .val();\n            repository_metadata.tool_shed_url = this.model.tool_shed_url;\n            if (repository_metadata.tool_shed_url.substr(-1) == \"/\") {\n                repository_metadata.tool_shed_url = repository_metadata.tool_shed_url.substr(\n                    0,\n                    repository_metadata.tool_shed_url.length - 1\n                );\n            }\n            toolshed_util.addToQueue(repository_metadata);\n            this.checkInstalled(repository_metadata);\n        });\n        this.toolTPSSelectionEvents();\n        $(() => {\n            $(\"#repository_dependencies\").jstree();\n        });\n        $(\".tool_form\").on(\"click\", ev => {\n            var guid = $(ev.target).attr(\"data-guid\");\n            var name = $(ev.target).attr(\"data-name\");\n            var desc = $(ev.target).attr(\"data-desc\");\n            var tool_shed_url = this.model.tool_shed_url;\n            var tsr_id = $(\"#repository_details\").attr(\"data-tsrid\");\n            var changeset = $(\"#changeset\")\n                .find(\"option:selected\")\n                .val();\n            var api_url = `${getAppRoot()}api/tool_shed/tool_json`;\n            var params = {\n                guid: guid,\n                tool_shed_url: tool_shed_url,\n                tsr_id: tsr_id,\n                changeset: changeset\n            };\n            $.get(api_url, params, data => {\n                var toolform = new FormView(data);\n                Utils.deepeach(data.inputs, input => {\n                    if (input.type) {\n                        if ([\"data\", \"data_collection\"].indexOf(input.type) != -1) {\n                            input.type = \"hidden\";\n                            input.info = `Data input '${input.name}' (${Utils.textify(input.extensions)})`;\n                        }\n                    }\n                });\n                var modal = new Modal.View();\n                var modal_title = `<u>${name}</u> ${desc}`;\n                modal.show({\n                    closing_events: true,\n                    title: modal_title,\n                    body: toolform.$el,\n                    buttons: {\n                        Close: function() {\n                            modal.hide();\n                        }\n                    }\n                });\n            });\n        });\n        $(\".select-tps-button\").on(\"click\", params => {\n            var changeset = this.selectedChangeset();\n            var guid = params.target.attributes.getNamedItem(\"data-toolguid\");\n            this.showToolTPSSelect(guid, changeset);\n        });\n        $(\".create-tps-button\").on(\"click\", params => {\n            var changeset = this.selectedChangeset();\n            var guid = params.target.attributes.getNamedItem(\"data-toolguid\");\n            this.showToolTPSCreate(guid, changeset);\n        });\n        $(\".global-select-tps-button\").on(\"click\", () => {\n            $(\"#tool_panel_section\").replaceWith(this.options.tps_template_global_select(this.options));\n            this.propagateTPS();\n            this.bindEvents();\n        });\n        $(\".global-create-tps-button\").on(\"click\", () => {\n            $(\"#tool_panel_section\").replaceWith(this.options.tps_template_global_create());\n            this.bindEvents();\n        });\n    },\n\n    checkInstalled: function(metadata) {\n        var params = { name: metadata.name, owner: metadata.owner };\n        var already_installed = false;\n        $.get(`${getAppRoot()}api/tool_shed_repositories`, params, data => {\n            for (var index = 0; index < data.length; index++) {\n                var repository = data[index];\n                var installed = !repository.deleted && !repository.uninstalled;\n                var changeset_match =\n                    repository.changeset_revision == metadata.changeset_revision ||\n                    repository.installed_changeset_revision == metadata.changeset_revision;\n                if (\n                    repository.name == metadata.repository.name &&\n                    repository.owner == metadata.repository.owner &&\n                    installed &&\n                    changeset_match\n                ) {\n                    already_installed = true;\n                }\n                if (already_installed) {\n                    $(\"#install_repository\").prop(\"disabled\", true);\n                    $(\"#install_repository\").val(\"This revision is already installed\");\n                } else {\n                    $(\"#install_repository\").prop(\"disabled\", false);\n                    $(\"#install_repository\").val(\"Install this revision\");\n                }\n            }\n            if (this.repoQueued(metadata) || already_installed) {\n                $(\"#queue_install\").hide();\n                $(\"#queue_install\").val(\"This revision is already in the queue\");\n            } else {\n                $(\"#queue_install\").show();\n                $(\"#queue_install\").val(\"Install this revision later\");\n            }\n        });\n    },\n\n    panelSelect: function(params) {\n        var tool_panel_section = {};\n        if ($(\"#tool_panel_section_select\").length) {\n            params.tool_panel_section_id = $(\"#tool_panel_section_select\")\n                .find(\"option:selected\")\n                .val();\n        } else {\n            params.new_tool_panel_section = $(\"#new_tool_panel_section\").val();\n        }\n        $(\".tool_panel_section_picker\").each(function() {\n            var element_name = $(this).attr(\"name\");\n            var tool_guid = $(this).attr(\"data-toolguid\");\n            if (element_name === \"tool_panel_section_id\") {\n                tool_panel_section[tool_guid] = {\n                    tool_panel_section: $(this)\n                        .find(\"option:selected\")\n                        .val(),\n                    action: \"append\"\n                };\n            } else {\n                tool_panel_section[tool_guid] = {\n                    tool_panel_section: $(this).val(),\n                    action: \"create\"\n                };\n            }\n        });\n        return tool_panel_section;\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.render(options);\n    },\n\n    repoQueued: function(metadata) {\n        if (!window.localStorage.repositories) {\n            return;\n        }\n        var queue_key = this.queueKey(metadata);\n        var queued_repos;\n        if (window.localStorage.repositories) {\n            queued_repos = JSON.parse(window.localStorage.repositories);\n        }\n        if (queued_repos && queued_repos.hasOwnProperty(queue_key)) {\n            return true;\n        }\n        return false;\n    },\n\n    queueKey: function(metadata) {\n        var shed_url = this.model.tool_shed_url;\n        // Make sure there is never a trailing slash on the shed URL.\n        if (shed_url.substr(-1) == \"/\") {\n            shed_url = shed_url.substr(0, shed_url.length - 1);\n        }\n        return `${shed_url}|${metadata.repository_id}|${metadata.changeset_revision}`;\n    },\n\n    tpsSelection: function() {\n        var new_tps = $(\"#tool_panel_section_select\")\n            .find(\"option:selected\")\n            .val();\n        $('.tool_panel_section_picker[default=\"active\"]').each(function() {\n            $(this).val(new_tps);\n        });\n    },\n\n    prepareInstall: function(params, api_url) {\n        $.post(api_url, params, data => {\n            var iri_parameters = JSON.parse(data);\n            this.doInstall(iri_parameters);\n        });\n    },\n\n    doInstall: function(params) {\n        var controller_url = `${getAppRoot()}admin_toolshed/install_repositories`;\n        var repositories = params.repositories;\n        var new_route = `status/r/${repositories.join(\"|\")}`;\n        $.post(controller_url, params, data => {\n            console.log(\"Initializing repository installation succeeded\");\n        });\n        Backbone.history.navigate(new_route, {\n            trigger: true,\n            replace: true\n        });\n    },\n\n    selectedChangeset: function() {\n        var changeset = $(\"#changeset\")\n            .find(\"option:selected\")\n            .val();\n        return changeset;\n    },\n\n    showToolTPSCreate: function(guid, changeset) {\n        var metadata = this.options.current_metadata;\n        var tools = metadata.tools;\n        var tool = toolshed_util.toolByGuid(guid, changeset, tools);\n        var selector = \"#tool_tps_\" + tool.clean;\n        $(selector).empty();\n        $(selector).append(this.options.tps_template_tool_create({ tool: tool }));\n        $(\".select-tps-button\").click(ev => {\n            var changeset = this.selectedChangeset();\n            var guid = ev.target.attributes.getNamedItem(\"data-toolguid\");\n            this.showToolTPSSelect(guid, changeset);\n        });\n        this.bindEvents();\n    },\n\n    showToolTPSSelect: function(guid, changeset) {\n        var metadata = this.options.current_metadata;\n        var tools = metadata.tools;\n        var tool = toolshed_util.toolByGuid(guid, changeset, tools);\n        var selector = \"#tool_tps_\" + tool.clean;\n        $(selector).empty();\n        $(selector).append(\n            this.options.tps_template_tool_select({\n                tool: tool,\n                panel_section_dict: this.options.panel_section_dict,\n                panel_section_options: this.options.panel_section_options\n            })\n        );\n        $(\".create-tps-button\").click(ev => {\n            var changeset = this.selectedChangeset();\n            var guid = ev.target.attributes.getNamedItem(\"data-toolguid\");\n            this.showToolTPSCreate(guid, changeset);\n        });\n        this.bindEvents();\n    },\n\n    propagateTPS: function() {\n        $(\"#tool_panel_section_select\").change(() => {\n            var new_tps = $(\"#tool_panel_section_select\")\n                .find(\"option:selected\")\n                .val();\n            $('.tool_panel_section_picker[default=\"active\"]').each(obj => {\n                obj.val(new_tps);\n            });\n        });\n        this.toolTPSSelectionEvents();\n    },\n\n    toolTPSSelectionEvents: function() {\n        $(\".tool_panel_section_picker\").on(\"change\", ev => {\n            let element = $(ev.target);\n            var new_value = element.find(\"option:selected\").val();\n            var default_tps = $(\"#tool_panel_section_select\")\n                .find(\"option:selected\")\n                .val();\n            if (new_value == default_tps) {\n                element.attr(\"default\", \"active\");\n            } else {\n                element.removeAttr(\"default\");\n            }\n        });\n    },\n\n    templateRepoDetails: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\">Repository information for&nbsp;<strong><%= repository.name %></strong>&nbsp;from&nbsp;<strong><%= repository.owner %></strong><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"repository_details\" data-tsrid=\"<%= repository.id %>\">',\n            '<form id=\"repository_installation\" name=\"install_repository\" method=\"post\" action=\"<%= api_url %>\">',\n            '<input type=\"hidden\" id=\"repositories\" name=\"<%= repository.id %>\" value=\"ID\" />',\n            '<input type=\"hidden\" id=\"tool_shed_url\" name=\"tool_shed_url\" value=\"<%= tool_shed %>\" />',\n            '<div class=\"toolForm\">',\n            '<div class=\"toolFormTitle\">Changeset</div>',\n            '<div class=\"toolFormBody changeset\">',\n            '<select id=\"changeset\" name=\"changeset\" style=\"margin: 5px;\">',\n            \"<% _.each(Object.keys(repository.metadata), function(changeset) { %>\",\n            '<% if (changeset == current_changeset) { var selected = \"selected \"; } else { var selected = \"\"; } %>',\n            '<option <%= selected %>value=\"<%= changeset.split(\":\")[1] %>\"><%= changeset %></option>',\n            \"<% }); %>\",\n            \"</select>\",\n            '<input class=\"btn btn-primary preview-button\" data-tsrid=\"<%= current_metadata.repository.id %>\" type=\"submit\" id=\"install_repository\" name=\"install_repository\" value=\"Install this revision now\" />',\n            '<input class=\"btn btn-primary preview-button\" type=\"button\" id=\"queue_install\" name=\"queue_install\" value=\"Install this revision later\" />',\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">Please select a revision and review the settings below before installing.</div>',\n            \"</div>\",\n            \"</div>\",\n            \"<%= shed_tool_conf %>\",\n            \"<% if (current_metadata.has_repository_dependencies) { %>\",\n            '<div class=\"toolFormTitle\">Repository dependencies for <strong id=\"current_changeset\"><%= current_changeset %></strong></div>',\n            '<div class=\"toolFormBody\">',\n            '<p id=\"install_repository_dependencies_checkbox\">',\n            '<input type=\"checkbox\" checked id=\"install_repository_dependencies\" />',\n            '<label for=\"install_repository_dependencies\">Install repository dependencies</label>',\n            \"</p>\",\n            \"<% current_metadata.repository_dependency_template = repository_dependency_template; %>\",\n            '<div class=\"tables container-table\" id=\"repository_dependencies\">',\n            '<div class=\"expandLink\">',\n            '<a class=\"toggle_folder\" data_target=\"repository_dependencies_table\">',\n            \"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>\",\n            \"</a>\",\n            \"</div>\",\n            \"<%= repository_dependencies_template(current_metadata) %>\",\n            \"</div>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"<% if (current_metadata.includes_tool_dependencies) { %>\",\n            '<div class=\"toolFormTitle\">Tool dependencies</div>',\n            '<div class=\"toolFormBody\">',\n            '<p id=\"install_resolver_dependencies_checkbox\">',\n            '<input type=\"checkbox\" checked id=\"install_resolver_dependencies\" />',\n            '<label for=\"install_resolver_dependencies\">Install resolver dependencies</label>',\n            \"</p>\",\n            '<p id=\"install_tool_dependencies_checkbox\">',\n            '<input type=\"checkbox\" checked id=\"install_tool_dependencies\" />',\n            '<label for=\"install_tool_dependencies\">Install tool dependencies</label>',\n            \"</p>\",\n            '<div class=\"tables container-table\" id=\"tool_dependencies\">',\n            '<div class=\"expandLink\">',\n            '<a class=\"toggle_folder\" data_target=\"tool_dependencies_table\">',\n            \"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>\",\n            \"</a>\",\n            \"</div>\",\n            '<table class=\"tables container-table\" id=\"tool_dependencies_table\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            \"<thead>\",\n            '<tr style=\"display: table-row;\" class=\"datasetRow\" parent=\"0\" id=\"libraryItem-rt-f9cad7b01a472135\">',\n            '<th style=\"padding-left: 40px;\">Name</th>',\n            \"<th>Version</th>\",\n            \"<th>Type</th>\",\n            \"</tr>\",\n            \"</thead>\",\n            '<tbody id=\"tool_deps\">',\n            \"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>\",\n            '<tr class=\"datasetRow tool_dependency_row\" style=\"display: table-row;\">',\n            '<td style=\"padding-left: 40px;\">',\n            \"<%= dependency.name %></td>\",\n            \"<td><%= dependency.version %></td>\",\n            \"<td><%= dependency.type %></td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</tbody>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>\",\n            '<div class=\"toolFormTitle\">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>',\n            '<div class=\"toolFormBody\">',\n            '<div class=\"tables container-table\" id=\"tools_toggle\">',\n            '<table class=\"tables container-table\" id=\"valid_tools\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            \"<thead>\",\n            '<tr style=\"display: table-row;\" class=\"datasetRow\" parent=\"0\" id=\"libraryItem-rt-f9cad7b01a472135\">',\n            '<th style=\"padding-left: 40px;\">Name</th>',\n            \"<th>Description</th>\",\n            \"<th>Version</th>\",\n            \"<th><%= tps_template_global_select({panel_section_dict: panel_section_dict, panel_section_options: panel_section_options}) %></tr>\",\n            \"</thead>\",\n            '<tbody id=\"tools_in_repo\">',\n            \"<% _.each(current_metadata.tools, function(tool) { %>\",\n            '<tr id=\"libraryItem-<%= tool.clean %>\" class=\"tool_row\" style=\"display: table-row;\" style=\"width: 15%\">',\n            '<td style=\"padding-left: 40px;\">',\n            '<div id=\"tool-<%= tool.clean %>\" class=\"menubutton split popup\" style=\"float: left;\">',\n            '<a class=\"tool_form view-info\" data-toggle=\"modal\" data-target=\"toolform_<%= tool.clean %>\" data-clean=\"<%= tool.clean %>\" data-guid=\"<%= tool.guid %>\" data-name=\"<%= tool.name %>\" data-desc=\"<%= tool.description %>\"><%= tool[\"name\"] %></a>',\n            \"</div>\",\n            \"</td>\",\n            \"<td><%= tool.description %></td>\",\n            '<td style=\"width: 15%\"><%= tool.version %></td>',\n            '<td style=\"width: 35%\" id=\"tool_tps_<%= tool.clean %>\">',\n            \"<%= tps_template_tool_select({tool: tool, panel_section_dict: panel_section_dict, panel_section_options: panel_section_options}) %>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</tbody>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"</form>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateRepoDependencies: _.template(\n        [\n            '<div class=\"toolFormTitle\">Repository Dependencies</div>',\n            '<div class=\"toolFormBody tables container-table\" id=\"repository_dependencies\">',\n            \"<ul>\",\n            \"<li>Repository installation requires the following\",\n            \"<% if (has_repository_dependencies) { %>\",\n            \"<% _.each(repository_dependencies, function(dependency) { %>\",\n            \"<% dependency.repository_dependency_template = repository_dependency_template; %>\",\n            \"<%= repository_dependency_template(dependency) %>\",\n            \"<% }); %>\",\n            \"<% } %>\",\n            \"</li>\",\n            \"</ul>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateRepoDependency: _.template(\n        [\n            '<li id=\"metadata_<%= id %>\" class=\"datasetRow repository_dependency_row\">',\n            \"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>\",\n            \"<% if (has_repository_dependencies) { %>\",\n            '<ul class=\"child_dependencies\">',\n            \"<% _.each(repository_dependencies, function(dependency) { %>\",\n            \"<% dependency.repository_dependency_template = repository_dependency_template; %>\",\n            \"<%= repository_dependency_template(dependency) %>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"<% } %>\",\n            \"</li>\"\n        ].join(\"\")\n    ),\n\n    templateShedToolConf: _.template(\n        [\n            '<div class=\"toolFormTitle\">Shed tool configuration file:</div>',\n            '<div class=\"toolFormBody\">',\n            '<div class=\"form-row\">',\n            '<select name=\"shed_tool_conf\">',\n            \"<% _.each(shed_tool_confs.options, function(conf) { %>\",\n            '<option value=\"<%= conf.value %>\"><%= conf.label %></option>',\n            \"<% }); %>\",\n            \"</select>\",\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateToolDependency: _.template(\n        [\n            \"<% if (has_repository_dependencies) { %>\",\n            \"<% _.each(repository_dependencies, function(dependency) { %>\",\n            \"<% if (dependency.includes_tool_dependencies) { %>\",\n            \"<% dependency.tool_dependency_template = tool_dependency_template %>\",\n            \"<%= tool_dependency_template(dependency) %>\",\n            \"<% } %>\",\n            \"<% }); %>\",\n            \"<% } %>\"\n        ].join(\"\")\n    ),\n\n    templateGlobalSectionCreate: _.template(\n        [\n            '<div id=\"tool_panel_section\">',\n            '<div class=\"form-row\" id=\"new_tps\">',\n            '<input id=\"new_tool_panel_section\" name=\"new_tool_panel_section\" type=\"textfield\" value=\"\" size=\"40\"/>',\n            '<input class=\"btn btn-primary global-select-tps-button\" type=\"button\" id=\"select_existing\" value=\"Select existing\" />',\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">',\n            \"Add a new tool panel section to contain the installed tools (optional).\",\n            \"</div>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateGlobalSectionSelect: _.template(\n        [\n            '<div id=\"tool_panel_section\">',\n            '<div class=\"toolFormTitle\">Tool Panel Section</div>',\n            '<div class=\"toolFormBody\">',\n            '<div class=\"tab-pane\" id=\"select_tps\">',\n            '<select name=\"<%= name %>\" id=\"<%= panel_section_dict.id %>\">',\n            \"<%= panel_section_options({sections: panel_section_dict.sections}) %>\",\n            \"</select>\",\n            '<input class=\"btn btn-primary global-create-tps-button\" type=\"button\" id=\"create_new\" value=\"Create new\" />',\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">',\n            \"Select an existing tool panel section to contain the installed tools (optional).\",\n            \"</div>\",\n            \"</div>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateToolSectionCreate: _.template(\n        [\n            '<div id=\"new_tps_<%= tool.clean %>\" data-clean=\"<%= tool.clean %>\" class=\"form-row\">',\n            '<input data-toolguid=\"<%= tool.guid %>\" class=\"tool_panel_section_picker\" size=\"40\" name=\"new_tool_panel_section\" id=\"new_tool_panel_section_<%= tool.clean %>\" type=\"text\">',\n            '<input id=\"per_tool_select_<%= tool.clean %>\" class=\"btn btn-primary select-tps-button\" data-toolguid=\"<%= tool.guid %>\" value=\"Select existing\" id=\"select_existing_<%= tool.clean %>\" type=\"button\">',\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templateToolSectionSelect: _.template(\n        [\n            '<div id=\"select_tps_<%= tool.clean %>\" data-clean=\"<%= tool.clean %>\" class=\"tps_creator\">',\n            '<select default=\"active\" style=\"width: 30em;\" data-toolguid=\"<%= tool.guid %>\" class=\"tool_panel_section_picker\" name=\"tool_panel_section_id\" id=\"tool_panel_section_select_<%= tool.clean %>\">',\n            \"<%= panel_section_options({sections: panel_section_dict.sections}) %>\",\n            \"</select>\",\n            '<input id=\"per_tool_create_<%= tool.clean %>\" data-clean=\"<%= tool.clean %>\" class=\"btn btn-primary create-tps-button\" data-toolguid=\"<%= tool.guid %>\" value=\"Create new\" id=\"create_new_<%= tool.clean %>\" type=\"button\">',\n            '<div style=\"clear: both;\" class=\"toolParamHelp\"></div>',\n            \"</div>\"\n        ].join(\"\")\n    ),\n\n    templatePanelSelectOptions: _.template(\n        [\n            \"<% _.each(sections, function(section) { %>\",\n            '<option value=\"<%= section.id %>\"><%= section.name %></option>',\n            \"<% }); %>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    RepoDetails: ToolShedRepositoryView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\n\nvar View = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: [],\n\n    initialize: function(options) {\n        this.model = new toolshed_model.RepoQueue();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.fetch();\n        this.render();\n    },\n\n    render: function(options) {\n        var repo_queue_template = this.templateRepoQueue;\n        var repositories = this.model.models;\n        this.$el.html(\n            repo_queue_template({\n                title: _l(\"Repository Installation Queue\"),\n                repositories: repositories,\n                empty: _l(\"No repositories in queue.\"),\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        $(\".install_one\").on(\"click\", ev => {\n            var repository_metadata = this.loadFromQueue($(ev.target).attr(\"data-repokey\"));\n            this.installFromQueue(repository_metadata, $(ev.target).attr(\"data-repokey\"));\n        });\n        $(\".remove_one\").on(\"click\", ev => {\n            var queue_key = $(ev.target).attr(\"data-repokey\");\n            var repo_queue = JSON.parse(window.localStorage.repositories);\n            if (repo_queue.hasOwnProperty(queue_key)) {\n                var repository_id = repo_queue[queue_key].repository.id;\n                delete repo_queue[queue_key];\n                $(`#queued_repository_${repository_id}`).remove();\n            }\n            window.localStorage.repositories = JSON.stringify(repo_queue);\n        });\n        $(\"#clear_queue\").on(\"click\", () => {\n            window.localStorage.repositories = \"{}\";\n        });\n        $(\"#from_workflow\").on(\"click\", () => {\n            Backbone.history.navigate(\"workflows\", {\n                trigger: true,\n                replace: true\n            });\n        });\n    },\n\n    installFromQueue: function(repository_metadata, queue_key) {\n        var params = {};\n        params.install_tool_dependencies = repository_metadata.install_tool_dependencies;\n        params.install_repository_dependencies = repository_metadata.install_repository_dependencies;\n        params.install_resolver_dependencies = repository_metadata.install_resolver_dependencies;\n        params.tool_panel_section = repository_metadata.tool_panel_section;\n        params.shed_tool_conf = repository_metadata.shed_tool_conf;\n        params.repositories = JSON.stringify([\n            [repository_metadata.repository.id, repository_metadata.changeset_revision]\n        ]);\n        params.tool_shed_repository_ids = JSON.stringify([repository_metadata.repository.id]);\n        params.tool_shed_url = queue_key.split(\"|\")[0];\n        params.changeset = repository_metadata.changeset_revision;\n        var url = `${getAppRoot()}api/tool_shed_repositories/install?async=True`;\n        $(`#queued_repository_${repository_metadata.repository.id}`).remove();\n        if (window.localStorage.repositories) {\n            if (queue_key === undefined) {\n                queue_key = toolshed_util.queueKey(repository_metadata);\n            }\n            var repository_queue = JSON.parse(window.localStorage.repositories);\n            if (repository_queue.hasOwnProperty(queue_key)) {\n                delete repository_queue[queue_key];\n                window.localStorage.repositories = JSON.stringify(repository_queue);\n            }\n        }\n\n        $.post(url, params, data => {\n            var iri_params = JSON.parse(data);\n            var repositories = iri_params.repositories;\n            var new_route = `status/r/${repositories.join(\"|\")}`;\n            $.post(`${getAppRoot()}admin_toolshed/install_repositories`, iri_params, data => {\n                console.log(\"Initializing repository installation succeeded\");\n            });\n            Backbone.history.navigate(new_route, {\n                trigger: true,\n                replace: true\n            });\n        });\n    },\n\n    loadFromQueue: function(queue_key) {\n        var repository_queue = JSON.parse(window.localStorage.repositories);\n        if (repository_queue.hasOwnProperty(queue_key)) {\n            return repository_queue[queue_key];\n        }\n        return this.defaults;\n    },\n\n    templateRepoQueue: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"tab-pane\" id=\"panel_header\" id=\"repository_queue\">',\n            '<table id=\"queued_repositories\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th class=\"datasetRow\">Name</th>',\n            '<th class=\"datasetRow\">Owner</th>',\n            '<th class=\"datasetRow\">Revision</th>',\n            '<th class=\"datasetRow\">ToolShed</th>',\n            '<th class=\"datasetRow\">Install</th>',\n            '<th class=\"datasetRow\"><input class=\"btn btn-primary\" type=\"submit\" id=\"clear_queue\" name=\"clear_queue\" value=\"Clear queue\" /></th>',\n            \"</tr>\",\n            \"</thead>\",\n            \"<tbody>\",\n            \"<% if (repositories.length > 0) { %>\",\n            \"<% _.each(repositories, function(repository) { %>\",\n            '<tr id=\"queued_repository_<%= repository.get(\"id\") %>\">',\n            '<td class=\"datasetRow\"><%= repository.get(\"repository\").name %></td>',\n            '<td class=\"datasetRow\"><%= repository.get(\"repository\").owner %></td>',\n            '<td class=\"datasetRow\"><%= repository.get(\"changeset_revision\") %></td>',\n            '<td class=\"datasetRow\"><%= repository.get(\"tool_shed_url\") %></td>',\n            '<td class=\"datasetRow\">',\n            '<input class=\"btn btn-primary install_one\" data-repokey=\"<%= repository.get(\"queue_key\") %>\" type=\"submit\" id=\"install_repository_<%= repository.get(\"id\") %>\" name=\"install_repository\" value=\"Install now\" />',\n            \"</td>\",\n            '<td class=\"datasetRow\">',\n            '<input class=\"btn btn-primary remove_one\" data-repokey=\"<%= repository.get(\"queue_key\") %>\" type=\"submit\" id=\"unqueue_repository_<%= repository.get(\"id\") %>\" name=\"unqueue_repository\" value=\"Remove from queue\" />',\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"<% } else { %>\",\n            '<tr><td colspan=\"6\"><%= empty %></td></tr>',\n            \"<% } %>\",\n            \"</tbody>\",\n            \"</table>\",\n            '<input type=\"button\" class=\"btn btn-primary\" id=\"from_workflow\" value=\"Add from workflow\" />',\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    RepoQueueView: View\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\n\nvar ToolShedRepoStatusView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(options) {\n        this.options = _.defaults(this.options || [{}], options, this.defaults);\n        this.model = new toolshed_model.RepoStatus();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.url += `?repositories=${this.options.repositories.join(\"|\")}`;\n        this.model.fetch();\n        this.timer = window.setInterval(() => {\n            var terminal_states = [\"installed\", \"error\"];\n            var all_done = true;\n            _.some(this.model.models, repository => {\n                var repo_status = repository.get(\"status\").toLowerCase();\n                if (terminal_states.indexOf(repo_status) === -1) {\n                    all_done = false;\n                    return true;\n                }\n            });\n            if (all_done) {\n                window.clearInterval(this.timer);\n            } else {\n                this.model.fetch();\n            }\n        }, 2000);\n    },\n\n    close: function() {\n        window.clearInterval(this.timer);\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var repo_status_template = this.templateRepoStatus;\n        this.$el.html(\n            repo_status_template({\n                title: _l(\"Repository Status\"),\n                repositories: this.model.models,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    templateRepoStatus: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".state-color-new,\",\n            \".state-color-deactivated,\",\n            \".state-color-uninstalled { border-color:#bfbfbf; background:#eee }\",\n            \".state-color-cloning,\",\n            \".state-color-setting-tool-versions,\",\n            \".state-color-installing-repository-dependencies,\",\n            \".state-color-installing-tool-dependencies,\",\n            \".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }\",\n            \".state-color-installed { border-color:#20b520; background:#b0f1b0 }\",\n            \".state-color-error { border-color:#dd1b15; background:#f9c7c5 }\",\n            \"</style>\",\n            '<table id=\"grid-table\" class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th id=\"null-header\">Name<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Description<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Owner<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Revision<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Installation Status<span class=\"sort-arrow\"></span></th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<tbody id=\"grid-table-body\">',\n            \"<% _.each(repositories, function(repository) { %>\",\n            \"<tr>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-name-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"name\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-desc-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"description\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-user-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"owner\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-changeset-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"changeset_revision\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"RepositoryStatus-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<div class=\"repo-status count-box state-color-<%= repository.get(\"status\").toLowerCase().replace(/ /g, \"-\") %>\" id=\"RepositoryStatus-<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"status\") %>',\n            \"</div>\",\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</tbody>\",\n            '<tfoot id=\"grid-table-footer\"></tfoot>',\n            \"</table>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    RepoStatus: ToolShedRepoStatusView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\n\nvar View = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: [{}],\n\n    initialize: function(options) {\n        this.model = new toolshed_model.WorkflowTools();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.fetch();\n        this.render();\n    },\n\n    render: function(options) {\n        var workflows_missing_tools = this.templateWorkflows;\n        var workflows = this.model.models;\n        this.$el.html(\n            workflows_missing_tools({\n                title: _l(\"Workflows Missing Tools\"),\n                workflows: workflows,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var repository_id;\n        $(\".show_wf_repo\").on(\"click\", ev => {\n            var tool_ids = $(ev.target).attr(\"data-toolids\");\n            var toolshed = $(ev.target).attr(\"data-shed\");\n            var api_url = `${getAppRoot()}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                var new_route = `repository/s/${toolshed.replace(/:/g, \"%3a\").replace(/\\//g, \"%2f\")}/r/${\n                    data.repository.id\n                }`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            });\n        });\n        $(\".queue_wf_repo\").on(\"click\", ev => {\n            var elem = $(ev.target);\n            var tool_ids = elem.attr(\"data-toolids\");\n            var toolshed = elem.attr(\"data-shed\");\n            var api_url = `${getAppRoot()}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                params = {\n                    tool_shed_url: toolshed,\n                    repository_id: repository_id\n                };\n                $.get(api_url, params, data => {\n                    var changesets = Object.keys(data.repository.metadata);\n                    var current_changeset = changesets[0];\n                    var current_metadata = data.repository.metadata[current_changeset];\n                    current_metadata.tool_shed_url = toolshed;\n                    toolshed_util.addToQueue(current_metadata);\n                    elem.remove();\n                });\n            });\n        });\n        $(\"#from_workflow\").on(\"click\", this.loadWorkflows);\n    },\n\n    templateWorkflows: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %><a class=\"ml-auto\" href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }\",\n            \"</style>\",\n            '<table id=\"workflows_missing_tools\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th class=\"datasetRow\">Workflows</th>',\n            '<th class=\"datasetRow\">Tool IDs</th>',\n            '<th class=\"datasetRow\">Shed</th>',\n            '<th class=\"datasetRow\">Name</th>',\n            '<th class=\"datasetRow\">Owner</th>',\n            '<th class=\"datasetRow\">Actions</th>',\n            \"</tr>\",\n            \"</thead>\",\n            \"<tbody>\",\n            \"<% _.each(workflows, function(workflow) { %>\",\n            \"<tr>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_names\">',\n            '<% _.each(workflow.get(\"workflows\"), function(name) { %>',\n            '<li class=\"workflow_names\"><%= name %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<% _.each(workflow.get(\"tools\"), function(tool) { %>',\n            '<li class=\"workflow_tools\"><%= tool %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\"><%= workflow.get(\"shed\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"repository\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"owner\") %></td>',\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<li class=\"workflow_tools\">',\n            '<input type=\"button\" class=\"show_wf_repo btn btn-primary\" data-shed=\"<%= workflow.get(\"shed\") %>\" data-owner=\"<%= workflow.get(\"owner\") %>\" data-repo=\"<%= workflow.get(\"repository\") %>\" data-toolids=\"<%= workflow.get(\"tools\").join(\",\") %>\" value=\"Show Repository\" /></li>',\n            \"</ul>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Workflows: View\n};\n","import Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport mod_shed_list_view from \"mvc/toolshed/shed-list-view\";\nimport mod_categories_view from \"mvc/toolshed/categories-view\";\nimport mod_repositories_view from \"mvc/toolshed/repositories-view\";\nimport mod_repository_view from \"mvc/toolshed/repository-view\";\nimport mod_repoqueue_view from \"mvc/toolshed/repository-queue-view\";\nimport mod_repo_status_view from \"mvc/toolshed/repo-status-view\";\nimport mod_workflows_view from \"mvc/toolshed/workflows-view\";\n\nvar AdminToolshedRouter = Backbone.Router.extend({\n    initialize: function() {\n        this.routesHit = 0;\n        // keep count of number of routes handled by the application\n        Backbone.history.on(\n            \"route\",\n            function() {\n                this.routesHit++;\n            },\n            this\n        );\n        this.bind(\"route\", this.trackPageview);\n    },\n\n    routes: {\n        \"\": \"toolsheds\",\n        sheds: \"toolsheds\",\n        queue: \"queue\",\n        workflows: \"workflows\",\n        \"status/r/:repositories\": \"status\",\n        status: \"status\",\n        \"categories/s/:tool_shed\": \"categories\",\n        \"category/s/:tool_shed/c/:category_id/k/:sort_key/p/:page/t/:sort_order\": \"repositories\",\n        \"repository/s/:tool_shed/r/:repository_id\": \"repository\"\n    },\n\n    /**\n     * If more than one route has been hit the user did not land on current\n     * page directly so we can go back safely. Otherwise go to the home page.\n     * Use replaceState if available so the navigation doesn't create an\n     * extra history entry\n     */\n    back: function() {\n        if (this.routesHit > 1) {\n            window.history.back();\n        } else {\n            this.navigate(\"#\", { trigger: true, replace: true });\n        }\n    }\n});\n\nvar GalaxyAdminToolshedApp = Backbone.View.extend({\n    app_config: {\n        known_views: [\"toolsheds\", \"queue\", \"status\", \"categories\", \"repositories\", \"repository\"]\n    },\n\n    initialize: function() {\n        let Galaxy = getGalaxyInstance();\n\n        Galaxy.admintoolshedapp = this;\n        this.admin_toolshed_router = new AdminToolshedRouter();\n\n        this.admin_toolshed_router.on(\"route:queue\", () => {\n            Galaxy.admintoolshedapp.adminRepoQueueView = new mod_repoqueue_view.RepoQueueView();\n        });\n        this.admin_toolshed_router.on(\"route:toolsheds\", () => {\n            Galaxy.admintoolshedapp.adminShedListView = new mod_shed_list_view.ShedListView();\n        });\n        this.admin_toolshed_router.on(\"route:categories\", tool_shed => {\n            Galaxy.admintoolshedapp.adminShedCategoriesView = new mod_categories_view.CategoryView({\n                tool_shed: tool_shed.replace(/\\//g, \"%2f\")\n            });\n        });\n        this.admin_toolshed_router.on(\n            \"route:repositories\",\n            (tool_shed, category_id, sort_key = \"name\", page = 1, sort_order = \"asc\") => {\n                Galaxy.admintoolshedapp.adminShedCategoryView = new mod_repositories_view.Category({\n                    tool_shed: tool_shed.replace(/\\//g, \"%2f\"),\n                    category_id: category_id,\n                    page: page,\n                    sort_order: sort_order,\n                    sort_key: sort_key\n                });\n            }\n        );\n        this.admin_toolshed_router.on(\"route:repository\", (tool_shed, repository_id) => {\n            Galaxy.admintoolshedapp.adminRepositoryView = new mod_repository_view.RepoDetails({\n                tool_shed: tool_shed.replace(/\\//g, \"%2f\"),\n                repository_id: repository_id\n            });\n        });\n        this.admin_toolshed_router.on(\"route:status\", repositories => {\n            Galaxy.admintoolshedapp.adminRepoStatusView = new mod_repo_status_view.RepoStatus({\n                repositories: repositories.split(\"|\")\n            });\n        });\n        this.admin_toolshed_router.on(\"route:workflows\", () => {\n            Galaxy.admintoolshedapp.adminWorkflowsView = new mod_workflows_view.Workflows();\n        });\n\n        Backbone.history.start({ pushState: false });\n    }\n});\n\nexport default {\n    GalaxyApp: GalaxyAdminToolshedApp\n};\n","import $ from \"jquery\";\nimport _l from \"utils/localization\";\n\nimport GridView from \"mvc/grid/grid-view\";\nimport { show_modal, hide_modal } from \"layout/modal\";\nimport { make_popupmenu } from \"ui/popupmenu\";\nimport { getGalaxyInstance } from \"app\";\nimport { buildConfig } from \"utils/genericConfig\";\n\n// Built a generic config container for the properties that\n// are passed in from python then used (formerly) globally\nconst configs = buildConfig();\n\n// Turn these window variables into config props list_objects_url,\n// set_accessible_url, get_name_and_link_url, editor_base_path,\n// iframe_base_path, save_url, page_id, page_list_url\nfunction setPageConfigs(incoming = {}) {\n    return Object.assign(configs, incoming);\n}\n\nvar WYMeditor = window.WYMeditor;\n\nvar CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular;\n    var item_plural;\n    var item_controller;\n    var item_class;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = `list_${item_plural.toLowerCase()}_for_selection`;\n    var ajax_url = configs.list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = configs.set_accessible_url.replace(\"ITEM_CONTROLLER\", item_controller);\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(`Making ${item_type} accessible failed`);\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(dialogType, dialogFeatures, bodyHtml) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n\n        // Get current URL, title.\n        var curURL;\n\n        var curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            `<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='${curURL}' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='${curTitle}' size='40' /></div><div>`,\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\";\n\n                    var sId = $(\".wym_id\").val() || \"\";\n                    var sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(`a[href=${sStamp}]`, wym._doc.body);\n                        link.attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(`${wym._options.dialogImageSelector} ${wym._options.srcSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.SRC)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.titleSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.TITLE)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.altSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.ALT)\n            );\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(`img[src$=${sStamp}]`, wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                            .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\"summary\", $(wym._options.summarySelector).val());\n\n                        //append the table after the selected container\n                        var node = $(wym.findUp(wym.container(), WYMeditor.MAIN_CONTAINERS)).get(0);\n                        if (!node || !node.parentNode) $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        let Galaxy = getGalaxyInstance();\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Insert: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    // Insert links to history for each checked item.\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var item_id = $(this).val();\n\n                        // Make item importable?\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                        var url_template = configs.get_name_and_link_url + item_id;\n                        var ajax_url = url_template.replace(\"ITEM_CONTROLLER\", item_info.controller);\n                        $.getJSON(ajax_url, returned_item_info => {\n                            // Get link text.\n                            wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                            var link_text = $(`a[href=${sStamp}]`, wym._doc.body).text();\n\n                            // Insert link: need to do different actions depending on link text.\n                            if (\n                                link_text == \"\" || // Firefox.\n                                link_text == sStamp // Safari\n                            ) {\n                                // User selected no text; create link from scratch and use default text.\n                                wym.insert(\n                                    `<a href='${returned_item_info.link}'>${item_info.singular} '${\n                                        returned_item_info.name\n                                    }'</a>`\n                                );\n                            } else {\n                                // Link created from selected text; add href and title.\n                                $(`a[href=${sStamp}]`, wym._doc.body)\n                                    .attr(WYMeditor.HREF, returned_item_info.link)\n                                    .attr(WYMeditor.TITLE, item_info.singular + item_id);\n                            }\n                        });\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        let item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        let grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        let Galaxy = getGalaxyInstance();\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Embed: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var elt = $(this);\n                        // Get item ID and name.\n                        var item_id = elt.val();\n                        // Use ':first' because there are many labels in table; the first one is the item name.\n                        var item_name = elt\n                            .closest(\"td\")\n                            .next(\"td\")\n                            .find(\"label\")\n                            .text();\n\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                        // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                        // item_class='History').\n                        var item_elt_id = `${item_info.iclass}-${item_id}`;\n                        var item_embed_html = [\n                            \"<div id='\",\n                            item_elt_id,\n                            \"' class='embedded-item \",\n                            item_info.singular.toLowerCase(),\n                            \" placeholder'>\",\n                            \"<p class='title'>\",\n                            \"Embedded Galaxy \",\n                            item_info.singular,\n                            \" '\",\n                            item_name,\n                            \"'\",\n                            \"</p>\",\n                            \"<p class='content'>\",\n                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                            item_info.singular.toLowerCase(),\n                            \" when it is displayed.]\",\n                            \"</p>\",\n                            \"</div>\"\n                        ].join(\"\");\n\n                        // Insert embedded item into document.\n                        wym.insert(item_embed_html);\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n};\n\nexport default function pagesEditorOnload(renderedConfigs = {}) {\n    setPageConfigs(renderedConfigs);\n\n    // Generic error handling\n    $(document).ajaxError((e, x) => {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: configs.editor_base_path,\n        iframeBasePath: configs.iframe_base_path,\n        // + WYMeditor.HTML\n        boxHtml: `<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>${\n            WYMeditor.TOOLS\n        }</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>${\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME\n        }${WYMeditor.STATUS}</div></div></td></tr></table>`,\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: _l(\"Superscript\"),\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: _l(\"Subscript\"),\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = callback => {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: configs.save_url,\n            type: \"POST\",\n            data: {\n                id: configs.page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify({}),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(() => {\n        save(() => {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(() => {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = () => {\n                window.onbeforeunload = undefined;\n                window.document.location = configs.page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = configs.page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, (k, v) => {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = () => {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n","/**\n * Generic config storage object\n */\n\nexport function buildConfig(defaultConfigs = {}) {\n    let storage = Object.assign({}, defaultConfigs);\n\n    return new Proxy(storage, {\n        get(target, propName) {\n            if (propName in target) {\n                return target[propName];\n            } else {\n                console.warn(\"Requested missing config prop\", propName);\n            }\n        }\n    });\n}\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport { HistoryCollection } from \"mvc/history/history-model\";\nimport HISTORY_VIEW_EDIT from \"mvc/history/history-view-edit\";\nimport JOB_STATES_MODEL from \"mvc/history/job-states-model\";\nimport historyCopyDialog from \"mvc/history/copy-dialog\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport baseMVC from \"mvc/base-mvc\";\nimport ajaxQueue from \"utils/ajax-queue\";\nimport \"ui/search-input\";\n\nvar logNamespace = \"history\";\n/* ==============================================================================\nTODO:\n\n============================================================================== */\n/** @class A container for a history panel that renders controls for that history (delete, copy, etc.) */\nvar HistoryViewColumn = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    tagName: \"div\",\n    className: \"history-column flex-column flex-row-container\",\n    id: function id() {\n        if (!this.model) {\n            return \"\";\n        }\n        return `history-column-${this.model.get(\"id\")}`;\n    },\n\n    // ------------------------------------------------------------------------ set up\n    /** set up passed-in panel (if any) and listeners */\n    initialize: function initialize(options) {\n        options = options || {};\n        this.purgeAllowed = !_.isUndefined(options.purgeAllowed) ? options.purgeAllowed : false;\n        this.panel = options.panel || this.createPanel(options);\n\n        this.setUpListeners();\n    },\n\n    /** create a history panel for this column */\n    createPanel: function createPanel(panelOptions) {\n        return new HISTORY_VIEW_EDIT.HistoryViewEdit(\n            _.defaults(panelOptions, {\n                model: this.model,\n                // non-current panels should set their hdas to draggable\n                purgeAllowed: this.purgeAllowed,\n                dragItems: true,\n                $scrollContainer: function() {\n                    return this.$el;\n                }\n            })\n        );\n    },\n\n    /** set up reflexive listeners */\n    setUpListeners: function setUpListeners() {\n        //this.log( 'setUpListeners', this );\n        this.once(\"rendered\", () => {\n            this.trigger(\"rendered:initial\", this);\n        });\n        this.setUpPanelListeners();\n    },\n\n    /** set listeners needed for panel */\n    setUpPanelListeners: function setUpPanelListeners() {\n        this.listenTo(\n            this.panel,\n            {\n                //'all': function(){ console.info( 'panel of ' + this, arguments ); },\n\n                // assumes panel will take the longest to render\n                rendered: () => {\n                    this.trigger(\"rendered\", this);\n                },\n                // when a panel's view expands turn off the click handler on the rerun button so that it uses it's href\n                // this allows the button to open the tool rerun form in a new tab (instead of erroring)\n                // TODO: hack\n                \"view:expanded view:rendered\": function(view) {\n                    view.$(\".rerun-btn\").off();\n                }\n            },\n            this\n        );\n    },\n\n    /** do the dimensions of this column overlap the given (horizontal) browser coords? */\n    inView: function(viewLeft, viewRight) {\n        var columnLeft = this.$el.offset().left;\n        var columnRight = columnLeft + this.$el.width();\n        if (columnRight < viewLeft) {\n            return false;\n        }\n        if (columnLeft > viewRight) {\n            return false;\n        }\n        return true;\n    },\n\n    /** shortcut to the panel */\n    $panel: function $panel() {\n        return this.$(\".history-panel\");\n    },\n\n    // ------------------------------------------------------------------------ render\n    /** render ths column, its panel, and set up plugins */\n    render: function render(speed) {\n        speed = speed !== undefined ? speed : \"fast\";\n        //this.log( this + '.render', this.$el, this.el );\n        //TODO: not needed\n        var modelData = this.model ? this.model.toJSON() : {};\n        this.$el.html(this.template(modelData));\n        this.renderPanel(speed);\n        // jq 1.12 doesn't fade/show properly when display: flex, re-set here\n        this.panel.$el.css(\"display\", \"flex\");\n        // if model and not children\n        // template\n        // render controls\n        this.setUpBehaviors();\n        // add panel\n        return this;\n    },\n\n    /** set up plugins */\n    setUpBehaviors: function setUpBehaviors() {\n        //this.log( 'setUpBehaviors:', this );\n        // on panel size change, ...\n    },\n\n    /** column body template with inner div for panel based on data (model json) */\n    template: function template(data) {\n        data = _.extend(data || {}, {\n            isCurrentHistory: this.currentHistory\n        });\n        return $(`\n            <div class=\"panel-controls mb-1\">\n                <div class=\"flex-row flex-column-container no-gutters justify-content-between\">\n                    ${this.controlsLeftTemplate({ history: data, view: this })}\n                    ${this.controlsRightTemplate({ history: data, view: this })}\n                </div>\n            </div>\n            <div class=\"inner flex-row flex-column-container\">\n                <div id=\"history-${data.id}\" class=\"history-column history-panel flex-column\"></div>\n            </div>`);\n    },\n\n    /** render the panel contained in the column using speed for fx speed */\n    renderPanel: function renderPanel(speed) {\n        speed = speed !== undefined ? speed : \"fast\";\n        this.panel.setElement(this.$panel()).render(speed);\n        if (this.currentHistory) {\n            this.panel.$list().before(this.panel._renderDropTargetHelp());\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ behaviors and events\n    /** event map */\n    events: {\n        // will make this the current history\n        \"click .switch-to.btn\": function() {\n            this.model.setAsCurrent();\n        },\n        //TODO: remove boiler plate from next 3\n        \"click .delete-history\": function() {\n            this.model._delete().done(data => {\n                this.render();\n            });\n        },\n        \"click .undelete-history\": function() {\n            this.model.undelete().done(data => {\n                this.render();\n            });\n        },\n        \"click .purge-history\": function() {\n            if (window.confirm(_l(\"This will permanently remove the data. Are you sure?\"))) {\n                this.model.purge().done(data => {\n                    this.render();\n                });\n            }\n        },\n        // will copy this history and make the copy the current history\n        \"click .copy-history\": \"copy\"\n    },\n\n    // ------------------------------------------------------------------------ non-current controls\n    /** Open a modal to get a new history name, copy it (if not canceled), and makes the copy current */\n    copy: function copy() {\n        historyCopyDialog(this.model);\n    },\n\n    // ------------------------------------------------------------------------ templates\n    /** controls template displaying controls above the panel based on this.currentHistory */\n    controlsLeftTemplate: _.template(\n        `\n        <div class=\"text-left col-8\">\n            <% if( data.history.isCurrentHistory ){ %>\n                <strong class=\"current-label\">\n                    ${_l(\"Current History\")}\n                </strong>\n            <% } else { %>\n                <button class=\"switch-to btn btn-secondary\">\n                    ${_l(\"Switch to\")}\n                </button>\n            <% } %>\n        </div>`,\n        { variable: \"data\" }\n    ),\n\n    /** controls template displaying controls above the panel based on this.currentHistory */\n    controlsRightTemplate: _.template(\n        `<div class=\"text-right col-4\">\n            <% if( !data.history.purged ){ %>\n                <div class=\"panel-menu btn-group\">\n                    <button type=\"button\" class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">\n                        <span class=\"caret\"></span>\n                    </button>\n                    <ul class=\"dropdown-menu\" role=\"menu\">\n                        <% if( !data.history.deleted ){ %>\n                            <li><a href=\"javascript:void(0);\" class=\"copy-history\">\n                                ${_l(\"Copy\")}\n                            </a></li>\n                            <li><a href=\"javascript:void(0);\" class=\"delete-history\">\n                                ${_l(\"Delete\")}\n                            </a></li>\n                        <% } else /* if is deleted */ { %>\n                            <li><a href=\"javascript:void(0);\" class=\"undelete-history\">\n                                ${_l(\"Undelete\")}\n                            </a></li>\n                        <% } %>\n                        <% if( data.view.purgeAllowed ){ %>\n                            <li><a href=\"javascript:void(0);\" class=\"purge-history\">\n                                ${_l(\"Purge\")}\n                            </a></li>\n                        <% } %>\n                    </ul>\n                </div>\n            <% } %>\n        </div>`,\n        { variable: \"data\" }\n    ),\n\n    // ------------------------------------------------------------------------ misc\n    /** String rep */\n    toString: function() {\n        return `HistoryViewColumn(${this.panel ? this.panel : \"\"})`;\n    }\n});\n\n//==============================================================================\n/** @class A view of a HistoryCollection and displays histories similarly to the current history panel.\n */\nvar MultiPanelColumns = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    className: \"multi-panel-history\",\n\n    // ------------------------------------------------------------------------ set up\n    /** Set up internals, history collection, and columns to display the history */\n    initialize: function initialize(options) {\n        options = options || {};\n        this.log(`${this}.init`, options);\n\n        // add the className here (since we gen. pass the el in options)\n        this.$el.addClass(this.className);\n\n        // --- instance vars\n        //TODO: move these to some defaults\n        this.options = {\n            columnWidth: 312,\n            borderWidth: 1,\n            columnGap: 8,\n            headerHeight: 29,\n            footerHeight: 0,\n            controlsHeight: 20\n        };\n\n        /** how many histories to get when fetching a new batch/page */\n        this.perPage = options.perPage || 10;\n\n        /** named ajax queue for loading hdas */\n        this.hdaQueue = new ajaxQueue.NamedAjaxQueue([], false);\n\n        // --- set up models, sub-views, and listeners\n        /** the original unfiltered and unordered collection of histories */\n        this.collection = null;\n        /** model id to column map */\n        this.columnMap = {};\n        /** model id to column map */\n        this.columnOptions = options.columnOptions || {};\n\n        /** what to search for within all histories */\n        this.historySearch = null;\n        /** what to search for within all datasets */\n        this.datasetSearch = null;\n\n        this.setCollection(options.histories);\n        this.setUpListeners();\n    },\n\n    /** Set up reflexive listeners */\n    setUpListeners: function setUpListeners() {\n        //multipanel.log( 'setUpListeners', multipanel );\n        this.on(\"end-of-scroll\", () => {\n            this.collection.fetchMore();\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection\n    /** Set up a (new) history collection, sorting and adding listeners\n     *  @fires 'new-collection' when set with this view as the arg\n     */\n    setCollection: function setCollection(collection) {\n        // console.log( 'setCollection:', collection );\n        this.stopListening(this.collection);\n\n        this.collection = collection || new HistoryCollection();\n        this.setUpCollectionListeners();\n\n        this.createColumns();\n        this.hdaQueue.clear();\n\n        this.trigger(\"new-collection\", this);\n        return this;\n    },\n\n    /** Set up a (new) history collection, sorting and adding listeners\n     *  @fires 'new-collection' when set with this view as the arg\n     */\n    addModels: function addModels(models, collection, options) {\n        // console.log( 'addModels:', models, collection, options );\n        options = options || {};\n        models = _.isArray(models) ? models : [models];\n        models.forEach(model => {\n            this.addColumn(model, false);\n            // if this is from a fetch, sort will be called and it will call render\n        });\n        return this;\n    },\n\n    /** Set up listeners for the collection - handling: added histories, change of current, deletion, and sorting */\n    setUpCollectionListeners: function() {\n        this.listenTo(this.collection, {\n            // handle ajax errors from the collection\n            error: this.errorHandler,\n            // add multiple models\n            add: this.addModels,\n            // when all the histories a user has have been fetched\n            \"all-fetched\": this._postFetchAll,\n            // handle addition of histories, triggered by column copy and create new\n            \"new-current\": this.addAsCurrentColumn,\n            // handle setting a history as current, triggered by history.setAsCurrent\n            \"set-as-current\": this.setCurrentHistory,\n            // handle deleting a history (depends on whether panels is including deleted or not)\n            \"change:deleted change:purged\": this.handleDeletedHistory,\n            // re-render columns after a sort\n            sort: function() {\n                this.renderColumns(0);\n            }\n        });\n    },\n\n    _postFetchAll: function(fetchData) {\n        // console.log( '_postFetchAll' );\n        this.$(\".histories-loading-indicator\").remove();\n        // when new histories is fetched and the indicator is not required,\n        // the panel will jump slightly left - totally aesthetic but jarring\n        // TODO: this probably would be best handled elsewhere during a refinement cycle (if any)\n        if (!this.historySearch) {\n            var $scrollContainer = this.$(\".outer-middle\");\n            $scrollContainer.scrollLeft($scrollContainer.scrollLeft() + 24);\n        }\n    },\n\n    /** Re-render and set currentHistoryId to reflect a new current history */\n    setCurrentHistory: function setCurrentHistory(history) {\n        this.log(\"setCurrentHistory:\", history);\n        var oldCurrentColumn = _.findWhere(this.columnMap, {\n            currentHistory: true\n        });\n        if (oldCurrentColumn) {\n            oldCurrentColumn.currentHistory = false;\n            oldCurrentColumn.$el.height(\"\");\n        }\n\n        var newCurrentColumn = this.columnMap[this.collection.currentHistoryId];\n        newCurrentColumn.currentHistory = true;\n        this.collection.sort();\n        this._recalcFirstColumnHeight();\n        return newCurrentColumn;\n    },\n\n    /** Either remove a deleted history or re-render it to show the deleted message\n     *      based on collection.includeDeleted\n     */\n    handleDeletedHistory: function handleDeletedHistory(history) {\n        if (history.get(\"deleted\") || history.get(\"purged\")) {\n            this.log(\"handleDeletedHistory\", this.collection.includeDeleted, history);\n            var column = this.columnMap[history.id];\n            if (!column) {\n                return;\n            }\n\n            // if it's the current column, create a new, empty history as the new current\n            if (column.model.id === this.collection.currentHistoryId) {\n                //TODO: figuring out the order of async here is tricky\n                //  - for now let the user handle the two step process\n                //multipanel.collection.create().done( function(){\n                //    if( !multipanel.collection.includeDeleted ){ multipanel.removeColumn( column, false ); }\n                //});\n            } else if (!this.collection.includeDeleted) {\n                this.removeColumn(column);\n            }\n        }\n    },\n\n    // ........................................................................ error handling\n    /** Event handler for errors (from the history collection mainly)\n     *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n     *  (e.g. this.trigger( 'error', 'Heres a message', 'Heres a title' ))\n     *  @param {Model or View} model    the (Backbone) source of the error\n     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n     *  @param {Object} options         the options map commonly used with bbone ajax\n     */\n    errorHandler: function(model, xhr, options) {\n        // interrupted ajax or no connection\n        if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n            // return ERROR_MODAL.offlineErrorModal();\n            // fail silently\n            return;\n        }\n        // otherwise, leave something to report in the console\n        this.error(model, xhr, options);\n        // and feedback to a modal\n        // if sent two strings (and possibly details as 'options'), use those as message and title\n        if (_.isString(model) && _.isString(xhr)) {\n            var message = model;\n            var title = xhr;\n            return ERROR_MODAL.errorModal(message, title, options);\n        }\n        // bad gateway\n        // TODO: possibly to global handler\n        if (xhr && xhr.status === 502) {\n            return ERROR_MODAL.badGatewayErrorModal();\n        }\n        return ERROR_MODAL.ajaxErrorModal(model, xhr, options);\n    },\n\n    /** If Galaxy object is available handle error there, otherwise, locally (and crudely) */\n    _ajaxErrorHandler: function() {\n        ERROR_MODAL.ajaxErrorModal.apply(null, _.toArray(arguments));\n    },\n\n    /** create a new history and set it to current */\n    create: function(ev) {\n        return this.collection.create({ current: true });\n    },\n\n    // ------------------------------------------------------------------------ columns\n    /** create columns from collection */\n    createColumns: function createColumns(models, columnOptions) {\n        columnOptions = columnOptions || this.options.columnOptions;\n        // clear column map\n        // TODO: make cummulative\n        this.columnMap = {};\n        this.collection.each((model, i) => {\n            this.columnMap[model.id] = this.createColumn(model, columnOptions);\n        });\n    },\n\n    /** create a column and its panel and set up any listeners to them */\n    createColumn: function createColumn(history, options) {\n        let Galaxy = getGalaxyInstance();\n        // options passed can be re-used, so extend them before adding the model to prevent pollution for the next\n        options = _.extend({}, options, {\n            model: history,\n            purgeAllowed: Galaxy.config.allow_user_dataset_purge\n        });\n        var column = new HistoryViewColumn(options);\n        if (history.id === this.collection.currentHistoryId) {\n            column.currentHistory = true;\n        }\n        this.setUpColumnListeners(column);\n        if (this.datasetSearch) {\n            column.panel.searchItems(this.datasetSearch);\n            this.queueHdaFetchDetails(column);\n        }\n        return column;\n    },\n\n    /** add a new column for history and render all columns if render is true */\n    addColumn: function add(history, render) {\n        render = render !== undefined ? render : true;\n        var newColumn = this.createColumn(history);\n        this.columnMap[history.id] = newColumn;\n        if (render) {\n            this.renderColumns();\n        }\n        return newColumn;\n    },\n\n    /** add a new column for history and make it the current history/column */\n    addAsCurrentColumn: function add(history, collection, options) {\n        var newColumn = this.addColumn(history, false);\n        this.setCurrentHistory(history);\n        newColumn.once(\"rendered\", () => {\n            this.queueHdaFetch(newColumn);\n        });\n        return newColumn;\n    },\n\n    /** remove the given column, it's listeners, and optionally render */\n    removeColumn: function remove(column, render) {\n        render = render !== undefined ? render : true;\n        this.log(\"removeColumn\", column);\n        if (!column) {\n            return;\n        }\n        var widthToRemove = this.options.columnWidth + this.options.columnGap;\n        column.$el.fadeOut(\"fast\", () => {\n            if (render) {\n                $(this).remove();\n                this.$(\".middle\").width(this.$(\".middle\").width() - widthToRemove);\n                this.checkColumnsInView();\n                this._recalcFirstColumnHeight();\n            }\n\n            //TODO: to freeColumn (where Columns have freePanel)\n            this.stopListening(column.panel);\n            this.stopListening(column);\n            delete this.columnMap[column.model.id];\n            column.remove();\n        });\n    },\n\n    /** set up listeners for a column and it's panel - handling: hda lazy-loading, drag and drop */\n    setUpColumnListeners: function setUpColumnListeners(column) {\n        this.listenTo(column, {\n            //'all': function(){ console.info( 'column ' + column + ':', arguments ) },\n            \"in-view\": this.queueHdaFetch\n        });\n\n        this.listenTo(column.panel, {\n            //'all': function(){ console.info( 'panel ' + column.panel + ':', arguments ) },\n\n            \"view:draggable:dragstart\": (ev, view, panel, column) => {\n                this._dropData = JSON.parse(ev.dataTransfer.getData(\"text\"));\n                this.currentColumnDropTargetOn();\n            },\n            \"view:draggable:dragend\": (ev, view, panel, column) => {\n                this._dropData = null;\n                this.currentColumnDropTargetOff();\n            },\n            \"droptarget:drop\": (ev, data, panel) => {\n                //note: bad copy sources fail silently\n                var toCopy = this._dropData.filter(json => panel.model.contents.isCopyable(json));\n                this._dropData = null;\n\n                var queue = new ajaxQueue.NamedAjaxQueue();\n                if (panel.model.contents.currentPage !== 0) {\n                    queue.add({\n                        name: \"fetch-front-page\",\n                        fn: function() {\n                            return panel.model.contents.fetchPage(0);\n                        }\n                    });\n                }\n                // need to reverse to better match expected order\n                // TODO: reconsider order in list-view._setUpItemViewListeners, dragstart (instead of here)\n                toCopy.reverse().forEach(content => {\n                    queue.add({\n                        name: `copy-${content.id}`,\n                        fn: function() {\n                            return panel.model.contents.copy(content);\n                        }\n                    });\n                });\n                queue.start();\n                queue.done(responses => {\n                    panel.model.fetch();\n                });\n            }\n        });\n    },\n\n    /** conv. fn to count the columns in columnMap */\n    columnMapLength: function() {\n        return Object.keys(this.columnMap).length;\n    },\n\n    /** return array of Columns filtered by filters and sorted to match the collection\n     *  @param: filters Function[] array of filter fns\n     */\n    sortedFilteredColumns: function(filters) {\n        filters = filters || this.filters;\n        if (!filters || !filters.length) {\n            return this.sortedColumns();\n        }\n        return this.sortedColumns().filter((column, index) => {\n            var filtered = column.currentHistory || _.every(filters.map(filter => filter.call(column)));\n            return filtered;\n        });\n    },\n\n    /** return array of Columns sorted to match the collection */\n    sortedColumns: function() {\n        var sorted = this.collection.map((history, index) => this.columnMap[history.id]);\n        return sorted;\n    },\n\n    // ------------------------------------------------------------------------ render\n    /** Render this view, columns, and set up view plugins */\n    render: function render(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n\n        this.log(`${this}.render`);\n        this.$el.html(this.mainTemplate);\n        this.renderColumns(speed);\n\n        // set the columns to full height allowed and set up behaviors for thie multipanel\n        this.setUpBehaviors();\n        //TODO: wrong - has to wait for columns to render\n        //  - create a column listener that fires this when all columns are rendered\n        this.trigger(\"rendered\", this);\n        return this;\n    },\n\n    /** Render the columns and panels */\n    renderColumns: function renderColumns(speed) {\n        speed = _.isNumber(speed) ? speed : this.fxSpeed;\n        // console.log( 'renderColumns:', speed );\n        // render columns and track the total number rendered, firing an event when all are rendered\n        var sortedAndFiltered = this.sortedFilteredColumns();\n        // console.log( '\\t sortedAndFiltered:', sortedAndFiltered );\n        var $middle = this.$(\".middle\").empty();\n\n        this._addColumns(sortedAndFiltered, speed);\n        if (!this.collection.allFetched) {\n            $middle.append(this.loadingIndicatorTemplate);\n        }\n        //TODO: sorta - at least their fx queue has started the re-rendering\n        this.trigger(\"columns-rendered\", sortedAndFiltered, this);\n\n        if (!this.datasetSearch || sortedAndFiltered.length > 1) {\n            // check for in-view, hda lazy-loading if so\n            this.checkColumnsInView();\n            // the first, current column has position: fixed and flex css will not apply - adjust height manually\n            this._recalcFirstColumnHeight();\n        }\n        return sortedAndFiltered;\n    },\n\n    _addColumns: function(columns, speed) {\n        speed = _.isNumber(speed) ? speed : this.fxSpeed;\n        var $middle = this.$(\".middle\");\n\n        var numExisting = $middle.children(\".history-column\").length;\n        $middle.width(this._calcMiddleWidth(columns.length + numExisting));\n\n        columns.forEach((column, i) => {\n            column\n                .delegateEvents()\n                .render(speed)\n                .$el.appendTo($middle);\n        });\n    },\n\n    _calcMiddleWidth: function(numColumns) {\n        var preventStackWidthAdj = 16;\n        return (\n            numColumns * (this.options.columnWidth + this.options.columnGap) +\n            // last column gap\n            this.options.columnGap +\n            // the amount that safely prevents stacking of columns when adding a new one\n            preventStackWidthAdj\n        );\n    },\n\n    //TODO: combine the following two more sensibly\n    //TODO: could have HistoryContents.haveDetails return false\n    //      if column.model.contents.length === 0 && !column.model.get( 'empty' ) then just check that\n    /** Get the *summary* contents of a column's history (and details on any expanded contents),\n     *      queueing the ajax call and using a named queue to prevent the call being sent twice\n     */\n    queueHdaFetch: function queueHdaFetch(column) {\n        // console.log( column.model + '.contentsShown:', column.model.contentsShown() );\n        var contents = column.model.contents;\n        // console.log( 'queueHdaFetch:', column, column.model.get( 'contents_active' ) );\n        // if the history model says it has hdas but none are present, queue an ajax req for them\n        if (contents.length === 0 && column.model.contentsShown()) {\n            var fetchOptions = { silent: true };\n            var ids = _.values(contents.storage.allExpanded()).join();\n            if (ids) {\n                fetchOptions.details = ids;\n            }\n            // this uses a 'named' queue so that duplicate requests are ignored\n            this.hdaQueue.add({\n                name: column.model.id,\n                fn: function() {\n                    return contents\n                        .fetchCurrentPage(fetchOptions)\n                        .done(() => {\n                            column.panel.renderItems();\n                        })\n                        .done(() => {\n                            if (!JOB_STATES_MODEL.FETCH_STATE_ON_ADD) {\n                                contents.jobStateSummariesCollection.fetch();\n                            }\n                        });\n                }\n            });\n            // the queue is re-used, so if it's not processing requests - start it again\n            if (!this.hdaQueue.running) {\n                this.hdaQueue.start();\n            }\n        }\n    },\n\n    /** Get the *detailed* json for *all* of a column's history's contents - req'd for searching */\n    queueHdaFetchDetails: function(column) {\n        var contents = column.model.contents;\n        var needsContentsLoaded = contents.length === 0 && column.model.contentsShown();\n        if (needsContentsLoaded || !contents.haveDetails()) {\n            // this uses a 'named' queue so that duplicate requests are ignored\n            this.hdaQueue.add({\n                name: column.model.id,\n                fn: function() {\n                    return contents.progressivelyFetchDetails().done(() => {\n                        column.panel._renderEmptyMessage();\n                    });\n                }\n            });\n            // the queue is re-used, so if it's not processing requests - start it again\n            if (!this.hdaQueue.running) {\n                this.hdaQueue.start();\n            }\n        }\n    },\n\n    /** put a text msg in the header */\n    renderInfo: function(msg) {\n        return this.$(\".header .header-info\").text(msg);\n    },\n\n    // ------------------------------------------------------------------------ events/behaviors\n    events: {\n        // will move to the server root (gen. Analyze data)\n        \"click .done.btn\": \"close\",\n        // creates a new empty history and makes it current\n        \"click .create-new.btn\": \"create\",\n        \"click #include-deleted\": \"_clickToggleDeletedHistories\",\n        // these change the collection and column sort order\n        \"click .order .set-order\": \"_chooseOrder\",\n        \"click #toggle-deleted\": \"_clickToggleDeletedDatasets\",\n        \"click #toggle-hidden\": \"_clickToggleHiddenDatasets\"\n        //'dragstart .list-item .title-bar'                       : function( e ){ console.debug( 'ok' ); }\n    },\n\n    close: function(ev) {\n        //TODO: switch to pushState/router\n        window.location = getAppRoot();\n    },\n\n    _clickToggleDeletedHistories: function(ev) {\n        this.toggleDeletedHistories($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    /** Include deleted histories in the collection */\n    toggleDeletedHistories: function(show) {\n        if (show) {\n            window.location = `${getAppRoot()}history/view_multiple?include_deleted_histories=True`;\n        } else {\n            window.location = `${getAppRoot()}history/view_multiple`;\n        }\n    },\n\n    _clickToggleDeletedDatasets: function(ev) {\n        this.toggleDeletedDatasets($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    toggleDeletedDatasets: function(show) {\n        show = show !== undefined ? show : false;\n        this.sortedFilteredColumns().forEach((column, i) => {\n            _.delay(() => {\n                column.panel.toggleShowDeleted(show, false);\n            }, i * 200);\n        });\n    },\n\n    _clickToggleHiddenDatasets: function(ev) {\n        this.toggleHiddenDatasets($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    toggleHiddenDatasets: function(show) {\n        show = show !== undefined ? show : false;\n        this.sortedFilteredColumns().forEach((column, i) => {\n            _.delay(() => {\n                column.panel.toggleShowHidden(show, false);\n            }, i * 200);\n        });\n    },\n\n    /** change the collection order and re-fetch when the drop down in the options menu is changed */\n    _chooseOrder: function(ev) {\n        var collection = this.collection;\n        var orderKey = $(ev.currentTarget).data(\"order\");\n        // set the sort order text also\n        this.$(\".current-order\").text(this.orderDescriptions[orderKey]);\n        this.toggleOptionsPopover();\n        // set the order and re-fetch using the new order, saving the current history as the first\n        collection.setOrder(orderKey);\n        var currentHistoryModel = collection.slice(0, 1);\n        collection.fetchFirst().done(() => {\n            collection.unshift(currentHistoryModel, {\n                silent: true\n            });\n            this.createColumns();\n            // need to clear this or previously fetched contents won't refetch now (bc of named queue)\n            this.hdaQueue.clear();\n            this.render();\n        });\n        this.once(\"columns-rendered\", this._scrollLeft);\n        //TODO: check allFetched and do not reset if so - just sort instead\n    },\n\n    /** scroll the column container right or left */\n    _scrollLeft: function(val) {\n        val = _.isNumber(val) ? val : 0;\n        this.$(\".outer-middle\").scrollLeft(val);\n    },\n\n    /** Set up any view plugins */\n    setUpBehaviors: function() {\n        this._moreOptionsPopover();\n\n        // input to search histories\n        this.$(\"#search-histories\").searchInput({\n            name: \"search-histories\",\n            placeholder: _l(\"search histories\"),\n\n            onfirstsearch: searchFor => {\n                this.$(\"#search-histories\").searchInput(\"toggle-loading\");\n                this.renderInfo(_l(\"loading all histories for search\"));\n                this.collection.fetchAll().done(() => {\n                    this.$(\"#search-histories\").searchInput(\"toggle-loading\");\n                    this.renderInfo(\"\");\n                });\n            },\n            onsearch: searchFor => {\n                this.historySearch = searchFor;\n                this.filters = [\n                    () => {\n                        return this.model.matchesAll(this.historySearch);\n                    }\n                ];\n                this.renderColumns(0);\n            },\n            onclear: searchFor => {\n                this.historySearch = null;\n                //TODO: remove specifically not just reset\n                this.filters = [];\n                this.renderColumns(0);\n            }\n        });\n\n        // input to search datasets\n        this.$(\"#search-datasets\").searchInput({\n            name: \"search-datasets\",\n            placeholder: _l(\"search all datasets\"),\n\n            onfirstsearch: searchFor => {\n                this.hdaQueue.clear();\n                this.$(\"#search-datasets\").searchInput(\"toggle-loading\");\n                this.datasetSearch = searchFor;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.searchItems(searchFor);\n                    // load details for them that need\n                    this.queueHdaFetchDetails(column);\n                });\n                this.hdaQueue.progress(progress => {\n                    this.renderInfo([_l(\"searching\"), progress.curr + 1, _l(\"of\"), progress.total].join(\" \"));\n                });\n                this.hdaQueue.deferred.done(() => {\n                    this.renderInfo(\"\");\n                    this.$(\"#search-datasets\").searchInput(\"toggle-loading\");\n                });\n            },\n            onsearch: searchFor => {\n                this.datasetSearch = searchFor;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.searchItems(searchFor);\n                });\n            },\n            onclear: searchFor => {\n                this.datasetSearch = null;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.clearSearch();\n                });\n            }\n        });\n\n        // resize first (fixed position) column on page resize\n        $(window).resize(() => {\n            this._recalcFirstColumnHeight();\n        });\n\n        // when scrolling - check for histories now in view: they will fire 'in-view' and queueHdaLoading if necc.\n        //TODO:?? might be able to simplify and not use pub-sub\n        var debouncedInView = _.debounce(() => {\n            var viewport = this._viewport();\n            this.checkColumnsInView(viewport);\n            this.checkForEndOfScroll(viewport);\n        }, 100);\n        this.$(\".middle\")\n            .parent()\n            .scroll(debouncedInView);\n    },\n\n    /** create the options popover */\n    _moreOptionsPopover: function() {\n        return this.$(\".open-more-options.btn\").popover({\n            container: \".header\",\n            placement: \"bottom\",\n            html: true,\n            content: $(this.optionsPopoverTemplate(this))\n        });\n    },\n\n    /** change the collection order and re-fetch when the drop down in the options menu is changed */\n    toggleOptionsPopover: function(ev) {\n        // hide seems broken in our version\n        this.$(\".open-more-options.btn\").popover(\"toggle\");\n    },\n\n    /** Adjust the height of the first, current column since flex-boxes won't work with fixed postiion elements */\n    _recalcFirstColumnHeight: function() {\n        var $firstColumn = this.$(\".history-column\").first();\n        var middleHeight = this.$(\".middle\").height();\n        var controlHeight = $firstColumn.find(\".panel-controls\").height();\n        $firstColumn\n            .height(middleHeight)\n            .find(\".inner\")\n            .height(middleHeight - controlHeight);\n    },\n\n    /** Get the left and right pixel coords of the middle element */\n    _viewport: function() {\n        var $outerMiddle = this.$(\".middle\").parent();\n        var viewLeft = $outerMiddle.offset().left;\n        var width = $outerMiddle.width();\n        return {\n            left: viewLeft,\n            right: viewLeft + width\n        };\n    },\n\n    /** returns the columns currently in the viewport */\n    columnsInView: function(viewport) {\n        //TODO: uses offset which is render intensive\n        //TODO: 2N - could use arg filter (sortedFilteredColumns( filter )) instead\n        var vp = viewport || this._viewport();\n        return this.sortedFilteredColumns().filter(column => column.currentHistory || column.inView(vp.left, vp.right));\n    },\n\n    //TODO: sortByInView - return cols in view, then others\n    /** trigger in-view from columns in-view */\n    checkColumnsInView: function() {\n        //TODO: assbackward - don't fire from the column, fire from here and listen from here\n        this.columnsInView().forEach(column => {\n            column.trigger(\"in-view\", column);\n        });\n    },\n\n    /** is the middle, horizontally scrolling section scrolled fully to the right? */\n    checkForEndOfScroll: function(viewport) {\n        viewport = viewport || this._viewport();\n        var END_PADDING = 16;\n        var $middle = this.$(\".middle\");\n        var scrollRight = $middle.parent().scrollLeft() + viewport.right;\n        if (scrollRight >= $middle.width() - END_PADDING) {\n            this.trigger(\"end-of-scroll\");\n        }\n    },\n\n    /** Show and enable the current columns drop target */\n    currentColumnDropTargetOn: function() {\n        var currentColumn = this.columnMap[this.collection.currentHistoryId];\n        if (!currentColumn) {\n            return;\n        }\n        //TODO: fix this - shouldn't need monkeypatch\n        currentColumn.panel.dataDropped = data => {};\n        currentColumn.panel.dropTargetOn();\n    },\n\n    /** Hide and disable the current columns drop target */\n    currentColumnDropTargetOff: function() {\n        var currentColumn = this.columnMap[this.collection.currentHistoryId];\n        if (!currentColumn) {\n            return;\n        }\n        currentColumn.panel.dataDropped = HISTORY_VIEW_EDIT.HistoryViewEdit.prototype.dataDrop;\n        // slight override of dropTargetOff to not erase drop-target-help\n        currentColumn.panel.dropTarget = false;\n        currentColumn.panel.$(\".history-drop-target\").remove();\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** String rep */\n    toString: function() {\n        return `MultiPanelColumns(${this.columns ? this.columns.length : 0})`;\n    },\n\n    // ------------------------------------------------------------------------ templates\n    mainTemplate: `\n        <div class=\"header flex-column-container\">\n            <div class=\"control-column control-column-left flex-column\">\n                <div id=\"search-histories\" class=\"search-control\"></div>\n                <div id=\"search-datasets\" class=\"search-control\"></div>\n                <a class=\"open-more-options btn btn-secondary\" tabindex=\"3\">\n                    <span class=\"fa fa-ellipsis-h\"></span>\n                </a>\n            </div>\n            <div class=\"control-column control-column-center flex-column\">\n                <div class=\"header-info\">\n                </div>\n            </div>\n            <div class=\"control-column control-column-right flex-column\">\n                <button class=\"create-new btn btn-secondary\" tabindex=\"4\">\n                    ${_l(\"Create new\")}\n                </button>\n            </div>\n        </div>\n        <div class=\"outer-middle flex-row flex-row-container\">\n            <div class=\"middle flex-column-container flex-row\"></div>\n        </div>\n        <div class=\"footer flex-column-container\"></div>`,\n\n    loadingIndicatorTemplate: `\n        <div class=\"histories-loading-indicator\">\n            <span class=\"fa fa-spin fa-spinner\"></span>\n            ${_l(\"Loading histories\")} ...\n        </div>`,\n\n    orderDescriptions: {\n        update_time: _l(\"most recent first\"),\n        \"update_time-asc\": _l(\"least recent first\"),\n        name: _l(\"name, a to z\"),\n        \"name-dsc\": _l(\"name, z to a\"),\n        size: _l(\"size, large to small\"),\n        \"size-asc\": _l(\"size, small to large\")\n    },\n\n    optionsPopoverTemplate: _.template(\n        [\n            '<div class=\"more-options d-flex flex-column\">',\n            '<div class=\"order btn-group mb-2\">',\n            '<button type=\"button\" class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n            `${_l(\"Order histories by\")} `,\n            '<span class=\"current-order\"><%- view.orderDescriptions[ view.collection.order ] %></span> ',\n            '<span class=\"caret\"></span>',\n            \"</button>\",\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n            \"<% _.each( view.orderDescriptions, function( text, order ){ %>\",\n            '<li class=\"dropdown-item\"><a href=\"javascript:void(0);\" class=\"set-order\" data-order=\"<%- order %>\">',\n            \"<%- text %>\",\n            \"</a></li>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\",\n\n            '<div class=\"checkbox\"><label><input id=\"include-deleted\" type=\"checkbox\"',\n            '<%= view.collection.includeDeleted? \" checked\" : \"\" %>>',\n            _l(\"Include deleted histories\"),\n            \"</label></div>\",\n\n            '<div class=\"checkbox\"><label><input id=\"toggle-deleted\" type=\"checkbox\">',\n            _l(\"Include deleted datasets\"),\n            \"</label></div>\",\n            '<div class=\"checkbox\"><label><input id=\"toggle-hidden\" type=\"checkbox\">',\n            _l(\"Include hidden datasets\"),\n            \"</label></div>\",\n            \"</div>\"\n        ].join(\"\"),\n        { variable: \"view\" }\n    )\n});\n\n//==============================================================================\nexport default {\n    MultiPanelColumns: MultiPanelColumns\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport HISTORY_VIEW from \"mvc/history/history-view\";\nimport _l from \"utils/localization\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// used in history/display.mako and history/embed.mako\n/** @class View/Controller for a tabular view of the history model.\n *\n *  As ReadOnlyHistoryView, but with:\n *      history annotation always shown\n *      datasets displayed in a table:\n *          datasets in left cells, dataset annotations in the right\n */\nvar AnnotatedHistoryView = _super.extend(\n    /** @lends AnnotatedHistoryView.prototype */ {\n        className: `${_super.prototype.className} annotated-history-panel`,\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** In this override, add the history annotation */\n        _buildNewRender: function() {\n            //TODO: shouldn't this display regardless (on all non-current panels)?\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            this.renderHistoryAnnotation($newRender);\n            return $newRender;\n        },\n\n        /** render the history's annotation as its own field */\n        renderHistoryAnnotation: function($newRender) {\n            var annotation = this.model.get(\"annotation\");\n            if (!annotation) {\n                return;\n            }\n            $newRender.find(\"> .controls .subtitle\").text(annotation);\n        },\n\n        /** override to add headers to indicate the dataset, annotation columns */\n        renderItems: function($whereTo) {\n            $whereTo = $whereTo || this.$el;\n            _super.prototype.renderItems.call(this, $whereTo);\n\n            var $controls = $whereTo.find(\"> .controls\");\n            $controls.find(\".contents-container.headers\").remove();\n\n            $('<div class=\"contents-container headers\"/>')\n                .append([\n                    $('<div class=\"history-content header\"/>').text(_l(\"Dataset\")),\n                    $('<div class=\"additional-info header\"/>').text(_l(\"Annotation\"))\n                ])\n                .appendTo($controls);\n\n            return self.views;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** override to wrap each subview */\n        _renderItemView$el: function(view) {\n            return $('<div class=\"contents-container\"/>').append([\n                view.render(0).$el,\n                $('<div class=\"additional-info\"/>').text(view.model.get(\"annotation\") || \"\")\n            ]);\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        events: _.extend(_.clone(_super.prototype.events), {\n            // clicking on any part of the row will expand the items\n            \"click .contents-container\": function(ev) {\n                ev.stopPropagation();\n                $(ev.currentTarget)\n                    .find(\".list-item .title-bar\")\n                    .click();\n            },\n            // prevent propagation on icon btns so they won't bubble up to tr and toggleBodyVisibility\n            \"click .icon-btn\": function(ev) {\n                ev.stopPropagation();\n                // stopProp will prevent bootstrap from getting the click needed to open a dropdown\n                //  in the case of metafile download buttons - workaround here\n                var $currTarget = $(ev.currentTarget);\n                if ($currTarget.length && $currTarget.attr(\"data-toggle\") === \"dropdown\") {\n                    $currTarget.dropdown(\"toggle\");\n                }\n            }\n        }),\n\n        _clickSectionLink: function(ev) {\n            var sectionNumber = $(ev.currentTarget)\n                .parent()\n                .parent()\n                .data(\"section\");\n            this.openSection(sectionNumber);\n        },\n\n        // ........................................................................ misc\n        /** Return a string rep of the history */\n        toString: function() {\n            return `AnnotatedHistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    AnnotatedHistoryView: AnnotatedHistoryView\n};\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport Backbone from \"backbone\";\n\n// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\njQuery.ajaxSettings.traditional = true;\n\n// dependencies\nimport Utils from \"utils/utils\";\nimport GridModel from \"legacy/grid/grid-model\";\nimport Templates from \"legacy/grid/grid-template\";\nimport PopupMenu from \"mvc/ui/popup-menu\";\nimport { init_refresh_on_change } from \"onload/globalInits/init_refresh_on_change\";\n\nvar $ = jQuery;\n\n// grid view\nexport default Backbone.View.extend({\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function(grid_config) {\n        this.grid = new GridModel();\n        this.dict_format = grid_config.dict_format;\n        this.title = grid_config.title;\n        this.title_id = grid_config.title_id;\n        var self = this;\n\n        // why is this a global?\n        // Answer: autocom_tagging passes this function from python and\n        // it must be on window scope or it won't work.\n        // TODO: refactor this out by turning the tagging functionality into a component\n        window.add_tag_to_grid_filter = (tag_name, tag_value) => {\n            // Put tag name and value together.\n            var tag = tag_name + (tag_value !== undefined && tag_value !== \"\" ? `:${tag_value}` : \"\");\n            var advanced_search = $(\"#advanced-search\").is(\":visible\");\n            if (!advanced_search) {\n                $(\"#standard-search\").slideToggle(\"fast\");\n                $(\"#advanced-search\").slideToggle(\"fast\");\n            }\n            self.add_filter_condition(\"tags\", tag);\n        };\n\n        // set element\n        if (this.dict_format) {\n            this.setElement(\"<div/>\");\n            if (grid_config.url_base && !grid_config.items) {\n                var url_data = grid_config.url_data || {};\n                _.each(grid_config.filters, (v, k) => {\n                    url_data[`f-${k}`] = v;\n                });\n                $.ajax({\n                    url: `${grid_config.url_base}?${$.param(url_data)}`,\n                    success: function(response) {\n                        response.embedded = grid_config.embedded;\n                        response.filters = grid_config.filters || {};\n                        self.init_grid(response);\n                    }\n                });\n            } else {\n                this.init_grid(grid_config);\n            }\n        } else {\n            this.setElement(\"#grid-container\");\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $(\"#center\").css({\n                padding: \"10px\",\n                overflow: \"auto\"\n            });\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function(refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray(\"history\", refresh_frames) > -1) {\n                if (window.top.Galaxy && window.top.Galaxy.currHistoryPanel) {\n                    window.top.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function(grid_config) {\n        this.grid.set(grid_config);\n\n        // get options\n        var options = this.grid.attributes;\n\n        if (this.allow_title_display && options.title) {\n            Utils.setWindowTitle(options.title);\n        }\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get(\"url_base\");\n        url = url.replace(/^.*\\/\\/[^\\/]+/, \"\");\n        this.grid.set(\"url_base\", url);\n\n        // append main template\n        this.$el.html(Templates.grid(options));\n\n        // update div contents\n        this.$el.find(\"#grid-table-header\").html(Templates.header(options));\n        this.$el.find(\"#grid-table-body\").html(Templates.body(options));\n        this.$el.find(\"#grid-table-footer\").html(Templates.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find(\"#grid-message\").html(Templates.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                setTimeout(() => {\n                    self.$el.find(\"#grid-message\").html(\"\");\n                }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function() {\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find(\".operation-button\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find(\"input[type=text]\").each(function() {\n            $(this).off();\n            $(this)\n                .click(function() {\n                    $(this).select();\n                })\n                .keyup(function() {\n                    $(this).css(\"font-style\", \"normal\");\n                });\n        });\n\n        // Initialize sort links.\n        this.$el.find(\".sort-link\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_sort_condition($(this).attr(\"sort_key\"));\n                return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find(\".text-filter-form\").each(function() {\n            $(this).off();\n            $(this).submit(function() {\n                var column_key = $(this).attr(\"column_key\");\n                var text_input_obj = $(`#input-${column_key}-filter`);\n                var text_input = text_input_obj.val();\n                text_input_obj.val(\"\");\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".text-filter-val > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                // Remove visible element.\n                $(this)\n                    .parent()\n                    .remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".categorical-filter > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_categorical_filter($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find(\".advanced-search-toggle\").each(function() {\n            $(this).off();\n            $(this).click(() => {\n                self.$el.find(\"#standard-search\").slideToggle(\"fast\");\n                self.$el.find(\"#advanced-search\").slideToggle(\"fast\");\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find(\"#check_all\").off();\n        this.$el.find(\"#check_all\").on(\"click\", () => {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements: function() {\n        // Initialize grid selection checkboxes.\n        this.$el.find(\".grid\").each(function() {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = () => {\n                check_count.text($(checkboxes).filter(\":checked\").length);\n            };\n\n            $(checkboxes).each(function() {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find(\".community_rating_star\").length !== 0) this.$el.find(\".community_rating_star\").rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find(\".page-link > a\").each(function() {\n            $(this).click(function() {\n                self.set_page($(this).attr(\"page_num\"));\n                return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find(\".use-target\").each(function() {\n            $(this).click(function() {\n                self.execute({\n                    href: $(this).attr(\"href\"),\n                    target: $(this).attr(\"target\")\n                });\n                return false;\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length === 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each(options.items, (item, index) => {\n            var button = self.$(`#grid-${item.encode_id}-popup`).off();\n            var popup = new PopupMenu(button);\n            _.each(options.operations, operation => {\n                self._add_operation(popup, operation, item);\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    _add_operation: function(popup, operation, item) {\n        var self = this;\n        var settings = item.operation_config[operation.label];\n        if (settings.allowed && operation.allow_popup) {\n            popup.addItem({\n                html: operation.label,\n                href: settings.url_args,\n                target: settings.target,\n                confirmation_text: operation.confirm,\n                func: function(e) {\n                    e.preventDefault();\n                    var label = $(e.target).html();\n                    if (operation.onclick) {\n                        operation.onclick(item.encode_id);\n                    } else {\n                        self.execute(this.findItemByHtml(label));\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function(name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(Templates.filter_element(name, value));\n        var self = this;\n        t.click(function() {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find(`#${name}-filtering-criteria`);\n        container.append(t);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function(name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function(col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get(\"sort_key\");\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== \"-\") {\n                new_sort = `-${col_key}`;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find(\".sort-arrow\").remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = new_sort.substring(0, 1) == \"-\" ? \"&uarr;\" : \"&darr;\";\n        var t = $(`<span>${sort_arrow}</span>`).addClass(\"sort-arrow\");\n\n        // Add to header\n        this.$el.find(`#${col_key}-header`).append(t);\n\n        // Update grid.\n        this.grid.set(\"sort_key\", new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function(name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get(\"categorical_filters\")[name];\n\n        var cur_value = this.grid.get(\"filters\")[name];\n        var self = this;\n        this.$el.find(`.${name}-filter`).each(function() {\n            var text = $.trim($(this).text());\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass(\"current-filter\");\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_categorical_filter(name, filter_value);\n                });\n                $(this).removeClass(\"current-filter\");\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function(new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find(\".page-link\").each(function() {\n            var id = $(this).attr(\"id\");\n\n            var // Id has form 'page-link-<page_num>\n                page_num = parseInt(id.split(\"-\")[2], 10);\n\n            var cur_page = self.grid.get(\"cur_page\");\n            var text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this)\n                    .children()\n                    .text();\n                $(this).empty();\n                $(this).addClass(\"inactive-link\");\n                $(this).text(text);\n            } else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass(\"inactive-link\");\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === \"all\") {\n            this.grid.set(\"cur_page\", new_page);\n        } else {\n            this.grid.set(\"cur_page\", parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function(operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (number_of_checked_ids < 1) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {\n            label: operation_name\n        });\n        if (operation && !confirmation_text) {\n            confirmation_text = operation.confirm || \"\";\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find(\"input[name=id]:checked\").each(function() {\n            item_ids.push($(this).val());\n        });\n\n        // execute operation\n        var options = {\n            operation: operation_name,\n            id: item_ids,\n            confirmation_text: confirmation_text\n        };\n        if (operation.target == \"top\" || operation.target == \"center\") {\n            options = _.extend(options, {\n                href: operation.href,\n                target: operation.target\n            });\n        }\n        this.execute(options);\n        return true;\n    },\n\n    check_all_items: function() {\n        var check = this.$(\".grid-row-select-checkbox\");\n        var state = this.$(\"#check_all\").prop(\"checked\");\n        _.each(check, c => {\n            $(c).prop(\"checked\", state);\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function() {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get(\"cur_page\");\n        if (cur_page !== null && cur_page !== undefined && cur_page !== \"all\") {\n            this.grid.set(\"cur_page\", 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function(options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf(\"operation=\") != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf(\"operation\") != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split(\"=\")[1];\n                            operation = operation.replace(/\\+/g, \" \");\n                        } else if (href_parms[index].indexOf(\"id\") != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split(\"=\")[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (\n                confirmation_text &&\n                confirmation_text !== \"\" &&\n                confirmation_text != \"None\" &&\n                confirmation_text != \"null\"\n            )\n                if (!confirm(confirmation_text)) return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if (target == \"top\") {\n                window.top.location = `${href}?${$.param(this.grid.get_url_data())}`;\n            } else if (target == \"center\") {\n                $(\"#galaxy_main\").attr(\"src\", `${href}?${$.param(this.grid.get_url_data())}`);\n            } else if (this.grid.can_async_op(operation) || this.dict_format) {\n                this.update_grid();\n            } else {\n                this.go_to(target, href);\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        if (this.grid.get(\"async\") || this.dict_format) {\n            this.update_grid();\n        } else {\n            this.go_to(target, href);\n        }\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function(target, href) {\n        // get aysnc status\n        var async = this.grid.get(\"async\");\n        this.grid.set(\"async\", false);\n\n        // get slide status\n        var advanced_search = this.$el.find(\"#advanced-search\").is(\":visible\");\n        this.grid.set(\"advanced_search\", advanced_search);\n\n        // get default url\n        if (!href) {\n            href = `${this.grid.get(\"url_base\")}?${$.param(this.grid.get_url_data())}`;\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined,\n            async: async\n        });\n        switch (target) {\n            case \"center\":\n                $(\"#galaxy_main\").attr(\"src\", href);\n                break;\n            case \"top\":\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function() {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = this.grid.get(\"operation\") ? \"POST\" : \"GET\";\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find(\".loading-elt-overlay\").show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get(\"url_base\"),\n            data: self.grid.get_url_data(),\n            error: function() {\n                alert(\"Grid refresh failed\");\n            },\n            success: function(response_text) {\n                // backup\n                var embedded = self.grid.get(\"embedded\");\n                var insert = self.grid.get(\"insert\");\n                var advanced_search = self.$el.find(\"#advanced-search\").is(\":visible\");\n\n                // request new configuration\n                var json = self.dict_format ? response_text : $.parseJSON(response_text);\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n                json.advanced_search = advanced_search;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find(\".loading-elt-overlay\").hide();\n            },\n            complete: function() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    }\n});\n","import $ from \"jquery\";\nimport * as d3 from \"d3\";\nimport { event as currentEvent } from \"d3\";\n\nfunction date_by_subtracting_days(date, days) {\n    return new Date(\n        date.getFullYear(),\n        date.getMonth(),\n        date.getDate() - days,\n        date.getHours(),\n        date.getMinutes(),\n        date.getSeconds(),\n        date.getMilliseconds()\n    );\n}\n\nfunction date_by_subtracting_hours(date, hours) {\n    return new Date(\n        date.getFullYear(),\n        date.getMonth(),\n        date.getDate(),\n        date.getHours() - hours,\n        date.getMinutes(),\n        date.getSeconds(),\n        date.getMilliseconds()\n    );\n}\n\n// Gets the utc time without minutes and seconds\nfunction get_utc_time_hours() {\n    var date = new Date();\n    return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), 0, 0);\n}\n\n// This is commented out until we make Reports more responsive.\n// setTimeout(refresh, 60000); //1 minute = 60000 ms\n\nexport function create_chart(inp_data, name, time, title) {\n    // Initialize starting variables\n    var data = inp_data;\n\n    var hours_array = [];\n    var now = get_utc_time_hours();\n    var i;\n    for (i = 0; i < 24; i++) {\n        hours_array.push(date_by_subtracting_hours(now, i));\n    }\n\n    var days_array = [];\n    for (i = 0; i < 30; i++) {\n        days_array.push(date_by_subtracting_days(now, i));\n    }\n\n    var margin = { top: 60, right: 30, bottom: 50, left: 60 };\n    var width = 300;\n    var barWidth = 0;\n    if (time == \"hours\") {\n        barWidth = width / 24;\n    } else if (time == \"days\") {\n        barWidth = width / 30;\n    }\n    var chart_width = width + margin.left + margin.right;\n\n    var chart_zoom = 1.75;\n    var height = 150;\n    var zoom;\n    if (d3.max(data) !== 0) {\n        zoom = height / d3.max(data);\n    } else {\n        zoom = 1.0;\n    }\n    var chart_height = height + margin.top + margin.bottom;\n\n    // Function for zooming in and out of charts\n    function click() {\n        var classes = d3.select(this).attr(\"class\");\n        classes = classes.split(\" \");\n        d3.selectAll(`.${classes[0]}`)\n            .filter(`.${classes[1]}`)\n            .style(\"cursor\", \"zoom-in\")\n            .transition()\n            .duration(750)\n            .attr(\"height\", chart_height)\n            .attr(\"width\", chart_width);\n\n        d3.select(this)\n            .style(\"cursor\", \"default\")\n            .transition()\n            .duration(750)\n            .attr(\"height\", chart_height * chart_zoom)\n            .attr(\"width\", chart_width * chart_zoom);\n    }\n\n    // Initialize all chart containers to have the correct height\n    $(\".charts\").css(\"height\", chart_height * chart_zoom);\n\n    // Create the chart object\n    var chart = d3\n        .select(`#${name}`)\n        .attr(\"width\", chart_width)\n        .attr(\"height\", chart_height)\n        .attr(\"preserveAspectRatio\", \"xMidYMin\")\n        .attr(\"viewBox\", `0 0 ${chart_width} ${chart_height}`)\n        .on(\"click\", click);\n\n    // Create bars on the chart and assosciate data with it\n    var bar = chart\n        .selectAll(\"g\")\n        .data(data)\n        .enter()\n        .append(\"g\")\n        .attr(\"transform\", (d, i) => {\n            // Place the bar in the correct place\n            var curr_margin = margin.left;\n            curr_margin += +(i * barWidth);\n            return `translate(${curr_margin},${margin.top})`;\n        })\n        .on(\"mouseenter\", d => {\n            // Show tool tip\n            var i = 1;\n            var size = d;\n\n            while (size >= 10) {\n                size = size / 10;\n                i++;\n            }\n\n            var wdth = i * 4 + 10;\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"text\")\n                .attr(\"transform\", `translate( ${margin.left - 5}, ${height - d * zoom + margin.top + 10} )`)\n                .attr(\"visibility\", \"visible\")\n                .text(d);\n\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .attr(\"width\", `${wdth}px`)\n                .attr(\"height\", \"15px\")\n                .select(\"rect\")\n                .attr(\"transform\", `translate( ${margin.left - wdth}, ${height - d * zoom + margin.top} )`)\n                .attr(\"width\", `${wdth}px`)\n                .attr(\"height\", \"15px\")\n                .attr(\"fill\", \"#ebd9b2\");\n        })\n        .on(\"mouseleave\", d => {\n            // Remove tool tip\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"text\")\n                .attr(\"visibility\", \"hidden\");\n\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"rect\")\n                .attr(\"width\", \"0\")\n                .attr(\"height\", \"0\")\n                .attr(\"fill\", \"\")\n                .text(d);\n        });\n\n    // Add a title to the chart\n    chart\n        .append(\"g\")\n        .append(\"text\")\n        .attr(\"class\", \"title\")\n        .attr(\"text-anchor\", \"end\")\n        .attr(\"transform\", () => `translate( ${width},15 )`)\n        .text(title);\n\n    // Add an x axis line to the chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"axis\")\n        .append(\"path\")\n        .attr(\"class\", \"x\")\n        .attr(\"d\", () => {\n            var m_x = margin.left;\n            var m_y = margin.top + height;\n            var l_x = m_x + width;\n            var l_y = m_y;\n\n            return `M${m_x} ${m_y} L ${l_x} ${l_y}`;\n        });\n\n    // Declare how high the y axis goes\n    var y = d3.scale.linear().range([height, 0]);\n\n    // Create a yAxis object\n    var yAxis = d3.svg\n        .axis()\n        .scale(y)\n        .orient(\"left\")\n        .tickFormat(d => d3.round(d * d3.max(data), 0));\n\n    // Put the y axis on the chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"y axis\")\n        .attr(\"id\", `y_${name}`)\n        .attr(\"text-anchor\", \"end\")\n        .attr(\"transform\", `translate( ${margin.left},${margin.top})`)\n        .call(yAxis)\n        .select(\".domain\");\n\n    // Put a title for y axis on chart\n    chart\n        .append(\"g\")\n        .append(\"text\")\n        .attr(\"class\", \"ax_title\")\n        .attr(\"transform\", () => {\n            var axis = d3.select(`#y_${name}`).node();\n            var left_pad = margin.left - axis.getBoundingClientRect().width - 5;\n            var top_pad = margin.top + axis.getBoundingClientRect().height / 2 - 30;\n            var trans = `translate(${left_pad},${top_pad})rotate(-90)`;\n\n            return trans;\n        })\n        .text(\"Number of Jobs\");\n\n    // Add color to the chart's bars\n    bar.append(\"rect\")\n        .attr(\"y\", d => height - d * zoom)\n        .attr(\"height\", d => d * zoom)\n        .attr(\"width\", barWidth - 1);\n\n    var first = false;\n\n    // Append x axis\n    if (time == \"hours\") {\n        // Append hour lines\n        bar.append(\"line\")\n            .attr(\"x1\", 0)\n            .attr(\"y1\", 0)\n            .attr(\"x2\", 0)\n            .attr(\"y2\", 3)\n            .attr(\"stroke\", \"black\")\n            .attr(\"stroke-width\", 1)\n            .attr(\"pointer-events\", \"none\")\n            .attr(\"transform\", () => `translate( ${barWidth / 2}, ${height})`);\n\n        // Append hour numbers\n        bar.append(\"text\")\n            .attr(\"fill\", \"rgb(0,0,0)\")\n            .attr(\"transform\", `translate( 10, ${height + 10} )`)\n            .text((d, i) => {\n                var time = \"0000\";\n\n                if (hours_array[i].getHours() < 10) {\n                    time = `0${String(hours_array[i].getHours())}`;\n                } else {\n                    time = hours_array[i].getHours();\n                }\n\n                return time;\n            });\n\n        // Append day lines\n        var curr_day = \"\";\n        first = false;\n        bar.append(\"line\")\n            .attr(\"x1\", 0)\n            .attr(\"y1\", 0)\n            .attr(\"x2\", 0)\n            .attr(\"y2\", (d, i) => {\n                var _y2 = 0;\n\n                if (hours_array[i].getDate() != curr_day) {\n                    if (!first) {\n                        _y2 = 27;\n                        first = true;\n                    } else {\n                        _y2 = 20;\n                    }\n\n                    curr_day = hours_array[i].getDate();\n                }\n\n                return _y2;\n            })\n            .attr(\"stroke\", \"black\")\n            .attr(\"stroke-width\", 1)\n            .attr(\"pointer-events\", \"none\")\n            .attr(\"transform\", () => `translate( 0, ${height})`);\n\n        // Append day numbers\n        curr_day = \"\";\n        var curr_day_text = \"\";\n        first = false;\n        bar.append(\"text\")\n            .attr(\"fill\", \"rgb(0,0,0)\")\n            .attr(\"pointer-events\", \"none\")\n            .text((d, i) => {\n                var time = \"\";\n                var locale = \"en-us\";\n\n                if (hours_array[i].getDate() != curr_day_text) {\n                    time = String(hours_array[i].toLocaleString(locale, { month: \"long\" }));\n                    time += ` ${String(hours_array[i].getDate())}`;\n\n                    curr_day_text = hours_array[i].getDate();\n                }\n\n                return time;\n            })\n            .attr(\"transform\", function(d, i) {\n                var text_height = height;\n                var this_width = d3\n                    .select(this)\n                    .node()\n                    .getBBox().width;\n\n                if (hours_array[i].getDate() != curr_day) {\n                    if (!first) {\n                        text_height += 26;\n                        first = true;\n                    } else {\n                        text_height += 18;\n                    }\n\n                    curr_day = hours_array[i].getDate();\n                }\n\n                return `translate( ${this_width + 2}, ${text_height} )`;\n            });\n    } else if (time == \"days\") {\n        // Append day lines\n        bar.append(\"line\")\n            .attr(\"x1\", 0)\n            .attr(\"y1\", 0)\n            .attr(\"x2\", 0)\n            .attr(\"y2\", 3)\n            .attr(\"stroke\", \"black\")\n            .attr(\"stroke-width\", 1)\n            .attr(\"pointer-events\", \"none\")\n            .attr(\"transform\", () => `translate( ${barWidth / 2}, ${height})`);\n\n        // Append day numbers\n        bar.append(\"text\")\n            .attr(\"fill\", \"rgb(0,0,0)\")\n            .attr(\"transform\", `translate( 9, ${height + 10} )`)\n            .text((d, i) => {\n                var time = \"0000\";\n\n                if (days_array[i].getDate() < 10) {\n                    time = `0${String(days_array[i].getDate())}`;\n                } else {\n                    time = days_array[i].getDate();\n                }\n\n                return time;\n            });\n\n        // Append month lines\n        var curr_month = \"\";\n        first = false;\n        bar.append(\"line\")\n            .attr(\"x1\", 0)\n            .attr(\"y1\", 0)\n            .attr(\"x2\", 0)\n            .attr(\"y2\", (d, i) => {\n                var _y2 = 0;\n\n                if (days_array[i].getMonth() != curr_month) {\n                    if (!first) {\n                        _y2 = 27;\n                        first = true;\n                    } else {\n                        _y2 = 20;\n                    }\n\n                    curr_month = days_array[i].getMonth();\n                }\n\n                return _y2;\n            })\n            .attr(\"stroke\", \"black\")\n            .attr(\"stroke-width\", 1)\n            .attr(\"pointer-events\", \"none\")\n            .attr(\"transform\", () => `translate( 0, ${height})`);\n\n        // Append month numbers\n        curr_month = \"\";\n        var curr_month_text = \"\";\n        first = false;\n        bar.append(\"text\")\n            .attr(\"fill\", \"rgb(0,100,0)\")\n            .attr(\"pointer-events\", \"none\")\n            .text((d, i) => {\n                var time = \"\";\n                var locale = \"en-us\";\n\n                if (days_array[i].getMonth() != curr_month_text) {\n                    time = String(days_array[i].toLocaleString(locale, { month: \"long\" }));\n                    time += ` ${String(days_array[i].getFullYear())}`;\n\n                    curr_month_text = days_array[i].getMonth();\n                }\n\n                return time;\n            })\n            .attr(\"transform\", function(d, i) {\n                var text_height = height;\n                var this_width = d3\n                    .select(this)\n                    .node()\n                    .getBBox().width;\n\n                if (days_array[i].getMonth() != curr_month) {\n                    if (!first) {\n                        text_height += 26;\n                        first = true;\n                    } else {\n                        text_height += 18;\n                    }\n\n                    curr_month = days_array[i].getMonth();\n                }\n\n                return `translate( ${this_width + 2}, ${text_height} )`;\n            });\n    }\n\n    // Put an invisible tool tip on the chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"tool_tip\")\n        .append(\"rect\");\n    chart.select(\".tool_tip\").append(\"text\");\n\n    // Initialize initial zoomed charts\n    if (name == \"jc_dy_chart\" || name == \"jc_hr_chart\") {\n        d3.select(`#${name}`)\n            .attr(\"height\", chart_height * chart_zoom)\n            .attr(\"width\", chart_width * chart_zoom)\n            .style(\"cursor\", \"default\");\n    }\n}\n\n//============================================================================================================\n\nexport function create_histogram(inp_data, name, title) {\n    // Initialize initial variables\n    // inp_data is an array of numbers that are the amount of minutes per run\n    var data = inp_data;\n\n    var chart_zoom = 1.75;\n    var margin = { top: 60, right: 30, bottom: 50, left: 60 };\n\n    var height = 150;\n    var chart_height = height + margin.top + margin.bottom;\n\n    var width = 300;\n    var chart_width = width + margin.left + margin.right;\n\n    // Cereate x axis metadata\n    // Used for x axis, histogram creation, and bar initialization\n    var x = d3.scale\n        .linear()\n        .domain([0, d3.max(data)])\n        .range([0, width]);\n\n    // Generate a histogram using twenty uniformly-spaced bins.\n    data = d3.layout.histogram().bins(x.ticks(20))(data);\n\n    // Create an array of the sizes of the bars\n    var lengths = [];\n    for (var i = 0; i < data.length; i++) {\n        lengths.push(data[i].length);\n    }\n\n    var zoom;\n    // Find the amount needed to magnify the bars\n    if (d3.max(data) !== 0) {\n        zoom = height / d3.max(lengths);\n    } else {\n        zoom = 1.0;\n    }\n\n    // Create y axis metadata\n    // Used for y axis and bar initialization\n    var y = d3.scale\n        .linear()\n        .domain([0, d3.max(data, d => d.y)])\n        .range([height, 0]);\n\n    // Function for zooming in and out of charts\n    function click() {\n        var classes = d3.select(this).attr(\"class\");\n        classes = classes.split(\" \");\n        d3.selectAll(`.${classes[0]}`)\n            .filter(`.${classes[1]}`)\n            .style(\"cursor\", \"zoom-in\")\n            .transition()\n            .duration(750)\n            .attr(\"height\", chart_height)\n            .attr(\"width\", chart_width);\n\n        d3.select(this)\n            .style(\"cursor\", \"default\")\n            .transition()\n            .duration(750)\n            .attr(\"height\", chart_height * chart_zoom)\n            .attr(\"width\", chart_width * chart_zoom);\n    }\n\n    // Formatter for x axis times (converting minutes to HH:MM).\n    var formatMinutes = d => {\n        var hours = Math.floor(d / 60);\n        var minutes = Math.floor(d - hours * 60);\n\n        if (hours < 10) {\n            hours = `0${hours}`;\n        }\n        if (minutes < 10) {\n            minutes = `0${minutes}`;\n        }\n\n        return `${hours}:${minutes}`;\n    };\n\n    // Create a chart object\n    var chart = d3\n        .select(`#${name}`)\n        .attr(\"viewBox\", `0 0 ${chart_width} ${chart_height}`)\n        .attr(\"width\", chart_width)\n        .attr(\"height\", chart_height)\n        .attr(\"preserveAspectRatio\", \"xMidYMin\")\n        .on(\"click\", click);\n\n    // Put title on chart\n    chart\n        .append(\"g\")\n        .append(\"text\")\n        .attr(\"class\", \"title\")\n        .attr(\"transform\", () => `translate( ${width},15 )`)\n        .text(title);\n\n    // Put bars on chart\n    var bar = chart\n        .selectAll(\".bar\")\n        .data(data)\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", \"bar\")\n        .attr(\"transform\", d => `translate(${+x(d.x) + margin.left},${+y(d.y) + margin.top})`)\n        .on(\"mouseenter\", d => {\n            // Show tool tip\n            var i = 0;\n\n            var size = d.length;\n\n            while (size >= 1) {\n                size = size / 10;\n                i++;\n            }\n            var wdth = i * 4 + 10;\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"text\")\n                .attr(\"transform\", `translate( ${margin.left - 5}, ${height - d.length * zoom + margin.top + 10} )`)\n                .attr(\"visibility\", \"visible\")\n                .text(d.length);\n\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .attr(\"width\", `${wdth}px`)\n                .attr(\"height\", \"15px\")\n                .select(\"rect\")\n                .attr(\"transform\", `translate( ${margin.left - wdth}, ${height - d.length * zoom + margin.top} )`)\n                .attr(\"width\", `${wdth}px`)\n                .attr(\"height\", \"15px\")\n                .attr(\"fill\", \"#ebd9b2\");\n        })\n        .on(\"mouseleave\", () => {\n            // Remove tool tip\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"text\")\n                .attr(\"visibility\", \"hidden\");\n\n            d3.select(currentEvent.target.parentElement)\n                .select(\".tool_tip\")\n                .select(\"rect\")\n                .attr(\"width\", \"0\")\n                .attr(\"height\", \"0\")\n                .attr(\"fill\", \"\");\n        });\n\n    // Create bar width\n    var bar_x;\n    if (data[0] === undefined) {\n        bar_x = 1;\n    } else {\n        bar_x = x(data[0].dx);\n    }\n\n    // Add color to bar\n    bar.append(\"rect\")\n        .attr(\"x\", 1)\n        .attr(\"width\", bar_x - 1)\n        .attr(\"height\", d => height - y(d.y));\n\n    // Create x axis\n    var xAxis = d3.svg\n        .axis()\n        .scale(x)\n        .orient(\"bottom\")\n        .tickFormat(formatMinutes);\n\n    // Add x axis to chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"id\", `x_${name}`)\n        .attr(\"transform\", `translate( ${margin.left},${+height + margin.top})`)\n        .call(xAxis);\n\n    // Add a title to the x axis\n    chart\n        .append(\"g\")\n        .append(\"text\")\n        .attr(\"class\", \"ax_title\")\n        .attr(\"transform\", () => {\n            var axis = d3.select(`#x_${name}`).node();\n            var left_pad = margin.left + axis.getBoundingClientRect().width / 2 + 30;\n            var top_pad = margin.top + height + axis.getBoundingClientRect().height + 10;\n            var trans = `translate(${left_pad},${top_pad})`;\n\n            return trans;\n        })\n        .text(\"ETA - hrs:mins\");\n\n    // Create y axis\n    var yAxis = d3.svg\n        .axis()\n        .scale(y)\n        .orient(\"left\");\n\n    // Add y axis to chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"y axis\")\n        .attr(\"id\", `y_${name}`)\n        .attr(\"transform\", `translate( ${margin.left},${margin.top})`)\n        .call(yAxis);\n\n    // Add a title to the y axis\n    chart\n        .append(\"g\")\n        .append(\"text\")\n        .attr(\"class\", \"ax_title\")\n        .attr(\"transform\", () => {\n            var axis = d3.select(`#y_${name}`).node();\n            var left_pad = margin.left - axis.getBoundingClientRect().width - 5;\n            var top_pad = margin.top + axis.getBoundingClientRect().height / 2 - 30;\n            var trans = `translate(${left_pad},${top_pad})rotate(-90)`;\n\n            return trans;\n        })\n        .text(\"Number of Jobs\");\n\n    // Put an invisible tool tip on the chart\n    chart\n        .append(\"g\")\n        .attr(\"class\", \"tool_tip\")\n        .append(\"rect\");\n    chart.select(\".tool_tip\").append(\"text\");\n}\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\n\n// ============================================================================\n// TS GROUP RELATED MODELS\n\nconst Group = Backbone.Model.extend({\n    urlRoot: `${getAppRoot()}api/groups`\n});\n\nconst Groups = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/groups`,\n\n    model: Group\n});\n\nexport default {\n    Group: Group,\n    Groups: Groups\n};\n","import _ from \"underscore\";\nimport Backbone from \"backbone\";\n\n// toolshed group row view\nconst GroupListRowView = Backbone.View.extend({\n    events: {},\n\n    initialize: function(options) {\n        this.render(options.group);\n    },\n\n    render: function(group) {\n        const tmpl = this.templateRow();\n        this.setElement(tmpl({ group: group }));\n        this.$el.show();\n        return this;\n    },\n\n    templateRow: function() {\n        return _.template(\n            [\n                '<tr class=\"\" data-id=\"<%- group.get(\"id\") %>\">',\n                '<td><a href=\"groups#/<%= group.get(\"id\") %>\"><%= _.escape(group.get(\"name\")) %></a></td>',\n                // '<td>description</td>',\n                '<td><%= group.get(\"total_members\") %></td>',\n                '<td><%= group.get(\"total_repos\") %></td>',\n                \"</tr>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    GroupListRowView: GroupListRowView\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { Toast } from \"ui/toast\";\nimport mod_group_model from \"toolshed/groups/group-model\";\nimport mod_group_row from \"toolshed/groups/group-listrow-view\";\nconst GroupListView = Backbone.View.extend({\n    el: \"#groups_element\",\n    defaults: {},\n\n    /**\n     * Initialize and fetch the groups from server.\n     * Async render afterwards.\n     * @param  {object} options an object with options\n     */\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, this.defaults, options);\n        const that = this;\n        window.globalTS.groups.collection = new mod_group_model.Groups();\n        window.globalTS.groups.collection.fetch({\n            success: function(model) {\n                that.render();\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    fetch: function() {},\n\n    /**\n     * Render the groups table from the object's own collection.\n     */\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").hide();\n        const template = this.templateGroupsList();\n        this.$el.html(template({ length: window.globalTS.groups.collection.models.length }));\n        this.renderRows(window.globalTS.groups.collection.models);\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    /**\n     * Render all given models as rows in the groups list\n     * @param  {array} groups_to_render array of group models to render\n     */\n    renderRows: function(groups_to_render) {\n        for (let i = 0; i < groups_to_render.length; i++) {\n            const group = groups_to_render[i];\n            this.renderOne({ group: group });\n        }\n    },\n\n    /**\n     * Create a view for the given model and add it to the groups view.\n     * @param {Group} model of the view that will be rendered\n     */\n    renderOne: function(options) {\n        const rowView = new mod_group_row.GroupListRowView(options);\n        this.$el.find(\"#group_list_body\").append(rowView.el);\n    },\n\n    /**\n     * Table heading was clicked, update sorting preferences and re-render.\n     * @return {[type]} [description]\n     */\n    // sort_clicked : function(){\n    //     if (Galaxy.libraries.preferences.get('sort_order') === 'asc'){\n    //         Galaxy.libraries.preferences.set({'sort_order': 'desc'});\n    //     } else {\n    //         Galaxy.libraries.preferences.set({'sort_order': 'asc'});\n    //     }\n    //     this.render();\n    // },\n\n    /**\n     * Sort the underlying collection according to the parameters received.\n     * Currently supports only sorting by name.\n     */\n    // sortLibraries: function(){\n    //     if (Galaxy.libraries.preferences.get('sort_by') === 'name'){\n    //         if (Galaxy.libraries.preferences.get('sort_order') === 'asc'){\n    //             this.collection.sortByNameAsc();\n    //         } else if (Galaxy.libraries.preferences.get('sort_order') === 'desc'){\n    //             this.collection.sortByNameDesc();\n    //         }\n    //     }\n    // },\n\n    // MMMMMMMMMMMMMMMMMM\n    // === TEMPLATES ====\n    // MMMMMMMMMMMMMMMMMM\n\n    templateGroupsList: function() {\n        const tmpl_array = [];\n\n        tmpl_array.push('<div id=\"groups\">');\n        tmpl_array.push(\"</div>\");\n        tmpl_array.push('<div class=\"groups_container table-responsive\">');\n        tmpl_array.push(\"<% if(length === 0) { %>\");\n        tmpl_array.push(\"<div>There are no groups yet.</div>\");\n        tmpl_array.push(\"<% } else{ %>\");\n        tmpl_array.push('<table class=\"grid table table-sm\">');\n        tmpl_array.push(\"   <thead>\");\n        tmpl_array.push(\"     <th>Name</th>\");\n        // tmpl_array.push('     <th style=\"width:22%;\">description</th>');\n        tmpl_array.push(\"     <th>Members</th> \");\n        tmpl_array.push(\"     <th>Repositories</th>\");\n        tmpl_array.push(\"   </thead>\");\n        tmpl_array.push('   <tbody id=\"group_list_body\">');\n        // group item views will attach here\n        tmpl_array.push(\"   </tbody>\");\n        tmpl_array.push(\"</table>\");\n        tmpl_array.push(\"<% }%>\");\n        tmpl_array.push(\"</div>\");\n\n        return _.template(tmpl_array.join(\"\"));\n    }\n});\n\nexport default {\n    GroupListView: GroupListView\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { Toast } from \"ui/toast\";\nimport mod_group_model from \"toolshed/groups/group-model\";\n\n// toolshed group detail view\nconst GroupDetailView = Backbone.View.extend({\n    el: \"#groups_element\",\n    options: {},\n    app: null,\n\n    initialize: function(options) {\n        this.options = _.extend(this.options, options);\n        this.app = window.globalTS.groups;\n\n        if (this.app.collection !== null) {\n            this.model = this.app.collection.get(this.options.group_id);\n            this.render();\n        } else {\n            this.fetchGroup();\n        }\n    },\n\n    fetchGroup: function(options) {\n        const that = this;\n        this.options = _.extend(this.options, options);\n        this.model = new mod_group_model.Group({ id: this.options.group_id });\n        this.model.fetch({\n            success: function(model) {\n                console.log(\"received data: \");\n                console.log(model);\n                that.render();\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    Toast.error(response.responseJSON.err_msg);\n                } else {\n                    Toast.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    render: function() {\n        const template = this.templateRow();\n        this.$el.html(template({ group: this.model }));\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    templateRow: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<h3><%= _.escape(group.get(\"name\")) %></h3>',\n                '<p class=\"\" style=\"color:gray;\">',\n                'A group of <%= group.get(\"members\").length %> members with <%= group.get(\"repositories\").length %> repositories and a total of <%= group.get(\"total_downloads\") %> combined repository clones.</p>',\n\n                \"<h3>Members</h3>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                \"<th>Name</th>\",\n                \"<th>Repositories</th>\",\n                \"<th>Registered</th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                '<% _.each(group.get(\"members\"), function(member) { %>',\n                \"<tr>\",\n                \"<td>\",\n                \"<%= _.escape(member.username) %>\",\n                \"</td>\",\n                \"<td>\",\n                '<a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Repositories of <%= _.escape(member.username) %>\" href=\"/repository/browse_repositories_by_user?user_id=<%= member.id %>&use_panels=true\" id=\"<%= member.id %>\"><%= member.user_repos_count %></a>',\n                \"</td>\",\n                \"<td>\",\n                \"<%= member.time_created %>\",\n                \"</td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</tbody>\",\n                \"</table>\",\n\n                \"<h3>Repositories</h3>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                \"<th>Name</th>\",\n                \"<th>Description</th>\",\n                \"<th>Clones</th>\",\n                \"<th>Owner</th>\",\n                \"<th>Categories</th>\",\n                \"<th>Created</th>\",\n                \"<th>Updated</th>\",\n                \"<th>Rating</th>\",\n                \"<th>Verified</th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                '<% _.each(group.get(\"repositories\"), function(repo) { %>',\n                \"<tr>\",\n                \"<td>\",\n                '<a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Details of <%= _.escape(repo.name) %>\" href=\"/view/<%= _.escape(repo.owner) %>/<%= _.escape(repo.name) %>\" id=\"<%= repo.id %>\"><%= _.escape(repo.name) %></a>',\n                \"</td>\",\n                \"<td>\",\n                \"<%= _.escape(repo.description) %>\",\n                \"</td>\",\n                \"<td>\",\n                \"<%= repo.times_downloaded %>\",\n                \"</td>\",\n                \"<td>\",\n                \"<%= _.escape(repo.owner) %>\",\n                \"</td>\",\n                \"<td>\",\n                \"<% _.each((repo.categories), function(cat) { %>\",\n                '<a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Repositories in <%= cat.name %>\" href=\"/repository/browse_repositories_in_category?id=<%= cat.id %>&use_panels=true\"><%= cat.name %></a><br/>',\n                // '<%= repo.categories %>',\n                \"<% }); %>\",\n                \"</td>\",\n                '<td data-toggle=\"tooltip\" data-placement=\"top\" title=\"<%= repo.time_created_full %>\">',\n                \"<%= repo.time_created %>\",\n                \"</td>\",\n                '<td data-toggle=\"tooltip\" data-placement=\"top\" title=\"<%= repo.time_updated_full %>\">',\n                \"<%= repo.time_updated %>\",\n                \"</td>\",\n                \"<td>\",\n                \"<%= repo.ratings_mean %>\",\n                \"</td>\",\n                \"<td>\",\n                \"<%= repo.approved %>\",\n                \"</td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</tbody>\",\n                \"</table>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\nexport default {\n    GroupDetailView: GroupDetailView\n};\n","// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n// === MAIN TOOLSHED GROUP MODULE ====\n// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n\nimport Backbone from \"backbone\";\nimport mod_group_list from \"toolshed/groups/group-list-view\";\nimport mod_group_detail from \"toolshed/groups/group-detail-view\";\n\n// ============================================================================\n// ROUTER\nconst ToolshedRouter = Backbone.Router.extend({\n    routes: {\n        \"\": \"groups\",\n        \":group_id\": \"group_page\"\n    }\n});\n\nconst ToolshedGroups = Backbone.View.extend({\n    groupListView: null,\n    groupDetailView: null,\n    collection: null,\n\n    initialize: function() {\n        window.globalTS.groups = this;\n\n        this.ts_router = new ToolshedRouter();\n        this.ts_router.on(\"route:groups\", () => {\n            window.globalTS.groups.groupListView = new mod_group_list.GroupListView();\n        });\n\n        this.ts_router.on(\"route:group_page\", group_id => {\n            window.globalTS.groups.groupDetailView = new mod_group_detail.GroupDetailView({\n                group_id: group_id\n            });\n        });\n\n        Backbone.history.start({ pushState: false });\n    }\n});\n\nexport default {\n    ToolshedGroups: ToolshedGroups\n};\n","import _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\n\n//==============================================================================\n/** @class Model for a saved Galaxy visualization.\n *\n *  @augments Backbone.Model\n *  @constructs\n */\nexport var Visualization = Backbone.Model.extend(\n    /** @lends Visualization.prototype */ {\n        ///** logger used to record this.log messages, commonly set to console */\n        //// comment this out to suppress log output\n        //logger              : console,\n\n        /** default attributes for a model */\n        defaults: {\n            config: {}\n        },\n\n        /** override urlRoot to handle prefix */\n        urlRoot: function() {\n            var apiUrl = \"api/visualizations\";\n            return getAppRoot() + apiUrl;\n        },\n\n        /** Set up the model, determine if accessible, bind listeners\n         *  @see Backbone.Model#initialize\n         */\n        initialize: function(data) {\n            //this.log( this + '.initialize', data, this.attributes );\n\n            // munge config sub-object here since bbone won't handle defaults with this\n            if (_.isObject(data.config) && _.isObject(this.defaults.config)) {\n                _.defaults(data.config, this.defaults.config);\n            }\n\n            this._setUpListeners();\n        },\n\n        /** set up any event listeners\n         */\n        _setUpListeners: function() {\n            //this.on( 'change', function(){\n            //    console.info( 'change:', arguments );\n            //});\n        },\n\n        // ........................................................................ config\n        /** override set to properly allow update and trigger change when setting the sub-obj 'config' */\n        set: function(key, val) {\n            //TODO: validate config is object\n            if (key === \"config\") {\n                var oldConfig = this.get(\"config\");\n                // extend if already exists (is this correct behavior? no way to eliminate keys or reset entirely)\n                // clone in order to trigger change (diff. obj ref)\n                if (_.isObject(oldConfig)) {\n                    val = _.extend(_.clone(oldConfig), val);\n                }\n            }\n            Backbone.Model.prototype.set.call(this, key, val);\n            return this;\n        },\n\n        // ........................................................................ misc\n        /** String representation */\n        toString: function() {\n            var idAndTitle = this.get(\"id\") || \"\";\n            if (this.get(\"title\")) {\n                idAndTitle += `:${this.get(\"title\")}`;\n            }\n            return `Visualization(${idAndTitle})`;\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone collection of visualization models\n *\n *  @constructs\n */\nexport var VisualizationCollection = Backbone.Collection.extend(\n    /** @lends VisualizationCollection.prototype */ {\n        model: Visualization,\n\n        ///** logger used to record this.log messages, commonly set to console */\n        //// comment this out to suppress log output\n        //logger              : console,\n\n        url: function() {\n            return `${getAppRoot()}api/visualizations`;\n        },\n\n        /** Set up.\n         *  @see Backbone.Collection#initialize\n         */\n        initialize: function(models, options) {\n            options = options || {};\n            //this._setUpListeners();\n        },\n\n        //_setUpListeners : function(){\n        //},\n\n        // ........................................................................ common queries\n        // ........................................................................ ajax\n        // ........................................................................ misc\n        set: function(models, options) {\n            // arrrrrrrrrrrrrrrrrg...\n            // override to get a correct/smarter merge when incoming data is partial (e.g. stupid backbone)\n            //  w/o this partial models from the server will fill in missing data with model defaults\n            //  and overwrite existing data on the client\n            // see Backbone.Collection.set and _prepareModel\n            var collection = this;\n            models = _.map(models, model => {\n                var existing = collection.get(model.id);\n                if (!existing) {\n                    return model;\n                }\n\n                // merge the models _BEFORE_ calling the superclass version\n                var merged = existing.toJSON();\n                _.extend(merged, model);\n                return merged;\n            });\n            // now call superclass when the data is filled\n            Backbone.Collection.prototype.set.call(this, models, options);\n        },\n\n        /** String representation. */\n        toString: function() {\n            return [\"VisualizationCollection(\", [this.historyId, this.length].join(), \")\"].join(\"\");\n        }\n    }\n);\n","import Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport { Visualization } from \"mvc/visualization/visualization-model\";\nexport default Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        type: \"\",\n        date: null,\n        state: \"\",\n        state_info: \"\",\n        modified: true,\n        dataset_id: \"\",\n        dataset_id_job: null\n    },\n\n    initialize: function(options, viz_options) {\n        this.groups = new Backbone.Collection();\n        this.settings = new Backbone.Model();\n        this.visualization_id = viz_options.visualization_id;\n        this.visualization_name = viz_options.visualization_name;\n        this.dataset_id = viz_options.dataset_id;\n        this.chart_dict = viz_options.chart_dict;\n        console.debug(\"model::initialize() - Initialized with configuration:\");\n        console.debug(viz_options);\n    },\n\n    reset: function() {\n        this.clear().set({\n            title: \"New Chart\",\n            dataset_id: this.dataset_id\n        });\n        this.settings.clear();\n        this.groups.reset();\n        this.groups.add({ id: Utils.uid() });\n    },\n\n    state: function(value, info) {\n        this.set({ state: value, state_info: info });\n        this.trigger(\"set:state\");\n        console.debug(\"model::state() - \" + info + \" (\" + value + \")\");\n    },\n\n    /** Create chart dictionary */\n    serialize: function() {\n        var d = {\n            attributes: this.attributes,\n            settings: this.settings.attributes,\n            groups: []\n        };\n        this.groups.each(function(group) {\n            d.groups.push(group.attributes);\n        });\n        return d;\n    },\n\n    /** Pack and save nested chart model */\n    save: function(options) {\n        var self = this;\n        options = options || {};\n        this.chart_dict = this.serialize();\n        var viz = new Visualization({\n            id: this.visualization_id || undefined,\n            type: this.visualization_name,\n            title: this.get(\"title\") || \"\",\n            config: {\n                dataset_id: this.dataset_id,\n                chart_dict: this.chart_dict\n            }\n        });\n        viz.save()\n            .then(function(response) {\n                if (response && response.id) {\n                    self.visualization_id = response.id;\n                    if (options.success) {\n                        options.success();\n                    }\n                    console.debug(\"model::save() - Received visualization id: \" + response.id);\n                } else {\n                    if (options.error) {\n                        options.error();\n                    }\n                    console.debug(\"model::save() - Unrecognized response. Saving may have failed.\");\n                }\n            })\n            .fail(function(response) {\n                if (options.error) {\n                    options.error();\n                }\n                console.debug(\"model::save() - Saving failed.\");\n            });\n        console.debug(\"model::save() - Saving with configuration.\");\n    },\n\n    /** Load nested models/collections from packed dictionary */\n    load: function(chart_parsed) {\n        var d = chart_parsed || this.chart_dict;\n        if (d) {\n            console.debug(\"model::load() - Attempting to load with configuration:\");\n            console.debug(d);\n        }\n        this.reset();\n        if (d && d.attributes) {\n            this.set(d.attributes);\n            this.state(\"ok\", \"Loading saved visualization...\");\n            this.settings.set(d.settings);\n            this.groups.reset();\n            this.groups.add(d.groups);\n            this.set(\"modified\", false);\n            this.trigger(\"load\");\n            console.debug(\"model::load() - Loading chart model \" + d.attributes.type + \".\");\n            return true;\n        } else {\n            this.set(\"modified\", true);\n            this.trigger(\"load\");\n            console.debug(\"model::load() - Visualization attributes unavailable.\");\n            return false;\n        }\n    }\n});\n","/** This class renders the chart data selection form with repeats. */\n\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\nimport Form from \"mvc/form/form-view\";\nimport Repeat from \"mvc/form/form-repeat\";\nimport FormData from \"mvc/form/form-data\";\n\nvar GroupView = Backbone.View.extend({\n    initialize: function(app, options) {\n        var self = this;\n        this.deferred = app.deferred;\n        this.chart = app.chart;\n        this.group = options.group;\n        this.setElement($(\"<div/>\"));\n        this.listenTo(this.chart, \"change:dataset_id\", function() {\n            self.render();\n        });\n        this.render();\n    },\n    render: function() {\n        var self = this;\n        var inputs = Utils.clone(this.chart.plugin.groups) || [];\n        var dataset_id = this.chart.get(\"dataset_id\");\n        if (dataset_id) {\n            this.chart.state(\"wait\", \"Loading metadata...\");\n            this.deferred.execute(function(process) {\n                Utils.get({\n                    url: getAppRoot() + \"api/datasets/\" + dataset_id,\n                    cache: true,\n                    success: function(dataset) {\n                        var data_columns = {};\n                        FormData.visitInputs(inputs, function(input, prefixed) {\n                            if (input.type == \"data_column\") {\n                                data_columns[prefixed] = Utils.clone(input);\n                                var columns = [];\n                                if (input.is_auto) {\n                                    columns.push({ label: \"Column: Row Number\", value: \"auto\" });\n                                }\n                                if (input.is_zero) {\n                                    columns.push({ label: \"Column: None\", value: \"zero\" });\n                                }\n                                var meta = dataset.metadata_column_types;\n                                for (var key in meta) {\n                                    if (\n                                        ([\"int\", \"float\"].indexOf(meta[key]) != -1 && input.is_numeric) ||\n                                        input.is_label\n                                    ) {\n                                        columns.push({ label: \"Column: \" + (parseInt(key) + 1), value: key });\n                                    }\n                                }\n                                input.data = columns;\n                            }\n                            var model_value = self.group.get(prefixed);\n                            if (model_value !== undefined && !input.hidden) {\n                                input.value = model_value;\n                            }\n                        });\n                        inputs.push({\n                            name: \"__data_columns\",\n                            type: \"hidden\",\n                            hidden: true,\n                            value: data_columns\n                        });\n                        self.chart.state(\"ok\", \"Metadata initialized...\");\n                        self.form = new Form({\n                            inputs: inputs,\n                            onchange: function() {\n                                self.group.set(self.form.data.create());\n                                self.chart.set(\"modified\", true);\n                                self.chart.trigger(\"redraw\");\n                            }\n                        });\n                        self.group.set(self.form.data.create());\n                        self.$el.empty().append(self.form.$el);\n                        process.resolve();\n                        self.chart.trigger(\"redraw\");\n                    }\n                });\n            });\n        }\n    }\n});\n\nexport default Backbone.View.extend({\n    initialize: function(app) {\n        var self = this;\n        this.app = app;\n        this.chart = app.chart;\n        this.repeat = new Repeat.View({\n            title: \"Data series\",\n            title_new: \"Data series\",\n            min: 1,\n            onnew: function() {\n                self.chart.groups.add({ id: Utils.uid() });\n            }\n        });\n        this.setElement($(\"<div/>\").append(this.repeat.$el));\n        this.listenTo(this.chart.groups, \"remove\", function(group) {\n            self.repeat.del(group.id);\n            self.chart.trigger(\"redraw\");\n        });\n        this.listenTo(this.chart.groups, \"reset\", function() {\n            self.repeat.delAll();\n        });\n        this.listenTo(this.chart.groups, \"add\", function(group) {\n            self.repeat.add({\n                id: group.id,\n                $el: new GroupView(self.app, { group: group }).$el,\n                ondel: function() {\n                    self.chart.groups.remove(group);\n                }\n            });\n        });\n    },\n    render: function() {\n        if (_.size(this.chart.plugin.groups) > 0) {\n            this.repeat.$el.show();\n        } else {\n            this.repeat.$el.hide();\n        }\n    }\n});\n","/** This class renders the chart configuration form. */\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport Form from \"mvc/form/form-view\";\nimport FormData from \"mvc/form/form-data\";\n\nexport default Backbone.View.extend({\n    initialize: function(app, options) {\n        var self = this;\n        this.chart = app.chart;\n        this.setElement(\"<div/>\");\n        this.listenTo(this.chart, \"load\", function() {\n            self.render();\n        });\n    },\n    render: function() {\n        var self = this;\n        var inputs = Utils.clone(this.chart.plugin.settings) || [];\n        var panel_option = this.chart.plugin.specs.use_panels;\n        if (panel_option == \"optional\") {\n            inputs.push({\n                name: \"__use_panels\",\n                type: \"boolean\",\n                label: \"Use multi-panels\",\n                help: \"Would you like to separate your data into individual panels?\"\n            });\n        } else {\n            this.chart.settings.set(\"__use_panels\", panel_option == \"yes\" ? \"true\" : \"false\");\n        }\n        this.$el.empty();\n        if (_.size(inputs) > 0) {\n            FormData.visitInputs(inputs, function(input, name) {\n                var model_value = self.chart.settings.get(name);\n                if (model_value !== undefined && !input.hidden) {\n                    input.value = model_value;\n                }\n            });\n            this.form = new Form({\n                inputs: inputs,\n                onchange: function() {\n                    self.chart.settings.set(self.form.data.create());\n                    self.chart.trigger(\"redraw\");\n                }\n            });\n            this.chart.settings.set(this.form.data.create());\n            this.$el.append(this.form.$el);\n        }\n    }\n});\n","/** Renders the visualization header with title, logo and description. */\n\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\n\nexport default Backbone.View.extend({\n    initialize: function(app) {\n        this.plugin = app.chart.plugin;\n        this.setElement(this._template());\n        this.$title = this.$(\".charts-description-title\");\n        this.$image = this.$(\".charts-description-image\");\n        this.$text = this.$(\".charts-description-text\");\n        this.render();\n    },\n    render: function() {\n        if (this.plugin.logo) {\n            this.$image.attr(\"src\", getAppRoot() + this.plugin.logo);\n            this.$title.html(this.plugin.html || \"Unavailable\");\n            this.$text.html(Utils.linkify(this.plugin.description || \"\"));\n            this.$el.show();\n        } else {\n            this.$el.hide();\n        }\n    },\n    _template: function() {\n        return `<div class=\"charts-description\">\n                    <table>\n                    <tr>\n                        <td class=\"charts-description-image-td\">\n                            <img class=\"charts-description-image\"/>\n                        </td>\n                        <td>\n                            <div class=\"charts-description-title\"/>\n                        </td>\n                    </tr>\n                    </table>\n                    <div class=\"charts-description-text\"/>\n                </div>`;\n    }\n});\n","/**\n *  The charts editor holds the tabs for selecting chart types, chart configuration\n *  and data group selections.\n */\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Groups from \"mvc/visualization/chart/views/groups\";\nimport Settings from \"mvc/visualization/chart/views/settings\";\nimport Description from \"mvc/visualization/chart/views/description\";\n\nexport default Backbone.View.extend({\n    initialize: function(app, options) {\n        this.app = app;\n        this.chart = this.app.chart;\n        this.description = new Description(this.app);\n        this.title = new Ui.Input({\n            onchange: () => {\n                this.chart.set(\"title\", this.title.value());\n            }\n        });\n        this.tabs = new Tabs.View({});\n        this.tabs.add({\n            id: \"settings\",\n            icon: \"fa fa-gear\",\n            tooltip: \"Change settings.\",\n            $el: $(\"<div/>\")\n                .append(\"<label><b>Provide a title</b><label>\")\n                .append(this.title.$el)\n                .append(\n                    $(\"<div/>\")\n                        .addClass(\"form-text text-muted\")\n                        .html(\"This title will appear in the list of 'Saved Visualizations'.\")\n                )\n                .append(new Settings(this.app).$el)\n        });\n        if (this.chart.plugin.groups) {\n            this.tabs.add({\n                id: \"groups\",\n                icon: \"fa-database\",\n                tooltip: \"Select data.\",\n                $el: new Groups(this.app).$el\n            });\n        }\n        this.setElement(\"<div class='charts-editor'/>\");\n        this.$el.append(this.description.$el);\n        this.$el.append(this.tabs.$el);\n        this.listenTo(this.chart, \"load\", () => {\n            this.title.value(this.chart.get(\"title\"));\n        });\n    }\n});\n","/**\n *  The viewer creates and manages the dom elements used by the visualization plugins to draw the chart.\n *  This is the last class of the charts core classes before handing control over to the visualization plugins.\n */\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\n\nexport default Backbone.View.extend({\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.chart = this.app.chart;\n        this.options = options;\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"charts-viewer\")\n                .append(\n                    $(\"<div/>\")\n                        .addClass(\"info\")\n                        .append($(\"<span/>\").addClass(\"icon\"))\n                        .append($(\"<span/>\").addClass(\"text\"))\n                )\n        );\n        this.$info = this.$(\".info\");\n        this.$icon = this.$(\".icon\");\n        this.$text = this.$(\".text\");\n        this._fullscreen(this.$el, 20);\n        this._createContainer(\"div\");\n        this.chart.on(\"redraw\", function(confirmed) {\n            if (!self.chart.get(\"modified\") || !self.chart.plugin.specs.confirm || confirmed) {\n                self.app.deferred.execute(function(process) {\n                    console.debug(\"viewer:redraw() - Redrawing...\");\n                    self._draw(process, self.chart);\n                });\n            } else {\n                self.chart.state(\"info\", \"Please confirm the settings before rendering the results.\");\n            }\n        });\n        this.chart.on(\"set:state\", function() {\n            var $container = self.$(\".charts-viewer-container\");\n            var $info = self.$info;\n            var $icon = self.$icon;\n            var $text = self.$text;\n            $icon.removeClass();\n            $info.show();\n            $text.html(self.chart.get(\"state_info\"));\n            var state = self.chart.get(\"state\");\n            switch (state) {\n                case \"ok\":\n                    $info.hide();\n                    $container.show();\n                    break;\n                case \"failed\":\n                    $icon.addClass(\"icon fa fa-warning\");\n                    $container.hide();\n                    break;\n                case \"info\":\n                    $icon.addClass(\"icon fa fa-info\");\n                    $container.hide();\n                    break;\n                default:\n                    $icon.addClass(\"icon fa fa-spinner fa-spin\");\n                    $container.show();\n            }\n        });\n    },\n\n    /** Force resize to fullscreen */\n    _fullscreen: function($el, margin) {\n        $el.css(\"height\", $(window).height() - margin);\n        $(window).resize(function() {\n            $el.css(\"height\", $(window).height() - margin);\n        });\n    },\n\n    /** A chart may contain multiple sub charts/containers which are created here */\n    _createContainer: function(tag, n) {\n        tag = tag || \"div\";\n        n = n || 1;\n        this.$(\".charts-viewer-container\").remove();\n        this.targets = [];\n        for (var i = 0; i < n; i++) {\n            var container_id = Utils.uid();\n            var container_el = $(\"<div/>\")\n                .addClass(\"charts-viewer-container\")\n                .width(parseInt(100 / n) + \"%\")\n                .append($(\"<\" + tag + \" class='charts-viewer-canvas' />\").attr(\"id\", container_id));\n            this.$el.append(container_el);\n            this.targets.push(container_id);\n        }\n    },\n\n    /** Draws a new chart by loading and executing the corresponding chart wrapper */\n    _draw: function(process, chart) {\n        var n_panels = chart.settings.get(\"__use_panels\") == \"true\" ? chart.groups.length : 1;\n        this._createContainer(chart.plugin.specs.tag, n_panels);\n        chart.set(\"date\", Utils.time());\n        chart.state(\"wait\", \"Please wait...\");\n        this.app.chart_load({ process: process, chart: chart, dataset: this.app.dataset, targets: this.targets });\n    }\n});\n","/** This class enables users to export/download a chart as PNG, SVG or PDF. */\n/** PNG export */\n\nimport $ from \"jquery\";\n\nfunction createPNG(options) {\n    if (options.$el.find(\"svg\").length > 0) {\n        _svg2png(options);\n    } else {\n        _canvas2png(options);\n    }\n}\n\nfunction _downloadData(imageData, filename) {\n    let link = document.createElement(\"a\");\n    link.download = filename;\n    link.href = imageData;\n    link.click();\n}\nfunction _downloadPNGData(imageData, filename) {\n    _downloadData(imageData.replace(\"image/png\", \"image/octet-stream\"), `${filename || \"GalaxyImage\"}.png`);\n}\n\nfunction _toImage($el, x_offset, y_offset, newContext) {\n    var tagname = $el.prop(\"tagName\").toLowerCase();\n    var p = $el.position();\n    var left =\n        x_offset +\n        p.left +\n        parseInt($el.css(\"marginLeft\"), 10) +\n        parseInt($el.css(\"borderLeftWidth\"), 10) +\n        parseInt($el.css(\"paddingLeft\"), 10);\n    var top =\n        y_offset +\n        p.top +\n        parseInt($el.css(\"marginTop\"), 10) +\n        parseInt($el.css(\"borderTopWidth\"), 10) +\n        parseInt($el.css(\"paddingTop\"), 10);\n    if (tagname == \"div\" || tagname == \"span\") {\n        $el.children().each(function() {\n            _toImage($(this), left, top);\n        });\n    } else if (tagname == \"canvas\") {\n        newContext.drawImage($el[0], left, top);\n    }\n}\n\n/** Convert canvas to png */\nfunction _canvas2png(options) {\n    let $canvas = options.$el.find(\".charts-viewer-canvas\");\n    try {\n        if ($canvas.width() !== 0 && $canvas.height() !== 0) {\n            var newCanvas = document.createElement(\"canvas\");\n            newCanvas.width = $canvas.outerWidth(true);\n            newCanvas.height = $canvas.outerHeight(true);\n            var newContext = newCanvas.getContext(\"2d\");\n            newContext.save();\n            newContext.fillStyle = \"rgb(255,255,255)\";\n            newContext.fillRect(0, 0, newCanvas.width, newCanvas.height);\n            newContext.restore();\n            newContext.translate(0, 0);\n            newContext.textAlign = \"left\";\n            newContext.textBaseline = \"top\";\n            $canvas.children().each(function() {\n                _toImage($(this), 0, 0, newContext);\n            });\n            const imgData = newCanvas.toDataURL(\"image/png\");\n            if (imgData) {\n                _downloadPNGData(imgData, options.title);\n            }\n        }\n    } catch (err) {\n        console.debug(\"FAILED - screenshot::_canvas2png() - \" + err);\n        if (options.error) {\n            options.error(\"Please reduce your visualization to a single panel and try again.\");\n        }\n    }\n}\n\n/** Convert svg to png */\nfunction _svg2png(options) {\n    var scale = 5;\n    var xml = toXML(options);\n    var canvas = document.createElement(\"canvas\");\n    var context = canvas.getContext(\"2d\");\n    var source = new Image();\n    var $container = $('<div style=\"display:none;\"/>').append($(canvas));\n    $(\"body\").append($container);\n    canvas.width = xml.width * scale;\n    canvas.height = xml.height * scale;\n    source.src = \"data:image/svg+xml;base64,\" + window.btoa(xml.string);\n    source.onload = function() {\n        context.drawImage(source, 0, 0, canvas.width, canvas.height);\n        let imageData = canvas.toDataURL(\"image/png\");\n        _downloadPNGData(imageData, options.title);\n        $container.remove();\n    };\n}\n\n/** SVG export */\nfunction createSVG(options) {\n    const imageData = `data:none/none;base64,${window.btoa(toXML(options).string)}`;\n    const filename = `${options.title || \"GalaxyImage\"}.svg`;\n    _downloadData(imageData, filename);\n}\n\n/** PDF export */\nfunction createPDF(options) {\n    var xml = toXML(options);\n    var data = {\n        filename: \"visualization\",\n        type: \"application/pdf\",\n        height: xml.height,\n        width: xml.width,\n        scale: 2,\n        svg: xml.string\n    };\n    var $el = $(\"body\");\n    var form = $el.find(\"#viewer-form\");\n    if (form.length === 0) {\n        form = $(\"<form>\", {\n            id: \"viewer-form\",\n            method: \"post\",\n            action: \"http://export.highcharts.com/\",\n            display: \"none\"\n        });\n        $el.append(form);\n    }\n    form.empty();\n    for (var name in data) {\n        var input = $(\"<input/>\", {\n            type: \"hidden\",\n            name: name,\n            value: data[name]\n        });\n        form.append(input);\n    }\n    try {\n        form.submit();\n    } catch (err) {\n        console.log(err);\n    }\n}\n\n/** XML export */\nfunction toXML(options) {\n    var $svg = options.$el.find(\"svg\");\n    if ($svg.length == 0) {\n        if (options.error) {\n            options.error(\"No SVG found. This visualization type does not support SVG/PDF export.\");\n            return;\n        }\n    }\n    var nsvgs = $svg.length;\n    var height = parseInt($svg.first().css(\"height\"));\n    var width = parseInt($svg.first().css(\"width\"));\n    var serializer = new XMLSerializer();\n    var $composite = $(\"<svg/>\").attr({\n        version: \"1.1\",\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: width * nsvgs,\n        height: height\n    });\n    var offsetX = 0;\n    $svg.each(function() {\n        var $svg = $(this).clone();\n        _inline($svg);\n        var $g = $('<g transform=\"translate(' + offsetX + ', 0)\">').attr(\"xmlns\", \"http://www.w3.org/2000/svg\");\n        $g.append($svg.find(\"g\").first());\n        $composite.append($g);\n        offsetX += width;\n    });\n    return {\n        string: serializer.serializeToString($composite[0]),\n        height: height,\n        width: width\n    };\n}\n\n/** inlines CSS code */\nfunction _inline($target) {\n    for (var sheet_id in document.styleSheets) {\n        var sheet = document.styleSheets[sheet_id];\n        var rules = sheet.cssRules;\n        if (rules) {\n            for (var idx = 0, len = rules.length; idx < len; idx++) {\n                try {\n                    $target.find(rules[idx].selectorText).each(function(i, elem) {\n                        elem.style.cssText += rules[idx].style.cssText;\n                    });\n                } catch (err) {\n                    console.error(err);\n                }\n            }\n        }\n    }\n}\n\nexport default {\n    createPNG: createPNG,\n    createSVG: createSVG,\n    createPDF: createPDF\n};\n","/** This class renders the chart menu options. */\nimport Backbone from \"backbone\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Screenshot from \"mvc/visualization/chart/components/screenshot\";\n\nexport default Backbone.View.extend({\n    initialize: function(app) {\n        this.app = app;\n        this.model = new Backbone.Model({ visible: true });\n        this.execute_button = new Ui.Button({\n            icon: \"fa-check-square\",\n            tooltip: \"Confirm\",\n            onclick: () => {\n                app.chart.trigger(\"redraw\", true);\n            }\n        });\n        this.export_button = new Ui.ButtonMenu({\n            icon: \"fa-camera\",\n            tooltip: \"Export\"\n        });\n        this.export_button.addMenu({\n            key: \"png\",\n            title: \"Save as PNG\",\n            icon: \"fa-file\",\n            onclick: () => {\n                this._wait(app.chart, () => {\n                    Screenshot.createPNG({\n                        $el: app.viewer.$el,\n                        title: app.chart.get(\"title\"),\n                        error: err => {\n                            app.message.update({ message: err, status: \"danger\" });\n                        }\n                    });\n                });\n            }\n        });\n        this.export_button.addMenu({\n            key: \"svg\",\n            title: \"Save as SVG\",\n            icon: \"fa-file-text-o\",\n            onclick: () => {\n                this._wait(app.chart, () => {\n                    Screenshot.createSVG({\n                        $el: app.viewer.$el,\n                        title: app.chart.get(\"title\"),\n                        error: err => {\n                            app.message.update({ message: err, status: \"danger\" });\n                        }\n                    });\n                });\n            }\n        });\n        this.export_button.addMenu({\n            key: \"pdf\",\n            title: \"Save as PDF\",\n            icon: \"fa-file-o\",\n            onclick: () => {\n                app.modal.show({\n                    title: \"Send visualization data for PDF creation\",\n                    body:\n                        \"Galaxy does not provide integrated PDF export scripts. You may click 'Continue' to create the PDF by using a 3rd party service (https://export.highcharts.com).\",\n                    buttons: {\n                        Cancel: () => {\n                            app.modal.hide();\n                        },\n                        Continue: () => {\n                            app.modal.hide();\n                            this._wait(app.chart, () => {\n                                Screenshot.createPDF({\n                                    $el: app.viewer.$el,\n                                    title: app.chart.get(\"title\"),\n                                    error: err => {\n                                        app.message.update({ message: err, status: \"danger\" });\n                                    }\n                                });\n                            });\n                        }\n                    }\n                });\n            }\n        });\n        this.left_button = new Ui.Button({\n            icon: \"fa-angle-double-left\",\n            tooltip: \"Show\",\n            onclick: () => {\n                this.model.set(\"visible\", true);\n                window.dispatchEvent(new Event(\"resize\"));\n            }\n        });\n        this.right_button = new Ui.Button({\n            icon: \"fa-angle-double-right\",\n            tooltip: \"Hide\",\n            onclick: () => {\n                this.model.set(\"visible\", false);\n                window.dispatchEvent(new Event(\"resize\"));\n            }\n        });\n        this.save_button = new Ui.Button({\n            icon: \"fa-save\",\n            tooltip: \"Save\",\n            onclick: () => {\n                if (app.chart.get(\"title\")) {\n                    app.message.update({\n                        message: `Saving '${app.chart.get(\n                            \"title\"\n                        )}'. It will appear in the list of 'Saved Visualizations'.`,\n                        status: \"success\"\n                    });\n                    app.chart.save({\n                        error: () => {\n                            app.message.update({\n                                message: \"Could not save visualization.\",\n                                status: \"danger\"\n                            });\n                        }\n                    });\n                } else {\n                    app.message.update({\n                        message: \"Please provide a name.\",\n                        status: \"danger\"\n                    });\n                }\n            }\n        });\n        this.buttons = [this.left_button, this.right_button, this.execute_button, this.export_button, this.save_button];\n        this.setElement(\"<div/>\");\n        for (let b of this.buttons) {\n            this.$el.append(b.$el);\n        }\n        this.listenTo(this.model, \"change\", () => this.render());\n        this.render();\n    },\n\n    render: function() {\n        var visible = this.model.get(\"visible\");\n        this.app.$el[visible ? \"removeClass\" : \"addClass\"](\"charts-fullscreen\");\n        this.execute_button.model.set(\"visible\", visible && !!this.app.chart.plugin.specs.confirm);\n        this.save_button.model.set(\"visible\", visible);\n        this.export_button.model.set(\"visible\", visible);\n        this.right_button.model.set(\"visible\", visible);\n        this.left_button.model.set(\"visible\", !visible);\n        var exports = this.app.chart.plugin.specs.exports || [];\n        this.export_button.collection.each(model => {\n            model.set(\"visible\", exports.indexOf(model.get(\"key\")) !== -1);\n        });\n    },\n\n    _wait: function(chart, callback) {\n        if (this.app.deferred.ready()) {\n            callback();\n        } else {\n            this.app.message.update({\n                message: \"Your visualization is currently being processed. Please wait and try again.\"\n            });\n        }\n    }\n});\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport Deferred from \"utils/deferred\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Chart from \"mvc/visualization/chart/components/model\";\nimport Editor from \"mvc/visualization/chart/views/editor\";\nimport Viewer from \"mvc/visualization/chart/views/viewer\";\nimport Menu from \"mvc/visualization/chart/views/menu\";\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        let Galaxy = getGalaxyInstance();\n        this.modal = Galaxy && Galaxy.modal ? Galaxy.modal : new Modal.View();\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"charts-client\")\n                .append($(\"<div/>\").addClass(\"charts-buttons\"))\n                .append($(\"<div/>\").addClass(\"charts-center\"))\n                .append($(\"<div/>\").addClass(\"charts-right\"))\n        );\n        this.$center = this.$(\".charts-center\");\n        this.$right = this.$(\".charts-right\");\n        this.$buttons = this.$(\".charts-buttons\");\n        this.chart = new Chart({}, options);\n        this.chart.plugin = options.visualization_plugin;\n        this.chart.plugin.specs = this.chart.plugin.specs || {};\n        this.chart_load = options.chart_load;\n        this.message = new Ui.Message();\n        this.deferred = new Deferred();\n        this.viewer = new Viewer(this);\n        this.editor = new Editor(this);\n        this.menu = new Menu(this);\n        this.$center.append(this.viewer.$el);\n        this.$right.append(this.message.$el).append(this.editor.$el);\n        this.$buttons.append(this.menu.$el);\n        $.ajax({\n            url: `${getAppRoot()}api/datasets/${options.dataset_id}`\n        })\n            .done(dataset => {\n                this.dataset = dataset;\n                this.chart.load();\n                this.chart.trigger(\"redraw\");\n            })\n            .fail(response => {\n                let message = response.responseJSON && response.responseJSON.err_msg;\n                this.errormessage = message || \"Import failed for unkown reason.\";\n            });\n    }\n});\n","/** This class handles, formats and caches datasets. */\nimport _ from \"underscore\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\n\n/** Assists in assigning the viewport panels */\nvar requestPanels = function(options) {\n    var process = options.process;\n    var chart = options.chart;\n    var render = options.render;\n    var targets = options.targets;\n    var dataset_id = options.dataset_id || options.chart.get(\"dataset_id\");\n    var dataset_groups = options.dataset_groups || options.chart.groups;\n    request({\n        chart: chart,\n        dataset_id: dataset_id,\n        dataset_groups: dataset_groups,\n        success: function(result) {\n            try {\n                if (targets.length == result.length) {\n                    var valid = true;\n                    for (var group_index in result) {\n                        var group = result[group_index];\n                        if (!render(targets[group_index], [group])) {\n                            valid = false;\n                            break;\n                        }\n                    }\n                    if (valid) {\n                        chart.state(\"ok\", \"Multi-panel chart drawn.\");\n                    }\n                } else if (targets.length == 1) {\n                    if (render(targets[0], result)) {\n                        chart.state(\"ok\", \"Chart drawn.\");\n                    }\n                } else {\n                    chart.state(\"failed\", \"Invalid panel count.\");\n                }\n                process.resolve();\n            } catch (err) {\n                console.debug(\"FAILED: tabular-utilities::panelHelper() - \" + err);\n                chart.state(\"failed\", err);\n                process.reject();\n            }\n        }\n    });\n};\n\n/** Fills request dictionary with data from cache/response */\nvar _cache = {};\nvar request = function(options) {\n    var groups = options.dataset_groups;\n    var dataset_id = options.dataset_id;\n    // identify columns needed to fulfill request\n    var column_list = [];\n    groups.each(function(group) {\n        _.each(group.get(\"__data_columns\"), function(column_def, column_name) {\n            var column = group.get(column_name);\n            var block_id = _block_id(dataset_id, column);\n            if (\n                column_list.indexOf(column) === -1 &&\n                !_cache[block_id] &&\n                column != \"auto\" &&\n                column != \"zero\" &&\n                column !== undefined\n            ) {\n                column_list.push(column);\n            }\n        });\n    });\n    if (column_list.length === 0) {\n        _fillFromCache(options);\n        return;\n    }\n    // Fetch data columns into dataset object\n    Utils.get({\n        url: getAppRoot() + \"api/datasets/\" + dataset_id,\n        data: {\n            data_type: \"raw_data\",\n            provider: \"dataset-column\",\n            indeces: column_list.toString()\n        },\n        success: function(response) {\n            var column_length = column_list.length;\n            var results = new Array(column_length);\n            for (let i = 0; i < results.length; i++) {\n                results[i] = [];\n            }\n            for (let i in response.data) {\n                var row = response.data[i];\n                for (let j in row) {\n                    var v = row[j];\n                    if (v !== undefined && v != 2147483647 && j < column_length) {\n                        results[j].push(v);\n                    }\n                }\n            }\n            console.debug(\"tabular-datasets::_fetch() - Fetching complete.\");\n            for (let i in results) {\n                var column = column_list[i];\n                var block_id = _block_id(dataset_id, column);\n                _cache[block_id] = results[i];\n            }\n            _fillFromCache(options);\n        }\n    });\n};\n\n/** Fill data from cache */\nvar _fillFromCache = function(options) {\n    var groups = options.dataset_groups;\n    var dataset_id = options.dataset_id;\n    console.debug(\"tabular-datasets::_fillFromCache() - Filling request from cache.\");\n    var limit = 0;\n    groups.each(function(group) {\n        _.each(group.get(\"__data_columns\"), function(column_def, column_name) {\n            var column = group.get(column_name);\n            var block_id = _block_id(dataset_id, column);\n            var column_data = _cache[block_id];\n            if (column_data) {\n                limit = Math.max(limit, column_data.length);\n            }\n        });\n    });\n    if (limit === 0) {\n        console.debug(\"tabular-datasets::_fillFromCache() - No data available.\");\n        if (options.chart) {\n            options.chart.state(\"failed\", \"No data available.\");\n        }\n    }\n    var results = [];\n    groups.each(function(group, group_index) {\n        var dict = Utils.merge({ key: group_index + \":\" + group.get(\"key\"), values: [] }, group.attributes);\n        for (let j = 0; j < limit; j++) {\n            dict.values[j] = { x: parseInt(j) };\n        }\n        results.push(dict);\n    });\n    groups.each(function(group, group_index) {\n        var values = results[group_index].values;\n        _.each(group.get(\"__data_columns\"), function(column_def, column_name) {\n            var column = group.get(column_name);\n            switch (column) {\n                case \"auto\":\n                    for (let j = 0; j < limit; j++) {\n                        values[j][column_name] = parseInt(j);\n                    }\n                    break;\n                case \"zero\":\n                    for (let j = 0; j < limit; j++) {\n                        values[j][column_name] = 0;\n                    }\n                    break;\n                default:\n                    var block_id = _block_id(dataset_id, column);\n                    var column_data = _cache[block_id];\n                    for (let j = 0; j < limit; j++) {\n                        var value = values[j];\n                        var v = column_data[j];\n                        if (isNaN(v) && !column_def.is_label) {\n                            v = 0;\n                        }\n                        value[column_name] = v;\n                    }\n            }\n        });\n    });\n    options.success(results);\n};\n\n/** Get block id */\nvar _block_id = function(dataset_id, column) {\n    return dataset_id + \"_\" + \"_\" + column;\n};\n\nexport default { request: request, requestPanels: requestPanels };\n","import _ from \"underscore\";\nimport * as d3 from \"d3\";\n\n/** Get domain boundaries value */\nfunction getDomains(groups, keys) {\n    function _apply(operator, key) {\n        let value;\n        for (let group_index in groups) {\n            let value_sub = d3[operator](groups[group_index].values, function(d) {\n                return d[key];\n            });\n            value = value === undefined ? value_sub : Math[operator](value, value_sub);\n        }\n        return value;\n    }\n    var result = {};\n    for (var index in keys) {\n        var key = keys[index];\n        result[key] = {\n            min: _apply(\"min\", key),\n            max: _apply(\"max\", key)\n        };\n    }\n    return result;\n}\n\n/** Default series maker */\nfunction makeSeries(groups, keys) {\n    var plot_data = [];\n    for (var group_index in groups) {\n        var group = groups[group_index];\n        var data = [];\n        for (var value_index in group.values) {\n            var point = [];\n            if (keys) {\n                for (var key_index in keys) {\n                    let column_index = keys[key_index];\n                    point.push(group.values[value_index][column_index]);\n                }\n            } else {\n                for (let column_index in group.values[value_index]) {\n                    point.push(group.values[value_index][column_index]);\n                }\n            }\n            data.push(point);\n        }\n        plot_data.push(data);\n    }\n    return plot_data;\n}\n\n/** Default category maker */\nfunction makeCategories(groups, column_keys) {\n    var array = {};\n    var data_columns = groups[0].__data_columns;\n    _.each(column_keys, function(key) {\n        if (data_columns[key].is_label) {\n            array[key] = [];\n        }\n    });\n    if (groups && groups[0]) {\n        _.each(groups[0].values, function(value_dict) {\n            for (var key in array) {\n                array[key].push(String(value_dict[key]));\n            }\n        });\n    }\n    mapCategories(array, groups);\n    return { array: array };\n}\n\n/** Apply default mapping index all values contained in label columns (for all groups) */\nfunction mapCategories(array, groups) {\n    _.each(groups, function(group) {\n        _.each(group.values, function(value_dict, i) {\n            for (var key in array) {\n                value_dict[key] = parseInt(i);\n            }\n        });\n    });\n}\n\n/** Category make for unique category labels */\nfunction makeUniqueCategories(groups, with_index) {\n    var categories = {};\n    var array = {};\n    var counter = {};\n    var data_columns = groups[0].__data_columns;\n    _.each(data_columns, function(column_def, key) {\n        if (column_def.is_label) {\n            categories[key] = {};\n            array[key] = [];\n            counter[key] = 0;\n        }\n    });\n    // index all values contained in label columns (for all groups)\n    for (var i in groups) {\n        var group = groups[i];\n        for (var j in group.values) {\n            var value_dict = group.values[j];\n            for (var key in categories) {\n                var value = String(value_dict[key]);\n                if (categories[key][value] === undefined) {\n                    categories[key][value] = counter[key];\n                    array[key].push(with_index ? [counter[key], value] : value);\n                    counter[key]++;\n                }\n            }\n        }\n    }\n    // convert group values into category indeces\n    for (let i in groups) {\n        let group = groups[i];\n        for (let j in group.values) {\n            let value_dict = group.values[j];\n            for (let key in categories) {\n                let value = String(value_dict[key]);\n                value_dict[key] = categories[key][value];\n            }\n        }\n    }\n    return {\n        categories: categories,\n        array: array,\n        counter: counter\n    };\n}\n\n/** Make axis */\nfunction makeTickFormat(options) {\n    var type = options.type;\n    var precision = options.precision;\n    var categories = options.categories;\n    var formatter = options.formatter;\n    if (type == \"hide\") {\n        formatter(function() {\n            return \"\";\n        });\n    } else if (type == \"auto\") {\n        if (categories) {\n            formatter(function(value) {\n                return categories[value] || \"\";\n            });\n        }\n    } else {\n        var d3format = function(d) {\n            switch (type) {\n                case \"s\":\n                    var prefix = d3.formatPrefix(d);\n                    return prefix.scale(d).toFixed() + prefix.symbol;\n                default:\n                    return d3.format(\".\" + precision + type)(d);\n            }\n        };\n        if (categories) {\n            formatter(function(value) {\n                var label = categories[value];\n                if (label) {\n                    if (isNaN(label)) {\n                        return label;\n                    } else {\n                        try {\n                            return d3format(label);\n                        } catch (err) {\n                            return label;\n                        }\n                    }\n                } else {\n                    return \"\";\n                }\n            });\n        } else {\n            formatter(function(value) {\n                return d3format(value);\n            });\n        }\n    }\n}\n\n/** Add zoom handler */\nfunction addZoom(options) {\n    var scaleExtent = 100;\n    var yAxis = options.yAxis;\n    var xAxis = options.xAxis;\n    var xDomain = options.xDomain || xAxis.scale().domain;\n    var yDomain = options.yDomain || yAxis.scale().domain;\n    var redraw = options.redraw;\n    var svg = options.svg;\n    var xScale = xAxis.scale();\n    var yScale = yAxis.scale();\n    var x_boundary = xScale.domain().slice();\n    var y_boundary = yScale.domain().slice();\n    var d3zoom = d3.behavior.zoom();\n    xScale.nice();\n    yScale.nice();\n    function fixDomain(domain, boundary) {\n        domain[0] = Math.min(Math.max(domain[0], boundary[0]), boundary[1] - boundary[1] / scaleExtent);\n        domain[1] = Math.max(boundary[0] + boundary[1] / scaleExtent, Math.min(domain[1], boundary[1]));\n        return domain;\n    }\n    function zoomed() {\n        yDomain(fixDomain(yScale.domain(), y_boundary));\n        xDomain(fixDomain(xScale.domain(), x_boundary));\n        redraw();\n    }\n    function unzoomed() {\n        xDomain(x_boundary);\n        yDomain(y_boundary);\n        redraw();\n        d3zoom.scale(1);\n        d3zoom.translate([0, 0]);\n    }\n    d3zoom\n        .x(xScale)\n        .y(yScale)\n        .scaleExtent([1, scaleExtent])\n        .on(\"zoom\", zoomed);\n    svg.call(d3zoom).on(\"dblclick.zoom\", unzoomed);\n    return d3zoom;\n}\n\nexport default {\n    makeCategories: makeCategories,\n    makeUniqueCategories: makeUniqueCategories,\n    makeSeries: makeSeries,\n    getDomains: getDomains,\n    mapCategories: mapCategories,\n    makeTickFormat: makeTickFormat,\n    addZoom: addZoom\n};\n","/** This class handles job submissions to the Galaxy API. */\nimport _ from \"underscore\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\nimport { getGalaxyInstance } from \"app\";\n\n/** Time to wait before refreshing to check if job has completed */\nconst WAITTIME = 1000;\n\n/** build job dictionary */\nvar requestCharts = function(chart, module) {\n    var settings_string = \"\";\n    var columns_string = \"\";\n    var group_index = 0;\n    for (var key in chart.settings.attributes) {\n        var settings_value = chart.settings.get(key);\n        _.each([[\" \", \"&#32;\"], [\",\", \"&#44;\"], [\":\", \"&#58;\"]], function(pair) {\n            settings_value = settings_value.replace(new RegExp(pair[0], \"g\"), pair[1]);\n        });\n        settings_string += key + \":\" + settings_value + \", \";\n    }\n    settings_string = settings_string.substring(0, settings_string.length - 2);\n    chart.groups.each(function(group) {\n        group_index++;\n        _.each(group.get(\"__data_columns\"), function(data_columns, name) {\n            columns_string += name + \"_\" + group_index + \":\" + (parseInt(group.get(name)) + 1) + \", \";\n        });\n    });\n    columns_string = columns_string.substring(0, columns_string.length - 2);\n    return {\n        tool_id: \"toolshed.g2.bx.psu.edu/repos/iuc/charts/charts/1.0.1\",\n        inputs: {\n            input: {\n                id: chart.get(\"dataset_id\"),\n                src: \"hda\"\n            },\n            module: module,\n            columns: columns_string,\n            settings: settings_string\n        }\n    };\n};\n\n/** Submit job request to charts tool */\nvar request = function(chart, parameters, success, error) {\n    chart.state(\"wait\", \"Requesting job results...\");\n    if (chart.get(\"modified\") && chart.get(\"dataset_id_job\")) {\n        Utils.request({\n            type: \"PUT\",\n            url: getAppRoot() + \"api/histories/none/contents/\" + chart.get(\"dataset_id_job\"),\n            data: { deleted: true },\n            success: () => {\n                refreshHdas();\n            }\n        });\n        chart.set(\"dataset_id_job\", null);\n        chart.set(\"modified\", false);\n    }\n    if (chart.get(\"dataset_id_job\")) {\n        wait(chart, success, error);\n    } else {\n        chart.state(\"wait\", \"Sending job request...\");\n        Utils.request({\n            type: \"POST\",\n            url: getAppRoot() + \"api/tools\",\n            data: parameters,\n            success: function(response) {\n                if (!response.outputs || response.outputs.length === 0) {\n                    chart.state(\"failed\", \"Job submission failed. No response.\");\n                    if (error) {\n                        error();\n                    }\n                } else {\n                    refreshHdas();\n                    var job = response.outputs[0];\n                    chart.state(\n                        \"wait\",\n                        \"Your job has been queued. You may close the browser window. The job will run in the background.\"\n                    );\n                    chart.set(\"dataset_id_job\", job.id);\n                    chart.save();\n                    wait(chart, success, error);\n                }\n            },\n            error: function(response) {\n                var message = \"\";\n                if (response && response.message && response.message.data && response.message.data.input) {\n                    message = response.message.data.input + \".\";\n                }\n                chart.state(\n                    \"failed\",\n                    \"This visualization requires the '\" +\n                        parameters.tool_id +\n                        \"' tool. Please make sure it is installed. \" +\n                        message\n                );\n                if (error) {\n                    error();\n                }\n            }\n        });\n    }\n};\n\n/** Request job details */\nvar wait = function(chart, success, error) {\n    Utils.request({\n        type: \"GET\",\n        url: getAppRoot() + \"api/datasets/\" + chart.get(\"dataset_id_job\"),\n        data: {},\n        success: function(dataset) {\n            var ready = false;\n            switch (dataset.state) {\n                case \"ok\":\n                    chart.state(\"wait\", \"Job completed successfully...\");\n                    if (success) {\n                        success(dataset);\n                    }\n                    ready = true;\n                    break;\n                case \"error\":\n                    chart.state(\"failed\", \"Job has failed. Please check the history for details.\");\n                    if (error) {\n                        error(dataset);\n                    }\n                    ready = true;\n                    break;\n                case \"running\":\n                    chart.state(\n                        \"wait\",\n                        \"Your job is running in the background and you may close the browser tab. Results will be available in your saved visualizations list.\"\n                    );\n            }\n            if (!ready) {\n                window.setTimeout(function() {\n                    wait(chart, success, error);\n                }, WAITTIME);\n            }\n        }\n    });\n};\n\n/** Refresh history panel */\nvar refreshHdas = function() {\n    let Galaxy = getGalaxyInstance();\n    if (Galaxy && Galaxy.currHistoryPanel) {\n        Galaxy.currHistoryPanel.refreshContents();\n    }\n};\n\nexport default { request: request, requestCharts: requestCharts };\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","<template>\n    <div id=\"masthead\"></div>\n</template>\n\n<script>\nimport { getGalaxyInstance } from \"app\";\nimport Masthead from \"layout/masthead\";\n\nexport default {\n    mounted() {\n        this.backboneRender();\n    },\n\n    updated() {\n        this.backboneRender();\n    },\n\n    methods: {\n        backboneRender() {\n            // dont bother unless we're in top window\n            if (window.top !== window) {\n                return;\n            }\n\n            let galaxy = getGalaxyInstance();\n\n            // old backbone view\n            if (!galaxy.masthead) {\n                galaxy.masthead = new Masthead.View(this.$props);\n            }\n\n            // bolt the rendered DOM onto the vue component's element\n            let backboneDom = galaxy.masthead.render();\n            this.$el.appendChild(backboneDom.$el[0]);\n        }\n    }\n};\n</script>\n\n<style lang=\"scss\">\n#masthead:empty {\n    display: none;\n}\n\n.framed {\n    #messagebox,\n    #masthead {\n        display: none;\n    }\n\n    #center,\n    #right,\n    #left {\n        top: 0;\n    }\n}\n</style>\n","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=2cff1a11&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"masthead\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * Temporary function used to mount the masthead inside the current application.\n * This function is exposed with the rest of the page-globals in bundledEntries.\n */\nimport Vue from \"vue\";\nimport Masthead from \"components/Masthead\";\n\nexport function initMasthead(config, container) {\n    console.log(\"initMasthead\");\n    let Component = Vue.extend(Masthead);\n    return new Component({\n        props: Object.keys(config),\n        propsData: config,\n        el: container\n    });\n}\n","/**\n * Panel management code transplanted from base.mako\n * TODO: figure out when these functions fire\n *\n * @param {} panelConfig\n */\nexport function panelManagement(panelConfig) {\n    console.log(\"panelManagement\");\n    console.log(\"(looks like it's assinging some global handlers to window to manage the left and right panel views?)\");\n\n    let { left_panel, right_panel, rightPanelSelector, leftPanelSelector } = panelConfig;\n\n    if (left_panel) {\n        var lp = new window.bundleEntries.panels.LeftPanel({\n            el: leftPanelSelector\n        });\n        window.force_left_panel = function(x) {\n            console.log(\"window.force_left_panel fired\");\n            lp.force_panel(x);\n        };\n    }\n\n    if (right_panel) {\n        var rp = new window.bundleEntries.panels.RightPanel({\n            el: rightPanelSelector\n        });\n        window.handle_minwidth_hint = function(x) {\n            console.log(\"window.handle_minwidth_hint\", x);\n            rp.handle_minwidth_hint(x);\n        };\n        window.force_right_panel = function(x) {\n            console.log(\"window.force_right_panel\", x);\n            rp.force_panel(x);\n        };\n    }\n}\n","import { getRootFromIndexLink } from \"./getRootFromIndexLink\";\n\nexport const defaultConfigs = {\n    options: {\n        root: getRootFromIndexLink()\n    },\n    bootstrapped: {},\n    form_input_auto_focus: false,\n    sentry: {}\n};\n","module.exports = global[\"config\"] = require(\"-!./loadConfig.js\");","// eslint-disable-next-line no-undef\ndefine([\"i18n!nls/locale\"], function(localeStrings) {\n    // =============================================================================\n    /** Simple string replacement localization. Language data from galaxy/scripts/nls */\n\n    if (localeStrings.hasOwnProperty(\"__root\")) {\n        //console.debug( 'amdi18n+webpack localization for ' + locale + ' loaded' );\n\n        let locale = sessionStorage.getItem(\"currentLocale\");\n\n        if (locale) {\n            localeStrings =\n                localeStrings[\"__\" + locale] || localeStrings[\"__\" + locale.split(\"-\")[0]] || localeStrings.__root;\n        }\n\n        // } else {\n        //     console.debug( 'i18n+requirejs localization for ' + locale + ' loaded' );\n    }\n    // TODO: when this is no longer necessary remove this, i18n.js, and the resolveModule in config\n\n    // -----------------------------------------------------------------------------\n    /** Attempt to get a localized string for strToLocalize. If not found, return\n     *      the original strToLocalize.\n     * @param {String} strToLocalize the string to localize\n     * @returns either the localized string if found or strToLocalize if not found\n     */\n    var localize = function(strToLocalize) {\n        // console.debug( 'amdi18n.localize:', strToLocalize, '->', localeStrings[ strToLocalize ] || strToLocalize );\n\n        // //TODO: conditional compile on DEBUG flag\n        // // cache strings that need to be localized but haven't been?\n        // if( localize.cacheNonLocalized && !localeStrings.hasOwnProperty( strToLocalize ) ){\n        //     // console.debug( 'localization NOT found:', strToLocalize );\n        //     // add nonCached as hash directly to this function\n        //     localize.nonLocalized = localize.nonLocalized || {};\n        //     localize.nonLocalized[ locale ] = localize.nonLocalized[ locale ] || {};\n        //     localize.nonLocalized[ locale ][ strToLocalize ] = false;\n        // }\n\n        // return the localized version from the closure if it's there, the strToLocalize if not\n        return localeStrings[strToLocalize] || strToLocalize;\n    };\n    localize.cacheNonLocalized = false;\n\n    // =============================================================================\n    return localize;\n});\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\n\n/**\n * Stringifies a number adding commas for digit grouping as per North America.\n */\nfunction commatize(number) {\n    number += \"\"; // Convert to string\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(number)) {\n        number = number.replace(rgx, \"$1\" + \",\" + \"$2\");\n    }\n    return number;\n}\n\n/**\n * Helper to determine if object is jQuery deferred.\n */\nvar is_deferred = d => \"promise\" in d;\n\n/**\n * Implementation of a server-state based deferred. Server is repeatedly polled, and when\n * condition is met, deferred is resolved.\n */\nvar ServerStateDeferred = Backbone.Model.extend({\n    defaults: {\n        ajax_settings: {},\n        interval: 1000,\n        success_fn: function(result) {\n            return true;\n        }\n    },\n\n    /**\n     * Returns a deferred that resolves when success function returns true.\n     */\n    go: function() {\n        var deferred = $.Deferred();\n        var self = this;\n        var ajax_settings = self.get(\"ajax_settings\");\n        var success_fn = self.get(\"success_fn\");\n        var interval = self.get(\"interval\");\n\n        var _go = () => {\n            $.ajax(ajax_settings).success(result => {\n                if (success_fn(result)) {\n                    // Result is good, so resolve.\n                    deferred.resolve(result);\n                } else {\n                    // Result not good, try again.\n                    setTimeout(_go, interval);\n                }\n            });\n        };\n\n        _go();\n        return deferred;\n    }\n});\n\n/**\n * Returns a random color in hexadecimal format that is sufficiently different from a single color\n * or set of colors.\n * @param colors a color or list of colors in the format '#RRGGBB'\n */\nvar get_random_color = colors => {\n    // Default for colors is white.\n    if (!colors) {\n        colors = \"#ffffff\";\n    }\n\n    // If needed, create list of colors.\n    if (typeof colors === \"string\") {\n        colors = [colors];\n    }\n\n    // Convert colors to numbers.\n    for (var i = 0; i < colors.length; i++) {\n        colors[i] = parseInt(colors[i].slice(1), 16);\n    }\n\n    // -- Perceived brightness and difference formulas are from\n    // -- http://www.w3.org/WAI/ER/WD-AERT/#color-contrast\n\n    // Compute perceived color brightness (based on RGB-YIQ transformation):\n    var brightness = (r, g, b) => (r * 299 + g * 587 + b * 114) / 1000;\n\n    // Compute color difference:\n    var difference = (r1, g1, b1, r2, g2, b2) =>\n        Math.max(r1, r2) -\n        Math.min(r1, r2) +\n        (Math.max(g1, g2) - Math.min(g1, g2)) +\n        (Math.max(b1, b2) - Math.min(b1, b2));\n\n    // Create new random color.\n    var new_color;\n\n    var nr;\n    var ng;\n    var nb;\n    var other_color;\n    var or;\n    var og;\n    var ob;\n    var n_brightness;\n    var o_brightness;\n    var diff;\n    var ok = false;\n    var num_tries = 0;\n    do {\n        // New color is never white b/c random in [0,1)\n        new_color = Math.round(Math.random() * 0xffffff);\n        nr = (new_color & 0xff0000) >> 16;\n        ng = (new_color & 0x00ff00) >> 8;\n        nb = new_color & 0x0000ff;\n        n_brightness = brightness(nr, ng, nb);\n        ok = true;\n        for (i = 0; i < colors.length; i++) {\n            other_color = colors[i];\n            or = (other_color & 0xff0000) >> 16;\n            og = (other_color & 0x00ff00) >> 8;\n            ob = other_color & 0x0000ff;\n            o_brightness = brightness(or, og, ob);\n            diff = difference(nr, ng, nb, or, og, ob);\n            // These thresholds may need to be adjusted. Brightness difference range is 125;\n            // color difference range is 500.\n            if (Math.abs(n_brightness - o_brightness) < 40 || diff < 200) {\n                ok = false;\n                break;\n            }\n        }\n\n        num_tries++;\n    } while (!ok && num_tries <= 10);\n\n    // Add 0x1000000 to left pad number with 0s.\n    return `#${(0x1000000 + new_color).toString(16).substr(1, 6)}`;\n};\n\nexport default {\n    commatize: commatize,\n    is_deferred: is_deferred,\n    ServerStateDeferred: ServerStateDeferred,\n    get_random_color: get_random_color\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\n\nexport var View = Backbone.View.extend({\n    className: \"ui-modal\",\n\n    // defaults\n    optionsDefault: {\n        container: \"body\",\n        title: \"ui-modal\",\n        cls: \"ui-modal\",\n        body: \"\",\n        backdrop: true,\n        height: null,\n        width: null,\n        xlarge: false /* BS4 max-width already expanded in Galaxy, expand even more if true. */,\n        closing_events: false,\n        closing_callback: null,\n        title_separator: true\n    },\n\n    // button list\n    buttonList: {},\n\n    // initialize\n    initialize: function(options) {\n        this.options = _.defaults(options || {}, this.optionsDefault);\n        $(this.options.container).prepend(this.el);\n        // optional render\n        if (options) {\n            this.render();\n        }\n    },\n\n    /**\n     * Displays modal\n     */\n    show: function(options) {\n        if (options) {\n            this.options = _.defaults(options, this.optionsDefault);\n            this.render();\n        }\n        if (!this.visible) {\n            this.visible = true;\n            this.$el.fadeIn(\"fast\");\n        }\n        if (this.options.closing_events) {\n            $(document).on(\"keyup.ui-modal\", e => {\n                if (e.keyCode == 27) {\n                    this.hide(true);\n                }\n            });\n            this.$backdrop.on(\"click\", () => {\n                this.hide(true);\n            });\n        }\n    },\n\n    /**\n     * Hide modal\n     */\n    hide: function(canceled) {\n        this.visible = false;\n        this.$el.fadeOut(\"fast\");\n        if (this.options.closing_callback) {\n            this.options.closing_callback(canceled);\n        }\n        $(document).off(\"keyup.ui-modal\");\n        this.$backdrop.off(\"click\");\n    },\n\n    /**\n     * Render modal\n     */\n    render: function() {\n        var self = this;\n        this.$el.html(this._template());\n\n        // link elements\n        this.$header = this.$(\".modal-header\");\n        this.$dialog = this.$(\".modal-dialog\");\n        this.$body = this.$(\".modal-body\");\n        this.$footer = this.$(\".modal-footer\");\n        this.$backdrop = this.$(\".modal-backdrop\");\n        this.$buttons = this.$(\".buttons\");\n\n        if (this.options.body == \"progress\") {\n            this.options.body = $(\n                '<div class=\"progress progress-striped active\">' +\n                    '<div class=\"progress-bar progress-bar-info\" style=\"width:100%\"/>' +\n                    \"</div>\"\n            );\n        }\n\n        // fix main content\n        this.$el\n            .removeClass()\n            .addClass(\"modal\")\n            .addClass(this.options.cls);\n        this.$header.find(\".title\").html(this.options.title);\n        this.$body.html(this.options.body);\n\n        // append buttons\n        this.$buttons.empty();\n        this.buttonList = {};\n        if (this.options.buttons) {\n            var counter = 0;\n            $.each(this.options.buttons, (name, callback) => {\n                var $button = $(\"<button/>\")\n                    .attr(\"id\", `button-${counter++}`)\n                    .text(name)\n                    .click(callback);\n                self.$buttons.append($button).append(\"&nbsp;\");\n                self.buttonList[name] = $button;\n            });\n        } else {\n            this.$footer.hide();\n        }\n\n        // configure background, separator line\n        this.$backdrop[(this.options.backdrop && \"addClass\") || \"removeClass\"](\"in\");\n        this.$header[(!this.options.title_separator && \"addClass\") || \"removeClass\"](\"no-separator\");\n\n        // fix dimensions\n        // note: because this is a singleton, we need to clear inline styles from any previous invocations\n        this.$body.removeAttr(\"style\");\n        if (this.options.height) {\n            this.$body.css(\"height\", this.options.height);\n            this.$body.css(\"overflow\", \"hidden\");\n        } else {\n            this.$body.css(\"max-height\", $(window).height() / 2);\n        }\n        if (this.options.width) {\n            this.$dialog.css(\"width\", this.options.width);\n        }\n        if (this.options.xlarge) {\n            this.$dialog.css(\"max-width\", \"3000px\");\n        }\n    },\n\n    /**\n     * Returns the button dom\n     * @param{String}   name    - Button name/title\n     */\n    getButton: function(name) {\n        return this.buttonList[name];\n    },\n\n    /**\n     * Enables a button\n     * @param{String}   name    - Button name/title\n     */\n    enableButton: function(name) {\n        this.getButton(name).prop(\"disabled\", false);\n    },\n\n    /**\n     * Disables a button\n     * @param{String}   name    - Button name/title\n     */\n    disableButton: function(name) {\n        this.getButton(name).prop(\"disabled\", true);\n    },\n\n    /**\n     * Show a button\n     * @param{String}   name    - Button name/title\n     */\n    showButton: function(name) {\n        this.getButton(name).show();\n    },\n\n    /**\n     * Hide a button\n     * @param{String}   name    - Button name/title\n     */\n    hideButton: function(name) {\n        this.getButton(name).hide();\n    },\n\n    /**\n     * Returns scroll top for body element\n     */\n    scrollTop: function() {\n        return this.$body.scrollTop();\n    },\n\n    /**\n     * Returns the modal template\n     */\n    _template: function() {\n        return (\n            '<div class=\"modal-backdrop fade\"/>' +\n            '<div class=\"modal-dialog\">' +\n            '<div class=\"modal-content\">' +\n            '<div class=\"modal-header\">' +\n            '<h4 class=\"title\"/>' +\n            \"</div>\" +\n            '<div class=\"modal-body\"/>' +\n            '<div class=\"modal-footer\">' +\n            '<div class=\"buttons\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport _l from \"utils/localization\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\nimport { getGalaxyInstance } from \"app\";\n\n/**\n * Dataset metedata.\n */\nvar DatasetMetadata = Backbone.Model.extend({});\n\n/**\n * A dataset. In Galaxy, datasets are associated with a history, so\n * this object is also known as a HistoryDatasetAssociation.\n */\nexport var Dataset = Backbone.Model.extend({\n    defaults: {\n        id: \"\",\n        type: \"\",\n        name: \"\",\n        hda_ldda: \"hda\",\n        metadata: null\n    },\n\n    initialize: function() {\n        // Metadata can be passed in as a model or a set of attributes; if it's\n        // already a model, there's no need to set metadata.\n        if (!this.get(\"metadata\")) {\n            this._set_metadata();\n        }\n\n        // Update metadata on change.\n        this.on(\"change\", this._set_metadata, this);\n    },\n\n    _set_metadata: function() {\n        var metadata = new DatasetMetadata();\n\n        // Move metadata from dataset attributes to metadata object.\n        _.each(\n            _.keys(this.attributes),\n            function(k) {\n                if (k.indexOf(\"metadata_\") === 0) {\n                    // Found metadata.\n                    var new_key = k.split(\"metadata_\")[1];\n                    metadata.set(new_key, this.attributes[k]);\n                    delete this.attributes[k];\n                }\n            },\n            this\n        );\n\n        // Because this is an internal change, silence it.\n        this.set(\"metadata\", metadata, { silent: true });\n    },\n\n    /**\n     * Returns dataset metadata for a given attribute.\n     */\n    get_metadata: function(attribute) {\n        return this.attributes.metadata.get(attribute);\n    },\n\n    urlRoot: `${getAppRoot()}api/datasets`\n});\n\n/**\n * A tabular dataset. This object extends dataset to provide incremental chunked data.\n */\nexport var TabularDataset = Dataset.extend({\n    defaults: _.extend({}, Dataset.prototype.defaults, {\n        chunk_url: null,\n        first_data_chunk: null,\n        offset: 0,\n        at_eof: false\n    }),\n\n    initialize: function(options) {\n        Dataset.prototype.initialize.call(this);\n\n        // If first data chunk is available, next chunk is 1.\n        if (this.attributes.first_data_chunk) {\n            this.attributes.offset = this.attributes.first_data_chunk.offset;\n        }\n        this.attributes.chunk_url = `${getAppRoot()}dataset/display?dataset_id=${this.id}`;\n        this.attributes.url_viz = `${getAppRoot()}visualization`;\n    },\n\n    /**\n     * Returns a jQuery Deferred object that resolves to the next data chunk or null if at EOF.\n     */\n    get_next_chunk: function() {\n        // If already at end of file, do nothing.\n        if (this.attributes.at_eof) {\n            return null;\n        }\n\n        // Get next chunk.\n        var self = this;\n\n        var next_chunk = $.Deferred();\n        $.getJSON(this.attributes.chunk_url, {\n            offset: self.attributes.offset\n        }).success(chunk => {\n            var rval;\n            if (chunk.ck_data !== \"\") {\n                // Found chunk.\n                rval = chunk;\n                self.attributes.offset = chunk.offset;\n            } else {\n                // At EOF.\n                self.attributes.at_eof = true;\n                rval = null;\n            }\n            next_chunk.resolve(rval);\n        });\n\n        return next_chunk;\n    }\n});\n\nexport var DatasetCollection = Backbone.Collection.extend({\n    model: Dataset\n});\n\n/**\n * Provides a base for table-based, dynamic view of a tabular dataset.\n * Do not instantiate directly; use either TopLevelTabularDatasetChunkedView\n * or EmbeddedTabularDatasetChunkedView.\n */\nvar TabularDatasetChunkedView = Backbone.View.extend({\n    /**\n     * Initialize view and, importantly, set a scroll element.\n     */\n    initialize: function(options) {\n        // Row count for rendering.\n        this.row_count = 0;\n        this.loading_chunk = false;\n\n        // load trackster button\n        new TabularButtonTracksterView({\n            model: options.model,\n            $el: this.$el\n        });\n    },\n\n    expand_to_container: function() {\n        if (this.$el.height() < this.scroll_elt.height()) {\n            this.attempt_to_fetch();\n        }\n    },\n\n    attempt_to_fetch: function(func) {\n        var self = this;\n        if (!this.loading_chunk && this.scrolled_to_bottom()) {\n            this.loading_chunk = true;\n            this.loading_indicator.show();\n            $.when(self.model.get_next_chunk()).then(result => {\n                if (result) {\n                    self._renderChunk(result);\n                    self.loading_chunk = false;\n                }\n                self.loading_indicator.hide();\n                self.expand_to_container();\n            });\n        }\n    },\n\n    render: function() {\n        // Add loading indicator.\n        this.loading_indicator = $(\"<div/>\").attr(\"id\", \"loading_indicator\");\n        this.$el.append(this.loading_indicator);\n\n        // Add data table and header.\n        var data_table = $(\"<table/>\").attr({\n            id: \"content_table\",\n            cellpadding: 0\n        });\n        this.$el.append(data_table);\n        var column_names = this.model.get_metadata(\"column_names\");\n        var header_container = $(\"<thead/>\").appendTo(data_table);\n        var header_row = $(\"<tr/>\").appendTo(header_container);\n        if (column_names) {\n            header_row.append(`<th>${column_names.join(\"</th><th>\")}</th>`);\n        } else {\n            for (var j = 1; j <= this.model.get_metadata(\"columns\"); j++) {\n                header_row.append(`<th>${j}</th>`);\n            }\n        }\n\n        // Render first chunk.\n        var self = this;\n\n        var first_chunk = this.model.get(\"first_data_chunk\");\n        if (first_chunk) {\n            // First chunk is bootstrapped, so render now.\n            this._renderChunk(first_chunk);\n        } else {\n            // No bootstrapping, so get first chunk and then render.\n            $.when(self.model.get_next_chunk()).then(result => {\n                self._renderChunk(result);\n            });\n        }\n\n        // -- Show new chunks during scrolling. --\n\n        // Set up chunk loading when scrolling using the scrolling element.\n        this.scroll_elt.scroll(() => {\n            self.attempt_to_fetch();\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return false;\n    },\n\n    // -- Helper functions. --\n\n    _renderCell: function(cell_contents, index, colspan) {\n        var $cell = $(\"<td>\").text(cell_contents);\n        var column_types = this.model.get_metadata(\"column_types\");\n        if (colspan !== undefined) {\n            $cell.attr(\"colspan\", colspan).addClass(\"stringalign\");\n        } else if (column_types) {\n            if (index < column_types.length) {\n                if (column_types[index] === \"str\" || column_types[index] === \"list\") {\n                    /* Left align all str columns, right align the rest */\n                    $cell.addClass(\"stringalign\");\n                }\n            }\n        }\n        return $cell;\n    },\n\n    _renderRow: function(line) {\n        // Check length of cells to ensure this is a complete row.\n        var cells = line.split(\"\\t\");\n\n        var row = $(\"<tr>\");\n        var num_columns = this.model.get_metadata(\"columns\");\n\n        if (this.row_count % 2 !== 0) {\n            row.addClass(\"dark_row\");\n        }\n\n        if (cells.length === num_columns) {\n            _.each(\n                cells,\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n        } else if (cells.length > num_columns) {\n            // SAM file or like format with optional metadata included.\n            _.each(\n                cells.slice(0, num_columns - 1),\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n            row.append(this._renderCell(cells.slice(num_columns - 1).join(\"\\t\"), num_columns - 1));\n        } else if (cells.length === 1) {\n            cells = line.split(\",\");\n            if (cells.length === num_columns) {\n                _.each(\n                    cells,\n                    function(cell_contents, index) {\n                        row.append(this._renderCell(cell_contents, index));\n                    },\n                    this\n                );\n            } else {\n                cells = line.split(\" \");\n                if (cells.length === num_columns) {\n                    _.each(\n                        cells,\n                        function(cell_contents, index) {\n                            row.append(this._renderCell(cell_contents, index));\n                        },\n                        this\n                    );\n                } else {    \n                    // Comment line, just return the one cell.\n                    row.append(this._renderCell(line, 0, num_columns));\n                }\n            }\n        } else {\n            // cells.length is greater than one, but less than num_columns.  Render cells and pad tds.\n            // Possibly a SAM file or like format with optional metadata missing.\n            // Could also be a tabular file with a line with missing columns.\n            _.each(\n                cells,\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n            _.each(_.range(num_columns - cells.length), () => {\n                row.append($(\"<td>\"));\n            });\n        }\n\n        this.row_count++;\n        return row;\n    },\n\n    _renderChunk: function(chunk) {\n        var data_table = this.$el.find(\"table\");\n        _.each(\n            chunk.ck_data.split(\"\\n\"),\n            function(line, index) {\n                if (line !== \"\") {\n                    data_table.append(this._renderRow(line));\n                }\n            },\n            this\n        );\n    }\n});\n\n/**\n * Tabular view that is placed at the top level of page. Scrolling occurs\n * view top-level elements outside of view.\n */\nvar TopLevelTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Scrolling happens in top-level elements.\n        var scroll_elt = _.find(this.$el.parents(), p => $(p).css(\"overflow\") === \"auto\");\n\n        // If no scrolling element found, use window.\n        if (!scroll_elt) {\n            scroll_elt = window;\n        }\n\n        // Wrap scrolling element for easy access.\n        this.scroll_elt = $(scroll_elt);\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return this.$el.height() - this.scroll_elt.scrollTop() - this.scroll_elt.height() <= 0;\n    }\n});\n\n/**\n * Tabular view tnat is embedded in a page. Scrolling occurs in view's el.\n */\nvar EmbeddedTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Because view is embedded, set up div to do scrolling.\n        this.scroll_elt = this.$el.css({\n            position: \"relative\",\n            overflow: \"scroll\",\n            height: options.height || \"500px\"\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return this.$el.scrollTop() + this.$el.innerHeight() >= this.el.scrollHeight;\n    }\n});\n\nfunction search(str, array) {\n    for (var j = 0; j < array.length; j++) if (array[j].match(str)) return j;\n    return -1;\n}\n\n/** Button for trackster visualization */\nvar TabularButtonTracksterView = Backbone.View.extend({\n    // gene region columns\n    col: {\n        chrom: null,\n        start: null,\n        end: null\n    },\n\n    // url for trackster\n    url_viz: null,\n\n    // dataset id\n    dataset_id: null,\n\n    // database key\n    genome_build: null,\n\n    // data type\n    file_ext: null,\n\n    // backbone initialize\n    initialize: function(options) {\n        // check if environment is available\n        let Galaxy = getGalaxyInstance();\n\n        // link galaxy modal or create one\n        if (Galaxy && Galaxy.modal) {\n            this.modal = Galaxy.modal;\n        }\n\n        // link galaxy frames\n        if (Galaxy && Galaxy.frame) {\n            this.frame = Galaxy.frame;\n        }\n\n        // check\n        if (!this.modal || !this.frame) {\n            return;\n        }\n\n        // model/metadata\n        var model = options.model;\n        var metadata = model.get(\"metadata\");\n\n        // check for datatype\n        if (!model.get(\"file_ext\")) {\n            return;\n        }\n\n        // get data type\n        this.file_ext = model.get(\"file_ext\");\n\n        // check for bed-file format\n        if (this.file_ext == \"bed\") {\n            // verify that metadata exists\n            if (metadata.get(\"chromCol\") && metadata.get(\"startCol\") && metadata.get(\"endCol\")) {\n                // read in columns\n                this.col.chrom = metadata.get(\"chromCol\") - 1;\n                this.col.start = metadata.get(\"startCol\") - 1;\n                this.col.end = metadata.get(\"endCol\") - 1;\n            } else {\n                console.log(\"TabularButtonTrackster : Bed-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check for vcf-file format\n        if (this.file_ext == \"vcf\") {\n            // search array\n\n            // load\n            this.col.chrom = search(\"Chrom\", metadata.get(\"column_names\"));\n            this.col.start = search(\"Pos\", metadata.get(\"column_names\"));\n            this.col.end = null;\n\n            // verify that metadata exists\n            if (this.col.chrom == -1 || this.col.start == -1) {\n                console.log(\"TabularButtonTrackster : VCF-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check\n        if (this.col.chrom === undefined) {\n            return;\n        }\n\n        // get dataset id\n        if (model.id) {\n            this.dataset_id = model.id;\n        } else {\n            console.log(\"TabularButtonTrackster : Dataset identification is missing.\");\n            return;\n        }\n\n        // get url\n        if (model.get(\"url_viz\")) {\n            this.url_viz = model.get(\"url_viz\");\n        } else {\n            console.log(\"TabularButtonTrackster : Url for visualization controller is missing.\");\n            return;\n        }\n\n        // get genome_build / database key\n        if (model.get(\"genome_build\")) {\n            this.genome_build = model.get(\"genome_build\");\n        }\n\n        // create the icon\n        var btn_viz = new mod_icon_btn.IconButtonView({\n            model: new mod_icon_btn.IconButton({\n                title: _l(\"Visualize\"),\n                icon_class: \"chart_curve\",\n                id: \"btn_viz\"\n            })\n        });\n\n        // set element\n        this.setElement(options.$el);\n\n        // add to element\n        this.$el.append(btn_viz.render().$el);\n\n        // hide the button\n        this.hide();\n    },\n\n    /** Add event handlers */\n    events: {\n        \"mouseover tr\": \"show\",\n        mouseleave: \"hide\"\n    },\n\n    // show button\n    show: function(e) {\n        var self = this;\n\n        // is numeric\n        function is_numeric(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        // check\n        if (this.col.chrom === null) return;\n\n        // get selected data line\n        var row = $(e.target).parent();\n\n        // verify that location has been found\n        var chrom = row\n            .children()\n            .eq(this.col.chrom)\n            .html();\n        var start = row\n            .children()\n            .eq(this.col.start)\n            .html();\n\n        // end is optional\n        var end = this.col.end\n            ? row\n                  .children()\n                  .eq(this.col.end)\n                  .html()\n            : start;\n\n        // double check location\n        if (!chrom.match(\"^#\") && chrom !== \"\" && is_numeric(start)) {\n            // get target gene region\n            var btn_viz_pars = {\n                dataset_id: this.dataset_id,\n                gene_region: `${chrom}:${start}-${end}`\n            };\n\n            // get button position\n            var offset = row.offset();\n            var left = offset.left - 10;\n            var top = offset.top - $(window).scrollTop() + 3;\n\n            // update css\n            $(\"#btn_viz\").css({\n                position: \"fixed\",\n                top: `${top}px`,\n                left: `${left}px`\n            });\n            $(\"#btn_viz\").off(\"click\");\n            $(\"#btn_viz\").click(() => {\n                self.frame.add({\n                    title: _l(\"Trackster\"),\n                    url: `${self.url_viz}/trackster?${$.param(btn_viz_pars)}`\n                });\n            });\n\n            // show the button\n            $(\"#btn_viz\").show();\n        } else {\n            // hide the button\n            $(\"#btn_viz\").hide();\n        }\n    },\n\n    /** hide button */\n    hide: function() {\n        this.$(\"#btn_viz\").hide();\n    }\n});\n\n/**\n * Create a tabular dataset chunked view (and requisite tabular dataset model)\n * and appends to parent_elt.\n */\nexport var createTabularDatasetChunkedView = options => {\n    // If no model, create and set model from dataset config.\n    if (!options.model) {\n        options.model = new TabularDataset(options.dataset_config);\n    }\n\n    var parent_elt = options.parent_elt;\n    var embedded = options.embedded;\n\n    // Clean up options so that only needed options are passed to view.\n    delete options.embedded;\n    delete options.parent_elt;\n    delete options.dataset_config;\n\n    // Create and set up view.\n    var view = embedded\n        ? new EmbeddedTabularDatasetChunkedView(options)\n        : new TopLevelTabularDatasetChunkedView(options);\n    view.render();\n\n    if (parent_elt) {\n        parent_elt.append(view.$el);\n        // If we're sticking this in another element, once it's appended check\n        // to make sure we've filled enough space.\n        // Without this, the scroll elements don't work.\n        view.expand_to_container();\n    }\n\n    return view;\n};\n","import jQuery from \"jquery\";\nimport _ from \"underscore\";\n\nvar $ = jQuery;\n//============================================================================\n/** Returns a jQuery object containing a clickable font-awesome button.\n *      options:\n *          tooltipConfig   : option map for bootstrap tool tip\n *          classes         : array of class names (will always be classed as icon-btn)\n *          disabled        : T/F - add the 'disabled' class?\n *          title           : tooltip/title string\n *          target          : optional href target\n *          href            : optional href\n *          faIcon          : which font awesome icon to use\n *          onclick         : function to call when the button is clicked\n */\nvar faIconButton = options => {\n    options = options || {};\n    options.tooltipConfig = options.tooltipConfig || {\n        placement: \"bottom\"\n    };\n\n    options.classes = [\"icon-btn\"].concat(options.classes || []);\n    if (options.disabled) {\n        options.classes.push(\"disabled\");\n    }\n\n    var html = [\n        '<a class=\"',\n        options.classes.join(\" \"),\n        '\"',\n        options.title ? ` title=\"${options.title}\"` : \"\",\n        !options.disabled && options.target ? ` target=\"${options.target}\"` : \"\",\n        ' href=\"',\n        !options.disabled && options.href ? options.href : \"javascript:void(0);\",\n        '\">',\n        // could go with something less specific here - like 'html'\n        '<span class=\"fa ',\n        options.faIcon,\n        '\"></span>',\n        \"</a>\"\n    ].join(\"\");\n    var $button = $(html).tooltip(options.tooltipConfig);\n    if (_.isFunction(options.onclick)) {\n        $button.click(function(ev) {\n            $button.tooltip(\"hide\");\n            $button\n                .parent()\n                .attr(\"tabindex\", -1)\n                .focus();\n            options.onclick.apply(this, arguments);\n        });\n    }\n    return $button;\n};\n\n//============================================================================\nexport default faIconButton;\n","/**\n    This class creates a form input element wrapper\n*/\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nexport default Backbone.View.extend({\n    initialize: function(app, options) {\n        this.app = app;\n        this.app_options = app.model ? app.model.attributes : {};\n        this.field = (options && options.field) || new Backbone.View();\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                text_enable: this.app_options.text_enable || \"Enable\",\n                text_disable: this.app_options.text_disable || \"Disable\",\n                text_connected_enable: this.app_options.text_connected_enable || \"Add connection to module\",\n                text_connected_disable: this.app_options.text_connected_disable || \"Remove connection from module\",\n                cls_enable: this.app_options.cls_enable || \"fa fa-caret-square-o-down\",\n                cls_disable: this.app_options.cls_disable || \"fa fa-caret-square-o-up\",\n                always_refresh: this.app_options.always_refresh\n            }).set(options);\n\n        // set element and link components\n        this.setElement(this._template());\n        this.$field = this.$(\".ui-form-field\");\n        this.$info = this.$(\".ui-form-info\");\n        this.$preview = this.$(\".ui-form-preview\");\n        this.$collapsible = this.$(\".ui-form-collapsible\");\n        this.$collapsible_text = this.$(\".ui-form-collapsible-text\");\n        this.$collapsible_icon = this.$(\".ui-form-collapsible-icon\");\n        this.$connected_icon = this.$(\".ui-form-connected-icon\");\n        this.$title = this.$(\".ui-form-title\");\n        this.$title_text = this.$(\".ui-form-title-text\");\n        this.$error_text = this.$(\".ui-form-error-text\");\n        this.$error = this.$(\".ui-form-error\");\n        this.$backdrop = this.$(\".ui-form-backdrop\");\n\n        // add field element\n        this.$field.prepend(this.field.$el);\n\n        // decide wether to expand or collapse fields\n        var collapsible_value = this.model.get(\"collapsible_value\");\n        var value = JSON.stringify(this.model.get(\"value\"));\n        this.field.connected = value == JSON.stringify({ __class__: \"ConnectedValue\" });\n        this.field.collapsed =\n            this.field.connected ||\n            (collapsible_value !== undefined &&\n                JSON.stringify(this.model.get(\"value\")) == JSON.stringify(collapsible_value));\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n\n        // add click handler\n        var self = this;\n        this.$collapsible_icon.on(\"click\", () => {\n            self.field.collapsed = !self.field.collapsed;\n            self.field.connected = false;\n            app.trigger && app.trigger(\"change\");\n            self.render();\n        });\n        this.$connected_icon.on(\"click\", () => {\n            self.field.connected = !self.field.connected;\n            self.field.collapsed = self.field.connected;\n            app.trigger && app.trigger(\"change\");\n            self.render();\n        });\n\n        // hide error on value change\n        if (this.field.model && !this.model.get(\"always_refresh\")) {\n            this.listenTo(this.field.model, \"change:value\", () => {\n                self.reset();\n            });\n        }\n\n        // add error listener\n        if (this.field.model) {\n            this.listenTo(this.field.model, \"error\", message => {\n                if (message) {\n                    this.error(message);\n                } else {\n                    this.reset();\n                }\n            });\n        }\n    },\n\n    /** Set backdrop for input element */\n    backdrop: function() {\n        this.model.set(\"backdrop\", true);\n    },\n\n    /** Set error text */\n    error: function(text) {\n        this.model.set(\"error_text\", text);\n    },\n\n    /** Reset this view */\n    reset: function() {\n        !this.model.get(\"fixed\") && this.model.set(\"error_text\", null);\n    },\n\n    render: function() {\n        // render help\n        $(\".tooltip\").hide();\n        var help_text = this.model.get(\"help\", \"\");\n        var help_argument = this.model.get(\"argument\");\n        if (help_argument && help_text.indexOf(`(${help_argument})`) == -1) {\n            help_text += ` (${help_argument})`;\n        }\n        this.$info.html(help_text);\n        // render visibility\n        this.$el[this.model.get(\"hidden\") ? \"hide\" : \"show\"]();\n        // render preview view for collapsed fields\n        // allow at least newlines to render properly after escape\n        const html = _.escape(this.model.get(\"text_value\")).replace(/\\n/g, \"<br />\");\n        this.$preview[\n            (this.field.collapsed && this.model.get(\"collapsible_preview\")) || this.model.get(\"disabled\")\n                ? \"show\"\n                : \"hide\"\n        ]().html(html);\n        // render error messages\n        var error_text = this.model.get(\"error_text\");\n        this.$error[error_text ? \"show\" : \"hide\"]();\n        this.$el[error_text ? \"addClass\" : \"removeClass\"](\"alert alert-danger\");\n        this.$error_text.html(error_text);\n        // render backdrop\n        this.$backdrop[this.model.get(\"backdrop\") ? \"show\" : \"hide\"]();\n        // render input field\n        this.field.collapsed || this.model.get(\"disabled\") ? this.$field.hide() : this.$field.show();\n        // render input field color and style\n        this.field.model &&\n            this.field.model.set({\n                color: this.model.get(\"color\"),\n                style: this.model.get(\"style\")\n            });\n        // render collapsible options\n        const connected = this.field.connected;\n        const collapsible =\n            !this.field.collapsible_disabled &&\n            !this.model.get(\"disabled\") &&\n            this.model.get(\"collapsible_value\") !== undefined;\n        const connectable = collapsible && this.model.get(\"connectable\");\n        if (collapsible || connectable) {\n            var collapsible_state = this.field.collapsed ? \"enable\" : \"disable\";\n            this.$title_text.hide();\n            this.$collapsible.show();\n            this.$collapsible_text.text(this.model.get(\"label\"));\n            if (collapsible && !connected) {\n                this.$collapsible_icon\n                    .removeClass()\n                    .addClass(\"icon ui-form-collapsible-icon\")\n                    .addClass(this.model.get(`cls_${collapsible_state}`))\n                    .tooltip(\"dispose\")\n                    .attr(\"data-original-title\", this.model.get(`text_${collapsible_state}`))\n                    .tooltip({ placement: \"bottom\" })\n                    .show();\n            } else {\n                this.$collapsible_icon.hide();\n            }\n            if (connectable) {\n                const connected_icon_style = this.field.connected ? \"fa fa-times\" : \"fa fa-arrows-h\";\n                const connected_icon_margin = !connected && collapsible ? \"ml-1\" : \"\";\n                const connected_collapsible_state = this.field.connected ? \"disable\" : \"enable\";\n                this.$connected_icon\n                    .removeClass()\n                    .addClass(\"icon ui-form-connected-icon\")\n                    .addClass(connected_icon_style)\n                    .addClass(connected_icon_margin)\n                    .tooltip(\"dispose\")\n                    .attr(\"data-original-title\", this.model.get(`text_connected_${connected_collapsible_state}`))\n                    .tooltip({ placement: \"bottom\" })\n                    .show();\n            } else {\n                this.$connected_icon.hide();\n            }\n        } else {\n            this.$title_text.show().text(this.model.get(\"label\"));\n            this.$collapsible.hide();\n        }\n    },\n\n    _template: function() {\n        return $(\"<div/>\")\n            .addClass(\"ui-form-element\")\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-error\")\n                    .append($(\"<span/>\").addClass(\"fa fa-arrow-down mr-1\"))\n                    .append($(\"<span/>\").addClass(\"ui-form-error-text\"))\n            )\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-title\")\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"ui-form-collapsible\")\n                            .append($(\"<i/>\").addClass(\"ui-form-collapsible-icon\"))\n                            .append($(\"<i/>\").addClass(\"ui-form-connected-icon\"))\n                            .append($(\"<span/>\").addClass(\"ui-form-collapsible-text ml-1\"))\n                    )\n                    .append($(\"<span/>\").addClass(\"ui-form-title-text\"))\n            )\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-field\")\n                    .append($(\"<span/>\").addClass(\"ui-form-info form-text text-muted mt-2\"))\n                    .append($(\"<div/>\").addClass(\"ui-form-backdrop\"))\n            )\n            .append($(\"<div/>\").addClass(\"ui-form-preview\"));\n    }\n});\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Select from \"mvc/ui/ui-select-default\";\nimport { getGalaxyInstance } from \"app\";\n\n/** Batch mode variations */\nvar Batch = { DISABLED: \"disabled\", ENABLED: \"enabled\", LINKED: \"linked\" };\n\n/** List of available content selectors options */\nvar Configurations = {\n    data: [\n        {\n            src: \"hda\",\n            icon: \"fa-file-o\",\n            tooltip: _l(\"Single dataset\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        },\n        {\n            src: \"hda\",\n            icon: \"fa-files-o\",\n            tooltip: _l(\"Multiple datasets\"),\n            multiple: true,\n            batch: Batch.LINKED\n        },\n        {\n            src: \"hdca\",\n            icon: \"fa-folder-o\",\n            tooltip: _l(\"Dataset collection\"),\n            multiple: false,\n            batch: Batch.LINKED\n        }\n    ],\n    data_multiple: [\n        {\n            src: \"hda\",\n            icon: \"fa-files-o\",\n            tooltip: _l(\"Multiple datasets\"),\n            multiple: true,\n            batch: Batch.DISABLED\n        },\n        {\n            src: \"hdca\",\n            icon: \"fa-folder-o\",\n            tooltip: _l(\"Dataset collections\"),\n            multiple: true,\n            batch: Batch.DISABLED\n        }\n    ],\n    data_collection: [\n        {\n            src: \"hdca\",\n            icon: \"fa-folder-o\",\n            tooltip: _l(\"Dataset collection\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        }\n    ],\n    workflow_data: [\n        {\n            src: \"hda\",\n            icon: \"fa-file-o\",\n            tooltip: _l(\"Single dataset\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        }\n    ],\n    workflow_data_multiple: [\n        {\n            src: \"hda\",\n            icon: \"fa-files-o\",\n            tooltip: _l(\"Multiple datasets\"),\n            multiple: true,\n            batch: Batch.DISABLED\n        }\n    ],\n    workflow_data_collection: [\n        {\n            src: \"hdca\",\n            icon: \"fa-folder-o\",\n            tooltip: _l(\"Dataset collection\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        }\n    ],\n    module_data: [\n        {\n            src: \"hda\",\n            icon: \"fa-file-o\",\n            tooltip: _l(\"Single dataset\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        },\n        {\n            src: \"hda\",\n            icon: \"fa-files-o\",\n            tooltip: _l(\"Multiple datasets\"),\n            multiple: true,\n            batch: Batch.ENABLED\n        }\n    ],\n    module_data_collection: [\n        {\n            src: \"hdca\",\n            icon: \"fa-folder-o\",\n            tooltip: _l(\"Dataset collection\"),\n            multiple: false,\n            batch: Batch.DISABLED\n        },\n        {\n            src: \"hdca\",\n            icon: \"fa-folder\",\n            tooltip: _l(\"Multiple collections\"),\n            multiple: true,\n            batch: Batch.ENABLED\n        }\n    ]\n};\n\n/** View for hda and hdca content selector ui elements */\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                src_labels: { hda: \"dataset\", hdca: \"dataset collection\" },\n                pagelimit: 100,\n                statustimer: 1000\n            }).set(options);\n        this.setElement($(\"<div/>\").addClass(\"ui-select-content\"));\n        this.button_product = new Ui.RadioButton.View({\n            value: \"false\",\n            data: [\n                {\n                    icon: \"fa fa-chain\",\n                    value: \"false\",\n                    tooltip:\n                        \"Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads.\"\n                },\n                {\n                    icon: \"fa fa-chain-broken\",\n                    value: \"true\",\n                    tooltip: \"Unlinked dataset inputs will be run against *all* other inputs.\"\n                }\n            ]\n        });\n        var $batch_div = $(\"<div/>\")\n            .addClass(\"form-text text-muted\")\n            .append($(\"<i/>\").addClass(\"fa fa-sitemap\"))\n            .append(\n                $(\"<span/>\").html(\n                    \"This is a batch mode input field. Separate jobs will be triggered for each dataset selection.\"\n                )\n            );\n        this.$batch = {\n            linked: $batch_div.clone(),\n            enabled: $batch_div\n                .clone()\n                .append(\n                    $(\"<div/>\")\n                        .append(\n                            $(\"<div/>\")\n                                .addClass(\"ui-form-title\")\n                                .html(\"Batch options:\")\n                        )\n                        .append(this.button_product.$el)\n                )\n                .append($(\"<div/>\").css(\"clear\", \"both\"))\n        };\n\n        // add drag-drop event handlers\n        let element = this.$el.get(0);\n        element.addEventListener(\"dragenter\", e => {\n            this.lastenter = e.target;\n            self.$el.addClass(\"ui-dragover\");\n        });\n        element.addEventListener(\"dragover\", e => {\n            e.preventDefault();\n        });\n        element.addEventListener(\"dragleave\", e => {\n            this.lastenter === e.target && self.$el.removeClass(\"ui-dragover\");\n        });\n        element.addEventListener(\"drop\", e => {\n            self._handleDrop(e);\n        });\n\n        // track current history elements\n        this.history = {};\n\n        // add listeners\n        this.listenTo(this.model, \"change:data\", this._changeData, this);\n        this.listenTo(this.model, \"change:wait\", this._changeWait, this);\n        this.listenTo(this.model, \"change:current\", this._changeCurrent, this);\n        this.listenTo(this.model, \"change:value\", this._changeValue, this);\n        this.listenTo(\n            this.model,\n            \"change:type change:optional change:multiple change:extensions\",\n            this._changeType,\n            this\n        );\n        this.render();\n\n        // add change event\n        this.on(\"change\", () => {\n            options.onchange && options.onchange(self.value());\n        });\n    },\n\n    render: function() {\n        this._changeType();\n        this._changeValue();\n        this._changeWait();\n    },\n\n    /** Indicate that select fields are being updated */\n    wait: function() {\n        this.model.set(\"wait\", true);\n    },\n\n    /** Indicate that the options update has been completed */\n    unwait: function() {\n        this.model.set(\"wait\", false);\n    },\n\n    /** Update data representing selectable options */\n    update: function(input_def) {\n        this.model.set(\"data\", input_def.options);\n    },\n\n    /** Return the currently selected dataset values */\n    value: function(new_value) {\n        let Galaxy = getGalaxyInstance();\n        new_value !== undefined && this.model.set(\"value\", new_value);\n        var current = this.model.get(\"current\");\n        if (this.config[current]) {\n            var id_list = this.fields[current].value();\n            if (id_list !== null) {\n                id_list = $.isArray(id_list) ? id_list : [id_list];\n                if (id_list.length > 0) {\n                    var result = this._batch({ values: [] });\n                    for (var i in id_list) {\n                        var details = this.history[`${id_list[i]}_${this.config[current].src}`];\n                        if (details) {\n                            result.values.push(details);\n                        } else {\n                            Galaxy.emit.debug(\n                                \"ui-select-content::value()\",\n                                `Requested details not found for '${id_list[i]}'.`\n                            );\n                            return null;\n                        }\n                    }\n                    result.values.sort((a, b) => a.hid - b.hid);\n                    return result;\n                }\n            }\n        } else {\n            Galaxy.emit.debug(\"ui-select-content::value()\", `Invalid value/source '${new_value}'.`);\n        }\n        return null;\n    },\n\n    /** Change of current select field */\n    _changeCurrent: function() {\n        var self = this;\n        _.each(this.fields, (field, i) => {\n            if (self.model.get(\"current\") == i) {\n                field.$el.show();\n                _.each(self.$batch, ($batchfield, batchmode) => {\n                    $batchfield[self.config[i].batch == batchmode ? \"show\" : \"hide\"]();\n                });\n                self.button_type.value(i);\n            } else {\n                field.$el.hide();\n            }\n        });\n    },\n\n    /** Change of type */\n    _changeType: function() {\n        let Galaxy = getGalaxyInstance();\n        var self = this;\n\n        // identify selector type identifier i.e. [ flavor ]_[ type ]_[ multiple ]\n        var config_id =\n            (this.model.get(\"flavor\") ? `${this.model.get(\"flavor\")}_` : \"\") +\n            String(this.model.get(\"type\")) +\n            (this.model.get(\"multiple\") ? \"_multiple\" : \"\");\n        if (Configurations[config_id]) {\n            this.config = Configurations[config_id];\n        } else {\n            this.config = Configurations[\"data\"];\n            Galaxy.emit.debug(\"ui-select-content::_changeType()\", `Invalid configuration/type id '${config_id}'.`);\n        }\n\n        // prepare extension component of error message\n        var data = self.model.get(\"data\");\n        var extensions = Utils.textify(this.model.get(\"extensions\"));\n        var src_labels = this.model.get(\"src_labels\");\n\n        // build views\n        this.fields = [];\n        this.button_data = [];\n        _.each(this.config, (c, i) => {\n            self.button_data.push({\n                value: i,\n                icon: c.icon,\n                tooltip: c.tooltip\n            });\n            self.fields.push(\n                new Select.View({\n                    optional: self.model.get(\"optional\"),\n                    multiple: c.multiple,\n                    searchable:\n                        !c.multiple || (data && data[c.src] && data[c.src].length > self.model.get(\"pagelimit\")),\n                    individual: true,\n                    error_text: `No ${extensions ? `${extensions} ` : \"\"}${src_labels[c.src] || \"content\"} available.`,\n                    onchange: function() {\n                        self.trigger(\"change\");\n                    }\n                })\n            );\n        });\n        this.button_type = new Ui.RadioButton.View({\n            value: this.model.get(\"current\"),\n            data: this.button_data,\n            onchange: function(value) {\n                self.model.set(\"current\", value);\n                self.trigger(\"change\");\n            }\n        });\n\n        // append views\n        this.$el.empty();\n        var button_width = 0;\n        if (this.fields.length > 1) {\n            this.$el.append(this.button_type.$el);\n            button_width = `${Math.max(0, this.fields.length * 40)}px`;\n        }\n        _.each(this.fields, field => {\n            self.$el.append(field.$el.css({ \"margin-left\": button_width }));\n        });\n        _.each(this.$batch, ($batchfield, batchmode) => {\n            self.$el.append($batchfield.css({ \"margin-left\": button_width }));\n        });\n        this.model.set(\"current\", 0);\n        this._changeCurrent();\n        this._changeData();\n    },\n\n    /** Change of wait flag */\n    _changeWait: function() {\n        var self = this;\n        _.each(this.fields, field => {\n            field[self.model.get(\"wait\") ? \"wait\" : \"unwait\"]();\n        });\n    },\n\n    /** Change of available options */\n    _changeData: function() {\n        var options = this.model.get(\"data\");\n        var self = this;\n        var select_options = {};\n        _.each(options, (items, src) => {\n            select_options[src] = [];\n            _.each(items, item => {\n                select_options[src].push({\n                    hid: item.hid,\n                    keep: item.keep,\n                    label: `${item.hid}: ${item.name}`,\n                    value: item.id,\n                    tags: item.tags\n                });\n                self.history[`${item.id}_${src}`] = item;\n            });\n        });\n        _.each(this.config, (c, i) => {\n            select_options[c.src] && self.fields[i].add(select_options[c.src], (a, b) => b.hid - a.hid);\n        });\n    },\n\n    /** Change of incoming value */\n    _changeValue: function() {\n        var new_value = this.model.get(\"value\");\n        if (new_value && new_value.values && new_value.values.length > 0) {\n            // create list with content ids\n            var list = [];\n            _.each(new_value.values, value => {\n                list.push(value.id);\n            });\n            // sniff first suitable field type from config list\n            var src = new_value.values[0].src;\n            var multiple = new_value.values.length > 1;\n            for (var i = 0; i < this.config.length; i++) {\n                var field = this.fields[i];\n                var c = this.config[i];\n                if (c.src == src && [multiple, true].indexOf(c.multiple) !== -1) {\n                    this.model.set(\"current\", i);\n                    field.value(list);\n                    break;\n                }\n            }\n        } else {\n            _.each(this.fields, field => {\n                field.value(null);\n            });\n        }\n    },\n\n    /** Handles drop events e.g. from history panel */\n    _handleDrop: function(ev) {\n        try {\n            var data = this.model.get(\"data\");\n            var current = this.model.get(\"current\");\n            var config = this.config[current];\n            var field = this.fields[current];\n            var drop_data = JSON.parse(ev.dataTransfer.getData(\"text\"))[0];\n            var new_id = drop_data.id;\n            var new_src = drop_data.history_content_type == \"dataset_collection\" ? \"hdca\" : \"hda\";\n            var new_value = { id: new_id, src: new_src };\n            if (data && drop_data.history_id) {\n                if (!_.findWhere(data[new_src], new_value)) {\n                    data[new_src].push({\n                        id: new_id,\n                        src: new_src,\n                        hid: drop_data.hid || \"Dropped\",\n                        name: drop_data.hid ? drop_data.name : new_id,\n                        keep: true,\n                        tags: []\n                    });\n                    this._changeData();\n                }\n                if (config.src == new_src) {\n                    var current_value = field.value();\n                    if (current_value && config.multiple) {\n                        if (current_value.indexOf(new_id) == -1) {\n                            current_value.push(new_id);\n                        }\n                    } else {\n                        current_value = new_id;\n                    }\n                    field.value(current_value);\n                } else {\n                    this.model.set(\"value\", { values: [new_value] });\n                    this.model.trigger(\"change:value\");\n                }\n                this.trigger(\"change\");\n                this._handleDropStatus(\"success\");\n            } else {\n                this._handleDropStatus(\"danger\");\n            }\n        } catch (e) {\n            this._handleDropStatus(\"danger\");\n        }\n        ev.preventDefault();\n    },\n\n    /** Highlight drag result */\n    _handleDropStatus: function(status) {\n        var self = this;\n        this.$el.removeClass(\"ui-dragover\").addClass(`ui-dragover-${status}`);\n        setTimeout(() => {\n            self.$el.removeClass(`ui-dragover-${status}`);\n        }, this.model.get(\"statustimer\"));\n    },\n\n    /** Assists in identifying the batch mode */\n    _batch: function(result) {\n        result[\"batch\"] = false;\n        var current = this.model.get(\"current\");\n        var config = this.config[current];\n        if (config.src == \"hdca\") {\n            var hdca = this.history[`${this.fields[current].value()}_hdca`];\n            if (hdca && hdca.map_over_type) {\n                result[\"batch\"] = true;\n            }\n        }\n        if (config.batch == Batch.LINKED || config.batch == Batch.ENABLED) {\n            result[\"batch\"] = true;\n            if (config.batch == Batch.ENABLED && this.button_product.value() === \"true\") {\n                result[\"product\"] = true;\n            }\n        }\n        return result;\n    }\n});\n\nexport default {\n    View: View\n};\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.options = options;\n        this.name = options.name || \"element\";\n        this.multiple = options.multiple || false;\n\n        // create message handler\n        this.message = new Ui.Message({ cls: \"col mb-0\" });\n\n        // create selections area\n        this.selections = $(\"<div/>\");\n\n        // create select field containing the options which can be inserted into the list\n        this.select = new Ui.Select.View({ optional: options.optional });\n\n        // create insert new list element button\n        this.$button = $(`<button class=\"fa fa-sign-in\"/>`);\n        this.$button.on(\"click\", () => {\n            this.add({\n                id: this.select.value(),\n                name: this.select.text()\n            });\n        });\n\n        // build main element\n        this.setElement(this._template(options));\n        this.$(\".ui-list-message\").append(this.message.$el);\n        this.$(\".ui-list-selections\").append(this.selections);\n        this.$(\".ui-list-button\").append(this.$button);\n        this.$(\".ui-list-select\").append(this.select.$el);\n    },\n\n    /** Return/Set currently selected list elements */\n    value: function(val) {\n        // set new value\n        if (val !== undefined) {\n            this.selections.empty();\n            if ($.isArray(val)) {\n                for (var i in val) {\n                    var v = val[i];\n                    var v_id = null;\n                    var v_name = null;\n                    if ($.type(v) != \"string\") {\n                        v_id = v.id;\n                        v_name = v.name;\n                    } else {\n                        v_id = v_name = v;\n                    }\n                    if (v_id != null) {\n                        this.add({\n                            id: v_id,\n                            name: v_name\n                        });\n                    }\n                }\n            }\n            this._refresh();\n        }\n        // get current value\n        var lst = [];\n        this.$(\".ui-list-id\").each(function() {\n            lst.push({\n                id: $(this).prop(\"id\"),\n                name: $(this)\n                    .find(\".ui-list-name\")\n                    .html()\n            });\n        });\n        if (lst.length == 0) {\n            return null;\n        }\n        return lst;\n    },\n\n    /** Add row */\n    add: function(options) {\n        var self = this;\n        if (this.$(`[id=\"${options.id}\"]`).length === 0) {\n            if (!Utils.isEmpty(options.id)) {\n                var $el = $(\n                    this._templateRow({\n                        id: options.id,\n                        name: options.name\n                    })\n                );\n                $el.find(\"button\").on(\"click\", () => {\n                    $el.remove();\n                    self._refresh();\n                });\n                this.selections.append($el);\n                this._refresh();\n            } else {\n                this.message.update({\n                    message: `Please select a valid ${this.name}.`,\n                    status: \"danger\"\n                });\n            }\n        } else {\n            this.message.update({\n                message: `This ${this.name} is already in the list.`\n            });\n        }\n    },\n\n    /** Update available options */\n    update: function(input_def) {\n        this.select.update(input_def);\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        if (this.$(\".ui-list-id\").length > 0) {\n            !this.multiple && this.$button.attr(\"disabled\", true);\n        } else {\n            this.$button.attr(\"disabled\", false);\n        }\n        this.options.onchange && this.options.onchange();\n    },\n\n    /** Main Template */\n    _template: function(options) {\n        return `<div class=\"ui-list container\">\n                    <div class=\"row\">\n                        <div class=\"col-1 pl-0 mb-2\">\n                            <div class=\"ui-list-button\"/>\n                        </div>\n                        <div class=\"ui-list-select col pr-0\"/>\n                    </div>\n                    <div class=\"ui-list-message mt-2 row\"/>\n                    <div class=\"ui-list-selections mt-2\"/>\n                </div>`;\n    },\n\n    /** Row Template */\n    _templateRow: function(options) {\n        return `<div id=\"${options.id}\" class=\"ui-list-id row mt-2\">\n                    <button class=\"ui-list-delete fa fa-trash mr-3\"/>\n                    <div class=\"ui-list-name\">${options.name}</span>\n                </div>`;\n    }\n});\n\nexport default {\n    View: View\n};\n","// dependencies\nimport Backbone from \"backbone\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport List from \"mvc/ui/ui-list\";\nimport { getAppRoot } from \"onload/loadConfig\";\n\n// collection of libraries\nvar Libraries = Backbone.Collection.extend({\n    url: `${getAppRoot()}api/libraries?deleted=false`\n});\n\n// collection of dataset\nvar LibraryDatasets = Backbone.Collection.extend({\n    initialize: function() {\n        var self = this;\n        this.config = new Backbone.Model({ library_id: null });\n        this.config.on(\"change\", () => {\n            self.fetch({ reset: true });\n        });\n    },\n    url: function() {\n        return `${getAppRoot()}api/libraries/${this.config.get(\"library_id\")}/contents`;\n    }\n});\n\n// hda/hdca content selector ui element\nvar View = Backbone.View.extend({\n    // initialize\n    initialize: function(options) {\n        // link this\n        var self = this;\n\n        // collections\n        this.libraries = new Libraries();\n        this.datasets = new LibraryDatasets();\n\n        // link app and options\n        this.options = options;\n\n        // select field for the library\n        // TODO: Remove this once the library API supports searching for library datasets\n        this.library_select = new Ui.Select.View({\n            onchange: function(value) {\n                self.datasets.config.set(\"library_id\", value);\n            }\n        });\n\n        // create ui-list view to keep track of selected data libraries\n        this.dataset_list = new List.View({\n            name: \"dataset\",\n            optional: options.optional,\n            multiple: options.multiple,\n            onchange: function() {\n                self.trigger(\"change\");\n            }\n        });\n\n        // add reset handler for fetched libraries\n        this.libraries.on(\"reset\", () => {\n            var data = [];\n            self.libraries.each(model => {\n                data.push({\n                    value: model.id,\n                    label: model.get(\"name\")\n                });\n            });\n            self.library_select.update({ data: data });\n        });\n\n        // add reset handler for fetched library datasets\n        this.datasets.on(\"reset\", () => {\n            var data = [];\n            var library_current = self.library_select.text();\n            if (library_current !== null) {\n                self.datasets.each(model => {\n                    if (model.get(\"type\") === \"file\") {\n                        data.push({\n                            value: model.id,\n                            label: model.get(\"name\")\n                        });\n                    }\n                });\n            }\n            self.dataset_list.update({ data: data });\n        });\n\n        // add change event. fires on trigger\n        this.on(\"change\", () => {\n            if (options.onchange) {\n                options.onchange(self.value());\n            }\n        });\n\n        // create elements\n        this.setElement(this._template());\n        this.$(\".library-select\").append(this.library_select.$el);\n        this.$el.append(this.dataset_list.$el);\n\n        // initial fetch of libraries\n        this.libraries.fetch({\n            reset: true,\n            success: function() {\n                self.library_select.trigger(\"change\");\n                if (self.options.value !== undefined) {\n                    self.value(self.options.value);\n                }\n            }\n        });\n    },\n\n    /** Return/Set currently selected library datasets */\n    value: function(val) {\n        return this.dataset_list.value(val);\n    },\n\n    /** Template */\n    _template: function() {\n        return `<div class=\"ui-select-library\">\n                    <div class=\"library-select mb-2\"/>\n                </div>`;\n    }\n});\n\nexport default {\n    View: View\n};\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\nimport List from \"mvc/ui/ui-list\";\n\n/**\n * FTP file selector\n */\nvar View = Backbone.View.extend({\n    // initialize\n    initialize: function(options) {\n        // link this\n        var self = this;\n\n        // create ui-list view to keep track of selected ftp files\n        this.ftpfile_list = new List.View({\n            name: \"file\",\n            optional: options.optional,\n            multiple: options.multiple,\n            onchange: function() {\n                options.onchange && options.onchange(self.value());\n            }\n        });\n\n        // create elements\n        this.setElement(this.ftpfile_list.$el);\n\n        // initial fetch of ftps\n        Utils.get({\n            url: `${getAppRoot()}api/remote_files`,\n            success: function(response) {\n                var data = [];\n                for (var i in response) {\n                    data.push({\n                        value: response[i][\"path\"],\n                        label: response[i][\"path\"]\n                    });\n                }\n                self.ftpfile_list.update(data);\n            }\n        });\n    },\n\n    /** Return/Set currently selected ftp datasets */\n    value: function(val) {\n        return this.ftpfile_list.value(val);\n    }\n});\n\nexport default {\n    View: View\n};\n","// Provides support for interacting with the GenomeSpace File Browser popup dialogue\nimport { getGalaxyInstance } from \"app\";\n\n// tool form templates\nexport default {\n    openFileBrowser: function(options) {\n        let Galaxy = getGalaxyInstance();\n        var GS_UI_URL = Galaxy.config.genomespace_ui_url;\n        var GS_UPLOAD_URL = `${GS_UI_URL}upload/loadUrlToGenomespace.html?getLocation=true`;\n\n        var newWin = window.open(GS_UPLOAD_URL, \"GenomeSpace File Browser\", \"height=360px,width=600px\");\n\n        window.addEventListener(\n            \"message\",\n            e => {\n                if (options.successCallback && e.data.destination) {\n                    options.successCallback(e.data);\n                }\n            },\n            false\n        );\n\n        newWin.focus();\n\n        if (options[\"errorCallback\"] != null) newWin.setCallbackOnGSUploadError = Galaxy.config[\"errorCallback\"];\n    }\n};\n","import Backbone from \"backbone\";\nimport _l from \"utils/localization\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport GenomespaceBrowser from \"mvc/tool/tool-genomespace\";\n/**\n * GenomeSpace file selector\n */\nvar View = Backbone.View.extend({\n    // initialize\n    initialize: function(options) {\n        // link this\n        var self = this;\n        this.options = options;\n\n        // create insert new list element button\n        this.browse_button = new Ui.Button({\n            title: _l(\"Browse\"),\n            icon: \"fa fa-sign-in\",\n            cls: \"btn btn-secondary float-left\",\n            tooltip: _l(\"Browse GenomeSpace\"),\n            onclick: function() {\n                self.browseGenomeSpace(options);\n            }\n        });\n\n        // create genomespace filepath textbox\n        this.filename_textbox = new Ui.Input();\n\n        // create elements\n        this.setElement(this._template(options));\n        this.$(\".ui-browse-button\").append(this.browse_button.$el);\n        this.$(\".ui-filename-textbox\").append(this.filename_textbox.$el);\n    },\n\n    /** Browse GenomeSpace */\n    browseGenomeSpace: function(options) {\n        var self = this;\n        GenomespaceBrowser.openFileBrowser({\n            successCallback: function(data) {\n                self.value(data.destination);\n            }\n        });\n    },\n\n    /** Main Template */\n    _template: function(options) {\n        return `<div class=\"row\">\n                    <div class=\"ui-browse-button col-3\" />\n                    <div class=\"ui-filename-textbox col\"/>\n                </div>`;\n    },\n\n    /** Return/Set currently selected genomespace filename */\n    value: function(new_value) {\n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        } else {\n            return this._getValue();\n        }\n    },\n\n    // get value\n    _getValue: function() {\n        return this.filename_textbox.value();\n    },\n\n    // set value\n    _setValue: function(new_value) {\n        if (new_value) {\n            this.filename_textbox.value(new_value);\n        }\n        this.options.onchange && this.options.onchange(new_value);\n    }\n});\n\nexport default {\n    View: View\n};\n","<template>\n    <div>\n        <ol class=\"rules\">\n            <rule-display-preview\n                v-for=\"(rule, index) in rules\"\n                v-bind:rule=\"rule\"\n                v-bind:index=\"index\"\n                v-bind:key=\"index\"\n                :col-headers=\"columnData.colHeadersPerRule[index]\"\n            />\n            <identifier-display-preview\n                v-for=\"(map, index) in mapping\"\n                v-bind=\"map\"\n                v-bind:index=\"index\"\n                v-bind:key=\"map.type\"\n                :col-headers=\"colHeaders\"\n            />\n        </ol>\n    </div>\n</template>\n<script>\nimport RuleDefs from \"mvc/rules/rule-definitions\";\n\n// read-only variants of the components for displaying these rules and mappings in builder widget.\nconst RuleDisplayPreview = {\n    template: `\n        <li class=\"rule\">\n            <span class=\"rule-display\">{{ title }}\n            </span>\n            <span class=\"rule-warning\" v-if=\"rule.warn\">\n                {{ rule.warn }}\n            </span>\n            <span class=\"rule-error\" v-if=\"rule.error\">\n                <span class=\"alert-message\">{{ rule.error }}</span>\n            </span>\n        </li>\n    `,\n    props: {\n        rule: {\n            required: true,\n            type: Object\n        },\n        colHeaders: {\n            type: Array,\n            required: false\n        }\n    },\n    computed: {\n        title() {\n            const ruleType = this.rule.type;\n            return RuleDefs.RULES[ruleType].display(this.rule, this.colHeaders);\n        }\n    },\n    methods: {}\n};\n\nconst IdentifierDisplayPreview = {\n    template: `\n      <li class=\"rule\" :title=\"help\">\n        Set {{ columnsLabel }} as {{ typeDisplay }}\n      </li>\n    `,\n    props: {\n        type: {\n            type: String,\n            required: true\n        },\n        columns: {\n            required: true\n        },\n        colHeaders: {\n            type: Array,\n            required: true\n        }\n    },\n    computed: {\n        typeDisplay() {\n            return RuleDefs.MAPPING_TARGETS[this.type].label;\n        },\n        help() {\n            return RuleDefs.MAPPING_TARGETS[this.type].help || \"\";\n        },\n        columnsLabel() {\n            return RuleDefs.columnDisplay(this.columns, this.colHeaders);\n        }\n    }\n};\n\nexport default {\n    data: function() {\n        return {};\n    },\n    computed: {\n        mapping: function() {\n            return this.inputRules ? this.inputRules.mapping : [];\n        },\n        rules: function() {\n            return this.inputRules ? this.inputRules.rules : [];\n        },\n        columnData: function() {\n            const colHeadersPerRule = [];\n            const hotData = RuleDefs.applyRules([], [], [], this.rules, colHeadersPerRule);\n            return { colHeadersPerRule: colHeadersPerRule, columns: hotData.columns };\n        },\n        colHeaders: function() {\n            const columns = this.columnData.columns;\n            return RuleDefs.colHeadersFor([], columns);\n        }\n    },\n    props: {\n        inputRules: {\n            required: false,\n            type: Object\n        }\n    },\n    components: {\n        RuleDisplayPreview,\n        IdentifierDisplayPreview\n    }\n};\n</script>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--1!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RulesDisplay.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--1!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RulesDisplay.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RulesDisplay.vue?vue&type=template&id=6e2d0020&\"\nimport script from \"./RulesDisplay.vue?vue&type=script&lang=js&\"\nexport * from \"./RulesDisplay.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ol',{staticClass:\"rules\"},[_vm._l((_vm.rules),function(rule,index){return _c('rule-display-preview',{key:index,attrs:{\"rule\":rule,\"index\":index,\"col-headers\":_vm.columnData.colHeadersPerRule[index]}})}),_vm._v(\" \"),_vm._l((_vm.mapping),function(map,index){return _c('identifier-display-preview',_vm._b({key:map.type,attrs:{\"index\":index,\"col-headers\":_vm.colHeaders}},'identifier-display-preview',map,false))})],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport axios from \"axios\";\nimport _l from \"utils/localization\";\n// import Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Vue from \"vue\";\nimport ListCollectionCreator from \"mvc/collection/list-collection-creator\";\nimport RulesDisplay from \"components/RulesDisplay.vue\";\n\n/**\n * Bridge rule based builder and the tool form.\n */\nvar View = Backbone.View.extend({\n    // initialize\n    initialize: function(options) {\n        // link this\n        this.options = options;\n        this.target = options.target;\n        this.reset = null;\n        const view = this;\n\n        // create insert new list element button\n        this.browse_button = new Ui.Button({\n            title: _l(\"Edit\"),\n            icon: \"fa fa-edit\",\n            tooltip: _l(\"Edit Rules\"),\n            onclick: () => {\n                if (view.target) {\n                    view._fetcCollectionAndEdit();\n                } else {\n                    view._showRuleEditor(null);\n                }\n            }\n        });\n\n        // add change event. fires on trigger\n        this.on(\"change\", () => {\n            if (options.onchange) {\n                options.onchange(this.value());\n            }\n        });\n\n        // create elements\n        this.setElement(this._template(options));\n        this.$(\".ui-rules-edit-button\").append(this.browse_button.$el);\n        var rulesDisplayInstance = Vue.extend(RulesDisplay);\n        var vm = document.createElement(\"div\");\n        this.$(\".ui-rules-preview\").append(vm);\n        this.instance = new rulesDisplayInstance({\n            propsData: {\n                initialRules: {\n                    rules: [],\n                    mapping: []\n                }\n            }\n        });\n        this.instance.$mount(vm);\n        this.collapsible_disabled = true;\n    },\n\n    _fetcCollectionAndEdit: function() {\n        const view = this;\n        const url = `${getAppRoot()}api/dataset_collections/${view.target.id}?instance_type=history`;\n        axios\n            .get(url)\n            .then(response => this._showCollection(response))\n            .catch(view._renderFetchError);\n    },\n\n    _showCollection: function(response) {\n        const elements = response.data;\n        this._showRuleEditor(elements);\n    },\n\n    _showRuleEditor: function(elements) {\n        const elementsType = \"collection_contents\";\n        const importType = \"collections\";\n        let value = this._value;\n        const options = {\n            saveRulesFn: rules => this._handleRulesSave(rules),\n            initialRules: value\n        };\n        ListCollectionCreator.ruleBasedCollectionCreatorModal(elements, elementsType, importType, options).done(\n            () => {}\n        );\n    },\n\n    _handleRulesSave: function(rules) {\n        this._setValue(rules);\n    },\n\n    _renderFetchError: function(e) {\n        console.log(e);\n        console.log(\"problem fetching collection\");\n    },\n\n    /** Main Template */\n    _template: function(options) {\n        return `\n            <div class=\"ui-rules-edit clearfix\">\n                <span class=\"ui-rules-preview\" />\n                <span class=\"ui-rules-edit-button float-left\" />\n            </div>\n        `;\n    },\n\n    /** Return/Set currently selected genomespace filename */\n    value: function(new_value) {\n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        } else {\n            return this._getValue();\n        }\n    },\n\n    // update\n    update: function(input_def) {\n        this.target = input_def.target;\n    },\n\n    // get value\n    _getValue: function() {\n        return this._value;\n    },\n\n    // set value\n    _setValue: function(new_value) {\n        if (new_value) {\n            if (typeof new_value == \"string\") {\n                new_value = JSON.parse(new_value);\n            }\n            this._value = new_value;\n            this.trigger(\"change\");\n            this.instance.inputRules = new_value;\n            if (this.reset) {\n                this.reset();\n                this.reset = null;\n            }\n        }\n    },\n\n    validate: function(reset) {\n        const value = this._value;\n        let message = null;\n        if (!value || value.rules.length === 0) {\n            message = \"No rules defined, define at least one rule.\";\n        } else if (value.mapping.length === 0) {\n            message = \"No collection identifiers defined, specify at least one collection identifier.\";\n        } else {\n            for (let rule of value.rules) {\n                if (rule.error) {\n                    message = \"One or more rules in error.\";\n                    break;\n                }\n            }\n        }\n        this.reset = reset;\n        return { valid: !message, message: message };\n    }\n});\n\nexport default {\n    View: View\n};\n","/** Renders the color picker used e.g. in the tool form **/\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\n\nfunction hex(x) {\n    return `0${parseInt(x).toString(16)}`.slice(-2);\n}\n\nexport default Backbone.View.extend({\n    colors: {\n        standard: [\"c00000\", \"ff0000\", \"ffc000\", \"ffff00\", \"92d050\", \"00b050\", \"00b0f0\", \"0070c0\", \"002060\", \"7030a0\"],\n        base: [\"ffffff\", \"000000\", \"eeece1\", \"1f497d\", \"4f81bd\", \"c0504d\", \"9bbb59\", \"8064a2\", \"4bacc6\", \"f79646\"],\n        theme: [\n            [\"f2f2f2\", \"7f7f7f\", \"ddd9c3\", \"c6d9f0\", \"dbe5f1\", \"f2dcdb\", \"ebf1dd\", \"e5e0ec\", \"dbeef3\", \"fdeada\"],\n            [\"d8d8d8\", \"595959\", \"c4bd97\", \"8db3e2\", \"b8cce4\", \"e5b9b7\", \"d7e3bc\", \"ccc1d9\", \"b7dde8\", \"fbd5b5\"],\n            [\"bfbfbf\", \"3f3f3f\", \"938953\", \"548dd4\", \"95b3d7\", \"d99694\", \"c3d69b\", \"b2a2c7\", \"92cddc\", \"fac08f\"],\n            [\"a5a5a5\", \"262626\", \"494429\", \"17365d\", \"366092\", \"953734\", \"76923c\", \"5f497a\", \"31859b\", \"e36c09\"],\n            [\"7f7f7e\", \"0c0c0c\", \"1d1b10\", \"0f243e\", \"244061\", \"632423\", \"4f6128\", \"3f3151\", \"205867\", \"974806\"]\n        ]\n    },\n\n    initialize: function(options) {\n        this.options = Utils.merge(options, {});\n        this.setElement(this._template());\n        this.$panel = this.$(\".ui-color-picker-panel\");\n        this.$view = this.$(\".ui-color-picker-view\");\n        this.$value = this.$(\".ui-color-picker-value\");\n        this.$header = this.$(\".ui-color-picker-header\");\n        this._build();\n        this.visible = false;\n        this.value(this.options.value);\n        this.$boxes = this.$(\".ui-color-picker-box\");\n        var self = this;\n        this.$boxes.on(\"click\", function() {\n            self.value($(this).css(\"background-color\"));\n            self.$header.trigger(\"click\");\n        });\n        this.$header.on(\"click\", () => {\n            self.visible = !self.visible;\n            if (self.visible) {\n                self.$view.fadeIn(\"fast\");\n            } else {\n                self.$view.fadeOut(\"fast\");\n            }\n        });\n    },\n\n    /** Get/set value */\n    value: function(new_val) {\n        if (new_val !== undefined && new_val !== null) {\n            this.$value.css(\"background-color\", new_val);\n            this.$(\".ui-color-picker-box\").empty();\n            this.$(this._getValue()).html(this._templateCheck());\n            this.options.onchange && this.options.onchange(new_val);\n        }\n        return this._getValue();\n    },\n\n    /** Get value from dom */\n    _getValue: function() {\n        var rgb = this.$value.css(\"background-color\");\n        rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n        if (rgb) {\n            return `#${hex(rgb[1])}${hex(rgb[2])}${hex(rgb[3])}`;\n        } else {\n            return null;\n        }\n    },\n\n    /** Build color panel */\n    _build: function() {\n        this._content({ colors: this.colors.base });\n        for (var i in this.colors.theme) {\n            var line_def = {};\n            if (i == 0) {\n                line_def[\"bottom\"] = true;\n            } else if (i != this.colors.theme.length - 1) {\n                line_def[\"top\"] = true;\n                line_def[\"bottom\"] = true;\n            } else {\n                line_def[\"top\"] = true;\n            }\n            line_def[\"colors\"] = this.colors.theme[i];\n            this._content(line_def);\n        }\n        this._content({ colors: this.colors.standard });\n    },\n\n    /** Create content */\n    _content: function(options) {\n        var colors = options.colors;\n        var $content = $(this._templateContent());\n        var $line = $content.find(\".line\");\n        this.$panel.append($content);\n        for (var i in colors) {\n            var $box = $(this._templateBox(colors[i]));\n            if (options.top) {\n                $box.css(\"border-top\", \"none\");\n                $box.css(\"border-top-left-radius\", \"0px\");\n                $box.css(\"border-top-right-radius\", \"0px\");\n            }\n            if (options.bottom) {\n                $box.css(\"border-bottom\", \"none\");\n                $box.css(\"border-bottom-left-radius\", \"0px\");\n                $box.css(\"border-bottom-right-radius\", \"0px\");\n            }\n            $line.append($box);\n        }\n        return $content;\n    },\n\n    /** Check icon */\n    _templateCheck: function() {\n        return '<div class=\"ui-color-picker-check fa fa-check\"/>';\n    },\n\n    /** Content template */\n    _templateContent: function() {\n        return '<div class=\"ui-color-picker-content\"><div class=\"line\"/></div>';\n    },\n\n    /** Box template */\n    _templateBox: function(color) {\n        return `<div id=\"${color}\" class=\"ui-color-picker-box\" style=\"background-color: #${color};\"/>`;\n    },\n\n    /** Main template */\n    _template: function() {\n        return `\n            <div class=\"ui-color-picker\">\n                <div class=\"ui-color-picker-header\">\n                    <div class=\"ui-color-picker-value\"/>\n                    <div class=\"ui-color-picker-label\">Select a color</div>\n                </div>\n                <div class=\"ui-color-picker-view ui-input\">\n                    <div class=\"ui-color-picker-panel\"/>\n                </div>\n            </div>\n            `;\n    }\n});\n","/**\n    This class creates input elements. New input parameter types should be added to the types dictionary.\n*/\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport SelectContent from \"mvc/ui/ui-select-content\";\nimport SelectLibrary from \"mvc/ui/ui-select-library\";\nimport SelectFtp from \"mvc/ui/ui-select-ftp\";\nimport SelectGenomeSpace from \"mvc/ui/ui-select-genomespace\";\nimport RulesEdit from \"mvc/ui/ui-rules-edit\";\nimport ColorPicker from \"mvc/ui/ui-color-picker\";\n\n// create form view\nexport default Backbone.Model.extend({\n    /** Available parameter types */\n    types: {\n        text: \"_fieldText\",\n        password: \"_fieldText\",\n        select: \"_fieldSelect\",\n        data_column: \"_fieldSelect\",\n        genomebuild: \"_fieldSelect\",\n        data: \"_fieldData\",\n        data_collection: \"_fieldData\",\n        integer: \"_fieldSlider\",\n        float: \"_fieldSlider\",\n        boolean: \"_fieldBoolean\",\n        drill_down: \"_fieldDrilldown\",\n        color: \"_fieldColor\",\n        group_tag: \"_fieldSelect\",\n        hidden: \"_fieldHidden\",\n        hidden_data: \"_fieldHidden\",\n        baseurl: \"_fieldHidden\",\n        library_data: \"_fieldLibrary\",\n        ftpfile: \"_fieldFtp\",\n        upload: \"_fieldUpload\",\n        rules: \"_fieldRulesEdit\",\n        genomespacefile: \"_fieldGenomeSpace\"\n    },\n\n    /** Returns an input field for a given field type */\n    create: function(input_def) {\n        let Galaxy = getGalaxyInstance();\n        var fieldClass = this.types[input_def.type];\n        var field = typeof this[fieldClass] === \"function\" ? this[fieldClass].call(this, input_def) : null;\n        if (!field) {\n            field = input_def.options ? this._fieldSelect(input_def) : this._fieldText(input_def);\n            Galaxy.emit.debug(\"form-parameters::_addRow()\", `Auto matched field type (${input_def.type}).`);\n        }\n        if (input_def.value === undefined) {\n            input_def.value = null;\n        }\n        field.value(input_def.value);\n        return field;\n    },\n\n    /** Data input field */\n    _fieldData: function(input_def) {\n        return new SelectContent.View({\n            id: `field-${input_def.id}`,\n            extensions: input_def.extensions,\n            optional: input_def.optional,\n            multiple: input_def.multiple,\n            type: input_def.type,\n            flavor: input_def.flavor,\n            data: input_def.options,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Select/Checkbox/Radio options field */\n    _fieldSelect: function(input_def) {\n        // show text field e.g. in workflow editor\n        if (input_def.is_workflow) {\n            return this._fieldText(input_def);\n        }\n\n        // customize properties\n        if (input_def.type == \"data_column\") {\n            input_def.error_text = \"Missing columns in referenced dataset.\";\n        }\n\n        // pick selection display\n        var classes = {\n            checkboxes: Ui.Checkbox,\n            radio: Ui.Radio,\n            radiobutton: Ui.RadioButton\n        };\n        var SelectClass = classes[input_def.display] || Ui.Select;\n        return new Ui.TextSelect({\n            id: `field-${input_def.id}`,\n            data: input_def.data,\n            options: input_def.options,\n            display: input_def.display,\n            error_text: input_def.error_text || \"No options available\",\n            readonly: input_def.readonly,\n            multiple: input_def.multiple,\n            optional: input_def.optional,\n            onchange: input_def.onchange,\n            individual: input_def.individual,\n            searchable: input_def.flavor !== \"workflow\",\n            textable: input_def.textable,\n            SelectClass: SelectClass\n        });\n    },\n\n    /** Drill down options field */\n    _fieldDrilldown: function(input_def) {\n        // show text field e.g. in workflow editor\n        if (input_def.is_workflow) {\n            return this._fieldText(input_def);\n        }\n\n        // create drill down field\n        return new Ui.Drilldown.View({\n            id: `field-${input_def.id}`,\n            data: input_def.options,\n            display: input_def.display,\n            optional: input_def.optional,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Text input field */\n    _fieldText: function(input_def) {\n        // field replaces e.g. a select field\n        if (input_def.model_class === 'SelectTagParameter' || input_def.options && input_def.data) {\n            input_def.area = input_def.multiple;\n            if (Utils.isEmpty(input_def.value)) {\n                input_def.value = null;\n            } else {\n                if ($.isArray(input_def.value)) {\n                    var str_value = \"\";\n                    for (var i in input_def.value) {\n                        str_value += String(input_def.value[i]);\n                        if (!input_def.multiple) {\n                            break;\n                        }\n                        str_value += \"\\n\";\n                    }\n                    input_def.value = str_value;\n                }\n            }\n        }\n        // create input element\n        return new Ui.Input({\n            id: `field-${input_def.id}`,\n            type: input_def.type,\n            area: input_def.area,\n            readonly: input_def.readonly,\n            placeholder: input_def.placeholder,\n            datalist: input_def.datalist,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Slider field */\n    _fieldSlider: function(input_def) {\n        return new Ui.Slider.View({\n            id: `field-${input_def.id}`,\n            precise: input_def.type == \"float\",\n            is_workflow: input_def.is_workflow,\n            min: input_def.min,\n            max: input_def.max,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Hidden field */\n    _fieldHidden: function(input_def) {\n        return new Ui.Hidden({\n            id: `field-${input_def.id}`,\n            info: input_def.info\n        });\n    },\n\n    /** Boolean field */\n    _fieldBoolean: function(input_def) {\n        return new Ui.RadioButton.View({\n            id: `field-${input_def.id}`,\n            data: [{ label: \"Yes\", value: \"true\" }, { label: \"No\", value: \"false\" }],\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Color picker field */\n    _fieldColor: function(input_def) {\n        return new ColorPicker({\n            id: `field-${input_def.id}`,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** Library dataset field */\n    _fieldLibrary: function(input_def) {\n        return new SelectLibrary.View({\n            id: `field-${input_def.id}`,\n            optional: input_def.optional,\n            multiple: input_def.multiple,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** FTP file field */\n    _fieldFtp: function(input_def) {\n        return new SelectFtp.View({\n            id: `field-${input_def.id}`,\n            optional: input_def.optional,\n            multiple: input_def.multiple,\n            onchange: input_def.onchange\n        });\n    },\n\n    /** GenomeSpace file select field\n     */\n    _fieldGenomeSpace: function(input_def) {\n        return new SelectGenomeSpace.View({\n            id: `field-${input_def.id}`,\n            onchange: input_def.onchange\n        });\n    },\n\n    _fieldRulesEdit: function(input_def) {\n        return new RulesEdit.View({\n            id: `field-${input_def.id}`,\n            onchange: input_def.onchange,\n            target: input_def.target\n        });\n    },\n\n    /** Upload file field */\n    _fieldUpload: function(input_def) {\n        return new Ui.Upload({\n            id: `field-${input_def.id}`,\n            onchange: input_def.onchange\n        });\n    }\n});\n","/**\n    This class creates a form section and populates it with input elements. It also handles repeat blocks and conditionals by recursively creating new sub sections.\n*/\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Repeat from \"mvc/form/form-repeat\";\nimport InputElement from \"mvc/form/form-input\";\nimport Parameters from \"mvc/form/form-parameters\";\nvar View = Backbone.View.extend({\n    initialize: function(app, options) {\n        this.app = app;\n        this.inputs = options.inputs;\n        this.parameters = new Parameters();\n        this.setElement($(\"<div/>\"));\n        this.render();\n    },\n\n    /** Render section view */\n    render: function() {\n        var self = this;\n        this.$el.empty();\n        _.each(this.inputs, input => {\n            self.add(input);\n        });\n    },\n\n    /** Add a new input element */\n    add: function(input) {\n        var input_def = $.extend({}, input);\n        input_def.id = Utils.uid();\n        this.app.input_list[input_def.id] = input_def;\n        switch (input_def.type) {\n            case \"conditional\":\n                this._addConditional(input_def);\n                break;\n            case \"repeat\":\n                this._addRepeat(input_def);\n                break;\n            case \"section\":\n                this._addSection(input_def);\n                break;\n            default:\n                this._addRow(input_def);\n        }\n    },\n\n    /** Add a conditional block */\n    _addConditional: function(input_def) {\n        var self = this;\n        input_def.test_param.id = input_def.id;\n        input_def.test_param.textable = false;\n        this.app.model.get(\"sustain_conditionals\") && (input_def.test_param.disabled = true);\n        var field = this._addRow(input_def.test_param);\n        // set onchange event for test parameter\n        if (field.model) {\n            // add conditional sub sections\n            for (var i in input_def.cases) {\n                var sub_section = new View(this.app, {\n                    inputs: input_def.cases[i].inputs\n                });\n                this._append(sub_section.$el.addClass(\"ui-portlet-section pl-2\"), `${input_def.id}-section-${i}`);\n            }\n            field.model.set(\"onchange\", value => {\n                var selectedCase = self.app.data.matchCase(input_def, value);\n                for (var i in input_def.cases) {\n                    var case_def = input_def.cases[i];\n                    var section_row = self.$(`#${input_def.id}-section-${i}`);\n                    var nonhidden = false;\n                    for (var j in case_def.inputs) {\n                        if (!case_def.inputs[j].hidden) {\n                            nonhidden = true;\n                            break;\n                        }\n                    }\n                    if (i == selectedCase && nonhidden) {\n                        section_row.fadeIn(\"fast\");\n                    } else {\n                        section_row.hide();\n                    }\n                }\n                self.app.trigger(\"change\");\n            });\n            // trigger refresh on conditional input field after all input elements have been created\n            field.trigger(\"change\");\n        }\n    },\n\n    /** Add a repeat block */\n    _addRepeat: function(input_def) {\n        var self = this;\n        var block_index = 0;\n\n        // create repeat block element\n        var repeat = new Repeat.View({\n            title: input_def.title || \"Repeat\",\n            min: input_def.min,\n            max: input_def.max,\n            onnew: function() {\n                create(input_def.inputs);\n                self.app.trigger(\"change\");\n            }\n        });\n\n        // helper function to create new repeat blocks\n        function create(inputs) {\n            var sub_section_id = `${input_def.id}-section-${block_index++}`;\n            var sub_section = new View(self.app, { inputs: inputs });\n            repeat.add({\n                id: sub_section_id,\n                $el: sub_section.$el,\n                ondel: function() {\n                    repeat.del(sub_section_id);\n                    self.app.trigger(\"change\");\n                }\n            });\n        }\n\n        //\n        // add parsed/minimum number of repeat blocks\n        //\n        var n_cache = _.size(input_def.cache);\n        for (var i = 0; i < Math.max(Math.max(n_cache, input_def.min || 0), input_def.default || 0); i++) {\n            create(i < n_cache ? input_def.cache[i] : input_def.inputs);\n        }\n\n        // hide options\n        this.app.model.get(\"sustain_repeats\") && repeat.hideOptions();\n\n        // create input field wrapper\n        var input_element = new InputElement(this.app, {\n            label: input_def.title || input_def.name,\n            help: input_def.help,\n            field: repeat\n        });\n        this._append(input_element.$el, input_def.id);\n    },\n\n    /** Add a customized section */\n    _addSection: function(input_def) {\n        var portlet = new Portlet.View({\n            title: input_def.title || input_def.name,\n            cls: \"ui-portlet-section\",\n            collapsible: true,\n            collapsible_button: true,\n            collapsed: !input_def.expanded\n        });\n        portlet.append(new View(this.app, { inputs: input_def.inputs }).$el);\n        portlet.append(\n            $(\"<div/>\")\n                .addClass(\"form-text text-muted\")\n                .html(input_def.help)\n        );\n        this.app.on(\"expand\", input_id => {\n            portlet.$(`#${input_id}`).length > 0 && portlet.expand();\n        });\n        this._append(portlet.$el, input_def.id);\n    },\n\n    /** Add a single input field element */\n    _addRow: function(input_def) {\n        var self = this;\n        var id = input_def.id;\n        input_def.onchange =\n            input_def.onchange ||\n            (() => {\n                self.app.trigger(\"change\", id);\n            });\n        var field = this.parameters.create(input_def);\n        this.app.field_list[id] = field;\n        var input_element = new InputElement(this.app, {\n            name: input_def.name,\n            label: input_def.hide_label ? \"\" : input_def.label || input_def.name,\n            value: input_def.value,\n            text_value: input_def.text_value,\n            collapsible_value: input_def.collapsible_value,\n            collapsible_preview: input_def.collapsible_preview,\n            connectable: input_def.connectable,\n            help: input_def.help,\n            argument: input_def.argument,\n            disabled: input_def.disabled,\n            color: input_def.color,\n            style: input_def.style,\n            backdrop: input_def.backdrop,\n            hidden: input_def.hidden,\n            fixed: input_def.fixed,\n            field: field\n        });\n        this.app.element_list[id] = input_element;\n        this._append(input_element.$el, input_def.id);\n        return field;\n    },\n\n    /** Append a new element to the form i.e. input element, repeat block, conditionals etc. */\n    _append: function($el, id) {\n        this.$el.append($el.addClass(\"section-row\").attr(\"id\", id));\n    }\n});\n\nexport default {\n    View: View\n};\n","/**\n    This is the main class of the form plugin. It is referenced as 'app' in lower level modules.\n*/\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport FormSection from \"mvc/form/form-section\";\nimport FormData from \"mvc/form/form-data\";\nimport { getGalaxyInstance } from \"app\";\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model({\n            initial_errors: false,\n            cls: \"ui-portlet\",\n            icon: null,\n            always_refresh: true,\n            status: \"warning\",\n            hide_operations: false,\n            onchange: function() {}\n        }).set(options);\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    /** Update available options */\n    update: function(new_model) {\n        var self = this;\n        this.data.matchModel(new_model, (node, input_id) => {\n            var field = self.field_list[input_id];\n            if (field.update) {\n                field.update(node);\n                field.trigger(\"change\");\n                let Galaxy = getGalaxyInstance();\n                Galaxy.emit.debug(\"form-view::update()\", `Updating input: ${input_id}`);\n            }\n        });\n    },\n\n    /** Set form into wait mode */\n    wait: function(active) {\n        for (var i in this.input_list) {\n            var field = this.field_list[i];\n            var input = this.input_list[i];\n            if (input.is_dynamic && field.wait && field.unwait) {\n                field[active ? \"wait\" : \"unwait\"]();\n            }\n        }\n    },\n\n    /** Highlight and scroll to input element (currently only used for error notifications) */\n    highlight: function(input_id, message, silent) {\n        var input_element = this.element_list[input_id];\n        if (input_element) {\n            input_element.error(message || \"Please verify this parameter.\");\n            this.portlet.expand();\n            this.trigger(\"expand\", input_id);\n            if (!silent) {\n                var $panel = this.$el\n                    .parents()\n                    .filter(function() {\n                        return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n                    })\n                    .first();\n                $panel.animate(\n                    {\n                        scrollTop: $panel.scrollTop() + input_element.$el.offset().top - $panel.position().top - 120\n                    },\n                    500\n                );\n            }\n        }\n    },\n\n    /** Highlights errors */\n    errors: function(options) {\n        this.trigger(\"reset\");\n        if (options && options.errors) {\n            var error_messages = this.data.matchResponse(options.errors);\n            for (var input_id in this.element_list) {\n                if (error_messages[input_id]) {\n                    this.highlight(input_id, error_messages[input_id], true);\n                }\n            }\n        }\n    },\n\n    /** Render tool form */\n    render: function() {\n        var self = this;\n        this.off(\"change\");\n        this.off(\"reset\");\n        // contains the dom field elements as created by the parameter factory i.e. form-parameters\n        this.field_list = {};\n        // contains input definitions/dictionaries as provided by the parameters to_dict() function through the api\n        this.input_list = {};\n        // contains the dom elements of each input element i.e. form-input which wraps the actual input field\n        this.element_list = {};\n        // converts the form into a json data structure\n        this.data = new FormData.Manager(this);\n        this._renderForm();\n        this.data.create();\n        if (this.model.get(\"initial_errors\")) {\n            this.errors(this.model.attributes);\n        }\n        // add listener which triggers on checksum change, and reset the form input wrappers\n        var current_check = this.data.checksum();\n        this.on(\"change\", input_id => {\n            var input = self.input_list[input_id];\n            if (!input || input.refresh_on_change || self.model.get(\"always_refresh\")) {\n                var new_check = self.data.checksum();\n                if (new_check != current_check) {\n                    current_check = new_check;\n                    self.model.get(\"onchange\")();\n                }\n            }\n        });\n        this.on(\"reset\", () => {\n            _.each(self.element_list, input_element => {\n                input_element.reset();\n            });\n        });\n        return this;\n    },\n\n    /** Renders/appends dom elements of the form */\n    _renderForm: function() {\n        $(\".tooltip\").remove();\n        var options = this.model.attributes;\n        this.message = new Ui.UnescapedMessage();\n        this.section = new FormSection.View(this, {\n            inputs: options.inputs\n        });\n        this.portlet = new Portlet.View({\n            icon: options.icon,\n            title: options.title,\n            title_id: options.title_id,\n            operations: !options.hide_operations && options.operations,\n            cls: options.cls,\n            buttons: options.buttons,\n            collapsible: options.collapsible,\n            collapsed: options.collapsed,\n            onchange_title: options.onchange_title\n        });\n        this.portlet.append(this.message.$el);\n        this.portlet.append(this.section.$el);\n        this.$el.empty();\n        if (options.inputs) {\n            this.$el.append(this.portlet.$el);\n        }\n        if (options.message) {\n            this.message.update({\n                persistent: true,\n                status: options.status,\n                message: options.message\n            });\n        }\n        let Galaxy = getGalaxyInstance();\n        Galaxy.emit.debug(\"form-view::initialize()\", \"Completed\");\n    }\n});\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport BASE_MVC from \"mvc/base-mvc\";\n\nvar logNamespace = \"list\";\n//==============================================================================\n/** A view which, when first rendered, shows only summary data/attributes, but\n *      can be expanded to show further details (and optionally fetch those\n *      details from the server).\n */\nvar ExpandableView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n    //PRECONDITION: model must have method hasDetails\n    //PRECONDITION: subclasses must have templates.el and templates.details\n\n    initialize: function(attributes) {\n        /** are the details of this view expanded/shown or not? */\n        this.expanded = attributes.expanded || false;\n        this.log(\"\\t expanded:\", this.expanded);\n        this.fxSpeed = attributes.fxSpeed !== undefined ? attributes.fxSpeed : this.fxSpeed;\n    },\n\n    // ........................................................................ render main\n    /** jq fx speed */\n    fxSpeed: \"fast\",\n\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render: function(speed) {\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors($newRender);\n        this._queueNewRender($newRender, speed);\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     *      If the view is already expanded, build the details as well.\n     */\n    _buildNewRender: function() {\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = $(this.templates.el(this.model.toJSON(), this));\n        if (this.expanded) {\n            this.$details($newRender).replaceWith(this._renderDetails().show());\n        }\n        return $newRender;\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender: function($newRender, speed) {\n        speed = speed === undefined ? this.fxSpeed : speed;\n        var view = this;\n\n        if (speed === 0) {\n            view._swapNewRender($newRender);\n            view.trigger(\"rendered\", view);\n        } else {\n            $(view).queue(\"fx\", [\n                next => {\n                    view.$el.fadeOut(speed, next);\n                },\n                next => {\n                    view._swapNewRender($newRender);\n                    next();\n                },\n                next => {\n                    view.$el.fadeIn(speed, next);\n                },\n                next => {\n                    view.trigger(\"rendered\", view);\n                    next();\n                }\n            ]);\n        }\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender: function($newRender) {\n        return this.$el\n            .empty()\n            .attr(\"class\", _.isFunction(this.className) ? this.className() : this.className)\n            .append($newRender.children());\n    },\n\n    /** set up js behaviors, event handlers for elements within the given container\n     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n     */\n    _setUpBehaviors: function($where) {\n        $where = $where || this.$el;\n        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n        //make_popup_menus( $where );\n        $where.find(\"[title]\").tooltip({ placement: \"bottom\" });\n    },\n\n    // ......................................................................... details\n    /** shortcut to details DOM (as jQ) */\n    $details: function($where) {\n        $where = $where || this.$el;\n        return $where.find(\"> .details\");\n    },\n\n    /** build the DOM for the details and set up behaviors on it */\n    _renderDetails: function() {\n        var $newDetails = $(this.templates.details(this.model.toJSON(), this));\n        this._setUpBehaviors($newDetails);\n        return $newDetails;\n    },\n\n    // ......................................................................... expansion/details\n    /** Show or hide the details\n     *  @param {Boolean} expand if true, expand; if false, collapse\n     */\n    toggleExpanded: function(expand) {\n        expand = expand === undefined ? !this.expanded : expand;\n        if (expand) {\n            this.expand();\n        } else {\n            this.collapse();\n        }\n        return this;\n    },\n\n    /** Render and show the full, detailed body of this view including extra data and controls.\n     *      note: if the model does not have detailed data, fetch that data before showing the body\n     *  @fires expanded when a body has been expanded\n     */\n    expand: function() {\n        var view = this;\n        return view._fetchModelDetails().always(() => {\n            view._expand();\n        });\n    },\n\n    /** Check for model details and, if none, fetch them.\n     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n     */\n    _fetchModelDetails: function() {\n        if (!this.model.hasDetails()) {\n            return this.model.fetch();\n        }\n        return $.when();\n    },\n\n    /** Inner fn called when expand (public) has fetched the details */\n    _expand: function() {\n        var view = this;\n        var $newDetails = view._renderDetails();\n        view.$details().replaceWith($newDetails);\n        // needs to be set after the above or the slide will not show\n        view.expanded = true;\n        view.$details().slideDown(view.fxSpeed, () => {\n            view.trigger(\"expanded\", view);\n        });\n    },\n\n    /** Hide the body/details of an HDA.\n     *  @fires collapsed when a body has been collapsed\n     */\n    collapse: function() {\n        this.debug(`${this}(ExpandableView).collapse`);\n        var view = this;\n        view.expanded = false;\n        this.$details().slideUp(view.fxSpeed, () => {\n            view.trigger(\"collapsed\", view);\n        });\n    }\n});\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *      Inherits from Expandable, Selectable, Draggable.\n *  The DOM contains warnings, a title bar, and a series of primary action controls.\n *      Primary actions are meant to be easily accessible item functions (such as delete)\n *      that are rendered in the title bar.\n *\n *  Details are rendered when the user clicks the title bar or presses enter/space when\n *      the title bar is in focus.\n *\n *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n */\nexport var ListItemView = ExpandableView.extend(\n    BASE_MVC.mixin(BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n        tagName: \"div\",\n        className: \"list-item\",\n\n        /** Set up the base class and all mixins */\n        initialize: function(attributes) {\n            ExpandableView.prototype.initialize.call(this, attributes);\n            BASE_MVC.SelectableViewMixin.initialize.call(this, attributes);\n            BASE_MVC.DraggableViewMixin.initialize.call(this, attributes);\n            this._setUpListeners();\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            // hide the primary actions in the title bar when selectable and narrow\n            this.on(\n                \"selectable\",\n                function(isSelectable) {\n                    if (isSelectable) {\n                        this.$(\".primary-actions\").hide();\n                    } else {\n                        this.$(\".primary-actions\").show();\n                    }\n                },\n                this\n            );\n            return this;\n        },\n\n        // ........................................................................ rendering\n        /** In this override, call methods to build warnings, titlebar and primary actions */\n        _buildNewRender: function() {\n            var $newRender = ExpandableView.prototype._buildNewRender.call(this);\n            $newRender.children(\".warnings\").replaceWith(this._renderWarnings());\n            $newRender.children(\".title-bar\").replaceWith(this._renderTitleBar());\n            $newRender.children(\".primary-actions\").append(this._renderPrimaryActions());\n            $newRender.find(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n            return $newRender;\n        },\n\n        /** In this override, render the selector controls and set up dragging before the swap */\n        _swapNewRender: function($newRender) {\n            ExpandableView.prototype._swapNewRender.call(this, $newRender);\n            if (this.selectable) {\n                this.showSelector(0);\n            }\n            if (this.draggable) {\n                this.draggableOn();\n            }\n            return this.$el;\n        },\n\n        /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n        _renderWarnings: function() {\n            var view = this;\n            var $warnings = $('<div class=\"warnings\"></div>');\n            var json = view.model.toJSON();\n            //TODO:! unordered (map)\n            _.each(view.templates.warnings, templateFn => {\n                $warnings.append($(templateFn(json, view)));\n            });\n            return $warnings;\n        },\n\n        /** Render the title bar (the main/exposed SUMMARY dom element) */\n        _renderTitleBar: function() {\n            return $(this.templates.titleBar(this.model.toJSON(), this));\n        },\n\n        /** Return an array of jQ objects containing common/easily-accessible item controls */\n        _renderPrimaryActions: function() {\n            // override this\n            return [];\n        },\n\n        /** Render the title bar (the main/exposed SUMMARY dom element) */\n        _renderSubtitle: function() {\n            return $(this.templates.subtitle(this.model.toJSON(), this));\n        },\n\n        // ......................................................................... events\n        /** event map */\n        events: {\n            // expand the body when the title is clicked or when in focus and space or enter is pressed\n            \"click .title-bar\": \"_clickTitleBar\",\n            \"keydown .title-bar\": \"_keyDownTitleBar\",\n            \"click .selector\": \"toggleSelect\"\n        },\n\n        /** expand when the title bar is clicked */\n        _clickTitleBar: function(event) {\n            event.stopPropagation();\n            if (event.altKey) {\n                this.toggleSelect(event);\n                if (!this.selectable) {\n                    this.showSelector();\n                }\n            } else {\n                this.toggleExpanded();\n            }\n        },\n\n        /** expand when the title bar is in focus and enter or space is pressed */\n        _keyDownTitleBar: function(event) {\n            // bail (with propagation) if keydown and not space or enter\n            var KEYCODE_SPACE = 32;\n\n            var KEYCODE_RETURN = 13;\n            if (\n                event &&\n                event.type === \"keydown\" &&\n                (event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN)\n            ) {\n                this.toggleExpanded();\n                event.stopPropagation();\n                return false;\n            }\n            return true;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `ListItemView(${modelString})`;\n        }\n    })\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListItemView.prototype.templates = (() => {\n    var elTemplato = BASE_MVC.wrapTemplate([\n        '<div class=\"list-element\">',\n        // errors, messages, etc.\n        '<div class=\"warnings\"></div>',\n\n        // multi-select checkbox\n        '<div class=\"selector\">',\n        '<span class=\"fa fa-2x fa-square-o\"></span>',\n        \"</div>\",\n        // space for title bar buttons - gen. floated to the right\n        '<div class=\"primary-actions\"></div>',\n        '<div class=\"title-bar\"></div>',\n\n        // expandable area for more details\n        '<div class=\"details\"></div>',\n        \"</div>\"\n    ]);\n\n    var warnings = {};\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            //TODO: prob. belongs in dataset-list-item\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.name %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    var subtitleTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"subtitle\"></div>'\n    ]);\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"details\"></div>'\n    ]);\n\n    return {\n        el: elTemplato,\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate,\n        details: detailsTemplate\n    };\n})();\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n *      If 'foldout': will expand vertically to show the nested list\n *      If 'drilldown': will overlay the parent list\n *\n *  Inherits from ListItemView.\n *\n *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n */\nexport var FoldoutListItemView = ListItemView.extend({\n    /** If 'foldout': show the sub-panel inside the expanded item\n     *  If 'drilldown': only fire events and handle by pub-sub\n     *      (allow the panel containing this item to attach it, hide itself, etc.)\n     */\n    foldoutStyle: \"foldout\",\n    /** Panel view class to instantiate for the sub-panel */\n    foldoutPanelClass: null,\n\n    /** override to:\n     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n     *      disrespect attributes.expanded if drilldown\n     */\n    initialize: function(attributes) {\n        if (this.foldoutStyle === \"drilldown\") {\n            this.expanded = false;\n        }\n        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\n        ListItemView.prototype.initialize.call(this, attributes);\n        this.foldout = this._createFoldoutPanel();\n    },\n\n    /** in this override, attach the foldout panel when rendering details */\n    _renderDetails: function() {\n        if (this.foldoutStyle === \"drilldown\") {\n            return $();\n        }\n        var $newDetails = ListItemView.prototype._renderDetails.call(this);\n        return this._attachFoldout(this.foldout, $newDetails);\n    },\n\n    /** In this override, handle collection expansion. */\n    _createFoldoutPanel: function() {\n        var model = this.model;\n        var FoldoutClass = this._getFoldoutPanelClass(model);\n        var options = this._getFoldoutPanelOptions(model);\n\n        var foldout = new FoldoutClass(\n            _.extend(options, {\n                model: model\n            })\n        );\n\n        return foldout;\n    },\n\n    /** Stub to return proper foldout panel class */\n    _getFoldoutPanelClass: function() {\n        // override\n        return this.foldoutPanelClass;\n    },\n\n    /** Stub to return proper foldout panel options */\n    _getFoldoutPanelOptions: function() {\n        return {\n            // propagate foldout style down\n            foldoutStyle: this.foldoutStyle,\n            fxSpeed: this.fxSpeed\n        };\n    },\n\n    /** Render the foldout panel inside the view, hiding controls */\n    _attachFoldout: function(foldout, $whereTo) {\n        $whereTo = $whereTo || this.$(\"> .details\");\n        this.foldout = foldout.render(0);\n        foldout.$(\"> .controls\").hide();\n        return $whereTo.append(foldout.$el);\n    },\n\n    /** In this override, branch on foldoutStyle to show expanded */\n    expand: function() {\n        var view = this;\n        return view._fetchModelDetails().always(() => {\n            if (view.foldoutStyle === \"foldout\") {\n                view._expand();\n            } else if (view.foldoutStyle === \"drilldown\") {\n                view._expandByDrilldown();\n            }\n        });\n    },\n\n    /** For drilldown, set up close handler and fire expanded:drilldown\n     *      containing views can listen to this and handle other things\n     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n     */\n    _expandByDrilldown: function() {\n        var view = this;\n        // attachment and rendering done by listener\n        view.listenTo(view.foldout, \"close\", () => {\n            view.trigger(\"collapsed:drilldown\", view, view.foldout);\n        });\n        view.trigger(\"expanded:drilldown\", view, view.foldout);\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nFoldoutListItemView.prototype.templates = (() => {\n    var detailsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            // override with more info (that goes above the panel)\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        details: detailsTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    ExpandableView: ExpandableView,\n    ListItemView: ListItemView,\n    FoldoutListItemView: FoldoutListItemView\n};\n","//=============================================================================\n/**\n * backbone model for icon buttons\n */\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { make_popupmenu } from \"ui/popupmenu\";\n\nvar IconButton = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        icon_class: \"\",\n        on_click: null,\n        menu_options: null,\n        is_menu_button: true,\n        id: null,\n        href: null,\n        target: null,\n        enabled: true,\n        visible: true,\n        tooltip_config: {}\n    }\n});\n\n/**\n *  backbone view for icon buttons\n */\nvar IconButtonView = Backbone.View.extend({\n    initialize: function() {\n        // better rendering this way\n        this.model.attributes.tooltip_config = { placement: \"bottom\" };\n        this.model.bind(\"change\", this.render, this);\n    },\n\n    render: function() {\n        // hide tooltip\n        this.$el.tooltip(\"hide\");\n\n        var new_elem = this.template(this.model.toJSON());\n        // configure tooltip\n        new_elem.tooltip(this.model.get(\"tooltip_config\"));\n        this.$el.replaceWith(new_elem);\n        this.setElement(new_elem);\n        return this;\n    },\n\n    events: {\n        click: \"click\"\n    },\n\n    click: function(event) {\n        // if on_click pass to that function\n        if (_.isFunction(this.model.get(\"on_click\"))) {\n            this.model.get(\"on_click\")(event);\n            return false;\n        }\n        // otherwise, bubble up ( to href or whatever )\n        return true;\n    },\n\n    // generate html element\n    template: function(options) {\n        var buffer = `title=\"${options.title}\" class=\"icon-button`;\n\n        if (options.is_menu_button) {\n            buffer += \" menu-button\";\n        }\n\n        buffer += ` ${options.icon_class}`;\n\n        if (!options.enabled) {\n            buffer += \"_disabled\";\n        }\n\n        // close class tag\n        buffer += '\"';\n\n        if (options.id) {\n            buffer += ` id=\"${options.id}\"`;\n        }\n\n        buffer += ` href=\"${options.href}\"`;\n        // add target for href\n        if (options.target) {\n            buffer += ` target=\"${options.target}\"`;\n        }\n        // set visibility\n        if (!options.visible) {\n            buffer += ' style=\"display: none;\"';\n        }\n\n        // enabled/disabled\n        if (options.enabled) {\n            buffer = `<a ${buffer}/>`;\n        } else {\n            buffer = `<span ${buffer}/>`;\n        }\n\n        // return element\n        return $(buffer);\n    }\n});\n\n// define collection\nvar IconButtonCollection = Backbone.Collection.extend({\n    model: IconButton\n});\n\n/**\n * menu with multiple icon buttons\n * views are not needed nor used for individual buttons\n */\nvar IconButtonMenuView = Backbone.View.extend({\n    tagName: \"div\",\n\n    initialize: function() {\n        this.render();\n    },\n\n    render: function() {\n        // initialize icon buttons\n        var self = this;\n        this.collection.each(button => {\n            // create and add icon button to menu\n            var elt = $(\"<a/>\")\n                .attr(\"href\", \"javascript:void(0)\")\n                .attr(\"title\", button.attributes.title)\n                .addClass(\"icon-button menu-button\")\n                .addClass(button.attributes.icon_class)\n                .appendTo(self.$el)\n                .click(button.attributes.on_click);\n\n            // configure tooltip\n            if (button.attributes.tooltip_config) {\n                elt.tooltip(button.attributes.tooltip_config);\n            }\n\n            // add popup menu to icon\n            var menu_options = button.get(\"options\");\n            if (menu_options) {\n                make_popupmenu(elt, menu_options);\n            }\n        });\n\n        // return\n        return this;\n    }\n});\n\n/**\n * Returns an IconButtonMenuView for the provided configuration.\n * Configuration is a list of dictionaries where each dictionary\n * defines an icon button. Each dictionary must have the following\n * elements: icon_class, title, and on_click.\n */\nvar create_icon_buttons_menu = (config, global_config) => {\n    // initialize global configuration\n    if (!global_config) global_config = {};\n\n    // create and initialize menu\n    var buttons = new IconButtonCollection(\n        _.map(config, button_config => new IconButton(_.extend(button_config, global_config)))\n    );\n\n    // return menu\n    return new IconButtonMenuView({ collection: buttons });\n};\n\n//=============================================================================\nexport default {\n    IconButton: IconButton,\n    IconButtonView: IconButtonView,\n    IconButtonCollection: IconButtonCollection,\n    IconButtonMenuView: IconButtonMenuView,\n    create_icon_buttons_menu: create_icon_buttons_menu\n};\n","/** This module contains all button views. */\nimport $ from \"jquery\";\nimport Utils from \"utils/utils\";\nimport Backbone from \"backbone\";\n\n/** This renders the default button which is used e.g. at the bottom of the upload modal. */\nvar Button = Backbone.View.extend({\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                title: \"\",\n                icon: \"\",\n                cls: \"btn btn-secondary\",\n                wait: false,\n                wait_text: \"Sending...\",\n                wait_cls: \"btn btn-info\",\n                disabled: false,\n                percentage: -1,\n                visible: true\n            }).set(options);\n        this.setElement(\n            $(\"<button/>\")\n                .attr(\"type\", \"button\")\n                .append((this.$icon = $(\"<i/>\")))\n                .append((this.$title = $(\"<span/>\")))\n                .append((this.$progress = $(\"<div/>\").append((this.$progress_bar = $(\"<div/>\")))))\n        );\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        var options = this.model.attributes;\n        this.$el\n            .removeClass()\n            .addClass(\"ui-button-default\")\n            .addClass(options.disabled && \"disabled\")\n            .attr(\"id\", options.id)\n            .attr(\"disabled\", options.disabled)\n            .css(\"display\", options.visible ? \"inline-block\" : \"none\")\n            .off(\"click\")\n            .on(\"click\", () => {\n                $(\".tooltip\").hide();\n                options.onclick && !this.disabled && options.onclick();\n            })\n            .tooltip({ title: options.tooltip || \"\", placement: \"bottom\" });\n        this.$progress.addClass(\"progress\").css(\"display\", options.percentage !== -1 ? \"block\" : \"none\");\n        this.$progress_bar.addClass(\"progress-bar\").css({ width: `${options.percentage}%` });\n        this.$icon.removeClass().addClass(\"icon fa\");\n        this.$title.removeClass().addClass(\"title\");\n        if (options.wait) {\n            this.$el.addClass(options.wait_cls).prop(\"disabled\", true);\n            this.$icon.addClass(\"fa-spinner fa-spin mr-1\");\n            this.$title.html(options.wait_text);\n        } else {\n            this.$el.addClass(options.cls);\n            this.$icon.addClass(options.icon);\n            if (options.title) {\n                this.$title.html(options.title);\n                if (options.icon) {\n                    this.$icon.addClass(\"mr-1\");\n                }\n            }\n        }\n    },\n\n    /** Show button */\n    show: function() {\n        this.model.set(\"visible\", true);\n    },\n\n    /** Hide button */\n    hide: function() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Disable button */\n    disable: function() {\n        this.model.set(\"disabled\", true);\n    },\n\n    /** Enable button */\n    enable: function() {\n        this.model.set(\"disabled\", false);\n    },\n\n    /** Show spinner to indicate that the button is not ready to be clicked */\n    wait: function() {\n        this.model.set(\"wait\", true);\n    },\n\n    /** Hide spinner to indicate that the button is ready to be clicked */\n    unwait: function() {\n        this.model.set(\"wait\", false);\n    },\n\n    /** Change icon */\n    setIcon: function(icon) {\n        this.model.set(\"icon\", icon);\n    }\n});\n\n/** This button allows the right-click/open-in-new-tab feature, its used e.g. for panel buttons. */\nvar ButtonLink = Button.extend({\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                visible: true,\n                title: \"\",\n                icon: \"\",\n                cls: \"\"\n            }).set(options);\n        this.setElement($(\"<a/>\").append((this.$icon = $(\"<span/>\"))));\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        var options = this.model.attributes;\n        this.$el\n            .removeClass()\n            .addClass(options.cls)\n            .attr({\n                id: options.id,\n                href: options.href || \"javascript:void(0)\",\n                title: options.title,\n                target: options.target || \"_top\",\n                disabled: options.disabled\n            })\n            .css(\"display\", options.visible ? \"inline-block\" : \"none\")\n            .tooltip({ placement: \"bottom\" })\n            .off(\"click\")\n            .on(\"click\", () => {\n                options.onclick && !options.disabled && options.onclick();\n            });\n        this.$icon.removeClass().addClass(options.icon);\n    }\n});\n\n/** The check button is used in the tool form and allows to distinguish between multiple states e.g. all, partially and nothing selected. */\nvar ButtonCheck = Backbone.View.extend({\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                title: \"Select/Unselect all\",\n                icons: [\"fa-square-o\", \"fa-minus-square-o\", \"fa-check-square-o\"],\n                value: 0,\n                visible: true,\n                onchange: function() {}\n            }).set(options);\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"mb-2\")\n                .append((this.$icon = $(\"<span/>\")))\n                .append((this.$title = $(\"<span/>\")))\n        );\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n\n    render: function(options) {\n        options = this.model.attributes;\n        this.$el\n            .addClass(\"ui-button-check\")\n            .css(\"display\", options.visible ? \"inline-block\" : \"none\")\n            .off(\"click\")\n            .on(\"click\", () => {\n                this.model.set(\"value\", (this.model.get(\"value\") === 0 && 2) || 0);\n                options.onclick && options.onclick();\n            });\n        this.$title.html(options.title);\n        this.$icon\n            .removeClass()\n            .addClass(\"icon fa mr-1\")\n            .addClass(options.icons[options.value]);\n    },\n\n    /* Sets a new value and/or returns the value.\n     * @param{Integer}   new_val - Set a new value 0=unchecked, 1=partial and 2=checked.\n     * OR:\n     * @param{Integer}   new_val - Number of selected options.\n     * @param{Integer}   total   - Total number of available options.\n     */\n    value: function(new_val, total) {\n        if (new_val !== undefined) {\n            if (total && new_val !== 0) {\n                new_val = (new_val !== total && 1) || 2;\n            }\n            this.model.set(\"value\", new_val);\n            this.model.get(\"onchange\")(this.model.get(\"value\"));\n        }\n        return this.model.get(\"value\");\n    }\n});\n\n/** This class creates a button with dropdown menu. */\nvar ButtonMenu = Backbone.View.extend({\n    $menu: null,\n    initialize: function(options) {\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: \"\",\n                title: \"\",\n                pull: \"right\",\n                icon: null,\n                onclick: null,\n                cls: \"btn btn-secondary float-right\",\n                tooltip: \"\",\n                target: \"\",\n                href: \"\",\n                onunload: null,\n                visible: true,\n                tag: \"\"\n            }).set(options);\n        this.collection = new Backbone.Collection();\n        this.setElement(\n            $(\"<div/>\").append(\n                (this.$root = $(\"<button/>\")\n                    .append((this.$icon = $(\"<i/>\")))\n                    .append((this.$title = $(\"<span/>\"))))\n            )\n        );\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"change add remove reset\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        var options = this.model.attributes;\n        this.$el\n            .removeClass()\n            .addClass(\"dropdown\")\n            .attr(\"id\", options.id)\n            .css({\n                display: options.visible && this.collection.where({ visible: true }).length > 0 ? \"block\" : \"none\"\n            });\n        this.$root\n            .addClass(options.cls)\n            .attr(\"data-toggle\", \"dropdown\")\n            .tooltip({ title: options.tooltip || \"\", placement: \"bottom\" })\n            .off(\"click\")\n            .on(\"click\", e => {\n                $(\".tooltip\").hide();\n                e.preventDefault();\n                options.onclick && options.onclick();\n            });\n        this.$icon\n            .removeClass()\n            .addClass(\"icon fa\")\n            .addClass(options.icon);\n        options.title &&\n            this.$title\n                .removeClass()\n                .addClass(\"title ml-1\")\n                .html(options.title);\n        this.$menu && this.$menu.remove();\n        if (this.collection.length > 0) {\n            this.$menu = $(\"<ul/>\")\n                .addClass(\"menu dropdown-menu dropdown-menu-right\")\n                .addClass(`pull-${this.model.get(\"pull\")}`)\n                .attr(\"role\", \"menu\");\n            this.$el.append(this.$menu);\n        }\n        this.collection.each(submodel => {\n            var suboptions = submodel.attributes;\n            if (suboptions.visible) {\n                var $link = $(\"<a/>\")\n                    .addClass(\"dropdown-item\")\n                    .attr({\n                        href: suboptions.href,\n                        target: suboptions.target\n                    })\n                    .append(\n                        $(\"<i/>\")\n                            .addClass(\"fa mr-2\")\n                            .addClass(suboptions.icon)\n                            .css(\"display\", suboptions.icon ? \"inline-block\" : \"none\")\n                    )\n                    .append(suboptions.title)\n                    .on(\"click\", e => {\n                        if (suboptions.onclick) {\n                            e.preventDefault();\n                            suboptions.onclick();\n                        }\n                    });\n                this.$menu.append($(\"<li/>\").append($link));\n                suboptions.divider && this.$menu.append($(\"<li/>\").addClass(\"divider\"));\n            }\n        });\n    },\n\n    /** Add a new menu item */\n    addMenu: function(options) {\n        this.collection.add(\n            Utils.merge(options, {\n                title: \"\",\n                target: \"\",\n                href: \"\",\n                onclick: null,\n                divider: false,\n                visible: true,\n                icon: null,\n                cls: \"button-menu btn-group\"\n            })\n        );\n    }\n});\n\nexport default {\n    Button: Button,\n    ButtonLink: ButtonLink,\n    ButtonCheck: ButtonCheck,\n    ButtonMenu: ButtonMenu\n};\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport Backbone from \"backbone\";\nimport HDCA from \"mvc/history/hdca-model\";\nimport STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport baseCreator from \"mvc/collection/base-creator\";\nimport UI_MODAL from \"mvc/ui/ui-modal\";\nimport _l from \"utils/localization\";\nimport Vue from \"vue\";\nimport { getGalaxyInstance } from \"app\";\n\nimport \"ui/hoverhighlight\";\n\nvar logNamespace = \"collections\";\nvar $ = jQuery;\n\n/*==============================================================================\nTODO:\n    use proper Element model and not just json\n    straighten out createFn, collection.createHDCA\n    possibly stop using modals for this\n    It would be neat to do a drag and drop\n\n==============================================================================*/\n/** A view for both DatasetDCEs and NestedDCDCEs\n *  (things that implement collection-model:DatasetCollectionElementMixin)\n */\nvar DatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function(attributes) {\n        this.element = attributes.element || {};\n        this.selected = attributes.selected || false;\n    },\n\n    render: function() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el\n            .attr(\"data-element-id\", this.element.id)\n            .attr(\"draggable\", true)\n            .html(this.template({ element: this.element }))\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        if (this.selected) {\n            this.$el.addClass(\"selected\");\n        }\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(\n        [\n            '<a class=\"name\" title=\"',\n            _l(\"Click to rename\"),\n            '\" href=\"javascript:void(0)\">',\n            \"<%- element.name %>\",\n            \"</a>\",\n            '<button class=\"discard btn btn-sm\" title=\"',\n            _l(\"Remove this dataset from the list\"),\n            '\">',\n            _l(\"Discard\"),\n            \"</button>\"\n        ].join(\"\")\n    ),\n\n    /** select this element and pub */\n    select: function(toggle) {\n        this.$el.toggleClass(\"selected\", toggle);\n        this.trigger(\"select\", {\n            source: this,\n            selected: this.$el.hasClass(\"selected\")\n        });\n    },\n\n    /** animate the removal of this element and pub */\n    discard: function() {\n        var view = this;\n        var parentWidth = this.$el.parent().width();\n        this.$el.animate({ \"margin-right\": parentWidth }, \"fast\", () => {\n            view.trigger(\"discard\", {\n                source: view\n            });\n            view.destroy();\n        });\n    },\n\n    /** remove the DOM and any listeners */\n    destroy: function() {\n        this.off();\n        this.$el.remove();\n    },\n\n    events: {\n        click: \"_click\",\n        \"click .name\": \"_clickName\",\n        \"click .discard\": \"_clickDiscard\",\n\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** select when the li is clicked */\n    _click: function(ev) {\n        ev.stopPropagation();\n        this.select(ev);\n    },\n\n    /** rename a pair when the name is clicked */\n    _clickName: function(ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n\n        var response = prompt(`${_l(\"Enter a new name for the element\")}:`, this.element.name);\n\n        if (response) {\n            this.element.name = response;\n            this.render();\n        }\n        //TODO: cancelling with ESC leads to closure of the creator...\n    },\n\n    /** discard when the discard button is clicked */\n    _clickDiscard: function(ev) {\n        ev.stopPropagation();\n        this.discard();\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function(ev) {\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.element));\n\n        this.$el.addClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragstart\", [this]);\n    },\n\n    /** dragging for re-ordering */\n    _dragend: function(ev) {\n        this.$el.removeClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\n/** An interface for building collections.\n */\nvar ListCollectionCreator = Backbone.View.extend(BASE_MVC.LoggableMixin)\n    .extend(baseCreator.CollectionCreatorMixin)\n    .extend({\n        _logNamespace: logNamespace,\n\n        /** the class used to display individual elements */\n        elementViewClass: DatasetCollectionElementView,\n        /** the class this creator will create and save */\n        collectionClass: HDCA.HistoryDatasetCollection,\n        className: \"list-collection-creator collection-creator flex-row-container\",\n\n        /** minimum number of valid elements to start with in order to build a collection of this type */\n        minElements: 1,\n\n        defaultAttributes: {\n            //TODO: remove - use new collectionClass().save()\n            /** takes elements and creates the proper collection - returns a promise */\n            creationFn: function() {\n                throw new TypeError(\"no creation fn for creator\");\n            },\n            /** fn to call when the collection is created (scoped to this) */\n            oncreate: function() {},\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            oncancel: function() {},\n            /** distance from list edge to begin autoscrolling list */\n            autoscrollDist: 24,\n            /** Color passed to hoverhighlight */\n            highlightClr: \"rgba( 64, 255, 255, 1.0 )\"\n        },\n\n        footerSettings: {\n            \".hide-originals\": \"hideOriginals\"\n        },\n\n        /** set up initial options, instance vars, behaviors */\n        initialize: function(attributes) {\n            this.metric(\"ListCollectionCreator.initialize\", attributes);\n            var creator = this;\n            _.each(this.defaultAttributes, (value, key) => {\n                value = attributes[key] || value;\n                creator[key] = value;\n            });\n\n            /** unordered, original list - cache to allow reversal */\n            creator.initialElements = attributes.elements || [];\n\n            this._setUpCommonSettings(attributes);\n            this._instanceSetUp();\n            this._elementsSetUp();\n            this._setUpBehaviors();\n        },\n\n        /** set up instance vars */\n        _instanceSetUp: function() {\n            /** Ids of elements that have been selected by the user - to preserve over renders */\n            this.selectedIds = {};\n            /** DOM elements currently being dragged */\n            this.$dragging = null;\n            /** Used for blocking UI events during ajax/operations (don't post twice) */\n            this.blocking = false;\n        },\n\n        // ------------------------------------------------------------------------ process raw list\n        /** set up main data */\n        _elementsSetUp: function() {\n            //this.debug( '-- _dataSetUp' );\n            /** a list of invalid elements and the reasons they aren't valid */\n            this.invalidElements = [];\n            //TODO: handle fundamental problem of syncing DOM, views, and list here\n            /** data for list in progress */\n            this.workingElements = [];\n            /** views for workingElements */\n            this.elementViews = [];\n\n            // copy initial list, sort, add ids if needed\n            this.workingElements = this.initialElements.slice(0);\n            this._ensureElementIds();\n            this._validateElements();\n            this._mangleDuplicateNames();\n            this._sortElements();\n        },\n\n        /** add ids to dataset objs in initial list if none */\n        _ensureElementIds: function() {\n            this.workingElements.forEach(element => {\n                if (!element.hasOwnProperty(\"id\")) {\n                    element.id = _.uniqueId();\n                }\n            });\n            return this.workingElements;\n        },\n\n        /** separate working list into valid and invalid elements for this collection */\n        _validateElements: function() {\n            var creator = this;\n            creator.invalidElements = [];\n\n            this.workingElements = this.workingElements.filter(element => {\n                var problem = creator._isElementInvalid(element);\n                if (problem) {\n                    creator.invalidElements.push({\n                        element: element,\n                        text: problem\n                    });\n                }\n                return !problem;\n            });\n            return this.workingElements;\n        },\n\n        /** describe what is wrong with a particular element if anything */\n        _isElementInvalid: function(element) {\n            if (element.history_content_type === \"dataset_collection\") {\n                return _l(\"is a collection, this is not allowed\");\n            }\n            var validState = element.state === STATES.OK || _.contains(STATES.NOT_READY_STATES, element.state);\n            if (!validState) {\n                return _l(\"has errored, is paused, or is not accessible\");\n            }\n            if (element.deleted || element.purged) {\n                return _l(\"has been deleted or purged\");\n            }\n            return null;\n        },\n\n        /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n        _mangleDuplicateNames: function() {\n            var SAFETY = 900;\n            var counter = 1;\n            var existingNames = {};\n            this.workingElements.forEach(element => {\n                var currName = element.name;\n                while (existingNames.hasOwnProperty(currName)) {\n                    currName = `${element.name} (${counter})`;\n                    counter += 1;\n                    if (counter >= SAFETY) {\n                        throw new Error(\"Safety hit in while loop - thats impressive\");\n                    }\n                }\n                element.name = currName;\n                existingNames[element.name] = true;\n            });\n        },\n\n        /** sort a list of elements */\n        _sortElements: function(list) {\n            // // currently only natural sort by name\n            // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n            // return this.workingElements;\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        // templates : ListCollectionCreator.templates,\n        /** render the entire interface */\n        render: function(speed, callback) {\n            //this.debug( '-- _render' );\n            if (this.workingElements.length < this.minElements) {\n                return this._renderInvalid(speed, callback);\n            }\n\n            this.$el.empty().html(this.templates.main());\n            this._renderHeader(speed);\n            this._renderMiddle(speed);\n            this._renderFooter(speed);\n            this._addPluginComponents();\n            this.$(\".collection-name\").focus();\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render a simplified interface aimed at telling the user why they can't move forward */\n        _renderInvalid: function(speed, callback) {\n            //this.debug( '-- _render' );\n            this.$el.empty().html(\n                this.templates.invalidInitial({\n                    problems: this.invalidElements,\n                    elements: this.workingElements\n                })\n            );\n            if (typeof this.oncancel === \"function\") {\n                this.$(\".cancel-create.btn\").show();\n            }\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render the header section */\n        _renderHeader: function(speed, callback) {\n            var $header = this.$(\".header\")\n                .empty()\n                .html(this.templates.header())\n                .find(\".help-content\")\n                .prepend($(this.templates.helpContent()));\n            //TODO: should only show once despite calling _renderHeader again\n            if (this.invalidElements.length) {\n                this._invalidElementsAlert();\n            }\n            return $header;\n        },\n\n        /** render the middle including the elements */\n        _renderMiddle: function(speed, callback) {\n            var $middle = this.$(\".middle\")\n                .empty()\n                .html(this.templates.middle());\n            this._renderList(speed);\n            return $middle;\n        },\n\n        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n        _addPluginComponents: function() {\n            this.$(\".help-content i\").hoverhighlight(\".collection-creator\", this.highlightClr);\n        },\n\n        /** build and show an alert describing any elements that could not be included due to problems */\n        _invalidElementsAlert: function() {\n            this._showAlert(\n                this.templates.invalidElements({\n                    problems: this.invalidElements\n                }),\n                \"alert-warning\"\n            );\n        },\n\n        _disableNameAndCreate: function(disable) {\n            disable = !_.isUndefined(disable) ? disable : true;\n            if (disable) {\n                this.$(\".collection-name\").prop(\"disabled\", true);\n                this.$(\".create-collection\").toggleClass(\"disabled\", true);\n                // } else {\n                //     this.$( '.collection-name' ).prop( 'disabled', false );\n                //     this.$( '.create-collection' ).removeClass( 'disable' );\n            }\n        },\n\n        // ------------------------------------------------------------------------ rendering elements\n        /** conv. to the main list display DOM */\n        $list: function() {\n            return this.$(\".collection-elements\");\n        },\n\n        /** show or hide the clear selected control based on the num of selected elements */\n        _renderClearSelected: function() {\n            if (_.size(this.selectedIds)) {\n                this.$(\".collection-elements-controls > .clear-selected\").show();\n            } else {\n                this.$(\".collection-elements-controls > .clear-selected\").hide();\n            }\n        },\n\n        /** render the elements in order (or a warning if no elements found) */\n        _renderList: function(speed, callback) {\n            //this.debug( '-- _renderList' );\n            var creator = this;\n\n            var $tmp = jQuery(\"<div/>\");\n            var $list = creator.$list();\n\n            _.each(this.elementViews, view => {\n                view.destroy();\n                creator.removeElementView(view);\n            });\n\n            // if( !this.workingElements.length ){\n            //     this._renderNoValidElements();\n            //     return;\n            // }\n\n            creator.workingElements.forEach(element => {\n                var elementView = creator._createElementView(element);\n                $tmp.append(elementView.$el);\n            });\n\n            creator._renderClearSelected();\n            $list.empty().append($tmp.children());\n            _.invoke(creator.elementViews, \"render\");\n\n            if ($list.height() > $list.css(\"max-height\")) {\n                $list.css(\"border-width\", \"1px 0px 1px 0px\");\n            } else {\n                $list.css(\"border-width\", \"0px\");\n            }\n        },\n\n        /** create an element view, cache in elementViews, set up listeners, and return */\n        _createElementView: function(element) {\n            var elementView = new this.elementViewClass({\n                //TODO: use non-generic class or not all\n                // model : COLLECTION.DatasetDCE( element )\n                element: element,\n                selected: _.has(this.selectedIds, element.id)\n            });\n            this.elementViews.push(elementView);\n            this._listenToElementView(elementView);\n            return elementView;\n        },\n\n        /** listen to any element events */\n        _listenToElementView: function(view) {\n            var creator = this;\n            creator.listenTo(view, {\n                select: function(data) {\n                    var element = data.source.element;\n                    if (data.selected) {\n                        creator.selectedIds[element.id] = true;\n                    } else {\n                        delete creator.selectedIds[element.id];\n                    }\n                    creator.trigger(\"elements:select\", data);\n                },\n                discard: function(data) {\n                    creator.trigger(\"elements:discard\", data);\n                }\n            });\n        },\n\n        /** add a new element view based on the json in element */\n        addElementView: function(element) {\n            //TODO: workingElements is sorted, add element in appropo index\n            // add element, sort elements, find element index\n            // var view = this._createElementView( element );\n            // return view;\n        },\n\n        /** stop listening to view and remove from caches */\n        removeElementView: function(view) {\n            delete this.selectedIds[view.element.id];\n            this._renderClearSelected();\n\n            this.elementViews = _.without(this.elementViews, view);\n            this.stopListening(view);\n        },\n\n        /** render a message in the list that no elements remain to create a collection */\n        _renderNoElementsLeft: function() {\n            this._disableNameAndCreate(true);\n            this.$(\".collection-elements\").append(this.templates.noElementsLeft());\n        },\n\n        // /** render a message in the list that no valid elements were found to create a collection */\n        // _renderNoValidElements : function(){\n        //     this._disableNameAndCreate( true );\n        //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n        // },\n\n        // ------------------------------------------------------------------------ API\n        /** convert element into JSON compatible with the collections API */\n        _elementToJSON: function(element) {\n            // return element.toJSON();\n            return element;\n        },\n\n        /** create the collection via the API\n         *  @returns {jQuery.xhr Object} the jquery ajax request\n         */\n        createList: function(name) {\n            if (!this.workingElements.length) {\n                var message = `${_l(\"No valid elements for final list\")}. `;\n                message += `<a class=\"cancel-create\" href=\"javascript:void(0);\">${_l(\"Cancel\")}</a> `;\n                message += _l(\"or\");\n                message += ` <a class=\"reset\" href=\"javascript:void(0);\">${_l(\"start over\")}</a>.`;\n                this._showAlert(message);\n                return;\n            }\n\n            var creator = this;\n\n            var elements = this.workingElements.map(element => creator._elementToJSON(element));\n\n            creator.blocking = true;\n            return creator\n                .creationFn(elements, name, creator.hideOriginals)\n                .always(() => {\n                    creator.blocking = false;\n                })\n                .fail((xhr, status, message) => {\n                    creator.trigger(\"error\", {\n                        xhr: xhr,\n                        status: status,\n                        message: _l(\"An error occurred while creating this collection\")\n                    });\n                })\n                .done(function(response, message, xhr) {\n                    creator.trigger(\"collection:created\", response, message, xhr);\n                    creator.metric(\"collection:created\", response);\n                    if (typeof creator.oncreate === \"function\") {\n                        creator.oncreate.call(this, response, message, xhr);\n                    }\n                });\n        },\n\n        // ------------------------------------------------------------------------ events\n        /** set up event handlers on self */\n        _setUpBehaviors: function() {\n            this.on(\"error\", this._errorHandler);\n\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this.on(\"elements:select\", function(data) {\n                this._renderClearSelected();\n            });\n\n            this.on(\"elements:discard\", function(data) {\n                var element = data.source.element;\n                this.removeElementView(data.source);\n\n                this.workingElements = _.without(this.workingElements, element);\n                if (!this.workingElements.length) {\n                    this._renderNoElementsLeft();\n                }\n            });\n\n            //this.on( 'all', function(){\n            //    this.info( arguments );\n            //});\n            return this;\n        },\n\n        /** handle errors with feedback and details to the user (if available) */\n        _errorHandler: function(data) {\n            this.error(data);\n\n            var creator = this;\n            var content = data.message || _l(\"An error occurred\");\n            if (data.xhr) {\n                var xhr = data.xhr;\n                var message = data.message;\n                if (xhr.readyState === 0 && xhr.status === 0) {\n                    content += `: ${_l(\"Galaxy could not be reached and may be updating.\")}${_l(\n                        \" Try again in a few minutes.\"\n                    )}`;\n                } else if (xhr.responseJSON) {\n                    content += `:<br /><pre>${JSON.stringify(xhr.responseJSON)}</pre>`;\n                } else {\n                    content += `: ${message}`;\n                }\n            }\n            creator._showAlert(content, \"alert-danger\");\n        },\n\n        events: {\n            // header\n            \"click .more-help\": \"_clickMoreHelp\",\n            \"click .less-help\": \"_clickLessHelp\",\n            \"click .main-help\": \"_toggleHelp\",\n            \"click .header .alert button\": \"_hideAlert\",\n\n            \"click .reset\": \"reset\",\n            \"click .clear-selected\": \"clearSelectedElements\",\n\n            // elements - selection\n            \"click .collection-elements\": \"clearSelectedElements\",\n\n            // elements - drop target\n            // 'dragenter .collection-elements': '_dragenterElements',\n            // 'dragleave .collection-elements': '_dragleaveElements',\n            \"dragover .collection-elements\": \"_dragoverElements\",\n            \"drop .collection-elements\": \"_dropElements\",\n\n            // these bubble up from the elements as custom events\n            \"collection-element.dragstart .collection-elements\": \"_elementDragstart\",\n            \"collection-element.dragend   .collection-elements\": \"_elementDragend\",\n\n            // footer\n            \"change .collection-name\": \"_changeName\",\n            \"keydown .collection-name\": \"_nameCheckForEnter\",\n            \"change .hide-originals\": \"_changeHideOriginals\",\n            \"click .cancel-create\": \"_cancelCreate\",\n            \"click .create-collection\": \"_clickCreate\" //,\n        },\n\n        // ........................................................................ elements\n        /** reset all data to the initial state */\n        reset: function() {\n            this._instanceSetUp();\n            this._elementsSetUp();\n            this.render();\n        },\n\n        /** deselect all elements */\n        clearSelectedElements: function(ev) {\n            this.$(\".collection-elements .collection-element\").removeClass(\"selected\");\n            this.$(\".collection-elements-controls > .clear-selected\").hide();\n        },\n\n        //_dragenterElements : function( ev ){\n        //    //this.debug( '_dragenterElements:', ev );\n        //},\n        //TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n        // _dragleaveElements : function( ev ){\n        //    //this.debug( '_dragleaveElements:', ev );\n        // },\n\n        /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n        _dragoverElements: function(ev) {\n            //this.debug( '_dragoverElements:', ev );\n            ev.preventDefault();\n\n            var $list = this.$list();\n            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n            var $nearest = this._getNearestElement(ev.originalEvent.clientY);\n\n            //TODO: no need to re-create - move instead\n            this.$(\".element-drop-placeholder\").remove();\n            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n            if (!$nearest.length) {\n                $list.append($placeholder);\n            } else {\n                $nearest.before($placeholder);\n            }\n        },\n\n        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n        _checkForAutoscroll: function($element, y) {\n            var AUTOSCROLL_SPEED = 2;\n            var offset = $element.offset();\n            var scrollTop = $element.scrollTop();\n            var upperDist = y - offset.top;\n            var lowerDist = offset.top + $element.outerHeight() - y;\n            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n            }\n        },\n\n        /** get the nearest element based on the mouse's Y coordinate.\n         *  If the y is at the end of the list, return an empty jQuery object.\n         */\n        _getNearestElement: function(y) {\n            var WIGGLE = 4;\n\n            var lis = this.$(\".collection-elements li.collection-element\").toArray();\n\n            for (var i = 0; i < lis.length; i++) {\n                var $li = $(lis[i]);\n                var top = $li.offset().top;\n                var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n                if (top + halfHeight > y && top - halfHeight < y) {\n                    return $li;\n                }\n            }\n            return $();\n        },\n\n        /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n        _dropElements: function(ev) {\n            if (ev.originalEvent) {\n                ev = ev.originalEvent;\n            }\n            // both required for firefox\n            ev.preventDefault();\n            ev.dataTransfer.dropEffect = \"move\";\n\n            // insert before the nearest element or after the last.\n            var $nearest = this._getNearestElement(ev.clientY);\n            if ($nearest.length) {\n                this.$dragging.insertBefore($nearest);\n            } else {\n                // no nearest before - insert after last element\n                this.$dragging.insertAfter(this.$(\".collection-elements .collection-element\").last());\n            }\n            // resync the creator's list based on the new DOM order\n            this._syncOrderToDom();\n            return false;\n        },\n\n        /** resync the creator's list of elements based on the DOM order */\n        _syncOrderToDom: function() {\n            var creator = this;\n            var newElements = [];\n            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n            this.$(\".collection-elements .collection-element\").each(function() {\n                var id = $(this).attr(\"data-element-id\");\n\n                var element = _.findWhere(creator.workingElements, {\n                    id: id\n                });\n\n                if (element) {\n                    newElements.push(element);\n                } else {\n                    console.error(\"missing element: \", id);\n                }\n            });\n            this.workingElements = newElements;\n            this._renderList();\n        },\n\n        /** drag communication with element sub-views: dragstart */\n        _elementDragstart: function(ev, element) {\n            // auto select the element causing the event and move all selected\n            element.select(true);\n            this.$dragging = this.$(\".collection-elements .collection-element.selected\");\n        },\n\n        /** drag communication with element sub-views: dragend - remove the placeholder */\n        _elementDragend: function(ev, element) {\n            $(\".element-drop-placeholder\").remove();\n            this.$dragging = null;\n        },\n\n        // ------------------------------------------------------------------------ templates\n        //TODO: move to require text plugin and load these as text\n        //TODO: underscore currently unnecc. bc no vars are used\n        //TODO: better way of localizing text-nodes in long strings\n        /** underscore template fns attached to class */\n        templates: _.extend({}, baseCreator.CollectionCreatorMixin._creatorTemplates, {\n            /** the header (not including help text) */\n            header: _.template(\n                [\n                    '<div class=\"main-help well clear\">',\n                    '<a class=\"more-help\" href=\"javascript:void(0);\">',\n                    _l(\"More help\"),\n                    \"</a>\",\n                    '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">',\n                    _l(\"Less\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"alert alert-dismissable\">',\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ',\n                    'title=\"',\n                    _l(\"Close and show more help\"),\n                    '\" aria-hidden=\"true\">&times;</button>',\n                    '<span class=\"alert-message\"></span>',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** the middle: element list */\n            middle: _.template(\n                [\n                    '<div class=\"collection-elements-controls\">',\n                    '<a class=\"reset\" href=\"javascript:void(0);\" ',\n                    'title=\"',\n                    _l(\"Undo all reordering and discards\"),\n                    '\">',\n                    _l(\"Start over\"),\n                    \"</a>\",\n                    '<a class=\"clear-selected\" href=\"javascript:void(0);\" ',\n                    'title=\"',\n                    _l(\"De-select all selected datasets\"),\n                    '\">',\n                    _l(\"Clear selected\"),\n                    \"</a>\",\n                    \"</div>\",\n                    '<div class=\"collection-elements scroll-container flex-row\">',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** creation and cancel controls */\n            footer: _.template(\n                [\n                    '<div class=\"attributes clear\">',\n                    '<div class=\"clear\">',\n                    '<label class=\"setting-prompt float-right\">',\n                    _l(\"Hide original elements\"),\n                    \"?\",\n                    '<input class=\"hide-originals float-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    \"</div>\",\n                    '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control float-right\" ',\n                    'placeholder=\"',\n                    _l(\"Enter a name for your new collection\"),\n                    '\" />',\n                    '<div class=\"collection-name-prompt float-right\">',\n                    _l(\"Name\"),\n                    \":</div>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options float-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"Create a different kind of collection\"),\n                    ' <span class=\"caret\"></span>',\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<li><a href=\"#\">',\n                    _l(\"Create a <i>single</i> pair\"),\n                    \"</a></li>\",\n                    '<li><a href=\"#\">',\n                    _l(\"Create a list of <i>unpaired</i> datasets\"),\n                    \"</a></li>\",\n                    \"</ul>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"main-options float-right\">',\n                    '<button class=\"create-collection btn btn-primary\">',\n                    _l(\"Create list\"),\n                    \"</button>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** help content */\n            helpContent: _.template(\n                [\n                    \"<p>\",\n                    _l(\n                        [\n                            \"Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and \",\n                            \"workflows in order to have analyses done on each member of the entire group. This interface allows \",\n                            \"you to create a collection and re-order the final collection.\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<ul>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Rename elements in the list by clicking on \",\n                            '<i data-target=\".collection-element .name\">the existing name</i>.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Discard elements from the final created list by clicking on the \",\n                            '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Reorder the list by clicking and dragging elements. Select multiple elements by clicking on \",\n                            '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ',\n                            \"entire group. Deselect them by clicking them again or by clicking the \",\n                            'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            'Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ',\n                            \"the interface.\"\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        ['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\n                            \"\"\n                        )\n                    ),\n                    \"</li>\",\n                    \"</ul><br />\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                            'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\"\n                ].join(\"\")\n            ),\n\n            /** shown in list when all elements are discarded */\n            invalidElements: _.template(\n                [\n                    _l(\"The following selections could not be included due to problems:\"),\n                    \"<ul><% _.each( problems, function( problem ){ %>\",\n                    \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                    \"<% }); %></ul>\"\n                ].join(\"\")\n            ),\n\n            /** shown in list when all elements are discarded */\n            noElementsLeft: _.template(\n                [\n                    '<li class=\"no-elements-left-message\">',\n                    _l(\"No elements left! \"),\n                    _l(\"Would you like to \"),\n                    '<a class=\"reset\" href=\"javascript:void(0)\">',\n                    _l(\"start over\"),\n                    \"</a>?\",\n                    \"</li>\"\n                ].join(\"\")\n            ),\n\n            /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n            invalidInitial: _.template(\n                [\n                    '<div class=\"header flex-row no-flex\">',\n                    '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                    \"<% if( _.size( problems ) ){ %>\",\n                    _l(\"The following selections could not be included due to problems\"),\n                    \":\",\n                    \"<ul><% _.each( problems, function( problem ){ %>\",\n                    \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                    \"<% }); %></ul>\",\n                    \"<% } else if( _.size( elements ) < 1 ){ %>\",\n                    _l(\"No datasets were selected\"),\n                    \".\",\n                    \"<% } %>\",\n                    \"<br />\",\n                    _l(\"At least one element is needed for the collection\"),\n                    \". \",\n                    _l(\"You may need to \"),\n                    '<a class=\"cancel-create\" href=\"javascript:void(0)\">',\n                    _l(\"cancel\"),\n                    \"</a> \",\n                    _l(\"and reselect new elements\"),\n                    \".\",\n                    \"</span>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"footer flex-row no-flex\">',\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options float-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    // _l( 'Create a different kind of collection' ),\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            )\n        }),\n\n        // ------------------------------------------------------------------------ misc\n        /** string rep */\n        toString: function() {\n            return \"ListCollectionCreator\";\n        }\n    });\n\nconst collectionCreatorModalSetup = function _collectionCreatorModalSetup(options) {\n    const deferred = jQuery.Deferred();\n    let Galaxy = getGalaxyInstance();\n    const modal = Galaxy.modal || new UI_MODAL.View();\n\n    const creatorOptions = _.defaults(options || {}, {\n        oncancel: function() {\n            modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function(creator, response) {\n            modal.hide();\n            deferred.resolve(response);\n        }\n    });\n\n    const showEl = function(el) {\n        modal.show({\n            title: options.title || _l(\"Create a collection\"),\n            body: el,\n            width: \"85%\",\n            height: \"100%\",\n            xlarge: true,\n            closing_events: true\n        });\n    };\n\n    return { deferred, creatorOptions, showEl };\n};\n\n//=============================================================================\n/** Create a modal and load its body with the given CreatorClass creator type\n *  @returns {Deferred} resolved when creator has built a collection.\n */\nvar collectionCreatorModal = function _collectionCreatorModal(elements, options, CreatorClass) {\n    options = _.defaults(options || {}, {\n        elements: elements\n    });\n    const { deferred, creatorOptions, showEl } = collectionCreatorModalSetup(options);\n    var creator = new CreatorClass(creatorOptions);\n    showEl(creator.$el);\n    creator.render();\n    return deferred;\n};\n\nvar ruleBasedCollectionCreatorModal = function _ruleBasedCollectionCreatorModal(\n    elements,\n    elementsType,\n    importType,\n    options\n) {\n    // importType in [datasets, collection]\n    // elementsType in [raw, ftp, datasets]\n    let title;\n    if (importType == \"datasets\") {\n        title = _l(\"Build Rules for Uploading Datasets\");\n    } else if (elementsType == \"collection_contents\") {\n        title = _l(\"Build Rules for Applying to Existing Collection\");\n    } else if (elementsType == \"datasets\" || elementsType == \"library_datasets\") {\n        title = _l(\"Build Rules for Creating Collection(s)\");\n    } else {\n        title = _l(\"Build Rules for Uploading Collections\");\n    }\n    options = _.defaults(options || {}, {\n        title: title\n    });\n    const { deferred, creatorOptions, showEl } = collectionCreatorModalSetup(options); // eslint-disable-line no-unused-vars\n    return import(/* webpackChunkName: \"ruleCollectionBuilder\" */ \"components/RuleCollectionBuilder.vue\").then(\n        module => {\n            var ruleCollectionBuilderInstance = Vue.extend(module.default);\n            var vm = document.createElement(\"div\");\n            showEl(vm);\n            new ruleCollectionBuilderInstance({\n                propsData: {\n                    initialElements: elements,\n                    elementsType: elementsType,\n                    importType: importType,\n                    ftpUploadSite: options.ftpUploadSite,\n                    creationFn: options.creationFn,\n                    oncancel: options.oncancel,\n                    oncreate: options.oncreate,\n                    defaultHideSourceItems: options.defaultHideSourceItems,\n                    saveRulesFn: options.saveRulesFn,\n                    initialRules: options.initialRules\n                }\n            }).$mount(vm);\n            return deferred;\n        }\n    );\n};\n\n/** List collection flavor of collectionCreatorModal. */\nvar listCollectionCreatorModal = function _listCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = _l(\"Create a collection from a list of datasets\");\n    return collectionCreatorModal(elements, options, ListCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a list collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createListCollection(contents, defaultHideSourceItems) {\n    const elements = contents.toJSON();\n    const copyElements = !defaultHideSourceItems;\n    const promise = listCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function(elements, name, hideSourceItems) {\n            elements = elements.map(element => ({\n                id: element.id,\n                name: element.name,\n                //TODO: this allows for list:list even if the filter above does not - reconcile\n                src: element.history_content_type === \"dataset\" ? \"hda\" : \"hdca\"\n            }));\n            return contents.createHDCA(elements, \"list\", name, hideSourceItems, copyElements);\n        }\n    });\n\n    return promise;\n}\n\nfunction createCollectionViaRules(selection, defaultHideSourceItems) {\n    let elements, elementsType, importType;\n    const selectionType = selection.selectionType;\n    const copyElements = !defaultHideSourceItems;\n    if (!selectionType) {\n        // Have HDAs from the history panel.\n        elements = selection.toJSON();\n        elementsType = \"datasets\";\n        importType = \"collections\";\n    } else if (selection.elements) {\n        elementsType = selection.selectionType;\n        importType = selection.dataType || \"collections\";\n        elements = selection.elements;\n    } else {\n        const hasNonWhitespaceChars = RegExp(/[^\\s]/);\n        // Have pasted data, data from a history dataset, or FTP list.\n        const lines = selection.content\n            .split(/[\\n\\r]/)\n            .filter(line => line.length > 0 && hasNonWhitespaceChars.exec(line));\n\n        // Really poor tabular parser - we should get a library for this or expose options? I'm not\n        // sure.\n        let hasTabs = false;\n        if (lines.length > 0) {\n            const firstLine = lines[0];\n            if (firstLine.indexOf(\"\\t\") >= 0) {\n                hasTabs = true;\n            }\n        }\n        const regex = hasTabs ? /\\t/ : /\\s+/;\n        elements = lines.map(line => line.split(regex));\n        elementsType = selection.selectionType;\n        importType = selection.dataType || \"collections\";\n    }\n    const promise = ruleBasedCollectionCreatorModal(elements, elementsType, importType, {\n        ftpUploadSite: selection.ftpUploadSite,\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function(elements, collectionType, name, hideSourceItems) {\n            return selection.createHDCA(elements, collectionType, name, hideSourceItems, copyElements);\n        }\n    });\n    return promise;\n}\n\n//==============================================================================\nexport default {\n    DatasetCollectionElementView: DatasetCollectionElementView,\n    ListCollectionCreator: ListCollectionCreator,\n    collectionCreatorModal: collectionCreatorModal,\n    listCollectionCreatorModal: listCollectionCreatorModal,\n    createListCollection: createListCollection,\n    createCollectionViaRules: createCollectionViaRules,\n    ruleBasedCollectionCreatorModal: ruleBasedCollectionCreatorModal\n};\n","import _ from \"underscore\";\n\nfunction get(key, queryString) {\n    queryString = queryString || window.location.search.substr(1);\n    var keyRegex = new RegExp(`${key}=([^&#$]+)`, \"g\");\n    var matches = queryString.match(keyRegex);\n    if (!matches || !matches.length) {\n        return undefined;\n    }\n    matches = _.map(matches, match => decodeURIComponent(match.substr(key.length + 1).replace(/\\+/g, \" \")));\n    if (matches.length === 1) {\n        return matches[0];\n    }\n    return matches;\n}\n\nfunction parse(queryString) {\n    if (!queryString) {\n        return {};\n    }\n    var parsed = {};\n    var split = queryString.split(\"&\");\n    split.forEach(pairString => {\n        var pair = pairString.split(\"=\");\n        parsed[pair[0]] = decodeURI(pair[1]);\n    });\n    return parsed;\n}\n\n// ============================================================================\nexport default {\n    get: get,\n    parse: parse\n};\n","/**\n * There's a bunch of little init scripts running around. They will become part\n * of the mounting logic for components one day, but for now I want them out of\n * the python templates.\n *\n * You can add more init functions using addInitialization either from a python\n * template, or from anywhere else in the code if you import the loadConfig\n * file.\n *\n * In a python template (the config object is attached to window in the browser):\n *    config.addInitialiation(function (galaxyInstance, config) { // your init } )\n * In any webpack script:\n *    import { addInitialization } from \"onload\";\n *    addInitialization((galaxyInstance, config) => { // do things });\n */\n\nimport { BehaviorSubject } from \"rxjs\";\nimport { filter } from \"rxjs/operators\";\n\nconst queue = new BehaviorSubject([]);\n\n// don't emit unless there are things to initialize\nexport const initializations$ = queue.pipe(filter(list => list.length > 0));\n\nexport const addInitialization = (...fns) => {\n    let nextInits = [...queue.getValue(), ...fns];\n    queue.next(nextInits);\n};\n\nexport const prependInitialization = (...fns) => {\n    let nextInits = [...fns, ...queue.getValue()];\n    queue.next(nextInits);\n};\n\nexport const clearInitQueue = () => queue.next([]);\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport util_mod from \"viz/trackster/util\";\nimport { getGalaxyInstance } from \"app\";\n\n/**\n * A configuration setting. Currently key is used as id.\n */\nvar ConfigSetting = Backbone.Model.extend({\n    initialize: function(options) {\n        // Use key as id for now.\n        var key = this.get(\"key\");\n        this.set(\"id\", key);\n\n        // Set defaults based on key.\n        var defaults = _.find(\n            [\n                {\n                    key: \"name\",\n                    label: \"Name\",\n                    type: \"text\",\n                    default_value: \"\"\n                },\n                {\n                    key: \"color\",\n                    label: \"Color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"min_value\",\n                    label: \"Min Value\",\n                    type: \"float\",\n                    default_value: null\n                },\n                {\n                    key: \"max_value\",\n                    label: \"Max Value\",\n                    type: \"float\",\n                    default_value: null\n                },\n                {\n                    key: \"mode\",\n                    type: \"string\",\n                    default_value: this.mode,\n                    hidden: true\n                },\n                {\n                    key: \"height\",\n                    type: \"int\",\n                    default_value: 32,\n                    hidden: true\n                },\n                {\n                    key: \"pos_color\",\n                    label: \"Positive Color\",\n                    type: \"color\",\n                    default_value: \"#FF8C00\"\n                },\n                {\n                    key: \"neg_color\",\n                    label: \"Negative Color\",\n                    type: \"color\",\n                    default_value: \"#4169E1\"\n                },\n                {\n                    key: \"block_color\",\n                    label: \"Block color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"label_color\",\n                    label: \"Label color\",\n                    type: \"color\",\n                    default_value: \"black\"\n                },\n                {\n                    key: \"show_insertions\",\n                    label: \"Show insertions\",\n                    type: \"bool\",\n                    default_value: false\n                },\n                {\n                    key: \"show_counts\",\n                    label: \"Show summary counts\",\n                    type: \"bool\",\n                    default_value: true\n                },\n                {\n                    key: \"reverse_strand_color\",\n                    label: \"Antisense strand color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"show_differences\",\n                    label: \"Show differences only\",\n                    type: \"bool\",\n                    default_value: true\n                }\n            ],\n            s => s.key === key\n        );\n        if (defaults) {\n            this.set(_.extend({}, defaults, options));\n        }\n\n        if (this.get(\"value\") === undefined && this.get(\"default_value\") !== undefined) {\n            // Use default to set value (if present).\n            this.set_value(this.get(\"default_value\"));\n\n            // If no default value for color config, set random color.\n            if (!this.get(\"value\") && this.get(\"type\") === \"color\") {\n                // For color setting, set random color.\n                this.set(\"value\", util_mod.get_random_color());\n            }\n        }\n    },\n\n    /**\n     * Cast and set value. This should be instead of\n     *  setting.set('value', new_value)\n     */\n    set_value: function(value, options) {\n        var type = this.get(\"type\");\n\n        if (type === \"float\") {\n            value = parseFloat(value);\n        } else if (type === \"int\") {\n            value = parseInt(value, 10);\n        }\n        // TODO: handle casting from string to bool?\n\n        this.set({ value: value }, options);\n    }\n});\n\n/**\n * Collection of config settings.\n */\nvar ConfigSettingCollection = Backbone.Collection.extend(\n    {\n        model: ConfigSetting,\n\n        /**\n         * Save settings as a dictionary of key-value pairs.\n         * This function is needed for backwards compatibility.\n         */\n        to_key_value_dict: function() {\n            var rval = {};\n            this.each(setting => {\n                rval[setting.get(\"key\")] = setting.get(\"value\");\n            });\n\n            return rval;\n        },\n\n        /**\n         * Returns value for a given key. Returns undefined if there is no setting with the specified key.\n         */\n        get_value: function(key) {\n            var s = this.get(key);\n            if (s) {\n                return s.get(\"value\");\n            }\n\n            return undefined;\n        },\n\n        /**\n         * Set value for a setting.\n         */\n        set_value: function(key, value, options) {\n            var s = this.get(key);\n            if (s) {\n                return s.set_value(value, options);\n            }\n\n            return undefined;\n        },\n\n        /**\n         * Set default value for a setting.\n         */\n        set_default_value: function(key, default_value) {\n            var s = this.get(key);\n            if (s) {\n                return s.set(\"default_value\", default_value);\n            }\n\n            return undefined;\n        }\n    },\n    {\n        /**\n         * Utility function that creates a ConfigSettingsCollection from a set of models\n         * and a saved_values dictionary.\n         */\n        from_models_and_saved_values: function(models, saved_values) {\n            // If there are saved values, copy models and update with saved values.\n            if (saved_values) {\n                models = _.map(models, m => _.extend({}, m, { value: saved_values[m.key] }));\n            }\n\n            return new ConfigSettingCollection(models);\n        }\n    }\n);\n\n/**\n * Viewer for config settings collection.\n */\nvar ConfigSettingCollectionView = Backbone.View.extend({\n    className: \"config-settings-view\",\n\n    /**\n     * Renders form for editing configuration settings.\n     */\n    render: function() {\n        var container = this.$el;\n\n        this.collection.each((param, index) => {\n            // Hidden params have no representation in the form\n            if (param.get(\"hidden\")) {\n                return;\n            }\n\n            // Build row for param.\n            var id = `param_${index}`;\n\n            var type = param.get(\"type\");\n            var value = param.get(\"value\");\n            var row = $(\"<div class='form-row' />\").appendTo(container);\n            row.append(\n                $(\"<label />\")\n                    .attr(\"for\", id)\n                    .text(`${param.get(\"label\")}:`)\n            );\n            // Draw parameter as checkbox\n            if (type === \"bool\") {\n                row.append(\n                    $('<input type=\"checkbox\" />')\n                        .attr(\"id\", id)\n                        .attr(\"name\", id)\n                        .attr(\"checked\", value)\n                );\n            } else if (type === \"text\") {\n                // Draw parameter as textbox\n                row.append(\n                    $('<input type=\"text\"/>')\n                        .attr(\"id\", id)\n                        .val(value)\n                        .click(function() {\n                            $(this).select();\n                        })\n                );\n            } else if (type === \"select\") {\n                // Draw parameter as select area\n                var select = $(\"<select />\").attr(\"id\", id);\n                _.each(param.get(\"options\"), option => {\n                    $(\"<option/>\")\n                        .text(option.label)\n                        .attr(\"value\", option.value)\n                        .appendTo(select);\n                });\n                select.val(value);\n                row.append(select);\n            } else if (type === \"color\") {\n                // Draw parameter as color picker\n                var container_div = $(\"<div/>\").appendTo(row);\n\n                var input = $(\"<input />\")\n                    .attr(\"id\", id)\n                    .attr(\"name\", id)\n                    .val(value)\n                    .css(\"float\", \"left\")\n                    .appendTo(container_div)\n                    .click(function(e) {\n                        // Hide other pickers.\n                        $(\".tooltip\").removeClass(\"in\");\n\n                        // Show input's color picker.\n                        var tip = $(this)\n                            .siblings(\".tooltip\")\n                            .addClass(\"in\");\n                        tip.css({\n                            // left: $(this).position().left + ( $(input).width() / 2 ) - 60,\n                            // top: $(this).position().top + $(this.height)\n                            left: $(this).position().left + $(this).width() + 5,\n                            top: $(this).position().top - $(tip).height() / 2 + $(this).height() / 2\n                        }).show();\n\n                        // Click management:\n\n                        // Keep showing tip if clicking in tip.\n                        tip.click(e => {\n                            e.stopPropagation();\n                        });\n\n                        // Hide tip if clicking outside of tip.\n                        $(document).bind(\"click.color-picker\", () => {\n                            tip.hide();\n                            $(document).unbind(\"click.color-picker\");\n                        });\n\n                        // No propagation to avoid triggering document click (and tip hiding) above.\n                        e.stopPropagation();\n                    });\n                // Icon for setting a new random color; behavior set below.\n                var new_color_icon = $(\"<a href='javascript:void(0)'/>\")\n                    .addClass(\"icon-button arrow-circle\")\n                    .appendTo(container_div)\n                    .attr(\"title\", \"Set new random color\")\n                    .tooltip();\n\n                // Color picker in tool tip style.\n                var tip = $(\"<div class='tooltip right' style='position: absolute;' />\")\n                    .appendTo(container_div)\n                    .hide();\n\n                // Inner div for padding purposes\n                var tip_inner = $(\"<div class='tooltip-inner' style='text-align: inherit'></div>\").appendTo(tip);\n\n                $(\"<div class='tooltip-arrow'></div>\").appendTo(tip);\n\n                var farb_obj = $.farbtastic(tip_inner, {\n                    width: 100,\n                    height: 100,\n                    callback: input,\n                    color: value\n                });\n\n                // Clear floating.\n                container_div.append($(\"<div/>\").css(\"clear\", \"both\"));\n\n                // Use function to fix farb_obj value.\n                (fixed_farb_obj => {\n                    new_color_icon.click(() => {\n                        fixed_farb_obj.setColor(util_mod.get_random_color());\n                    });\n                })(farb_obj);\n            } else {\n                row.append(\n                    $(\"<input />\")\n                        .attr(\"id\", id)\n                        .attr(\"name\", id)\n                        .val(value)\n                );\n            }\n            // Help text\n            if (param.help) {\n                row.append($(\"<div class='help'/>\").text(param.help));\n            }\n        });\n\n        return this;\n    },\n\n    /**\n     * Render view in modal.\n     */\n    render_in_modal: function(title) {\n        // Set up handlers for cancel, ok button and for handling esc key.\n        var self = this;\n        let Galaxy = getGalaxyInstance();\n\n        var cancel_fn = () => {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n        };\n\n        var ok_fn = () => {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n            self.update_from_form();\n        };\n\n        var check_enter_esc = e => {\n            if ((e.keyCode || e.which) === 27) {\n                // Escape key\n                cancel_fn();\n            } else if ((e.keyCode || e.which) === 13) {\n                // Enter key\n                ok_fn();\n            }\n        };\n\n        // Set keypress handler.\n        $(window).bind(\"keypress.check_enter_esc\", check_enter_esc);\n\n        // Show modal.\n        if (this.$el.children().length === 0) {\n            this.render();\n        }\n        Galaxy.modal.show({\n            title: title || \"Configure\",\n            body: this.$el,\n            buttons: {\n                Cancel: cancel_fn,\n                OK: ok_fn\n            }\n        });\n    },\n\n    /**\n     * Update settings with new values entered via form.\n     */\n    update_from_form: function() {\n        var self = this;\n        this.collection.each((setting, index) => {\n            if (!setting.get(\"hidden\")) {\n                // Set value from view.\n                var id = `param_${index}`;\n                var value = self.$el.find(`#${id}`).val();\n                if (setting.get(\"type\") === \"bool\") {\n                    value = self.$el.find(`#${id}`).is(\":checked\");\n                }\n                setting.set_value(value);\n            }\n        });\n    }\n});\n\nexport default {\n    ConfigSetting: ConfigSetting,\n    ConfigSettingCollection: ConfigSettingCollection,\n    ConfigSettingCollectionView: ConfigSettingCollectionView\n};\n","import _ from \"underscore\";\nimport DATASET from \"mvc/dataset/dataset-model\";\nimport HISTORY_CONTENT from \"mvc/history/history-content-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\n\n//==============================================================================\nvar _super = DATASET.DatasetAssociation;\n\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n */\nvar HistoryDatasetAssociation = _super.extend(\n    BASE_MVC.mixin(\n        hcontentMixin,\n        /** @lends HistoryDatasetAssociation.prototype */ {\n            /** default attributes for a model */\n            defaults: _.extend({}, _super.prototype.defaults, hcontentMixin.defaults, {\n                history_content_type: \"dataset\",\n                model_class: \"HistoryDatasetAssociation\"\n            })\n        }\n    )\n);\n\n//==============================================================================\nexport default {\n    HistoryDatasetAssociation: HistoryDatasetAssociation\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nexport default Backbone.Model.extend({\n    defaults: {\n        url_base: \"\",\n        title_id: undefined,\n        async: false,\n        async_ops: [],\n        categorical_filters: [],\n        filters: {},\n        sort_key: null,\n        show_item_checkboxes: false,\n        advanced_search: false,\n        cur_page: 1,\n        num_pages: 1,\n        operation: undefined,\n        item_ids: undefined\n    },\n\n    /**\n     * Add filtering criterion.\n     */\n    add_filter: function(key, value, append) {\n        // Update URL arg with new condition.\n        if (append) {\n            // Update or append value.\n            var cur_val = this.attributes.filters[key];\n\n            var new_val;\n            if (cur_val === null || cur_val === undefined) {\n                new_val = value;\n            } else if (typeof cur_val == \"string\") {\n                if (cur_val == \"All\" || cur_val == value) {\n                    new_val = value;\n                } else {\n                    // Replace string with array.\n                    var values = [];\n                    values[0] = cur_val;\n                    values[1] = value;\n                    new_val = values;\n                }\n            } else {\n                // Current value is an array.\n                new_val = cur_val;\n                if (new_val.indexOf(value) === -1) {\n                    new_val.push(value);\n                }\n            }\n            this.attributes.filters[key] = new_val;\n        } else {\n            // Replace value.\n            this.attributes.filters[key] = value;\n        }\n    },\n\n    /**\n     * Remove filtering criterion.\n     */\n    remove_filter: function(key, condition) {\n        var cur_val = this.attributes.filters[key];\n        if (cur_val === null || cur_val === undefined) {\n            return false;\n        }\n\n        if (typeof cur_val === \"string\") {\n            // overwrite/remove condition.\n            this.attributes.filters[key] = \"\";\n        } else {\n            // filter contains an array of conditions.\n            var condition_index = _.indexOf(cur_val, condition);\n            if (condition_index !== -1) {\n                cur_val[condition_index] = \"\";\n            }\n        }\n    },\n\n    /**\n     * Returns URL data for obtaining a new grid.\n     */\n    get_url_data: function() {\n        var url_data = {\n            async: this.attributes.async,\n            sort: this.attributes.sort_key,\n            page: this.attributes.cur_page,\n            show_item_checkboxes: this.attributes.show_item_checkboxes,\n            advanced_search: this.attributes.advanced_search\n        };\n\n        // Add operation, item_ids only if they have values.\n        if (this.attributes.operation) {\n            url_data.operation = this.attributes.operation;\n        }\n        if (this.attributes.item_ids) {\n            url_data.id = this.attributes.item_ids;\n        }\n\n        // Add filter arguments to data, placing \"f-\" in front of all arguments.\n        var self = this;\n        _.each(_.pairs(self.attributes.filters), k => {\n            url_data[`f-${k[0]}`] = k[1];\n        });\n        return url_data;\n    },\n\n    // Return URL for obtaining a new grid\n    get_url: function(args) {\n        return `${this.get(\"url_base\")}?${$.param(this.get_url_data())}&${$.param(args)}`;\n    }\n});\n","import $ from \"jquery\";\nimport Utils from \"utils/utils\";\nimport _ from \"underscore\";\n\n// grid view templates\nexport default {\n    // template\n    grid: function(options) {\n        let tmpl;\n        if (options.embedded) {\n            tmpl = this.grid_header(options) + this.grid_table(options);\n        } else {\n            tmpl = `\n                <div class=\"loading-elt-overlay\"></div>\n                <table class=\"grid-table\">\n                    <tr>\n                        <td width=\"75%\">${this.grid_header(options)}</td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td width=\"100%\" id=\"grid-message\" valign=\"top\"></td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                </table>\n                ${this.grid_table(options)}\n            `;\n        }\n\n        // add info text\n        if (options.info_text) {\n            tmpl += `<br><div class=\"toolParamHelp\" style=\"clear: both;\">${options.info_text}</div>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    grid_table: function() {\n        return `\n            <form method=\"post\" onsubmit=\"return false;\">\n                <table id=\"grid-table\" class=\"grid\">\n                    <thead id=\"grid-table-header\"></thead>\n                    <tbody id=\"grid-table-body\"></tbody>\n                    <tfoot id=\"grid-table-footer\"></tfoot>\n                </table>\n            </form>`;\n    },\n\n    // template\n    grid_header: function(options) {\n        var tmpl = '<div class=\"grid-header\">';\n        if (!options.embedded) {\n            let id_str = \"\";\n            if (options.title_id) {\n                id_str += ` id=\"${options.title_id}\"`;\n            }\n            tmpl += `<h2${id_str}>${options.title}</h2>`;\n        }\n        if (options.global_actions) {\n            tmpl += '<ul class=\"manage-table-actions\">';\n            var show_popup = options.global_actions.length >= 3;\n            if (show_popup) {\n                tmpl +=\n                    '<li><a class=\"action-button\" id=\"popup-global-actions\" class=\"menubutton\">Actions</a></li>' +\n                    '<div popupmenu=\"popup-global-actions\">';\n            }\n            for (let action of options.global_actions) {\n                tmpl += `<li><a class=\"action-button use-target\" target=\"${action.target}\" href=\"${\n                    action.url_args\n                }\" onclick=\"return false;\" >${action.label}</a></li>`;\n            }\n            if (show_popup) {\n                tmpl += \"</div>\";\n            }\n            tmpl += \"</ul>\";\n        }\n        if (options.insert) {\n            tmpl += options.insert;\n        }\n\n        // add grid filters\n        tmpl += this.grid_filters(options);\n        tmpl += \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    header: function(options) {\n        // start\n        var tmpl = \"<tr>\";\n\n        // add checkbox\n        if (options.show_item_checkboxes) {\n            tmpl += \"<th>\";\n            if (options.items.length > 0) {\n                tmpl +=\n                    '<input type=\"checkbox\" id=\"check_all\" name=select_all_checkbox value=\"true\">' +\n                    '<input type=\"hidden\" name=select_all_checkbox value=\"true\">';\n            }\n            tmpl += \"</th>\";\n        }\n\n        // create header elements\n        for (let column of options.columns) {\n            if (column.visible) {\n                tmpl += `<th id=\"${column.key}-header\">`;\n                if (column.sortable) {\n                    tmpl += `<a href=\"javascript:void(0)\" class=\"sort-link\" sort_key=\"${column.key}\">${\n                        column.label\n                    }</a>`;\n                } else {\n                    tmpl += column.label;\n                }\n                tmpl += `<span class=\"sort-arrow\">${column.extra}</span></th>`;\n            }\n        }\n\n        // finalize\n        tmpl += \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    body: function(options) {\n        // initialize\n        var tmpl = \"\";\n        var items_length = options.items.length;\n\n        // empty grid?\n        if (items_length === 0) {\n            // No results.\n            tmpl += '<tr><td colspan=\"100\"><em>No Items</em></td></tr>';\n        }\n\n        // create rows\n        for (let item of options.items) {\n            // Tag current\n            tmpl += \"<tr \";\n            if (options.current_item_id == item.id) {\n                tmpl += 'class=\"current\"';\n            }\n            tmpl += \">\";\n\n            // Item selection column\n            if (options.show_item_checkboxes) {\n                tmpl += `<td style=\"width: 1.5em;\"><input type=\"checkbox\" name=\"id\" value=\"${item.encode_id}\" id=\"${\n                    item.encode_id\n                }\" class=\"grid-row-select-checkbox\" /></td>`;\n            }\n\n            // Data columns\n            for (let column of options.columns) {\n                if (column.visible) {\n                    // Nowrap\n                    var nowrap = \"\";\n                    if (column.nowrap) {\n                        nowrap = 'style=\"white-space:nowrap;\"';\n                    }\n\n                    // get column settings\n                    var column_settings = item.column_config[column.label];\n\n                    // load attributes\n                    var link = column_settings.link;\n                    var value = column_settings.value;\n                    var target = column_settings.target;\n\n                    // unescape value\n                    if ($.type(value) === \"string\") {\n                        value = value.replace(/\\/\\//g, \"/\");\n                    }\n\n                    // Attach popup menu?\n                    var popup_id = \"\";\n                    if (column.attach_popup) {\n                        popup_id = `grid-${item.encode_id}-popup`;\n                    }\n\n                    // Check for row wrapping\n                    tmpl += `<td ${nowrap}>`;\n\n                    // Determine cell content\n                    if (column.delayed) {\n                        tmpl += `<div class=\"delayed-value-${column.key}\" data-id=\"${\n                            item.encode_id\n                        }\" data-value=\"${value}\"><span class=\"fa fa-spinner fa-spin\"></span></div>`;\n                    } else if (column.attach_popup && link) {\n                        tmpl += `<div class=\"btn-group\">\n                                    <button class=\"btn btn-secondary use-target\" target=\"${target}\" href=\"${link}\" onclick=\"return false;\">${value}</button>\n                                    <button id=\"${popup_id}\" class=\"btn btn-secondary dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\"/>\n                                </div>`;\n                    } else if (column.attach_popup) {\n                        tmpl += `<button id=\"${popup_id}\" class=\"btn dropdown-toggle\" data-toggle=\"dropdown\">${value}</button>`;\n                    } else if (link) {\n                        tmpl += `<a class=\"use-target\" target=\"${target}\" href=\"${link}\" onclick=\"return false;\">${value}</a>`;\n                    } else {\n                        tmpl += `<label>${value || \"\"}</label>`;\n                    }\n                    tmpl += \"</td>\";\n                }\n            }\n            tmpl += \"</tr>\";\n        }\n        return tmpl;\n    },\n\n    // template\n    footer: function(options) {\n        // create template string\n        var tmpl = \"\";\n\n        // paging\n        if (options.use_paging && options.num_pages > 1) {\n            // get configuration\n            var num_page_links = options.num_page_links;\n            var cur_page_num = options.cur_page_num;\n            var num_pages = options.num_pages;\n\n            // First pass on min page.\n            var page_link_range = num_page_links / 2;\n            var min_page = cur_page_num - page_link_range;\n            var min_offset = 0;\n            if (min_page <= 0) {\n                // Min page is too low.\n                min_page = 1;\n                min_offset = page_link_range - (cur_page_num - min_page);\n            }\n\n            // Set max page.\n            var max_range = page_link_range + min_offset;\n            var max_page = cur_page_num + max_range;\n            var max_offset;\n            if (max_page <= num_pages) {\n                // Max page is fine.\n                max_offset = 0;\n            } else {\n                // Max page is too high.\n                max_page = num_pages;\n                // +1 to account for the +1 in the loop below.\n                max_offset = max_range - (max_page + 1 - cur_page_num);\n            }\n\n            // Second and final pass on min page to add any unused\n            // offset from max to min.\n            if (max_offset !== 0) {\n                min_page -= max_offset;\n                if (min_page < 1) {\n                    min_page = 1;\n                }\n            }\n\n            // template header\n            tmpl += '<tr id=\"page-links-row\">';\n            if (options.show_item_checkboxes) {\n                tmpl += \"<td></td>\";\n            }\n            tmpl += '<td colspan=\"100\">' + '<span id=\"page-link-container\">' + \"Page:\";\n\n            if (min_page > 1) {\n                tmpl +=\n                    '<span class=\"page-link-grid\" id=\"page-link-1\"><a href=\"javascript:void(0);\" page_num=\"1\" onclick=\"return false;\">1</a></span> ...';\n            }\n\n            // create page urls\n            for (var page_index = min_page; page_index < max_page + 1; page_index++) {\n                if (page_index == options.cur_page_num) {\n                    tmpl += `<span class=\"page-link-grid inactive-link\" id=\"page-link-${page_index}\">${page_index}</span>`;\n                } else {\n                    tmpl += `<span class=\"page-link-grid\" id=\"page-link-${page_index}\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${page_index}\">${page_index}</a></span>`;\n                }\n            }\n\n            // show last page\n            if (max_page < num_pages) {\n                tmpl += `...<span class=\"page-link-grid\" id=\"page-link-${num_pages}\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${num_pages}\">${num_pages}</a></span>`;\n            }\n            tmpl += \"</span>\";\n\n            // Show all link\n            tmpl += `\n                    <span class=\"page-link-grid\" id=\"show-all-link-span\"> | <a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"all\">Show All</a></span>\n                    </td>\n                </tr>`;\n        }\n\n        // Grid operations for multiple items.\n        if (options.show_item_checkboxes) {\n            // start template\n            tmpl += `\n                <tr>\n                    <input type=\"hidden\" id=\"operation\" name=\"operation\" value=\"\">\n                    <td></td>\n                    <td colspan=\"100\">\n                        For <span class=\"grid-selected-count\"></span> selected items: \n            `;\n\n            // configure buttons for operations\n            for (let operation of options.operations) {\n                if (operation.allow_multiple) {\n                    tmpl += `<input type=\"button\" value=\"${\n                        operation.label\n                    }\" class=\"operation-button action-button\">&nbsp;`;\n                }\n            }\n\n            // finalize template\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // count global operations\n        var found_global = false;\n        for (let operation of options.operations) {\n            if (operation.global_operation) {\n                found_global = true;\n                break;\n            }\n        }\n\n        // add global operations\n        if (found_global) {\n            tmpl += \"<tr>\" + '<td colspan=\"100\">';\n            for (let operation of options.operations) {\n                if (operation.global_operation) {\n                    tmpl += `<a class=\"action-button\" href=\"${operation.global_operation}\">${operation.label}</a>`;\n                }\n            }\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // add legend\n        if (options.legend) {\n            tmpl += `<tr><td colspan=\"100\">${options.legend}</td></tr>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    message: function(options) {\n        var status = options.status;\n        if ([\"success\", \"ok\"].indexOf(status) != -1) {\n            status = \"done\";\n        }\n        return `<p><div class=\"${status}message transient-message\">${_.escape(\n            options.message\n        )}</div><div style=\"clear: both\"></div></p>`;\n    },\n\n    // template\n    grid_filters: function(options) {\n        // get filters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n\n        // show advanced search if flag set or if there are filters for advanced search fields\n        var advanced_search_display = \"none\";\n        if (options.advanced_search) {\n            advanced_search_display = \"block\";\n        }\n\n        // identify columns with advanced filtering\n        var show_advanced_search_link = false;\n        for (let column of options.columns) {\n            if (column.filterable == \"advanced\") {\n                var column_key = column.key;\n                var f_key = filters[column_key];\n                var d_key = default_filter_dict[column_key];\n                if (f_key && d_key && f_key != d_key) {\n                    advanced_search_display = \"block\";\n                }\n                show_advanced_search_link = true;\n            }\n        }\n\n        // hide standard search if advanced is shown\n        var standard_search_display = \"block\";\n        if (advanced_search_display == \"block\") {\n            standard_search_display = \"none\";\n        }\n\n        //\n        // standard search\n        //\n        var tmpl = `<div id=\"standard-search\" style=\"display: ${standard_search_display};\"><table><tr><td style=\"padding: 0;\"><table>`;\n\n        // add standard filters\n        for (let column of options.columns) {\n            if (column.filterable == \"standard\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize standard search\n        tmpl += \"</table>\" + \"</td>\" + \"</tr>\" + \"<tr>\" + \"<td>\";\n\n        // show advanced search link in standard display\n        if (show_advanced_search_link) {\n            tmpl += '<a href=\"\" class=\"advanced-search-toggle\">Advanced Search</a>';\n        }\n\n        // finalize standard search display\n        tmpl += \"</td>\" + \"</tr>\" + \"</table>\" + \"</div>\";\n\n        //\n        // advanced search\n        //\n        tmpl += `<div id=\"advanced-search\" style=\"display: ${advanced_search_display}; margin-top: 5px;\"><table><tr><td style=\"text-align: left\" colspan=\"100\"><a href=\"\" class=\"advanced-search-toggle\">Close Advanced Search</a></td></tr>`;\n\n        // add advanced filters\n        for (let column of options.columns) {\n            if (column.filterable == \"advanced\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize advanced search template\n        tmpl += \"</table>\" + \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    grid_column_filter: function(options, column) {\n        // collect parameters\n        var filters = options.filters;\n        var column_label = column.label;\n        var column_key = column.key;\n        if (column.filterable == \"advanced\") {\n            column_label = column_label.toLowerCase();\n        }\n\n        // start\n        var tmpl = \"<tr>\";\n\n        if (column.filterable == \"advanced\") {\n            tmpl += `<td align=\"left\" style=\"padding-left: 10px\">${column_label}:</td>`;\n        }\n        tmpl += '<td style=\"padding-bottom: 1px;\">';\n        if (column.is_text) {\n            tmpl += `<form class=\"text-filter-form\" column_key=\"${column_key}\" action=\"${options.url}\" method=\"get\" >`;\n            // Carry forward filtering criteria with hidden inputs.\n            for (let column of options.columns) {\n                var filter_value = filters[column.key];\n                if (filter_value) {\n                    if (filter_value != \"All\") {\n                        if (column.is_text) {\n                            filter_value = JSON.stringify(filter_value);\n                        }\n                        tmpl += `<input type=\"hidden\" id=\"${column.key}\" name=\"f-${\n                            column.key\n                        }\" value=\"${filter_value}\"/>`;\n                    }\n                }\n            }\n            // Print current filtering criteria and links to delete.\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add filters\n            var column_filter = filters[column_key];\n            if (column_filter) {\n                // identify type\n                var type = $.type(column_filter);\n\n                // single filter value\n                if (type == \"string\") {\n                    if (column_filter != \"All\") {\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter);\n                    }\n                }\n\n                // multiple filter values\n                if (type == \"array\") {\n                    for (let i in column_filter) {\n                        // copy filters and remove entry\n                        var params = column_filter;\n                        params = params.slice(i);\n\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter[i]);\n                    }\n                }\n            }\n\n            // close span\n            tmpl += \"</span>\";\n\n            // Set value, size of search input field. Minimum size is 20 characters.\n            var value = \"\";\n            var size = 20;\n            if (column.filterable == \"standard\") {\n                value = column.label.toLowerCase();\n                if (value.length < 20) {\n                    size = value.length;\n                }\n                // +4 to account for space after placeholder\n                size = size + 4;\n            }\n\n            // print input field for column\n            tmpl += `\n                <span class=\"search-box\">\n                    <input class=\"search-box-input\" id=\"input-${column_key}-filter\" name=\"f-${column_key}\" type=\"text\" placeholder=\"${value}\" size=\"${size}\"/>\n                    <button type=\"submit\" style=\"background: transparent; border: none; padding: 4px; margin: 0px;\">\n                        <i class=\"fa fa-search\"></i>\n                    </button>\n                </span>\n            </form>`;\n        } else {\n            // filter criteria\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add category filters\n            var seperator = false;\n            for (var cf_label in options.categorical_filters[column_key]) {\n                // get category filter\n                var cf = options.categorical_filters[column_key][cf_label];\n\n                // each filter will have only a single argument, so get that single argument\n                var cf_key = \"\";\n                var cf_arg = \"\";\n                for (var key in cf) {\n                    cf_key = key;\n                    cf_arg = cf[key];\n                }\n\n                // add seperator\n                if (seperator) {\n                    tmpl += \" | \";\n                }\n                seperator = true;\n\n                // add category\n                var filter = filters[column_key];\n                if (filter && cf[column_key] && filter == cf_arg) {\n                    tmpl += `<span class=\"categorical-filter ${column_key}-filter current-filter\">${cf_label}</span>`;\n                } else {\n                    tmpl += `<span class=\"categorical-filter ${column_key}-filter\"><a href=\"javascript:void(0);\" filter_key=\"${cf_key}\" filter_val=\"${cf_arg}\">${cf_label}</a></span>`;\n                }\n            }\n            tmpl += \"</span>\";\n        }\n        tmpl += \"</td>\" + \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template for filter items\n    filter_element: function(filter_key, filter_value) {\n        filter_value = Utils.sanitize(filter_value);\n        return `<span class=\"text-filter-val\">${filter_value}<a href=\"javascript:void(0);\" filter_key=\"${filter_key}\" filter_val=\"${filter_value}\"><i class=\"fa fa-times\" style=\"padding-left: 5px; padding-bottom: 6px;\"/></a></span>`;\n    }\n};\n","import Backbone from \"backbone\";\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport { getGalaxyInstance } from \"app\";\nimport Utils from \"utils/utils\";\nimport GridModel from \"mvc/grid/grid-model\";\nimport Templates from \"mvc/grid/grid-template\";\nimport PopupMenu from \"mvc/ui/popup-menu\";\nimport LoadingIndicator from \"ui/loading-indicator\";\nimport { init_refresh_on_change } from \"onload/globalInits/init_refresh_on_change\";\nimport store from \"../../store\";\nimport slugify from \"slugify\";\n\n// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\n$.ajaxSettings.traditional = true;\n\n// grid view\nexport default Backbone.View.extend({\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function(grid_config) {\n        this.grid = new GridModel();\n        this.title = grid_config.title;\n        this.active_tab = grid_config.active_tab;\n        var self = this;\n\n        // Subscribe to changes in the store, currently just storing\n        // tag changes from the tagging components, but that will change\n        // when we rework the grid. This subscription ties this older grid\n        // code to the new vue components\n        store.watch(\n            state => state.gridSearch.searchTags,\n            newTags => {\n                let tagArray = Array.from(newTags);\n                self.grid.add_filter(\"tags\", tagArray, false);\n                self.openAdvancedSearch();\n                self.render_filter_button(\"tags\", tagArray);\n                self.go_page_one();\n                self.execute();\n            }\n        );\n\n        if (grid_config.url_base && !grid_config.items) {\n            LoadingIndicator.markViewAsLoading(this);\n            var url_data = grid_config.url_data || {};\n            _.each(grid_config.filters, (v, k) => {\n                url_data[`f-${k}`] = v;\n            });\n            $.ajax({\n                url: `${grid_config.url_base}?${$.param(url_data)}`,\n                success: function(response) {\n                    response.embedded = grid_config.embedded;\n                    response.filters = grid_config.filters || {};\n                    self.init_grid(response);\n                }\n            });\n        } else {\n            // set element\n            this.setElement(\"<div>\");\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $(\"#center\").css({\n                padding: \"10px\",\n                overflow: \"auto\"\n            });\n        }\n    },\n\n    openAdvancedSearch: function() {\n        var isOpen = $(\"#advanced-search\").is(\":visible\");\n        if (!isOpen) {\n            $(\"#standard-search\").slideToggle(\"fast\");\n            $(\"#advanced-search\").slideToggle(\"fast\");\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function(refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray(\"history\", refresh_frames) > -1) {\n                let Galaxy = getGalaxyInstance();\n                if (Galaxy && Galaxy.currHistoryPanel) {\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function(grid_config) {\n        this.grid.set(grid_config);\n\n        // get options\n        var options = this.grid.attributes;\n\n        if (this.allow_title_display && options.title) {\n            Utils.setWindowTitle(options.title);\n        }\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get(\"url_base\");\n        url = url.replace(/^.*\\/\\/[^/]+/, \"\");\n        this.grid.set(\"url_base\", url);\n\n        // append main template\n        this.$el.html(Templates.grid(options));\n\n        // add a class identifier for styling purposes\n        this.$el.addClass(this.getRootClassName(grid_config));\n\n        // update div contents\n        this.$el.find(\"#grid-table-header\").html(Templates.header(options));\n        this.$el.find(\"#grid-table-body\").html(Templates.body(options));\n        this.$el.find(\"#grid-table-footer\").html(Templates.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find(\"#grid-message\").html(Templates.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                window.setTimeout(() => {\n                    self.$el.find(\"#grid-message\").html(\"\");\n                }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function() {\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find(\".operation-button\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find(\"input[type=text]\").each(function() {\n            $(this).off();\n            $(this)\n                .click(function() {\n                    $(this).select();\n                })\n                .keyup(function() {\n                    $(this).css(\"font-style\", \"normal\");\n                });\n        });\n\n        // Initialize sort links.\n        this.$el.find(\".sort-link\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_sort_condition($(this).attr(\"sort_key\"));\n                return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find(\".text-filter-form\").each(function() {\n            $(this).off();\n            $(this).submit(function() {\n                var column_key = $(this).attr(\"column_key\");\n                var text_input_obj = $(`#input-${column_key}-filter`);\n                var text_input = text_input_obj.val();\n                text_input_obj.val(\"\");\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".text-filter-val > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                // Remove visible element.\n                $(this)\n                    .parent()\n                    .remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".categorical-filter > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_categorical_filter($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find(\".advanced-search-toggle\").each(function() {\n            $(this).off();\n            $(this).click(() => {\n                self.$el.find(\"#standard-search\").slideToggle(\"fast\");\n                self.$el.find(\"#advanced-search\").slideToggle(\"fast\");\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find(\"#check_all\").off();\n        this.$el.find(\"#check_all\").on(\"click\", () => {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements: function() {\n        // Initialize grid selection checkboxes.\n        this.$el.find(\".grid\").each(function() {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = () => {\n                check_count.text($(checkboxes).filter(\":checked\").length);\n            };\n\n            $(checkboxes).each(function() {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find(\".community_rating_star\").length !== 0) this.$el.find(\".community_rating_star\").rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find(\".page-link-grid > a\").each(function() {\n            $(this).click(function() {\n                self.set_page($(this).attr(\"page_num\"));\n                return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find(\".use-target\").each(function() {\n            $(this).click(function() {\n                self.execute({\n                    href: $(this).attr(\"href\"),\n                    target: $(this).attr(\"target\")\n                });\n                return false;\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length === 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each(options.items, (item, index) => {\n            var button = self.$(`#grid-${item.encode_id}-popup`).off();\n            var popup = new PopupMenu(button);\n            _.each(options.operations, operation => {\n                self.add_operation(popup, operation, item);\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    add_operation: function(popup, operation, item) {\n        var self = this;\n        var settings = item.operation_config[operation.label];\n        if (settings.allowed && operation.allow_popup) {\n            popup.addItem({\n                html: operation.label,\n                href: settings.url_args,\n                target: settings.target,\n                confirmation_text: operation.confirm,\n                func: function(e) {\n                    e.preventDefault();\n                    var label = $(e.target).html();\n                    if (operation.onclick) {\n                        operation.onclick(item.encode_id);\n                    } else {\n                        self.execute(this.findItemByHtml(label));\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function(name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        this.render_filter_button(name, value);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    render_filter_button: function(name, value) {\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(Templates.filter_element(name, value));\n        var self = this;\n        t.click(function() {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find(`#${name}-filtering-criteria`);\n        container.append(t);\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function(name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // update vuex if the one criteria we're currently tracking changes\n        if (name == \"tags\") {\n            store.dispatch(\"removeSearchTag\", { text: value });\n        }\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function(col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get(\"sort_key\");\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== \"-\") {\n                new_sort = `-${col_key}`;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find(\".sort-arrow\").remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = new_sort.substring(0, 1) == \"-\" ? \"&uarr;\" : \"&darr;\";\n        var t = $(`<span>${sort_arrow}</span>`).addClass(\"sort-arrow\");\n\n        // Add to header\n        this.$el.find(`#${col_key}-header`).append(t);\n\n        // Update grid.\n        this.grid.set(\"sort_key\", new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function(name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get(\"categorical_filters\")[name];\n\n        var cur_value = this.grid.get(\"filters\")[name];\n        var self = this;\n        this.$el.find(`.${name}-filter`).each(function() {\n            var text = $.trim($(this).text());\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass(\"current-filter\");\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_categorical_filter(name, filter_value);\n                });\n                $(this).removeClass(\"current-filter\");\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function(new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find(\".page-link\").each(function() {\n            var id = $(this).attr(\"id\");\n\n            var // Id has form 'page-link-<page_num>\n                page_num = parseInt(id.split(\"-\")[2], 10);\n\n            var cur_page = self.grid.get(\"cur_page\");\n            var text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this)\n                    .children()\n                    .text();\n                $(this).empty();\n                $(this).addClass(\"inactive-link\");\n                $(this).text(text);\n            } else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass(\"inactive-link\");\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === \"all\") {\n            this.grid.set(\"cur_page\", new_page);\n        } else {\n            this.grid.set(\"cur_page\", parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function(operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (number_of_checked_ids < 1) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {\n            label: operation_name\n        });\n        if (operation && !confirmation_text) {\n            confirmation_text = operation.confirm || \"\";\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find(\"input[name=id]:checked\").each(function() {\n            item_ids.push($(this).val());\n        });\n\n        // execute operation\n        var options = {\n            operation: operation_name,\n            id: item_ids,\n            confirmation_text: confirmation_text\n        };\n        if (operation.target == \"top\" || operation.target == \"center\") {\n            options = _.extend(options, {\n                href: operation.href,\n                target: operation.target\n            });\n        }\n        this.execute(options);\n        return true;\n    },\n\n    check_all_items: function() {\n        var check = this.$(\".grid-row-select-checkbox\");\n        var state = this.$(\"#check_all\").prop(\"checked\");\n        _.each(check, c => {\n            $(c).prop(\"checked\", state);\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function() {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get(\"cur_page\");\n        if (cur_page !== null && cur_page !== undefined && cur_page !== \"all\") {\n            this.grid.set(\"cur_page\", 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function(options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf(\"operation=\") != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf(\"operation\") != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split(\"=\")[1];\n                            operation = operation.replace(/\\+/g, \" \");\n                        } else if (href_parms[index].indexOf(\"id\") != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split(\"=\")[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (\n                confirmation_text &&\n                confirmation_text !== \"\" &&\n                confirmation_text != \"None\" &&\n                confirmation_text != \"null\"\n            )\n                if (!window.confirm(confirmation_text)) return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if (target == \"top\") {\n                window.top.location = `${href}?${$.param(this.grid.get_url_data())}`;\n            } else if (target == \"center\") {\n                $(\"#galaxy_main\").attr(\"src\", `${href}?${$.param(this.grid.get_url_data())}`);\n            } else {\n                this.update_grid();\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        this.update_grid();\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function(target, href) {\n        // get slide status\n        var advanced_search = this.$el.find(\"#advanced-search\").is(\":visible\");\n        this.grid.set(\"advanced_search\", advanced_search);\n\n        // get default url\n        if (!href) {\n            href = `${this.grid.get(\"url_base\")}?${$.param(this.grid.get_url_data())}`;\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined\n        });\n        switch (target) {\n            case \"center\":\n                $(\"#galaxy_main\").attr(\"src\", href);\n                break;\n            case \"top\":\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function() {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = this.grid.get(\"operation\") ? \"POST\" : \"GET\";\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find(\".loading-elt-overlay\").show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get(\"url_base\"),\n            data: self.grid.get_url_data(),\n            error: function() {\n                alert(\"Grid refresh failed\");\n            },\n            success: function(response_text) {\n                // backup\n                var embedded = self.grid.get(\"embedded\");\n                var insert = self.grid.get(\"insert\");\n                var advanced_search = self.$el.find(\"#advanced-search\").is(\":visible\");\n\n                // request new configuration\n                var json = response_text;\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n                json.advanced_search = advanced_search;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find(\".loading-elt-overlay\").hide();\n            },\n            complete: function() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    },\n\n    // Generates a class name at the root of the view that we can\n    // use for conditional styling in the various kinds of grids\n    // instead of acres of if/then statements in javascript\n    getRootClassName({ title = \"grid\" }) {\n        return slugify(title).toLowerCase();\n    }\n});\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport _l from \"utils/localization\";\nimport { getGalaxyInstance } from \"app\";\n\n//TODO: toastr is another possibility - I didn't see where I might add details, tho\n\n/* ============================================================================\nError modals meant to replace the o-so-easy alerts.\n\nThese are currently styled as errormessages but use the Galaxy.modal\ninfrastructure to be shown/closed. They're capable of showing details in a\ntogglable dropdown and the details are formatted in a pre.\n\nExample:\n    errorModal( 'Heres a message', 'A Title', { some_details: 'here' });\n    errorModal( 'Heres a message' ); // no details, title is 'Error'\n\nThere are three specialized forms:\n    offlineErrorModal       a canned response for when there's no connection\n    badGatewayErrorModal    canned response for when Galaxy is restarting\n    ajaxErrorModal          plugable into any Backbone class as an\n        error event handler by accepting the error args: model, xhr, options\n\nExamples:\n    if( navigator.offLine ){ offlineErrorModal(); }\n    if( xhr.status === 502 ){ badGatewayErrorModal(); }\n    this.listenTo( this.model, 'error', ajaxErrorModal );\n\n============================================================================ */\n\nvar CONTACT_MSG = _l(\"Please contact a Galaxy administrator if the problem persists.\");\nvar DEFAULT_AJAX_ERR_MSG = _l(\"An error occurred while updating information with the server.\");\nvar DETAILS_MSG = _l(\"The following information can assist the developers in finding the source of the error:\");\n\n/** private helper that builds the modal and handles adding details */\nfunction _errorModal(message, title, details) {\n    let Galaxy = getGalaxyInstance();\n    // create and return the modal, adding details button only if needed\n    Galaxy.modal.show({\n        title: title,\n        body: message,\n        closing_events: true,\n        buttons: {\n            Ok: function() {\n                Galaxy.modal.hide();\n            }\n        }\n    });\n    Galaxy.modal.$el.addClass(\"error-modal\");\n\n    if (details) {\n        Galaxy.modal\n            .$(\".error-details\")\n            .add(Galaxy.modal.$('button:contains(\"Details\")'))\n            .remove();\n        $(\"<div/>\")\n            .addClass(\"error-details\")\n            .hide()\n            .appendTo(Galaxy.modal.$(\".modal-content\"))\n            .append([$(\"<p/>\").text(DETAILS_MSG), $(\"<pre/>\").text(JSON.stringify(details, null, \"  \"))]);\n\n        $(`<button id=\"button-1\" class=\"float-left\">${_l(\"Details\")}</button>`)\n            .appendTo(Galaxy.modal.$(\".buttons\"))\n            .click(() => {\n                Galaxy.modal.$(\".error-details\").toggle();\n            });\n    }\n    return Galaxy.modal;\n}\n\n/** Display a modal showing an error message but fallback to alert if there's no modal */\nfunction errorModal(message, title, details) {\n    if (!message) {\n        return;\n    }\n\n    let Galaxy = getGalaxyInstance();\n    message = _l(message);\n    title = _l(title) || _l(\"Error:\");\n    if (Galaxy && Galaxy.modal) {\n        return _errorModal(message, title, details);\n    }\n\n    alert(`${title}\\n\\n${message}`);\n    console.log(\"error details:\", JSON.stringify(details));\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal when the user may be offline */\nfunction offlineErrorModal() {\n    return errorModal(_l(\"You appear to be offline. Please check your connection and try again.\"), _l(\"Offline?\"));\n}\n\n// ----------------------------------------------------------------------------\n/** 502 messages that should be displayed when galaxy is restarting */\nfunction badGatewayErrorModal() {\n    return errorModal(\n        `${_l(\"Galaxy is currently unreachable. Please try again in a few minutes.\")} ${CONTACT_MSG}`,\n        _l(\"Cannot connect to Galaxy\")\n    );\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal (with details) about a failed Backbone ajax operation */\nfunction ajaxErrorModal(model, xhr, options, message, title) {\n    message = message || DEFAULT_AJAX_ERR_MSG;\n    message += ` ${CONTACT_MSG}`;\n    title = title || _l(\"An error occurred\");\n    var details = _ajaxDetails(model, xhr, options);\n    return errorModal(message, title, details);\n}\n\n/** build details which may help debugging the ajax call */\nfunction _ajaxDetails(model, xhr, options) {\n    let Galaxy = getGalaxyInstance();\n    return {\n        //TODO: still can't manage Raven id\n        raven: _.result(window.Raven, \"lastEventId\"),\n        userAgent: navigator.userAgent,\n        onLine: navigator.onLine,\n        version: _.result(Galaxy.config, \"version_major\"),\n        xhr: _.omit(xhr, _.functions(xhr)),\n        options: _.omit(options, \"xhr\"),\n        // add ajax data from Galaxy object cache\n        url: _.result(Galaxy.lastAjax, \"url\"),\n        data: _.result(Galaxy.lastAjax, \"data\"),\n        // backbone stuff (auto-redacting email for user)\n        model: _.result(model, \"toJSON\", `${model}`),\n        user: _.omit(_.result(Galaxy.user, \"toJSON\"), \"email\")\n    };\n}\n\n//=============================================================================\nexport default {\n    errorModal: errorModal,\n    offlineErrorModal: offlineErrorModal,\n    badGatewayErrorModal: badGatewayErrorModal,\n    ajaxErrorModal: ajaxErrorModal\n};\n","export function serverPath(rawUrl = window.location.href) {\n    let url = new URL(rawUrl);\n    return url.pathname;\n}\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport { ListItemView, FoldoutListItemView } from \"mvc/list/list-item\";\nimport { DatasetListItemView } from \"mvc/dataset/dataset-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n/** @class Read only view for DatasetCollection.\n */\nvar DCListItemView = FoldoutListItemView.extend(\n    /** @lends DCListItemView.prototype */ {\n        className: `${FoldoutListItemView.prototype.className} dataset-collection`,\n        id: function() {\n            return [\"dataset_collection\", this.model.get(\"id\")].join(\"-\");\n        },\n\n        /** override to add linkTarget */\n        initialize: function(attributes) {\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n            this.hasUser = attributes.hasUser;\n            FoldoutListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            FoldoutListItemView.prototype._setUpListeners.call(this);\n            this.listenTo(this.model, \"change\", function(model, options) {\n                // if the model has changed deletion status render it entirely\n                if (_.has(model.changed, \"deleted\")) {\n                    this.render();\n\n                    // if the model has been decorated after the fact with the element count,\n                    // render the subtitle where the count is displayed\n                } else if (_.has(model.changed, \"element_count\")) {\n                    this.$(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n                }\n            });\n        },\n\n        // ......................................................................... rendering\n        /** render a subtitle to show the user what sort of collection this is */\n        _renderSubtitle: function() {\n            return $(this.templates.subtitle(this.model.toJSON(), this));\n        },\n\n        // ......................................................................... foldout\n        /** override to add linktarget to sub-panel */\n        _getFoldoutPanelOptions: function() {\n            var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call(this);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                hasUser: this.hasUser\n            });\n        },\n\n        /** override to not catch sub-panel selectors */\n        $selector: function() {\n            return this.$(\"> .selector\");\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCListItemView.prototype.templates = (() => {\n    var warnings = _.extend({}, FoldoutListItemView.prototype.templates.warnings, {\n        error: BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            \"<% if( model.error ){ %>\",\n            '<div class=\"errormessagesmall\">',\n            _l(\"There was an error getting the data for this collection\"),\n            \": <%- model.error %>\",\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        purged: BASE_MVC.wrapTemplate([\n            \"<% if( model.purged ){ %>\",\n            '<div class=\"purged-msg warningmessagesmall\">',\n            _l(\"This collection has been deleted and removed from disk\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        deleted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.deleted && !model.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This collection has been deleted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n    });\n\n    // use element identifier\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    // use element identifier\n    var subtitleTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"subtitle\">',\n            '<% var countText = collection.element_count? ( collection.element_count + \" \" ) : \"\"; %>',\n            '<%        if( collection.collection_type === \"list\" ){ %>',\n            _l(\"a list of <%- countText %>datasets\"),\n            '<% } else if( collection.collection_type === \"paired\" ){ %>',\n            _l(\"a pair of datasets\"),\n            '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n            _l(\"a list of <%- countText %>dataset pairs\"),\n            '<% } else if( collection.collection_type === \"list:list\" ){ %>',\n            _l(\"a list of <%- countText %>dataset lists\"),\n            \"<% } %>\",\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    return _.extend({}, FoldoutListItemView.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemView = ListItemView.extend(\n    /** @lends DCEListItemView.prototype */ {\n        /** add the DCE class to the list item */\n        className: `${ListItemView.prototype.className} dataset-collection-element`,\n\n        /** set up */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(\"DCEListItemView.initialize:\", attributes);\n            ListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCEListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCEListItemView.prototype.templates = (() => {\n    // use the element identifier here - since that will persist and the user will need it\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.element_identifier %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemView = DatasetListItemView.extend(\n    /** @lends DatasetDCEListItemView.prototype */ {\n        className: `${DatasetListItemView.prototype.className} dataset-collection-element`,\n\n        /** set up */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(\"DatasetDCEListItemView.initialize:\", attributes);\n            DatasetListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        /** In this override, only get details if in the ready state.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return $.when();\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetDCEListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemView.prototype.templates = (() => {\n    // use the element identifier here and not the dataset name\n    //TODO:?? can we steal the DCE titlebar?\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.element_identifier %></span>',\n            \"</div>\",\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    return _.extend({}, DatasetListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemView = DCListItemView.extend(\n    /** @lends NestedDCDCEListItemView.prototype */ {\n        className: `${DCListItemView.prototype.className} dataset-collection-element`,\n\n        /** In this override, add the state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            DCListItemView.prototype._swapNewRender.call(this, $newRender);\n            var state = this.model.get(\"state\") || \"ok\";\n            this.$el.addClass(`state-${state}`);\n            return this.$el;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `NestedDCDCEListItemView(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DCListItemView: DCListItemView,\n    DCEListItemView: DCEListItemView,\n    DatasetDCEListItemView: DatasetDCEListItemView,\n    NestedDCDCEListItemView: NestedDCDCEListItemView\n};\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { HistoryContents } from \"mvc/history/history-contents\";\nimport CONTROLLED_FETCH_COLLECTION from \"mvc/base/controlled-fetch-collection\";\nimport UTILS from \"utils/utils\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/** @class Model for a Galaxy history resource - both a record of user\n *      tool use and a collection of the datasets those tools produced.\n *  @name History\n *  @augments Backbone.Model\n */\nexport var History = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(\n    BASE_MVC.mixin(\n        BASE_MVC.SearchableModelMixin,\n        /** @lends History.prototype */ {\n            _logNamespace: \"history\",\n\n            /** ms between fetches when checking running jobs/datasets for updates */\n            UPDATE_DELAY: 4000,\n\n            // values from api (may need more)\n            defaults: {\n                model_class: \"History\",\n                id: null,\n                name: \"Unnamed History\",\n                state: \"new\",\n\n                deleted: false,\n                contents_active: {},\n                contents_states: {}\n            },\n\n            contentsClass: HistoryContents,\n\n            /** What model fields to search with */\n            searchAttributes: [\"name\", \"annotation\", \"tags\"],\n\n            /** Adding title and singular tag */\n            searchAliases: {\n                title: \"name\",\n                tag: \"tags\"\n            },\n\n            // ........................................................................ set up/tear down\n            /** Set up the model\n             *  @param {Object} historyJSON model data for this History\n             *  @param {Object} options     any extra settings including logger\n             */\n            initialize: function(historyJSON, options) {\n                options = options || {};\n                this.logger = options.logger || null;\n                this.log(`${this}.initialize:`, historyJSON, options);\n\n                this.urlRoot = `${getAppRoot()}api/histories`;\n                /** HistoryContents collection of the HDAs contained in this history. */\n                this.contents = new this.contentsClass([], {\n                    history: this,\n                    historyId: this.get(\"id\"),\n                    order: options.order\n                });\n\n                this._setUpListeners();\n                this._setUpCollectionListeners();\n\n                /** cached timeout id for the dataset updater */\n                this.updateTimeoutId = null;\n            },\n\n            /** set up any event listeners for this history including those to the contained HDAs\n             *  events: error:contents  if an error occurred with the contents collection\n             */\n            _setUpListeners: function() {\n                // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n                return this.on({\n                    error: function(model, xhr, options, msg, details) {\n                        this.clearUpdateTimeout();\n                    },\n                    \"change:id\": function(model, newId) {\n                        if (this.contents) {\n                            this.contents.historyId = newId;\n                        }\n                    }\n                });\n            },\n\n            /** event handlers for the contents submodels */\n            _setUpCollectionListeners: function() {\n                if (!this.contents) {\n                    return this;\n                }\n                // bubble up errors\n                return this.listenTo(this.contents, {\n                    error: function() {\n                        this.trigger.apply(this, jQuery.makeArray(arguments));\n                    }\n                });\n            },\n\n            // ........................................................................ derived attributes\n            /**  */\n            contentsShown: function() {\n                var contentsActive = this.get(\"contents_active\");\n                var shown = contentsActive.active || 0;\n                shown += this.contents.includeDeleted ? contentsActive.deleted : 0;\n                shown += this.contents.includeHidden ? contentsActive.hidden : 0;\n                return shown;\n            },\n\n            /** convert size in bytes to a more human readable version */\n            nice_size: function() {\n                var size = this.get(\"size\");\n                return size ? UTILS.bytesToString(size, true, 2) : _l(\"(empty)\");\n            },\n\n            /** override to add nice_size */\n            toJSON: function() {\n                return _.extend(Backbone.Model.prototype.toJSON.call(this), {\n                    nice_size: this.nice_size()\n                });\n            },\n\n            /** override to allow getting nice_size */\n            get: function(key) {\n                if (key === \"nice_size\") {\n                    return this.nice_size();\n                }\n                return Backbone.Model.prototype.get.apply(this, arguments);\n            },\n\n            // ........................................................................ common queries\n            /** T/F is this history owned by the current user (Galaxy.user)\n             *      Note: that this will return false for an anon user even if the history is theirs.\n             */\n            ownedByCurrUser: function() {\n                let Galaxy = getGalaxyInstance();\n                // no currUser\n                if (!Galaxy || !Galaxy.user) {\n                    return false;\n                }\n                // user is anon or history isn't owned\n                if (Galaxy.user.isAnonymous() || Galaxy.user.id !== this.get(\"user_id\")) {\n                    return false;\n                }\n                return true;\n            },\n\n            /** Return the number of running jobs assoc with this history (note: unknown === 0) */\n            numOfUnfinishedJobs: function() {\n                var unfinishedJobIds = this.get(\"non_ready_jobs\");\n                return unfinishedJobIds ? unfinishedJobIds.length : 0;\n            },\n\n            /** Return the number of running hda/hdcas in this history (note: unknown === 0) */\n            numOfUnfinishedShownContents: function() {\n                return this.contents.runningAndActive().length || 0;\n            },\n\n            // ........................................................................ updates\n            _fetchContentRelatedAttributes: function() {\n                var contentRelatedAttrs = [\"size\", \"non_ready_jobs\", \"contents_active\", \"hid_counter\"];\n                return this.fetch({\n                    data: jQuery.param({\n                        keys: contentRelatedAttrs.join(\",\")\n                    })\n                });\n            },\n\n            /** check for any changes since the last time we updated (or fetch all if ) */\n            refresh: function(options) {\n                // console.log( this + '.refresh' );\n                options = options || {};\n\n                // note if there was no previous update time, all summary contents will be fetched\n                var lastUpdateTime = this.lastUpdateTime;\n                // if we don't flip this, then a fully-fetched list will not be re-checked via fetch\n                this.contents.allFetched = false;\n                var fetchFn =\n                    this.contents.currentPage !== 0\n                        ? () => this.contents.fetchPage(this.contents.currentPage)\n                        : () => this.contents.fetchUpdated(lastUpdateTime);\n                // note: if there was no previous update time, all summary contents will be fetched\n                return fetchFn().done((response, status, xhr) => {\n                    var serverResponseDatetime;\n                    try {\n                        serverResponseDatetime = new Date(xhr.getResponseHeader(\"Date\"));\n                    } catch (err) {\n                        console.error(err);\n                    }\n                    this.lastUpdateTime = serverResponseDatetime || new Date();\n                    this.checkForUpdates(options);\n                });\n            },\n\n            /** continuously fetch updated contents every UPDATE_DELAY ms if this history's datasets or jobs are unfinished */\n            checkForUpdates: function(options) {\n                // console.log( this + '.checkForUpdates' );\n                options = options || {};\n                var delay = this.UPDATE_DELAY;\n                if (!this.id) {\n                    return;\n                }\n\n                var _delayThenUpdate = () => {\n                    // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n                    this.clearUpdateTimeout();\n                    this.updateTimeoutId = setTimeout(() => {\n                        this.refresh(options);\n                    }, delay);\n                };\n\n                // if there are still datasets in the non-ready state, recurse into this function with the new time\n                var nonReadyContentCount = this.numOfUnfinishedShownContents();\n                // console.log( 'nonReadyContentCount:', nonReadyContentCount );\n                if (nonReadyContentCount > 0) {\n                    _delayThenUpdate();\n                } else {\n                    // no datasets are running, but currently runnning jobs may still produce new datasets\n                    // see if the history has any running jobs and continue to update if so\n                    // (also update the size for the user in either case)\n                    this._fetchContentRelatedAttributes().done(historyData => {\n                        // console.log( 'non_ready_jobs:', historyData.non_ready_jobs );\n                        if (this.numOfUnfinishedJobs() > 0) {\n                            _delayThenUpdate();\n                        } else {\n                            // otherwise, let listeners know that all updates have stopped\n                            this.trigger(\"ready\");\n                        }\n                    });\n                }\n            },\n\n            /** clear the timeout and the cached timeout id */\n            clearUpdateTimeout: function() {\n                if (this.updateTimeoutId) {\n                    clearTimeout(this.updateTimeoutId);\n                    this.updateTimeoutId = null;\n                }\n            },\n\n            stopPolling: function() {\n                this.clearUpdateTimeout();\n                if (this.contents) {\n                    this.contents.stopPolling();\n                }\n            },\n\n            // ........................................................................ ajax\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** fetch this histories data (using options) then it's contents (using contentsOptions) */\n            fetchWithContents: function(options, contentsOptions) {\n                options = options || {};\n                var self = this;\n\n                // console.log( this + '.fetchWithContents' );\n                // TODO: push down to a base class\n                options.view = \"dev-detailed\";\n\n                // fetch history then use history data to fetch (paginated) contents\n                return this.fetch(options).then(function getContents(history) {\n                    self.contents.history = self;\n                    self.contents.setHistoryId(history.id);\n                    return self.fetchContents(contentsOptions);\n                });\n            },\n\n            /** fetch this histories contents, adjusting options based on the stored history preferences */\n            fetchContents: function(options) {\n                options = options || {};\n\n                // we're updating, reset the update time\n                this.lastUpdateTime = new Date();\n                return this.contents.fetchCurrentPage(options);\n            },\n\n            /** save this history, _Mark_ing it as deleted (just a flag) */\n            _delete: function(options) {\n                if (this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true }, options);\n            },\n            /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n            purge: function(options) {\n                if (this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true, purged: true }, options);\n            },\n            /** save this history, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** Make a copy of this history on the server\n             *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n             *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n             *  @fires copied               passed this history and the response JSON from the copy\n             *  @returns {xhr}\n             */\n            copy: function(current, name, allDatasets) {\n                current = current !== undefined ? current : true;\n                if (!this.id) {\n                    throw new Error(\"You must set the history ID before copying it.\");\n                }\n\n                var postData = { history_id: this.id };\n                if (current) {\n                    postData.current = true;\n                }\n                if (name) {\n                    postData.name = name;\n                }\n                if (!allDatasets) {\n                    postData.all_datasets = false;\n                }\n                postData.view = \"dev-detailed\";\n\n                var history = this;\n                var copy = jQuery.post(this.urlRoot, postData);\n                // if current - queue to setAsCurrent before firing 'copied'\n                if (current) {\n                    return copy.then(response => {\n                        var newHistory = new History(response);\n                        return newHistory.setAsCurrent().done(() => {\n                            history.trigger(\"copied\", history, response);\n                        });\n                    });\n                }\n                return copy.done(response => {\n                    history.trigger(\"copied\", history, response);\n                });\n            },\n\n            setAsCurrent: function() {\n                var history = this;\n\n                var xhr = jQuery.getJSON(`${getAppRoot()}history/set_as_current?id=${this.id}`);\n\n                xhr.done(() => {\n                    history.trigger(\"set-as-current\", history);\n                });\n                return xhr;\n            },\n\n            // ........................................................................ misc\n            toString: function() {\n                return `History(${this.get(\"id\")},${this.get(\"name\")})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\nvar _collectionSuper = CONTROLLED_FETCH_COLLECTION.InfinitelyScrollingCollection;\n/** @class A collection of histories (per user)\n *      that maintains the current history as the first in the collection.\n *  New or copied histories become the current history.\n */\nexport var HistoryCollection = _collectionSuper.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    model: History,\n    /** @type {String} initial order used by collection */\n    order: \"update_time\",\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: 10,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 10,\n\n    initialize: function(models, options) {\n        options = options || {};\n        this.log(\"HistoryCollection.initialize\", models, options);\n        this.urlRoot = `${getAppRoot()}api/histories`;\n        _collectionSuper.prototype.initialize.call(this, models, options);\n\n        /** @type {boolean} should deleted histories be included */\n        this.includeDeleted = options.includeDeleted || false;\n\n        /** @type {String} encoded id of the history that's current */\n        this.currentHistoryId = options.currentHistoryId;\n\n        this.setUpListeners();\n        // note: models are sent to reset *after* this fn ends; up to this point\n        // the collection *is empty*\n    },\n\n    url: function() {\n        return this.urlRoot;\n    },\n\n    /** set up reflexive event handlers */\n    setUpListeners: function setUpListeners() {\n        return this.on({\n            // when a history is deleted, remove it from the collection (if optionally set to do so)\n            \"change:deleted\": function(history) {\n                // TODO: this becomes complicated when more filters are used\n                this.debug(\"change:deleted\", this.includeDeleted, history.get(\"deleted\"));\n                if (!this.includeDeleted && history.get(\"deleted\")) {\n                    this.remove(history);\n                }\n            },\n            // listen for a history copy, setting it to current\n            copied: function(original, newData) {\n                this.setCurrent(new History(newData, []));\n            },\n            // when a history is made current, track the id in the collection\n            \"set-as-current\": function(history) {\n                var oldCurrentId = this.currentHistoryId;\n                this.trigger(\"no-longer-current\", oldCurrentId);\n                this.currentHistoryId = history.id;\n            }\n        });\n    },\n\n    /** override to change view */\n    _buildFetchData: function(options) {\n        return _.extend(_collectionSuper.prototype._buildFetchData.call(this, options), {\n            view: \"dev-detailed\"\n        });\n    },\n\n    /** override to filter out deleted and purged */\n    _buildFetchFilters: function(options) {\n        var superFilters = _collectionSuper.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (this.includeDeleted !== true) {\n            filters.deleted = false;\n            filters.purged = false;\n        } else {\n            // force API to return both deleted and non\n            //TODO: when the API is updated, remove this\n            filters.deleted = null;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    /** override to fetch current as well (as it may be outside the first 10, etc.) */\n    fetchFirst: function(options) {\n        // TODO: batch?\n        var xhr = jQuery.when();\n        if (this.currentHistoryId) {\n            xhr = _collectionSuper.prototype.fetchFirst.call(this, {\n                silent: true,\n                limit: 1,\n                filters: {\n                    \"encoded_id-in\": this.currentHistoryId,\n                    // without these a deleted current history will return [] here and block the other xhr\n                    deleted: null,\n                    purged: \"\"\n                }\n            });\n        }\n        return xhr.then(() => {\n            options = options || {};\n            options.offset = 0;\n            return this.fetchMore(options);\n        });\n    },\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_collectionSuper.prototype.comparators), {\n        name: BASE_MVC.buildComparator(\"name\", {\n            ascending: true\n        }),\n        \"name-dsc\": BASE_MVC.buildComparator(\"name\", {\n            ascending: false\n        }),\n        size: BASE_MVC.buildComparator(\"size\", {\n            ascending: false\n        }),\n        \"size-asc\": BASE_MVC.buildComparator(\"size\", {\n            ascending: true\n        })\n    }),\n\n    /** override to always have the current history first */\n    sort: function(options) {\n        options = options || {};\n        var silent = options.silent;\n        var currentHistory = this.remove(this.get(this.currentHistoryId));\n        _collectionSuper.prototype.sort.call(this, _.defaults({ silent: true }, options));\n        this.unshift(currentHistory, { silent: true });\n        if (!silent) {\n            this.trigger(\"sort\", this, options);\n        }\n        return this;\n    },\n\n    /** create a new history and by default set it to be the current history */\n    create: function create(data, hdas, historyOptions, xhrOptions) {\n        //TODO: .create is actually a collection function that's overridden here\n        var collection = this;\n\n        var xhr = jQuery.getJSON(`${getAppRoot()}history/create_new_current`);\n        return xhr.done(newData => {\n            collection.setCurrent(new History(newData, [], historyOptions || {}));\n        });\n    },\n\n    /** set the current history to the given history, placing it first in the collection.\n     *  Pass standard bbone options for use in unshift.\n     *  @triggers new-current passed history and this collection\n     */\n    setCurrent: function(history, options) {\n        options = options || {};\n        // new histories go in the front\n        this.unshift(history, options);\n        this.currentHistoryId = history.get(\"id\");\n        if (!options.silent) {\n            this.trigger(\"new-current\", history, this);\n        }\n        return this;\n    },\n\n    toString: function toString() {\n        return `HistoryCollection(${this.length},current:${this.currentHistoryId})`;\n    }\n});\n","/**\n * Model, view, and controller objects for Galaxy tools and tool panel.\n */\n/* global ga */\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport d3 from \"d3\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport util from \"viz/trackster/util\";\nimport { DatasetCollection } from \"mvc/dataset/data\";\n\n/**\n * Mixin for tracking model visibility.\n */\nvar VisibilityMixin = {\n    hidden: false,\n\n    show: function() {\n        this.set(\"hidden\", false);\n    },\n\n    hide: function() {\n        this.set(\"hidden\", true);\n    },\n\n    toggle: function() {\n        this.set(\"hidden\", !this.get(\"hidden\"));\n    },\n\n    is_visible: function() {\n        return !this.attributes.hidden;\n    }\n};\n\n/**\n * A tool parameter.\n */\nvar ToolParameter = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        label: null,\n        type: null,\n        value: null,\n        html: null,\n        num_samples: 5\n    },\n\n    initialize: function(options) {\n        this.attributes.html = unescape(this.attributes.html);\n    },\n\n    copy: function() {\n        return new ToolParameter(this.toJSON());\n    },\n\n    set_value: function(value) {\n        this.set(\"value\", value || \"\");\n    }\n});\n\nvar ToolParameterCollection = Backbone.Collection.extend({\n    model: ToolParameter\n});\n\n/**\n * A data tool parameter.\n */\nvar DataToolParameter = ToolParameter.extend({});\n\n/**\n * An integer tool parameter.\n */\nvar IntegerToolParameter = ToolParameter.extend({\n    set_value: function(value) {\n        this.set(\"value\", parseInt(value, 10));\n    },\n\n    /**\n     * Returns samples from a tool input.\n     */\n    get_samples: function() {\n        return d3.scale\n            .linear()\n            .domain([this.get(\"min\"), this.get(\"max\")])\n            .ticks(this.get(\"num_samples\"));\n    }\n});\n\nvar FloatToolParameter = IntegerToolParameter.extend({\n    set_value: function(value) {\n        this.set(\"value\", parseFloat(value));\n    }\n});\n\n/**\n * A select tool parameter.\n */\nvar SelectToolParameter = ToolParameter.extend({\n    /**\n     * Returns tool options.\n     */\n    get_samples: function() {\n        return _.map(this.get(\"options\"), option => option[0]);\n    }\n});\n\n// Set up dictionary of parameter types.\nToolParameter.subModelTypes = {\n    integer: IntegerToolParameter,\n    float: FloatToolParameter,\n    data: DataToolParameter,\n    select: SelectToolParameter\n};\n\n/**\n * A Galaxy tool.\n */\nvar Tool = Backbone.Model.extend({\n    // Default attributes.\n    defaults: {\n        id: null,\n        name: null,\n        description: null,\n        target: null,\n        inputs: [],\n        outputs: []\n    },\n\n    urlRoot: `${getAppRoot()}api/tools`,\n\n    initialize: function(options) {\n        // Set parameters.\n        this.set(\n            \"inputs\",\n            new ToolParameterCollection(\n                _.map(options.inputs, p => {\n                    var p_class = ToolParameter.subModelTypes[p.type] || ToolParameter;\n                    return new p_class(p);\n                })\n            )\n        );\n    },\n\n    /**\n     *\n     */\n    toJSON: function() {\n        var rval = Backbone.Model.prototype.toJSON.call(this);\n\n        // Convert inputs to JSON manually.\n        rval.inputs = this.get(\"inputs\").map(i => i.toJSON());\n        return rval;\n    },\n\n    /**\n     * Removes inputs of a particular type; this is useful because not all inputs can be handled by\n     * client and server yet.\n     */\n    remove_inputs: function(types) {\n        var tool = this;\n\n        var incompatible_inputs = tool.get(\"inputs\").filter(input => types.indexOf(input.get(\"type\")) !== -1);\n\n        tool.get(\"inputs\").remove(incompatible_inputs);\n    },\n\n    /**\n     * Returns object copy, optionally including only inputs that can be sampled.\n     */\n    copy: function(only_samplable_inputs) {\n        var copy = new Tool(this.toJSON());\n\n        // Return only samplable inputs if flag is set.\n        if (only_samplable_inputs) {\n            var valid_inputs = new Backbone.Collection();\n            copy.get(\"inputs\").each(input => {\n                if (input.get_samples()) {\n                    valid_inputs.push(input);\n                }\n            });\n            copy.set(\"inputs\", valid_inputs);\n        }\n\n        return copy;\n    },\n\n    apply_search_results: function(results) {\n        _.indexOf(results, this.attributes.id) !== -1 ? this.show() : this.hide();\n        return this.is_visible();\n    },\n\n    /**\n     * Set a tool input's value.\n     */\n    set_input_value: function(name, value) {\n        this.get(\"inputs\")\n            .find(input => input.get(\"name\") === name)\n            .set(\"value\", value);\n    },\n\n    /**\n     * Set many input values at once.\n     */\n    set_input_values: function(inputs_dict) {\n        var self = this;\n        _.each(_.keys(inputs_dict), input_name => {\n            self.set_input_value(input_name, inputs_dict[input_name]);\n        });\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     */\n    run: function() {\n        return this._run();\n    },\n\n    /**\n     * Rerun tool using regions and a target dataset.\n     */\n    rerun: function(target_dataset, regions) {\n        return this._run({\n            action: \"rerun\",\n            target_dataset_id: target_dataset.id,\n            regions: regions\n        });\n    },\n\n    /**\n     * Returns input dict for tool's inputs.\n     */\n    get_inputs_dict: function() {\n        var input_dict = {};\n        this.get(\"inputs\").each(input => {\n            input_dict[input.get(\"name\")] = input.get(\"value\");\n        });\n        return input_dict;\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     * NOTE: this method is a helper method and should not be called directly.\n     */\n    _run: function(additional_params) {\n        // Create payload.\n        var payload = _.extend(\n            {\n                tool_id: this.id,\n                inputs: this.get_inputs_dict()\n            },\n            additional_params\n        );\n\n        // Because job may require indexing datasets, use server-side\n        // deferred to ensure that job is run. Also use deferred that\n        // resolves to outputs from tool.\n        var run_deferred = $.Deferred();\n\n        var ss_deferred = new util.ServerStateDeferred({\n            ajax_settings: {\n                url: this.urlRoot,\n                data: JSON.stringify(payload),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Run job and resolve run_deferred to tool outputs.\n        $.when(ss_deferred.go()).then(result => {\n            run_deferred.resolve(new DatasetCollection(result));\n        });\n        return run_deferred;\n    }\n});\n_.extend(Tool.prototype, VisibilityMixin);\n\n/**\n * Wrap collection of tools for fast access/manipulation.\n */\nvar ToolCollection = Backbone.Collection.extend({\n    model: Tool\n});\n\n/**\n * Label or section header in tool panel.\n */\nvar ToolSectionLabel = Backbone.Model.extend(VisibilityMixin);\n\n/**\n * Section of tool panel with elements (labels and tools).\n */\nvar ToolSection = Backbone.Model.extend({\n    defaults: {\n        elems: [],\n        open: false\n    },\n\n    clear_search_results: function() {\n        _.each(this.attributes.elems, elt => {\n            elt.show();\n        });\n\n        this.show();\n        this.set(\"open\", false);\n    },\n\n    apply_search_results: function(results) {\n        var all_hidden = true;\n        var cur_label;\n        _.each(this.attributes.elems, elt => {\n            if (elt instanceof ToolSectionLabel) {\n                cur_label = elt;\n                cur_label.hide();\n            } else if (elt instanceof Tool) {\n                if (elt.apply_search_results(results)) {\n                    all_hidden = false;\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            }\n        });\n\n        if (all_hidden) {\n            this.hide();\n        } else {\n            this.show();\n            this.set(\"open\", true);\n        }\n    }\n});\n_.extend(ToolSection.prototype, VisibilityMixin);\n\n/**\n * Tool search that updates results when query is changed. Result value of null\n * indicates that query was not run; if not null, results are from search using\n * query.\n */\nvar ToolSearch = Backbone.Model.extend({\n    SEARCH_RESERVED_TERMS_FAVORITES: [\"#favs\", \"#favorites\", \"#favourites\"],\n\n    defaults: {\n        search_hint_string: \"search tools\",\n        min_chars_for_search: 3,\n        clear_btn_url: \"\",\n        visible: true,\n        query: \"\",\n        results: null,\n        // ESC (27) will clear the input field and tool search filters\n        clear_key: 27\n    },\n\n    urlRoot: `${getAppRoot()}api/tools`,\n\n    initialize: function() {\n        this.on(\"change:query\", this.do_search);\n    },\n\n    /**\n     * Do the search and update the results.\n     */\n    do_search: function() {\n        let Galaxy = getGalaxyInstance();\n        var query = this.attributes.query;\n\n        // If query is too short, do not search.\n        if (query.length < this.attributes.min_chars_for_search) {\n            this.set(\"results\", null);\n            return;\n        }\n\n        // Do search via AJAX.\n        var q = query;\n        // Stop previous ajax-request\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n        // Catch reserved words\n        if (this.SEARCH_RESERVED_TERMS_FAVORITES.indexOf(q) >= 0) {\n            this.set(\"results\", Galaxy.user.getFavorites().tools);\n        } else {\n            // Start a new ajax-request in X ms\n            $(\"#search-clear-btn\").hide();\n            $(\"#search-spinner\").show();\n            var self = this;\n            this.timer = setTimeout(() => {\n                // log the search to analytics if present\n                if (typeof ga !== \"undefined\") {\n                    ga(\"send\", \"pageview\", `${getAppRoot()}?q=${q}`);\n                }\n                $.get(\n                    self.urlRoot,\n                    { q: q },\n                    data => {\n                        self.set(\"results\", data);\n                        $(\"#search-spinner\").hide();\n                        $(\"#search-clear-btn\").show();\n                    },\n                    \"json\"\n                );\n            }, 400);\n        }\n    },\n\n    clear_search: function() {\n        this.set(\"query\", \"\");\n        this.set(\"results\", null);\n    }\n});\n_.extend(ToolSearch.prototype, VisibilityMixin);\n\n/**\n * Tool Panel.\n */\nvar ToolPanel = Backbone.Model.extend({\n    initialize: function(options) {\n        this.attributes.tool_search = options.tool_search;\n        this.attributes.tool_search.on(\"change:results\", this.apply_search_results, this);\n        this.attributes.tools = options.tools;\n        this.attributes.layout = new Backbone.Collection(this.parse(options.layout));\n    },\n\n    /**\n     * Parse tool panel dictionary and return collection of tool panel elements.\n     */\n    parse: function(response) {\n        // Recursive function to parse tool panel elements.\n        var self = this;\n\n        var // Helper to recursively parse tool panel.\n            parse_elt = elt_dict => {\n                var type = elt_dict.model_class;\n                // There are many types of tools; for now, anything that ends in 'Tool'\n                // is treated as a generic tool.\n                if (type.indexOf(\"Tool\") === type.length - 4) {\n                    return self.attributes.tools.get(elt_dict.id);\n                } else if (type === \"ToolSection\") {\n                    // Parse elements.\n                    var elems = _.map(elt_dict.elems, parse_elt);\n                    elt_dict.elems = elems;\n                    return new ToolSection(elt_dict);\n                } else if (type === \"ToolSectionLabel\") {\n                    return new ToolSectionLabel(elt_dict);\n                }\n            };\n\n        return _.map(response, parse_elt);\n    },\n\n    clear_search_results: function() {\n        this.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSection) {\n                panel_elt.clear_search_results();\n            } else {\n                // Label or tool, so just show.\n                panel_elt.show();\n            }\n        });\n    },\n\n    apply_search_results: function() {\n        var results = this.get(\"tool_search\").get(\"results\");\n        if (results === null) {\n            this.clear_search_results();\n            return;\n        }\n\n        var cur_label = null;\n        this.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSectionLabel) {\n                cur_label = panel_elt;\n                cur_label.hide();\n            } else if (panel_elt instanceof Tool) {\n                if (panel_elt.apply_search_results(results)) {\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            } else {\n                // Starting new section, so clear current label.\n                cur_label = null;\n                panel_elt.apply_search_results(results);\n            }\n        });\n    }\n});\n\n/**\n * View classes for Galaxy tools and tool panel.\n *\n * Views use the templates defined below for rendering. Views update as needed\n * based on (a) model/collection events and (b) user interactions; in this sense,\n * they are controllers are well and the HTML is the real view in the MVC architecture.\n */\n\n/**\n * Base view that handles visibility based on model's hidden attribute.\n */\nvar BaseView = Backbone.View.extend({\n    initialize: function() {\n        this.model.on(\"change:hidden\", this.update_visible, this);\n        this.update_visible();\n    },\n    update_visible: function() {\n        this.model.attributes.hidden ? this.$el.hide() : this.$el.show();\n    }\n});\n\n/**\n * Link to a tool.\n */\nvar ToolLinkView = BaseView.extend({\n    tagName: \"div\",\n\n    render: function() {\n        // create element\n        var $link = $(\"<div/>\");\n        $link.append(templates.tool_link(this.model.toJSON()));\n\n        var formStyle = this.model.get(\"form_style\", null);\n        // open upload dialog for upload tool\n        if (this.model.id === \"upload1\") {\n            $link.find(\"a\").on(\"click\", e => {\n                e.preventDefault();\n                let Galaxy = getGalaxyInstance();\n                Galaxy.upload.show();\n            });\n        } else if (formStyle === \"regular\") {\n            // regular tools\n            var self = this;\n            $link.find(\"a\").on(\"click\", e => {\n                e.preventDefault();\n                let Galaxy = getGalaxyInstance();\n                Galaxy.router.push(\"/\", {\n                    tool_id: self.model.id,\n                    version: self.model.get(\"version\")\n                });\n            });\n        }\n\n        // add element\n        this.$el.append($link);\n        return this;\n    }\n});\n\n/**\n * Panel label/section header.\n */\nvar ToolSectionLabelView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolPanelLabel\",\n\n    render: function() {\n        this.$el.append($(\"<span/>\").text(this.model.attributes.text));\n        return this;\n    }\n});\n\n/**\n * Panel section.\n */\nvar ToolSectionView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolSectionWrapper\",\n\n    initialize: function() {\n        BaseView.prototype.initialize.call(this);\n        this.model.on(\"change:open\", this.update_open, this);\n    },\n\n    render: function() {\n        // Build using template.\n        this.$el.append(templates.panel_section(this.model.toJSON()));\n\n        // Add tools to section.\n        var section_body = this.$el.find(\".toolSectionBody\");\n        _.each(this.model.attributes.elems, elt => {\n            if (elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: elt,\n                    className: \"toolTitle\"\n                });\n                tool_view.render();\n                section_body.append(tool_view.$el);\n            } else if (elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: elt\n                });\n                label_view.render();\n                section_body.append(label_view.$el);\n            } else {\n                // TODO: handle nested section bodies?\n            }\n        });\n        return this;\n    },\n\n    events: {\n        \"click .toolSectionTitle > a\": \"toggle\"\n    },\n\n    /**\n     * Toggle visibility of tool section.\n     */\n    toggle: function() {\n        this.model.set(\"open\", !this.model.attributes.open);\n    },\n\n    /**\n     * Update whether section is open or close.\n     */\n    update_open: function() {\n        this.model.attributes.open\n            ? this.$el.children(\".toolSectionBody\").slideDown(\"fast\")\n            : this.$el.children(\".toolSectionBody\").slideUp(\"fast\");\n    }\n});\n\nvar ToolSearchView = Backbone.View.extend({\n    tagName: \"div\",\n    id: \"tool-search\",\n    className: \"bar\",\n\n    events: {\n        click: \"focus_and_select\",\n        \"keyup :input\": \"query_changed\",\n        \"change :input\": \"query_changed\",\n        \"click #search-clear-btn\": \"clear\"\n    },\n\n    render: function() {\n        this.$el.append(templates.tool_search(this.model.toJSON()));\n        if (!this.model.is_visible()) {\n            this.$el.hide();\n        }\n\n        this.$el.find(\"[title]\").tooltip();\n        return this;\n    },\n\n    focus_and_select: function() {\n        this.$el\n            .find(\":input\")\n            .focus()\n            .select();\n    },\n\n    clear: function() {\n        this.model.clear_search();\n        this.$el.find(\":input\").val(\"\");\n        this.focus_and_select();\n        return false;\n    },\n\n    query_changed: function(evData) {\n        // check for the 'clear key' (ESC) first\n        if (this.model.attributes.clear_key && this.model.attributes.clear_key === evData.which) {\n            this.clear();\n            return false;\n        }\n        this.model.set(\"query\", this.$el.find(\":input\").val());\n    }\n});\n\n/**\n * Tool panel view. Events triggered include:\n * tool_link_click(click event, tool_model)\n */\nvar ToolPanelView = Backbone.View.extend({\n    tagName: \"div\",\n    className: \"toolMenu\",\n\n    /**\n     * Set up view.\n     */\n    initialize: function() {\n        this.model.get(\"tool_search\").on(\"change:results\", this.handle_search_results, this);\n    },\n\n    render: function() {\n        var self = this;\n\n        // Render search.\n        var search_view = new ToolSearchView({\n            model: this.model.get(\"tool_search\")\n        });\n        search_view.render();\n        // FIXME: This is a little ugly because it navigates through the parent\n        //        element, but good enough until this is all `.vue`\n        self.$el\n            .closest(\".unified-panel\")\n            .find(\".unified-panel-controls\")\n            .append(search_view.$el);\n\n        // Render panel.\n        this.model.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSection) {\n                var section_title_view = new ToolSectionView({\n                    model: panel_elt\n                });\n                section_title_view.render();\n                self.$el.append(section_title_view.$el);\n            } else if (panel_elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: panel_elt,\n                    className: \"toolTitleNoSection\"\n                });\n                tool_view.render();\n                self.$el.append(tool_view.$el);\n            } else if (panel_elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: panel_elt\n                });\n                label_view.render();\n                self.$el.append(label_view.$el);\n            }\n        });\n\n        // Setup tool link click eventing.\n        self.$el.find(\"a.tool-link\").click(function(e) {\n            // Tool id is always the first class.\n            var tool_id = $(this)\n                .attr(\"class\")\n                .split(/\\s+/)[0];\n\n            var tool = self.model.get(\"tools\").get(tool_id);\n\n            self.trigger(\"tool_link_click\", e, tool);\n        });\n\n        return this;\n    },\n\n    handle_search_results: function() {\n        var results = this.model.get(\"tool_search\").get(\"results\");\n        if (results && results.length === 0) {\n            $(\"#search-no-results\").show();\n        } else {\n            $(\"#search-no-results\").hide();\n        }\n    }\n});\n\n/**\n * View for working with a tool: setting parameters and inputs and executing the tool.\n */\nvar ToolFormView = Backbone.View.extend({\n    className: \"toolForm\",\n\n    render: function() {\n        this.$el.children().remove();\n        this.$el.append(templates.tool_form(this.model.toJSON()));\n    }\n});\n\n// TODO: move into relevant views\nvar templates = {\n    // the search bar at the top of the tool panel\n    tool_search: _.template(\n        `<input id=\"tool-search-query\" class=\"search-query parent-width\" name=\"query\"\n                placeholder=\"<%- search_hint_string %>\" autocomplete=\"off\" type=\"text\" />\n         <a id=\"search-clear-btn\" title=\"clear search (esc)\"> </a>\n         <span id=\"search-spinner\" class=\"search-spinner fa fa-spinner fa-spin\"></span>\n    `\n    ),\n\n    // the category level container in the tool panel (e.g. 'Get Data', 'Text Manipulation')\n    panel_section: _.template(\n        [\n            '<div class=\"toolSectionTitle\" id=\"title_<%- id %>\">',\n            '<a href=\"javascript:void(0)\"><span><%- name %></span></a>',\n            \"</div>\",\n            '<div id=\"<%- id %>\" class=\"toolSectionBody\" style=\"display: none;\">',\n            '<div class=\"toolSectionBg\"></div>',\n            \"<div>\"\n        ].join(\"\")\n    ),\n\n    // a single tool's link in the tool panel; will load the tool form in the center panel\n    tool_link: _.template(\n        [\n            '<a class=\"<%- id %> tool-link\" href=\"<%= link %>\" target=\"<%- target %>\" minsizehint=\"<%- min_width %>\">',\n            '<span class=\"labels\">',\n            \"<% _.each( labels, function( label ){ %>\",\n            '<span class=\"badge badge-primary badge-<%- label %>\">',\n            \"<%- label %>\",\n            \"</span>\",\n            \"<% }); %>\",\n            \"</span>\",\n            '<span class=\"tool-old-link\">',\n            \"<%- name %>\",\n            \"</span>\",\n            \" <%- description %>\",\n            \"</a>\"\n        ].join(\"\")\n    ),\n\n    // the tool form for entering tool parameters, viewing help and executing the tool\n    // loaded when a tool link is clicked in the tool panel\n    tool_form: _.template(\n        [\n            '<div class=\"toolFormTitle\"><%- tool.name %> (version <%- tool.version %>)</div>',\n            '<div class=\"toolFormBody\">',\n            \"<% _.each( tool.inputs, function( input ){ %>\",\n            '<div class=\"form-row\">',\n            '<label for=\"<%- input.name %>\"><%- input.label %>:</label>',\n            '<div class=\"form-row-input\">',\n            \"<%= input.html %>\",\n            \"</div>\",\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">',\n            \"<%- input.help %>\",\n            \"</div>\",\n            '<div style=\"clear: both;\"></div>',\n            \"</div>\",\n            \"<% }); %>\",\n            \"</div>\",\n            '<div class=\"form-row form-actions\">',\n            '<input type=\"submit\" class=\"btn btn-primary\" name=\"runtool_btn\" value=\"Execute\" />',\n            \"</div>\",\n            '<div class=\"toolHelp\">',\n            '<div class=\"toolHelpBody\"><% tool.help %></div>',\n            \"</div>\"\n            // TODO: we need scoping here because 'help' is the dom for the help menu in the masthead\n            // which implies a leaky variable that I can't find\n        ].join(\"\"),\n        { variable: \"tool\" }\n    )\n};\n\n// Exports\nexport default {\n    ToolParameter: ToolParameter,\n    IntegerToolParameter: IntegerToolParameter,\n    SelectToolParameter: SelectToolParameter,\n    Tool: Tool,\n    ToolCollection: ToolCollection,\n    ToolSearch: ToolSearch,\n    ToolPanel: ToolPanel,\n    ToolPanelView: ToolPanelView,\n    ToolFormView: ToolFormView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\nimport LIST_ITEM from \"mvc/list/list-item\";\nimport STATES from \"mvc/dataset/states\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport { mountNametags } from \"components/Nametags\";\n\nvar logNamespace = \"dataset\";\n/*==============================================================================\nTODO:\n    straighten out state rendering and templates used\n    inaccessible/STATES.NOT_VIEWABLE is a special case\n    simplify button rendering\n\n==============================================================================*/\nvar _super = LIST_ITEM.ListItemView;\n/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n *      Roughly, any DatasetInstance (and not a raw Dataset).\n */\nexport var DatasetListItemView = _super.extend(\n    /** @lends DatasetListItemView.prototype */ {\n        _logNamespace: logNamespace,\n\n        className: `${_super.prototype.className} dataset`,\n        //TODO:?? doesn't exactly match an hda's type_id\n        id: function() {\n            return [\"dataset\", this.model.get(\"id\")].join(\"-\");\n        },\n\n        /** Set up: instance vars, options, and event handlers */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(`${this}.initialize:`, attributes);\n            _super.prototype.initialize.call(this, attributes);\n\n            /** where should pages from links be displayed? (default to new tab/window) */\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n        },\n\n        // mount new vue component for tags\n        render: function() {\n            let result = _super.prototype.render.apply(this, arguments);\n            this._mountVueNametags();\n            return result;\n        },\n\n        _mountVueNametags: function() {\n            let container = this.$(\".nametags\")[0];\n            let { id, model_class, tags } = this.model.attributes;\n            let storeKey = `${model_class}-${id}`;\n            mountNametags({ storeKey, tags }, container);\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            var self = this;\n\n            // re-rendering on any model changes\n            return self.listenTo(self.model, {\n                change: function(model) {\n                    // if the model moved into the ready state and is expanded without details, fetch those details now\n                    if (\n                        self.model.changedAttributes().state &&\n                        self.model.inReadyState() &&\n                        self.expanded &&\n                        !self.model.hasDetails()\n                    ) {\n                        // normally, will render automatically (due to fetch -> change),\n                        // but! setting_metadata sometimes doesn't cause any other changes besides state\n                        // so, not rendering causes it to seem frozen in setting_metadata state\n                        self.model.fetch({ silent: true }).done(() => {\n                            self.render();\n                        });\n                    } else {\n                        if (_.has(self.model.changed, \"tags\") && _.keys(self.model.changed).length === 2) {\n                            // If only the tags and update time have changed,\n                            // rerender specifically the titlebar region.\n                            // Otherwise default to the full render.\n                            self._mountVueNametags();\n                        } else {\n                            self.render();\n                        }\n                    }\n                }\n            });\n        },\n\n        // ......................................................................... expandable\n        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return $.when();\n        },\n\n        // ......................................................................... removal\n        /** Remove this view's html from the DOM and remove all event listeners.\n         *  @param {Number or String} speed jq effect speed\n         *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n         */\n        remove: function(speed, callback) {\n            var view = this;\n            speed = speed || this.fxSpeed;\n            this.$el.fadeOut(speed, () => {\n                Backbone.View.prototype.remove.call(view);\n                if (callback) {\n                    callback.call(view);\n                }\n            });\n        },\n\n        // ......................................................................... rendering\n        /* TODO:\n        dataset states are the issue primarily making dataset rendering complex\n            each state should have it's own way of displaying/set of details\n            often with different actions that can be applied\n        throw in deleted/purged/visible and things get complicated easily\n        I've considered (a couple of times) - creating a view for each state\n            - but recreating the view during an update...seems wrong\n    */\n        /** In this override, add the dataset state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            _super.prototype._swapNewRender.call(this, $newRender);\n            if (this.model.has(\"state\")) {\n                this.$el.addClass(`state-${this.model.get(\"state\")}`);\n            }\n            return this.$el;\n        },\n\n        // ................................................................................ titlebar\n        /** In this override, add the dataset display button. */\n        _renderPrimaryActions: function() {\n            // render just the display for read-only\n            return [this._renderDisplayButton()];\n        },\n\n        /** Render icon-button to display dataset data */\n        _renderDisplayButton: function() {\n            // don't show display if not viewable or not accessible\n            var state = this.model.get(\"state\");\n            if (state === STATES.NOT_VIEWABLE || state === STATES.DISCARDED || !this.model.get(\"accessible\")) {\n                return null;\n            }\n\n            var displayBtnData = {\n                target: this.linkTarget,\n                classes: \"display-btn\"\n            };\n\n            // show a disabled display if the data's been purged\n            if (this.model.get(\"purged\")) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"Cannot display datasets removed from disk\");\n\n                // disable if still uploading\n            } else if (state === STATES.UPLOAD) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"This dataset must finish uploading before it can be viewed\");\n\n                // disable if still new\n            } else if (state === STATES.NEW) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"This dataset is not yet viewable\");\n            } else {\n                displayBtnData.title = _l(\"View data\");\n\n                // default link for dataset\n                displayBtnData.href = this.model.urls.display;\n\n                // add frame manager option onclick event\n                var self = this;\n                displayBtnData.onclick = ev => {\n                    let Galaxy = getGalaxyInstance();\n                    if (Galaxy.frame && Galaxy.frame.active) {\n                        // Add dataset to frames.\n                        Galaxy.frame.addDataset(self.model.get(\"id\"));\n                        ev.preventDefault();\n                    }\n                };\n            }\n            displayBtnData.faIcon = \"fa-eye\";\n            return faIconButton(displayBtnData);\n        },\n\n        // ......................................................................... rendering details\n        /** Render the enclosing div of the hda body and, if expanded, the html in the body\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderDetails: function() {\n            //TODO: generalize to be allow different details for each state\n\n            // no access - render nothing but a message\n            if (this.model.get(\"state\") === STATES.NOT_VIEWABLE) {\n                return $(this.templates.noAccess(this.model.toJSON(), this));\n            }\n\n            var $details = _super.prototype._renderDetails.call(this);\n            $details\n                .find(\".actions .left\")\n                .empty()\n                .append(this._renderSecondaryActions());\n            $details\n                .find(\".summary\")\n                .html(this._renderSummary())\n                .prepend(this._renderDetailMessages());\n            $details.find(\".display-applications\").html(this._renderDisplayApplications());\n\n            this._setUpBehaviors($details);\n            return $details;\n        },\n\n        /** Defer to the appropo summary rendering fn based on state */\n        _renderSummary: function() {\n            var json = this.model.toJSON();\n            var summaryRenderFn = this.templates.summaries[json.state];\n            summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n            return summaryRenderFn(json, this);\n        },\n\n        /** Render messages to be displayed only when the details are shown */\n        _renderDetailMessages: function() {\n            var view = this;\n            var $warnings = $('<div class=\"detail-messages\"></div>');\n            var json = view.model.toJSON();\n            //TODO:! unordered (map)\n            _.each(view.templates.detailMessages, templateFn => {\n                $warnings.append($(templateFn(json, view)));\n            });\n            return $warnings;\n        },\n\n        /** Render the external display application links */\n        _renderDisplayApplications: function() {\n            if (this.model.isDeletedOrPurged()) {\n                return \"\";\n            }\n            // render both old and new display apps using the same template\n            return [\n                this.templates.displayApplications(this.model.get(\"display_apps\"), this),\n                this.templates.displayApplications(this.model.get(\"display_types\"), this)\n            ].join(\"\");\n        },\n\n        // ......................................................................... secondary/details actions\n        /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n        _renderSecondaryActions: function() {\n            this.debug(\"_renderSecondaryActions\");\n            switch (this.model.get(\"state\")) {\n                case STATES.NOT_VIEWABLE:\n                    return [];\n                case STATES.OK:\n                case STATES.FAILED_METADATA:\n                case STATES.ERROR:\n                    return [this._renderDownloadButton(), this._renderShowParamsButton()];\n            }\n            return [this._renderShowParamsButton()];\n        },\n\n        /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderShowParamsButton: function() {\n            // gen. safe to show in all cases\n            return faIconButton({\n                title: _l(\"View details\"),\n                classes: \"params-btn\",\n                href: this.model.urls.show_params,\n                target: this.linkTarget,\n                faIcon: \"fa-info-circle\",\n                onclick: function(ev) {\n                    let Galaxy = getGalaxyInstance();\n                    if (Galaxy.frame && Galaxy.frame.active) {\n                        Galaxy.frame.add({\n                            title: _l(\"Dataset details\"),\n                            url: this.href\n                        });\n                        ev.preventDefault();\n                        ev.stopPropagation();\n                    }\n                }\n            });\n        },\n\n        /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderDownloadButton: function() {\n            // don't show anything if the data's been purged\n            if (this.model.get(\"purged\") || !this.model.hasData()) {\n                return null;\n            }\n\n            // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n            //  or a single download icon-button (if there are no meta files)\n            if (!_.isEmpty(this.model.get(\"meta_files\"))) {\n                return this._renderMetaFileDownloadButton();\n            }\n\n            return $(`\n                <a class=\"download-btn icon-btn\" href=\"${this.model.urls.download}\" title=\"${_l(\"Download\")}\">\n                    <span class=\"fa fa-floppy-o\"></span>\n                </a>`);\n        },\n\n        /** Render the download button which opens a dropdown with links to download assoc. meta files (indices, etc.) */\n        _renderMetaFileDownloadButton: function() {\n            var urls = this.model.urls;\n            return $(`\n                <div class=\"metafile-dropdown dropdown\">\n                    <a class=\"download-btn icon-btn\" href=\"${urls.download}\" data-toggle=\"dropdown\" title=\"${_l(\n                \"Download\"\n            )}\">\n                        <span class=\"fa fa-floppy-o\"></span>\n                    </a>\n                    <ul class=\"dropdown-menu\" role=\"menu\">\n                        <li>\n                            <a href=\"${urls.download}\">\n                                ${_l(\"Download dataset\")}\n                            </a>\n                        </li>\n                        ${_.map(\n                            this.model.get(\"meta_files\"),\n                            meta_file =>\n                                `<li>\n                                    <a href=\"${urls.meta_download + meta_file.file_type}\">\n                                        ${_l(\"Download\")} ${meta_file.file_type}\n                                    </a>\n                                </li>`\n                        )}\n                    </ul>\n                </div>`);\n        },\n\n        // ......................................................................... misc\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .display-btn\": function(ev) {\n                this.trigger(\"display\", this, ev);\n            },\n            \"click .params-btn\": function(ev) {\n                this.trigger(\"params\", this, ev);\n            },\n            \"click .download-btn\": function(ev) {\n                this.trigger(\"download\", this, ev);\n            }\n        }),\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemView.prototype.templates = (() => {\n    //TODO: move to require text! plugin\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: BASE_MVC.wrapTemplate([\n            // failed metadata is rendered as a warning on an otherwise ok dataset view\n            '<% if( model.state === \"failed_metadata\" ){ %>',\n            '<div class=\"warningmessagesmall\">',\n            _l(\"An error occurred setting the metadata for this dataset\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        error: BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            \"<% if( model.error ){ %>\",\n            '<div class=\"errormessagesmall\">',\n            _l(\"There was an error getting the data for this dataset\"),\n            \": <%- model.error %>\",\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        purged: BASE_MVC.wrapTemplate([\n            \"<% if( model.purged ){ %>\",\n            '<div class=\"purged-msg warningmessagesmall\">',\n            _l(\"This dataset has been deleted and removed from disk\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        deleted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.deleted && !model.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This dataset has been deleted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n\n        //NOTE: hidden warning is only needed for HDAs\n    });\n\n    var detailsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            '<div class=\"summary\"></div>',\n\n            '<div class=\"actions clear\">',\n            '<div class=\"left\"></div>',\n            '<div class=\"right\"></div>',\n            \"</div>\",\n\n            // do not display tags, annotation, display apps, or peek when deleted\n            \"<% if( !dataset.deleted && !dataset.purged ){ %>\",\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"display-applications\"></div>',\n\n            \"<% if( dataset.peek ){ %>\",\n            '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>',\n            \"<% } %>\",\n            \"<% } %>\",\n            \"</div>\"\n        ],\n        \"dataset\"\n    );\n\n    var noAccessTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            '<div class=\"summary\">',\n            _l(\"You do not have permission to view this dataset\"),\n            \"</div>\",\n            \"</div>\"\n        ],\n        \"dataset\"\n    );\n\n    //TODO: still toooooooooooooo complex - rework\n    var summaryTemplates = {};\n    summaryTemplates[STATES.OK] = summaryTemplates[STATES.FAILED_METADATA] = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( dataset.misc_blurb ){ %>\",\n            '<div class=\"blurb\">',\n            '<span class=\"value\"><%- dataset.misc_blurb %></span>',\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.file_ext ){ %>\",\n            '<div class=\"datatype\">',\n            '<label class=\"prompt\">',\n            _l(\"format\"),\n            \"</label>\",\n            '<span class=\"value\"><%- dataset.file_ext %></span>',\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.metadata_dbkey ){ %>\",\n            '<div class=\"dbkey\">',\n            '<label class=\"prompt\">',\n            _l(\"database\"),\n            \"</label>\",\n            '<span class=\"value\">',\n            \"<%- dataset.metadata_dbkey %>\",\n            \"</span>\",\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.misc_info ){ %>\",\n            '<div class=\"info\">',\n            '<span class=\"value\"><%- dataset.misc_info %></span>',\n            \"</div>\",\n            \"<% } %>\"\n        ],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.NEW] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This is a new dataset and not all of its data are available yet\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.NOT_VIEWABLE] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"You do not have permission to view this dataset\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.DISCARDED] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"The job creating this dataset was cancelled before completion\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.QUEUED] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This job is waiting to run\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.RUNNING] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This job is currently running\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.UPLOAD] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This dataset is currently uploading\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.SETTING_METADATA] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"Metadata is being auto-detected\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.PAUSED] = BASE_MVC.wrapTemplate(\n        [\n            \"<div>\",\n            _l('This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume'),\n            \"</div>\",\n            '<div class=\"info\"><%- dataset.misc_info %></div>'\n        ],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.ERROR] = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( !dataset.purged ){ %>\",\n            \"<div><%- dataset.misc_blurb %></div>\",\n            \"<% } %>\",\n            '<span class=\"help-text\">',\n            _l(\"An error occurred with this dataset\"),\n            \":</span>\",\n            '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'\n        ],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.EMPTY] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"No data\"), \": <i><%- dataset.misc_blurb %></i></div>\"],\n        \"dataset\"\n    );\n    summaryTemplates.unknown = BASE_MVC.wrapTemplate(\n        ['<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'],\n        \"dataset\"\n    );\n\n    // messages to be displayed only within the details section ('below the fold')\n    var detailMessageTemplates = {\n        resubmitted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.resubmitted ){ %>\",\n            '<div class=\"resubmitted-msg infomessagesmall\">',\n            _l(\"The job creating this dataset has been resubmitted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n    };\n\n    // this is applied to both old and new style display apps\n    var displayApplicationsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% _.each( apps, function( app ){ %>\",\n            '<div class=\"display-application\">',\n            '<span class=\"display-application-location\"><%- app.label %></span> ',\n            '<span class=\"display-application-links\">',\n            \"<% _.each( app.links, function( link ){ %>\",\n            '<a target=\"<%- link.target %>\" href=\"<%- link.href %>\">',\n            \"<% print( _l( link.text ) ); %>\",\n            \"</a> \",\n            \"<% }); %>\",\n            \"</span>\",\n            \"</div>\",\n            \"<% }); %>\"\n        ],\n        \"apps\"\n    );\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        details: detailsTemplate,\n        noAccess: noAccessTemplate,\n        summaries: summaryTemplates,\n        detailMessages: detailMessageTemplates,\n        displayApplications: displayApplicationsTemplate\n    });\n})();\n\n// ============================================================================\nexport default {\n    DatasetListItemView: DatasetListItemView\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { make_popupmenu } from \"ui/popupmenu\";\n/**\n * View for track/group header.\n */\nvar TrackHeaderView = Backbone.View.extend({\n    className: \"track-header\",\n\n    initialize: function() {\n        // Watch and update name changes.\n        this.model.config.get(\"name\").on(\"change:value\", this.update_name, this);\n        this.render();\n    },\n\n    render: function() {\n        this.$el.append($(\"<div/>\").addClass(this.model.drag_handle_class));\n        this.$el.append(\n            $(\"<div/>\")\n                .addClass(\"track-name\")\n                .text(this.model.config.get_value(\"name\"))\n        );\n\n        // Icons container.\n        this.action_icons = {};\n        this.render_action_icons();\n\n        // Suppress double clicks in header so that they do not impact viz under header.\n        this.$el.dblclick(e => {\n            e.stopPropagation();\n        });\n\n        // Needed for floating elts in header.\n        this.$el.append($(\"<div style='clear: both'/>\"));\n    },\n\n    update_name: function() {\n        this.$el.find(\".track-name\").text(this.model.config.get_value(\"name\"));\n    },\n\n    render_action_icons: function() {\n        var self = this;\n        this.icons_div = $(\"<div/>\")\n            .addClass(\"track-icons\")\n            .hide()\n            .appendTo(this.$el);\n        _.each(this.model.action_icons_def, icon_dict => {\n            self.add_action_icon(\n                icon_dict.name,\n                icon_dict.title,\n                icon_dict.css_class,\n                icon_dict.on_click_fn,\n                icon_dict.prepend,\n                icon_dict.hide\n            );\n        });\n\n        // Set up behavior for modes popup.\n        this.set_display_modes(this.model.display_modes);\n    },\n\n    /**\n     * Add an action icon to this object. Appends icon unless prepend flag is specified.\n     */\n    add_action_icon: function(name, title, css_class, on_click_fn, prepend, hide) {\n        var self = this;\n        this.action_icons[name] = $(\"<a/>\")\n            .attr(\"title\", title)\n            .addClass(\"icon-button\")\n            .addClass(css_class)\n            .tooltip()\n            .click(() => {\n                on_click_fn(self.model);\n            })\n            .appendTo(this.icons_div);\n        if (hide) {\n            this.action_icons[name].hide();\n        }\n    },\n\n    /**\n     * Set track's modes and update mode icon popup.\n     */\n    set_display_modes: function(new_modes, init_mode) {\n        if (!new_modes) {\n            return;\n        }\n\n        // HACK: move this out of view and into track.\n\n        // Set modes, init mode.\n        this.model.display_modes = new_modes;\n        this.model.mode = init_mode || this.model.config.get_value(\"mode\") || this.model.display_modes[0];\n\n        this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: ${this.mode})`);\n\n        // Setup popup menu for changing modes.\n        var track = this.model;\n        var mode_mapping = {};\n        for (var i = 0, len = track.display_modes.length; i < len; i++) {\n            var mode = track.display_modes[i];\n            mode_mapping[mode] = (mode => () => {\n                track.change_mode(mode);\n                // HACK: the popup menu messes with the track's hover event, so manually show/hide\n                // icons div for now.\n                //self.icons_div.show();\n                //track.container_div.mouseleave(function() { track.icons_div.hide(); } );\n            })(mode);\n        }\n\n        make_popupmenu(this.action_icons.mode_icon, mode_mapping);\n    }\n});\n\nexport default {\n    TrackHeaderView: TrackHeaderView\n};\n","import _ from \"libs/underscore\";\nvar extend = _.extend;\n\n// HACK: LABEL_SPACING is currently duplicated between here and painters\nvar LABEL_SPACING = 2;\n\nvar PACK_SPACING = 5;\n\n/**\n * Hold slotting information for a feature.\n */\nvar SlottedInfo = function(slot, feature) {\n    this.slot = slot;\n    this.feature = feature;\n};\n\n/**\n * FeatureSlotter determines slots in which to draw features for vertical\n * packing.\n *\n * This implementation is incremental, any feature assigned a slot will be\n * retained for slotting future features.\n */\nvar FeatureSlotter = function(w_scale, mode, max_rows, measureText) {\n    this.slots = {};\n    this.start_end_dct = {};\n    this.w_scale = w_scale;\n    this.mode = mode;\n    this.include_label = mode === \"Pack\";\n    this.max_rows = max_rows;\n    this.measureText = measureText;\n};\n\n/**\n * Slot a set of features, `this.slots` will be updated with slots by id, and\n * the largest slot required for the passed set of features is returned\n */\nextend(FeatureSlotter.prototype, {\n    /**\n     * Get drawing coordinate for a feature.\n     */\n    _get_draw_coords: function(feature) {\n        // Get initial draw coordinates using w_scale.\n        var draw_start = Math.floor(feature[1] * this.w_scale);\n\n        var draw_end = Math.ceil(feature[2] * this.w_scale);\n        var f_name = feature[3];\n        //var text_align;\n\n        // Update start, end drawing locations to include feature name.\n        // Try to put the name on the left, if not, put on right.\n        if (f_name !== undefined && this.include_label) {\n            // Add gap for label spacing and extra pack space padding\n            // TODO: Fix constants\n            var text_len = this.measureText(f_name).width + (LABEL_SPACING + PACK_SPACING);\n            if (draw_start - text_len >= 0) {\n                draw_start -= text_len;\n                //text_align = \"left\";\n            } else {\n                draw_end += text_len;\n                //text_align = \"right\";\n            }\n        }\n\n        /*\n        if (slot_num < 0) {\n            \n            TODO: this is not yet working --\n            console.log(feature_uid, \"looking for slot with text on the right\");\n            // Slot not found. If text was on left, try on right and see\n            // if slot can be found.\n            // TODO: are there any checks we need to do to ensure that text\n            // will fit on tile?\n            if (text_align === \"left\") {\n                draw_start -= text_len;\n                draw_end -= text_len;\n                text_align = \"right\";\n                slot_num = find_slot(draw_start, draw_end);\n            }\n            if (slot_num >= 0) {\n                console.log(feature_uid, \"found slot with text on the right\");\n            }\n\n        }\n        */\n\n        return [draw_start, draw_end];\n    },\n\n    /**\n     * Find the first slot such that current feature doesn't overlap any other features in that slot.\n     * Returns -1 if no slot was found.\n     */\n    _find_slot: function(draw_coords) {\n        // TODO: Use a data structure for faster searching of available slots.\n        var draw_start = draw_coords[0];\n\n        var draw_end = draw_coords[1];\n        for (var slot_num = 0; slot_num <= this.max_rows; slot_num++) {\n            var has_overlap = false;\n            var slot = this.start_end_dct[slot_num];\n            if (slot !== undefined) {\n                // Iterate through features already in slot to see if current feature will fit.\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    var s_e = slot[k];\n                    if (draw_end > s_e[0] && draw_start < s_e[1]) {\n                        // There is overlap\n                        has_overlap = true;\n                        break;\n                    }\n                }\n            }\n            if (!has_overlap) {\n                return slot_num;\n            }\n        }\n        return -1;\n    },\n\n    /**\n     * Slot features.\n     */\n    slot_features: function(features) {\n        var start_end_dct = this.start_end_dct;\n        var undone = [];\n        var highest_slot = 0;\n        var feature;\n        var feature_uid;\n\n        // Loop through features to (a) find those that are not yet slotted and (b) update\n        // those that are slotted if new information is availabe. For (a), features already\n        // slotted (based on slotting from other tiles) will retain their current slot.\n        for (let i = 0, len = features.length; i < len; i++) {\n            feature = features[i];\n            feature_uid = feature[0];\n            var slotted_info = this.slots[feature_uid];\n\n            // Separate and handle slotted vs. unslotted features.\n            if (slotted_info) {\n                // Feature is slotted; if feature now has larger start/end coordinates,\n                // update drawing coordinates.\n                if (feature[1] < slotted_info.feature[1] || slotted_info.feature[2] < feature[2]) {\n                    // Feature has changed (e.g. a single read now has its pair), so recalculate its\n                    // drawing coordinates.\n                    var old_draw_coords = this._get_draw_coords(slotted_info.feature);\n\n                    var new_draw_coords = this._get_draw_coords(feature);\n                    var slotted_coords = this.start_end_dct[slotted_info.slot];\n                    for (var k = 0; k < slotted_coords.length; k++) {\n                        var dc = slotted_coords[k];\n                        if (dc[0] === old_draw_coords[0] && dc[1] === old_draw_coords[1]) {\n                            // Replace old drawing coordinates with new ones.\n                            slotted_coords[k] = new_draw_coords;\n                        }\n                    }\n                }\n                highest_slot = Math.max(highest_slot, this.slots[feature_uid].slot);\n            } else {\n                undone.push(i);\n            }\n        }\n\n        // Slot unslotted features.\n\n        // Do slotting.\n        for (let i = 0, len = undone.length; i < len; i++) {\n            feature = features[undone[i]];\n            feature_uid = feature[0];\n            var draw_coords = this._get_draw_coords(feature);\n\n            // Find slot.\n            var slot_num = this._find_slot(draw_coords);\n\n            // Do slotting.\n            if (slot_num >= 0) {\n                // Add current feature to slot.\n                if (start_end_dct[slot_num] === undefined) {\n                    start_end_dct[slot_num] = [];\n                }\n                start_end_dct[slot_num].push(draw_coords);\n                this.slots[feature_uid] = new SlottedInfo(slot_num, feature);\n                highest_slot = Math.max(highest_slot, slot_num);\n            }\n        }\n\n        // Debugging: view slots data.\n        /*\n        for (var i = 0; i < MAX_FEATURE_DEPTH; i++) {\n            var slot = start_end_dct[i];\n            if (slot !== undefined) {\n                console.log(i, \"*************\");\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    console.log(\"\\t\", slot[k][0], slot[k][1]);\n                }\n            }\n        }\n        */\n        return highest_slot + 1;\n    }\n});\n\nexport default {\n    FeatureSlotter: FeatureSlotter\n};\n","import _ from \"libs/underscore\";\n// Constants specific to feature tracks moved here (HACKING, these should\n// basically all be configuration options)\nconst BEFORE = 1001;\nconst CONTAINS = 1002;\nconst OVERLAP_START = 1003;\nconst OVERLAP_END = 1004;\nconst CONTAINED_BY = 1005;\nconst AFTER = 1006;\n\nconst DENSE_TRACK_HEIGHT = 10;\nconst NO_DETAIL_TRACK_HEIGHT = 3;\nconst SQUISH_TRACK_HEIGHT = 5;\nconst PACK_TRACK_HEIGHT = 10;\nconst NO_DETAIL_FEATURE_HEIGHT = 1;\nconst DENSE_FEATURE_HEIGHT = 9;\nconst SQUISH_FEATURE_HEIGHT = 3;\nconst PACK_FEATURE_HEIGHT = 9;\nconst LABEL_SPACING = 2;\nconst CONNECTOR_COLOR = \"#ccc\";\n\n/**\n * Compute the type of overlap between two regions. They are assumed to be on the same chrom/contig.\n * The overlap is computed relative to the second region; hence, OVERLAP_START indicates that the first\n * region overlaps the start (but not the end) of the second region.\n * NOTE: Coordinates are assumed to be in BED format: half open (start is closed, end is open).\n */\nfunction compute_overlap(first_region, second_region) {\n    var first_start = first_region[0];\n    var first_end = first_region[1];\n    var second_start = second_region[0];\n    var second_end = second_region[1];\n    var overlap;\n    if (first_start < second_start) {\n        if (first_end <= second_start) {\n            overlap = BEFORE;\n        } else if (first_end <= second_end) {\n            overlap = OVERLAP_START;\n        } else {\n            // first_end > second_end\n            overlap = CONTAINS;\n        }\n    } else {\n        // first_start >= second_start\n        if (first_start > second_end) {\n            overlap = AFTER;\n        } else if (first_end <= second_end) {\n            overlap = CONTAINED_BY;\n        } else {\n            overlap = OVERLAP_END;\n        }\n    }\n    return overlap;\n}\n\n/**\n * Returns true if regions overlap.\n */\nfunction is_overlap(first_region, second_region) {\n    var overlap = compute_overlap(first_region, second_region);\n    return overlap !== BEFORE && overlap !== AFTER;\n}\n\n/**\n * Draw a dashed line on a canvas using filled rectangles. This function is based on:\n * http://vetruvet.blogspot.com/2010/10/drawing-dashed-lines-on-html5-canvas.html\n * However, that approach uses lines, which don't seem to render as well, so use\n * rectangles instead.\n */\nfunction dashedLine(ctx, x1, y1, x2, y2, dashLen) {\n    if (dashLen === undefined) {\n        dashLen = 4;\n    }\n    var dX = x2 - x1;\n    var dY = y2 - y1;\n    var dashes = Math.floor(Math.sqrt(dX * dX + dY * dY) / dashLen);\n    var dashX = dX / dashes;\n    var dashY = dY / dashes;\n    var q;\n\n    for (q = 0; q < dashes; q++, x1 += dashX, y1 += dashY) {\n        if (q % 2 !== 0) {\n            continue;\n        }\n        ctx.fillRect(x1, y1, dashLen, 1);\n    }\n}\n\n/**\n * Draw an isosceles triangle that points down.\n */\nfunction drawDownwardEquilateralTriangle(ctx, down_vertex_x, down_vertex_y, side_len) {\n    // Compute other two points of triangle.\n    var x1 = down_vertex_x - side_len / 2;\n\n    var x2 = down_vertex_x + side_len / 2;\n    var y = down_vertex_y - Math.sqrt((side_len * 3) / 2);\n\n    // Draw and fill.\n    ctx.beginPath();\n    ctx.moveTo(x1, y);\n    ctx.lineTo(x2, y);\n    ctx.lineTo(down_vertex_x, down_vertex_y);\n    ctx.lineTo(x1, y);\n\n    ctx.strokeStyle = this.fillStyle;\n    ctx.fill();\n    ctx.stroke();\n    ctx.closePath();\n}\n\n/**\n * Base class for all scalers. Scalers produce values that are used to change (scale) drawing attributes.\n */\nclass Scaler {\n    constructor(default_val) {\n        this.default_val = default_val ? default_val : 1;\n    }\n\n    /**\n     * Produce a scaling value.\n     */\n    gen_val(input) {\n        return this.default_val;\n    }\n}\n\n/**\n * Results from painter.draw()\n */\nclass DrawResults {\n    constructor(options) {\n        this.incomplete_features = options.incomplete_features;\n        this.feature_mapper = options.feature_mapper;\n    }\n}\n\n/**\n * Base class for painters\n *\n * -- Mode and prefs are both optional\n */\nclass Painter {\n    constructor(data, view_start, view_end, prefs, mode) {\n        // Data and data properties\n        this.data = data;\n        this.default_prefs = {};\n        // View\n        this.view_start = view_start;\n        this.view_end = view_end;\n        // Drawing prefs\n        this.prefs = _.extend({}, this.default_prefs, prefs);\n        this.mode = mode;\n    }\n\n    static get default_prefs() {\n        return {};\n    }\n\n    /**\n     * Draw on the context using a rectangle of width x height using scale w_scale.\n     */\n    draw(ctx, width, height, w_scale) {}\n\n    /**\n     * Get starting drawing position, which is offset a half-base left of coordinate.\n     */\n    get_start_draw_pos(chrom_pos, w_scale) {\n        return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, -0.5);\n    }\n\n    /**\n     * Get end drawing position, which is offset a half-base right of coordinate.\n     */\n    get_end_draw_pos(chrom_pos, w_scale) {\n        return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0.5);\n    }\n\n    /**\n     * Get drawing position.\n     */\n    get_draw_pos(chrom_pos, w_scale) {\n        return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0);\n    }\n\n    /**\n     * Convert chromosome position to drawing position.\n     */\n    _chrom_pos_to_draw_pos(chrom_pos, w_scale, offset) {\n        return Math.floor(w_scale * (Math.max(0, chrom_pos - this.view_start) + offset));\n    }\n}\n\nclass LinePainter extends Painter {\n    constructor(data, view_start, view_end, prefs, mode) {\n        super(data, view_start, view_end, prefs, mode);\n    }\n\n    static get default_prefs() {\n        return {\n            min_value: undefined,\n            max_value: undefined,\n            mode: \"Histogram\",\n            color: \"#000\",\n            overflow_color: \"#F66\"\n        };\n    }\n\n    draw(ctx, width, height, w_scale) {\n        var in_path = false;\n        var min_value = this.prefs.min_value;\n        var max_value = this.prefs.max_value;\n        var vertical_range = max_value - min_value;\n        var height_px = height;\n        var view_start = this.view_start;\n        var mode = this.mode;\n        var data = this.data;\n\n        ctx.save();\n\n        // Pixel position of 0 on the y axis\n        var y_zero = Math.round(height + (min_value / vertical_range) * height);\n\n        // Horizontal line to denote x-axis\n        if (mode !== \"Intensity\") {\n            ctx.fillStyle = \"#aaa\";\n            ctx.fillRect(0, y_zero, width, 1);\n        }\n\n        ctx.beginPath();\n        var x_scaled;\n        var y;\n        var delta_x_pxs;\n        if (data.length > 1) {\n            delta_x_pxs = _.map(data.slice(0, -1), (d, i) => Math.ceil((data[i + 1][0] - data[i][0]) * w_scale));\n        } else {\n            delta_x_pxs = [10];\n        }\n\n        // Painter color can be in either block_color (FeatureTrack) or color pref (LineTrack).\n        var painter_color = this.prefs.block_color || this.prefs.color;\n\n        var // Extract RGB from preference color.\n            pref_color = parseInt(painter_color.slice(1), 16);\n        var pref_r = (pref_color & 0xff0000) >> 16;\n        var pref_g = (pref_color & 0x00ff00) >> 8;\n        var pref_b = pref_color & 0x0000ff;\n        var top_overflow = false;\n        var bot_overflow = false;\n\n        // Paint track.\n        var delta_x_px;\n        for (var i = 0, len = data.length; i < len; i++) {\n            // Reset attributes for next point.\n            ctx.fillStyle = ctx.strokeStyle = painter_color;\n            top_overflow = bot_overflow = false;\n            delta_x_px = delta_x_pxs[i];\n\n            x_scaled = Math.floor((data[i][0] - view_start - 0.5) * w_scale);\n            y = data[i][1];\n\n            // Process Y (scaler) value.\n            if (y === null) {\n                if (in_path && mode === \"Filled\") {\n                    ctx.lineTo(x_scaled, height_px);\n                }\n                in_path = false;\n                continue;\n            }\n\n            // Bound Y value by min, max.\n            if (y < min_value) {\n                bot_overflow = true;\n                y = min_value;\n            } else if (y > max_value) {\n                top_overflow = true;\n                y = max_value;\n            }\n\n            // Draw point.\n            if (mode === \"Histogram\") {\n                // y becomes the bar height in pixels, which is the negated for canvas coords\n                y = Math.round((y / vertical_range) * height_px);\n                ctx.fillRect(x_scaled, y_zero, delta_x_px, -y);\n            } else if (mode === \"Intensity\") {\n                var saturation = (y - min_value) / vertical_range;\n\n                var // Range is [pref_color, 255] where saturation = 0 --> 255 and saturation = 1 --> pref color\n                    new_r = Math.round(pref_r + (255 - pref_r) * (1 - saturation));\n\n                var new_g = Math.round(pref_g + (255 - pref_g) * (1 - saturation));\n                var new_b = Math.round(pref_b + (255 - pref_b) * (1 - saturation));\n                ctx.fillStyle = `rgb(${new_r},${new_g},${new_b})`;\n                ctx.fillRect(x_scaled, 0, delta_x_px, height_px);\n            } else {\n                // mode is Coverage/Line or Filled.\n\n                // Scale Y value.\n                y = Math.round(height_px - ((y - min_value) / vertical_range) * height_px);\n                if (in_path) {\n                    ctx.lineTo(x_scaled, y);\n                } else {\n                    in_path = true;\n                    if (mode === \"Filled\") {\n                        ctx.moveTo(x_scaled, height_px);\n                        ctx.lineTo(x_scaled, y);\n                    } else {\n                        ctx.moveTo(x_scaled, y);\n                        // Use this approach (note: same as for filled) to draw line from 0 to\n                        // first data point.\n                        //ctx.moveTo(x_scaled, height_px);\n                        //ctx.lineTo(x_scaled, y);\n                    }\n                }\n            }\n\n            // Draw lines at boundaries if overflowing min or max\n            ctx.fillStyle = this.prefs.overflow_color;\n            if (top_overflow || bot_overflow) {\n                var overflow_x;\n                if (mode === \"Histogram\" || mode === \"Intensity\") {\n                    overflow_x = delta_x_px;\n                } else {\n                    // Line and Filled, which are points\n                    x_scaled -= 2; // Move it over to the left so it's centered on the point\n                    overflow_x = 4;\n                }\n                if (top_overflow) {\n                    ctx.fillRect(x_scaled, 0, overflow_x, 3);\n                }\n                if (bot_overflow) {\n                    ctx.fillRect(x_scaled, height_px - 3, overflow_x, 3);\n                }\n            }\n            ctx.fillStyle = painter_color;\n        }\n        if (mode === \"Filled\") {\n            if (in_path) {\n                ctx.lineTo(x_scaled, y_zero);\n                ctx.lineTo(0, y_zero);\n            }\n            ctx.fill();\n        } else {\n            ctx.stroke();\n        }\n\n        ctx.restore();\n    }\n}\n\n/**\n * Mapper that contains information about feature locations and data.\n */\nclass FeaturePositionMapper {\n    constructor(slot_height) {\n        this.feature_positions = {};\n        this.slot_height = slot_height;\n        this.translation = 0;\n        this.y_translation = 0;\n    }\n\n    /**\n     * Map feature data to a position defined by <slot, x_start, x_end>.\n     */\n    map_feature_data(feature_data, slot, x_start, x_end) {\n        if (!this.feature_positions[slot]) {\n            this.feature_positions[slot] = [];\n        }\n        this.feature_positions[slot].push({\n            data: feature_data,\n            x_start: x_start,\n            x_end: x_end\n        });\n    }\n\n    /**\n     * Get feature data for position <x, y>\n     */\n    get_feature_data(x, y) {\n        // Find slot using Y.\n        var slot = Math.floor((y - this.y_translation) / this.slot_height);\n\n        var feature_dict;\n\n        // May not be over a slot due to padding, margin, etc.\n        if (!this.feature_positions[slot]) {\n            return null;\n        }\n\n        // Find feature using X.\n        x += this.translation;\n        for (var i = 0; i < this.feature_positions[slot].length; i++) {\n            feature_dict = this.feature_positions[slot][i];\n            if (x >= feature_dict.x_start && x <= feature_dict.x_end) {\n                return feature_dict.data;\n            }\n        }\n    }\n}\n\n/**\n * Abstract object for painting feature tracks. Subclasses must implement draw_element() for painting to work.\n * Painter uses a 0-based, half-open coordinate system; start coordinate is closed--included--and the end is open.\n * This coordinate system matches the BED format.\n */\nclass FeaturePainter extends Painter {\n    constructor(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n        super(data, view_start, view_end, prefs, mode);\n        this.alpha_scaler = alpha_scaler ? alpha_scaler : new Scaler();\n        this.height_scaler = height_scaler ? height_scaler : new Scaler();\n        this.max_label_length = 200;\n    }\n\n    static get default_prefs() {\n        return {\n            block_color: \"#FFF\",\n            connector_color: \"#FFF\"\n        };\n    }\n    get_required_height(rows_required, width) {\n        // y_scale is the height per row\n        var required_height = this.get_row_height();\n\n        var y_scale = required_height;\n        var mode = this.mode;\n        // If using a packing mode, need to multiply by the number of slots used\n        if (mode === \"no_detail\" || mode === \"Squish\" || mode === \"Pack\") {\n            required_height = rows_required * y_scale;\n        }\n        return required_height + this.get_top_padding(width);\n    }\n\n    /** Extra padding before first row of features */\n    get_top_padding(width) {\n        return 0;\n    }\n\n    /**\n     * Draw data on ctx using slots and within the rectangle defined by width and height. Returns\n     * a FeaturePositionMapper object with information about where features were drawn.\n     */\n    draw(ctx, width, height, w_scale, slots) {\n        ctx.save();\n        ctx.fillStyle = this.prefs.block_color;\n        ctx.textAlign = \"right\";\n\n        var y_scale = this.get_row_height();\n        var feature_mapper = new FeaturePositionMapper(y_scale);\n        var x_draw_coords;\n        var incomplete_features = [];\n\n        for (var i = 0, len = this.data.length; i < len; i++) {\n            var feature = this.data[i];\n            var feature_uid = feature[0];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n\n            // Slot valid only if features are slotted and this feature is slotted;\n            // feature may not be due to lack of space.\n            var slot = slots && slots[feature_uid] !== undefined ? slots[feature_uid].slot : null;\n\n            // Draw feature if (a) mode is dense or feature is slotted (as it must be for all non-dense modes) and\n            // (b) there's overlap between the feature and drawing region.\n            if (\n                (this.mode === \"Dense\" || slot !== null) &&\n                (feature_start < this.view_end && feature_end > this.view_start)\n            ) {\n                x_draw_coords = this.draw_element(\n                    ctx,\n                    this.mode,\n                    feature,\n                    slot,\n                    this.view_start,\n                    this.view_end,\n                    w_scale,\n                    y_scale,\n                    width\n                );\n                feature_mapper.map_feature_data(feature, slot, x_draw_coords[0], x_draw_coords[1]);\n\n                // Add to incomplete features if it's not drawn completely in region.\n                if (feature_start < this.view_start || feature_end > this.view_end) {\n                    incomplete_features.push(feature);\n                }\n            }\n        }\n\n        ctx.restore();\n\n        feature_mapper.y_translation = this.get_top_padding(width);\n        return new DrawResults({\n            incomplete_features: incomplete_features,\n            feature_mapper: feature_mapper\n        });\n    }\n\n    /**\n     * Abstract function for drawing an individual feature.\n     */\n    draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        return [0, 0];\n    }\n}\n\nclass LinkedFeaturePainter extends FeaturePainter {\n    constructor(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n        super(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n        // Whether to draw a single connector in the background that spans the entire feature (the intron fishbone)\n        this.draw_background_connector = true;\n        // Whether to call draw_connector for every pair of blocks\n        this.draw_individual_connectors = false;\n    }\n\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"no_detail\") {\n            height = NO_DETAIL_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    }\n\n    /**\n     * Draw a feature. Returns an array with feature's start and end X coordinates.\n     */\n    draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        // var feature_uid = feature[0];\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n        var feature_strand = feature[4];\n        // -0.5 to offset region between bases.\n        var f_start = Math.floor(Math.max(0, (feature_start - tile_low - 0.5) * w_scale));\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n        var draw_start = f_start;\n        var draw_end = f_end;\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale + this.get_top_padding(width);\n        var thick_start = null;\n        var thick_end = null;\n\n        // TODO: is there any reason why block, label color cannot be set at the Painter level?\n        // For now, assume '.' === '+'\n        var block_color =\n            !feature_strand || feature_strand === \"+\" || feature_strand === \".\"\n                ? this.prefs.block_color\n                : this.prefs.reverse_strand_color;\n        var label_color = this.prefs.label_color;\n\n        // Set global alpha.\n        ctx.globalAlpha = this.alpha_scaler.gen_val(feature);\n\n        // In dense mode, put all data in top slot.\n        if (mode === \"Dense\") {\n            slot = 1;\n        }\n\n        if (mode === \"no_detail\") {\n            // No details for feature, so only one way to display.\n            ctx.fillStyle = block_color;\n            ctx.fillRect(f_start, y_start + 5, f_end - f_start, NO_DETAIL_FEATURE_HEIGHT);\n        } else {\n            // Mode is either Squish or Pack:\n            // Feature details.\n            var feature_ts = feature[5];\n\n            var feature_te = feature[6];\n            var feature_blocks = feature[7];\n\n            var // Whether we are drawing full height or squished features\n                full_height = true;\n\n            if (feature_ts && feature_te) {\n                thick_start = Math.floor(Math.max(0, (feature_ts - tile_low) * w_scale));\n                thick_end = Math.ceil(Math.min(width, Math.max(0, (feature_te - tile_low) * w_scale)));\n            }\n\n            // Set vars that depend on mode.\n            var thin_height;\n\n            var thick_height;\n            if (mode === \"Squish\") {\n                thin_height = 1;\n                thick_height = SQUISH_FEATURE_HEIGHT;\n                full_height = false;\n            } else if (mode === \"Dense\") {\n                thin_height = 5;\n                thick_height = DENSE_FEATURE_HEIGHT;\n            } else {\n                // mode === \"Pack\"\n                thin_height = 5;\n                thick_height = PACK_FEATURE_HEIGHT;\n            }\n\n            // Draw feature/feature blocks + connectors.\n            if (!feature_blocks) {\n                // If there are no blocks, treat the feature as one big exon.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                // If strand is specified, draw arrows over feature\n                if (feature_strand && full_height) {\n                    if (feature_strand === \"+\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                    } else if (feature_strand === \"-\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                    }\n                    ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                }\n            } else {\n                //\n                // There are feature blocks and mode is either Squish or Pack.\n                //\n                // Approach: (a) draw whole feature as connector/intron and (b) draw blocks as\n                // needed. This ensures that whole feature, regardless of whether it starts with\n                // a block, is visible.\n                //\n\n                // Compute y axis start position and height\n                var cur_y_start;\n\n                var cur_height;\n                if (mode === \"Squish\" || mode === \"Dense\") {\n                    cur_y_start = y_start + Math.floor(SQUISH_FEATURE_HEIGHT / 2) + 1;\n                    cur_height = 1;\n                } else {\n                    // mode === \"Pack\"\n                    if (feature_strand) {\n                        cur_y_start = y_start;\n                        cur_height = thick_height;\n                    } else {\n                        cur_y_start += SQUISH_FEATURE_HEIGHT / 2 + 1;\n                        cur_height = 1;\n                    }\n                }\n\n                // Draw whole feature as connector/intron.\n                if (this.draw_background_connector) {\n                    if (mode === \"Squish\" || mode === \"Dense\") {\n                        ctx.fillStyle = CONNECTOR_COLOR;\n                    } else {\n                        // mode === \"Pack\"\n                        if (feature_strand) {\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand\");\n                            }\n                        } else {\n                            ctx.fillStyle = CONNECTOR_COLOR;\n                        }\n                    }\n                    ctx.fillRect(f_start, cur_y_start, f_end - f_start, cur_height);\n                }\n\n                // Draw blocks.\n                for (var k = 0, k_len = feature_blocks.length; k < k_len; k++) {\n                    var block = feature_blocks[k];\n\n                    var // -0.5 to offset block between bases.\n                        block_start = Math.floor(Math.max(0, (block[0] - tile_low - 0.5) * w_scale));\n\n                    var block_end = Math.ceil(Math.min(width, Math.max((block[1] - tile_low - 0.5) * w_scale)));\n\n                    var last_block_start;\n                    var last_block_end;\n\n                    // Skip drawing if block not on tile.\n                    if (block_start > block_end) {\n                        continue;\n                    }\n\n                    // Draw thin block.\n                    ctx.fillStyle = block_color;\n                    ctx.fillRect(\n                        block_start,\n                        y_start + (thick_height - thin_height) / 2 + 1,\n                        block_end - block_start,\n                        thin_height\n                    );\n\n                    // If block intersects with thick region, draw block as thick.\n                    // - No thick is sometimes encoded as thick_start == thick_end, so don't draw in that case\n                    if (\n                        thick_start !== undefined &&\n                        feature_te > feature_ts &&\n                        !(block_start > thick_end || block_end < thick_start)\n                    ) {\n                        var block_thick_start = Math.max(block_start, thick_start);\n\n                        var block_thick_end = Math.min(block_end, thick_end);\n                        ctx.fillRect(block_thick_start, y_start + 1, block_thick_end - block_thick_start, thick_height);\n                        if (feature_blocks.length === 1 && mode === \"Pack\") {\n                            // Exactly one block means we have no introns, but do have a distinct \"thick\" region,\n                            // draw arrows over it if in pack mode.\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                            }\n                            // If region is wide enough in pixels, pad a bit\n                            if (block_thick_start + 14 < block_thick_end) {\n                                block_thick_start += 2;\n                                block_thick_end -= 2;\n                            }\n                            ctx.fillRect(\n                                block_thick_start,\n                                y_start + 1,\n                                block_thick_end - block_thick_start,\n                                thick_height\n                            );\n                        }\n                    }\n                    // Draw individual connectors if required\n                    if (this.draw_individual_connectors && last_block_start) {\n                        this.draw_connector(ctx, last_block_start, last_block_end, block_start, block_end, y_start);\n                    }\n                    last_block_start = block_start;\n                    last_block_end = block_end;\n                }\n\n                // FIXME: Height scaling only works in Pack mode right now.\n                if (mode === \"Pack\") {\n                    // Reset alpha so height scaling is not impacted by alpha scaling.\n                    ctx.globalAlpha = 1;\n\n                    // Height scaling: draw white lines to reduce height according to height scale factor.\n                    ctx.fillStyle = \"white\"; // TODO: set this to background color.\n                    var hscale_factor = this.height_scaler.gen_val(feature);\n\n                    var // Ceil ensures that min height is >= 1.\n                        new_height = Math.ceil(thick_height * hscale_factor);\n\n                    var ws_height = Math.round((thick_height - new_height) / 2);\n                    if (hscale_factor !== 1) {\n                        ctx.fillRect(f_start, cur_y_start + 1, f_end - f_start, ws_height);\n                        ctx.fillRect(f_start, cur_y_start + thick_height - ws_height + 1, f_end - f_start, ws_height);\n                    }\n                }\n            }\n\n            // Reset alpha so that label is not transparent.\n            ctx.globalAlpha = 1;\n\n            // Draw label for Pack mode.\n            if (feature_name && mode === \"Pack\" && feature_start > tile_low) {\n                ctx.fillStyle = label_color;\n                // FIXME: assumption here that the entire view starts at 0\n                if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                    ctx.textAlign = \"left\";\n                    ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_end += ctx.measureText(feature_name).width + LABEL_SPACING;\n                } else {\n                    ctx.textAlign = \"right\";\n                    ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_start -= ctx.measureText(feature_name).width + LABEL_SPACING;\n                }\n                //ctx.fillStyle = block_color;\n            }\n        }\n\n        // Reset global alpha.\n        ctx.globalAlpha = 1;\n\n        return [draw_start, draw_end];\n    }\n}\n\nclass ReadPainter extends FeaturePainter {\n    constructor(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler, ref_seq, base_color_fn) {\n        super(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n        this.ref_seq = ref_seq ? ref_seq.data : null;\n        this.base_color_fn = base_color_fn;\n    }\n    /**\n     * Returns height based on mode.\n     */\n    get_row_height() {\n        var height;\n        var mode = this.mode;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n            if (this.prefs.show_insertions) {\n                height *= 2;\n            }\n        }\n        return height;\n    }\n\n    /**\n     * Parse CIGAR string to get (a) a list of contiguous drawing blocks (MD=X) and\n     * (b) an array of [ op_index, op_len ] pairs where op_index is an index into the\n     * string 'MIDNSHP=X' Return value is a dictionary with two entries, blocks and cigar\n     */\n    _parse_cigar(cigar_str) {\n        var cigar_ops = \"MIDNSHP=X\";\n\n        // Parse cigar.\n        var blocks = [[0, 0]];\n\n        var cur_block = blocks[0];\n        var base_pos = 0;\n\n        var // Parse cigar operations out and update/create blocks as needed.\n            parsed_cigar = _.map(cigar_str.match(/[0-9]+[MIDNSHP=X]/g), op => {\n                // Get operation length, character.\n                var op_len = parseInt(op.slice(0, -1), 10),\n                    op_char = op.slice(-1);\n\n                // Update drawing block.\n                if (op_char === \"N\") {\n                    // At skip, so need to start new block if current block represents\n                    // drawing area.\n                    if (cur_block[1] !== 0) {\n                        cur_block = [base_pos + op_len, base_pos + op_len];\n                        blocks.push(cur_block);\n                    }\n                } else if (\"ISHP\".indexOf(op_char) === -1) {\n                    // Operation is M,D,=,X.\n                    cur_block[1] += op_len;\n                    base_pos += op_len;\n                }\n\n                // Return parsed cigar.\n                return [cigar_ops.indexOf(op_char), op_len];\n            });\n\n        return {\n            blocks: blocks,\n            cigar: parsed_cigar\n        };\n    }\n\n    /**\n     * Draw a single read from reference-based read sequence and cigar.\n     */\n    draw_read(ctx, mode, w_scale, y_start, tile_low, tile_high, feature_start, cigar, strand, read_seq) {\n        // Helper function to update base and sequnence offsets.\n        var update_base_offset = (offset, cig_op, cig_len) => {\n            if (\"M=NXD\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var update_seq_offset = (offset, cig_op, cig_len) => {\n            if (\"IX\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var // Gets drawing coordinate for a sequence coordinate. Assumes closure variables w_scale and tile_low.\n            get_draw_coord = (\n                sequence_coord // -0.5 to offset sequence between bases.\n            ) => Math.floor(Math.max(0, (sequence_coord - tile_low - 0.5) * w_scale));\n\n        ctx.textAlign = \"center\";\n        var tile_region = [tile_low, tile_high];\n        var base_offset = 0;\n        var seq_offset = 0;\n        var gap = Math.round(w_scale / 2);\n        var char_width_px = ctx.canvas.manager.char_width_px;\n\n        var block_color = strand === \"+\" ? this.prefs.detail_block_color : this.prefs.reverse_strand_color;\n\n        var pack_mode = mode === \"Pack\";\n\n        var draw_height = pack_mode ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        var rect_y = y_start + 1;\n        var paint_utils = new ReadPainterUtils(ctx, draw_height, w_scale, mode);\n        var drawing_blocks = [];\n        var s_start;\n        var s_end;\n\n        // Keep list of items that need to be drawn on top of initial drawing layer.\n        var draw_last = [];\n\n        // Parse cigar and get drawing blocks.\n        var t = this._parse_cigar(cigar);\n        cigar = t.cigar;\n        drawing_blocks = t.blocks;\n\n        // Draw blocks.\n        for (var i = 0; i < drawing_blocks.length; i++) {\n            var block = drawing_blocks[i];\n\n            if (is_overlap([feature_start + block[0], feature_start + block[1]], tile_region)) {\n                s_start = get_draw_coord(feature_start + block[0]);\n                s_end = get_draw_coord(feature_start + block[1]);\n\n                // Make sure that block is drawn even if it too small to be rendered officially; in this case,\n                // read is drawn at 1px.\n                // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n                // and drawing.\n                if (s_start === s_end) {\n                    s_end += 1;\n                }\n\n                // Draw read base as rectangle.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(s_start, rect_y, s_end - s_start, draw_height);\n            }\n        }\n\n        // Draw read features.\n        for (var cig_id = 0, len = cigar.length; cig_id < len; cig_id++) {\n            var cig = cigar[cig_id];\n            var cig_op = \"MIDNSHP=X\"[cig[0]];\n            var cig_len = cig[1];\n\n            var seq_start = feature_start + base_offset;\n            s_start = get_draw_coord(seq_start);\n            s_end = get_draw_coord(seq_start + cig_len);\n\n            // Skip feature if it's not in tile.\n            if (!is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                // Update offsets.\n                base_offset = update_base_offset(base_offset, cig_op, cig_len);\n                seq_offset = update_seq_offset(seq_offset, cig_op, cig_len);\n                continue;\n            }\n\n            // Make sure that read is drawn even if it too small to be rendered officially; in this case,\n            // read is drawn at 1px.\n            // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n            // and drawing.\n            if (s_start === s_end) {\n                s_end += 1;\n            }\n\n            // Draw read feature.\n            switch (cig_op) {\n                case \"H\": // Hard clipping.\n                case \"S\": // Soft clipping.\n                case \"P\": // Padding.\n                    // Sequence not present and not related to alignment; do nothing.\n                    break;\n                case \"M\": // \"Match\".\n                    // Because it's not known whether there is a match, ignore.\n                    base_offset += cig_len;\n                    break;\n                case \"=\": // Match with reference.\n                case \"X\": // Mismatch with reference.\n                    //\n                    // Draw sequence and/or variants.\n                    //\n\n                    // Get sequence to draw.\n                    var cur_seq = \"\";\n                    if (cig_op === \"X\") {\n                        // Get sequence from read_seq.\n                        cur_seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                    } else if (this.ref_seq) {\n                        // && cig_op === '='\n                        // Use reference sequence.\n                        cur_seq = this.ref_seq.slice(\n                            // If read starts after tile start, slice at read start.\n                            Math.max(0, seq_start - tile_low),\n                            // If read ends before tile end, slice at read end.\n                            Math.min(seq_start - tile_low + cig_len, tile_high - tile_low)\n                        );\n                    }\n\n                    // Draw sequence. Because cur_seq starts and read/tile start, go to there to start writing.\n                    var start_pos = Math.max(seq_start, tile_low);\n                    for (let c = 0; c < cur_seq.length; c++) {\n                        // Draw base if showing all (i.e. not showing differences) or there is a mismatch.\n                        if ((cur_seq && !this.prefs.show_differences) || cig_op === \"X\") {\n                            // Draw base.\n                            let c_start = Math.floor(Math.max(0, (start_pos + c - tile_low) * w_scale));\n                            ctx.fillStyle = this.base_color_fn(cur_seq[c]);\n                            if (pack_mode && w_scale > char_width_px) {\n                                ctx.fillText(cur_seq[c], c_start, y_start + 9);\n                            } else if (w_scale > 0.05) {\n                                // Require a minimum w_scale so that variants are only drawn when somewhat zoomed in.\n                                ctx.fillRect(c_start - gap, rect_y, Math.max(1, Math.round(w_scale)), draw_height);\n                            }\n                        }\n                    }\n\n                    // Move forward in sequence only if sequence used to get mismatches.\n                    if (cig_op === \"X\") {\n                        seq_offset += cig_len;\n                    }\n                    base_offset += cig_len;\n\n                    break;\n                case \"N\": // Skipped bases.\n                    ctx.fillStyle = CONNECTOR_COLOR;\n                    ctx.fillRect(s_start, rect_y + (draw_height - 1) / 2, s_end - s_start, 1);\n                    // No change in seq_offset because sequence not used when skipping.\n                    base_offset += cig_len;\n                    break;\n                case \"D\": // Deletion.\n                    paint_utils.draw_deletion(s_start, rect_y, cig_len);\n                    base_offset += cig_len;\n                    break;\n                case \"I\": // Insertion.\n                    // Check to see if sequence should be drawn at all by looking at the overlap between\n                    // the sequence region and the tile region.\n                    var insert_x_coord = s_start - gap;\n\n                    if (is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                        var seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                        // Insertion point is between the sequence start and the previous base: (-gap) moves\n                        // back from sequence start to insertion point.\n                        if (this.prefs.show_insertions) {\n                            //\n                            // Show inserted sequence above, centered on insertion point.\n                            //\n\n                            // Draw sequence.\n                            // X center is offset + start - <half_sequence_length>\n                            var x_center = s_start - (s_end - s_start) / 2;\n                            if (\n                                (mode === \"Pack\" || this.mode === \"Auto\") &&\n                                read_seq !== undefined &&\n                                w_scale > char_width_px\n                            ) {\n                                // Draw sequence container.\n                                ctx.fillStyle = \"yellow\";\n                                ctx.fillRect(x_center - gap, y_start - 9, s_end - s_start, 9);\n                                draw_last[draw_last.length] = {\n                                    type: \"triangle\",\n                                    data: [insert_x_coord, y_start + 4, 5]\n                                };\n                                ctx.fillStyle = CONNECTOR_COLOR;\n                                // Based on overlap b/t sequence and tile, get sequence to be drawn.\n                                switch (compute_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                                    case OVERLAP_START:\n                                        seq = seq.slice(tile_low - seq_start);\n                                        break;\n                                    case OVERLAP_END:\n                                        seq = seq.slice(0, seq_start - tile_high);\n                                        break;\n                                    case CONTAINED_BY:\n                                        // All of sequence drawn.\n                                        break;\n                                    case CONTAINS:\n                                        seq = seq.slice(tile_low - seq_start, seq_start - tile_high);\n                                        break;\n                                }\n                                // Draw sequence.\n                                for (let c = 0, str_len = seq.length; c < str_len; c++) {\n                                    let c_start = Math.floor(Math.max(0, (seq_start + c - tile_low) * w_scale));\n                                    ctx.fillText(seq[c], c_start - (s_end - s_start) / 2, y_start);\n                                }\n                            } else {\n                                // Draw block.\n                                ctx.fillStyle = \"yellow\";\n                                // TODO: This is a pretty hack-ish way to fill rectangle based on mode.\n                                ctx.fillRect(\n                                    x_center,\n                                    y_start + (this.mode !== \"Dense\" ? 2 : 5),\n                                    s_end - s_start,\n                                    mode !== \"Dense\" ? SQUISH_FEATURE_HEIGHT : DENSE_FEATURE_HEIGHT\n                                );\n                            }\n                        } else {\n                            if (\n                                (mode === \"Pack\" || this.mode === \"Auto\") &&\n                                read_seq !== undefined &&\n                                w_scale > char_width_px\n                            ) {\n                                // Show insertions with a single number at the insertion point.\n                                draw_last.push({\n                                    type: \"text\",\n                                    data: [seq.length, insert_x_coord, y_start + 9]\n                                });\n                            } else {\n                                // TODO: probably can merge this case with code above.\n                            }\n                        }\n                    }\n                    seq_offset += cig_len;\n                    // No change to base offset because insertions are drawn above sequence/read.\n                    break;\n            }\n        }\n\n        //\n        // Draw last items.\n        //\n        ctx.fillStyle = \"yellow\";\n        var item;\n        var type;\n        var data;\n        for (let i = 0; i < draw_last.length; i++) {\n            item = draw_last[i];\n            type = item.type;\n            data = item.data;\n            if (type === \"text\") {\n                ctx.save();\n                ctx.font = `bold ${ctx.font}`;\n                ctx.fillText(data[0], data[1], data[2]);\n                ctx.restore();\n            } else if (type === \"triangle\") {\n                drawDownwardEquilateralTriangle(ctx, data[0], data[1], data[2]);\n            }\n        }\n    }\n\n    /**\n     * Draw a complete read pair\n     */\n    draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        // All features need a start, end, and vertical center.\n        // var feature_uid = feature[0];\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n\n        var // -0.5 to put element between bases.\n            f_start = Math.floor(Math.max(-0.5 * w_scale, (feature_start - tile_low - 0.5) * w_scale));\n\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale;\n\n        var draw_height = mode === \"Pack\" ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        // Draw read.\n        if (feature[5] instanceof Array) {\n            // Read is paired.\n            var connector = true;\n\n            // Draw left/forward read.\n            if (feature[4][1] >= tile_low && feature[4][0] <= tile_high && feature[4][2]) {\n                this.draw_read(\n                    ctx,\n                    mode,\n                    w_scale,\n                    y_start,\n                    tile_low,\n                    tile_high,\n                    feature[4][0],\n                    feature[4][2],\n                    feature[4][3],\n                    feature[4][4]\n                );\n            } else {\n                connector = false;\n            }\n\n            // Draw right/reverse read.\n            if (feature[5][1] >= tile_low && feature[5][0] <= tile_high && feature[5][2]) {\n                this.draw_read(\n                    ctx,\n                    mode,\n                    w_scale,\n                    y_start,\n                    tile_low,\n                    tile_high,\n                    feature[5][0],\n                    feature[5][2],\n                    feature[5][3],\n                    feature[5][4]\n                );\n            } else {\n                connector = false;\n            }\n\n            // Draw connector if both reads were drawn.\n            // TODO: currently, there is no way to connect reads drawn on different tiles; to connect reads on different tiles, data manager\n            // code is needed to join mate pairs from different regions. Alternatively, requesting multiple regions of data at once would\n            // make it possible to put together more easily.\n            // -0.5 to position connector correctly between reads.\n            var b1_end = Math.ceil(\n                Math.min(width, Math.max(-0.5 * w_scale, (feature[4][1] - tile_low - 0.5) * w_scale))\n            );\n\n            var b2_start = Math.floor(Math.max(-0.5 * w_scale, (feature[5][0] - tile_low - 0.5) * w_scale));\n\n            if (connector && b2_start > b1_end) {\n                ctx.fillStyle = CONNECTOR_COLOR;\n                var line_height = y_start + 1 + (draw_height - 1) / 2;\n                dashedLine(ctx, b1_end, line_height, b2_start, line_height);\n            }\n        } else {\n            // Read is single.\n            this.draw_read(\n                ctx,\n                mode,\n                w_scale,\n                y_start,\n                tile_low,\n                tile_high,\n                feature_start,\n                feature[4],\n                feature[5],\n                feature[6]\n            );\n        }\n        if (mode === \"Pack\" && feature_start >= tile_low && feature_name !== \".\") {\n            // Draw label.\n            ctx.fillStyle = this.prefs.label_color;\n            if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                ctx.textAlign = \"left\";\n                ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 9, this.max_label_length);\n            } else {\n                ctx.textAlign = \"right\";\n                ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 9, this.max_label_length);\n            }\n        }\n\n        // FIXME: provide actual coordinates for drawn read.\n        return [0, 0];\n    }\n}\n\nclass ArcLinkedFeaturePainter extends LinkedFeaturePainter {\n    constructor(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n        super(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n        // Need to know the longest feature length for adding spacing\n        this.longest_feature_length = this.calculate_longest_feature_length();\n        this.draw_background_connector = false;\n        this.draw_individual_connectors = true;\n    }\n\n    calculate_longest_feature_length() {\n        var longest_feature_length = 0;\n        for (let i = 0, len = this.data.length; i < len; i++) {\n            var feature = this.data[i];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n            longest_feature_length = Math.max(longest_feature_length, feature_end - feature_start);\n        }\n        return longest_feature_length;\n    }\n\n    get_top_padding(width) {\n        var view_range = this.view_end - this.view_start;\n        var w_scale = width / view_range;\n        return Math.min(128, Math.ceil((this.longest_feature_length / 2) * w_scale));\n    }\n\n    draw_connector(ctx, block1_start, block1_end, block2_start, block2_end, y_start) {\n        // Arc drawing -- from closest endpoints\n        var x_center = (block1_end + block2_start) / 2;\n        var radius = block2_start - x_center;\n        if (radius > 0) {\n            ctx.beginPath();\n            ctx.arc(x_center, y_start, block2_start - x_center, Math.PI, 0);\n            ctx.stroke();\n        }\n    }\n}\n\n// Color stuff from less.js\n\nclass Color {\n    constructor(rgb, a) {\n        /**\n         * The end goal here, is to parse the arguments\n         * into an integer triplet, such as `128, 255, 0`\n         *\n         * This facilitates operations and conversions.\n         */\n        if (Array.isArray(rgb)) {\n            this.rgb = rgb;\n        } else if (rgb.length == 6) {\n            this.rgb = rgb.match(/.{2}/g).map(c => parseInt(c, 16));\n        } else if (rgb.length == 7) {\n            this.rgb = rgb\n                .substring(1, 7)\n                .match(/.{2}/g)\n                .map(c => parseInt(c, 16));\n        } else {\n            this.rgb = rgb.split(\"\").map(c => parseInt(c + c, 16));\n        }\n        this.alpha = typeof a === \"number\" ? a : 1;\n    }\n\n    eval() {\n        return this;\n    }\n\n    //\n    // If we have some transparency, the only way to represent it\n    // is via `rgba`. Otherwise, we use the hex representation,\n    // which has better compatibility with older browsers.\n    // Values are capped between `0` and `255`, rounded and zero-padded.\n    //\n    toCSS() {\n        if (this.alpha < 1.0) {\n            return `rgba(${this.rgb\n                .map(c => Math.round(c))\n                .concat(this.alpha)\n                .join(\", \")})`;\n        } else {\n            return `#${this.rgb\n                .map(i => {\n                    i = Math.round(i);\n                    i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n                    return i.length === 1 ? `0${i}` : i;\n                })\n                .join(\"\")}`;\n        }\n    }\n\n    toHSL() {\n        var r = this.rgb[0] / 255;\n        var g = this.rgb[1] / 255;\n        var b = this.rgb[2] / 255;\n        var a = this.alpha;\n        var max = Math.max(r, g, b);\n        var min = Math.min(r, g, b);\n        var h;\n        var s;\n        var l = (max + min) / 2;\n        var d = max - min;\n\n        if (max === min) {\n            h = s = 0;\n        } else {\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n            switch (max) {\n                case r:\n                    h = (g - b) / d + (g < b ? 6 : 0);\n                    break;\n                case g:\n                    h = (b - r) / d + 2;\n                    break;\n                case b:\n                    h = (r - g) / d + 4;\n                    break;\n            }\n            h /= 6;\n        }\n        return { h: h * 360, s: s, l: l, a: a };\n    }\n\n    toARGB() {\n        var argb = [Math.round(this.alpha * 255)].concat(this.rgb);\n        return `#${argb\n            .map(i => {\n                i = Math.round(i);\n                i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n                return i.length === 1 ? `0${i}` : i;\n            })\n            .join(\"\")}`;\n    }\n\n    mix(color2, weight) {\n        var color1 = this;\n\n        var p = weight; // .value / 100.0;\n        var w = p * 2 - 1;\n        var a = color1.toHSL().a - color2.toHSL().a;\n\n        var w1 = ((w * a == -1 ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\n        var w2 = 1 - w1;\n\n        var rgb = [\n            color1.rgb[0] * w1 + color2.rgb[0] * w2,\n            color1.rgb[1] * w1 + color2.rgb[1] * w2,\n            color1.rgb[2] * w1 + color2.rgb[2] * w2\n        ];\n\n        var alpha = color1.alpha * p + color2.alpha * (1 - p);\n\n        return new Color(rgb, alpha);\n    }\n}\n\n// End colors from less.js\n\nclass LinearRamp {\n    constructor(start_color, end_color, start_value, end_value) {\n        /**\n         * Simple linear gradient\n         */\n        this.start_color = new Color(start_color);\n        this.end_color = new Color(end_color);\n        this.start_value = start_value;\n        this.end_value = end_value;\n        this.value_range = end_value - start_value;\n    }\n\n    map_value(value) {\n        value = Math.max(value, this.start_value);\n        value = Math.min(value, this.end_value);\n        value = (value - this.start_value) / this.value_range;\n        // HACK: just red for now\n        // return \"hsl(0,100%,\" + (value * 100) + \"%)\"\n        return this.start_color.mix(this.end_color, 1 - value).toCSS();\n    }\n}\n\nclass SplitRamp {\n    constructor(start_color, middle_color, end_color, start_value, end_value) {\n        /**\n         * Two gradients split away from 0\n         */\n        this.positive_ramp = new LinearRamp(middle_color, end_color, 0, end_value);\n        this.negative_ramp = new LinearRamp(middle_color, start_color, 0, -start_value);\n        this.start_value = start_value;\n        this.end_value = end_value;\n    }\n\n    map_value(value) {\n        value = Math.max(value, this.start_value);\n        value = Math.min(value, this.end_value);\n        if (value >= 0) {\n            return this.positive_ramp.map_value(value);\n        } else {\n            return this.negative_ramp.map_value(-value);\n        }\n    }\n}\n\nclass DiagonalHeatmapPainter extends Painter {\n    constructor(data, view_start, view_end, prefs, mode) {\n        super(data, view_start, view_end, prefs, mode);\n        var i;\n        var len;\n\n        if (this.prefs.min_value === undefined) {\n            var min_value = Infinity;\n            for (i = 0, len = this.data.length; i < len; i++) {\n                min_value = Math.min(min_value, this.data[i][6]);\n            }\n            this.prefs.min_value = min_value;\n        }\n        if (this.prefs.max_value === undefined) {\n            var max_value = -Infinity;\n            for (i = 0, len = this.data.length; i < len; i++) {\n                max_value = Math.max(max_value, this.data[i][6]);\n            }\n            this.prefs.max_value = max_value;\n        }\n    }\n\n    static get default_prefs() {\n        return {\n            min_value: undefined,\n            max_value: undefined,\n            mode: \"Heatmap\",\n            pos_color: \"#FF8C00\",\n            neg_color: \"#4169E1\"\n        };\n    }\n\n    draw(ctx, width, height, w_scale) {\n        var min_value = this.prefs.min_value;\n        var max_value = this.prefs.max_value;\n        var view_start = this.view_start;\n        var invsqrt2 = 1 / Math.sqrt(2);\n\n        var ramp = new SplitRamp(this.prefs.neg_color, \"#FFFFFF\", this.prefs.pos_color, min_value, max_value);\n\n        var d;\n        var s1;\n        var e1;\n        var s2;\n        var e2;\n        var value;\n\n        var scale = p => (p - view_start) * w_scale;\n\n        ctx.save();\n\n        // Draw into triangle, then rotate and scale\n        ctx.rotate((-45 * Math.PI) / 180);\n        ctx.scale(invsqrt2, invsqrt2);\n\n        // Paint track.\n        for (var i = 0, len = this.data.length; i < len; i++) {\n            d = this.data[i];\n\n            s1 = scale(d[1]);\n            e1 = scale(d[2]);\n            s2 = scale(d[4]);\n            e2 = scale(d[5]);\n            value = d[6];\n\n            ctx.fillStyle = ramp.map_value(value);\n            ctx.fillRect(s1, s2, e1 - s1, e2 - s2);\n        }\n\n        ctx.restore();\n    }\n}\n\n/**\n * Utilities for painting reads.\n */\nclass ReadPainterUtils {\n    constructor(ctx, row_height, px_per_base, mode) {\n        this.ctx = ctx;\n        this.row_height = row_height;\n        this.px_per_base = px_per_base;\n        this.draw_details = (mode === \"Pack\" || mode === \"Auto\") && px_per_base >= ctx.canvas.manager.char_width_px;\n        this.delete_details_thickness = 0.2;\n    }\n\n    /**\n     * Draw deletion of base(s).\n     * @param draw_detail if true, drawing in detail and deletion is drawn more subtly\n     */\n    draw_deletion(x, y, len) {\n        this.ctx.fillStyle = \"black\";\n        var thickness = (this.draw_details ? this.delete_details_thickness : 1) * this.row_height;\n        y += 0.5 * (this.row_height - thickness);\n        this.ctx.fillRect(x, y, len * this.px_per_base, thickness);\n    }\n}\n\n/**\n * Paints variant data onto canvas.\n */\nclass VariantPainter extends Painter {\n    constructor(data, view_start, view_end, prefs, mode, base_color_fn) {\n        super(data, view_start, view_end, prefs, mode);\n        this.base_color_fn = base_color_fn;\n        this.divider_height = 1;\n    }\n\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    }\n\n    /**\n     * Returns required height to draw a particular number of samples in a given mode.\n     */\n    get_required_height(num_samples) {\n        // FIXME: for single-sample data, height should be summary_height when zoomed out and\n        // row_height when zoomed in.\n        var height = this.prefs.summary_height;\n\n        // If showing sample data, height is summary + divider + samples.\n        if (num_samples > 1 && this.prefs.show_sample_data) {\n            height += this.divider_height + num_samples * this.get_row_height();\n        }\n        return height;\n    }\n\n    /**\n     * Draw on the context using a rectangle of width x height with scale w_scale.\n     */\n    draw(ctx, width, height, w_scale) {\n        ctx.save();\n\n        var /**\n             * Returns dictionary of information about an indel; returns empty if there no indel. Assumes indel is left-aligned.\n             * Dict attributes:\n             *    -type: 'insertion' or 'deletion'\n             *    -start: where the deletion starts relative to reference start\n             *    -len: how long the deletion is\n             */\n            get_indel_info = (ref, alt) => {\n                var ref_len = ref.length;\n                var alt_len = alt.length;\n                var start = 0;\n                var len = 1;\n                var type = null;\n                if (alt === \"-\") {\n                    type = \"deletion\";\n                    len = ref.length;\n                } else if (ref.indexOf(alt) === 0 && ref_len > alt_len) {\n                    type = \"deletion\";\n                    len = ref_len - alt_len;\n                    start = alt_len;\n                } else if (alt.indexOf(ref) === 0 && ref_len < alt_len) {\n                    // Insertion.\n                    type = \"insertion\";\n                    len = alt_len - ref_len;\n                    start = alt_len;\n                }\n\n                return type !== null ? { type: type, start: start, len: len } : {};\n            };\n\n        // Draw.\n        var locus_data;\n\n        var pos;\n        var ref;\n        var alt;\n        var sample_gts;\n        var allele_counts;\n        var variant;\n        var draw_x_start;\n        var draw_y_start;\n        var genotype;\n\n        var // Always draw variants at least 1 pixel wide.\n            base_px = Math.max(1, Math.floor(w_scale));\n\n        var // Determine number of samples.\n            num_samples = this.data.length ? this.data[0][7].split(\",\").length : 0;\n\n        var row_height = this.mode === \"Squish\" ? SQUISH_TRACK_HEIGHT : PACK_TRACK_HEIGHT;\n\n        var // If zoomed out, fill the whole row with feature to make it easier to read;\n            // when zoomed in, use feature height so that there are gaps in sample rows.\n            feature_height =\n                w_scale < 0.1 ? row_height : this.mode === \"Squish\" ? SQUISH_FEATURE_HEIGHT : PACK_FEATURE_HEIGHT;\n\n        var draw_summary = true;\n\n        var paint_utils = new ReadPainterUtils(ctx, row_height, w_scale, this.mode);\n\n        var j;\n\n        // If there's a single sample, update drawing variables.\n        if (num_samples === 1) {\n            row_height = feature_height =\n                w_scale < ctx.canvas.manager.char_width_px ? this.prefs.summary_height : row_height;\n            paint_utils.row_height = row_height;\n            // No summary when there's a single sample.\n            draw_summary = false;\n        }\n\n        // Draw divider between summary and samples.\n        if (this.prefs.show_sample_data && draw_summary) {\n            ctx.fillStyle = \"#F3F3F3\";\n            ctx.globalAlpha = 1;\n            ctx.fillRect(0, this.prefs.summary_height - this.divider_height, width, this.divider_height);\n        }\n\n        // Draw variants.\n        ctx.textAlign = \"center\";\n        for (var i = 0; i < this.data.length; i++) {\n            // Get locus data.\n            locus_data = this.data[i];\n            pos = locus_data[1];\n            ref = locus_data[3];\n            alt = [locus_data[4].split(\",\")];\n            sample_gts = locus_data[7].split(\",\");\n            allele_counts = locus_data.slice(8);\n\n            // Process alterate values to derive information about each alt.\n            alt = _.map(_.flatten(alt), a => {\n                var alt_info = {\n                    type: \"snp\",\n                    value: a,\n                    start: 0\n                };\n\n                var indel_info = get_indel_info(ref, a);\n\n                return _.extend(alt_info, indel_info);\n            });\n\n            // Only draw locus data if it's in viewing region.\n            if (pos < this.view_start || pos > this.view_end) {\n                continue;\n            }\n\n            // Draw summary for alleles.\n            if (draw_summary) {\n                ctx.fillStyle = \"#999999\";\n                ctx.globalAlpha = 1;\n                for (j = 0; j < alt.length; j++) {\n                    // Draw background for summary.\n                    draw_x_start = this.get_start_draw_pos(pos + alt[j].start, w_scale);\n                    ctx.fillRect(draw_x_start, 0, base_px, this.prefs.summary_height);\n                    draw_y_start = this.prefs.summary_height;\n                    // Draw allele fractions onto summary.\n                    for (j = 0; j < alt.length; j++) {\n                        ctx.fillStyle = alt[j].type === \"deletion\" ? \"black\" : this.base_color_fn(alt[j].value);\n                        var allele_frac = allele_counts / sample_gts.length;\n                        var draw_height = Math.ceil(this.prefs.summary_height * allele_frac);\n                        ctx.fillRect(draw_x_start, draw_y_start - draw_height, base_px, draw_height);\n                        draw_y_start -= draw_height;\n                    }\n                }\n            }\n\n            // Done drawing if not showing samples data.\n            if (!this.prefs.show_sample_data) {\n                continue;\n            }\n\n            // Draw sample genotype(s).\n            draw_y_start = draw_summary ? this.prefs.summary_height + this.divider_height : 0;\n            for (j = 0; j < sample_gts.length; j++, draw_y_start += row_height) {\n                genotype = sample_gts[j] ? sample_gts[j].split(/\\/|\\|/) : [\"0\", \"0\"];\n\n                // Get variant to draw and set drawing properties.\n                variant = null;\n                if (genotype[0] === genotype[1]) {\n                    if (genotype[0] === \".\") {\n                        // TODO: draw uncalled variant.\n                    } else if (genotype[0] !== \"0\") {\n                        // Homozygous for variant.\n                        variant = alt[parseInt(genotype[0], 10) - 1];\n                        ctx.globalAlpha = 1;\n                    }\n                    // else reference\n                } else {\n                    // Heterozygous for variant.\n                    variant = genotype[0] !== \"0\" ? genotype[0] : genotype[1];\n                    variant = alt[parseInt(variant, 10) - 1];\n                    ctx.globalAlpha = 0.5;\n                }\n\n                // If there's a variant, draw it.\n                if (variant) {\n                    draw_x_start = this.get_start_draw_pos(pos + variant.start, w_scale);\n                    if (variant.type === \"snp\") {\n                        var snp = variant.value;\n                        ctx.fillStyle = this.base_color_fn(snp);\n                        if (paint_utils.draw_details) {\n                            ctx.fillText(snp, this.get_draw_pos(pos, w_scale), draw_y_start + row_height);\n                        } else {\n                            ctx.fillRect(draw_x_start, draw_y_start + 1, base_px, feature_height);\n                        }\n                    } else if (variant.type === \"deletion\") {\n                        paint_utils.draw_deletion(draw_x_start, draw_y_start + 1, variant.len);\n                    } else {\n                        // TODO: handle insertions.\n                    }\n                }\n            }\n        }\n\n        ctx.restore();\n    }\n}\n\nexport default {\n    Scaler: Scaler,\n    LinePainter: LinePainter,\n    LinkedFeaturePainter: LinkedFeaturePainter,\n    ReadPainter: ReadPainter,\n    ArcLinkedFeaturePainter: ArcLinkedFeaturePainter,\n    DiagonalHeatmapPainter: DiagonalHeatmapPainter,\n    VariantPainter: VariantPainter\n};\n","import $ from \"jquery\";\nimport _l from \"utils/localization\";\nimport _ from \"libs/underscore\";\nimport { getGalaxyInstance } from \"app\";\n\n/**\n * Filters that enable users to show/hide data points dynamically.\n */\nvar Filter = function(obj_dict) {\n    this.manager = null;\n    this.name = obj_dict.name;\n    // Index into payload to filter.\n    this.index = obj_dict.index;\n    this.tool_id = obj_dict.tool_id;\n    // Name to use for filter when building expression for tool.\n    this.tool_exp_name = obj_dict.tool_exp_name;\n};\n\n_.extend(Filter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        return {\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        };\n    }\n});\n\n/**\n * Creates an action icon.\n */\nvar create_action_icon = (title, css_class, on_click_fn) =>\n    $(\"<a/>\")\n        .attr(\"href\", \"javascript:void(0);\")\n        .attr(\"title\", title)\n        .addClass(\"icon-button\")\n        .addClass(css_class)\n        .tooltip()\n        .click(on_click_fn);\n\n/**\n * Number filters have a min, max as well as a low, high; low and high are used\n */\nvar NumberFilter = function(obj_dict) {\n    //\n    // Attribute init.\n    //\n    Filter.call(this, obj_dict);\n    // Filter low/high. These values are used to filter elements.\n    this.low = \"low\" in obj_dict ? obj_dict.low : -Number.MAX_VALUE;\n    this.high = \"high\" in obj_dict ? obj_dict.high : Number.MAX_VALUE;\n    // Slide min/max. These values are used to set/update slider.\n    this.min = \"min\" in obj_dict ? obj_dict.min : Number.MAX_VALUE;\n    this.max = \"max\" in obj_dict ? obj_dict.max : -Number.MAX_VALUE;\n    // UI elements associated with filter.\n    this.container = null;\n    this.slider = null;\n    this.slider_label = null;\n\n    //\n    // Create HTML.\n    //\n\n    // Function that supports inline text editing of slider values.\n    // Enable users to edit parameter's value via a text box.\n    var edit_slider_values = (container, span, slider) => {\n        container.click(function() {\n            var cur_value = span.text();\n            var max = parseFloat(slider.slider(\"option\", \"max\"));\n\n            var input_size = max <= 1 ? 4 : max <= 1000000 ? max.toString().length : 6;\n\n            var multi_value = false;\n            var slider_row = $(this).parents(\".slider-row\");\n\n            // Row now has input.\n            slider_row.addClass(\"input\");\n\n            // Increase input size if there are two values.\n            if (slider.slider(\"option\", \"values\")) {\n                input_size = 2 * input_size + 1;\n                multi_value = true;\n            }\n            span.text(\"\");\n            // Temporary input for changing value.\n            $(\"<input type='text'/>\")\n                .attr(\"size\", input_size)\n                .attr(\"maxlength\", input_size)\n                .attr(\"value\", cur_value)\n                .appendTo(span)\n                .focus()\n                .select()\n                .click(e => {\n                    // Don't want click to propogate up to values_span and restart everything.\n                    e.stopPropagation();\n                })\n                .blur(function() {\n                    $(this).remove();\n                    span.text(cur_value);\n                    slider_row.removeClass(\"input\");\n                })\n                .keyup(function(e) {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        $(this).trigger(\"blur\");\n                    } else if (e.keyCode === 13) {\n                        //\n                        // Enter/return key initiates callback. If new value(s) are in slider range,\n                        // change value (which calls slider's change() function).\n                        //\n                        var slider_min = slider.slider(\"option\", \"min\");\n\n                        var slider_max = slider.slider(\"option\", \"max\");\n\n                        var invalid = a_val => isNaN(a_val) || a_val > slider_max || a_val < slider_min;\n\n                        var new_value = $(this).val();\n                        if (!multi_value) {\n                            new_value = parseFloat(new_value);\n                            if (invalid(new_value)) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        } else {\n                            // Multi value.\n                            new_value = new_value.split(\"-\");\n                            new_value = [parseFloat(new_value[0]), parseFloat(new_value[1])];\n                            if (invalid(new_value[0]) || invalid(new_value[1])) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        }\n\n                        // Updating the slider also updates slider values and removes input.\n                        slider.slider(multi_value ? \"values\" : \"value\", new_value);\n                        slider_row.removeClass(\"input\");\n                    }\n                });\n        });\n    };\n\n    var filter = this;\n\n    filter.parent_div = $(\"<div/>\").addClass(\"filter-row slider-row\");\n\n    // Set up filter label (name, values).\n    var filter_label = $(\"<div/>\")\n        .addClass(\"elt-label\")\n        .appendTo(filter.parent_div);\n\n    $(\"<span/>\")\n        .addClass(\"slider-name\")\n        .text(`${filter.name}  `)\n        .appendTo(filter_label);\n\n    var values_span = $(\"<span/>\").text(`${this.low}-${this.high}`);\n\n    var values_span_container = $(\"<span/>\")\n        .addClass(\"slider-value\")\n        .appendTo(filter_label)\n        .append(\"[\")\n        .append(values_span)\n        .append(\"]\");\n\n    filter.values_span = values_span;\n\n    // Set up slider for filter.\n    var slider_div = $(\"<div/>\")\n        .addClass(\"slider\")\n        .appendTo(filter.parent_div);\n    filter.control_element = $(\"<div/>\")\n        .attr(\"id\", `${filter.name}-filter-control`)\n        .appendTo(slider_div);\n    filter.control_element.slider({\n        range: true,\n        min: this.min,\n        max: this.max,\n        step: this.get_slider_step(this.min, this.max),\n        values: [this.low, this.high],\n        slide: function(event, ui) {\n            filter.slide(event, ui);\n        },\n        change: function(event, ui) {\n            filter.control_element.slider(\"option\", \"slide\").call(filter.control_element, event, ui);\n        }\n    });\n    filter.slider = filter.control_element;\n    filter.slider_label = values_span;\n\n    // Enable users to edit slider values via text box.\n    edit_slider_values(values_span_container, values_span, filter.control_element);\n\n    // Set up filter display controls.\n    var display_controls_div = $(\"<div/>\")\n        .addClass(\"display-controls\")\n        .appendTo(filter.parent_div);\n    this.transparency_icon = create_action_icon(\"Use filter for data transparency\", \"layer-transparent\", () => {\n        if (filter.manager.alpha_filter !== filter) {\n            // Setting this filter as the alpha filter.\n            filter.manager.alpha_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".layer-transparent\")\n                .removeClass(\"active\")\n                .hide();\n            filter.transparency_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.alpha_filter = null;\n            filter.transparency_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    this.height_icon = create_action_icon(\"Use filter for data height\", \"arrow-resize-090\", () => {\n        if (filter.manager.height_filter !== filter) {\n            // Setting this filter as the height filter.\n            filter.manager.height_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".arrow-resize-090\")\n                .removeClass(\"active\")\n                .hide();\n            filter.height_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.height_filter = null;\n            filter.height_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    filter.parent_div.hover(\n        () => {\n            filter.transparency_icon.show();\n            filter.height_icon.show();\n        },\n        () => {\n            if (filter.manager.alpha_filter !== filter) {\n                filter.transparency_icon.hide();\n            }\n            if (filter.manager.height_filter !== filter) {\n                filter.height_icon.hide();\n            }\n        }\n    );\n\n    // Add to clear floating layout.\n    $(\"<div style='clear: both;'/>\").appendTo(filter.parent_div);\n};\n\n_.extend(NumberFilter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        var obj_dict = Filter.prototype.to_dict.call(this);\n        return _.extend(obj_dict, {\n            type: \"number\",\n            min: this.min,\n            max: this.max,\n            low: this.low,\n            high: this.high\n        });\n    },\n    /**\n     * Return a copy of filter.\n     */\n    copy: function() {\n        return new NumberFilter({\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        });\n    },\n    /**\n     * Get step for slider.\n     */\n    // FIXME: make this a \"static\" function.\n    get_slider_step: function(min, max) {\n        var range = max - min;\n        return range <= 2 ? 0.01 : 1;\n    },\n    /**\n     * Handle slide events.\n     */\n    slide: function(event, ui) {\n        var values = ui.values;\n\n        // Set new values in UI.\n        this.values_span.text(`${values[0]}-${values[1]}`);\n\n        // Set new values in filter.\n        this.low = values[0];\n        this.high = values[1];\n\n        // Set timeout to update if filter low, high are stable.\n        var self = this;\n        setTimeout(() => {\n            if (values[0] === self.low && values[1] === self.high) {\n                self.manager.track.request_draw({\n                    force: true,\n                    clear_after: true\n                });\n            }\n        }, 25);\n    },\n    /**\n     * Returns true if filter can be applied to element.\n     */\n    applies_to: function(element) {\n        if (element.length > this.index) {\n            return true;\n        }\n        return false;\n    },\n    /**\n     * Helper function: returns true if value in in filter's [low, high] range.\n     */\n    _keep_val: function(val) {\n        return isNaN(val) || (val >= this.low && val <= this.high);\n    },\n    /**\n     * Returns true if (a) element's value(s) is in [low, high] (range is inclusive)\n     * or (b) if value is non-numeric and hence unfilterable.\n     */\n    keep: function(element) {\n        if (!this.applies_to(element)) {\n            // No element to filter on.\n            return true;\n        }\n\n        // Do filtering.\n        var to_filter = element[this.index];\n        if (to_filter instanceof Array) {\n            var returnVal = true;\n            for (var i = 0; i < to_filter.length; i++) {\n                if (!this._keep_val(to_filter[i])) {\n                    // Exclude element.\n                    returnVal = false;\n                    break;\n                }\n            }\n            return returnVal;\n        } else {\n            return this._keep_val(element[this.index]);\n        }\n    },\n    /**\n     * Update filter's min and max values based on element's values.\n     */\n    update_attrs: function(element) {\n        var updated = false;\n        if (!this.applies_to(element)) {\n            return updated;\n        }\n\n        //\n        // Update filter's min, max based on element values.\n        //\n\n        // Make value(s) into an Array.\n        var values = element[this.index];\n        if (!(values instanceof Array)) {\n            values = [values];\n        }\n\n        // Loop through values and update min, max.\n        for (var i = 0; i < values.length; i++) {\n            var value = values[i];\n            if (value < this.min) {\n                this.min = Math.floor(value);\n                updated = true;\n            }\n            if (value > this.max) {\n                this.max = Math.ceil(value);\n                updated = true;\n            }\n        }\n        return updated;\n    },\n    /**\n     * Update filter's slider.\n     */\n    update_ui_elt: function() {\n        // Only show filter if min < max because filter is not useful otherwise. This\n        // covers all corner cases, such as when min, max have not been defined and\n        // when min == max.\n        if (this.min < this.max) {\n            this.parent_div.show();\n        } else {\n            this.parent_div.hide();\n        }\n\n        var slider_min = this.slider.slider(\"option\", \"min\");\n        var slider_max = this.slider.slider(\"option\", \"max\");\n        if (this.min < slider_min || this.max > slider_max) {\n            // Update slider min, max, step.\n            this.slider.slider(\"option\", \"min\", this.min);\n            this.slider.slider(\"option\", \"max\", this.max);\n            this.slider.slider(\"option\", \"step\", this.get_slider_step(this.min, this.max));\n            // Refresh slider:\n            // TODO: do we want to keep current values or reset to min/max?\n            // Currently we reset values:\n            this.slider.slider(\"option\", \"values\", [this.min, this.max]);\n            // To use the current values.\n            //var values = this.slider.slider( \"option\", \"values\" );\n            //this.slider.slider( \"option\", \"values\", values );\n        }\n    }\n});\n\n/**\n * Manages a set of filters.\n */\nvar FiltersManager = function(track, obj_dict) {\n    this.track = track;\n    this.alpha_filter = null;\n    this.height_filter = null;\n    this.filters = [];\n\n    //\n    // Create HTML.\n    //\n\n    //\n    // Create parent div.\n    //\n    this.parent_div = $(\"<div/>\")\n        .addClass(\"filters\")\n        .hide();\n    // Disable dragging, double clicking, keys on div so that actions on slider do not impact viz.\n    this.parent_div\n        .bind(\"drag\", e => {\n            e.stopPropagation();\n        })\n        .click(e => {\n            e.stopPropagation();\n        })\n        .bind(\"dblclick\", e => {\n            e.stopPropagation();\n        })\n        .bind(\"keydown\", e => {\n            e.stopPropagation();\n        });\n\n    //\n    // Restore state from dict.\n    //\n    if (obj_dict && \"filters\" in obj_dict) {\n        // Second condition needed for backward compatibility.\n        var alpha_filter_name = \"alpha_filter\" in obj_dict ? obj_dict.alpha_filter : null;\n\n        var height_filter_name = \"height_filter\" in obj_dict ? obj_dict.height_filter : null;\n\n        var filters_dict = obj_dict.filters;\n        var filter;\n        for (var i = 0; i < filters_dict.length; i++) {\n            if (filters_dict[i].type === \"number\") {\n                filter = new NumberFilter(filters_dict[i]);\n                this.add_filter(filter);\n                if (filter.name === alpha_filter_name) {\n                    this.alpha_filter = filter;\n                    filter.transparency_icon.addClass(\"active\").show();\n                }\n                if (filter.name === height_filter_name) {\n                    this.height_filter = filter;\n                    filter.height_icon.addClass(\"active\").show();\n                }\n            } else {\n                console.log(\"ERROR: unsupported filter: \", filters_dict[i]);\n            }\n        }\n\n        if (\"visible\" in obj_dict && obj_dict.visible) {\n            this.parent_div.show();\n        }\n    }\n\n    // Add button to filter complete dataset.\n    if (this.filters.length !== 0) {\n        var run_buttons_row = $(\"<div/>\")\n            .addClass(\"param-row\")\n            .appendTo(this.parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'/>\")\n            .attr(\"value\", \"Run on complete dataset\")\n            .appendTo(run_buttons_row);\n        var filter_manager = this;\n        run_on_dataset_button.click(() => {\n            filter_manager.run_on_dataset();\n        });\n    }\n};\n\n_.extend(FiltersManager.prototype, {\n    // HTML manipulation and inspection.\n    show: function() {\n        this.parent_div.show();\n    },\n    hide: function() {\n        this.parent_div.hide();\n    },\n    toggle: function() {\n        this.parent_div.toggle();\n    },\n    visible: function() {\n        return this.parent_div.is(\":visible\");\n    },\n    /**\n     * Returns dictionary for manager.\n     */\n    to_dict: function() {\n        var obj_dict = {};\n        var filter_dicts = [];\n        var filter;\n\n        // Include individual filter states.\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            filter_dicts.push(filter.to_dict());\n        }\n        obj_dict.filters = filter_dicts;\n\n        // Include transparency, height filters.\n        obj_dict.alpha_filter = this.alpha_filter ? this.alpha_filter.name : null;\n        obj_dict.height_filter = this.height_filter ? this.height_filter.name : null;\n\n        // Include visibility.\n        obj_dict.visible = this.parent_div.is(\":visible\");\n\n        return obj_dict;\n    },\n    /**\n     * Return a copy of the manager.\n     */\n    copy: function(new_track) {\n        var copy = new FiltersManager(new_track);\n        for (var i = 0; i < this.filters.length; i++) {\n            copy.add_filter(this.filters[i].copy());\n        }\n        return copy;\n    },\n    /**\n     * Add a filter to the manager.\n     */\n    add_filter: function(filter) {\n        filter.manager = this;\n        this.parent_div.append(filter.parent_div);\n        this.filters.push(filter);\n    },\n    /**\n     * Remove all filters from manager.\n     */\n    remove_all: function() {\n        this.filters = [];\n        this.parent_div.children().remove();\n    },\n    /**\n     * Initialize filters.\n     */\n\n    init_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.update_ui_elt();\n        }\n    },\n    /**\n     * Clear filters so that they do not impact track display.\n     */\n    clear_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.slider.slider(\"option\", \"values\", [filter.min, filter.max]);\n        }\n        this.alpha_filter = null;\n        this.height_filter = null;\n\n        // Hide icons for setting filters.\n        this.parent_div.find(\".icon-button\").hide();\n    },\n    run_on_dataset: function() {\n        // Get or create dictionary item.\n        var get_or_create_dict_item = (dict, key, new_item) => {\n            // Add new item to dict if\n            if (!(key in dict)) {\n                dict[key] = new_item;\n            }\n            return dict[key];\n        };\n\n        //\n        // Find and group active filters. Active filters are those being used to hide data.\n        // Filters with the same tool id are grouped.\n        //\n        var active_filters = {};\n\n        var filter;\n        var tool_filter_conditions;\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            if (filter.tool_id) {\n                // Add filtering conditions if filter low/high are set.\n                if (filter.min !== filter.low) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} >= ${filter.low}`;\n                }\n                if (filter.max !== filter.high) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} <= ${filter.high}`;\n                }\n            }\n        }\n\n        //\n        // Use tools to run filters.\n        //\n\n        // Create list of (tool_id, tool_filters) tuples.\n        var active_filters_list = [];\n        for (var tool_id in active_filters) {\n            active_filters_list[active_filters_list.length] = [tool_id, active_filters[tool_id]];\n        }\n\n        // Invoke recursive function to run filters; this enables chaining of filters via\n        // iteratively application.\n        (function run_filter(input_dataset_id, filters) {\n            var // Set up filtering info and params.\n                filter_tuple = filters[0];\n\n            var tool_id = filter_tuple[0];\n            var tool_filters = filter_tuple[1];\n            var tool_filter_str = `(${tool_filters.join(\") and (\")})`;\n\n            var url_params = {\n                cond: tool_filter_str,\n                input: input_dataset_id,\n                target_dataset_id: input_dataset_id,\n                tool_id: tool_id\n            };\n\n            // Remove current filter.\n            filters = filters.slice(1);\n\n            // DBTODO: This will never work, run_tool_url doesn't exist?\n            // https://github.com/galaxyproject/galaxy/issues/7224\n            // eslint-disable-next-line no-undef\n            $.getJSON(run_tool_url, url_params, response => {\n                let Galaxy = getGalaxyInstance();\n                if (response.error) {\n                    // General error.\n                    Galaxy.modal.show({\n                        title: _l(\"Filter Dataset\"),\n                        body: `Error running tool ${tool_id}`,\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else if (filters.length === 0) {\n                    // No more filters to run.\n                    Galaxy.modal.show({\n                        title: _l(\"Filtering Dataset\"),\n                        body: \"Filter(s) are running on the complete dataset. Outputs are in dataset's history.\",\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else {\n                    // More filters to run.\n                    run_filter(response.dataset_id, filters);\n                }\n            });\n        })(this.track.dataset_id, active_filters_list);\n    }\n});\n\nexport default {\n    FiltersManager: FiltersManager,\n    NumberFilter: NumberFilter\n};\n","import $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport visualization from \"viz/visualization\";\nimport * as bigwig from \"libs/bbi/bigwig\";\n\n/**\n * Data manager for BBI datasets/files, including BigWig and BigBed.\n */\nvar BBIDataManager = visualization.GenomeDataManager.extend({\n    /**\n     * Load data from server and manage data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function(region, mode, resolution, extra_params) {\n        var deferred = $.Deferred();\n        this.set_data(region, deferred);\n\n        var url = `${getAppRoot()}datasets/${this.get(\"dataset\").id}/display`;\n\n        var self = this;\n        $.when(bigwig.makeBwg(url)).then((bb, err) => {\n            $.when(bb.readWigData(region.get(\"chrom\"), region.get(\"start\"), region.get(\"end\"))).then(data => {\n                // Transform data into \"bigwig\" format for LinePainter. \"bigwig\" format is an array of 2-element arrays\n                // where each element is [position, score]; unlike real bigwig format, no gaps are allowed.\n                var result = [];\n\n                var prev = { max: Number.MIN_VALUE };\n                data.forEach(d => {\n                    // If there is a gap between prev and d, fill it with an interval with score 0.\n                    // This is necessary for LinePainter to draw correctly.\n                    if (prev.max !== d.min - 1) {\n                        // +1 to start after previous region.\n                        result.push([prev.max + 1, 0]);\n                        // -2 = -1 for converting from 1-based to 0-based coordinates,\n                        //      -1 for ending before current region.\n                        result.push([d.min - 2, 0]);\n                    }\n\n                    // Add data point for entry start. -1 to convert from wiggle\n                    // 1-based coordinates to 0-based browser coordinates.\n                    result.push([d.min - 1, d.score]);\n\n                    // Add data point for entry end:\n                    result.push([d.max, d.score]);\n\n                    prev = d;\n                });\n\n                var entry = {\n                    data: result,\n                    region: region,\n                    dataset_type: \"bigwig\"\n                };\n\n                self.set_data(region, entry);\n                deferred.resolve(entry);\n            });\n        });\n\n        return deferred;\n    }\n});\n\nexport default {\n    BBIDataManager: BBIDataManager\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport visualization from \"viz/visualization\";\nimport viz_views from \"viz/viz_views\";\nimport util from \"viz/trackster/util\";\nimport slotting from \"viz/trackster/slotting\";\nimport painters from \"viz/trackster/painters\";\nimport filters_mod from \"viz/trackster/filters\";\nimport { Dataset } from \"mvc/dataset/data\";\nimport tools_mod from \"mvc/tool/tools\";\nimport config_mod from \"utils/config\";\nimport bbi from \"viz/bbi-data-manager\";\nimport \"ui/editable-text\";\n\nvar extend = _.extend;\n\n// ---- Web UI specific utilities ----\n\n/**\n * Dictionary of HTML element-JavaScript object relationships.\n */\n// TODO: probably should separate moveable objects from containers.\nvar html_elt_js_obj_dict = {};\n\n/**\n * Designates an HTML as a container.\n */\nfunction is_container(element, obj) {\n    html_elt_js_obj_dict[element.attr(\"id\")] = obj;\n}\n\n/**\n * Make `element` moveable within parent and sibling elements by dragging `handle` (a selector).\n * Function manages JS objects, containers as well.\n *\n * @param element HTML element to make moveable\n * @param handle_class classname that denotes HTML element to be used as handle\n * @param container_selector selector used to identify possible containers for this element\n * @param element_js_obj JavaScript object associated with element; used\n */\nfunction moveable(element, handle_class, container_selector, element_js_obj) {\n    // HACK: set default value for container selector.\n    container_selector = \".group\";\n\n    // Register element with its object.\n    html_elt_js_obj_dict[element.attr(\"id\")] = element_js_obj;\n\n    // Need to provide selector for handle, not class.\n    element\n        .bind(\"drag\", { handle: `.${handle_class}`, relative: true }, function(e, d) {\n            var element = $(this);\n            var parent = element.parent();\n            // Only sorting amongst tracks and groups.\n            var children = parent.children(\".track,.group\");\n            var this_obj = html_elt_js_obj_dict[$(this).attr(\"id\")];\n            var child;\n            var container;\n            var top;\n            var bottom;\n            var i;\n\n            //\n            // Enable three types of dragging: (a) out of container; (b) into container;\n            // (c) sibling movement, aka sorting. Handle in this order for simplicity.\n            //\n\n            // Handle dragging out of container.\n            container = $(this).parents(container_selector);\n            if (container.length !== 0) {\n                top = container.position().top;\n                bottom = top + container.outerHeight();\n                var cur_container = html_elt_js_obj_dict[container.attr(\"id\")];\n                if (d.offsetY < top) {\n                    // Moving above container.\n                    $(this).insertBefore(container);\n                    cur_container.remove_drawable(this_obj);\n                    cur_container.container.add_drawable_before(this_obj, cur_container);\n                    return;\n                } else if (d.offsetY > bottom) {\n                    // Moving below container.\n                    $(this).insertAfter(container);\n                    cur_container.remove_drawable(this_obj);\n                    cur_container.container.add_drawable(this_obj);\n                    return;\n                }\n            }\n\n            // Handle dragging into container. Child is appended to container's content_div.\n            container = null;\n            for (i = 0; i < children.length; i++) {\n                child = $(children.get(i));\n                top = child.position().top;\n                bottom = top + child.outerHeight();\n                // Dragging into container if child is a container and offset is inside container.\n                if (child.is(container_selector) && this !== child.get(0) && d.offsetY >= top && d.offsetY <= bottom) {\n                    // Append/prepend based on where offsetY is closest to and return.\n                    if (d.offsetY - top < bottom - d.offsetY) {\n                        child.find(\".content-div\").prepend(this);\n                    } else {\n                        child.find(\".content-div\").append(this);\n                    }\n                    // Update containers. Object may not have container if it is being moved quickly.\n                    if (this_obj.container) {\n                        this_obj.container.remove_drawable(this_obj);\n                    }\n                    html_elt_js_obj_dict[child.attr(\"id\")].add_drawable(this_obj);\n                    return;\n                }\n            }\n\n            // Handle sibling movement, aka sorting.\n\n            // Determine new position\n            for (i = 0; i < children.length; i++) {\n                child = $(children.get(i));\n                if (\n                    d.offsetY < child.position().top &&\n                    // Cannot move tracks above reference track or intro div.\n                    !(child.hasClass(\"reference-track\") || child.hasClass(\"intro\"))\n                ) {\n                    break;\n                }\n            }\n\n            // If not already in the right place, move. Need\n            // to handle the end specially since we don't have\n            // insert at index\n            if (i === children.length) {\n                if (this !== children.get(i - 1)) {\n                    parent.append(this);\n                    html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, i);\n                }\n            } else if (this !== children.get(i)) {\n                $(this).insertBefore(children.get(i));\n                // Need to adjust insert position if moving down because move is changing\n                // indices of all list items.\n                html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, d.deltaY > 0 ? i - 1 : i);\n            }\n        })\n        .bind(\"dragstart\", function() {\n            $(this).addClass(\"dragging\");\n        })\n        .bind(\"dragend\", function() {\n            $(this).removeClass(\"dragging\");\n        });\n}\n\n/**\n * Init constants & functions used throughout trackster.\n */\n\n// Padding at the top of tracks for error messages\nconst ERROR_PADDING = 20;\n\n// Maximum number of rows un a slotted track\nconst MAX_FEATURE_DEPTH = 100;\n\n// Minimum width for window for squish to be used.\nconst MIN_SQUISH_VIEW_WIDTH = 12000;\n\n// Number of pixels per tile, not including left offset.\nconst TILE_SIZE = 400;\n\nconst DEFAULT_DATA_QUERY_WAIT = 5000;\n\n// Maximum number of chromosomes that are selectable at any one time.\nconst MAX_CHROMS_SELECTABLE = 100;\n\nconst DATA_ERROR = \"Cannot display dataset due to an error. \";\n\nconst DATA_NOCONVERTER = \"A converter for this dataset is not installed. Please check your datatypes_conf.xml file.\";\n\nconst DATA_NONE = \"No data for this chrom/contig.\";\n\nconst DATA_PENDING =\n    \"Preparing data. This can take a while for a large dataset. \" +\n    \"If the visualization is saved and closed, preparation will continue in the background.\";\n\nconst DATA_CANNOT_RUN_TOOL = \"Tool cannot be rerun: \";\n//var DATA_LOADING = \"Loading data...\";\nconst DATA_OK = \"Ready for display\";\nconst TILE_CACHE_SIZE = 10;\n//var DATA_CACHE_SIZE = 20;\n//\n// Numerical/continuous data display modes.\nconst CONTINUOUS_DATA_MODES = [\"Histogram\", \"Line\", \"Filled\", \"Intensity\"];\n\n/**\n * Round a number to a given number of decimal places.\n */\nfunction round(num, places) {\n    // Default rounding is to integer.\n    if (!places) {\n        places = 0;\n    }\n\n    var val = Math.pow(10, places);\n    return Math.round(num * val) / val;\n}\n\n/**\n * Check if a server can do byte range requests.\n */\nfunction supportsByteRanges(url) {\n    var promise = $.Deferred();\n    $.ajax({\n        type: \"HEAD\",\n        url: url,\n        beforeSend: function(xhr) {\n            xhr.setRequestHeader(\"Range\", \"bytes=0-10\");\n        },\n        success: function(result, status, xhr) {\n            promise.resolve(xhr.status === 206);\n        }\n    });\n\n    return promise;\n}\n\n/**\n * Drawables hierarchy:\n *\n * Drawable\n *    --> DrawableCollection\n *        --> DrawableGroup\n *        --> View\n *    --> Track\n */\n\n/**\n * Base class for all drawable objects. Drawable objects are associated with a view and live in a\n * container. They have the following HTML elements and structure:\n *  <container_div>\n *      <header_div>\n *      <content_div>\n *\n * They optionally have a drag handle class.\n */\nvar Drawable = function(view, container, obj_dict) {\n    if (!Drawable.id_counter) {\n        Drawable.id_counter = 0;\n    }\n    this.id = Drawable.id_counter++;\n    this.view = view;\n    this.container = container;\n    this.drag_handle_class = obj_dict.drag_handle_class;\n    this.is_overview = false;\n    this.action_icons = {};\n\n    // -- Set up drawable configuration. --\n    this.config = config_mod.ConfigSettingCollection.from_models_and_saved_values(\n        this.build_config_params(),\n        obj_dict.prefs\n    );\n\n    // If there's no saved name, use object name.\n    if (!this.config.get_value(\"name\")) {\n        this.config.set_value(\"name\", obj_dict.name);\n    }\n    if (this.config_onchange) {\n        this.config.on(\"change\", this.config_onchange, this);\n    }\n\n    // Build Drawable HTML and behaviors.\n    this.container_div = this.build_container_div();\n    this.header_div = null;\n\n    // Use opt-out policy on header creation because this is the more frequent approach:\n    // unless flag set, create header.\n    if (obj_dict.header !== false) {\n        var header_view = new viz_views.TrackHeaderView({\n            model: this,\n            id: this.id\n        });\n\n        this.header_div = header_view.$el;\n        this.container_div.append(this.header_div);\n\n        // Show icons when users is hovering over track.\n        var icons_div = header_view.icons_div;\n        this.action_icons = header_view.action_icons;\n        this.container_div.hover(\n            () => {\n                icons_div.show();\n            },\n            () => {\n                icons_div.hide();\n            }\n        );\n    }\n};\n\nDrawable.prototype.action_icons_def = [\n    // Hide/show drawable content.\n    // FIXME: make this an odict for easier lookup.\n    {\n        name: \"toggle_icon\",\n        title: \"Hide/show content\",\n        css_class: \"toggle\",\n        on_click_fn: function(drawable) {\n            if (drawable.config.get_value(\"content_visible\")) {\n                drawable.action_icons.toggle_icon.addClass(\"toggle-expand\").removeClass(\"toggle\");\n                drawable.hide_contents();\n                drawable.config.set_value(\"content_visible\", false);\n            } else {\n                drawable.action_icons.toggle_icon.addClass(\"toggle\").removeClass(\"toggle-expand\");\n                drawable.config.set_value(\"content_visible\", true);\n                drawable.show_contents();\n            }\n        }\n    },\n    // Edit settings.\n    {\n        name: \"settings_icon\",\n        title: _l(\"Edit settings\"),\n        css_class: \"gear\",\n        on_click_fn: function(drawable) {\n            var view = new config_mod.ConfigSettingCollectionView({\n                collection: drawable.config\n            });\n            view.render_in_modal(\"Configure Track\");\n        }\n    },\n    // Remove.\n    {\n        name: \"remove_icon\",\n        title: _l(\"Remove\"),\n        css_class: \"remove-icon\",\n        on_click_fn: function(drawable) {\n            // Tooltip for remove icon must be deleted when drawable is deleted.\n            $(\".tooltip\").remove();\n            drawable.remove();\n        }\n    }\n];\n\nextend(Drawable.prototype, {\n    config_params: [\n        { key: \"name\", label: \"Name\", type: \"text\", default_value: \"\" },\n        {\n            key: \"content_visible\",\n            type: \"bool\",\n            default_value: true,\n            hidden: true\n        }\n    ],\n\n    build_config_params: function() {\n        return this.config_params;\n    },\n\n    config_onchange: function() {},\n\n    init: function() {},\n\n    changed: function() {\n        this.view.changed();\n    },\n\n    can_draw: function() {\n        if (this.enabled && this.config.get_value(\"content_visible\")) {\n            return true;\n        }\n\n        return false;\n    },\n\n    request_draw: function() {},\n\n    _draw: function(options) {},\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {},\n\n    /**\n     * Set drawable name.\n     */\n    set_name: function(new_name) {\n        this.old_name = this.config.get_value(\"name\");\n        this.config.set_value(\"name\", new_name);\n    },\n\n    /**\n     * Revert track name; currently name can be reverted only once.\n     */\n    revert_name: function() {\n        if (this.old_name) {\n            this.config.set_value(\"name\", this.old_name);\n        }\n    },\n\n    /**\n     * Remove drawable (a) from its container and (b) from the HTML.\n     */\n    remove: function() {\n        this.changed();\n\n        this.container.remove_drawable(this);\n        var view = this.view;\n        this.container_div.hide(0, function() {\n            $(this).remove();\n            // HACK: is there a better way to update the view?\n            view.update_intro_div();\n        });\n    },\n\n    /**\n     * Build drawable's container div; this is the parent div for all drawable's elements.\n     */\n    build_container_div: function() {},\n\n    /**\n     * Update icons.\n     */\n    update_icons: function() {},\n\n    /**\n     * Hide drawable's contents.\n     */\n    hide_contents: function() {},\n\n    /**\n     * Show drawable's contents.\n     */\n    show_contents: function() {},\n\n    /**\n     * Returns a shallow copy of all drawables in this drawable.\n     */\n    get_drawables: function() {}\n});\n\n/**\n * A collection of drawable objects.\n */\nvar DrawableCollection = function(view, container, obj_dict) {\n    Drawable.call(this, view, container, obj_dict);\n\n    // Attribute init.\n    this.obj_type = obj_dict.obj_type;\n    this.drawables = [];\n};\n\nextend(DrawableCollection.prototype, Drawable.prototype, {\n    /**\n     * Unpack and add drawables to the collection.\n     */\n    unpack_drawables: function(drawables_array) {\n        // Add drawables to collection.\n        this.drawables = [];\n        var drawable;\n        for (var i = 0; i < drawables_array.length; i++) {\n            drawable = object_from_template(drawables_array[i], this.view, this);\n            this.add_drawable(drawable);\n        }\n    },\n\n    /**\n     * Init each drawable in the collection.\n     */\n    init: function() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].init();\n        }\n    },\n\n    /**\n     * Draw each drawable in the collection.\n     */\n    _draw: function(options) {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i]._draw(options);\n        }\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {\n        var dictified_drawables = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            dictified_drawables.push(this.drawables[i].to_dict());\n        }\n        return {\n            prefs: this.config.to_key_value_dict(),\n            obj_type: this.obj_type,\n            drawables: dictified_drawables\n        };\n    },\n\n    /**\n     * Add a drawable to the end of the collection.\n     */\n    add_drawable: function(drawable) {\n        this.drawables.push(drawable);\n        drawable.container = this;\n        this.changed();\n    },\n\n    /**\n     * Add a drawable before another drawable.\n     */\n    add_drawable_before: function(drawable, other) {\n        this.changed();\n        var index = this.drawables.indexOf(other);\n        if (index !== -1) {\n            this.drawables.splice(index, 0, drawable);\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Replace one drawable with another.\n     */\n    replace_drawable: function(old_drawable, new_drawable, update_html) {\n        var index = this.drawables.indexOf(old_drawable);\n        if (index !== -1) {\n            this.drawables[index] = new_drawable;\n            if (update_html) {\n                old_drawable.container_div.replaceWith(new_drawable.container_div);\n            }\n            this.changed();\n        }\n        return index;\n    },\n\n    /**\n     * Remove drawable from this collection.\n     */\n    remove_drawable: function(drawable) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Found drawable to remove.\n            this.drawables.splice(index, 1);\n            drawable.container = null;\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Move drawable to another location in collection.\n     */\n    move_drawable: function(drawable, new_position) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Remove from current position:\n            this.drawables.splice(index, 1);\n            // insert into new position:\n            this.drawables.splice(new_position, 0, drawable);\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function() {\n        return this.drawables;\n    },\n\n    /**\n     * Returns all <track_type> tracks in collection.\n     */\n    get_tracks: function(track_type) {\n        // Initialize queue with copy of drawables array.\n        var queue = this.drawables.slice(0);\n\n        var tracks = [];\n        var drawable;\n        while (queue.length !== 0) {\n            drawable = queue.shift();\n            if (drawable instanceof track_type) {\n                tracks.push(drawable);\n            } else if (drawable.drawables) {\n                queue = queue.concat(drawable.drawables);\n            }\n        }\n        return tracks;\n    }\n});\n\n/**\n * A group of drawables that are moveable, visible.\n */\nvar DrawableGroup = function(view, container, obj_dict) {\n    extend(obj_dict, {\n        obj_type: \"DrawableGroup\",\n        drag_handle_class: \"group-handle\"\n    });\n    DrawableCollection.call(this, view, container, obj_dict);\n\n    // Set up containers/moving for group: register both container_div and content div as container\n    // because both are used as containers (container div to recognize container, content_div to\n    // store elements). Group can be moved.\n    this.content_div = $(\"<div/>\")\n        .addClass(\"content-div\")\n        .attr(\"id\", `group_${this.id}_content_div`)\n        .appendTo(this.container_div);\n    is_container(this.container_div, this);\n    is_container(this.content_div, this);\n    moveable(this.container_div, this.drag_handle_class, \".group\", this);\n\n    // Set up filters.\n    this.filters_manager = new filters_mod.FiltersManager(this);\n    this.header_div.after(this.filters_manager.parent_div);\n\n    // HACK: add div to clear floating elements.\n    this.filters_manager.parent_div.after($(\"<div style='clear: both'/>\"));\n\n    // For saving drawables' filter managers when group-level filtering is done:\n    this.saved_filters_managers = [];\n\n    // Add drawables.\n    if (\"drawables\" in obj_dict) {\n        this.unpack_drawables(obj_dict.drawables);\n    }\n\n    // Restore filters.\n    if (\"filters\" in obj_dict) {\n        // FIXME: Pass collection_dict to DrawableCollection/Drawable will make this easier.\n        var old_manager = this.filters_manager;\n        this.filters_manager = new filters_mod.FiltersManager(this, obj_dict.filters);\n        old_manager.parent_div.replaceWith(this.filters_manager.parent_div);\n\n        if (obj_dict.filters.visible) {\n            this.setup_multitrack_filtering();\n        }\n    }\n};\n\nextend(DrawableGroup.prototype, Drawable.prototype, DrawableCollection.prototype, {\n    action_icons_def: [\n        Drawable.prototype.action_icons_def[0],\n        Drawable.prototype.action_icons_def[1],\n        // Replace group with composite track.\n        {\n            name: \"composite_icon\",\n            title: _l(\"Show composite track\"),\n            css_class: \"layers-stack\",\n            on_click_fn: function(group) {\n                $(\".tooltip\").remove();\n                group.show_composite_track();\n            }\n        },\n        // Toggle track filters.\n        {\n            name: \"filters_icon\",\n            title: _l(\"Filters\"),\n            css_class: \"ui-slider-050\",\n            on_click_fn: function(group) {\n                // TODO: update Tooltip text.\n                if (group.filters_manager.visible()) {\n                    // Hiding filters.\n                    group.filters_manager.clear_filters();\n                    group._restore_filter_managers();\n                    // TODO: maintain current filter by restoring and setting saved manager's\n                    // settings to current/shared manager's settings.\n                    // TODO: need to restore filter managers when moving drawable outside group.\n                } else {\n                    // Showing filters.\n                    group.setup_multitrack_filtering();\n                    group.request_draw({ clear_tile_cache: true });\n                }\n                group.filters_manager.toggle();\n            }\n        },\n        Drawable.prototype.action_icons_def[2]\n    ],\n\n    build_container_div: function() {\n        var container_div = $(\"<div/>\")\n            .addClass(\"group\")\n            .attr(\"id\", `group_${this.id}`);\n        if (this.container) {\n            this.container.content_div.append(container_div);\n        }\n        return container_div;\n    },\n\n    hide_contents: function() {\n        this.tiles_div.hide();\n    },\n\n    show_contents: function() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    update_icons: function() {\n        //\n        // Handle update when there are no tracks.\n        //\n        var num_drawables = this.drawables.length;\n        if (num_drawables === 0) {\n            this.action_icons.composite_icon.hide();\n            this.action_icons.filters_icon.hide();\n        } else if (num_drawables === 1) {\n            this.action_icons.composite_icon.toggle(this.drawables[0] instanceof CompositeTrack);\n            this.action_icons.filters_icon.hide();\n        } else {\n            // There are 2 or more tracks.\n\n            //\n            // Determine if a composite track can be created. Current criteria:\n            // (a) all tracks are line tracks;\n            //      OR\n            // FIXME: this is not enabled right now because it has not been well tested:\n            // (b) there is a single FeatureTrack.\n            //\n\n            // All tracks the same?\n            var i;\n\n            var j;\n            var drawable;\n            var same_type = true;\n            var a_type = this.drawables[0].get_type();\n            var num_feature_tracks = 0;\n            for (i = 0; i < num_drawables; i++) {\n                drawable = this.drawables[i];\n                if (drawable.get_type() !== a_type) {\n                    break;\n                }\n                if (drawable instanceof FeatureTrack) {\n                    num_feature_tracks++;\n                }\n            }\n\n            if (same_type && this.drawables[0] instanceof LineTrack) {\n                this.action_icons.composite_icon.show();\n            } else {\n                this.action_icons.composite_icon.hide();\n                $(\".tooltip\").remove();\n            }\n\n            //\n            // Set up group-level filtering and update filter icon.\n            //\n            if (num_feature_tracks > 1 && num_feature_tracks === this.drawables.length) {\n                //\n                // Find shared filters.\n                //\n                var shared_filters = {};\n\n                var filter;\n\n                // Init shared filters with filters from first drawable.\n                drawable = this.drawables[0];\n                for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                    filter = drawable.filters_manager.filters[j];\n                    shared_filters[filter.name] = [filter];\n                }\n\n                // Create lists of shared filters.\n                for (i = 1; i < this.drawables.length; i++) {\n                    drawable = this.drawables[i];\n                    for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                        filter = drawable.filters_manager.filters[j];\n                        if (filter.name in shared_filters) {\n                            shared_filters[filter.name].push(filter);\n                        }\n                    }\n                }\n\n                //\n                // Create filters for shared filters manager. Shared filters manager is group's\n                // manager.\n                //\n                this.filters_manager.remove_all();\n                for (var filter_name in shared_filters) {\n                    let filters = shared_filters[filter_name];\n                    if (filters.length === num_feature_tracks) {\n                        // Add new filter.\n                        // FIXME: can filter.copy() be used?\n                        let new_filter = new filters_mod.NumberFilter({\n                            name: filters[0].name,\n                            index: filters[0].index\n                        });\n                        this.filters_manager.add_filter(new_filter);\n                    }\n                }\n\n                // Show/hide icon based on filter availability.\n                this.action_icons.filters_icon.toggle(this.filters_manager.filters.length > 0);\n            } else {\n                this.action_icons.filters_icon.hide();\n            }\n        }\n    },\n\n    /**\n     * Restore individual track filter managers.\n     */\n    _restore_filter_managers: function() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].filters_manager = this.saved_filters_managers[i];\n        }\n        this.saved_filters_managers = [];\n    },\n\n    /**\n     *\n     */\n    setup_multitrack_filtering: function() {\n        // Save tracks' managers and set up shared manager.\n        if (this.filters_manager.filters.length > 0) {\n            // For all tracks, save current filter manager and set manager to shared (this object's) manager.\n            this.saved_filters_managers = [];\n            for (var i = 0; i < this.drawables.length; i++) {\n                var drawable = this.drawables[i];\n                this.saved_filters_managers.push(drawable.filters_manager);\n                drawable.filters_manager = this.filters_manager;\n            }\n\n            //TODO: hide filters icons for each drawable?\n        }\n        this.filters_manager.init_filters();\n    },\n\n    /**\n     * Replace group with a single composite track that includes all group's tracks.\n     */\n    show_composite_track: function() {\n        var composite_track = new CompositeTrack(this.view, this.view, {\n            name: this.config.get_value(\"name\"),\n            drawables: this.drawables\n        });\n        this.container.replace_drawable(this, composite_track, true);\n        composite_track.request_draw();\n    },\n\n    add_drawable: function(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    remove_drawable: function(drawable) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    to_dict: function() {\n        // If filters are visible, need to restore original filter managers before converting to dict.\n        if (this.filters_manager.visible()) {\n            this._restore_filter_managers();\n        }\n\n        var obj_dict = extend(DrawableCollection.prototype.to_dict.call(this), {\n            filters: this.filters_manager.to_dict()\n        });\n\n        // Setup multi-track filtering again.\n        if (this.filters_manager.visible()) {\n            this.setup_multitrack_filtering();\n        }\n\n        return obj_dict;\n    },\n\n    request_draw: function(options) {\n        _.each(this.drawables, d => {\n            d.request_draw(options);\n        });\n    }\n});\n\n/**\n * View object manages a trackster visualization, including tracks and user interactions.\n * Events triggered:\n *      navigate: when browser view changes to a new locations\n */\nvar TracksterView = Backbone.View.extend({\n    initialize: function(obj_dict) {\n        extend(obj_dict, {\n            obj_type: \"View\"\n        });\n        DrawableCollection.call(this, \"View\", obj_dict.container, obj_dict);\n        this.chrom = null;\n        this.vis_id = obj_dict.vis_id;\n        this.dbkey = obj_dict.dbkey;\n        this.stand_alone = obj_dict.stand_alone !== undefined ? obj_dict.stand_alone : true;\n        this.label_tracks = [];\n        this.tracks_to_be_redrawn = [];\n        this.max_low = 0;\n        this.max_high = 0;\n        this.zoom_factor = 3;\n        this.min_separation = 30;\n        this.has_changes = false;\n        // Deferred object that indicates when view's chrom data has been loaded.\n        this.load_chroms_deferred = null;\n        this.render();\n        this.canvas_manager = new visualization.CanvasManager(this.container.get(0).ownerDocument);\n        this.reset();\n\n        // Define track configuration\n        this.config = config_mod.ConfigSettingCollection.from_models_and_saved_values(\n            [\n                {\n                    key: \"name\",\n                    label: \"Name\",\n                    type: \"text\",\n                    default_value: \"\"\n                },\n                {\n                    key: \"a_color\",\n                    label: \"A Color\",\n                    type: \"color\",\n                    default_value: \"#FF0000\"\n                },\n                {\n                    key: \"c_color\",\n                    label: \"C Color\",\n                    type: \"color\",\n                    default_value: \"#00FF00\"\n                },\n                {\n                    key: \"g_color\",\n                    label: \"G Color\",\n                    type: \"color\",\n                    default_value: \"#0000FF\"\n                },\n                {\n                    key: \"t_color\",\n                    label: \"T Color\",\n                    type: \"color\",\n                    default_value: \"#FF00FF\"\n                },\n                {\n                    key: \"n_color\",\n                    label: \"N Color\",\n                    type: \"color\",\n                    default_value: \"#AAAAAA\"\n                }\n            ],\n            { name: obj_dict.name }\n        );\n    },\n\n    render: function() {\n        // Attribute init.\n        this.requested_redraw = false;\n\n        // Create DOM elements\n        var parent_element = this.container;\n\n        var view = this;\n        // Top container for things that are fixed at the top\n        this.top_container = $(\"<div/>\")\n            .addClass(\"top-container\")\n            .appendTo(parent_element);\n        // Browser content, primary tracks are contained in here\n        this.browser_content_div = $(\"<div/>\")\n            .addClass(\"content\")\n            .appendTo(parent_element);\n        // Bottom container for things that are fixed at the bottom\n        this.bottom_container = $(\"<div/>\")\n            .addClass(\"bottom-container\")\n            .appendTo(parent_element);\n        // Label track fixed at top\n        this.top_labeltrack = $(\"<div/>\")\n            .addClass(\"top-labeltrack\")\n            .appendTo(this.top_container);\n        // Viewport for dragging tracks in center\n        this.viewport_container = $(\"<div/>\")\n            .addClass(\"viewport-container\")\n            .attr(\"id\", \"viewport-container\")\n            .appendTo(this.browser_content_div);\n        // Alias viewport_container as content_div so that it matches function of DrawableCollection/Group content_div.\n        this.content_div = this.viewport_container;\n        is_container(this.viewport_container, view);\n        // Introduction div shown when there are no tracks.\n        this.intro_div = $(\"<div/>\")\n            .addClass(\"intro\")\n            .appendTo(this.viewport_container);\n        // Add tracks button\n        $(\"<div/>\")\n            .text(\"Add Datasets to Visualization\")\n            .addClass(\"action-button\")\n            .appendTo(this.intro_div)\n            .click(() => {\n                visualization.select_datasets({ dbkey: view.dbkey }, tracks => {\n                    _.each(tracks, track => {\n                        view.add_drawable(object_from_template(track, view, view));\n                    });\n                });\n            });\n\n        // Navigation at top\n        this.nav_container = $(\"<div/>\")\n            .addClass(\"trackster-nav-container\")\n            .prependTo(this.top_container);\n        this.nav = $(\"<div/>\")\n            .addClass(\"trackster-nav\")\n            .appendTo(this.nav_container);\n\n        if (this.stand_alone) {\n            this.nav_container.addClass(\"stand-alone\");\n            this.nav.addClass(\"stand-alone\");\n        }\n\n        // Overview (scrollbar and overview plot) at bottom\n        this.overview = $(\"<div/>\")\n            .addClass(\"overview\")\n            .appendTo(this.bottom_container);\n        this.overview_viewport = $(\"<div/>\")\n            .addClass(\"overview-viewport\")\n            .appendTo(this.overview);\n        this.overview_close = $(\"<a/>\")\n            .attr(\"title\", \"Close overview\")\n            .addClass(\"icon-button overview-close tooltip\")\n            .hide()\n            .appendTo(this.overview_viewport);\n        this.overview_highlight = $(\"<div/>\")\n            .addClass(\"overview-highlight\")\n            .hide()\n            .appendTo(this.overview_viewport);\n        this.overview_box_background = $(\"<div/>\")\n            .addClass(\"overview-boxback\")\n            .appendTo(this.overview_viewport);\n        this.overview_box = $(\"<div/>\")\n            .addClass(\"overview-box\")\n            .appendTo(this.overview_viewport);\n        this.default_overview_height = this.overview_box.height();\n\n        this.nav_controls = $(\"<div/>\")\n            .addClass(\"nav-controls\")\n            .appendTo(this.nav);\n        this.chrom_select = $(\"<select/>\")\n            .attr({ name: \"chrom\" })\n            .addClass(\"chrom-nav\")\n            .append(\"<option value=''>Loading</option>\")\n            .appendTo(this.nav_controls);\n        var submit_nav = function(e) {\n            if (e.type === \"focusout\" || (e.keyCode || e.which) === 13 || (e.keyCode || e.which) === 27) {\n                if ((e.keyCode || e.which) !== 27) {\n                    // Not escape key\n                    view.go_to($(this).val());\n                }\n                $(this).hide();\n                $(this).val(\"\");\n                view.location_span.show();\n                view.chrom_select.show();\n            }\n\n            // Suppress key presses so that they do impact viz.\n            e.stopPropagation();\n        };\n        this.nav_input = $(\"<input/>\")\n            .addClass(\"nav-input\")\n            .hide()\n            .bind(\"keyup focusout\", submit_nav)\n            .appendTo(this.nav_controls);\n        this.location_span = $(\"<span/>\")\n            .addClass(\"location\")\n            .attr(\"title\", \"Click to change location\")\n            .tooltip({ placement: \"bottom\" })\n            .appendTo(this.nav_controls);\n        this.location_span.click(() => {\n            view.location_span.hide();\n            view.chrom_select.hide();\n            view.nav_input.val(`${view.chrom}:${view.low}-${view.high}`);\n            view.nav_input.css(\"display\", \"inline-block\");\n            view.nav_input.select();\n            view.nav_input.focus();\n            // Set up autocomplete for tracks' features.\n            view.nav_input.autocomplete({\n                source: function(request, response) {\n                    // Using current text, query each track and create list of all matching features.\n                    var all_features = [];\n\n                    var feature_search_deferreds = $.map(view.get_tracks(FeatureTrack), t =>\n                        t.data_manager.search_features(request.term).success(dataset_features => {\n                            all_features = all_features.concat(dataset_features);\n                        })\n                    );\n\n                    // When all searching is done, fill autocomplete.\n                    $.when.apply($, feature_search_deferreds).done(() => {\n                        response(\n                            $.map(all_features, feature => ({\n                                label: feature[0],\n                                value: feature[1]\n                            }))\n                        );\n                    });\n                },\n                minLength: 2\n            });\n        });\n        if (this.vis_id !== undefined) {\n            this.hidden_input = $(\"<input/>\")\n                .attr(\"type\", \"hidden\")\n                .val(this.vis_id)\n                .appendTo(this.nav_controls);\n        }\n\n        this.zo_link = $(\"<a/>\")\n            .attr(\"id\", \"zoom-out\")\n            .attr(\"title\", \"Zoom out\")\n            .tooltip({ placement: \"bottom\" })\n            .click(() => {\n                view.zoom_out();\n            })\n            .appendTo(this.nav_controls);\n        this.zi_link = $(\"<a/>\")\n            .attr(\"id\", \"zoom-in\")\n            .attr(\"title\", \"Zoom in\")\n            .tooltip({ placement: \"bottom\" })\n            .click(() => {\n                view.zoom_in();\n            })\n            .appendTo(this.nav_controls);\n\n        // Get initial set of chroms.\n        this.load_chroms_deferred = this.load_chroms({ low: 0 });\n        this.chrom_select.bind(\"change\", () => {\n            view.change_chrom(view.chrom_select.val());\n        });\n\n        /*\n        this.browser_content_div.bind(\"mousewheel\", function( e, delta ) {\n            if (Math.abs(delta) < 0.5) {\n                return;\n            }\n            if (delta > 0) {\n                view.zoom_in(e.pageX, this.viewport_container);\n            } else {\n                view.zoom_out();\n            }\n            e.preventDefault();\n        });\n        */\n\n        // Blur tool/filter inputs when user clicks on content div.\n        this.browser_content_div.click(function(e) {\n            $(this)\n                .find(\"input\")\n                .trigger(\"blur\");\n        });\n\n        // Double clicking zooms in\n        this.browser_content_div.bind(\"dblclick\", function(e) {\n            view.zoom_in(e.pageX, this.viewport_container);\n        });\n\n        // Dragging the overview box (~ horizontal scroll bar)\n        this.overview_box\n            .bind(\"dragstart\", function(e, d) {\n                this.current_x = d.offsetX;\n            })\n            .bind(\"drag\", function(e, d) {\n                var delta = d.offsetX - this.current_x;\n                this.current_x = d.offsetX;\n                var delta_chrom = Math.round(\n                    (delta / view.viewport_container.width()) * (view.max_high - view.max_low)\n                );\n                view.move_delta(-delta_chrom);\n            });\n\n        this.overview_close.click(() => {\n            view.reset_overview();\n        });\n\n        // Dragging in the viewport scrolls\n        this.viewport_container\n            .bind(\"draginit\", (e, d) => {\n                // Disable interaction if started in scrollbar (for webkit)\n                if (e.clientX > view.viewport_container.width() - 16) {\n                    return false;\n                }\n            })\n            .bind(\"dragstart\", (e, d) => {\n                d.original_low = view.low;\n                d.current_height = e.clientY;\n                d.current_x = d.offsetX;\n            })\n            .bind(\"drag\", function(e, d) {\n                var container = $(this);\n                var delta = d.offsetX - d.current_x;\n                var new_scroll = container.scrollTop() - (e.clientY - d.current_height);\n                container.scrollTop(new_scroll);\n                d.current_height = e.clientY;\n                d.current_x = d.offsetX;\n                var delta_chrom = Math.round((delta / view.viewport_container.width()) * (view.high - view.low));\n                view.move_delta(delta_chrom);\n            });\n        /*\n        FIXME: Do not do this for now because it's too jittery. Some kind of gravity approach is\n        needed here because moving left/right should be difficult.\n\n        // Also capture mouse wheel for left/right scrolling\n        }).bind( 'mousewheel', function( e, d, dx, dy ) {\n            // Only handle x axis scrolling; y axis scrolling is\n            // handled by the browser when the event bubbles up.\n            if (dx) {\n                var delta_chrom = Math.round( - dx / view.viewport_container.width() * (view.high - view.low) );\n                view.move_delta( delta_chrom );\n            }\n        });\n        */\n\n        // Dragging in the top label track allows selecting a region to zoom in on selected region.\n        this.top_labeltrack\n            .bind(\"dragstart\", function(e, d) {\n                return $(\"<div/>\")\n                    .addClass(\"zoom-area\")\n                    .css(\"height\", view.browser_content_div.height() + view.top_labeltrack.height() + 1)\n                    .appendTo($(this));\n            })\n            .bind(\"drag\", (e, d) => {\n                $(d.proxy).css({\n                    left: Math.min(e.pageX, d.startX) - view.container.offset().left,\n                    width: Math.abs(e.pageX - d.startX)\n                });\n\n                var min = Math.min(e.pageX, d.startX) - view.container.offset().left;\n\n                var max = Math.max(e.pageX, d.startX) - view.container.offset().left;\n\n                var span = view.high - view.low;\n                var width = view.viewport_container.width();\n                view.update_location(\n                    Math.round((min / width) * span) + view.low,\n                    Math.round((max / width) * span) + view.low\n                );\n            })\n            .bind(\"dragend\", (e, d) => {\n                var min = Math.min(e.pageX, d.startX);\n                var max = Math.max(e.pageX, d.startX);\n                var span = view.high - view.low;\n                var width = view.viewport_container.width();\n                var old_low = view.low;\n                view.low = Math.round((min / width) * span) + old_low;\n                view.high = Math.round((max / width) * span) + old_low;\n                $(d.proxy).remove();\n                view.request_redraw();\n            });\n\n        // FIXME: this is still wonky for embedded visualizations.\n        /*\n        // For vertical alignment, track mouse with simple line.\n        var mouse_tracker_div = $('<div/>').addClass('mouse-pos').appendTo(parent_element);\n\n        // Show tracker only when hovering over view.\n        parent_element.hover(\n            function() {\n                mouse_tracker_div.show();\n                parent_element.mousemove(function(e) {\n                    mouse_tracker_div.css({\n                        // -1 makes line appear next to the mouse w/o preventing mouse actions.\n                        left: e.pageX - parent_element.offset().left - 1\n                    });\n                });\n            },\n            function() {\n                parent_element.off('mousemove');\n                mouse_tracker_div.hide();\n            }\n        );\n        */\n\n        this.add_label_track(new LabelTrack(this, { content_div: this.top_labeltrack }));\n\n        $(window).bind(\"resize\", function() {\n            // Stop previous timer.\n            if (this.resize_timer) {\n                window.clearTimeout(this.resize_timer);\n            }\n\n            // When function activated, resize window and redraw.\n            this.resize_timer = window.setTimeout(() => {\n                view.resize_window();\n            }, 500);\n        });\n        $(document).bind(\"redraw\", () => {\n            view.redraw();\n        });\n\n        this.reset();\n        $(window).trigger(\"resize\");\n    },\n\n    get_base_color: function(base) {\n        return this.config.get_value(`${base.toLowerCase()}_color`) || this.config.get_value(\"n_color\");\n    }\n});\n\n// FIXME: need to use this approach to enable inheritance of DrawableCollection functions.\nextend(TracksterView.prototype, DrawableCollection.prototype, {\n    changed: function() {\n        this.has_changes = true;\n    },\n\n    /** Add or remove intro div depending on view state. */\n    update_intro_div: function() {\n        this.intro_div.toggle(this.drawables.length === 0);\n    },\n\n    /**\n     * Triggers navigate events as needed. If there is a delay,\n     * then event is triggered only after navigation has stopped.\n     */\n    trigger_navigate: function(new_chrom, new_low, new_high, delay) {\n        // Stop previous timer.\n        if (this.timer) {\n            window.clearTimeout(this.timer);\n        }\n\n        if (delay) {\n            // To aggregate calls, use timer and only navigate once\n            // location has stabilized.\n            this.timer = window.setTimeout(() => {\n                this.trigger(\"navigate\", `${new_chrom}:${new_low}-${new_high}`);\n            }, 500);\n        } else {\n            this.trigger(\"navigate\", `${new_chrom}:${new_low}-${new_high}`);\n        }\n    },\n\n    update_location: function(low, high) {\n        this.location_span.text(`${util.commatize(low)} - ${util.commatize(high)}`);\n        this.nav_input.val(`${this.chrom}:${util.commatize(low)}-${util.commatize(high)}`);\n\n        // Update location. Only update when there is a valid chrom; when loading vis, there may\n        // not be a valid chrom.\n        var chrom = this.chrom_select.val();\n        if (chrom !== \"\") {\n            this.trigger_navigate(chrom, this.low, this.high, true);\n        }\n    },\n\n    /**\n     * Load chrom data for the view. Returns a jQuery Deferred.\n     */\n    // FIXME: instead of loading chrom data, should load and store genome object.\n    load_chroms: function(url_parms) {\n        url_parms.num = MAX_CHROMS_SELECTABLE;\n\n        var chrom_data = $.Deferred();\n        $.ajax({\n            url: `${getAppRoot()}api/genomes/${this.dbkey}`,\n            data: url_parms,\n            dataType: \"json\",\n            success: result => {\n                // Do nothing if could not load chroms.\n                if (result.chrom_info.length === 0) {\n                    return;\n                }\n\n                // Load chroms.\n                if (result.reference) {\n                    var ref_track = new ReferenceTrack(this);\n                    this.add_label_track(ref_track);\n                    this.reference_track = ref_track;\n                }\n                this.chrom_data = result.chrom_info;\n\n                this.chrom_select.html(\"\");\n                this.chrom_select.append($('<option value=\"\">Select Chrom/Contig</option>'));\n\n                for (var i = 0, len = this.chrom_data.length; i < len; i++) {\n                    var chrom = this.chrom_data[i].chrom;\n                    var chrom_option = $(\"<option>\");\n                    chrom_option.text(chrom);\n                    chrom_option.val(chrom);\n                    this.chrom_select.append(chrom_option);\n                }\n                if (result.prev_chroms) {\n                    this.chrom_select.append($(`<option value=\"previous\">Previous ${MAX_CHROMS_SELECTABLE}</option>`));\n                }\n                if (result.next_chroms) {\n                    this.chrom_select.append($(`<option value=\"next\">Next ${MAX_CHROMS_SELECTABLE}</option>`));\n                }\n                this.chrom_start_index = result.start_index;\n\n                chrom_data.resolve(result.chrom_info);\n            },\n            error: function() {\n                alert(`Could not load chroms for this dbkey: ${this.dbkey}`);\n            }\n        });\n        return chrom_data;\n    },\n\n    change_chrom: function(chrom, low, high) {\n        var view = this;\n        // If chrom data is still loading, wait for it.\n        if (!view.chrom_data) {\n            view.load_chroms_deferred.then(() => {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        }\n\n        // Don't do anything if chrom is \"None\" (hackish but some browsers already have this set), or null/blank\n        if (!chrom || chrom === \"None\") {\n            return;\n        }\n\n        //\n        // If user is navigating to previous/next set of chroms, load new chrom set and return.\n        //\n        if (chrom === \"previous\") {\n            view.load_chroms({\n                low: this.chrom_start_index - MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n        if (chrom === \"next\") {\n            view.load_chroms({\n                low: this.chrom_start_index + MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n\n        //\n        // User is loading a particular chrom. Look first in current set; if not in current set, load new\n        // chrom set.\n        //\n        var found = $.grep(view.chrom_data, (v, i) => v.chrom === chrom)[0];\n        if (found === undefined) {\n            // Try to load chrom and then change to chrom.\n            view.load_chroms({ chrom: chrom }, () => {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        } else {\n            // Switching to local chrom.\n            if (chrom !== view.chrom) {\n                view.chrom = chrom;\n                view.chrom_select.val(view.chrom);\n                view.max_high = found.len - 1; // -1 because we're using 0-based indexing.\n                view.reset();\n\n                for (var i = 0, len = view.drawables.length; i < len; i++) {\n                    var drawable = view.drawables[i];\n                    if (drawable.init) {\n                        drawable.init();\n                    }\n                }\n                if (view.reference_track) {\n                    view.reference_track.init();\n                }\n            }\n\n            // Resolve low, high.\n            if (low === undefined && high === undefined) {\n                // Both are undefined, so view is whole chromosome.\n                view.low = 0;\n                view.high = view.max_high;\n            } else {\n                // Low and/or high is defined.\n                view.low = low !== undefined ? Math.max(low, 0) : 0;\n                if (high === undefined) {\n                    // Center visualization around low.\n                    // HACK: max resolution is currently 30 bases.\n                    view.low = Math.max(view.low - 15, 0);\n                    view.high = view.low + 30;\n                } else {\n                    // High is defined.\n                    view.high = Math.min(high, view.max_high);\n                }\n            }\n\n            view.request_redraw();\n        }\n    },\n\n    /**\n     * Change viewing region to that denoted by string. General format of string is:\n     *\n     * <chrom>[ {separator}<start>[-<end>] ]\n     *\n     * where separator can be whitespace or a colon. Examples:\n     *\n     * chr22\n     * chr1:100-200\n     * chr7 89999\n     * chr8 90000 990000\n     */\n    go_to: function(str) {\n        // Remove commas.\n        str = str.replace(/,/g, \"\");\n\n        // Replace colons and hyphens with space for easy parsing.\n        str = str.replace(/:|-/g, \" \");\n\n        // Parse new location.\n        var chrom_pos = str.split(/\\s+/);\n\n        var chrom = chrom_pos[0];\n        var new_low = chrom_pos[1] ? parseInt(chrom_pos[1], 10) : undefined;\n        var new_high = chrom_pos[2] ? parseInt(chrom_pos[2], 10) : undefined;\n\n        this.change_chrom(chrom, new_low, new_high);\n    },\n\n    move_fraction: function(fraction) {\n        var view = this;\n        var span = view.high - view.low;\n        this.move_delta(fraction * span);\n    },\n\n    move_delta: function(delta_chrom) {\n        //\n        // Update low, high.\n        //\n\n        var view = this;\n        var current_chrom_span = view.high - view.low;\n        // Check for left and right boundaries\n        if (view.low - delta_chrom < view.max_low) {\n            view.low = view.max_low;\n            view.high = view.max_low + current_chrom_span;\n        } else if (view.high - delta_chrom > view.max_high) {\n            view.high = view.max_high;\n            view.low = view.max_high - current_chrom_span;\n        } else {\n            view.high -= delta_chrom;\n            view.low -= delta_chrom;\n        }\n\n        //\n        // Redraw view.\n        //\n\n        // Redraw without requesting more data immediately.\n        view.request_redraw({ data_fetch: false });\n\n        // Set up timeout to redraw with more data when moving stops.\n        if (this.redraw_on_move_fn) {\n            window.clearTimeout(this.redraw_on_move_fn);\n        }\n\n        this.redraw_on_move_fn = window.setTimeout(() => {\n            view.request_redraw();\n        }, 200);\n\n        // Navigate.\n        var chrom = view.chrom_select.val();\n        this.trigger_navigate(chrom, view.low, view.high, true);\n    },\n\n    /**\n     * Add a drawable to the view.\n     */\n    add_drawable: function(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        drawable.init();\n        this.changed();\n        this.update_intro_div();\n\n        // When drawable config changes, mark view as changed. This\n        // captures most (all?) state change that needs to be saved.\n        var self = this;\n        drawable.config.on(\"change\", () => {\n            self.changed();\n        });\n    },\n\n    add_label_track: function(label_track) {\n        label_track.view = this;\n        label_track.init();\n        this.label_tracks.push(label_track);\n    },\n\n    /**\n     * Remove drawable from the view.\n     */\n    remove_drawable: function(drawable, hide) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        if (hide) {\n            var view = this;\n            drawable.container_div.hide(0, function() {\n                $(this).remove();\n                view.update_intro_div();\n            });\n        }\n    },\n\n    reset: function() {\n        this.low = this.max_low;\n        this.high = this.max_high;\n        this.viewport_container.find(\".yaxislabel\").remove();\n    },\n\n    /**\n     * Request that view redraw one or more of view's drawables. If drawable is not specified,\n     * all drawables are redrawn.\n     */\n    request_redraw: function(options, drawable) {\n        var view = this;\n\n        var // Either redrawing a single drawable or all view's drawables.\n            track_list = drawable ? [drawable] : view.drawables;\n\n        // Add/update tracks in track list to redraw list.\n        _.each(track_list, track => {\n            var track_options = _.find(view.tracks_to_be_redrawn, to => to[0] === track);\n\n            if (track_options) {\n                // Track already in list; update options.\n                track_options[1] = options;\n            } else {\n                // Track not in list yet.\n                view.tracks_to_be_redrawn.push([track, options]);\n            }\n        });\n\n        // Set up redraw if it has not been requested since last redraw.\n        if (!this.requested_redraw) {\n            window.requestAnimationFrame(() => {\n                view._redraw();\n            });\n            this.requested_redraw = true;\n        }\n    },\n\n    /**\n     * Redraws view and tracks.\n     * NOTE: this method should never be called directly; request_redraw() should be used so\n     * that requestAnimationFrame can manage redrawing.\n     */\n    _redraw: function() {\n        // TODO: move this code to function that does location setting.\n\n        // Clear because requested redraw is being handled now.\n        this.requested_redraw = false;\n\n        var low = this.low;\n        var high = this.high;\n\n        if (low < this.max_low) {\n            low = this.max_low;\n        }\n        if (high > this.max_high) {\n            high = this.max_high;\n        }\n        var span = this.high - this.low;\n        if (this.high !== 0 && span < this.min_separation) {\n            high = low + this.min_separation;\n        }\n        this.low = Math.floor(low);\n        this.high = Math.ceil(high);\n\n        this.update_location(this.low, this.high);\n\n        // -- Drawing code --\n\n        // Resolution is a pixel density.\n        this.resolution_px_b = this.viewport_container.width() / (this.high - this.low);\n\n        // Overview\n        var left_px = (this.low / (this.max_high - this.max_low)) * this.overview_viewport.width() || 0;\n        var width_px = ((this.high - this.low) / (this.max_high - this.max_low)) * this.overview_viewport.width() || 0;\n        var min_width_px = 13;\n\n        this.overview_box\n            .css({\n                left: left_px,\n                width: Math.max(min_width_px, width_px)\n            })\n            .show();\n        if (width_px < min_width_px) {\n            this.overview_box.css(\"left\", left_px - (min_width_px - width_px) / 2);\n        }\n        if (this.overview_highlight) {\n            this.overview_highlight.css({\n                left: left_px,\n                width: width_px\n            });\n        }\n\n        // Draw data tracks.\n        _.each(this.tracks_to_be_redrawn, track_options => {\n            var track = track_options[0];\n            var options = track_options[1];\n            if (track) {\n                track._draw(options);\n            }\n        });\n        this.tracks_to_be_redrawn = [];\n\n        // Draw label tracks.\n        _.each(this.label_tracks, label_track => {\n            label_track._draw();\n        });\n    },\n\n    zoom_in: function(point, container) {\n        if (this.max_high === 0 || this.high - this.low <= this.min_separation) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = span / this.zoom_factor / 2;\n        if (point) {\n            cur_center = (point / this.viewport_container.width()) * (this.high - this.low) + this.low;\n        }\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n\n        this.changed();\n        this.request_redraw();\n    },\n\n    zoom_out: function() {\n        if (this.max_high === 0) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = (span * this.zoom_factor) / 2;\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n        this.changed();\n        this.request_redraw();\n    },\n\n    /** Resize viewport. Use this method if header/footer content has changed in size. */\n    resize_viewport: function() {\n        this.viewport_container.height(\n            this.container.height() - this.top_container.height() - this.bottom_container.height()\n        );\n    },\n\n    /** Called when window is resized. */\n    resize_window: function() {\n        this.resize_viewport();\n        this.request_redraw();\n    },\n\n    /** Show a Drawable in the overview. */\n    set_overview: function(drawable) {\n        if (this.overview_drawable) {\n            // If drawable to be set as overview is already in overview, do nothing.\n            // Otherwise, remove overview.\n            if (this.overview_drawable.dataset.id === drawable.dataset.id) {\n                return;\n            }\n            this.overview_viewport.find(\".track\").remove();\n        }\n\n        // Set new overview.\n        var overview_drawable = drawable.copy({\n            content_div: this.overview_viewport\n        });\n\n        var view = this;\n        overview_drawable.header_div.hide();\n        overview_drawable.is_overview = true;\n        view.overview_drawable = overview_drawable;\n        this.overview_drawable.postdraw_actions = () => {\n            view.overview_highlight.show().height(view.overview_drawable.content_div.height());\n            view.overview_viewport.height(\n                view.overview_drawable.content_div.height() + view.overview_box.outerHeight()\n            );\n            view.overview_close.show();\n            view.resize_window();\n        };\n        view.overview_drawable.request_draw();\n        this.changed();\n    },\n\n    /** Close and reset overview. */\n    reset_overview: function() {\n        // Update UI.\n        $(\".tooltip\").remove();\n        this.overview_viewport.find(\".track-tile\").remove();\n        this.overview_viewport.height(this.default_overview_height);\n        this.overview_box.height(this.default_overview_height);\n        this.overview_close.hide();\n        this.overview_highlight.hide();\n        this.resize_window();\n        this.overview_drawable = null;\n    }\n});\n\n/**\n * Encapsulation of a tool that users can apply to tracks/datasets.\n */\nvar TracksterTool = tools_mod.Tool.extend({\n    defaults: {\n        track: null\n    },\n\n    initialize: function(options) {\n        tools_mod.Tool.prototype.initialize.call(this, options);\n\n        // Restore tool visibility from state; default to hidden.\n        var hidden = true;\n        if (options.tool_state !== undefined && options.tool_state.hidden !== undefined) {\n            hidden = options.tool_state.hidden;\n        }\n        this.set(\"hidden\", hidden);\n\n        // FIXME: need to restore tool values from options.tool_state\n\n        // HACK: remove some inputs because Trackster does yet not work with them.\n        this.remove_inputs([\"data\", \"hidden_data\", \"conditional\"]);\n    },\n\n    state_dict: function(options) {\n        return _.extend(this.get_inputs_dict(), {\n            hidden: !this.is_visible()\n        });\n    }\n});\n\n/**\n * View renders tool parameter HTML and updates parameter value as it is changed in the HTML.\n */\nvar ToolParameterView = Backbone.View.extend({\n    events: {\n        \"change :input\": \"update_value\"\n    },\n\n    render: function() {\n        var param_div = this.$el.addClass(\"param-row\");\n        var param = this.model;\n\n        // Param label.\n        $(\"<div>\")\n            .addClass(\"param-label\")\n            .text(param.get(\"label\"))\n            .appendTo(param_div);\n        // Param HTML.\n        var html_div = $(\"<div/>\")\n            .addClass(\"param-input\")\n            .html(param.get(\"html\"))\n            .appendTo(param_div);\n        // Set initial value.\n        html_div.find(\":input\").val(param.get(\"value\"));\n\n        // Add to clear floating layout.\n        $(\"<div style='clear: both;'/>\").appendTo(param_div);\n    },\n\n    update_value: function(update_event) {\n        this.model.set_value($(update_event.target).val());\n    }\n});\n\n/**\n * View for TracksterTool.\n */\nvar TracksterToolView = Backbone.View.extend({\n    initialize: function(options) {\n        this.model.on(\"change:hidden\", this.set_visible, this);\n    },\n\n    /**\n     * Render tool UI.\n     */\n    render: function() {\n        var self = this;\n        var tool = this.model;\n        var parent_div = this.$el.addClass(\"dynamic-tool\").hide();\n\n        // Prevent div events from propogating to other elements.\n        parent_div\n            .bind(\"drag\", e => {\n                e.stopPropagation();\n            })\n            .click(e => {\n                e.stopPropagation();\n            })\n            .bind(\"dblclick\", e => {\n                e.stopPropagation();\n            })\n            .keydown(e => {\n                e.stopPropagation();\n            });\n\n        // Add name, inputs.\n        $(\"<div class='tool-name'>\")\n            .appendTo(parent_div)\n            .text(tool.get(\"name\"));\n        tool.get(\"inputs\").each(param => {\n            // Render parameter.\n            var param_view = new ToolParameterView({ model: param });\n            param_view.render();\n            parent_div.append(param_view.$el);\n        });\n\n        // Highlight value for inputs for easy replacement.\n        parent_div.find(\"input\").click(function() {\n            $(this).select();\n        });\n\n        // Add buttons for running on dataset, region.\n        var run_tool_row = $(\"<div>\")\n            .addClass(\"param-row\")\n            .appendTo(parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'>\")\n            .attr(\"value\", \"Run on complete dataset\")\n            .appendTo(run_tool_row);\n        var run_on_region_button = $(\"<input type='submit'>\")\n            .attr(\"value\", \"Run on visible region\")\n            .appendTo(run_tool_row);\n        run_on_region_button.click(() => {\n            // Run tool to create new track.\n            self.run_on_region();\n        });\n        run_on_dataset_button.click(() => {\n            self.run_on_dataset();\n        });\n\n        if (tool.is_visible()) {\n            this.$el.show();\n        }\n    },\n\n    /**\n     * Show or hide tool depending on tool visibility state.\n     */\n    set_visible: function() {\n        this.$el.toggle(this.model.is_visible());\n    },\n\n    /**\n     * Update tool parameters.\n     */\n    update_params: function() {\n        for (var i = 0; i < this.params.length; i++) {\n            this.params[i].update_value();\n        }\n    },\n\n    /**\n     * Run tool on dataset. Output is placed in dataset's history and no changes to viz are made.\n     */\n    run_on_dataset: function() {\n        var tool = this.model;\n        let Galaxy = getGalaxyInstance();\n        this.run(\n            // URL params.\n            {\n                target_dataset_id: this.model.get(\"track\").dataset.id,\n                action: \"rerun\",\n                tool_id: tool.id\n            },\n            null,\n            track_data => {\n                Galaxy.modal.show({\n                    title: `${tool.get(\"name\")} is Running`,\n                    body: `${tool.get(\n                        \"name\"\n                    )} is running on the complete dataset. Tool outputs are in dataset's history.`,\n                    buttons: {\n                        Close: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            }\n        );\n    },\n\n    /**\n     * Run dataset on visible region. This creates a new track and sets the track's contents\n     * to the tool's output.\n     */\n    run_on_region: function() {\n        //\n        // Create track for tool's output immediately to provide user feedback.\n        //\n        var track = this.model.get(\"track\");\n\n        var tool = this.model;\n\n        var region = new visualization.GenomeRegion({\n            chrom: track.view.chrom,\n            start: track.view.low,\n            end: track.view.high\n        });\n\n        var url_params = {\n            target_dataset_id: track.dataset.id,\n            action: \"rerun\",\n            tool_id: tool.id,\n            regions: [region.toJSON()]\n        };\n\n        // Set name of track to include tool name, parameters, and region used.\n        var track_name = tool.get(\"name\") + track.tool_region_and_parameters_str(region);\n\n        var container;\n\n        // If track not in a group, create a group for it and add new track to group. If track\n        // already in group, add track to group.\n        if (track.container === track.view) {\n            // Create new group.\n            var group = new DrawableGroup(track.view, track.view, {\n                name: track.config.get_value(\"name\")\n            });\n\n            // Replace track with group.\n            var index = track.container.replace_drawable(track, group, false);\n\n            // Update HTML.\n            // FIXME: this is ugly way to replace a track with a group -- make this easier via\n            // a Drawable or DrawableCollection function.\n            group.container_div.insertBefore(track.view.content_div.children()[index]);\n            group.add_drawable(track);\n            track.container_div.appendTo(group.content_div);\n            container = group;\n        } else {\n            // Use current group.\n            container = track.container;\n        }\n\n        // Create and init new track.\n        var new_track = new track.constructor(track.view, container, {\n            name: track_name,\n            hda_ldda: \"hda\"\n        });\n        new_track.init_for_tool_data();\n        new_track.change_mode(track.mode);\n        new_track.set_filters_manager(track.filters_manager.copy(new_track));\n        new_track.update_icons();\n        container.add_drawable(new_track);\n        new_track.tiles_div.text(\"Starting job.\");\n\n        // Run tool.\n        this.run(url_params, new_track, track_data => {\n            new_track.set_dataset(new Dataset(track_data));\n            new_track.tiles_div.text(\"Running job.\");\n            new_track.init();\n        });\n    },\n\n    /**\n     * Run tool using a set of URL params and a success callback.\n     */\n    run: function(url_params, new_track, success_callback) {\n        // Run tool.\n        url_params.inputs = this.model.get_inputs_dict();\n        var ss_deferred = new util.ServerStateDeferred({\n            ajax_settings: {\n                url: `${getAppRoot()}api/tools`,\n                data: JSON.stringify(url_params),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Start with this status message.\n        //new_track.container_div.addClass(\"pending\");\n        //new_track.content_div.html(DATA_PENDING);\n\n        $.when(ss_deferred.go()).then(response => {\n            if (response === \"no converter\") {\n                // No converter available for input datasets, so cannot run tool.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_NOCONVERTER);\n            } else if (response.error) {\n                // General error.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_CANNOT_RUN_TOOL + response.message);\n            } else {\n                // Job submitted and running.\n                success_callback(response);\n            }\n        });\n    }\n});\n\n/**\n * Generates scale values based on filter and feature's value for filter.\n */\nvar FilterScaler = function(filter, default_val) {\n    painters.Scaler.call(this, default_val);\n    this.filter = filter;\n};\n\nFilterScaler.prototype.gen_val = function(feature_data) {\n    // If filter is not initalized yet, return default val.\n    if (\n        this.filter.high === Number.MAX_VALUE ||\n        this.filter.low === -Number.MAX_VALUE ||\n        this.filter.low === this.filter.high\n    ) {\n        return this.default_val;\n    }\n\n    // Scaling value is ratio of (filter's value compared to low) to (complete filter range).\n    return (parseFloat(feature_data[this.filter.index]) - this.filter.low) / (this.filter.high - this.filter.low);\n};\n\n/**\n * Tiles drawn by tracks.\n */\nvar Tile = function(track, region, w_scale, canvas, data) {\n    this.track = track;\n    this.region = region;\n    this.low = region.get(\"start\");\n    this.high = region.get(\"end\");\n    this.w_scale = w_scale;\n    this.canvas = canvas;\n    // Wrap element in div for background and to provide container for tile-specific elements.\n    this.html_elt = $(\"<div class='track-tile'/>\").append(canvas);\n    this.data = data;\n    this.stale = false;\n};\n\n/**\n * Perform pre-display actions.\n */\nTile.prototype.predisplay_actions = () => {};\n\nvar LineTrackTile = function(track, region, w_scale, canvas, data) {\n    Tile.call(this, track, region, w_scale, canvas, data);\n};\nLineTrackTile.prototype.predisplay_actions = () => {};\n\nvar FeatureTrackTile = function(\n    track,\n    region,\n    w_scale,\n    canvas,\n    data,\n    mode,\n    message,\n    all_slotted,\n    feature_mapper,\n    incomplete_features,\n    seq_data\n) {\n    // Attribute init.\n    Tile.call(this, track, region, w_scale, canvas, data);\n    this.mode = mode;\n    this.all_slotted = all_slotted;\n    this.feature_mapper = feature_mapper;\n    this.has_icons = false;\n    this.incomplete_features = incomplete_features;\n    // Features drawn based on data from other tiles.\n    this.other_tiles_features_drawn = {};\n    this.seq_data = seq_data;\n\n    // Add message + action icons to tile's html.\n    /*\n    This does not work right now because a random set of reads is returned by the server.\n    When the server can respond with more data systematically, renable these icons.\n    if (message) {\n        this.has_icons = true;\n\n        var\n            tile = this;\n            canvas = this.html_elt.children()[0],\n            message_div = $(\"<div/>\").addClass(\"tile-message\")\n                            // -1 to account for border.\n                            .css({'height': ERROR_PADDING, 'width': canvas.width}).prependTo(this.html_elt);\n\n        // Handle message; only message currently is that only the first N elements are displayed.\n        var tile_region = new visualization.GenomeRegion({\n                chrom: track.view.chrom,\n                start: this.low,\n                end: this.high\n            }),\n            num_features = data.length,\n            more_down_icon = $(\"<a/>\").addClass(\"icon more-down\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data including depth\")\n                                .tooltip().appendTo(message_div),\n            more_across_icon = $(\"<a/>\").addClass(\"icon more-across\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data excluding depth\")\n                                .tooltip().appendTo(message_div);\n\n        // Set up actions for icons.\n        more_down_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.DEEP_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n\n        more_across_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.BROAD_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n    }\n    */\n};\nextend(FeatureTrackTile.prototype, Tile.prototype);\n\n/**\n * Sets up support for popups.\n */\nFeatureTrackTile.prototype.predisplay_actions = () => {\n    /*\n    FIXME: use a canvas library to handle popups.\n    //\n    // Add support for popups.\n    //\n    var tile = this,\n        popups = {};\n\n    // Only show popups in Pack mode.\n    if (tile.mode !== \"Pack\") { return; }\n\n    $(this.html_elt).hover(\n    function() {\n        this.hovered = true;\n        $(this).mousemove();\n    },\n    function() {\n        this.hovered = false;\n        // Clear popup if it is still hanging around (this is probably not needed)\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    } ).mousemove(function (e) {\n        // Use the hover plugin to get a delay before showing popup\n        if ( !this.hovered ) { return; }\n        // Get feature data for position.\n        var\n            this_offset = $(this).offset(),\n            offsetX = e.pageX - this_offset.left,\n            offsetY = e.pageY - this_offset.top,\n            feature_data = tile.feature_mapper.get_feature_data(offsetX, offsetY),\n            feature_uid = (feature_data ? feature_data[0] : null);\n        // Hide visible popup if not over a feature or over a different feature.\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").each(function() {\n            if ( !feature_uid ||\n                 $(this).attr(\"id\") !== feature_uid.toString() ) {\n                $(this).remove();\n            }\n        });\n\n        if (feature_data) {\n            // Get or create popup.\n            var popup = popups[feature_uid];\n            if (!popup) {\n                // Create feature's popup element.\n                var feature_dict = {\n                        name: feature_data[3],\n                        start: feature_data[1],\n                        end: feature_data[2],\n                        strand: feature_data[4]\n                    },\n                    filters = tile.track.filters_manager.filters,\n                    filter;\n\n                // Add filter values to feature dict.\n                for (var i = 0; i < filters.length; i++) {\n                    filter = filters[i];\n                    feature_dict[filter.name] = feature_data[filter.index];\n                }\n\n                // Build popup.\n                popup = $(\"<div/>\").attr(\"id\", feature_uid).addClass(\"feature-popup\");\n                var table = $(\"<table/>\"),\n                    key, value, row;\n                for (key in feature_dict) {\n                    value = feature_dict[key];\n                    row = $(\"<tr/>\").appendTo(table);\n                    $(\"<th/>\").appendTo(row).text(key);\n                    $(\"<td/>\").attr(\"align\", \"left\").appendTo(row)\n                              .text(typeof(value) === 'number' ? round(value, 2) : value);\n                }\n                popup.append( $(\"<div class='feature-popup-inner'>\").append( table ) );\n                popups[feature_uid] = popup;\n            }\n\n            // Attach popup to track's overlay.\n            popup.appendTo( $(this).parents(\".track-content\").children(\".overlay\") );\n\n            // Offsets are within canvas, but popup must be positioned relative to parent element.\n            // parseInt strips \"px\" from left, top measurements. +7 so that mouse pointer does not\n            // overlap popup.\n            var\n                popupX = offsetX + parseInt( tile.html_elt.css(\"left\"), 10 ) - popup.width() / 2,\n                popupY = offsetY + parseInt( tile.html_elt.css(\"top\"), 10 ) + 7;\n            popup.css(\"left\", popupX + \"px\").css(\"top\", popupY + \"px\");\n        }\n        else if (!e.isPropagationStopped()) {\n            // Propogate event to other tiles because overlapping tiles prevent mousemove from being\n            // called on tiles under this tile.\n            e.stopPropagation();\n            $(this).siblings().each(function() {\n                $(this).trigger(e);\n            });\n        }\n    })\n    .mouseleave(function() {\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    });\n    */\n};\n\n/**\n * Tracks are objects can be added to the View.\n *\n * Track object hierarchy:\n * Track\n * -> LabelTrack\n * -> TiledTrack\n * ----> LineTrack\n * ----> ReferenceTrack\n * ----> FeatureTrack\n * -------> ReadTrack\n * ----> VariantTrack\n */\nvar Track = function(view, container, obj_dict) {\n    // For now, track's container is always view.\n    extend(obj_dict, {\n        drag_handle_class: \"draghandle\"\n    });\n    Drawable.call(this, view, container, obj_dict);\n\n    //\n    // Attribute init.\n    //\n\n    // Set or create dataset.\n    this.dataset = null;\n    if (obj_dict.dataset) {\n        // Dataset can be a Backbone model or a dict that can be used to create a model.\n        this.dataset = obj_dict.dataset instanceof Backbone.Model ? obj_dict.dataset : new Dataset(obj_dict.dataset);\n    }\n    this.dataset_check_type = \"converted_datasets_state\";\n    this.data_url_extra_params = {};\n    this.data_query_wait = \"data_query_wait\" in obj_dict ? obj_dict.data_query_wait : DEFAULT_DATA_QUERY_WAIT;\n    // A little ugly creating data manager right now due to transition to Backbone-based objects.\n    this.data_manager =\n        \"data_manager\" in obj_dict\n            ? obj_dict.data_manager\n            : new visualization.GenomeDataManager({\n                  dataset: this.dataset,\n                  // HACK: simulate 'genome' attributes from view for now.\n                  // View should eventually use Genome object.\n                  genome: new visualization.Genome({\n                      key: view.dbkey,\n                      chroms_info: {\n                          chrom_info: view.chrom_data\n                      }\n                  }),\n                  data_mode_compatible: this.data_and_mode_compatible,\n                  can_subset: this.can_subset\n              });\n\n    // Height attributes: min height, max height, and visible height.\n    this.min_height_px = 16;\n    this.max_height_px = 800;\n    this.visible_height_px = this.config.get_value(\"height\");\n\n    //\n    // Create content div, which is where track is displayed, and add to container if available.\n    //\n    this.content_div = $(\"<div class='track-content'>\").appendTo(this.container_div);\n    if (this.container) {\n        this.container.content_div.append(this.container_div);\n        if (!(\"resize\" in obj_dict) || obj_dict.resize) {\n            this.add_resize_handle();\n        }\n    }\n};\n\nextend(Track.prototype, Drawable.prototype, {\n    action_icons_def: [\n        // Change track mode.\n        {\n            name: \"mode_icon\",\n            title: _l(\"Set display mode\"),\n            css_class: \"chevron-expand\",\n            on_click_fn: function() {}\n        },\n        // Hide/show content.\n        Drawable.prototype.action_icons_def[0],\n        // Set track as overview.\n        {\n            name: \"overview_icon\",\n            title: _l(\"Set as overview\"),\n            css_class: \"application-dock-270\",\n            on_click_fn: function(track) {\n                track.view.set_overview(track);\n            }\n        },\n        // Edit config.\n        Drawable.prototype.action_icons_def[1],\n        // Toggle track filters.\n        {\n            name: \"filters_icon\",\n            title: _l(\"Filters\"),\n            css_class: \"ui-slider-050\",\n            on_click_fn: function(drawable) {\n                // TODO: update Tooltip text.\n                if (drawable.filters_manager.visible()) {\n                    drawable.filters_manager.clear_filters();\n                } else {\n                    drawable.filters_manager.init_filters();\n                }\n                drawable.filters_manager.toggle();\n            }\n        },\n        // Toggle track tool.\n        {\n            name: \"tools_icon\",\n            title: _l(\"Tool\"),\n            css_class: \"hammer\",\n            on_click_fn: function(track) {\n                // TODO: update Tooltip text.\n\n                track.tool.toggle();\n\n                // Update track name.\n                if (track.tool.is_visible()) {\n                    track.set_name(track.config.get_value(\"name\") + track.tool_region_and_parameters_str());\n                } else {\n                    track.revert_name();\n                }\n                // HACK: name change modifies icon placement, which leaves tooltip incorrectly placed.\n                $(\".tooltip\").remove();\n            }\n        },\n        // Go to parameter exploration visualization.\n        {\n            name: \"param_space_viz_icon\",\n            title: _l(\"Tool parameter space visualization\"),\n            css_class: \"arrow-split\",\n            on_click_fn: track => {\n                let Galaxy = getGalaxyInstance();\n\n                var html = `\n                    <strong>Tool</strong>:${track.tool.get(\"name\")}<br/>\n                    <strong>Dataset</strong>:${track.config.get_value(\"name\")}<br/>\n                    <strong>Region(s)</strong>:\n                        <select name=\"regions\">\n                            <option value=\"cur\">current viewing area</option>\n                            <option value=\"bookmarks\">bookmarks</option>\n                            <option value=\"both\">current viewing area and bookmarks</option>\n                        </select>\n                    `;\n\n                var cancel_fn = () => {\n                    Galaxy.modal.hide();\n                    $(window).unbind(\"keypress.check_enter_esc\");\n                };\n\n                var ok_fn = () => {\n                    var regions_to_use = $('select[name=\"regions\"] option:selected').val();\n                    var regions;\n                    var view_region = new visualization.GenomeRegion({\n                        chrom: this.view.chrom,\n                        start: this.view.low,\n                        end: this.view.high\n                    });\n                    var bookmarked_regions = _.map(\n                        $(\".bookmark\"),\n                        elt =>\n                            new visualization.GenomeRegion({\n                                from_str: $(elt)\n                                    .children(\".position\")\n                                    .text()\n                            })\n                    );\n\n                    // Get regions for visualization.\n                    if (regions_to_use === \"cur\") {\n                        // Use only current region.\n                        regions = [view_region];\n                    } else if (regions_to_use === \"bookmarks\") {\n                        // Use only bookmarks.\n                        regions = bookmarked_regions;\n                    } else {\n                        // Use both current region and bookmarks.\n                        regions = [view_region].concat(bookmarked_regions);\n                    }\n\n                    Galaxy.modal.hide();\n\n                    // Go to visualization.\n                    window.top.location.href = `${getAppRoot()}visualization/sweepster?${$.param({\n                        dataset_id: track.dataset.id,\n                        hda_ldda: track.dataset.get(\"hda_ldda\"),\n                        regions: JSON.stringify(new Backbone.Collection(regions).toJSON())\n                    })}`;\n                };\n\n                /*\n                 * TODO: Re-enable this when functional.\n                var check_enter_esc = e => {\n                    if ((e.keyCode || e.which) === 27) {\n                        // Escape key\n                        cancel_fn();\n                    } else if ((e.keyCode || e.which) === 13) {\n                        // Enter key\n                        ok_fn();\n                    }\n                };\n                */\n\n                // show dialog\n                Galaxy.modal.show({\n                    title: \"Visualize tool parameter space and output from different parameter settings?\",\n                    body: html,\n                    buttons: { No: cancel_fn, Yes: ok_fn }\n                });\n            }\n        },\n        // Remove track.\n        Drawable.prototype.action_icons_def[2]\n    ],\n\n    can_draw: function() {\n        return this.dataset && Drawable.prototype.can_draw.call(this);\n    },\n\n    build_container_div: function() {\n        return $(\"<div/>\")\n            .addClass(\"track\")\n            .attr(\"id\", `track_${this.id}`);\n    },\n\n    /**\n     * Set track's dataset.\n     */\n    set_dataset: function(dataset) {\n        this.dataset = dataset;\n        this.data_manager.set(\"dataset\", dataset);\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function() {\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Add resizing handle to drawable's container_div.\n     */\n    add_resize_handle: function() {\n        var track = this;\n        var in_handle = false;\n        var in_drag = false;\n        var drag_control = $(\"<div class='track-resize'>\");\n        // Control shows on hover over track, stays while dragging\n        $(track.container_div).hover(\n            () => {\n                if (track.config.get_value(\"content_visible\")) {\n                    in_handle = true;\n                    drag_control.show();\n                }\n            },\n            () => {\n                in_handle = false;\n                if (!in_drag) {\n                    drag_control.hide();\n                }\n            }\n        );\n        // Update height and force redraw of current view while dragging,\n        // clear cache to force redraw of other tiles.\n        drag_control\n            .hide()\n            .bind(\"dragstart\", (e, d) => {\n                in_drag = true;\n                d.original_height = $(track.content_div).height();\n            })\n            .bind(\"drag\", (e, d) => {\n                var new_height = Math.min(\n                    Math.max(d.original_height + d.deltaY, track.min_height_px),\n                    track.max_height_px\n                );\n                $(track.tiles_div).css(\"height\", new_height);\n                track.visible_height_px = track.max_height_px === new_height ? 0 : new_height;\n                track.on_resize();\n            })\n            .bind(\"dragend\", (e, d) => {\n                track.tile_cache.clear();\n                in_drag = false;\n                if (!in_handle) {\n                    drag_control.hide();\n                }\n                track.config.set_value(\"height\", track.visible_height_px);\n                track.changed();\n            })\n            .appendTo(track.container_div);\n    },\n\n    /**\n     * Hide any elements that are part of the tracks contents area. Should\n     * remove as approprite, the track will be redrawn by show_contents.\n     */\n    hide_contents: function() {\n        // Hide tiles.\n        this.tiles_div.hide();\n        // Hide any y axis labels (common to several track types)\n        this.container_div.find(\".yaxislabel, .track-resize\").hide();\n    },\n\n    show_contents: function() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        this.container_div.find(\".yaxislabel, .track-resize\").show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    /**\n     * Returns track type.\n     */\n    get_type: function() {\n        // Order is important: start with most-specific classes and go up the track hierarchy.\n        if (this instanceof LabelTrack) {\n            return \"LabelTrack\";\n        } else if (this instanceof ReferenceTrack) {\n            return \"ReferenceTrack\";\n        } else if (this instanceof LineTrack) {\n            return \"LineTrack\";\n        } else if (this instanceof ReadTrack) {\n            return \"ReadTrack\";\n        } else if (this instanceof VariantTrack) {\n            return \"VariantTrack\";\n        } else if (this instanceof CompositeTrack) {\n            return \"CompositeTrack\";\n        } else if (this instanceof FeatureTrack) {\n            return \"FeatureTrack\";\n        }\n        return \"\";\n    },\n\n    /**\n     * Remove visualization content and display message.\n     */\n    show_message: function(msg_html) {\n        this.tiles_div.remove();\n        return $(\"<span/>\")\n            .addClass(\"message\")\n            .html(msg_html)\n            .appendTo(this.content_div);\n    },\n\n    /**\n     * Initialize and draw the track.\n     */\n    init: function(retry) {\n        // FIXME: track should have a 'state' attribute that is checked on load; this state attribute should be\n        // used in this function to determine what action(s) to take.\n\n        var track = this;\n        track.enabled = false;\n        track.tile_cache.clear();\n        track.data_manager.clear();\n        /*\n        if (!track.content_div.text()) {\n            track.content_div.text(DATA_LOADING);\n        }\n        */\n        // Remove old track content (e.g. tiles, messages).\n        track.content_div.children().remove();\n        track.container_div.removeClass(\"nodata error pending\");\n\n        track.tiles_div = $(\"<div/>\")\n            .addClass(\"tiles\")\n            .appendTo(track.content_div);\n\n        //\n        // Tracks with no dataset id are handled differently.\n        // FIXME: is this really necessary?\n        //\n        if (!track.dataset.id) {\n            return;\n        }\n\n        // Get dataset state; if state is fine, enable and draw track. Otherwise, show message\n        // about track status.\n        var init_deferred = $.Deferred();\n\n        var params = {\n            hda_ldda: track.dataset.get(\"hda_ldda\"),\n            data_type: this.dataset_check_type,\n            chrom: track.view.chrom,\n            retry: retry\n        };\n\n        $.getJSON(this.dataset.url(), params, result => {\n            if (!result || result === \"error\" || result.kind === \"error\") {\n                // Dataset is in error state.\n                track.container_div.addClass(\"error\");\n                var msg_elt = track.show_message(DATA_ERROR);\n                if (result.message) {\n                    // Add links to (a) show error and (b) try again.\n                    msg_elt.append(\n                        $(\"<a href='javascript:void(0);'></a>\")\n                            .text(\"View error\")\n                            .click(() => {\n                                let Galaxy = getGalaxyInstance();\n                                Galaxy.modal.show({\n                                    title: _l(\"Trackster Error\"),\n                                    body: `<pre>${result.message}</pre>`,\n                                    buttons: {\n                                        Close: function() {\n                                            Galaxy.modal.hide();\n                                        }\n                                    }\n                                });\n                            })\n                    );\n                    msg_elt.append($(\"<span/>\").text(\" \"));\n                    msg_elt.append(\n                        $(\"<a href='javascript:void(0);'></a>\")\n                            .text(\"Try again\")\n                            .click(() => {\n                                track.init(true);\n                            })\n                    );\n                }\n            } else if (result === \"no converter\") {\n                track.container_div.addClass(\"error\");\n                track.show_message(DATA_NOCONVERTER);\n            } else if (\n                result === \"no data\" ||\n                (result.data !== undefined && (result.data === null || result.data.length === 0))\n            ) {\n                track.container_div.addClass(\"nodata\");\n                track.show_message(DATA_NONE);\n            } else if (result === \"pending\") {\n                track.container_div.addClass(\"pending\");\n                track.show_message(DATA_PENDING);\n                //$(\"<img/>\").attr(\"src\", image_path + \"/yui/rel_interstitial_loading.gif\").appendTo(track.tiles_div);\n                window.setTimeout(() => {\n                    track.init();\n                }, track.data_query_wait);\n            } else if (result === \"data\" || result.status === \"data\") {\n                if (result.valid_chroms) {\n                    track.valid_chroms = result.valid_chroms;\n                    track.update_icons();\n                }\n                track.tiles_div.text(DATA_OK);\n                if (track.view.chrom) {\n                    track.tiles_div.text(\"\");\n                    track.tiles_div.css(\"height\", `${track.visible_height_px}px`);\n                    track.enabled = true;\n                    // predraw_init may be asynchronous, wait for it and then draw\n                    $.when.apply($, track.predraw_init()).done(() => {\n                        init_deferred.resolve();\n                        track.container_div.removeClass(\"nodata error pending\");\n                        track.request_draw();\n                    });\n                } else {\n                    init_deferred.resolve();\n                }\n            }\n        });\n\n        this.update_icons();\n        return init_deferred;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var track = this;\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                var data = result.data;\n\n                // Tracks may not have stat data either because there is no data or data is not yet ready.\n                if (data && data.min !== undefined && data.max !== undefined) {\n                    // Compute default minimum and maximum values\n                    var min_value = data.min;\n\n                    var max_value = data.max;\n                    // If mean and sd are present, use them to compute a ~95% window\n                    // but only if it would shrink the range on one side\n                    min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                    max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                    // Update config, prefs\n                    track.config.set_default_value(\"min_value\", min_value);\n                    track.config.set_default_value(\"max_value\", max_value);\n                    track.config.set_value(\"min_value\", min_value);\n                    track.config.set_value(\"max_value\", max_value);\n                }\n            }\n        );\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function() {\n        return this;\n    }\n});\n\nvar TiledTrack = function(view, container, obj_dict) {\n    Track.call(this, view, container, obj_dict);\n\n    var track = this;\n\n    // Make track moveable.\n    moveable(track.container_div, track.drag_handle_class, \".group\", track);\n\n    // Attribute init.\n    this.filters_manager = new filters_mod.FiltersManager(this, \"filters\" in obj_dict ? obj_dict.filters : null);\n    // HACK: set filters manager for data manager.\n    // FIXME: prolly need function to set filters and update data_manager reference.\n    this.data_manager.set(\"filters_manager\", this.filters_manager);\n    this.filters_available = false;\n    this.tool = obj_dict.tool\n        ? new TracksterTool(\n              _.extend(obj_dict.tool, {\n                  track: this,\n                  tool_state: obj_dict.tool_state\n              })\n          )\n        : null;\n    this.tile_cache = new visualization.Cache(TILE_CACHE_SIZE);\n    this.left_offset = 0;\n\n    if (this.header_div) {\n        //\n        // Setup filters.\n        //\n        this.set_filters_manager(this.filters_manager);\n\n        //\n        // Create dynamic tool view.\n        //\n        if (this.tool) {\n            var tool_view = new TracksterToolView({ model: this.tool });\n            tool_view.render();\n            this.dynamic_tool_div = tool_view.$el;\n            this.header_div.after(this.dynamic_tool_div);\n        }\n    }\n\n    // Add tiles_div, overlay_div to content_div.\n    this.tiles_div = $(\"<div/>\")\n        .addClass(\"tiles\")\n        .appendTo(this.content_div);\n    if (!this.config.get_value(\"content_visible\")) {\n        this.tiles_div.hide();\n    }\n    this.overlay_div = $(\"<div/>\")\n        .addClass(\"overlay\")\n        .appendTo(this.content_div);\n\n    if (obj_dict.mode) {\n        this.change_mode(obj_dict.mode);\n    }\n};\nextend(TiledTrack.prototype, Drawable.prototype, Track.prototype, {\n    action_icons_def: Track.prototype.action_icons_def.concat([\n        // Show more rows when all features are not slotted.\n        {\n            name: \"show_more_rows_icon\",\n            title: \"To minimize track height, not all feature rows are displayed. Click to display more rows.\",\n            css_class: \"exclamation\",\n            on_click_fn: function(track) {\n                $(\".tooltip\").remove();\n                track.slotters[track.view.resolution_px_b].max_rows *= 2;\n                track.request_draw({ clear_tile_cache: true });\n            },\n            hide: true\n        }\n    ]),\n\n    /**\n     * Returns a copy of the track. The copy uses the same data manager so that the tracks can share data.\n     */\n    copy: function(container) {\n        // Create copy.\n        var obj_dict = this.to_dict();\n        extend(obj_dict, {\n            data_manager: this.data_manager\n        });\n        var new_track = new this.constructor(this.view, container, obj_dict);\n        // Misc. init and return.\n        new_track.change_mode(this.mode);\n        new_track.enabled = this.enabled;\n        return new_track;\n    },\n\n    /**\n     * Set filters manager + HTML elements.\n     */\n    set_filters_manager: function(filters_manager) {\n        this.filters_manager = filters_manager;\n        this.header_div.after(this.filters_manager.parent_div);\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {\n        return {\n            track_type: this.get_type(),\n            dataset: {\n                id: this.dataset.id,\n                hda_ldda: this.dataset.get(\"hda_ldda\")\n            },\n            prefs: this.config.to_key_value_dict(),\n            mode: this.mode,\n            filters: this.filters_manager.to_dict(),\n            tool_state: this.tool ? this.tool.state_dict() : {}\n        };\n    },\n\n    /**\n     * Set track bounds for current chromosome.\n     */\n    set_min_max: function() {\n        var track = this;\n\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                var data = result.data;\n                if (\n                    isNaN(parseFloat(track.config.get_value(\"min_value\"))) ||\n                    isNaN(parseFloat(track.config.get_value(\"max_value\")))\n                ) {\n                    // Compute default minimum and maximum values\n                    var min_value = data.min;\n\n                    var max_value = data.max;\n                    // If mean and sd are present, use them to compute a ~95% window\n                    // but only if it would shrink the range on one side\n                    min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                    max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                    // Update the prefs\n                    track.config.set_value(\"min_value\", min_value);\n                    track.config.set_value(\"max_value\", max_value);\n                }\n            }\n        );\n    },\n\n    /**\n     * Change track's mode.\n     */\n    change_mode: function(new_mode) {\n        var track = this;\n        // TODO: is it necessary to store the mode in two places (.mode and track_config)?\n        track.mode = new_mode;\n        track.config.set_value(\"mode\", new_mode);\n        // FIXME: find a better way to get Auto data w/o clearing cache; using mode in the\n        // data manager would work if Auto data were checked for compatibility when a specific\n        // mode is chosen.\n        if (new_mode === \"Auto\") {\n            this.data_manager.clear();\n        }\n        track.request_draw({ clear_tile_cache: true });\n        this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: ${track.mode})`);\n        return track;\n    },\n\n    /**\n     * Update track's buttons.\n     */\n    update_icons: function() {\n        var track = this;\n\n        //\n        // Show/hide filter icon.\n        //\n        track.action_icons.filters_icon.toggle(track.filters_available);\n\n        //\n        // Show/hide tool icons.\n        //\n        track.action_icons.tools_icon.toggle(track.tool !== null);\n        track.action_icons.param_space_viz_icon.toggle(track.tool !== null);\n    },\n\n    /**\n     * Generate a key for the tile cache.\n     * TODO: create a TileCache object (like DataCache) and generate key internally.\n     */\n    _gen_tile_cache_key: function(w_scale, tile_region) {\n        return `${w_scale}_${tile_region}`;\n    },\n\n    /**\n     * Request that track be drawn.\n     */\n    request_draw: function(options) {\n        if (options && options.clear_tile_cache) {\n            this.tile_cache.clear();\n        }\n        this.view.request_redraw(options, this);\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    before_draw: function() {\n        // Clear because this is set when drawing.\n        this.max_height_px = 0;\n    },\n\n    /**\n     * Draw track. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -clear_after: clear old tiles after drawing new tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     *\n     * NOTE: this function should never be called directly; use request_draw() so that drawing\n     * management can be used.\n     */\n    _draw: function(options) {\n        if (!this.can_draw()) {\n            return;\n        }\n\n        var clear_after = options && options.clear_after;\n        var low = this.view.low;\n        var high = this.view.high;\n        //var range = high - low;\n        var width = this.view.container.width();\n        var w_scale = this.view.resolution_px_b;\n        var resolution = 1 / w_scale;\n\n        // For overview, adjust high, low, resolution, and w_scale.\n        if (this.is_overview) {\n            low = this.view.max_low;\n            high = this.view.max_high;\n            w_scale = width / (this.view.max_high - this.view.max_low);\n            resolution = 1 / w_scale;\n        }\n\n        this.before_draw();\n\n        //\n        // Method for moving and/or removing tiles:\n        // (a) mark all elements for removal using class 'remove'\n        // (b) during tile drawing/placement, remove class for elements that are moved;\n        //     this occurs in show_tile()\n        // (c) after drawing tiles, remove elements still marked for removal\n        //     (i.e. that still have class 'remove').\n        //\n\n        // Step (a) for (re)moving tiles.\n        this.tiles_div.children().addClass(\"remove\");\n\n        var // Tile width in bases.\n            tile_width = Math.floor(TILE_SIZE * resolution);\n\n        var // Index of first tile that overlaps visible region.\n            tile_index = Math.floor(low / tile_width);\n\n        var tile_region;\n        var tile_promise;\n        var tile_promises = [];\n        var tiles = [];\n        // Draw tiles.\n        while (tile_index * tile_width < high) {\n            // Get tile region.\n            tile_region = new visualization.GenomeRegion({\n                chrom: this.view.chrom,\n                start: tile_index * tile_width,\n                // Tile high cannot be larger than view.max_high, which the chromosome length.\n                end: Math.min((tile_index + 1) * tile_width, this.view.max_high)\n            });\n            tile_promise = this.draw_helper(tile_region, w_scale, options);\n            tile_promises.push(tile_promise);\n            $.when(tile_promise).then(tile => {\n                tiles.push(tile);\n            });\n\n            // Go to next tile.\n            tile_index += 1;\n        }\n\n        // Step (c) for (re)moving tiles when clear_after is false.\n        if (!clear_after) {\n            this.tiles_div\n                .children(\".remove\")\n                .removeClass(\"remove\")\n                .remove();\n        }\n\n        // When all tiles are drawn, call post-draw actions.\n        $.when.apply($, tile_promises).then(() => {\n            // Step (c) for (re)moving tiles when clear_after is true:\n            this.tiles_div.children(\".remove\").remove();\n\n            // Only do postdraw actions for tiles; instances where tiles may not be drawn include:\n            // (a) ReferenceTrack without sufficient resolution;\n            // (b) data_fetch = false.\n            tiles = _.filter(tiles, t => t !== null);\n            if (tiles.length !== 0) {\n                this.postdraw_actions(tiles, width, w_scale, clear_after);\n            }\n        });\n    },\n\n    /**\n     * Add a maximum/minimum label to track.\n     */\n    _add_yaxis_label: function(type, on_change) {\n        var css_class = type === \"max\" ? \"top\" : \"bottom\";\n        var text = type === \"max\" ? \"max\" : \"min\";\n        var pref_name = type === \"max\" ? \"max_value\" : \"min_value\";\n        var label = this.container_div.find(`.yaxislabel.${css_class}`);\n        var value = round(this.config.get_value(pref_name), 1);\n\n        // Default action for on_change is to redraw track.\n        on_change =\n            on_change ||\n            (() => {\n                this.request_draw({ clear_tile_cache: true });\n            });\n\n        if (label.length !== 0) {\n            // Label already exists, so update value.\n            label.text(value);\n        } else {\n            // Add label.\n            label = $(\"<div/>\")\n                .text(value)\n                .make_text_editable({\n                    num_cols: 12,\n                    on_finish: function(new_val) {\n                        $(\".tooltip\").remove();\n                        this.config.set_value(pref_name, round(new_val, 1));\n                        on_change();\n                    },\n                    help_text: `Set ${text} value`\n                })\n                .addClass(`yaxislabel ${css_class}`)\n                .css(\"color\", this.config.get_value(\"label_color\"));\n            this.container_div.prepend(label);\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        var line_track_tiles = _.filter(tiles, tile => tile instanceof LineTrackTile);\n\n        //\n        // Take different actions depending on whether there are LineTrack/Coverage tiles.\n        //\n\n        if (line_track_tiles.length > 0) {\n            // -- Drawing in Coverage mode. --\n\n            // Clear because this is set when drawing.\n            this.max_height_px = 0;\n            _.each(tiles, tile => {\n                if (!(tile instanceof LineTrackTile)) {\n                    tile.html_elt.remove();\n                    this.draw_helper(tile.region, w_scale, {\n                        force: true,\n                        mode: \"Coverage\"\n                    });\n                }\n            });\n\n            this._add_yaxis_label(\"max\");\n        } else {\n            // -- Drawing in non-Coverage mode. --\n\n            // Remove Y-axis labels because there are no line track tiles.\n            this.container_div.find(\".yaxislabel\").remove();\n\n            //\n            // If some tiles have icons, set padding of tiles without icons so features and rows align.\n            //\n            var icons_present = _.find(tiles, tile => tile.has_icons);\n\n            if (icons_present) {\n                _.each(tiles, tile => {\n                    if (!tile.has_icons) {\n                        // Need to align with other tile(s) that have icons.\n                        tile.html_elt.css(\"padding-top\", ERROR_PADDING);\n                    }\n                });\n            }\n        }\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function(data) {\n        return this.mode;\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function(display_mode) {\n        // FIXME: needs to be implemented.\n    },\n\n    /**\n     * Returns a list of drawables to draw. Defaults to current track.\n     */\n    _get_drawables: function() {\n        return [this];\n    },\n\n    /**\n     * Retrieves from cache, draws, or sets up drawing for a single tile. Returns either a Tile object or a\n     * jQuery.Deferred object that is fulfilled when tile can be drawn again. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     */\n    draw_helper: function(region, w_scale, options) {\n        // Init options if necessary to avoid having to check if options defined.\n        if (!options) {\n            options = {};\n        }\n\n        var force = options.force;\n        var mode = options.mode || this.mode;\n        var resolution = 1 / w_scale;\n\n        var drawables = this._get_drawables();\n        var key = this._gen_tile_cache_key(w_scale, region);\n\n        var is_tile = o => o && \"track\" in o;\n\n        // Check tile cache, if found show existing tile in correct position\n        var tile = force ? undefined : this.tile_cache.get_elt(key);\n        if (tile) {\n            if (is_tile(tile)) {\n                this.show_tile(tile, w_scale);\n            }\n            return tile;\n        }\n\n        // If not fetching data, nothing more to do because data is needed to draw tile.\n        if (options.data_fetch === false) {\n            return null;\n        }\n\n        // Function that returns data/Deferreds needed to draw tile.\n        var get_tile_data = () => {\n            // HACK: if display mode (mode) is in continuous data modes, data mode must be coverage to get coverage data.\n            var data_mode = _.find(CONTINUOUS_DATA_MODES, m => m === mode) ? \"Coverage\" : mode;\n\n            // Map drawable object to data needed for drawing.\n            var tile_data = _.map(drawables, (\n                d // Get the track data/promise.\n            ) => d.data_manager.get_data(region, data_mode, resolution, this.data_url_extra_params));\n\n            // Get reference data/promise.\n            if (this.view.reference_track) {\n                tile_data.push(\n                    this.view.reference_track.data_manager.get_data(\n                        region,\n                        mode,\n                        resolution,\n                        this.view.reference_track.data_url_extra_params\n                    )\n                );\n            }\n\n            return tile_data;\n        };\n\n        //\n        // When data is available, draw tile.\n        //\n        var tile_drawn = $.Deferred();\n        this.tile_cache.set_elt(key, tile_drawn);\n        $.when.apply($, get_tile_data()).then(() => {\n            var tile_data = get_tile_data();\n            var tracks_data = tile_data;\n            var seq_data;\n\n            // Deferreds may show up here if trying to fetch a subset of data from a superset data chunk\n            // that cannot be subsetted. This may occur if the superset has a message. If there is a\n            // Deferred, try again from the top. NOTE: this condition could (should?) be handled by the\n            // GenomeDataManager in visualization module.\n            if (_.find(tile_data, d => util.is_deferred(d))) {\n                this.tile_cache.set_elt(key, undefined);\n                $.when(this.draw_helper(region, w_scale, options)).then(tile => {\n                    tile_drawn.resolve(tile);\n                });\n                return;\n            }\n\n            // If sequence data is available, subset to get only data in region.\n            if (this.view.reference_track) {\n                seq_data = this.view.reference_track.data_manager.subset_entry(tile_data.pop(), region);\n            }\n\n            // Get drawing modes, heights for all tracks.\n            var drawing_modes = [];\n            var drawing_heights = [];\n\n            _.each(drawables, (d, i) => {\n                var data = tracks_data[i];\n                if (d.mode === \"Auto\") {\n                    d.mode = d.get_mode(data);\n                    d.update_auto_mode(d.mode);\n                }\n                drawing_modes.push(d.mode);\n                drawing_heights.push(d.get_canvas_height(data, d.mode, w_scale, width));\n            });\n\n            var canvas = this.view.canvas_manager.new_canvas();\n            var tile_low = region.get(\"start\");\n            var tile_high = region.get(\"end\");\n            var width = Math.ceil((tile_high - tile_low) * w_scale) + this.left_offset;\n            var height = _.max(drawing_heights);\n            var tile;\n\n            //\n            // Draw all tracks on tile.\n            //\n            canvas.width = width;\n            // Height is specified in options or is the height found above.\n            canvas.height = options.height || height;\n            var ctx = canvas.getContext(\"2d\");\n            ctx.translate(this.left_offset, 0);\n            if (drawables.length > 1) {\n                ctx.globalAlpha = 0.5;\n                ctx.globalCompositeOperation = \"source-over\";\n            }\n            _.each(drawables, (d, i) => {\n                tile = d.draw_tile(tracks_data[i], ctx, drawing_modes[i], region, w_scale, seq_data);\n            });\n\n            // Don't cache, show if no tile.\n            if (tile !== undefined) {\n                this.tile_cache.set_elt(key, tile);\n                this.show_tile(tile, w_scale);\n            }\n\n            tile_drawn.resolve(tile);\n        });\n\n        return tile_drawn;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        return this.visible_height_px;\n    },\n\n    /**\n     * Draw line (bigwig) data onto tile.\n     */\n    _draw_line_track_tile: function(result, ctx, mode, region, w_scale) {\n        // Set min/max if they are not already set.\n        // FIXME: checking for different null/undefined/0 is messy; it would be nice to\n        // standardize this.\n        if ([undefined, null].indexOf(this.config.get_value(\"min_value\")) !== -1) {\n            this.config.set_value(\"min_value\", 0);\n        }\n        if ([undefined, null, 0].indexOf(this.config.get_value(\"max_value\")) !== -1) {\n            this.config.set_value(\"max_value\", _.max(_.map(result.data, d => d[1])) || 0);\n        }\n\n        var canvas = ctx.canvas;\n\n        var painter = new painters.LinePainter(\n            result.data,\n            region.get(\"start\"),\n            region.get(\"end\"),\n            this.config.to_key_value_dict(),\n            mode\n        );\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new LineTrackTile(this, region, w_scale, canvas, result.data);\n    },\n\n    /**\n     * Draw a track tile.\n     * @param result result from server\n     * @param ctx canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale, ref_seq) {},\n\n    /**\n     * Show track tile and perform associated actions. Showing tile may actually move\n     * an existing tile rather than reshowing it.\n     */\n    show_tile: function(tile, w_scale) {\n        var tile_element = tile.html_elt;\n\n        // -- Show/move tile element. --\n\n        tile.predisplay_actions();\n\n        // Position tile element based on current viewport.\n        var left = Math.round((tile.low - (this.is_overview ? this.view.max_low : this.view.low)) * w_scale);\n        if (this.left_offset) {\n            left -= this.left_offset;\n        }\n        tile_element.css(\"left\", left);\n\n        if (tile_element.hasClass(\"remove\")) {\n            // Step (b) for (re)moving tiles. See _draw() function for description of algorithm\n            // for removing tiles.\n            tile_element.removeClass(\"remove\");\n        } else {\n            // Showing new tile.\n            this.tiles_div.append(tile_element);\n        }\n\n        // -- Update track, tile heights based on new tile. --\n\n        tile_element.css(\"height\", \"auto\");\n\n        // Update max height based on current tile's height.\n        // BUG/HACK: tile_element.height() returns a height that is always 2 pixels too big, so\n        // -2 to get the correct height.\n        this.max_height_px = Math.max(this.max_height_px, tile_element.height() - 2);\n\n        // Update height for all tiles based on max height.\n        tile_element\n            .parent()\n            .children()\n            .css(\"height\", `${this.max_height_px}px`);\n\n        // Update track height based on max height and visible height.\n        var track_height = this.max_height_px;\n        if (this.visible_height_px !== 0) {\n            track_height = Math.min(this.max_height_px, this.visible_height_px);\n        }\n        this.tiles_div.css(\"height\", `${track_height}px`);\n    },\n\n    /**\n     * Utility function that creates a label string describing the region and parameters of a track's tool.\n     */\n    tool_region_and_parameters_str: function(region) {\n        var track = this;\n        var region_str = region !== undefined ? region.toString() : \"all\";\n        var param_str = _.values(track.tool.get_inputs_dict()).join(\", \");\n        return ` - region=[${region_str}], parameters=[${param_str}]`;\n    },\n\n    /**\n     * Returns true if data is compatible with a given mode.\n     */\n    data_and_mode_compatible: function(data, mode) {\n        // Only handle modes that user can set.\n        if (mode === \"Auto\") {\n            return true;\n        } else if (mode === \"Coverage\") {\n            // Histogram mode requires bigwig data.\n            return data.dataset_type === \"bigwig\";\n        } else if (data.dataset_type === \"bigwig\" || data.extra_info === \"no_detail\") {\n            // All other modes--Dense, Squish, Pack--require data + details.\n            return false;\n        } else {\n            return true;\n        }\n    },\n\n    /**\n     * Returns true if entry can be subsetted.\n     */\n    can_subset: function(entry) {\n        // Do not subset entries with a message or data with no detail.\n        if (entry.message || entry.extra_info === \"no_detail\") {\n            return false;\n        } else if (entry.dataset_type === \"bigwig\") {\n            // Subset only if data is single-bp resolution.\n            return entry.data[1][0] - entry.data[0][0] === 1;\n        }\n\n        return true;\n    },\n\n    /**\n     * Set up track to receive tool data.\n     */\n    init_for_tool_data: function() {\n        // Set up track to fetch raw data rather than converted data.\n        this.data_manager.set(\"data_type\", \"raw_data\");\n        this.data_query_wait = 1000;\n        this.dataset_check_type = \"state\";\n\n        // FIXME: this is optional and is disabled for now because it creates\n        // additional converter jobs without a clear benefit because indexing\n        // such a small dataset provides little benefit.\n        //\n        // Set up one-time, post-draw to clear tool execution settings.\n        //\n        /*\n        this.normal_postdraw_actions = this.postdraw_actions;\n        this.postdraw_actions = function(tiles, width, w_scale, clear_after) {\n            var self = this;\n\n            // Do normal postdraw init.\n            self.normal_postdraw_actions(tiles, width, w_scale, clear_after);\n\n            // Tool-execution specific post-draw init:\n\n            // Reset dataset check, wait time.\n            self.dataset_check_type = 'converted_datasets_state';\n            self.data_query_wait = DEFAULT_DATA_QUERY_WAIT;\n\n            // Reset data URL when dataset indexing has completed/when not pending.\n            var ss_deferred = new util.ServerStateDeferred({\n                url: self.dataset_state_url,\n                url_params: {dataset_id : self.dataset.id, hda_ldda: self.dataset.get('hda_ldda')},\n                interval: self.data_query_wait,\n                // Set up deferred to check dataset state until it is not pending.\n                success_fn: function(result) { return result !== \"pending\"; }\n            });\n            $.when(ss_deferred.go()).then(function() {\n                // Dataset is indexed, so use converted data.\n                self.data_manager.set('data_type', 'data');\n            });\n\n            // Reset post-draw actions function.\n            self.postdraw_actions = self.normal_postdraw_actions;\n        };\n        */\n    }\n});\n\nvar LabelTrack = function(view, container) {\n    Track.call(this, view, container, {\n        resize: false,\n        header: false\n    });\n    this.container_div.addClass(\"label-track\");\n};\nextend(LabelTrack.prototype, Track.prototype, {\n    init: function() {\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {},\n\n    _draw: function(options) {\n        var view = this.view;\n        var range = view.high - view.low;\n\n        var tickDistance = Math.floor(Math.pow(10, Math.floor(Math.log(range) / Math.log(10))));\n\n        var position = Math.floor(view.low / tickDistance) * tickDistance;\n        var width = this.view.container.width();\n        var new_div = $(\"<div/>\").addClass(\"label-container\");\n        while (position < view.high) {\n            var screenPosition = Math.floor(((position - view.low) / range) * width);\n            new_div.append(\n                $(\"<div/>\")\n                    .addClass(\"pos-label\")\n                    .text(util.commatize(position))\n                    .css({\n                        left: screenPosition\n                    })\n            );\n            position += tickDistance;\n        }\n        this.content_div.children(\":first\").remove();\n        this.content_div.append(new_div);\n    }\n});\n\n// FIXME: Composite tracks have code for showing composite tracks with line tracks and\n// composite tracks with line + feature tracks. It's probably best if different classes\n// are created for each type of composite track.\n\n/**\n * A tiled track composed of multiple other tracks. Composite tracks only work with\n * bigwig data for now.\n */\nvar CompositeTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n\n    // Init drawables; each drawable is a copy so that config/preferences\n    // are independent of each other. Also init left offset.\n    this.drawables = [];\n    if (\"drawables\" in obj_dict) {\n        var drawable;\n        for (var i = 0; i < obj_dict.drawables.length; i++) {\n            drawable = obj_dict.drawables[i];\n            this.drawables[i] = object_from_template(drawable, view, null);\n\n            // Track's left offset is the max of all tracks.\n            if (drawable.left_offset > this.left_offset) {\n                this.left_offset = drawable.left_offset;\n            }\n        }\n        this.enabled = true;\n    }\n\n    // Set all feature tracks to use Coverage mode.\n    _.each(this.drawables, d => {\n        if (d instanceof FeatureTrack || d instanceof ReadTrack) {\n            d.change_mode(\"Coverage\");\n        }\n    });\n\n    this.update_icons();\n\n    // HACK: needed for saving object for now. Need to generalize get_type() to all Drawables and use\n    // that for object type.\n    this.obj_type = \"CompositeTrack\";\n};\n\nextend(CompositeTrack.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 30,\n                hidden: true\n            }\n        ]);\n    },\n\n    action_icons_def: [\n        // Create composite track from group's tracks.\n        {\n            name: \"composite_icon\",\n            title: _l(\"Show individual tracks\"),\n            css_class: \"layers-stack\",\n            on_click_fn: function(track) {\n                $(\".tooltip\").remove();\n                track.show_group();\n            }\n        }\n    ].concat(TiledTrack.prototype.action_icons_def),\n\n    // HACK: CompositeTrack should inherit from DrawableCollection as well.\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: DrawableCollection.prototype.to_dict,\n\n    add_drawable: DrawableCollection.prototype.add_drawable,\n\n    unpack_drawables: DrawableCollection.prototype.unpack_drawables,\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function() {\n        // Propogate visible height to other tracks.\n        var visible_height = this.visible_height_px;\n        _.each(this.drawables, d => {\n            d.visible_height_px = visible_height;\n        });\n        Track.prototype.on_resize.call(this);\n    },\n\n    /**\n     * Change mode for all tracks.\n     */\n    change_mode: function(new_mode) {\n        TiledTrack.prototype.change_mode.call(this, new_mode);\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].change_mode(new_mode);\n        }\n    },\n\n    /**\n     * Initialize component tracks and draw composite track when all components are initialized.\n     */\n    init: function() {\n        // Init components.\n        var init_deferreds = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            init_deferreds.push(this.drawables[i].init());\n        }\n\n        // Draw composite when all tracks available.\n        var track = this;\n        $.when.apply($, init_deferreds).then(() => {\n            track.enabled = true;\n            track.request_draw();\n        });\n    },\n\n    update_icons: function() {\n        // For now, hide filters and tool.\n        this.action_icons.filters_icon.hide();\n        this.action_icons.tools_icon.hide();\n        this.action_icons.param_space_viz_icon.hide();\n    },\n\n    can_draw: Drawable.prototype.can_draw,\n\n    _get_drawables: function() {\n        return this.drawables;\n    },\n\n    /**\n     * Replace this track with group that includes individual tracks.\n     */\n    show_group: function() {\n        // Create group with individual tracks.\n        var group = new DrawableGroup(this.view, this.container, {\n            name: this.config.get_value(\"name\")\n        });\n\n        var track;\n        for (var i = 0; i < this.drawables.length; i++) {\n            track = this.drawables[i];\n            track.update_icons();\n            group.add_drawable(track);\n            track.container = group;\n            group.content_div.append(track.container_div);\n        }\n\n        // Replace track with group.\n        this.container.replace_drawable(this, group, true);\n        group.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions taken before drawing.\n     */\n    before_draw: function() {\n        // FIXME: this is needed only if there are feature tracks in the composite track.\n        // TiledTrack.prototype.before_draw.call(this);\n\n        //\n        // Set min, max for tracks to be largest min, max.\n        //\n\n        // Get smallest min, biggest max.\n        var min = _.min(_.map(this.drawables, d => d.config.get_value(\"min_value\")));\n\n        var max = _.max(_.map(this.drawables, d => d.config.get_value(\"max_value\")));\n\n        this.config.set_value(\"min_value\", min);\n        this.config.set_value(\"max_value\", max);\n\n        // Set all tracks to smallest min, biggest max.\n        _.each(this.drawables, d => {\n            d.config.set_value(\"min_value\", min);\n            d.config.set_value(\"max_value\", max);\n        });\n    },\n\n    /**\n     * Update minimum, maximum for component tracks.\n     */\n    update_all_min_max: function() {\n        var min_value = this.config.get_value(\"min_value\");\n        var max_value = this.config.get_value(\"max_value\");\n        _.each(this.drawables, d => {\n            d.config.set_value(\"min_value\", min_value);\n            d.config.set_value(\"max_value\", max_value);\n        });\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        // All tiles must be the same height in order to draw LineTracks, so redraw tiles as needed.\n        var max_height = -1;\n\n        var i;\n        for (i = 0; i < tiles.length; i++) {\n            var height = tiles[i].html_elt.find(\"canvas\").height();\n            if (height > max_height) {\n                max_height = height;\n            }\n        }\n\n        for (i = 0; i < tiles.length; i++) {\n            var tile = tiles[i];\n            if (tile.html_elt.find(\"canvas\").height() !== max_height) {\n                this.draw_helper(tile.region, w_scale, {\n                    force: true,\n                    height: max_height\n                });\n                tile.html_elt.remove();\n            }\n        }\n\n        // Wrap function so that it can be called without object reference.\n        var track = this;\n\n        var t = () => {\n            track.update_all_min_max();\n        };\n\n        // Add min, max labels.\n        this._add_yaxis_label(\"min\", t);\n        this._add_yaxis_label(\"max\", t);\n    }\n});\n\n/**\n * Displays reference genome data.\n */\nvar ReferenceTrack = function(view) {\n    TiledTrack.call(this, view, { content_div: view.top_labeltrack }, { resize: false, header: false });\n\n    // Use offset to ensure that bases at tile edges are drawn.\n    this.left_offset = view.canvas_manager.char_width_px;\n    this.container_div.addClass(\"reference-track\");\n    this.data_url = `${getAppRoot()}api/genomes/${this.view.dbkey}`;\n    this.data_url_extra_params = { reference: true };\n    this.data_manager = new visualization.GenomeReferenceDataManager({\n        data_url: this.data_url,\n        can_subset: this.can_subset\n    });\n    this.hide_contents();\n};\nextend(ReferenceTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 13,\n                hidden: true\n            }\n        ]);\n    },\n\n    init: function() {\n        this.data_manager.clear();\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {},\n\n    can_draw: Drawable.prototype.can_draw,\n\n    /**\n     * Draws and shows tile if reference data can be displayed; otherwise track is hidden.\n     */\n    draw_helper: function(region, w_scale, options) {\n        var cur_visible = this.tiles_div.is(\":visible\");\n        var new_visible;\n        var tile = null;\n        if (w_scale > this.view.canvas_manager.char_width_px) {\n            this.tiles_div.show();\n            new_visible = true;\n            tile = TiledTrack.prototype.draw_helper.call(this, region, w_scale, options);\n        } else {\n            new_visible = false;\n            this.tiles_div.hide();\n        }\n\n        // NOTE: viewport resizing conceptually belongs in postdraw_actions(), but currently\n        // postdraw_actions is not called when reference track not shown due to no tiles. If\n        // it is moved to postdraw_actions, resize must be called each time because cannot\n        // easily detect showing/hiding.\n\n        // If showing or hiding reference track, resize viewport.\n        if (cur_visible !== new_visible) {\n            this.view.resize_viewport();\n        }\n\n        return tile;\n    },\n\n    can_subset: function(entry) {\n        return true;\n    },\n\n    /**\n     * Draw ReferenceTrack tile.\n     */\n    draw_tile: function(data, ctx, mode, region, w_scale) {\n        // Try to subset data.\n        var subset = this.data_manager.subset_entry(data, region);\n\n        var seq_data = subset.data;\n\n        // Draw sequence data.\n        var canvas = ctx.canvas;\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"center\";\n        for (var c = 0, str_len = seq_data.length; c < str_len; c++) {\n            ctx.fillStyle = this.view.get_base_color(seq_data[c]);\n            ctx.fillText(seq_data[c], Math.floor(c * w_scale), 10);\n        }\n        return new Tile(this, region, w_scale, canvas, subset);\n    }\n});\n\n/**\n * Track displays continuous/numerical data. Track expects position data in 1-based format, i.e. wiggle format.\n */\nvar LineTrack = function(view, container, obj_dict) {\n    this.mode = \"Histogram\";\n    TiledTrack.call(this, view, container, obj_dict);\n    // Need left offset for drawing overlap near tile boundaries.\n    this.left_offset = 30;\n\n    // If server has byte-range support, use BBI data manager to read directly from the BBI file.\n    // FIXME: there should be a flag to wait for this check to complete before loading the track.\n    var self = this;\n    $.when(supportsByteRanges(`${getAppRoot()}datasets/${this.dataset.id}/display`)).then(supportsByteRanges => {\n        if (supportsByteRanges) {\n            self.data_manager = new bbi.BBIDataManager({\n                dataset: self.dataset\n            });\n        }\n    });\n};\n\nextend(LineTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            { key: \"color\", label: \"Color\", type: \"color\" },\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 30,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    // FIXME: can the default behavior be used; right now it breaks during resize.\n    before_draw: function() {},\n\n    /**\n     * Draw track tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n    },\n\n    /**\n     * Subset data only if data is at single-base pair resolution.\n     */\n    can_subset: function(entry) {\n        return entry.data[1][0] - entry.data[0][0] === 1;\n    },\n\n    /**\n     * Add min, max labels.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        // Add min, max labels.\n        this._add_yaxis_label(\"max\");\n        this._add_yaxis_label(\"min\");\n    }\n});\n\n/**\n * Diagonal heatmap for showing interactions data.\n */\nvar DiagonalHeatmapTrack = function(view, container, obj_dict) {\n    this.mode = \"Heatmap\";\n    TiledTrack.call(this, view, container, obj_dict);\n};\n\nextend(DiagonalHeatmapTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Heatmap\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"pos_color\",\n                label: \"Positive Color\",\n                type: \"color\",\n                default_value: \"#FF8C00\"\n            },\n            {\n                key: \"neg_color\",\n                label: \"Negative Color\",\n                type: \"color\",\n                default_value: \"#4169E1\"\n            },\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"int\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"int\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 500,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var track = this;\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                // What does this do?  Is it meant to be attached to some higher scope state object?\n                // var data = result.data;\n            }\n        );\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        // Paint onto canvas.\n        var canvas = ctx.canvas;\n\n        var painter = new painters.DiagonalHeatmapPainter(\n            result.data,\n            region.get(\"start\"),\n            region.get(\"end\"),\n            this.config.to_key_value_dict(),\n            mode\n        );\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new Tile(this, region, w_scale, canvas, result.data);\n    }\n});\n\n/**\n * A track that displays features/regions. Track expects position data in BED format, i.e. 0-based, half-open.\n */\nvar FeatureTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.container_div.addClass(\"feature-track\");\n    this.summary_draw_height = 30;\n    this.slotters = {};\n    this.start_end_dct = {};\n    this.left_offset = 200;\n    this.set_painter_from_config();\n};\n\nextend(FeatureTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"block_color\",\n                label: \"Block color\",\n                type: \"color\"\n            },\n            {\n                key: \"reverse_strand_color\",\n                label: \"Antisense strand color\",\n                type: \"color\"\n            },\n            {\n                key: \"label_color\",\n                label: \"Label color\",\n                type: \"color\",\n                default_value: \"black\"\n            },\n            {\n                key: \"show_counts\",\n                label: \"Show summary counts\",\n                type: \"bool\",\n                default_value: true,\n                help: \"Show the number of items in each bin when drawing summary histogram\"\n            },\n            {\n                key: \"min_value\",\n                label: \"Histogram minimum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"max_value\",\n                label: \"Histogram maximum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"connector_style\",\n                label: \"Connector style\",\n                type: \"select\",\n                default_value: \"fishbones\",\n                options: [\n                    {\n                        label: \"Line with arrows\",\n                        value: \"fishbone\"\n                    },\n                    { label: \"Arcs\", value: \"arcs\" }\n                ]\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.set_painter_from_config();\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    set_painter_from_config: function() {\n        if (this.config.get_value(\"connector_style\") === \"arcs\") {\n            this.painter = painters.ArcLinkedFeaturePainter;\n        } else {\n            this.painter = painters.LinkedFeaturePainter;\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var line_track_tiles = _.filter(tiles, t => t instanceof LineTrackTile);\n\n        //\n        // Finish drawing of features that span multiple tiles. Features that span multiple tiles\n        // are labeled incomplete on the tile level because they cannot be completely drawn.\n        //\n        if (line_track_tiles.length === 0) {\n            // Gather incomplete features together.\n            var all_incomplete_features = {};\n            _.each(_.pluck(tiles, \"incomplete_features\"), inc_features => {\n                _.each(inc_features, feature => {\n                    all_incomplete_features[feature[0]] = feature;\n                });\n            });\n\n            // Draw incomplete features on each tile.\n            _.each(tiles, tile => {\n                // Remove features already drawn on tile originally.\n                var tile_incomplete_features = _.omit(\n                    all_incomplete_features,\n                    _.map(tile.incomplete_features, f => f[0])\n                );\n\n                // Remove features already drawn on tile in past postdraw actions.\n                tile_incomplete_features = _.omit(tile_incomplete_features, _.keys(tile.other_tiles_features_drawn));\n\n                // Draw tile's incomplete features.\n                if (_.size(tile_incomplete_features) !== 0) {\n                    // To draw incomplete features, create new canvas, copy original canvas/tile onto new\n                    // canvas, and then draw incomplete features on the new canvas.\n                    var features = {\n                        data: _.values(tile_incomplete_features)\n                    };\n\n                    var new_canvas = this.view.canvas_manager.new_canvas();\n                    var new_canvas_ctx = new_canvas.getContext(\"2d\");\n                    new_canvas.height = Math.max(\n                        tile.canvas.height,\n                        this.get_canvas_height(features, tile.mode, tile.w_scale, 100)\n                    );\n                    new_canvas.width = tile.canvas.width;\n                    new_canvas_ctx.drawImage(tile.canvas, 0, 0);\n                    new_canvas_ctx.translate(this.left_offset, 0);\n                    var new_tile = this.draw_tile(\n                        features,\n                        new_canvas_ctx,\n                        tile.mode,\n                        tile.region,\n                        tile.w_scale,\n                        tile.seq_data\n                    );\n                    $(tile.canvas).replaceWith($(new_tile.canvas));\n                    tile.canvas = new_canvas;\n                    _.extend(tile.other_tiles_features_drawn, all_incomplete_features);\n                }\n            });\n        }\n\n        // If mode is Coverage and tiles do not share max, redraw tiles as necessary using new max.\n        /*\n        This code isn't used right now because Coverage mode uses predefined max in preferences.\n        if (track.mode === \"Coverage\") {\n            // Get global max.\n            var global_max = -1;\n            for (i = 0; i < tiles.length; i++) {\n                var cur_max = tiles[i].max_val;\n                if (cur_max > global_max) {\n                    global_max = cur_max;\n                }\n            }\n\n            for (i = 0; i < tiles.length; i++) {\n                var tile = tiles[i];\n                if (tile.max_val !== global_max) {\n                    tile.html_elt.remove();\n                    track.draw_helper(tile.index, w_scale, { more_tile_data: { force: true, max: global_max } } );\n                }\n            }\n        }\n        */\n\n        //\n        // Update filter attributes, UI.\n        //\n\n        // Update filtering UI.\n        if (this.filters_manager) {\n            var filters = this.filters_manager.filters;\n            var f;\n            for (f = 0; f < filters.length; f++) {\n                filters[f].update_ui_elt();\n            }\n\n            // Determine if filters are available; this is based on the tiles' data.\n            // Criteria for filter to be available: (a) it is applicable to tile data and (b) filter min != filter max.\n            var filters_available = false;\n\n            var example_feature;\n            var filter;\n            for (let i = 0; i < tiles.length; i++) {\n                if (tiles[i].data.length) {\n                    example_feature = tiles[i].data[0];\n                    for (f = 0; f < filters.length; f++) {\n                        filter = filters[f];\n                        if (filter.applies_to(example_feature) && filter.min !== filter.max) {\n                            filters_available = true;\n                            break;\n                        }\n                    }\n                }\n            }\n\n            // If filter availability changed, hide filter div if necessary and update menu.\n            if (this.filters_available !== filters_available) {\n                this.filters_available = filters_available;\n                if (!this.filters_available) {\n                    this.filters_manager.hide();\n                }\n                this.update_icons();\n            }\n        }\n\n        //\n        // If not all features slotted, show icon for showing more rows (slots).\n        //\n        if (tiles[0] instanceof FeatureTrackTile) {\n            var all_slotted = true;\n            for (let i = 0; i < tiles.length; i++) {\n                if (!tiles[i].all_slotted) {\n                    all_slotted = false;\n                    break;\n                }\n            }\n            this.action_icons.show_more_rows_icon.toggle(!all_slotted);\n        } else {\n            this.action_icons.show_more_rows_icon.hide();\n        }\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function(mode) {\n        if (this.mode === \"Auto\") {\n            if (mode === \"no_detail\") {\n                mode = \"feature spans\";\n            }\n            this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: Auto/${mode})`);\n        }\n    },\n\n    /**\n     * Place features in slots for drawing (i.e. pack features).\n     * this.slotters[level] is created in this method. this.slotters[level]\n     * is a Slotter object. Returns the number of slots used to pack features.\n     */\n    incremental_slots: function(level, features, mode) {\n        // Get/create incremental slots for level. If display mode changed,\n        // need to create new slots.\n\n        var dummy_context = this.view.canvas_manager.dummy_context;\n\n        var slotter = this.slotters[level];\n        if (!slotter || slotter.mode !== mode) {\n            slotter = new slotting.FeatureSlotter(level, mode, MAX_FEATURE_DEPTH, x => dummy_context.measureText(x));\n            this.slotters[level] = slotter;\n        }\n\n        return slotter.slot_features(features);\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function(data) {\n        var mode;\n        // HACK: use no_detail mode track is in overview to prevent overview from being too large.\n        if (data.extra_info === \"no_detail\" || this.is_overview) {\n            mode = \"no_detail\";\n        } else {\n            // Choose b/t Squish and Pack.\n            // Proxy measures for using Squish:\n            // (a) error message re: limiting number of features shown;\n            // (b) X number of features shown;\n            // (c) size of view shown.\n            // TODO: cannot use (a) and (b) because it requires coordinating mode across tiles;\n            // fix this so that tiles are redrawn as necessary to use the same mode.\n            //if ( (result.message && result.message.match(/^Only the first [\\d]+/)) ||\n            //     (result.data && result.data.length > 2000) ||\n            //var data = result.data;\n            // if ( (data.length && data.length < 4) ||\n            //      (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) ) {\n            if (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) {\n                mode = \"Squish\";\n            } else {\n                mode = \"Pack\";\n            }\n        }\n        return mode;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        if (mode === \"Coverage\" || result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // All other modes require slotting.\n            var rows_required = this.incremental_slots(w_scale, result.data, mode);\n            // HACK: use dummy painter to get required height. Painter should be extended so that get_required_height\n            // works as a static function.\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return Math.max(this.min_height_px, dummy_painter.get_required_height(rows_required, canvas_width));\n        }\n    },\n\n    /**\n     * Draw FeatureTrack tile.\n     * @param result result from server\n     * @param cxt canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     * @param cur_tile true if drawing is occurring on a currently visible tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale, ref_seq, cur_tile) {\n        var track = this;\n        var canvas = ctx.canvas;\n        var tile_low = region.get(\"start\");\n        var tile_high = region.get(\"end\");\n        var left_offset = this.left_offset;\n\n        // If data is line track data, draw line track tile.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n        }\n\n        // Handle row-by-row tracks\n\n        // Preprocessing: filter features and determine whether all unfiltered features have been slotted.\n        var filtered = [];\n\n        var slots = this.slotters[w_scale].slots;\n        var all_slotted = true;\n        if (result.data) {\n            var filters = this.filters_manager.filters;\n            for (var i = 0, len = result.data.length; i < len; i++) {\n                var feature = result.data[i];\n                var hide_feature = false;\n                var filter;\n                for (var f = 0, flen = filters.length; f < flen; f++) {\n                    filter = filters[f];\n                    filter.update_attrs(feature);\n                    if (!filter.keep(feature)) {\n                        hide_feature = true;\n                        break;\n                    }\n                }\n                if (!hide_feature) {\n                    // Feature visible.\n                    filtered.push(feature);\n                    // Set flag if not slotted.\n                    if (!(feature[0] in slots)) {\n                        all_slotted = false;\n                    }\n                }\n            }\n        }\n\n        // Create painter.\n        var filter_alpha_scaler = this.filters_manager.alpha_filter\n            ? new FilterScaler(this.filters_manager.alpha_filter)\n            : null;\n\n        var filter_height_scaler = this.filters_manager.height_filter\n            ? new FilterScaler(this.filters_manager.height_filter)\n            : null;\n\n        var painter = new this.painter(\n            filtered,\n            tile_low,\n            tile_high,\n            this.config.to_key_value_dict(),\n            mode,\n            filter_alpha_scaler,\n            filter_height_scaler,\n            // HACK: ref_seq only be defined for ReadTracks, and only the ReadPainter accepts that argument\n            ref_seq,\n            b => track.view.get_base_color(b)\n        );\n\n        var feature_mapper = null;\n        var incomplete_features = null;\n\n        ctx.fillStyle = this.config.get_value(\"block_color\");\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"right\";\n\n        if (result.data) {\n            // Draw features.\n            var draw_results = painter.draw(ctx, canvas.width, canvas.height, w_scale, slots);\n            feature_mapper = draw_results.feature_mapper;\n            incomplete_features = draw_results.incomplete_features;\n            feature_mapper.translation = -left_offset;\n        }\n\n        // If not drawing on current tile, create new tile.\n        if (!cur_tile) {\n            return new FeatureTrackTile(\n                track,\n                region,\n                w_scale,\n                canvas,\n                result.data,\n                mode,\n                result.message,\n                all_slotted,\n                feature_mapper,\n                incomplete_features,\n                ref_seq\n            );\n        }\n    }\n});\n\n/**\n * Displays variant data.\n */\nvar VariantTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.painter = painters.VariantPainter;\n    this.summary_draw_height = 30;\n\n    // Maximum resolution is ~45 pixels/base, so use this size left offset to ensure that full\n    // variant is drawn when variant is at start of tile.\n    this.left_offset = 30;\n};\n\nextend(VariantTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"color\",\n                label: \"Histogram color\",\n                type: \"color\"\n            },\n            {\n                key: \"show_sample_data\",\n                label: \"Show sample data\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"show_labels\",\n                label: \"Show summary and sample labels\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"summary_height\",\n                label: \"Locus summary height\",\n                type: \"float\",\n                default_value: 20\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        // Data could be coverage data or variant data.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, \"Histogram\", region, w_scale);\n        } else {\n            // result.dataset_type === 'variant'\n            var view = this.view;\n\n            var painter = new this.painter(\n                result.data,\n                region.get(\"start\"),\n                region.get(\"end\"),\n                this.config.to_key_value_dict(),\n                mode,\n                b => view.get_base_color(b)\n            );\n\n            painter.draw(ctx, ctx.canvas.width, ctx.canvas.height, w_scale);\n            return new Tile(this, region, w_scale, ctx.canvas, result.data);\n        }\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        if (result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // HACK: sample_names is not be defined when dataset definition is fetched before\n            // dataset is complete (as is done when running tools). In that case, fall back on\n            // # of samples in data. This can be fixed by re-requesting dataset definition\n            // in init.\n            var num_samples = this.dataset.get_metadata(\"sample_names\")\n                ? this.dataset.get_metadata(\"sample_names\").length\n                : 0;\n            if (num_samples === 0 && result.data.length !== 0) {\n                // Sample data is separated by commas, so this computes # of samples:\n                num_samples = result.data[0][7].match(/,/g);\n                if (num_samples === null) {\n                    num_samples = 1;\n                } else {\n                    num_samples = num_samples.length + 1;\n                }\n            }\n\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return dummy_painter.get_required_height(num_samples);\n        }\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var deferreds = [Track.prototype.predraw_init.call(this)];\n        // FIXME: updating dataset metadata is only needed for visual analysis. Can\n        // this be moved somewhere else?\n        if (!this.dataset.get_metadata(\"sample_names\")) {\n            deferreds.push(this.dataset.fetch());\n        }\n        return deferreds;\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var line_track_tiles = _.filter(tiles, t => t instanceof LineTrackTile);\n\n        // Add summary/sample labels if needed and not already included.\n        var sample_names = this.dataset.get_metadata(\"sample_names\");\n        if (\n            line_track_tiles.length === 0 &&\n            this.config.get_value(\"show_labels\") &&\n            sample_names &&\n            sample_names.length > 1\n        ) {\n            var font_size;\n\n            // Add and/or style labels.\n            if (this.container_div.find(\".yaxislabel.variant\").length === 0) {\n                // Add summary and sample labels.\n\n                // Add summary label to middle of summary area.\n                font_size = this.config.get_value(\"summary_height\") / 2;\n                this.tiles_div.prepend(\n                    $(\"<div/>\")\n                        .text(\"Summary\")\n                        .addClass(\"yaxislabel variant top\")\n                        .css({\n                            \"font-size\": `${font_size}px`,\n                            top: `${(this.config.get_value(\"summary_height\") - font_size) / 2}px`\n                        })\n                );\n\n                // Show sample labels.\n                if (this.config.get_value(\"show_sample_data\")) {\n                    var samples_div_html = sample_names.join(\"<br/>\");\n\n                    this.tiles_div.prepend(\n                        $(\"<div/>\")\n                            .html(samples_div_html)\n                            .addClass(\"yaxislabel variant top sample\")\n                            .css({\n                                top: this.config.get_value(\"summary_height\")\n                            })\n                    );\n                }\n            }\n\n            // Style labels.\n\n            // Match sample font size to mode.\n            font_size = `${this.mode === \"Squish\" ? 5 : 10}px`;\n            $(this.tiles_div)\n                .find(\".sample\")\n                .css({\n                    \"font-size\": font_size,\n                    \"line-height\": font_size\n                });\n            // Color labels to preference color.\n            $(this.tiles_div)\n                .find(\".yaxislabel\")\n                .css(\"color\", this.config.get_value(\"label_color\"));\n        } else {\n            // Remove all labels.\n            this.container_div.find(\".yaxislabel.variant\").remove();\n        }\n    }\n});\n\n/**\n * Track that displays mapped reads. Track expects position data in 1-based, closed format, i.e. SAM/BAM format.\n */\nvar ReadTrack = function(view, container, obj_dict) {\n    FeatureTrack.call(this, view, container, obj_dict);\n    this.painter = painters.ReadPainter;\n    this.update_icons();\n};\n\nextend(ReadTrack.prototype, Drawable.prototype, TiledTrack.prototype, FeatureTrack.prototype, {\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"block_color\",\n                label: \"Histogram color\",\n                type: \"color\"\n            },\n            {\n                key: \"detail_block_color\",\n                label: \"Sense strand block color\",\n                type: \"color\",\n                default_value: \"#AAAAAA\"\n            },\n            {\n                key: \"reverse_strand_color\",\n                label: \"Antisense strand block color\",\n                type: \"color\",\n                default_value: \"#DDDDDD\"\n            },\n            {\n                key: \"label_color\",\n                label: \"Label color\",\n                type: \"color\",\n                default_value: \"black\"\n            },\n            {\n                key: \"show_insertions\",\n                label: \"Show insertions\",\n                type: \"bool\",\n                default_value: false\n            },\n            {\n                key: \"show_differences\",\n                label: \"Show differences only\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"show_counts\",\n                label: \"Show summary counts\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"min_value\",\n                label: \"Histogram minimum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"max_value\",\n                label: \"Histogram maximum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    }\n});\n\n/**\n * Objects that can be added to a view.\n */\nvar addable_objects = {\n    CompositeTrack: CompositeTrack,\n    DrawableGroup: DrawableGroup,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    FeatureTrack: FeatureTrack,\n    LineTrack: LineTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    // For backward compatibility, map vcf track to variant.\n    VcfTrack: VariantTrack\n};\n\n/**\n * Create new object from a template. A template can be either an object dictionary or an\n * object itself.\n */\nvar object_from_template = (template, view, container) => {\n    if (\"copy\" in template) {\n        // Template is an object.\n        return template.copy(container);\n    } else {\n        // Template is a dictionary.\n        var drawable_type = template.obj_type;\n        // For backward compatibility:\n        if (!drawable_type) {\n            drawable_type = template.track_type;\n        }\n        return new addable_objects[drawable_type](view, container, template);\n    }\n};\n\nexport default {\n    TracksterView: TracksterView,\n    DrawableGroup: DrawableGroup,\n    LineTrack: LineTrack,\n    FeatureTrack: FeatureTrack,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    CompositeTrack: CompositeTrack,\n    object_from_template: object_from_template\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"tags-display\",class:_vm.tagContainerClasses},[(_vm.linkVisible)?_c('a',{staticClass:\"toggle-link\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toggleTagDisplay($event)}}},[_vm._v(\"\\n        \"+_vm._s(_vm._f(\"localize\")(_vm.linkText))+\"\\n    \")]):_vm._e(),_vm._v(\" \"),(_vm.tagsVisible)?_c('vue-tags-input',{staticClass:\"tags-input tag-area\",attrs:{\"tags\":_vm.tagModels,\"autocomplete-items\":_vm.autocompleteTags,\"disabled\":_vm.disabled,\"placeholder\":_vm._f(\"localize\")('Add Tags'),\"add-on-key\":_vm.triggerKeys},on:{\"before-adding-tag\":_vm.beforeAddingTag,\"before-deleting-tag\":_vm.beforeDeletingTag,\"tags-changed\":_vm.tagsChanged},scopedSlots:_vm._u([{key:\"tag-center\",fn:function(t){return [_c('div',{staticClass:\"tag-name\",on:{\"click\":function($event){return _vm.$emit('tag-click', t.tag)}}},[_vm._v(_vm._s(t.tag.label))])]}}],null,false,4090180873),model:{value:(_vm.tagText),callback:function ($$v) {_vm.tagText=$$v},expression:\"tagText\"}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * The tag model is pretty simple, so this extra file might be overkill, but\n * it's good practice to separate data modeling from data retrieval\n */\n\nimport { keyedColorScheme } from \"utils/color\";\n\nfunction TagModel(props = {}) {\n    this.text = \"\";\n\n    // special handling for name:thing tags\n    if (props.text && props.text.startsWith(\"#\")) {\n        props.text = props.text.replace(\"#\", \"name:\");\n    }\n\n    Object.assign(this, props);\n\n    // Need to do Object.defineProperty instead of a class getter to make\n    // style enumerable for vue-tags-input\n    Object.defineProperty(this, \"style\", {\n        enumerable: true,\n        get: function() {\n            if (this.text.startsWith(\"name:\")) {\n                let { primary, contrasting, darker } = keyedColorScheme(this.text);\n\n                let styles = {\n                    \"background-color\": primary,\n                    color: contrasting,\n                    \"border-color\": darker\n                };\n\n                return Object.keys(styles)\n                    .map(prop => `${prop}: ${styles[prop]}`)\n                    .join(\";\");\n            }\n            return \"\";\n        }\n    });\n\n    // Changes name:foo to #foo\n    Object.defineProperty(this, \"label\", {\n        enumerable: true,\n        get: function() {\n            return this.text.startsWith(\"name:\") ? this.text.replace(\"name:\", \"#\") : this.text;\n        }\n    });\n\n    // valid flag\n    Object.defineProperty(this, \"valid\", {\n        enumerable: false,\n        get: function() {\n            if (!this.text.length) return false;\n            if (this.text == \"name:\") return false;\n            return true;\n        }\n    });\n}\n\nTagModel.prototype.equals = function(otherTag) {\n    return this.text == otherTag.text;\n};\n\nTagModel.prototype.toString = function() {\n    return this.text;\n};\n\n// Public factory\n\nexport function createTag(data) {\n    let props = {};\n    switch (typeof data) {\n        case \"string\":\n            props = { text: data };\n            break;\n        case \"object\":\n            props = Object.assign({}, data);\n            break;\n    }\n    return new TagModel(props);\n}\n\n// Returns tags in \"newTags\" that aren't present in \"existingTags\"\n\nexport const diffTags = (newTags, existingTags) => {\n    let newModels = newTags.map(createTag);\n    let existingModels = existingTags.map(createTag);\n    return newModels.filter(tag => !existingModels.some(st => st.equals(tag)));\n};\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StatelessTags.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StatelessTags.vue?vue&type=script&lang=js&\"","<!-- This is intended to be a stateless UI-only component. All data storage and\nretrieval as well as and specific event handling should be managed from an\nupstream component or environment that is accessed through props and events -->\n\n<template>\n    <div class=\"tags-display\" :class=\"tagContainerClasses\">\n        <a v-if=\"linkVisible\" href=\"#\" class=\"toggle-link\" @click.prevent=\"toggleTagDisplay\">\n            {{ linkText | localize }}\n        </a>\n        <vue-tags-input\n            v-if=\"tagsVisible\"\n            class=\"tags-input tag-area\"\n            v-model=\"tagText\"\n            :tags=\"tagModels\"\n            :autocomplete-items=\"autocompleteTags\"\n            :disabled=\"disabled\"\n            :placeholder=\"'Add Tags' | localize\"\n            :add-on-key=\"triggerKeys\"\n            @before-adding-tag=\"beforeAddingTag\"\n            @before-deleting-tag=\"beforeDeletingTag\"\n            @tags-changed=\"tagsChanged\"\n        >\n            <template slot=\"tag-center\" slot-scope=\"t\">\n                <div class=\"tag-name\" @click=\"$emit('tag-click', t.tag)\">{{ t.tag.label }}</div>\n            </template>\n        </vue-tags-input>\n    </div>\n</template>\n\n<script>\nimport VueTagsInput from \"@johmun/vue-tags-input\";\nimport { createTag } from \"./model\";\n\nexport default {\n    components: {\n        VueTagsInput\n    },\n    props: {\n        value: { type: Array, required: false, default: () => [] },\n        autocompleteItems: { type: Array, required: false, default: () => [] },\n        maxVisibleTags: { type: Number, required: false, default: 5 },\n        useToggleLink: { type: Boolean, required: false, default: true },\n        disabled: { type: Boolean, required: false, default: false }\n    },\n    data() {\n        // initialize toggle value\n        let isClosed = this.useToggleLink && this.value.length > this.maxVisibleTags;\n\n        return {\n            tagText: \"\",\n            tagToggle: !isClosed,\n            triggerKeys: [13, \" \"]\n        };\n    },\n    computed: {\n        tagContainerClasses() {\n            return {\n                disabled: this.disabled\n            };\n        },\n        tagModels() {\n            return this.value.map(createTag);\n        },\n        autocompleteTags() {\n            return this.autocompleteItems.map(createTag);\n        },\n        linkText() {\n            return `${this.tagModels.length} Tags`;\n        },\n        linkVisible() {\n            return this.useToggleLink && this.tagModels.length > this.maxVisibleTags;\n        },\n        tagsVisible() {\n            return this.useToggleLink ? this.tagToggle : true;\n        }\n    },\n    watch: {\n        tagText(newValue) {\n            this.$emit(\"tag-input-changed\", newValue);\n        }\n    },\n    methods: {\n        tagsChanged(newTags) {\n            this.$emit(\"input\", this.pluckLabels(newTags));\n        },\n        pluckLabels(newTags) {\n            return newTags.map(t => createTag(t).toString());\n        },\n        toggleTagDisplay() {\n            this.tagToggle = !this.tagToggle;\n            this.$emit(\"show\", this.tagToggle);\n        },\n        beforeAddingTag($event) {\n            if (!this.emitHookEvent(\"before-adding-tag\", $event)) {\n                let { tag, addTag } = $event;\n                addTag(tag);\n            }\n        },\n        beforeDeletingTag($event) {\n            if (!this.emitHookEvent(\"before-deleting-tag\", $event)) {\n                let { tag, deleteTag } = $event;\n                deleteTag(tag);\n            }\n        },\n        emitHookEvent(eventName, $event) {\n            if (this.hasHandler(eventName)) {\n                this.$emit(eventName, $event);\n                return true;\n            }\n            return false;\n        },\n        hasHandler(eventName) {\n            return Object.keys(this.$listeners).includes(eventName);\n        }\n    }\n};\n</script>\n\n<style lang=\"scss\">\n// Most styling of the tags should happen in here.\n\n@import \"theme/blue\";\n@import \"scss/mixins\";\n\n// Puts a little graphic in place of the text-input\n// when the input is not in focus\n@mixin newTagHoverButton() {\n    .vue-tags-input .ti-tags .ti-new-tag-input-wrapper {\n        input {\n            background-color: transparent;\n        }\n        input:not(:focus) {\n            background: url(\"/static/images/fugue/tag--plus.png\");\n            background-repeat: no-repeat;\n            color: transparent;\n            &::placeholder {\n                color: transparent;\n            }\n        }\n    }\n}\n\n// general style butchering\n@mixin matchBootstrapStyling() {\n    // TODO: actually match the bootstrap button classes in\n    // here either by importing mixins or just using colors\n    // from the boostrap .scss files\n    .vue-tags-input {\n        @include fill();\n        .ti-input {\n            padding: 0;\n            border: none;\n        }\n        .ti-tag {\n            border-radius: 4px;\n            font-size: 0.8rem;\n            font-weight: 400;\n        }\n        &.tag-area {\n            background-color: transparent;\n        }\n    }\n}\n\n// Version of the tags that only allow clicking\n// existing tags instead of the full editing UI\n@mixin forDisplayOnly() {\n    .vue-tags-input {\n        .ti-actions,\n        .ti-new-tag-input-wrapper {\n            display: none;\n        }\n    }\n}\n\n.tags-display {\n    // adds in a graphic in place of the text input\n    @include newTagHoverButton();\n\n    // match bootstrap tag styles/colors\n    @include matchBootstrapStyling();\n\n    // display-only tags\n    &.disabled {\n        @include forDisplayOnly();\n    }\n}\n</style>\n","import { render, staticRenderFns } from \"./StatelessTags.vue?vue&type=template&id=68c0290c&\"\nimport script from \"./StatelessTags.vue?vue&type=script&lang=js&\"\nexport * from \"./StatelessTags.vue?vue&type=script&lang=js&\"\nimport style0 from \"./StatelessTags.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","/**\n * Generates a service object used by the tagging component to save, delete and\n * lookup potential tag options for the autocomplete feature. Standard typeahead\n * debouncing and ajax cancelling functionality is also provided here, though an\n * argument can be made that it more properly belongs in the component that is\n * handling the inputs.\n *\n * TODO: convert the associated python endpoint to a legit json REST service\n */\n\nimport axios from \"axios\";\nimport { createTag } from \"./model\";\nimport { Subject } from \"rxjs\";\nimport { map, filter, debounceTime, switchMap, distinctUntilChanged } from \"rxjs/operators\";\n\nexport class TagService {\n    constructor({ id, itemClass, context, debounceInterval = 150 }) {\n        this.id = id;\n        this.itemClass = itemClass;\n        this.context = context;\n        this.debounceInterval = debounceInterval;\n\n        // Buffer for autocomplete text changes\n        this._searchText = new Subject();\n    }\n\n    /**\n     * Autocomplete observable. Subscribe to this object to get updates to\n     * matching autocomplete results as the autocompleteSearchText property is\n     * changed\n     */\n    get autocompleteOptions() {\n        return this._searchText.pipe(\n            map(txt => txt.replace(\"name:\", \"\")),\n            filter(txt => txt.length),\n            debounceTime(this.debounceInterval),\n            distinctUntilChanged(),\n            switchMap(txt => this.autocomplete(txt))\n        );\n    }\n\n    /**\n     * Set this property to start process of retrieving autocomplete results.\n     */\n    set autocompleteSearchText(txt) {\n        this._searchText.next(txt);\n    }\n\n    /**\n     * Save tag, input can be text string or tag model\n     * @param {string|Tag} tag\n     * @returns Promise yielding new tag model\n     */\n    async save(rawTag) {\n        let { id, itemClass, context } = this;\n        let tag = createTag(rawTag);\n        if (!tag.valid) {\n            throw new Error(\"Invalid tag\");\n        }\n        let url = `/tag/add_tag_async?item_id=${id}&item_class=${itemClass}&context=${context}&new_tag=${tag.text}`;\n        let response = await axios.get(url);\n        if (response.status !== 200) {\n            throw new Error(`Unable to save tag: ${tag}`);\n        }\n        return createTag(tag);\n    }\n\n    /**\n     * Delete tag, input can be text string or tag model\n     * @param {string|Tag} tag\n     * @returns Promise yielding deleted tag model\n     */\n    async delete(rawTag) {\n        let { id, itemClass, context } = this;\n        let tag = createTag(rawTag);\n        let url = `/tag/remove_tag_async?item_id=${id}&item_class=${itemClass}&context=${context}&tag_name=${tag.text}`;\n        let response = await axios.get(url);\n        if (response.status !== 200) {\n            throw new Error(`Unable to delete tag: ${tag}`);\n        }\n        return tag;\n    }\n\n    /**\n     * Looks up autocomplete options based on search text\n     * @param {string} searchText\n     * @returns Promise yielding an array of tag models\n     */\n    async autocomplete(searchText) {\n        let { id, itemClass } = this;\n        let url = `/tag/tag_autocomplete_data?item_id=${id}&item_class=${itemClass}&q=${searchText}`;\n        let response = await axios.get(url);\n        if (response.status !== 200) {\n            throw new Error(`Unable to retrieve autocomplete tags for search string: ${searchText}`);\n        }\n        return parseAutocompleteResults(response.data).map(createTag);\n    }\n}\n\n/**\n * Utility function parser for the archaic result format in the current API. See\n * testData/autocompleteResponse.txt for a sample.\n * @param {string} rawResponse\n */\nexport function parseAutocompleteResults(rawResponse) {\n    return rawResponse\n        .split(\"\\n\")\n        .filter(line => line.includes(\"|\"))\n        .map(line => line.split(\"|\")[0])\n        .filter(label => label.length)\n        .filter(label => label !== \"#Header\");\n}\n","<template>\n    <stateless-tags\n        v-model=\"observedTags\"\n        :disabled=\"disabled\"\n        :autocomplete-items=\"autocompleteItems\"\n        @tag-click=\"onClick\"\n        @tag-input-changed=\"updateTagSearch\"\n        @before-adding-tag=\"beforeAddingTag\"\n        @before-deleting-tag=\"beforeDeletingTag\"\n    />\n</template>\n\n<script>\nimport Vue from \"vue\";\nimport VueRx from \"vue-rx\";\nimport { mapActions } from \"vuex\";\nimport { map } from \"rxjs/operators\";\nimport StatelessTags from \"./StatelessTags\";\nimport { diffTags } from \"./model\";\nimport { TagService } from \"./tagService\";\n\nVue.use(VueRx);\n\nexport default {\n    components: {\n        StatelessTags\n    },\n\n    props: {\n        // initialization value\n        tags: { type: Array, required: false, default: () => [] },\n\n        // data requests go through this object\n        tagService: { type: TagService, required: true },\n\n        // store key, usually a model ID or something like that\n        storeKey: { type: String, required: true },\n\n        // allows user to edit tag list\n        disabled: { type: Boolean, required: false, default: false }\n    },\n\n    computed: {\n        observedTags: {\n            get() {\n                return this.$store.getters.getTagsById(this.storeKey);\n            },\n            set(tags) {\n                this.updateTags({ key: this.storeKey, tags });\n            }\n        }\n    },\n\n    subscriptions() {\n        return {\n            autocompleteItems: this.tagService.autocompleteOptions.pipe(\n                // without the ones we've already selected\n                map(resultTags => diffTags(resultTags, this.tags))\n            )\n        };\n    },\n\n    methods: {\n        onClick(tag) {\n            this.$emit(\"tag-click\", tag);\n        },\n\n        beforeAddingTag({ tag, addTag }) {\n            this.tagService\n                .save(tag)\n                .then(() => addTag(tag))\n                .catch(err => console.warn(\"Unable to save tag\", err));\n        },\n\n        beforeDeletingTag({ tag, deleteTag }) {\n            this.tagService\n                .delete(tag)\n                .then(() => deleteTag(tag))\n                .catch(err => console.warn(\"Unable to delete tag\", err));\n        },\n\n        // Set search value on tag service input proprety and eventually search\n        // results will appear on the tagService.autocompleteOptions observable\n        // object which is subscribed to above\n\n        updateTagSearch(searchTxt) {\n            this.tagService.autocompleteSearchText = searchTxt;\n        },\n\n        ...mapActions([\"updateTags\", \"initializeTags\"])\n    },\n\n    mounted() {\n        this.initializeTags({ key: this.storeKey, tags: this.tags });\n    }\n};\n</script>\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tags.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tags.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Tags.vue?vue&type=template&id=278d6dce&\"\nimport script from \"./Tags.vue?vue&type=script&lang=js&\"\nexport * from \"./Tags.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('stateless-tags',{attrs:{\"disabled\":_vm.disabled,\"autocomplete-items\":_vm.autocompleteItems},on:{\"tag-click\":_vm.onClick,\"tag-input-changed\":_vm.updateTagSearch,\"before-adding-tag\":_vm.beforeAddingTag,\"before-deleting-tag\":_vm.beforeDeletingTag},model:{value:(_vm.observedTags),callback:function ($$v) {_vm.observedTags=$$v},expression:\"observedTags\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { createTag } from \"./model\";\nimport { TagService } from \"./tagService\";\n\n// Some parts of the application save tags by saving model so that\n// it will update other parts of the app, which is a rudimentary way\n// of recreating reactivity, so I expect this will probably die soon\n\nexport class BackboneTagService extends TagService {\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n    }\n\n    async save(rawTag) {\n        let tag = createTag(rawTag);\n        if (!tag.valid) {\n            throw new Error(\"Invalid tag\");\n        }\n\n        // update model\n        let tags = new Set(this.model.attributes.tags);\n        tags.add(tag.text);\n        tags = Array.from(tags);\n\n        await this.model.save({ tags });\n        return tag;\n    }\n\n    async delete(rawTag) {\n        let tag = createTag(rawTag);\n\n        let tags = new Set(this.model.attributes.tags);\n        tags.delete(tag.text);\n        tags = Array.from(tags);\n\n        await this.model.save({ tags });\n        return tag;\n    }\n}\n","/**\n * These functions are for mounting the tag display/editor in non-Vue\n * environments such as the existing python scripts and Backbone views.\n */\n\nimport Tags from \"./Tags\";\nimport { mountVueComponent } from \"utils/mountVueComponent\";\nimport { redirectToUrl } from \"utils/redirect\";\nimport { TagService } from \"./tagService\";\nimport { BackboneTagService } from \"./backboneTagService\";\n\n/**\n * General mount function for the tags that were previously rendered\n * by the tagging_common.mako file\n */\nexport const mountMakoTags = (options = {}, el) => {\n    let { id, itemClass, tags = [], disabled = false, context = \"unspecified\" } = options;\n\n    let propData = {\n        storeKey: `${itemClass}-${id}`,\n        tagService: new TagService({ id, itemClass, context }),\n        tags,\n        disabled\n    };\n\n    let fn = mountVueComponent(Tags);\n    let vm = fn(propData, el);\n    vm.$on(\"tag-click\", makoClickHandler(options, vm));\n    return vm;\n};\n\n/**\n * Generate a click handler for the tags\n *\n * @param {object} options Passed options from mount fn\n */\nconst makoClickHandler = (options, vm) =>\n    function(tag) {\n        if (!tag) {\n            return;\n        }\n\n        let { tagClickFn = \"none\", clickUrl } = options;\n\n        switch (tagClickFn) {\n            // I made this match the existing behavior, but I am not clear on\n            // the reason why this link redirects to a raw json page\n            case \"community_tag_click\":\n                if (undefined !== clickUrl) {\n                    let suffix = tag.value ? `:${tag.value}` : \"\";\n                    let href = `${clickUrl}?f-tags=${tag.text}${suffix}`;\n                    redirectToUrl(href);\n                }\n                break;\n\n            case \"add_tag_to_grid_filter\":\n                vm.$store.dispatch(\"toggleSearchTag\", tag);\n                break;\n        }\n    };\n\n/**\n * Mount function when a backbone model is provided.\n */\nexport const mountModelTags = (options = {}, el) => {\n    let { model, disabled = false, context = \"unspecified\" } = options;\n\n    if (!model) {\n        console.warn(\"Missing model in mountModelTags\");\n        return;\n    }\n\n    let { id, model_class: itemClass, tags = [] } = model.attributes;\n\n    let propData = {\n        storeKey: `${itemClass}-${id}`,\n        tagService: new BackboneTagService({ id, itemClass, context, model }),\n        tags,\n        disabled\n    };\n\n    let fn = mountVueComponent(Tags);\n    return fn(propData, el);\n};\n","// This file exists purely to make unit testing easier\n\nexport function redirectToUrl(url) {\n    window.location = url;\n}\n","// Low level stateless UI component\nexport { default as StatelessTags } from \"./StatelessTags\";\n\n// Implements data storage logic and click event handling\n// This is usually what you'll want to use.\nexport { default as Tags } from \"./Tags\";\n\n// functions for mounting the tag editor in non-Vue environments\nexport { mountMakoTags, mountModelTags } from \"./mounts\";\n","import { setGalaxyInstance } from \"app\";\n\n/**\n * Most of the time, all we do is launch a GalaxyApp with the passed configs\n *\n * @param {string} label\n * @returns {function} Returns a function that accepts the application\n * configuration and returns a galaxy instance.\n */\nexport const defaultAppFactory = (config, label = \"Galaxy\") => {\n    return setGalaxyInstance(GalaxyApp => {\n        let { options, bootstrapped } = config;\n        let app = new GalaxyApp(options, bootstrapped);\n        app.debug(`${label} app`);\n        return app;\n    });\n};\n","// Applies noop to all methods for mock creation\n\nconst doNothing = () => null;\n\nexport const mock = source =>\n    Object.keys(source)\n        .filter(prop => typeof source[prop] == \"function\")\n        .reduce((result, prop) => {\n            result[prop] = doNothing;\n            return result;\n        }, {});\n","/**\n * Diagnostic utility, can be setup to monitor globally assigned resources. For\n * instance if some legacy script set a variable called window.Bob, call\n * installMonitor(\"Bob\"). Then open the chrome console and type\n * toggleGlobalMonitor(\"Bob\", true) to receive console.log messages and a\n * traceroute every time some random script accesses window.Bob or one of its\n * properties.\n */\n\nimport { mock } from \"utils/mock\";\n\n// stores values that are returned when somebody asks for window.Something\nwindow._monitorStorage = window._monitorStorage || {};\n\nexport function installMonitor(globalProp) {\n    // Need to handle the special case of window.Galaxy because\n    // we already install an Object.defineProperty on window.Galaxy\n    // to make the singleton available to legacy scripts\n    if (globalProp == \"Galaxy\") {\n        // handled in singleton\n        return;\n    }\n\n    // watch window.globalProp as a whole with a Object.defineProperty\n    installObjectWatcher(globalProp);\n}\n\nexport function installObjectWatcher(globalProp, getter = null, setter = null) {\n    let label = `window.${globalProp}`;\n    let debug = isPropMonitored(globalProp);\n    let logger = debug ? console : mock(console);\n\n    // Replaces window.Thing with an object definition that forwards\n    // gets and set values to window._monitorStorage\n\n    Object.defineProperty(window, globalProp, {\n        enumerable: true,\n        configurable: false,\n        get() {\n            let val = undefined;\n            logger.groupCollapsed(`${label} read`);\n            logger.trace();\n            try {\n                if (getter) {\n                    val = getter();\n                } else {\n                    val = window._monitorStorage[globalProp];\n                }\n                logger.log(val);\n            } catch (err) {\n                logger.warn(\"Unable to retrieve\");\n                logger.warn(err);\n            }\n            logger.groupEnd();\n            return val;\n        },\n        set(newValue) {\n            logger.groupCollapsed(`${label} write...`, String(newValue));\n            logger.trace();\n            try {\n                if (setter) {\n                    setter(newValue);\n                } else {\n                    window._monitorStorage[globalProp] = newValue;\n                }\n            } catch (err) {\n                logger.log(\"Unable to set value on window facade\");\n                logger.warn(err);\n            }\n            logger.groupEnd();\n        }\n    });\n}\n\n// sets a flag in sessionStorage to install a monitor for the\n// indicated prop on the next page refresh\nexport function toggleGlobalMonitor(prop, bShow = true) {\n    let toggleList = getToggles();\n    if (bShow) {\n        toggleList[prop] = true;\n    } else {\n        if (prop in toggleList) {\n            delete toggleList[prop];\n        }\n    }\n    setToggles(toggleList);\n    return toggleList;\n}\n\n// determines whether specified prop is toggled on or off by the user\nexport function isPropMonitored(prop) {\n    let toggleList = getToggles();\n    return toggleList[prop] == true;\n}\n\n// show list of monitor toggles\nexport function showMonitorToggles() {\n    let toggleList = getToggles();\n    console.log(toggleList);\n}\n\n// retrieve toggle list from the session storage\nfunction getToggles() {\n    let json = sessionStorage.getItem(\"global_monitors\");\n    let existinglist = json ? JSON.parse(json) : {};\n    return existinglist;\n}\n\n// put the toggle list back in session storage\nfunction setToggles(toggleList) {\n    sessionStorage.setItem(\"global_monitors\", JSON.stringify(toggleList));\n}\n\n// Display properties available for monitoring at time of page reload\n// (you can add more during a page-session with installMonitor)\nexport function monitorInit() {\n    let monitoredProps = Object.keys(getToggles());\n\n    console.groupCollapsed(\"monitor init\");\n    console.log(\n        \"The following global properties are monitored because they were setup in the javascript source manually:\",\n        monitoredProps\n    );\n    console.log(\"To toggle messages on/off, type toggleGlobalMonitor('Galaxy', true|false) into the console\");\n    console.log(\"You can set up any other variable by typing installMonitor('a window variable name')\");\n    console.groupEnd();\n\n    // installs monitors from stored list\n    monitoredProps.forEach(installMonitor);\n\n    // makes monitor installation available at console\n    window.installMonitor = installMonitor;\n\n    // Type showMonitoredProperties in developer console to list which\n    // global variables have actually been proxied\n    window.showMonitorToggles = showMonitorToggles;\n\n    // Type toggleGlobalMonitor(\"variableName\", true|false) in\n    // the developer console to enable/disable\n    window.toggleGlobalMonitor = toggleGlobalMonitor;\n}\n","import Raven from \"libs/raven\";\n\n/**\n * Initializes raven/sentry, one of the few functions that should actually be\n * in a global init. Transplanted here from js-app.mako\n *\n * @param {object} config Galaxy configuration object\n */\nexport const initSentry = (galaxy, config) => {\n    console.log(\"initSentry\");\n\n    if (config.sentry) {\n        let { sentry_dsn_public, email } = config.sentry;\n        Raven.config(sentry_dsn_public).install();\n        if (email) {\n            Raven.setUser({ email });\n        }\n    }\n};\n","// Initialize refresh events.\nimport $ from \"jquery\";\n\nexport function initTooltips() {\n    console.log(\"initTooltips\");\n\n    // Tooltips\n    if ($.fn.tooltip) {\n        // Put tooltips below items in panel header so that they do not overlap masthead.\n        $(\".unified-panel-header [title]\").tooltip({ placement: \"bottom\" });\n\n        // default tooltip initialization, it will follow the data-placement tag for tooltip location\n        // and fallback to 'top' if not present\n        $(\"[title]\").tooltip();\n    }\n}\n","import $ from \"jquery\";\n\n// If galaxy_main frame does not exist and link targets galaxy_main,\n// add use_panels=True and set target to self.\nexport function adjustIframeLinks() {\n    console.log(\"adjustIframeLinks\");\n\n    $(\"a\").click(function() {\n        var anchor = $(this);\n        var galaxy_main_exists = window.parent.frames && window.parent.frames.galaxy_main;\n        if (anchor.attr(\"target\") == \"galaxy_main\" && !galaxy_main_exists) {\n            var href = anchor.attr(\"href\");\n            if (href.indexOf(\"?\") == -1) {\n                href += \"?\";\n            } else {\n                href += \"&\";\n            }\n            href += \"use_panels=True\";\n            anchor.attr(\"href\", href);\n            anchor.attr(\"target\", \"_self\");\n        }\n        return anchor;\n    });\n}\n\n/**\n * Adds an identifying class at the document root so that we can tell when we're\n * inside an iframe from inside the css, removing the need for all those\n * pointless conditional checks to apply iframe-only styles.\n */\nexport function addIframeClass() {\n    console.log(\"addIframeClass\");\n    if (window.self !== window.top) {\n        console.log(\">>> We are in an iframe\");\n        document.body.classList.add(\"framed\");\n    }\n}\n","import Webhooks from \"mvc/webhooks\";\nimport Utils from \"utils/utils\";\n\nexport function onloadWebhooks(Galaxy) {\n    console.log(\"onloadWebhooks\");\n\n    if (Galaxy.config.enable_webhooks) {\n        Webhooks.load({\n            type: \"onload\",\n            callback: function(webhooks) {\n                webhooks.each(model => {\n                    var webhook = model.toJSON();\n                    if (webhook.activate && webhook.script) {\n                        Utils.appendScriptStyle(webhook);\n                    }\n                });\n            }\n        });\n    }\n}\n","// Transplanted from \"onload.js\"\n\nimport $ from \"jquery\";\n\nfunction refresh_select2(element) {\n    var select_elt = $(element);\n    var options = {\n        placeholder: \"Click to select\",\n        closeOnSelect: !select_elt.is(\"[MULTIPLE]\"),\n        dropdownAutoWidth: true,\n        containerCssClass: \"select2-minwidth\"\n    };\n    return element.select2(options);\n}\n\n// Replace select box with a text input box + autocomplete.\nexport function replace_big_select_inputs(min_length, max_length, select_elts) {\n    console.log(\"replace_big_select_inputs\");\n\n    // To do replace, the select2 plugin must be loaded.\n    if (!$.fn.select2) {\n        console.warn(\"No select 2\");\n        return;\n    }\n\n    // Set default for min_length and max_length\n    if (min_length === undefined) {\n        min_length = 20;\n    }\n    if (max_length === undefined) {\n        max_length = 3000;\n    }\n\n    select_elts = select_elts || $(\"select\");\n\n    select_elts.each(function() {\n        var select_elt = $(this).not(\"[multiple]\");\n        // Make sure that options is within range.\n        var num_options = select_elt.find(\"option\").length;\n        if (num_options < min_length || num_options > max_length) {\n            return;\n        }\n\n        if (select_elt.hasClass(\"no-autocomplete\")) {\n            return;\n        }\n\n        /* Replaced jQuery.autocomplete with select2, notes:\n         * - multiple selects are supported\n         * - the original element is updated with the value, convert_to_values should not be needed\n         * - events are fired when updating the original element, so refresh_on_change should just work\n         *\n         * - should we still sort dbkey fields here?\n         */\n        refresh_select2(select_elt);\n    });\n}\n","import Tours from \"mvc/tours\";\n\nexport function initTours(Galaxy) {\n    console.log(\"initTours\");\n    Tours.activeGalaxyTourRunner();\n    Galaxy.giveTourWithData = Tours.giveTourWithData;\n}\n","// Previously ran in masthead, moved into standard init\n\nimport Modal from \"mvc/ui/ui-modal\";\n\nexport function initModals(galaxy) {\n    console.log(\"initModals\");\n\n    if (!galaxy.modal) {\n        galaxy.modal = new Modal.View();\n    }\n}\n","/**\n * Entry point view initialization This is a collection of functions that were\n * jammed together in the old onload.js script. I've added a queue so we can\n * extend the initializations externally without creating a new entry point (at\n * least until these are all components)\n *\n * This code should be considered transitional. Soon we will have a real Vue app\n * and it will control the order of initialization based on individual component\n * needs. For now, we need to organize the random scripts that are being printed\n * to the python templates.\n */\n\nimport { combineLatest } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\n\nimport { serverPath } from \"utils/serverPath\";\nimport { defaultAppFactory } from \"./defaultAppFactory\";\nimport { globalInits } from \"./globalInits\";\n\n// observable configs and init queue\nimport { config$ } from \"./loadConfig\";\nimport { initializations$, clearInitQueue } from \"./initQueue\";\n\n/**\n * This is the standard endpoint initialization chain. Configs are loaded, the\n * app is instantiated, then a bunch of initialization scripts are run and\n * passed the new app instance and the configuration variables.\n *\n * @param {string} label Logging identifier\n * @param {function} appFactory Override this parameter with a function matching the\n * signature of defaultAppFactory in the event that you require a custom Galaxy\n * application instance.\n */\nexport function standardInit(label = \"Galaxy\", appFactory = defaultAppFactory) {\n    // register assortment of random javascript inits\n    // which were transplanted from python templates\n    globalInits();\n\n    // waits for configs to stop changing then instantiates Galaxy\n    let galaxy$ = config$.pipe(map(cfg => appFactory(cfg, label)));\n\n    // once config, app and initialization observables have a value then run all\n    // the initialization functions, this will keep running new initialization\n    // functions even if they are registered super-late because combineLatest\n    // will not remake a the existing Galaxy or config objects, it'll just run\n    // the new batch of freshly registered init functions\n    combineLatest(config$, galaxy$, initializations$).subscribe(([config, galaxy, inits]) => {\n        console.groupCollapsed(`runInitializations`, label, serverPath());\n        inits.forEach(fn => fn(galaxy, config));\n        clearInitQueue();\n        console.groupEnd();\n    });\n}\n","/**\n * This is a collection of miscellaneous javascripts that that were previously\n * printed to the page by python templates or just floating around the onload.js\n * file.\n *\n * One day soon, these will all disappear because any functionality they provide\n * will more properly be run inside a lifecycle handler inside of a component.\n */\n\nimport { prependInitialization } from \"../initQueue\";\n\n// specific initialization functions\nimport { monitorInit } from \"utils/installMonitor\";\nimport { initSentry } from \"./initSentry\";\nimport { initTooltips } from \"./initTooltips\";\nimport { adjustIframeLinks, addIframeClass } from \"./iframesAreTerrible\";\nimport { init_refresh_on_change } from \"./init_refresh_on_change\";\nimport { onloadWebhooks } from \"./onloadWebhooks\";\nimport { replace_big_select_inputs } from \"./replace_big_select_inputs\";\nimport { make_popup_menus } from \"ui/popupmenu\";\nimport { initTours } from \"./initTours\";\nimport { initModals } from \"./initModals\";\n\nexport function globalInits() {\n    prependInitialization(\n        monitorInit,\n        initSentry,\n        addIframeClass,\n        adjustIframeLinks,\n        initModals,\n        initTooltips,\n        init_refresh_on_change,\n        () => replace_big_select_inputs(20, 1500),\n        make_popup_menus,\n        initTours,\n        onloadWebhooks\n    );\n}\n","// Bootstrap overwrites .tooltip() method, load it after jquery-ui\n// (which is loaded everywhere via libs/jquery.custom.js)\nimport \"bootstrap\";\nimport \"bootstrap-tour\";\n\n// Galaxy core styles\nimport \"scss/base.scss\";\n\n// Module exports appear as objects on window.config in the browser\nexport { standardInit } from \"./standardInit\";\nexport { initializations$, addInitialization, prependInitialization, clearInitQueue } from \"./initQueue\";\nexport { config$, set as setConfig, get as getConfig, getAppRoot } from \"./loadConfig\";\nexport { getRootFromIndexLink } from \"./getRootFromIndexLink\";\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport DATASET_MODEL from \"mvc/dataset/dataset-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport Utils from \"utils/utils\";\n\n//==============================================================================\n/*\nNotes:\n\nTerminology:\n    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\n\nThis all seems too complex unfortunately:\n\n- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n    decided to merge the contained JSON with the DC element json - making the 'has a'\n    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n    DRY in both models and views, but may make tracking or tracing within these models\n    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n    or DatasetCollections (nested)). This also violates the rule of thumb about\n    favoring aggregation over inheritance.\n- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n    These each should a) be usable on their own, b) be usable in the context of\n    nesting within a collection model (at least in the case of ListPaired), and\n    c) be usable within the context of other container models (like History or\n    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n    handle those three situations, but it's proven difficult to do in a simple,\n    readable manner.\n- Ideally, histories and libraries would inherit from the same server models as\n    dataset collections do since they are (in essence) dataset collections themselves -\n    making the whole nested structure simpler. This would be a large, error-prone\n    refactoring and migration.\n\nMany of the classes and heirarchy are meant as extension points so, while the\nrelations and flow may be difficult to understand initially, they'll allow us to\nhandle the growth or flux dataset collection in the future (w/o actually implementing\nany YAGNI).\n\n*/\n//_________________________________________________________________________________________________ ELEMENTS\n/** @class mixin for Dataset collection elements.\n *      When collection elements are passed from the API, the underlying element is\n *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n *          effectively changing a DCE from a container to a subclass (has a --> is a).\n */\nvar DatasetCollectionElementMixin = {\n    /** default attributes used by elements in a dataset collection */\n    defaults: {\n        model_class: \"DatasetCollectionElement\",\n        element_identifier: null,\n        element_index: null,\n        element_type: null\n    },\n\n    /** merge the attributes of the sub-object 'object' into this model */\n    _mergeObject: function(attributes) {\n        // Don't let the dataset ID replace the DCE's ID so record it as the\n        // element_id and when fetching dataset details below use the element_id\n        // instead of this.id.\n        const object = attributes.object;\n        let elementId = this.elementId;\n        if (object) {\n            elementId = attributes.object.id;\n            delete attributes.object.id;\n        }\n        _.extend(attributes, attributes.object, {\n            element_id: elementId\n        });\n        delete attributes.object;\n        return attributes;\n    },\n\n    /** override to merge this.object into this */\n    constructor: function(attributes, options) {\n        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n        attributes = this._mergeObject(attributes);\n        this.idAttribute = \"element_id\";\n        Backbone.Model.apply(this, arguments);\n    },\n\n    /** when the model is fetched, merge this.object into this */\n    parse: function(response, options) {\n        var attributes = response;\n        attributes = this._mergeObject(attributes);\n        return attributes;\n    }\n};\n\n/** @class Concrete class of Generic DatasetCollectionElement */\nvar DatasetCollectionElement = Backbone.Model.extend(BASE_MVC.LoggableMixin)\n    .extend(DatasetCollectionElementMixin)\n    .extend({ _logNamespace: \"collections\" });\n\n//==============================================================================\n/** @class Base/Abstract Backbone collection for Generic DCEs - \n    current may be associated with a dataset (DatasetDCECollection)\n    or another collection (NestedDCDCECollection).\n*/\nvar DCECollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends DCECollection.prototype */ {\n        _logNamespace: \"collections\",\n\n        model: DatasetCollectionElement,\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetCollectionElementCollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n */\nvar DatasetDCE = DATASET_MODEL.DatasetAssociation.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends DatasetDCE.prototype */ {\n            /** url fn */\n            url: function() {\n                // won't always be an hda\n                if (!this.has(\"history_id\")) {\n                    console.warn(\"no endpoint for non-hdas within a collection yet\");\n                    // (a little silly since this api endpoint *also* points at hdas)\n                    return `${getAppRoot()}api/datasets`;\n                }\n                const datasetId = this._getDatasetId();\n                const url = `${getAppRoot()}api/histories/${this.get(\"history_id\")}/contents/${datasetId}`;\n                return url;\n            },\n\n            _getDatasetId: function() {\n                // I'm a DCE acting as dataset, this URL needs to be the dataset URL so\n                // use element_id instead of id. See note above in _mergeObject and\n                // discussion on #3782 for more context.\n                return this.get(\"element_id\");\n            },\n\n            defaults: _.extend(\n                {},\n                DATASET_MODEL.DatasetAssociation.prototype.defaults,\n                DatasetCollectionElementMixin.defaults\n            ),\n\n            _downloadQueryParameters: function() {\n                // Setting the file extension to just 'data' defers that\n                // decision to the serverside, setting based on the datatype.\n                var fileExt = this.get(\"file_ext\") || \"data\";\n                var elementIdentifier = this.get(\"element_identifier\");\n                var parentHdcaId = this.get(\"parent_hdca_id\");\n                return `?to_ext=${fileExt}&hdca_id=${parentHdcaId}&element_identifier=${elementIdentifier}`;\n            },\n\n            // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n            //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n            //  - re-apply manually for now\n            /** call the mixin constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t DatasetDCE.constructor:\", attributes, options);\n                //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** Does this model already contain detailed data (as opposed to just summary level data)? */\n            hasDetails: function() {\n                return this.elements && this.elements.length;\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.get(\"element_identifier\");\n                return `DatasetDCE(${objStr})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n */\nvar DatasetDCECollection = DCECollection.extend(\n    /** @lends DatasetDCECollection.prototype */ {\n        model: DatasetDCE,\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetDCECollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//_________________________________________________________________________________________________ COLLECTIONS\n/** @class Backbone model for Dataset Collections.\n *      The DC API returns an array of JSON objects under the attribute elements.\n *      This model:\n *          - removes that array/attribute ('elements') from the model,\n *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n *          - passes that json onto the bbone collection\n *          - caches the bbone collection in this.elements\n */\nvar DatasetCollection = Backbone.Model.extend(BASE_MVC.LoggableMixin)\n    .extend(BASE_MVC.SearchableModelMixin)\n    .extend(\n        /** @lends DatasetCollection.prototype */ {\n            _logNamespace: \"collections\",\n\n            /** default attributes for a model */\n            defaults: {\n                /* 'list', 'paired', or 'list:paired' */\n                collection_type: null,\n                //??\n                deleted: false\n            },\n\n            /** Which class to use for elements */\n            collectionClass: function() {\n                if (this.attributes.collection_type.indexOf(\":\") > 0) {\n                    return NestedDCDCECollection;\n                } else {\n                    return DatasetDCECollection;\n                }\n            },\n\n            /** set up: create elements instance var and (on changes to elements) update them  */\n            initialize: function(model, options) {\n                this.debug(`${this}(DatasetCollection).initialize:`, model, options, this);\n                this.elements = this._createElementsModel();\n                this.on(\"change:elements\", function() {\n                    this.log(\"change:elements\");\n                    //TODO: prob. better to update the collection instead of re-creating it\n                    this.elements = this._createElementsModel();\n                });\n            },\n\n            /** move elements model attribute to full collection */\n            _createElementsModel: function() {\n                var collectionClass = this.collectionClass();\n                this.debug(`${this}._createElementsModel`, collectionClass, this.get(\"elements\"), this.elements);\n                //TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n                var elements = this.get(\"elements\") || [];\n                this.unset(\"elements\", { silent: true });\n                var parentHdcaId = this.get(\"parent_hdca_id\") || this.get(\"id\");\n                _.each(elements, (element, index) => {\n                    _.extend(element, {\n                        parent_hdca_id: parentHdcaId\n                    });\n                });\n                this.elements = new collectionClass(elements);\n                //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n                return this.elements;\n            },\n\n            // ........................................................................ common queries\n            /** pass the elements back within the model json when this is serialized */\n            toJSON: function() {\n                var json = Backbone.Model.prototype.toJSON.call(this);\n                if (this.elements) {\n                    json.elements = this.elements.toJSON();\n                }\n                return json;\n            },\n\n            /** Is this collection in a 'ready' state no processing (for the collection) is left\n             *  to do on the server.\n             */\n            inReadyState: function() {\n                var populated = this.get(\"populated\");\n                return this.isDeletedOrPurged() || populated;\n            },\n\n            //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n            /** Does the DC contain any elements yet? Is a fetch() required? */\n            hasDetails: function() {\n                return this.elements.length !== 0;\n            },\n\n            /** Given the filters, what models in this.elements would be returned? */\n            getVisibleContents: function(filters) {\n                // filters unused for now\n                return this.elements;\n            },\n\n            // ........................................................................ ajax\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** save this collection, _Mark_ing it as deleted (just a flag) */\n            delete: function(recursive, purge, options) {\n                recursive = recursive || false;\n                purge = purge || false;\n                if (this.get(\"deleted\")) {\n                    return $.when();\n                }\n                options = Utils.merge(options, { method: \"delete\" });\n                return this.save({ deleted: true, recursive: recursive, purge: purge }, options);\n            },\n            /** save this collection, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\")) {\n                    return $.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** Is this collection deleted or purged? */\n            isDeletedOrPurged: function() {\n                return this.get(\"deleted\") || this.get(\"purged\");\n            },\n\n            // ........................................................................ searchable\n            /** searchable attributes for collections */\n            searchAttributes: [\"name\", \"tags\"],\n\n            // ........................................................................ misc\n            /** String representation */\n            toString: function() {\n                var idAndName = [this.get(\"id\"), this.get(\"name\") || this.get(\"element_identifier\")];\n                return `DatasetCollection(${idAndName.join(\",\")})`;\n            }\n        }\n    );\n\n//_________________________________________________________________________________________________ NESTED COLLECTIONS\n// this is where things get weird, man. Weird.\n//TODO: it might be possible to compact all the following...I think.\n//==============================================================================\n/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n *      (a nested collection).\n */\nvar NestedDCDCE = DatasetCollection.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends NestedDCDCE.prototype */ {\n            // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n            //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n            //  - re-apply manually it now\n            /** call the mixin constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t NestedDCDCE.constructor:\", attributes, options);\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.object ? `${this.object}` : this.get(\"element_identifier\");\n                return [\"NestedDCDCE(\", objStr, \")\"].join(\"\");\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n */\nvar NestedDCDCECollection = DCECollection.extend(\n    /** @lends NestedDCDCECollection.prototype */ {\n        /** This is a collection of nested collections */\n        model: NestedDCDCE,\n\n        /** String representation. */\n        toString: function() {\n            return [\"NestedDCDCECollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DatasetCollection: DatasetCollection\n};\n","import _ from \"underscore\";\nimport DC_MODEL from \"mvc/collection/collection-model\";\nimport HISTORY_CONTENT from \"mvc/history/history-content-model\";\n\n/*==============================================================================\n\nModels for DatasetCollections contained within a history.\n\n==============================================================================*/\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n\nvar DC = DC_MODEL.DatasetCollection;\n\n//==============================================================================\n/** @class Backbone model for List Dataset Collection within a History.\n */\nvar HistoryDatasetCollection = DC.extend(hcontentMixin).extend(\n    /** @lends HistoryDatasetCollection.prototype */ {\n        defaults: _.extend(_.clone(DC.prototype.defaults), {\n            history_content_type: \"dataset_collection\",\n            model_class: \"HistoryDatasetCollectionAssociation\"\n        }),\n\n        //==============================================================================\n        /** Override to post to contents route w/o id. */\n        save: function(attributes, options) {\n            if (this.isNew()) {\n                options = options || {};\n                options.url = `${this.urlRoot + this.get(\"history_id\")}/contents`;\n                attributes = attributes || {};\n                attributes.type = \"dataset_collection\";\n            }\n            return DC.prototype.save.call(this, attributes, options);\n        },\n\n        /** String representation. */\n        toString: function() {\n            return `History${DC.prototype.toString.call(this)}`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    HistoryDatasetCollection: HistoryDatasetCollection\n};\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport Utils from \"utils/utils\";\n\nconst Webhooks = Backbone.Collection.extend({\n    url: function() {\n        return `${getAppRoot()}api/webhooks`;\n    }\n});\n\nconst WebhookView = Backbone.View.extend({\n    el: \"#webhook-view\",\n\n    initialize: function(options) {\n        const toolId = options.toolId || \"\";\n        const toolVersion = options.toolVersion || \"\";\n\n        this.$el.attr(\"tool_id\", toolId);\n        this.$el.attr(\"tool_version\", toolVersion);\n\n        const webhooks = new Webhooks();\n        webhooks.fetch({\n            success: data => {\n                if (options.type) {\n                    data.reset(filterType(data, options.type));\n                }\n                if (data.length > 0) {\n                    this.render(weightedRandomPick(data));\n                }\n            }\n        });\n    },\n\n    render: function(model) {\n        const webhook = model.toJSON();\n        this.$el.html(`<div id=\"${webhook.id}\"></div>`);\n        Utils.appendScriptStyle(webhook);\n        return this;\n    }\n});\n\nconst load = options => {\n    const webhooks = new Webhooks();\n    webhooks.fetch({\n        async: options.async !== undefined ? options.async : true,\n        success: data => {\n            if (options.type) {\n                data.reset(filterType(data, options.type));\n            }\n            options.callback(data);\n        }\n    });\n};\n\nfunction filterType(data, type) {\n    return data.models.filter(item => {\n        let itype = item.get(\"type\");\n        if (itype) {\n            return itype.indexOf(type) !== -1;\n        } else {\n            return false;\n        }\n    });\n}\n\nfunction weightedRandomPick(data) {\n    const weights = data.pluck(\"weight\");\n    const sum = weights.reduce((a, b) => a + b);\n\n    const normalizedWeightsMap = new Map();\n    weights.forEach((weight, index) => {\n        normalizedWeightsMap.set(index, parseFloat((weight / sum).toFixed(2)));\n    });\n\n    const table = [];\n    for (const [index, weight] of normalizedWeightsMap) {\n        for (let i = 0; i < weight * 100; i++) {\n            table.push(index);\n        }\n    }\n\n    return data.at(table[Math.floor(Math.random() * table.length)]);\n}\n\nexport default {\n    WebhookView: WebhookView,\n    load: load\n};\n","import $ from \"jquery\";\n\n//=============================================================================\n/** @class AjaxQueue\n *  Class that allows queueing functions that return jQuery promises (such\n *  as ajax calls). Each function waits for the previous to complete before\n *  being called\n *\n *  @constructor accepts a list of functions and automatically begins\n *      processing them\n */\nclass AjaxQueue {\n    constructor(initialFunctions) {\n        /** the main deferred for the entire queue - note: also sends notifications of progress */\n        this.deferred = $.Deferred();\n        /** the queue array of functions */\n        this.queue = [];\n        /** cache the response from each deferred call - error or success */\n        this.responses = [];\n        /** total number of fn's to process */\n        this.numToProcess = 0;\n        /** is the queue processing/waiting for any calls to return? */\n        this.running = false;\n\n        this.init(initialFunctions || []);\n        this.start();\n    }\n\n    /** add all fns in initialFunctions (if any) to the queue */\n    init(initialFunctions) {\n        initialFunctions.forEach(fn => {\n            this.add(fn);\n        });\n    }\n\n    add(fn) {\n        var index = this.queue.length;\n        this.numToProcess += 1;\n\n        this.queue.push(() => {\n            var fnIndex = index;\n            var xhr = fn();\n            // if successful, notify using the deferred to allow tracking progress\n            xhr.done(response => {\n                this.deferred.notify({\n                    curr: fnIndex,\n                    total: this.numToProcess,\n                    response: response\n                });\n            });\n            // (regardless of previous error or success) if not last ajax call, shift and call the next\n            //  if last fn, resolve deferred\n            xhr.always(response => {\n                this.responses.push(response);\n                if (this.queue.length) {\n                    this.queue.shift()();\n                } else {\n                    this.stop();\n                }\n            });\n        });\n        return this;\n    }\n\n    start() {\n        if (this.queue.length) {\n            this.running = true;\n            this.queue.shift()();\n        }\n        return this;\n    }\n\n    /** stop the queue\n     *  @param {boolean} causeFail  cause an error/fail on the main deferred\n     *  @param {String} msg         message to send when rejecting the main deferred\n     */\n    stop(causeFail, msg) {\n        //TODO: doesn't abort current call\n        this.running = false;\n        this.queue = [];\n        if (causeFail) {\n            //TODO: spliced args instead\n            this.deferred.reject(msg);\n        } else {\n            this.deferred.resolve(this.responses);\n        }\n        this.numToProcess = 0;\n        this.deferred = $.Deferred();\n        return this;\n    }\n\n    // only a handful of the deferred interface for now - possible YAGNI\n    /** implement done from the jq deferred interface */\n    done(fn) {\n        return this.deferred.done(fn);\n    }\n\n    /** implement fail from the jq deferred interface */\n    fail(fn) {\n        return this.deferred.fail(fn);\n    }\n\n    /** implement always from the jq deferred interface */\n    always(fn) {\n        return this.deferred.always(fn);\n    }\n\n    /** implement progress from the jq deferred interface */\n    progress(fn) {\n        return this.deferred.progress(fn);\n    }\n\n    /** shortcut constructor / fire and forget\n     *  @returns {Deferred} the queue's main deferred\n     */\n    static create(initialFunctions) {\n        return new AjaxQueue(initialFunctions).deferred;\n    }\n}\n\n//=============================================================================\n/** @class NamedAjaxQueue\n *  @augments AjaxQueue\n *  Allows associating a name with a deferring fn and prevents adding deferring\n *  fns if the name has already been used. Useful to prevent build up of duplicate\n *  async calls.\n *  Both the array initialFunctions sent to constructor and any added later with\n *  add() should be objects (NOT functions) of the form:\n *  { name: some unique id,\n *    fn:   the deferring fn or ajax call }\n */\nclass NamedAjaxQueue extends AjaxQueue {\n    constructor(initialFunctions) {\n        super(initialFunctions);\n        this.names = {};\n    }\n\n    /** add the obj.fn to the queue if obj.name hasn't been used before */\n    add(obj) {\n        if (!(obj.hasOwnProperty(\"name\") && obj.hasOwnProperty(\"fn\"))) {\n            throw new Error(`NamedAjaxQueue.add requires an object with both \"name\" and \"fn\": ${JSON.stringify(obj)}`);\n        }\n        if (this.names.hasOwnProperty(obj.name)) {\n            //console.warn( 'name has been used:', obj.name );\n            return;\n        }\n        this.names[obj.name] = true;\n        return super.add(obj.fn);\n    }\n\n    clear() {\n        this.names = {};\n        return this;\n    }\n\n    /** shortcut constructor / fire and forget\n     *  @returns {Deferred} the queue's main deferred\n     */\n    static create(initialFunctions) {\n        return new NamedAjaxQueue(initialFunctions).deferred;\n    }\n}\n\n//=============================================================================\nexport default {\n    AjaxQueue: AjaxQueue,\n    NamedAjaxQueue: NamedAjaxQueue\n};\n","import Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n */\nvar User = Backbone.Model.extend(baseMVC.LoggableMixin).extend(\n    /** @lends User.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** API location for this resource */\n        urlRoot: function() {\n            return `${getAppRoot()}api/users`;\n        },\n\n        /** Model defaults\n         *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n         *      a safer method is if( !user.get( 'email' ) ) -> anon user\n         */\n        defaults: /** @lends User.prototype */ {\n            id: null,\n            username: `(${_l(\"anonymous user\")})`,\n            email: \"\",\n            total_disk_usage: 0,\n            nice_total_disk_usage: \"\",\n            quota_percent: null,\n            is_admin: false,\n            preferences: {}\n        },\n\n        /** Set up and bind events\n         *  @param {Object} data Initial model data.\n         */\n        initialize: function(data) {\n            this.log(\"User.initialize:\", data);\n\n            this.on(\"loaded\", function(model, resp) {\n                this.log(`${this} has loaded:`, model, resp);\n            });\n            this.on(\"change\", function(model, data) {\n                this.log(`${this} has changed:`, model, data.changes);\n            });\n        },\n\n        isAnonymous: function() {\n            return !this.get(\"email\");\n        },\n\n        isAdmin: function() {\n            return this.get(\"is_admin\");\n        },\n\n        updatePreferences: function(name, new_value) {\n            let preferences = this.get(\"preferences\");\n            preferences[name] = JSON.stringify(new_value);\n            this.preferences = preferences;\n        },\n\n        getFavorites: function() {\n            let preferences = this.get(\"preferences\");\n            if (preferences && preferences.favorites) {\n                return JSON.parse(preferences.favorites);\n            } else {\n                return {\n                    tools: []\n                };\n            }\n        },\n\n        updateFavorites: function(object_type, new_favorites) {\n            let favorites = this.getFavorites();\n            favorites[object_type] = new_favorites[object_type];\n            this.updatePreferences(\"favorites\", favorites);\n        },\n\n        /** Load a user with the API using an id.\n         *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n         *      (e.g. 'current') and the API will return the current transaction's user data.\n         *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n         *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n         *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n         */\n        loadFromApi: function(idOrCurrent, options) {\n            idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n            options = options || {};\n            var model = this;\n            var userFn = options.success;\n\n            /** @ignore */\n            options.success = (newModel, response) => {\n                model.trigger(\"loaded\", newModel, response);\n                if (userFn) {\n                    userFn(newModel, response);\n                }\n            };\n\n            // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n            if (idOrCurrent === User.CURRENT_ID_STR) {\n                options.url = `${this.urlRoot}/${User.CURRENT_ID_STR}`;\n            }\n            return Backbone.Model.prototype.fetch.call(this, options);\n        },\n\n        /** Clears all data from the sessionStorage.\n         */\n        clearSessionStorage: function() {\n            for (var key in sessionStorage) {\n                //TODO: store these under the user key so we don't have to do this\n                // currently only history\n                if (key.indexOf(\"history:\") === 0) {\n                    sessionStorage.removeItem(key);\n                } else if (key === \"history-panel\") {\n                    sessionStorage.removeItem(key);\n                }\n            }\n        },\n\n        /** string representation */\n        toString: function() {\n            var userInfo = [this.get(\"username\")];\n            if (this.get(\"id\")) {\n                userInfo.unshift(this.get(\"id\"));\n                userInfo.push(this.get(\"email\"));\n            }\n            return `User(${userInfo.join(\":\")})`;\n        }\n    }\n);\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = \"current\";\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = options => {\n    var currentUser = new User();\n    currentUser.loadFromApi(User.CURRENT_ID_STR, options);\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\n//var UserCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n//    model: User,\n//    urlRoot: function() {\n//        return `${getAppRoot()}api/users`;\n//    }\n//    //logger  : console,\n//});\n\n//==============================================================================\nexport default {\n    User: User\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport userModel from \"mvc/user/user-model\";\nimport metricsLogger from \"utils/metrics-logger\";\nimport addLogging from \"utils/add-logging\";\nimport localize from \"utils/localization\";\nimport { getGalaxyInstance } from \"app\";\n\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nexport function GalaxyApp(options = {}, bootstrapped = {}) {\n    // console.warn(\"GalaxyApp constructor\", serverPath());\n    this._init(options, bootstrapped);\n}\n\n// add logging shortcuts for this object\naddLogging(GalaxyApp, \"GalaxyApp\");\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = \"galaxy:debug\";\n\nvar NAMESPACE_KEY = `${DEBUGGING_KEY}:namespaces`;\nvar FLATTEN_LOG_MESSAGES_KEY = `${DEBUGGING_KEY}:flatten`;\n\nvar localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem(DEBUGGING_KEY) == \"true\";\n} catch (storageErr) {\n    console.log(localize(\"localStorage not available for debug flag retrieval\"));\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function(options, bootstrapped) {\n    var self = this;\n    _.extend(self, Backbone.Events);\n    if (localDebugging) {\n        self.logger = console;\n        console.debug(\"debugging galaxy:\", \"options:\", options, \"bootstrapped:\", bootstrapped);\n    }\n\n    self._processOptions(options);\n    self._initConfig(options.config || {});\n\n    // Patch if this galaxy instance is replacing an existing one\n    // _patchGalaxy depends on options.patchExisting\n    // TODO: rethink this behavior\n    let existingGalaxy = getGalaxyInstance();\n    if (existingGalaxy) {\n        self._patchGalaxy(existingGalaxy);\n    }\n\n    // add root and url parameters\n    self.root = options.root || \"/\";\n    self.params = options.params || {};\n    self.session_csrf_token = options.session_csrf_token || null;\n\n    self._initLogger(self.options.loggerOptions || {});\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug(\"GalaxyApp.options: \", self.options);\n    self.debug(\"GalaxyApp.config: \", self.config);\n    self.debug(\"GalaxyApp.logger: \", self.logger);\n\n    self._initLocale();\n    self.debug(\"GalaxyApp.localize: \", self.localize);\n\n    self.config = options.config || {};\n    self.debug(\"GalaxyApp.config: \", self.config);\n\n    self._initUser(options.user || {});\n    self.debug(\"GalaxyApp.user: \", self.user);\n\n    self._initUserLocale();\n    self.debug(\"currentLocale: \", sessionStorage.getItem(\"currentLocale\"));\n\n    self._setUpListeners();\n    self.trigger(\"ready\", self);\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing Galaxy object? */\n    patchExisting: true,\n    /** root url of this app */\n    root: \"/\",\n    session_csrf_token: null\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions(options) {\n    var self = this;\n    var defaults = self.defaultOptions;\n\n    self.options = {};\n    for (var k in defaults) {\n        if (defaults.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig(config) {\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n// TODO: Remove this behavior when we can, it is kind of non-intuitive\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if (self.options.patchExisting && patchWith) {\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for (var k in patchWith) {\n            if (patchWith.hasOwnProperty(k)) {\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[k] = patchWith[k];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if (self.config.debug) {\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(\",\");\n        } catch (storageErr) {\n            console.debug(storageErr);\n        }\n        try {\n            loggerOptions.consoleFlattenMessages = localStorage.getItem(FLATTEN_LOG_MESSAGES_KEY) == \"true\";\n        } catch (storageErr) {\n            console.debug(storageErr);\n        }\n        console.log(loggerOptions.consoleFlattenMessages);\n    }\n\n    self.logger = new metricsLogger.MetricsLogger(loggerOptions);\n    self.emit = {};\n    [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"].map(i => {\n        self.emit[i] = function(data) {\n            self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n        };\n    });\n\n    if (self.config.debug) {\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        BASE_MVC.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale(options) {\n    var self = this;\n    self.debug(\"_initLocale:\", options);\n    self.localize = localize;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initUserLocale = function _initUserLocale(options) {\n    var self = this;\n\n    // Choose best locale\n    var global_locale = self.config.default_locale ? self.config.default_locale.toLowerCase() : false;\n\n    var extra_user_preferences = {};\n    if (self.user && self.user.attributes.preferences && \"extra_user_preferences\" in self.user.attributes.preferences) {\n        extra_user_preferences = JSON.parse(self.user.attributes.preferences.extra_user_preferences);\n    }\n\n    var user_locale =\n        \"localization|locale\" in extra_user_preferences\n            ? extra_user_preferences[\"localization|locale\"].toLowerCase()\n            : false;\n\n    if (user_locale == \"auto\") {\n        user_locale = false;\n    }\n\n    var nav_locale =\n        typeof navigator === \"undefined\"\n            ? \"__root\"\n            : (navigator.language || navigator.userLanguage || \"__root\").toLowerCase();\n\n    let locale = user_locale || global_locale || nav_locale;\n\n    sessionStorage.setItem(\"currentLocale\", locale);\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser(userJSON) {\n    var self = this;\n    self.debug(\"_initUser:\", userJSON);\n    self.user = new userModel.User(userJSON);\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $(document).bind(\"ajaxSend\", (ev, xhr, options) => {\n        var data = options.data;\n        try {\n            data = JSON.parse(data);\n        } catch (err) {\n            // data isn't JSON, skip.\n        }\n\n        self.lastAjax = {\n            url: location.href.slice(0, -1) + options.url,\n            data: data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging(setting) {\n    var self = this;\n    try {\n        if (setting === undefined) {\n            return localStorage.getItem(DEBUGGING_KEY) === \"true\";\n        }\n        if (setting) {\n            localStorage.setItem(DEBUGGING_KEY, true);\n            return true;\n        }\n\n        localStorage.removeItem(DEBUGGING_KEY);\n        // also remove all namespaces\n        self.debuggingNamespaces(null);\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug flag retrieval\"));\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n    var self = this;\n    try {\n        if (namespaces === undefined) {\n            var csv = localStorage.getItem(NAMESPACE_KEY);\n            return typeof csv === \"string\" ? csv.split(\",\") : [];\n        } else if (namespaces === null) {\n            localStorage.removeItem(NAMESPACE_KEY);\n        } else {\n            localStorage.setItem(NAMESPACE_KEY, namespaces);\n        }\n        var newSettings = self.debuggingNamespaces();\n        if (self.logger) {\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug namespace retrieval\"));\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString() {\n    var userEmail = this.user ? this.user.get(\"email\") || \"(anonymous)\" : \"uninitialized\";\n    return `GalaxyApp(${userEmail})`;\n};\n\n// ============================================================================\nexport default {\n    GalaxyApp: GalaxyApp\n};\n","/**\n * TODO: Make this part of galaxy.js later, once the global refs are gone\n */\n\nimport addLogging from \"utils/add-logging\";\nimport { GalaxyApp } from \"./galaxy\";\nimport { serverPath } from \"utils/serverPath\";\n\nexport function setGalaxyInstance(factory) {\n    console.warn(\"setGalaxyInstance\", serverPath());\n\n    let storage = getStorage();\n    let newInstance = factory(GalaxyApp);\n    if (!(newInstance instanceof GalaxyApp)) {\n        newInstance = new GalaxyApp(newInstance);\n    }\n    if (newInstance.debug === undefined) {\n        addLogging(newInstance, \"GalaxyApp\");\n    }\n\n    storage._galaxyInstance = newInstance;\n\n    return storage._galaxyInstance;\n}\n\nexport function getGalaxyInstance() {\n    let storage = getStorage();\n    return storage._galaxyInstance;\n}\n\nexport function galaxyIsInitialized() {\n    let instance = getGalaxyInstance();\n    return instance !== null;\n}\n\n// Having a CORS issue in the toolshed iframe, store separate versions\n// of galaxy in each window for the short-term\nexport function getStorage() {\n    return window;\n}\n","// Initializes \"training wheels\" causing legacy references to window.Galaxy to\n// pass through the singleton accessors. All future code should access galaxy\n// through getGalaxyInstance, and rarely with setGalaxyInstance\n\nimport { getGalaxyInstance, setGalaxyInstance } from \"app\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { serverPath } from \"utils/serverPath\";\n\nconst galaxyStub = {\n    root: getAppRoot(),\n    config: {}\n};\n\nif (!window.Galaxy) {\n    Object.defineProperty(window, \"Galaxy\", {\n        enumerable: true,\n        get: function() {\n            console.warn(\"accessing (get) window.Galaxy\", serverPath());\n            return getGalaxyInstance() || galaxyStub;\n        },\n        set: function(newValue) {\n            console.warn(\"accessing (set) window.Galaxy\", serverPath());\n            setGalaxyInstance(newValue);\n        }\n    });\n} else {\n    console.error(\"Detected redefinition of window.Galaxy -- skipping, but this should be investigated.\", serverPath());\n}\n\nexport default window.Galaxy;\n","export { setGalaxyInstance, getGalaxyInstance } from \"./singleton\";\nexport { default as galaxyFacade } from \"./monitor\";\n","import MODAL from \"mvc/ui/ui-modal\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport _l from \"utils/localization\";\nimport _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport { getGalaxyInstance } from \"app\";\n\nvar $ = jQuery;\n\n//==============================================================================\n/**\n * A dialog/modal that allows copying a user history or 'importing' from user\n * another. Generally called via historyCopyDialog below.\n * @type {Object}\n */\nvar CopyDialog = {\n    // language related strings/fns\n    defaultName: _.template(\"Copy of '<%- name %>'\"),\n    title: _.template(`${_l(\"Copying history\")} \"<%- name %>\"`),\n    submitLabel: _l(\"Copy\"),\n    errorMessage: _l(\"History could not be copied.\"),\n    progressive: _l(\"Copying history\"),\n    activeLabel: _l(\"Copy only the active, non-deleted datasets\"),\n    allLabel: _l(\"Copy all datasets including deleted ones\"),\n    anonWarning:\n        _l(\"As an anonymous user, unless you login or register, you will lose your current history \") +\n        _l(\"after copying this history. \"),\n\n    // template for modal body\n    _template: _.template(\n        [\n            //TODO: remove inline styles\n            // show a warning message for losing current to anon users\n            \"<% if( isAnon ){ %>\",\n            '<div class=\"warningmessage\">',\n            \"<%- anonWarning %>\",\n            _l(\"You can\"),\n            ' <a href=\"/user/login\">',\n            _l(\"login here\"),\n            \"</a> \",\n            _l(\"or\"),\n            \" \",\n            ' <a href=\"/user/create\">',\n            _l(\"register here\"),\n            \"</a>.\",\n            \"</div>\",\n            \"<% } %>\",\n            \"<form>\",\n            '<label for=\"copy-modal-title\">',\n            _l(\"Enter a title for the new history\"),\n            \":\",\n            \"</label><br />\",\n            // TODO: could use required here and the form validators\n            // NOTE: use unescaped here if escaped in the modal function below\n            '<input id=\"copy-modal-title\" class=\"form-control\" style=\"width: 100%\" value=\"<%= name %>\" />',\n            '<p class=\"invalid-title bg-danger\" style=\"color: red; margin: 8px 0px 8px 0px; display: none\">',\n            _l(\"Please enter a valid history title\"),\n            \"</p>\",\n            // if allowAll, add the option to copy deleted datasets, too\n            \"<% if( allowAll ){ %>\",\n            \"<br />\",\n            \"<p>\",\n            _l(\"Choose which datasets from the original history to include:\"),\n            \"</p>\",\n            // copy non-deleted is the default\n            '<input name=\"copy-what\" type=\"radio\" id=\"copy-non-deleted\" value=\"copy-non-deleted\" ',\n            '<% if( copyWhat === \"copy-non-deleted\" ){ print( \"checked\" ); } %>/>',\n            '<label for=\"copy-non-deleted\"> <%- activeLabel %></label>',\n            \"<br />\",\n            '<input name=\"copy-what\" type=\"radio\" id=\"copy-all\" value=\"copy-all\" ',\n            '<% if( copyWhat === \"copy-all\" ){ print( \"checked\" ); } %>/>',\n            '<label for=\"copy-all\"> <%- allLabel %></label>',\n            \"<% } %>\",\n            \"</form>\"\n        ].join(\"\")\n    ),\n\n    // empty modal body and let the user know the copy is happening\n    _showAjaxIndicator: function _showAjaxIndicator() {\n        var indicator = `<p><span class=\"fa fa-spinner fa-spin\"></span> ${this.progressive}...</p>`;\n        this.modal\n            .$(\".modal-body\")\n            .empty()\n            .append(indicator)\n            .css({ \"margin-top\": \"8px\" });\n    },\n\n    // (sorta) public interface - display the modal, render the form, and potentially copy the history\n    // returns a jQuery.Deferred done->history copied, fail->user cancelled\n    dialog: function _dialog(modal, history, options) {\n        options = options || {};\n\n        var dialog = this;\n        var deferred = jQuery.Deferred();\n\n        var // TODO: getting a little byzantine here\n            defaultCopyNameFn = options.nameFn || this.defaultName;\n\n        var defaultCopyName = defaultCopyNameFn({\n            name: history.get(\"name\")\n        });\n\n        var // TODO: these two might be simpler as one 3 state option (all,active,no-choice)\n            defaultCopyWhat = options.allDatasets ? \"copy-all\" : \"copy-non-deleted\";\n\n        var allowAll = !_.isUndefined(options.allowAll) ? options.allowAll : true;\n\n        var autoClose = !_.isUndefined(options.autoClose) ? options.autoClose : true;\n\n        this.modal = modal;\n\n        // validate the name and copy if good\n        function checkNameAndCopy() {\n            var name = modal.$(\"#copy-modal-title\").val();\n            if (!name) {\n                modal.$(\".invalid-title\").show();\n                return;\n            }\n            // get further settings, shut down and indicate the ajax call, then hide and resolve/reject\n            var copyAllDatasets = modal.$('input[name=\"copy-what\"]:checked').val() === \"copy-all\";\n            modal.$(\"button\").prop(\"disabled\", true);\n            dialog._showAjaxIndicator();\n            history\n                .copy(true, name, copyAllDatasets)\n                .done(response => {\n                    deferred.resolve(response);\n                })\n                .fail(function(xhr, status, message) {\n                    var options = {\n                        name: name,\n                        copyAllDatasets: copyAllDatasets\n                    };\n                    ERROR_MODAL.ajaxErrorModal(history, xhr, options, dialog.errorMessage);\n                    deferred.rejectWith(deferred, arguments);\n                })\n                .done(() => {\n                    if (autoClose) {\n                        modal.hide();\n                    }\n                });\n        }\n\n        var originalClosingCallback = options.closing_callback;\n        let Galaxy = getGalaxyInstance();\n        modal.show(\n            _.extend(options, {\n                title: this.title({ name: history.get(\"name\") }),\n                body: $(\n                    dialog._template({\n                        name: defaultCopyName,\n                        isAnon: Galaxy.user.isAnonymous(),\n                        allowAll: allowAll,\n                        copyWhat: defaultCopyWhat,\n                        activeLabel: this.activeLabel,\n                        allLabel: this.allLabel,\n                        anonWarning: this.anonWarning\n                    })\n                ),\n                buttons: _.object([\n                    [\n                        _l(\"Cancel\"),\n                        () => {\n                            modal.hide();\n                        }\n                    ],\n                    [this.submitLabel, checkNameAndCopy]\n                ]),\n                height: \"auto\",\n                closing_events: true,\n                closing_callback: function _historyCopyClose(cancelled) {\n                    if (cancelled) {\n                        deferred.reject({ cancelled: true });\n                    }\n                    if (originalClosingCallback) {\n                        originalClosingCallback(cancelled);\n                    }\n                }\n            })\n        );\n\n        // set the default dataset copy, autofocus the title, and set up for a simple return\n        modal\n            .$(\"#copy-modal-title\")\n            .focus()\n            .select();\n        modal.$(\"#copy-modal-title\").on(\"keydown\", ev => {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                checkNameAndCopy();\n            }\n        });\n\n        return deferred;\n    }\n};\n\n//==============================================================================\n// maintain the (slight) distinction between copy and import\n/**\n * Subclass CopyDialog to use the import language.\n */\nvar ImportDialog = _.extend({}, CopyDialog, {\n    defaultName: _.template(\"imported: <%- name %>\"),\n    title: _.template(`${_l(\"Importing history\")} \"<%- name %>\"`),\n    submitLabel: _l(\"Import\"),\n    errorMessage: _l(\"History could not be imported.\"),\n    progressive: _l(\"Importing history\"),\n    activeLabel: _l(\"Import only the active, non-deleted datasets\"),\n    allLabel: _l(\"Import all datasets including deleted ones\"),\n    anonWarning:\n        _l(\"As an anonymous user, unless you login or register, you will lose your current history \") +\n        _l(\"after importing this history. \")\n});\n\n//==============================================================================\n/**\n * Main interface for both history import and history copy dialogs.\n * @param  {Backbone.Model} history     the history to copy\n * @param  {Object}         options     a hash\n * @return {jQuery.Deferred}            promise that fails on close and succeeds on copy\n *\n * options:\n *     (this object is also passed to the modal used to display the dialog and accepts modal options)\n *     {Function} nameFn    if defined, use this to build the default name shown to the user\n *                          (the fn is passed: {name: <original history's name>})\n *     {bool} useImport     if true, use the 'import' language (instead of Copy)\n *     {bool} allowAll      if true, allow the user to choose between copying all datasets and\n *                          only non-deleted datasets\n *     {String} allDatasets default initial checked radio button: 'copy-all' or 'copy-non-deleted',\n */\nvar historyCopyDialog = (history, options) => {\n    let Galaxy = getGalaxyInstance();\n    options = options || {};\n    // create our own modal if Galaxy doesn't have one (mako tab without use_panels)\n    var modal = Galaxy.modal || new MODAL.View({});\n    return options.useImport\n        ? ImportDialog.dialog(modal, history, options)\n        : CopyDialog.dialog(modal, history, options);\n};\n\n//==============================================================================\nexport default historyCopyDialog;\n","import _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport pyre from \"pyre-to-regexp\";\n\nconst NEW_COLUMN = \"new\";\n\nconst multiColumnsToString = function(targetColumns, colHeaders) {\n    if (targetColumns.length == 0) {\n        return `no columns`;\n    } else if (targetColumns.length == 1) {\n        return `column ${colHeaders[targetColumns[0]]}`;\n    } else {\n        const targetHeaders = targetColumns.map(el => colHeaders[el]);\n        // https://stackoverflow.com/questions/16251822/array-to-comma-separated-string-and-for-last-tag-use-the-and-instead-of-comma\n        return `columns ${[targetHeaders.slice(0, -1).join(\", \"), targetHeaders.slice(-1)[0]].join(\" and \")}`;\n    }\n};\n\nconst removeColumns = function(columns, targetColumns) {\n    const newColumns = [];\n    for (let index in columns) {\n        if (targetColumns.indexOf(index) === -1) {\n            newColumns.push(columns[index]);\n        }\n    }\n    return newColumns;\n};\n\nconst applyRegex = function(regex, target, data, replacement, groupCount) {\n    let regExp;\n    try {\n        regExp = pyre(String(regex));\n    } catch (error) {\n        return { error: `Invalid regular expression specified.` };\n    }\n    let failedCount = 0;\n    function newRow(row) {\n        const source = row[target];\n        const match = regExp.exec(source);\n        if (!match) {\n            failedCount++;\n            return null;\n        }\n        if (!replacement) {\n            groupCount = groupCount && parseInt(groupCount);\n            if (groupCount) {\n                if (match.length != groupCount + 1) {\n                    failedCount++;\n                    return null;\n                }\n                return row.concat(match.splice(1, match.length));\n            } else {\n                return row.concat([match[0]]);\n            }\n        } else {\n            return row.concat([regExp.pyreReplace(match[0], replacement)]);\n        }\n    }\n    data = data.map(newRow);\n    if (failedCount > 0) {\n        return { error: `${failedCount} row(s) failed to match specified regular expression.` };\n    }\n    return { data };\n};\n\nconst flatMap = (f, xs) => {\n    return xs.reduce((acc, x) => acc.concat(f(x)), []);\n};\n\nconst RULES = {\n    add_column_basename: {\n        title: _l(\"Basename of Path of URL\"),\n        display: (rule, colHeaders) => {\n            return `Add column using basename of column ${colHeaders[rule.target_column]}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnBasenameTarget = 0;\n            } else {\n                component.addColumnBasenameTarget = rule.target_column;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addColumnBasenameTarget;\n        },\n        apply: (rule, data, sources, columns) => {\n            // https://github.com/kgryte/regex-basename-posix/blob/master/lib/index.js\n            //const re = /^(?:\\/?|)(?:[\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(?:\\.[^.\\/]*|))(?:[\\/]*)$/;\n            // https://stackoverflow.com/questions/8376525/get-value-of-a-string-after-a-slash-in-javascript\n            const re = \"[^/]*$\";\n            const target = rule.target_column;\n            const rval = applyRegex(re, target, data);\n            columns.push(NEW_COLUMN);\n            rval.columns = columns;\n            return rval;\n        }\n    },\n    add_column_rownum: {\n        title: _l(\"Row Number\"),\n        display: (rule, colHeaders) => {\n            return `Add column for the current row number.`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnRownumStart = 1;\n            } else {\n                component.addColumnRownumStart = rule.start;\n            }\n        },\n        save: (component, rule) => {\n            rule.start = parseInt(component.addColumnRownumStart);\n        },\n        apply: (rule, data, sources, columns) => {\n            let rownum = rule.start;\n            function newRow(row) {\n                const newRow = row.slice();\n                newRow.push(String(rownum));\n                rownum += 1;\n                return newRow;\n            }\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data, columns };\n        }\n    },\n    add_column_value: {\n        title: _l(\"Fixed Value\"),\n        display: (rule, colHeaders) => {\n            return `Add column for the constant value of ${rule.value}.`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnValue = \"\";\n            } else {\n                component.addColumnValue = rule.value;\n            }\n        },\n        save: (component, rule) => {\n            rule.value = component.addColumnValue;\n        },\n        apply: (rule, data, sources, columns) => {\n            const addValue = rule.value;\n            function newRow(row) {\n                const newRow = row.slice();\n                newRow.push(addValue);\n                return newRow;\n            }\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data, columns };\n        }\n    },\n    add_column_metadata: {\n        title: _l(\"Add Column from Metadata\"),\n        display: (rule, colHeaders) => {\n            return `Add column for ${rule.value}.`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnMetadataValue = null;\n            } else {\n                component.addColumnMetadataValue = rule.value;\n            }\n        },\n        save: (component, rule) => {\n            rule.value = component.addColumnMetadataValue;\n        },\n        apply: (rule, data, sources, columns) => {\n            const ruleValue = rule.value;\n            let newRow;\n            if (ruleValue.indexOf(\"identifier\") == 0) {\n                const identifierIndex = parseInt(ruleValue.substring(\"identifier\".length));\n                newRow = (row, index) => {\n                    const newRow = row.slice();\n                    newRow.push(sources[index][\"identifiers\"][identifierIndex]);\n                    return newRow;\n                };\n            } else if (ruleValue == \"tags\") {\n                newRow = (row, index) => {\n                    const newRow = row.slice();\n                    const tags = sources[index][\"tags\"];\n                    tags.sort();\n                    newRow.push(tags.join(\",\"));\n                    return newRow;\n                };\n            } else if (ruleValue == \"hid\" || ruleValue == \"name\" || ruleValue == \"path\") {\n                newRow = (row, index) => {\n                    const newRow = row.slice();\n                    newRow.push(sources[index][ruleValue]);\n                    return newRow;\n                };\n            } else {\n                return { error: `Unknown metadata type [${ruleValue}}]` };\n            }\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data, columns };\n        }\n    },\n    add_column_group_tag_value: {\n        title: _l(\"Add Column from Group Tag Value\"),\n        display: (rule, colHeaders) => {\n            return `Add column for value of group tag ${rule.value}.`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnGroupTagValueValue = null;\n                component.addColumnGroupTagValueDefault = \"\";\n            } else {\n                component.addColumnGroupTagValueValue = rule.value;\n                component.addColumnGroupTagValueDefault = rule.default_value;\n            }\n        },\n        save: (component, rule) => {\n            rule.value = component.addColumnGroupTagValueValue;\n            rule.default_value = component.addColumnGroupTagValueDefault;\n        },\n        apply: (rule, data, sources, columns) => {\n            const ruleValue = rule.value;\n            const groupTagPrefix = `group:${ruleValue}:`;\n            const newRow = (row, index) => {\n                const newRow = row.slice();\n                const tags = sources[index][\"tags\"];\n                tags.sort();\n                let groupTagValue = rule.default_value;\n                for (let index in tags) {\n                    const tag = tags[index];\n                    if (tag.indexOf(groupTagPrefix) == 0) {\n                        groupTagValue = tag.substr(groupTagPrefix.length);\n                        break;\n                    }\n                }\n                newRow.push(groupTagValue);\n                return newRow;\n            };\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data, columns };\n        }\n    },\n    add_column_regex: {\n        title: _l(\"Using a Regular Expression\"),\n        display: (rule, colHeaders) => {\n            return `Add new column using ${rule.expression} applied to column ${colHeaders[rule.target_column]}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnRegexTarget = 0;\n                component.addColumnRegexExpression = \"\";\n                component.addColumnRegexReplacement = null;\n                component.addColumnRegexGroupCount = null;\n            } else {\n                component.addColumnRegexTarget = rule.target_column;\n                component.addColumnRegexExpression = rule.expression;\n                component.addColumnRegexReplacement = rule.replacement;\n                component.addColumnRegexGroupCount = rule.group_count;\n            }\n            let addColumnRegexType = \"global\";\n            if (component.addColumnRegexGroupCount) {\n                addColumnRegexType = \"groups\";\n            } else if (component.addColumnRegexReplacement) {\n                addColumnRegexType = \"replacement\";\n            }\n            component.addColumnRegexType = addColumnRegexType;\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addColumnRegexTarget;\n            rule.expression = component.addColumnRegexExpression;\n            if (component.addColumnRegexReplacement) {\n                rule.replacement = component.addColumnRegexReplacement;\n            }\n            if (component.addColumnRegexGroupCount) {\n                rule.group_count = component.addColumnRegexGroupCount;\n            }\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const rval = applyRegex(rule.expression, target, data, rule.replacement, rule.group_count);\n            columns.push(NEW_COLUMN);\n            rval.columns = columns;\n            return rval;\n        }\n    },\n    add_column_concatenate: {\n        title: _l(\"Concatenate Columns\"),\n        display: (rule, colHeaders) => {\n            return `Concatenate column ${colHeaders[rule.target_column_0]} and column ${\n                colHeaders[rule.target_column_1]\n            }`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnConcatenateTarget0 = 0;\n                component.addColumnConcatenateTarget1 = 0;\n            } else {\n                component.addColumnConcatenateTarget0 = rule.target_column_0;\n                component.addColumnConcatenateTarget1 = rule.target_column_1;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column_0 = component.addColumnConcatenateTarget0;\n            rule.target_column_1 = component.addColumnConcatenateTarget1;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target0 = rule.target_column_0;\n            const target1 = rule.target_column_1;\n            function newRow(row) {\n                const newRow = row.slice();\n                newRow.push(row[target0] + row[target1]);\n                return newRow;\n            }\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data, columns };\n        }\n    },\n    add_column_substr: {\n        title: _l(\"Keep or Trim Prefix or Suffix\"),\n        display: (rule, colHeaders) => {\n            const type = rule.substr_type;\n            let display;\n            if (type == \"keep_prefix\") {\n                display = `Keep only ${rule.length} characters from the start of column ${\n                    colHeaders[rule.target_column]\n                }`;\n            } else if (type == \"drop_prefix\") {\n                display = `Remove ${rule.length} characters from the start of column ${colHeaders[rule.target_column]}`;\n            } else if (type == \"keep_suffix\") {\n                display = `Keep only ${rule.length} characters from the end of column ${\n                    colHeaders[rule.target_column]\n                }`;\n            } else {\n                display = `Remove ${rule.length} characters from the end of column ${colHeaders[rule.target_column]}`;\n            }\n            return display;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addColumnSubstrTarget = 0;\n                component.addColumnSubstrType = \"keep_prefix\";\n                component.addColumnSubstrLength = 1;\n            } else {\n                component.addColumnSubstrTarget = rule.target_column;\n                component.addColumnSubstrLength = rule.length;\n                component.addColumnSubstrType = rule.substr_type;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addColumnSubstrTarget;\n            rule.length = parseInt(component.addColumnSubstrLength);\n            rule.substr_type = component.addColumnSubstrType;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const length = rule.length;\n            const type = rule.substr_type;\n            function newRow(row) {\n                const newRow = row.slice();\n                const originalValue = row[target];\n                let start = 0,\n                    end = originalValue.length;\n                if (type == \"keep_prefix\") {\n                    end = length;\n                } else if (type == \"drop_prefix\") {\n                    start = length;\n                } else if (type == \"keep_suffix\") {\n                    start = end - length;\n                    if (start < 0) {\n                        start = 0;\n                    }\n                } else {\n                    end = end - length;\n                    if (end < 0) {\n                        end = 0;\n                    }\n                }\n                newRow.push(originalValue.substr(start, end));\n                return newRow;\n            }\n            data = data.map(newRow);\n            columns.push(NEW_COLUMN);\n            return { data };\n        }\n    },\n    remove_columns: {\n        title: _l(\"Remove Column(s)\"),\n        display: (rule, colHeaders) => {\n            const targetColumns = rule.target_columns;\n            return `Remove ${multiColumnsToString(targetColumns, colHeaders)}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.removeColumnTargets = [];\n            } else {\n                component.removeColumnTargets = rule.target_columns;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_columns = component.removeColumnTargets;\n        },\n        apply: (rule, data, sources, columns) => {\n            const targets = rule.target_columns;\n            function newRow(row) {\n                const newRow = [];\n                for (let index in row) {\n                    if (targets.indexOf(parseInt(index)) == -1) {\n                        newRow.push(row[index]);\n                    }\n                }\n                return newRow;\n            }\n            data = data.map(newRow);\n            columns = removeColumns(columns, targets);\n            return { data, columns };\n        }\n    },\n    add_filter_regex: {\n        title: _l(\"Using a Regular Expression\"),\n        display: (rule, colHeaders) => {\n            return `Filter rows using regular expression ${rule.expression} on column ${\n                colHeaders[rule.target_column]\n            }`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addFilterRegexTarget = 0;\n                component.addFilterRegexExpression = \"\";\n                component.addFilterRegexInvert = false;\n            } else {\n                component.addFilterRegexTarget = rule.target_column;\n                component.addFilterRegexExpression = rule.expression;\n                component.addFilterRegexInvert = rule.invert;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addFilterRegexTarget;\n            rule.expression = component.addFilterRegexExpression;\n            rule.invert = component.addFilterRegexInvert;\n        },\n        apply: (rule, data, sources, columns) => {\n            const regex = String(rule.expression);\n            var regExp;\n            try {\n                regExp = pyre(regex);\n            } catch (error) {\n                return { error: `Invalid regular expression specified.` };\n            }\n            const target = rule.target_column;\n            const invert = rule.invert;\n            const filterFunction = function(el, index) {\n                const row = data[parseInt(index)];\n                return regExp.exec(row[target]) ? !invert : invert;\n            };\n            sources = sources.filter(filterFunction);\n            data = data.filter(filterFunction);\n            return { data, sources };\n        }\n    },\n    add_filter_count: {\n        title: _l(\"First or Last N Rows\"),\n        display: (rule, colHeaders) => {\n            const which = rule.which;\n            const invert = rule.invert;\n            if (which == \"first\" && !invert) {\n                return `Filter out first ${rule.count} row(s).`;\n            } else if (which == \"first\" && invert) {\n                return `Keep only first ${rule.count} row(s).`;\n            } else if (which == \"last\" && !invert) {\n                return `Filter out last ${rule.count} row(s).`;\n            } else {\n                return `Keep only last ${rule.count} row(s).`;\n            }\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addFilterCountN = 0;\n                component.addFilterCountWhich = \"first\";\n                component.addFilterCountInvert = false;\n            } else {\n                component.addFilterCountN = parseInt(rule.count);\n                component.addFilterCountWhich = rule.which;\n                component.addFilterCountInvert = rule.inverse;\n            }\n        },\n        save: (component, rule) => {\n            rule.count = parseInt(component.addFilterCountN);\n            rule.which = component.addFilterCountWhich;\n            rule.invert = component.addFilterCountInvert;\n        },\n        apply: (rule, data, sources, columns) => {\n            const count = rule.count;\n            const invert = rule.invert;\n            const which = rule.which;\n            const dataLength = data.length;\n            const filterFunction = function(el, index) {\n                let matches;\n                if (which == \"first\") {\n                    matches = index >= count;\n                } else {\n                    matches = index < dataLength - count;\n                }\n                return matches ? !invert : invert;\n            };\n            sources = sources.filter(filterFunction);\n            data = data.filter(filterFunction);\n            return { data, sources };\n        }\n    },\n    add_filter_empty: {\n        title: _l(\"On Emptiness\"),\n        display: (rule, colHeaders) => {\n            return `Filter rows if no value for column ${colHeaders[rule.target_column]}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addFilterEmptyTarget = 0;\n                component.addFilterEmptyInvert = false;\n            } else {\n                component.addFilterEmptyTarget = rule.target_column;\n                component.addFilterEmptyInvert = rule.invert;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addFilterEmptyTarget;\n            rule.invert = component.addFilterEmptyInvert;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const invert = rule.invert;\n            const filterFunction = function(el, index) {\n                const row = data[parseInt(index)];\n                return row[target].length ? !invert : invert;\n            };\n            sources = sources.filter(filterFunction);\n            data = data.filter(filterFunction);\n            return { data, sources };\n        }\n    },\n    add_filter_matches: {\n        title: _l(\"Matching a Supplied Value\"),\n        display: (rule, colHeaders) => {\n            return `Filter rows with value ${rule.value} for column ${colHeaders[rule.target_column]}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addFilterMatchesTarget = 0;\n                component.addFilterMatchesValue = \"\";\n                component.addFilterMatchesInvert = false;\n            } else {\n                component.addFilterMatchesTarget = rule.target_column;\n                component.addFilterMatchesValue = rule.value;\n                component.addFilterMatchesInvert = rule.invert;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addFilterMatchesTarget;\n            rule.value = component.addFilterMatchesValue;\n            rule.invert = component.addFilterMatchesInvert;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const invert = rule.invert;\n            const value = rule.value;\n            const filterFunction = function(el, index) {\n                const row = data[parseInt(index)];\n                return row[target] == value ? !invert : invert;\n            };\n            sources = sources.filter(filterFunction);\n            data = data.filter(filterFunction);\n            return { data, sources };\n        }\n    },\n    add_filter_compare: {\n        title: _l(\"By Comparing to a Numeric Value\"),\n        display: (rule, colHeaders) => {\n            return `Filter rows with value ${rule.compare_type} ${rule.value} for column ${\n                colHeaders[rule.target_column]\n            }`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addFilterCompareTarget = 0;\n                component.addFilterCompareValue = 0;\n                component.addFilterCompareType = \"less_than\";\n            } else {\n                component.addFilterCompareTarget = rule.target_column;\n                component.addFilterCompareValue = rule.value;\n                component.addFilterCompareType = rule.compare_type;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addFilterCompareTarget;\n            rule.value = component.addFilterCompareValue;\n            rule.compare_type = component.addFilterCompareType;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const compare_type = rule.compare_type;\n            const value = rule.value;\n            const filterFunction = function(el, index) {\n                const row = data[parseInt(index)];\n                const targetValue = parseFloat(row[target]);\n                let matches;\n                if (compare_type == \"less_than\") {\n                    matches = targetValue < value;\n                } else if (compare_type == \"less_than_equal\") {\n                    matches = targetValue <= value;\n                } else if (compare_type == \"greater_than\") {\n                    matches = targetValue > value;\n                } else if (compare_type == \"greater_than_equal\") {\n                    matches = targetValue >= value;\n                }\n                return matches;\n            };\n            sources = sources.filter(filterFunction);\n            data = data.filter(filterFunction);\n            return { data, sources };\n        }\n    },\n    sort: {\n        title: _l(\"Sort\"),\n        display: (rule, colHeaders) => {\n            return `Sort on column ${colHeaders[rule.target_column]}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.addSortingTarget = 0;\n                component.addSortingNumeric = false;\n            } else {\n                component.addSortingTarget = rule.target_column;\n                component.addSortingNumeric = rule.numeric;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column = component.addSortingTarget;\n            rule.numeric = component.addSortingNumeric;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target = rule.target_column;\n            const numeric = rule.numeric;\n\n            const sortable = _.zip(data, sources);\n\n            const sortFunc = (a, b) => {\n                let aVal = a[0][target];\n                let bVal = b[0][target];\n                if (numeric) {\n                    aVal = parseFloat(aVal);\n                    bVal = parseFloat(bVal);\n                }\n                if (aVal < bVal) {\n                    return -1;\n                } else if (bVal < aVal) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            };\n\n            sortable.sort(sortFunc);\n\n            const newData = [];\n            const newSources = [];\n\n            sortable.map(zipped => {\n                newData.push(zipped[0]);\n                newSources.push(zipped[1]);\n            });\n\n            return { data: newData, sources: newSources };\n        }\n    },\n    swap_columns: {\n        title: _l(\"Swap Column(s)\"),\n        display: (rule, colHeaders) => {\n            return `Swap ${multiColumnsToString([rule.target_column_0, rule.target_column_1], colHeaders)}`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.swapColumnsTarget0 = 0;\n                component.swapColumnsTarget1 = 0;\n            } else {\n                component.swapColumnsTarget0 = rule.target_column_0;\n                component.swapColumnsTarget1 = rule.target_column_1;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_column_0 = component.swapColumnsTarget0;\n            rule.target_column_1 = component.swapColumnsTarget1;\n        },\n        apply: (rule, data, sources, columns) => {\n            const target0 = rule.target_column_0;\n            const target1 = rule.target_column_1;\n            function newRow(row) {\n                const newRow = row.slice();\n                newRow[target0] = row[target1];\n                newRow[target1] = row[target0];\n                return newRow;\n            }\n            data = data.map(newRow);\n            const tempColumn = columns[target0];\n            columns[target0] = columns[target1];\n            columns[target1] = tempColumn;\n            return { data, columns };\n        }\n    },\n    split_columns: {\n        title: _l(\"Split Column(s)\"),\n        display: (rule, colHeaders) => {\n            return `Duplicate each row and split up columns`;\n        },\n        init: (component, rule) => {\n            if (!rule) {\n                component.splitColumnsTargets0 = [];\n                component.splitColumnsTargets1 = [];\n            } else {\n                component.splitColumnsTargets0 = rule.target_columns_0;\n                component.splitColumnsTargets1 = rule.target_columns_1;\n            }\n        },\n        save: (component, rule) => {\n            rule.target_columns_0 = component.splitColumnsTargets0;\n            rule.target_columns_1 = component.splitColumnsTargets1;\n        },\n        apply: (rule, data, sources, columns) => {\n            const targets0 = rule.target_columns_0;\n            const targets1 = rule.target_columns_1;\n\n            const splitRow = function(row) {\n                const newRow0 = [],\n                    newRow1 = [];\n                for (let index in row) {\n                    index = parseInt(index);\n                    if (targets0.indexOf(index) > -1) {\n                        newRow0.push(row[index]);\n                    } else if (targets1.indexOf(index) > -1) {\n                        newRow1.push(row[index]);\n                    } else {\n                        newRow0.push(row[index]);\n                        newRow1.push(row[index]);\n                    }\n                }\n                return [newRow0, newRow1];\n            };\n            data = flatMap(splitRow, data);\n            sources = flatMap(src => [src, src], sources);\n            columns = removeColumns(columns, targets0);\n            return { data, sources, columns };\n        }\n    }\n};\n\nconst MAPPING_TARGETS = {\n    list_identifiers: {\n        multiple: true,\n        label: _l(\"List Identifier(s)\"),\n        columnHeader: _l(\"List Identifier\"),\n        help: _l(\n            \"This should be a short description of the replicate, sample name, condition, etc... that describes each level of the list structure.\"\n        ),\n        importType: \"collections\"\n    },\n    paired_identifier: {\n        label: _l(\"Paired-end Indicator\"),\n        columnHeader: _l(\"Paired Indicator\"),\n        help: _l(\n            \"This should be set to '1', 'R1', 'forward', 'f', or 'F' to indicate forward reads, and '2', 'r', 'reverse', 'R2', 'R', or 'R2' to indicate reverse reads.\"\n        ),\n        importType: \"collections\"\n    },\n    collection_name: {\n        label: _l(\"Collection Name\"),\n        help: _l(\n            \"If this is set, all rows with the same collection name will be joined into a collection and it is possible to create multiple collections at once.\"\n        ),\n        modes: [\"raw\", \"ftp\", \"datasets\", \"library_datasets\"],\n        importType: \"collections\"\n    },\n    name_tag: {\n        label: _l(\"Name Tag\"),\n        help: _l(\"Add a name tag or hash tag based on the specified column value for imported datasets.\"),\n        importType: \"datasets\",\n        modes: [\"raw\", \"ftp\"]\n    },\n    tags: {\n        multiple: true,\n        label: _l(\"General Purpose Tag(s)\"),\n        help: _l(\n            \"Add a general purpose tag based on the specified column value, use : to separate key-value pairs if desired. These tags are not propagated to derived datasets the way name and group tags are.\"\n        ),\n        modes: [\"raw\", \"ftp\", \"datasets\", \"library_datasets\"]\n    },\n    group_tags: {\n        multiple: true,\n        label: _l(\"Group Tag(s)\"),\n        help: _l(\n            \"Add a group tag based on the specified column value, use : to separate key-value pairs. These tags are propagated to derived datasets and may be useful for factorial experiments.\"\n        ),\n        modes: [\"raw\", \"ftp\", \"datasets\", \"library_datasets\"]\n    },\n    name: {\n        label: _l(\"Name\"),\n        importType: \"datasets\"\n    },\n    dbkey: {\n        label: _l(\"Genome\"),\n        modes: [\"raw\", \"ftp\"]\n    },\n    file_type: {\n        label: _l(\"Type\"),\n        modes: [\"raw\", \"ftp\"],\n        help: _l(\"This should be the Galaxy file type corresponding to this file.\")\n    },\n    url: {\n        label: _l(\"URL\"),\n        modes: [\"raw\"],\n        help: _l(\"This should be a URL the file can be downloaded from.\")\n    },\n    info: {\n        label: _l(\"Info\"),\n        help: _l(\n            \"Unstructured text associated with the dataset that shows up in the history panel, this is optional and can be whatever you would like.\"\n        ),\n        modes: [\"raw\", \"ftp\"]\n    },\n    ftp_path: {\n        label: _l(\"FTP Path\"),\n        modes: [\"raw\", \"ftp\"],\n        help: _l(\n            \"This should be the path to the target file to include relative to your FTP directory on the Galaxy server\"\n        ),\n        requiresFtp: true\n    }\n};\n\nconst columnDisplay = function(columns, colHeaders) {\n    let columnNames;\n    if (typeof columns == \"object\") {\n        columnNames = columns.map(idx => colHeaders[idx]);\n    } else {\n        columnNames = [colHeaders[columns]];\n    }\n    if (columnNames.length == 2) {\n        return \"columns \" + columnNames[0] + \" and \" + columnNames[1];\n    } else if (columnNames.length > 2) {\n        return \"columns \" + columnNames.slice(0, -1).join(\", \") + \", and \" + columnNames[columnNames.length - 1];\n    } else {\n        return \"column \" + columnNames[0];\n    }\n};\n\nconst colHeadersFor = function(data, columns) {\n    if (data.length == 0) {\n        if (columns) {\n            return columns.map((el, i) => String.fromCharCode(65 + i));\n        } else {\n            return [];\n        }\n    } else {\n        return data[0].map((el, i) => String.fromCharCode(65 + i));\n    }\n};\n\nconst applyRules = function(data, sources, columns, rules, headersPerRule = []) {\n    let colHeadersPerRule = Array.from(headersPerRule);\n    let hasRuleError = false;\n    for (var ruleIndex in rules) {\n        const ruleHeaders = colHeadersFor(data, columns);\n        colHeadersPerRule[ruleIndex] = ruleHeaders;\n        const rule = rules[ruleIndex];\n        rule.error = null;\n        rule.warn = null;\n        if (hasRuleError) {\n            rule.warn = _l(\"Skipped due to previous errors.\");\n            continue;\n        }\n        var ruleType = rule.type;\n        const ruleDef = RULES[ruleType];\n        const res = ruleDef.apply(rule, data, sources, columns);\n        if (res.error) {\n            hasRuleError = true;\n            rule.error = res.error;\n        } else {\n            if (res.warn) {\n                rule.warn = res.warn;\n            }\n            data = res.data || data;\n            sources = res.sources || sources;\n            columns = res.columns || columns;\n        }\n    }\n    return { data, sources, columns, colHeadersPerRule };\n};\n\nexport default {\n    applyRules: applyRules,\n    columnDisplay: columnDisplay,\n    colHeadersFor: colHeadersFor,\n    RULES: RULES,\n    MAPPING_TARGETS: MAPPING_TARGETS\n};\n","// dependencies\nimport Utils from \"utils/utils\";\n// grid view templates\nexport default {\n    // template\n    grid: function(options) {\n        var tmpl = \"\";\n        if (options.embedded) {\n            tmpl = this.grid_header(options) + this.grid_table(options);\n        } else {\n            tmpl = `<div class=\"loading-elt-overlay\"></div><table><tr><td width=\"75%\">${this.grid_header(\n                options\n            )}</td><td></td><td></td></tr><tr><td width=\"100%\" id=\"grid-message\" valign=\"top\"></td><td></td><td></td></tr></table>${this.grid_table(\n                options\n            )}`;\n        }\n\n        // add info text\n        if (options.info_text) {\n            tmpl += `<br><div class=\"toolParamHelp\" style=\"clear: both;\">${options.info_text}</div>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    grid_table: function() {\n        return `\n            <form method=\"post\" onsubmit=\"return false;\">\n                <table id=\"grid-table\" class=\"grid\">\n                    <thead id=\"grid-table-header\"></thead>\n                    <tbody id=\"grid-table-body\"></tbody>\n                    <tfoot id=\"grid-table-footer\"></tfoot>\n                </table>\n            </form>`;\n    },\n\n    // template\n    grid_header: function(options) {\n        var tmpl = '<div class=\"grid-header\">';\n        if (!options.embedded) {\n            tmpl += `<h2>${options.title}</h2>`;\n        }\n        if (options.global_actions) {\n            tmpl += '<ul class=\"manage-table-actions\">';\n            var show_popup = options.global_actions.length >= 3;\n            if (show_popup) {\n                tmpl +=\n                    '<li><a class=\"action-button\" id=\"popup-global-actions\" class=\"menubutton\">Actions</a></li>' +\n                    '<div popupmenu=\"popup-global-actions\">';\n            }\n            for (let action of options.global_actions) {\n                tmpl += `<li><a class=\"action-button use-target\" target=\"${action.target}\" href=\"${\n                    action.url_args\n                }\" onclick=\"return false;\" >${action.label}</a></li>`;\n            }\n            if (show_popup) {\n                tmpl += \"</div>\";\n            }\n            tmpl += \"</ul>\";\n        }\n        if (options.insert) {\n            tmpl += options.insert;\n        }\n\n        // add grid filters\n        tmpl += this.grid_filters(options);\n        tmpl += \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    header: function(options) {\n        // start\n        var tmpl = \"<tr>\";\n\n        // add checkbox\n        if (options.show_item_checkboxes) {\n            tmpl += \"<th>\";\n            if (options.items.length > 0) {\n                tmpl +=\n                    '<input type=\"checkbox\" id=\"check_all\" name=select_all_checkbox value=\"true\">' +\n                    '<input type=\"hidden\" name=select_all_checkbox value=\"true\">';\n            }\n            tmpl += \"</th>\";\n        }\n\n        // create header elements\n        for (let column of options.columns) {\n            if (column.visible) {\n                tmpl += `<th id=\"${column.key}-header\">`;\n                if (column.href) {\n                    tmpl += `<a href=\"${column.href}\" class=\"sort-link\" sort_key=\"${column.key}\">${column.label}</a>`;\n                } else {\n                    tmpl += column.label;\n                }\n                tmpl += `<span class=\"sort-arrow\">${column.extra}</span></th>`;\n            }\n        }\n\n        // finalize\n        tmpl += \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    body: function(options) {\n        // initialize\n        var tmpl = \"\";\n        var items_length = options.items.length;\n\n        // empty grid?\n        if (items_length === 0) {\n            // No results.\n            tmpl += '<tr><td colspan=\"100\"><em>No Items</em></td></tr>';\n        }\n\n        // create rows\n        for (let item of options.items) {\n            // Tag current\n            tmpl += \"<tr \";\n            if (options.current_item_id == item.id) {\n                tmpl += 'class=\"current\"';\n            }\n            tmpl += \">\";\n\n            // Item selection column\n            if (options.show_item_checkboxes) {\n                tmpl += `<td style=\"width: 1.5em;\"><input type=\"checkbox\" name=\"id\" value=\"${item.encode_id}\" id=\"${\n                    item.encode_id\n                }\" class=\"grid-row-select-checkbox\" /></td>`;\n            }\n\n            // Data columns\n            for (let column of options.columns) {\n                if (column.visible) {\n                    // Nowrap\n                    var nowrap = \"\";\n                    if (column.nowrap) {\n                        nowrap = 'style=\"white-space:nowrap;\"';\n                    }\n\n                    // get column settings\n                    var column_settings = item.column_config[column.label];\n\n                    // load attributes\n                    var link = column_settings.link;\n                    var value = column_settings.value;\n                    var target = column_settings.target;\n\n                    // unescape value\n                    if (jQuery.type(value) === \"string\") {\n                        value = value.replace(/\\/\\//g, \"/\");\n                    }\n\n                    // Attach popup menu?\n                    var id = \"\";\n                    var cls = \"\";\n                    if (column.attach_popup) {\n                        id = `grid-${item.encode_id}-popup`;\n                        cls = \"menubutton\";\n                        if (link !== \"\") {\n                            cls += \" split\";\n                        }\n                        cls += \" popup\";\n                    }\n\n                    // Check for row wrapping\n                    tmpl += `<td ${nowrap}>`;\n\n                    // Link\n                    if (link) {\n                        if (options.operations.length !== 0) {\n                            tmpl += `<div id=\"${id}\" class=\"${cls}\" style=\"float: left;\">`;\n                        }\n                        tmpl += `<a class=\"menubutton-label use-target\" target=\"${target}\" href=\"${link}\" onclick=\"return false;\">${value}</a>`;\n                        if (options.operations.length !== 0) {\n                            tmpl += \"</div>\";\n                        }\n                    } else {\n                        tmpl += `<div id=\"${id}\" class=\"${cls}\"><label id=\"${column.label_id_prefix}${\n                            item.encode_id\n                        }\" for=\"${item.encode_id}\">${value || \"\"}</label></div>`;\n                    }\n                    tmpl += \"</td>\";\n                }\n            }\n            tmpl += \"</tr>\";\n        }\n        return tmpl;\n    },\n\n    // template\n    footer: function(options) {\n        // create template string\n        var tmpl = \"\";\n\n        // paging\n        if (options.use_paging && options.num_pages > 1) {\n            // get configuration\n            var num_page_links = options.num_page_links;\n            var cur_page_num = options.cur_page_num;\n            var num_pages = options.num_pages;\n\n            // First pass on min page.\n            var page_link_range = num_page_links / 2;\n            var min_page = cur_page_num - page_link_range;\n            var min_offset = 0;\n            if (min_page <= 0) {\n                // Min page is too low.\n                min_page = 1;\n                min_offset = page_link_range - (cur_page_num - min_page);\n            }\n\n            // Set max page.\n            var max_range = page_link_range + min_offset;\n            var max_page = cur_page_num + max_range;\n            var max_offset;\n            if (max_page <= num_pages) {\n                // Max page is fine.\n                max_offset = 0;\n            } else {\n                // Max page is too high.\n                max_page = num_pages;\n                // +1 to account for the +1 in the loop below.\n                max_offset = max_range - (max_page + 1 - cur_page_num);\n            }\n\n            // Second and final pass on min page to add any unused\n            // offset from max to min.\n            if (max_offset !== 0) {\n                min_page -= max_offset;\n                if (min_page < 1) {\n                    min_page = 1;\n                }\n            }\n\n            // template header\n            tmpl += '<tr id=\"page-links-row\">';\n            if (options.show_item_checkboxes) {\n                tmpl += \"<td></td>\";\n            }\n            tmpl += '<td colspan=\"100\">' + '<span id=\"page-link-container\">' + \"Page:\";\n\n            if (min_page > 1) {\n                tmpl +=\n                    '<span class=\"page-link\" id=\"page-link-1\"><a href=\"javascript:void(0);\" page_num=\"1\" onclick=\"return false;\">1</a></span> ...';\n            }\n\n            // create page urls\n            for (var page_index = min_page; page_index < max_page + 1; page_index++) {\n                if (page_index == options.cur_page_num) {\n                    tmpl += `<span class=\"page-link inactive-link\" id=\"page-link-${page_index}\">${page_index}</span>`;\n                } else {\n                    tmpl += `<span class=\"page-link\" id=\"page-link-${page_index}\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${page_index}\">${page_index}</a></span>`;\n                }\n            }\n\n            // show last page\n            if (max_page < num_pages) {\n                tmpl += `...<span class=\"page-link\" id=\"page-link-${num_pages}\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${num_pages}\">${num_pages}</a></span>`;\n            }\n            tmpl += \"</span>\";\n\n            // Show all link\n            tmpl += `\n                    <span class=\"page-link\" id=\"show-all-link-span\"> | <a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"all\">Show All</a></span>\n                    </td>\n                </tr>`;\n        }\n\n        // Grid operations for multiple items.\n        if (options.show_item_checkboxes) {\n            // start template\n            tmpl += `\n                <tr>\n                    <input type=\"hidden\" id=\"operation\" name=\"operation\" value=\"\">\n                    <td></td>\n                    <td colspan=\"100\">\n                        For <span class=\"grid-selected-count\"></span> selected items: \n            `;\n\n            // configure buttons for operations\n            for (let operation of options.operations) {\n                if (operation.allow_multiple) {\n                    tmpl += `<input type=\"button\" value=\"${\n                        operation.label\n                    }\" class=\"operation-button action-button\">&nbsp;`;\n                }\n            }\n\n            // finalize template\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // count global operations\n        var found_global = false;\n        for (let operation of options.operations) {\n            if (operation.global_operation) {\n                found_global = true;\n                break;\n            }\n        }\n\n        // add global operations\n        if (found_global) {\n            tmpl += \"<tr>\" + '<td colspan=\"100\">';\n            for (let operation of options.operations) {\n                if (operation.global_operation) {\n                    tmpl += `<a class=\"action-button\" href=\"${operation.global_operation}\">${operation.label}</a>`;\n                }\n            }\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // add legend\n        if (options.legend) {\n            tmpl += `<tr><td colspan=\"100\">${options.legend}</td></tr>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    message: function(options) {\n        var status = options.status;\n        if ([\"success\", \"ok\"].indexOf(status) != -1) {\n            status = \"done\";\n        }\n        return `<p><div class=\"${status}message transient-message\">${_.escape(\n            options.message\n        )}</div><div style=\"clear: both\"></div></p>`;\n    },\n\n    // template\n    grid_filters: function(options) {\n        // get filters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n\n        // show advanced search if flag set or if there are filters for advanced search fields\n        var advanced_search_display = \"none\";\n        if (options.advanced_search) {\n            advanced_search_display = \"block\";\n        }\n\n        // identify columns with advanced filtering\n        var show_advanced_search_link = false;\n        for (let column of options.columns) {\n            if (column.filterable == \"advanced\") {\n                var column_key = column.key;\n                var f_key = filters[column_key];\n                var d_key = default_filter_dict[column_key];\n                if (f_key && d_key && f_key != d_key) {\n                    advanced_search_display = \"block\";\n                }\n                show_advanced_search_link = true;\n            }\n        }\n\n        // hide standard search if advanced is shown\n        var standard_search_display = \"block\";\n        if (advanced_search_display == \"block\") {\n            standard_search_display = \"none\";\n        }\n\n        //\n        // standard search\n        //\n        var tmpl = `<div id=\"standard-search\" style=\"display: ${standard_search_display};\"><table><tr><td style=\"padding: 0;\"><table>`;\n\n        // add standard filters\n        for (let column of options.columns) {\n            if (column.filterable == \"standard\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize standard search\n        tmpl += \"</table>\" + \"</td>\" + \"</tr>\" + \"<tr>\" + \"<td>\";\n\n        // show advanced search link in standard display\n        if (show_advanced_search_link) {\n            tmpl += '<a href=\"\" class=\"advanced-search-toggle\">Advanced Search</a>';\n        }\n\n        // finalize standard search display\n        tmpl += \"</td>\" + \"</tr>\" + \"</table>\" + \"</div>\";\n\n        //\n        // advanced search\n        //\n        tmpl += `<div id=\"advanced-search\" style=\"display: ${advanced_search_display}; margin-top: 5px; border: 1px solid #ccc;\"><table><tr><td style=\"text-align: left\" colspan=\"100\"><a href=\"\" class=\"advanced-search-toggle\">Close Advanced Search</a></td></tr>`;\n\n        // add advanced filters\n        for (let column of options.columns) {\n            if (column.filterable == \"advanced\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize advanced search template\n        tmpl += \"</table>\" + \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    grid_column_filter: function(options, column) {\n        // collect parameters\n        var filters = options.filters;\n        var column_label = column.label;\n        var column_key = column.key;\n        if (column.filterable == \"advanced\") {\n            column_label = column_label.toLowerCase();\n        }\n\n        // start\n        var tmpl = \"<tr>\";\n\n        if (column.filterable == \"advanced\") {\n            tmpl += `<td align=\"left\" style=\"padding-left: 10px\">${column_label}:</td>`;\n        }\n        tmpl += '<td style=\"padding-bottom: 1px;\">';\n        if (column.is_text) {\n            tmpl += `<form class=\"text-filter-form\" column_key=\"${column_key}\" action=\"${options.url}\" method=\"get\" >`;\n            // Carry forward filtering criteria with hidden inputs.\n            for (let column of options.columns) {\n                var filter_value = filters[column.key];\n                if (filter_value) {\n                    if (filter_value != \"All\") {\n                        if (column.is_text) {\n                            filter_value = JSON.stringify(filter_value);\n                        }\n                        tmpl += `<input type=\"hidden\" id=\"${column.key}\" name=\"f-${\n                            column.key\n                        }\" value=\"${filter_value}\"/>`;\n                    }\n                }\n            }\n            // Print current filtering criteria and links to delete.\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add filters\n            var column_filter = filters[column_key];\n            if (column_filter) {\n                // identify type\n                var type = jQuery.type(column_filter);\n\n                // single filter value\n                if (type == \"string\") {\n                    if (column_filter != \"All\") {\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter);\n                    }\n                }\n\n                // multiple filter values\n                if (type == \"array\") {\n                    for (let i in column_filter) {\n                        // copy filters and remove entry\n                        var params = column_filter;\n                        params = params.slice(i);\n\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter[i]);\n                    }\n                }\n            }\n\n            // close span\n            tmpl += \"</span>\";\n\n            // Set value, size of search input field. Minimum size is 20 characters.\n            var value = \"\";\n            var size = 20;\n            if (column.filterable == \"standard\") {\n                value = column.label.toLowerCase();\n                if (value.length < 20) {\n                    size = value.length;\n                }\n                // +4 to account for space after placeholder\n                size = size + 4;\n            }\n\n            // print input field for column\n            tmpl += `\n                <span class=\"search-box\">\n                    <input class=\"search-box-input\" id=\"input-${column_key}-filter\" name=\"f-${column_key}\" type=\"text\" placeholder=\"${value}\" size=\"${size}\"/>\n                    <button type=\"submit\" style=\"background: transparent; border: none; padding: 4px; margin: 0px;\">\n                        <i class=\"fa fa-search\"></i>\n                    </button>\n                </span>\n            </form>`;\n        } else {\n            // filter criteria\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add category filters\n            var seperator = false;\n            for (var cf_label in options.categorical_filters[column_key]) {\n                // get category filter\n                var cf = options.categorical_filters[column_key][cf_label];\n\n                // each filter will have only a single argument, so get that single argument\n                var cf_key = \"\";\n                var cf_arg = \"\";\n                for (var key in cf) {\n                    cf_key = key;\n                    cf_arg = cf[key];\n                }\n\n                // add seperator\n                if (seperator) {\n                    tmpl += \" | \";\n                }\n                seperator = true;\n\n                // add category\n                var filter = filters[column_key];\n                if (filter && cf[column_key] && filter == cf_arg) {\n                    tmpl += `<span class=\"categorical-filter ${column_key}-filter current-filter\">${cf_label}</span>`;\n                } else {\n                    tmpl += `<span class=\"categorical-filter ${column_key}-filter\"><a href=\"javascript:void(0);\" filter_key=\"${cf_key}\" filter_val=\"${cf_arg}\">${cf_label}</a></span>`;\n                }\n            }\n            tmpl += \"</span>\";\n        }\n        tmpl += \"</td>\" + \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template for filter items\n    filter_element: function(filter_key, filter_value) {\n        filter_value = Utils.sanitize(filter_value);\n        return `<span class=\"text-filter-val\">${filter_value}<a href=\"javascript:void(0);\" filter_key=\"${filter_key}\" filter_val=\"${filter_value}\"><i class=\"fa fa-times\" style=\"padding-left: 5px; padding-bottom: 6px;\"/></a></span>`;\n    }\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\n\n/* This class maps the form dom to an api compatible javascript dictionary. */\nexport var Manager = Backbone.Model.extend({\n    initialize: function(app) {\n        this.app = app;\n    },\n\n    /** Creates a checksum. */\n    checksum: function() {\n        var sum = \"\";\n        var self = this;\n        this.app.section.$el.find(\".section-row\").each(function() {\n            var id = $(this).attr(\"id\");\n            var field = self.app.field_list[id];\n            if (field) {\n                sum += `${id}:${JSON.stringify(field.value && field.value())}:${field.collapsed}:${field.connected};`;\n            }\n        });\n        return sum;\n    },\n\n    /** Convert dom into a dictionary of flat id/value pairs used e.g. on job submission. */\n    create: function() {\n        var self = this;\n\n        // get raw dictionary from dom\n        var dict = {};\n        this._iterate(this.app.section.$el, dict);\n\n        // add to result dictionary, label elements\n        var result_dict = {};\n        this.flat_dict = {};\n        function add(flat_id, input_id, input_value) {\n            self.flat_dict[flat_id] = input_id;\n            result_dict[flat_id] = input_value;\n            if (self.app.element_list[input_id]) {\n                self.app.element_list[input_id].$el.attr(\"tour_id\", flat_id);\n            }\n        }\n        // converter between raw dictionary and job dictionary\n        function convert(identifier, head) {\n            for (var index in head) {\n                var node = head[index];\n                if (node.input) {\n                    var input = node.input;\n                    var flat_id = identifier;\n                    if (identifier !== \"\") {\n                        flat_id += \"|\";\n                    }\n                    flat_id += input.name;\n                    switch (input.type) {\n                        case \"repeat\":\n                            var section_label = \"section-\";\n                            var block_indices = [];\n                            var block_prefix = null;\n                            for (var block_label in node) {\n                                var pos = block_label.indexOf(section_label);\n                                if (pos != -1) {\n                                    pos += section_label.length;\n                                    block_indices.push(parseInt(block_label.substr(pos)));\n                                    if (!block_prefix) {\n                                        block_prefix = block_label.substr(0, pos);\n                                    }\n                                }\n                            }\n                            block_indices.sort((a, b) => a - b);\n                            index = 0;\n                            for (var i in block_indices) {\n                                convert(`${flat_id}_${index++}`, node[block_prefix + block_indices[i]]);\n                            }\n                            break;\n                        case \"conditional\":\n                            var value = self.app.field_list[input.id].value();\n                            add(`${flat_id}|${input.test_param.name}`, input.id, value);\n                            var selectedCase = matchCase(input, value);\n                            if (selectedCase != -1) {\n                                convert(flat_id, head[`${input.id}-section-${selectedCase}`]);\n                            }\n                            break;\n                        case \"section\":\n                            convert((!input.flat && flat_id) || \"\", node);\n                            break;\n                        default:\n                            var field = self.app.field_list[input.id];\n                            if (field && field.value) {\n                                value = field.value();\n                                if (input.ignore === undefined || input.ignore != value) {\n                                    if (field.connected) {\n                                        value = { __class__: \"ConnectedValue\" };\n                                    } else if (field.collapsed && input.collapsible_value) {\n                                        value = input.collapsible_value;\n                                    }\n                                    add(flat_id, input.id, value);\n                                    if (input.payload) {\n                                        for (var p_id in input.payload) {\n                                            add(p_id, input.id, input.payload[p_id]);\n                                        }\n                                    }\n                                }\n                            }\n                    }\n                }\n            }\n        }\n        convert(\"\", dict);\n        return result_dict;\n    },\n\n    /** Matches flat ids to corresponding input element\n     * @param{string} flat_id - Flat input id to be looked up.\n     */\n    match: function(flat_id) {\n        return this.flat_dict && this.flat_dict[flat_id];\n    },\n\n    /** Match conditional values to selected cases\n     */\n    matchCase: function(input, value) {\n        return matchCase(input, value);\n    },\n\n    /** Matches a new tool model to the current input elements e.g. used to update dynamic options\n     */\n    matchModel: function(model, callback) {\n        var self = this;\n        visitInputs(model.inputs, (input, name) => {\n            if (self.flat_dict[name]) {\n                callback(input, self.flat_dict[name]);\n            }\n        });\n    },\n\n    /** Matches identifier from api response to input elements e.g. used to display validation errors\n     */\n    matchResponse: function(response) {\n        var result = {};\n        var self = this;\n        function search(id, head) {\n            if (typeof head === \"string\") {\n                var input_id = self.flat_dict[id];\n                if (input_id) {\n                    result[input_id] = head;\n                }\n            } else {\n                for (var i in head) {\n                    var new_id = i;\n                    if (id !== \"\") {\n                        var separator = \"|\";\n                        if (head instanceof Array) {\n                            separator = \"_\";\n                        }\n                        new_id = id + separator + new_id;\n                    }\n                    search(new_id, head[i]);\n                }\n            }\n        }\n        search(\"\", response);\n        return result;\n    },\n\n    /** Map dom tree to dictionary tree with input elements.\n     */\n    _iterate: function(parent, dict) {\n        var self = this;\n        var children = $(parent).children();\n        children.each(function() {\n            var child = this;\n            var id = $(child).attr(\"id\");\n            if ($(child).hasClass(\"section-row\")) {\n                var input = self.app.input_list[id];\n                dict[id] = (input && { input: input }) || {};\n                self._iterate(child, dict[id]);\n            } else {\n                self._iterate(child, dict);\n            }\n        });\n    }\n});\n\n/** Match conditional values to selected cases\n * @param{dict}   input     - Definition of conditional input parameter\n * @param{dict}   value     - Current value\n */\nexport var matchCase = (input, value) => {\n    if (input.test_param.type == \"boolean\") {\n        if (value == \"true\") {\n            value = input.test_param.truevalue || \"true\";\n        } else {\n            value = input.test_param.falsevalue || \"false\";\n        }\n    }\n    for (var i in input.cases) {\n        if (input.cases[i].value == value) {\n            return i;\n        }\n    }\n    return -1;\n};\n\n/** Visits tool inputs\n * @param{dict}   inputs    - Nested dictionary of input elements\n * @param{dict}   callback  - Called with the mapped dictionary object and corresponding model node\n */\nexport var visitInputs = (inputs, callback, prefix, context) => {\n    context = $.extend({}, context);\n    _.each(inputs, input => {\n        if (input && input.type && input.name) {\n            context[input.name] = input;\n        }\n    });\n    for (var key in inputs) {\n        let Galaxy = getGalaxyInstance();\n        var node = inputs[key];\n        node.name = node.name || key;\n        var name = prefix ? `${prefix}|${node.name}` : node.name;\n        switch (node.type) {\n            case \"repeat\":\n                _.each(node.cache, (cache, j) => {\n                    visitInputs(cache, callback, `${name}_${j}`, context);\n                });\n                break;\n            case \"conditional\":\n                if (node.test_param) {\n                    callback(node.test_param, `${name}|${node.test_param.name}`, context);\n                    var selectedCase = matchCase(node, node.test_param.value);\n                    if (selectedCase != -1) {\n                        visitInputs(node.cases[selectedCase].inputs, callback, name, context);\n                    } else {\n                        Galaxy.emit.debug(`form-data::visitInputs() - Invalid case for ${name}.`);\n                    }\n                } else {\n                    Galaxy.emit.debug(`form-data::visitInputs() - Conditional test parameter missing for ${name}.`);\n                }\n                break;\n            case \"section\":\n                visitInputs(node.inputs, callback, name, context);\n                break;\n            default:\n                callback(node, name, context);\n        }\n    }\n};\n\nexport default {\n    Manager: Manager,\n    visitInputs: visitInputs\n};\n","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n\n/** Multi 'mode' button (or any element really) that changes the html\n *      contents of itself when clicked. Pass in an ordered list of\n *      objects with 'html' and (optional) onclick functions.\n *\n *      When clicked in a particular node, the onclick function will\n *      be called (with the element as this) and the element will\n *      switch to the next mode, replacing its html content with\n *      that mode's html.\n *\n *      If there is no next mode, the element will switch back to\n *      the first mode.\n * @example:\n *     $( '.myElement' ).modeButton({\n *         modes : [\n *             {\n *                 mode: 'bler',\n *                 html: '<h5>Bler</h5>',\n *                 onclick : function(){\n *                     $( 'body' ).css( 'background-color', 'red' );\n *                 }\n *             },\n *             {\n *                 mode: 'bloo',\n *                 html: '<h4>Bloo</h4>',\n *                 onclick : function(){\n *                     $( 'body' ).css( 'background-color', 'blue' );\n *                 }\n *             },\n *             {\n *                 mode: 'blah',\n *                 html: '<h3>Blah</h3>',\n *                 onclick : function(){\n *                     $( 'body' ).css( 'background-color', 'grey' );\n *                 }\n *             },\n *         ]\n *     });\n *     $( '.myElement' ).modeButton( 'callModeFn', 'bler' );\n */\n/** constructor */\nfunction ModeButton(element, options) {\n    this.currModeIndex = 0;\n    return this._init(element, options);\n}\n\n/** html5 data key to store this object inside an element */\nModeButton.prototype.DATA_KEY = \"mode-button\";\n/** default options */\nModeButton.prototype.defaults = {\n    switchModesOnClick: true\n};\n\n// ---- private interface\n/** set up options, intial mode, and the click handler */\nModeButton.prototype._init = function _init(element, options) {\n    //console.debug( 'ModeButton._init:', element, options );\n    options = options || {};\n    this.$element = $(element);\n    this.options = $.extend(true, {}, this.defaults, options);\n    if (!options.modes) {\n        throw new Error('ModeButton requires a \"modes\" array');\n    }\n\n    var modeButton = this;\n    this.$element.click(function _ModeButtonClick(event) {\n        // call the curr mode fn\n        modeButton.callModeFn();\n        // inc the curr mode index\n        if (modeButton.options.switchModesOnClick) {\n            modeButton._incModeIndex();\n        }\n        // set the element html\n        $(this).html(modeButton.options.modes[modeButton.currModeIndex].html);\n    });\n    return this.reset();\n};\n/** increment the mode index to the next in the array, looping back to zero if at the last */\nModeButton.prototype._incModeIndex = function _incModeIndex() {\n    this.currModeIndex += 1;\n    if (this.currModeIndex >= this.options.modes.length) {\n        this.currModeIndex = 0;\n    }\n    return this;\n};\n/** get the mode index in the modes array for the given key (mode name) */\nModeButton.prototype._getModeIndex = function _getModeIndex(modeKey) {\n    for (var i = 0; i < this.options.modes.length; i += 1) {\n        if (this.options.modes[i].mode === modeKey) {\n            return i;\n        }\n    }\n    throw new Error(`mode not found: ${modeKey}`);\n};\n/** set the current mode to the one with the given index and set button html */\nModeButton.prototype._setModeByIndex = function _setModeByIndex(index) {\n    var newMode = this.options.modes[index];\n    if (!newMode) {\n        throw new Error(`mode index not found: ${index}`);\n    }\n    this.currModeIndex = index;\n    if (newMode.html) {\n        this.$element.html(newMode.html);\n    }\n    return this;\n};\n\n// ---- public interface\n/** get the current mode object (not just the mode name) */\nModeButton.prototype.currentMode = function currentMode() {\n    return this.options.modes[this.currModeIndex];\n};\n/** return the mode key of the current mode */\nModeButton.prototype.current = function current() {\n    // sugar for returning mode name\n    return this.currentMode().mode;\n};\n/** get the mode with the given modeKey or the current mode if modeKey is undefined */\nModeButton.prototype.getMode = function getMode(modeKey) {\n    if (!modeKey) {\n        return this.currentMode();\n    }\n    return this.options.modes[this._getModeIndex(modeKey)];\n};\n/** T/F if the button has the given mode */\nModeButton.prototype.hasMode = function hasMode(modeKey) {\n    try {\n        return !!this.getMode(modeKey);\n    } catch (err) {\n        console.debug(err);\n    }\n    return false;\n};\n/** set the current mode to the mode with the given name */\nModeButton.prototype.setMode = function setMode(modeKey) {\n    return this._setModeByIndex(this._getModeIndex(modeKey));\n};\n/** reset to the initial mode */\nModeButton.prototype.reset = function reset() {\n    this.currModeIndex = 0;\n    if (this.options.initialMode) {\n        this.currModeIndex = this._getModeIndex(this.options.initialMode);\n    }\n    return this._setModeByIndex(this.currModeIndex);\n};\n/** manually call the click handler of the given mode */\nModeButton.prototype.callModeFn = function callModeFn(modeKey) {\n    var modeFn = this.getMode(modeKey).onclick;\n    if (modeFn && $.type(modeFn === \"function\")) {\n        // call with the element as context (std jquery pattern)\n        return modeFn.call(this.$element.get(0));\n    }\n    return undefined;\n};\n\n// as jq plugin\n$.fn.modeButton = function $modeButton(options) {\n    if (!this.length) {\n        return this;\n    }\n\n    //TODO: does map still work with jq multi selection (i.e. $( '.class-for-many-btns' ).modeButton)?\n    if ($.type(options) === \"object\") {\n        return this.map(function() {\n            var $this = $(this);\n            $this.data(\"mode-button\", new ModeButton($this, options));\n            return this;\n        });\n    }\n\n    var $first = $(this[0]);\n    var button = $first.data(\"mode-button\");\n\n    if (!button) {\n        throw new Error(\"modeButton needs an options object or string name of a function\");\n    }\n\n    if (button && $.type(options) === \"string\") {\n        var fnName = options;\n        if (button && $.type(button[fnName]) === \"function\") {\n            return button[fnName].apply(button, $.makeArray(arguments).slice(1));\n        }\n    }\n    return button;\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport LIST_VIEW from \"mvc/list/list-view\";\nimport { History } from \"mvc/history/history-model\";\nimport { HistoryContents } from \"mvc/history/history-contents\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport HDCA_LI from \"mvc/history/hdca-li\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport HistoryViewEdit from \"mvc/history/history-view-edit\";\nimport HistoryCopyDialog from \"mvc/history/copy-dialog\";\nimport \"ui/search-input\";\nimport \"ui/mode-button\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar HistoryView = _super.extend(\n    /** @lends HistoryView.prototype */ {\n        _logNamespace: \"history\",\n\n        /** class to use for constructing the HDA views */\n        HDAViewClass: HDA_LI.HDAListItemView,\n        /** class to use for constructing the HDCA views */\n        HDCAViewClass: HDCA_LI.HDCAListItemView,\n        /** class to used for constructing collection of sub-view models */\n        collectionClass: HistoryContents,\n        /** key of attribute in model to assign to this.collection */\n        modelCollectionKey: \"contents\",\n\n        tagName: \"div\",\n        className: `${_super.prototype.className} history-panel`,\n\n        /** string to display when the collection is empty */\n        emptyMsg: _l(\"This history is empty\"),\n        /** displayed when no items match the search terms */\n        noneFoundMsg: _l(\"No matching datasets found\"),\n        /** string used for search placeholder */\n        searchPlaceholder: _l(\"search datasets\"),\n\n        // ......................................................................... SET UP\n        /** Set up the view, bind listeners.\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            // ---- instance vars\n            // control contents/behavior based on where (and in what context) the panel is being used\n            /** where should pages from links be displayed? (default to new tab/window) */\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n        },\n\n        /** create and return a collection for when none is initially passed */\n        _createDefaultCollection: function() {\n            // override\n            return new this.collectionClass([], {\n                history: this.model\n            });\n        },\n\n        /** In this override, clear the update timer on the model */\n        freeModel: function() {\n            _super.prototype.freeModel.call(this);\n            if (this.model) {\n                this.model.stopPolling();\n            }\n            return this;\n        },\n\n        /** create any event listeners for the panel\n         *  @fires: rendered:initial    on the first render\n         *  @fires: empty-history       when switching to a history with no contents or creating a new history\n         */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            this.on({\n                error: function(model, xhr, options, msg, details) {\n                    this.errorHandler(model, xhr, options, msg, details);\n                },\n                \"views:ready view:attached view:removed\": function(view) {\n                    this._renderSelectButton();\n                },\n                \"view:attached\": function(view) {\n                    this.scrollTo(0);\n                }\n            });\n            // this.on( 'all', function(){ console.debug( arguments ); });\n        },\n\n        // ------------------------------------------------------------------------ loading history/hda models\n        /** load the history with the given id then it's contents, sending ajax options to both */\n        loadHistory: function(historyId, options, contentsOptions) {\n            contentsOptions = _.extend(contentsOptions || { silent: true });\n            this.info(\"loadHistory:\", historyId, options, contentsOptions);\n            this.setModel(new History({ id: historyId }));\n\n            contentsOptions.silent = true;\n            this.trigger(\"loading\");\n            return this.model.fetchWithContents(options, contentsOptions).always(() => {\n                this.render();\n                this.trigger(\"loading-done\");\n            });\n        },\n\n        /** convenience alias to the model. Updates the item list only (not the history) */\n        refreshContents: function(options) {\n            if (this.model) {\n                return this.model.refresh(options);\n            }\n            // may have callbacks - so return an empty promise\n            return $.when();\n        },\n\n        /** Override to reset web storage when the id changes (since it needs the id) */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            return this.listenTo(this.collection, {\n                // 'all' : function(){ console.log( this.collection + ':', arguments ); },\n                \"fetching-more\": function() {\n                    this._toggleContentsLoadingIndicator(true);\n                    this.$emptyMessage().hide();\n                },\n                \"fetching-more-done\": function() {\n                    this._toggleContentsLoadingIndicator(false);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n        _showLoadingIndicator: function(msg, speed, callback) {\n            var $indicator = $('<div class=\"loading-indicator\"/>');\n            this.$el.html($indicator.text(msg).slideDown(!_.isUndefined(speed) ? speed : this.fxSpeed));\n        },\n\n        /** hide the loading indicator */\n        _hideLoadingIndicator: function(speed) {\n            // make speed a bit slower to compensate for slow rendering of up to 500 contents\n            this.$(\".loading-indicator\").slideUp(!_.isUndefined(speed) ? speed : this.fxSpeed + 200, function() {\n                $(this).remove();\n            });\n        },\n\n        /** In this override, add a btn to toggle the selectors */\n        _buildNewRender: function() {\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            this._renderSelectButton($newRender);\n            return $newRender;\n        },\n\n        /** button for starting select mode */\n        _renderSelectButton: function($where) {\n            $where = $where || this.$el;\n            // do not render selector option if no actions\n            if (!this.multiselectActions().length) {\n                return null;\n            }\n            // do not render (and remove even) if nothing to select\n            if (!this.views.length) {\n                this.hideSelectors();\n                $where.find(\".controls .actions .show-selectors-btn\").remove();\n                return null;\n            }\n            // don't bother rendering if there's one already\n            var $existing = $where.find(\".controls .actions .show-selectors-btn\");\n            if ($existing.length) {\n                return $existing;\n            }\n\n            return faIconButton({\n                title: _l(\"Operations on multiple datasets\"),\n                classes: \"show-selectors-btn\",\n                faIcon: \"fa-check-square-o\",\n                tooltipConfig: { placement: \"top\" }\n            }).prependTo($where.find(\".controls .actions\"));\n        },\n\n        /** override to avoid showing intial empty message using contents_active */\n        _renderEmptyMessage: function($whereTo) {\n            var $emptyMsg = this.$emptyMessage($whereTo);\n            var empty = this.model.get(\"contents_active\").active <= 0;\n            if (empty) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.emptyMsg)\n                    .show();\n            } else if (this.searchFor && this.model.contents.haveSearchDetails() && !this.views.length) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.noneFoundMsg)\n                    .show();\n            }\n            $emptyMsg.hide();\n            return $();\n        },\n\n        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n        $scrollContainer: function($where) {\n            // override or set via attributes.$scrollContainer\n            return this.$list($where);\n        },\n\n        // ------------------------------------------------------------------------ subviews\n        _toggleContentsLoadingIndicator: function(show) {\n            if (!show) {\n                this.$list()\n                    .find(\".contents-loading-indicator\")\n                    .remove();\n            } else {\n                this.$list().html(\n                    '<div class=\"contents-loading-indicator\">' + '<span class=\"fa fa-2x fa-spinner fa-spin\"/></div>'\n                );\n            }\n        },\n\n        /** override to render pagination also */\n        renderItems: function($whereTo) {\n            // console.log( this + '.renderItems-----------------', new Date() );\n            $whereTo = $whereTo || this.$el;\n            var $list = this.$list($whereTo);\n\n            // TODO: bootstrap hack to remove orphaned tooltips\n            $(\".tooltip\").remove();\n\n            $list.empty();\n            this.views = [];\n\n            var models = this._filterCollection();\n            if (models.length) {\n                this._renderPagination($whereTo);\n                this.views = this._renderSomeItems(models, $list);\n            } else {\n                // TODO: consolidate with _renderPagination above by (???) passing in models/length?\n                $whereTo.find(\"> .controls .list-pagination\").empty();\n            }\n            this._renderEmptyMessage($whereTo).toggle(!models.length);\n\n            this.trigger(\"views:ready\", this.views);\n            return this.views;\n        },\n\n        /** render pagination controls if not searching and contents says we're paginating */\n        _renderPagination: function($whereTo) {\n            var $paginationControls = $whereTo.find(\"> .controls .list-pagination\");\n            if (this.searchFor || !this.model.contents.shouldPaginate()) return $paginationControls.empty();\n\n            $paginationControls.html(\n                this.templates.pagination(\n                    {\n                        // pagination is 1-based for the user\n                        current: this.model.contents.currentPage + 1,\n                        last: this.model.contents.getLastPage() + 1\n                    },\n                    this\n                )\n            );\n            $paginationControls.find(\"select.pages\").tooltip();\n            return $paginationControls;\n        },\n\n        /** render a subset of the entire collection (client-side pagination) */\n        _renderSomeItems: function(models, $list) {\n            var views = [];\n            $list.append(\n                models.map(m => {\n                    var view = this._createItemView(m);\n                    views.push(view);\n                    return this._renderItemView$el(view);\n                })\n            );\n            return views;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** in this override, check if the contents would also display based on includeDeleted/hidden */\n        _filterItem: function(model) {\n            var contents = this.model.contents;\n            return (\n                (contents.includeHidden || !model.hidden()) &&\n                (contents.includeDeleted || !model.isDeletedOrPurged()) &&\n                _super.prototype._filterItem.call(this, model)\n            );\n        },\n\n        /** In this override, since history contents are mixed,\n         *      get the appropo view class based on history_content_type\n         */\n        _getItemViewClass: function(model) {\n            var contentType = model.get(\"history_content_type\");\n            switch (contentType) {\n                case \"dataset\":\n                    return this.HDAViewClass;\n                case \"dataset_collection\":\n                    return this.HDCAViewClass;\n            }\n            throw new TypeError(`Unknown history_content_type: ${contentType}`);\n        },\n\n        /** in this override, add a linktarget, and expand if id is in web storage */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                expanded: this.model.contents.storage.isExpanded(model.id),\n                hasUser: this.model.ownedByCurrUser()\n            });\n        },\n\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n            //TODO: send from content view: this.model.collection.storage.addExpanded\n            // maintain a list of items whose bodies are expanded\n            return panel.listenTo(view, {\n                expanded: function(v) {\n                    panel.model.contents.storage.addExpanded(v.model);\n                },\n                collapsed: function(v) {\n                    panel.model.contents.storage.removeExpanded(v.model);\n                }\n            });\n        },\n\n        /** override to remove expandedIds from webstorage */\n        collapseAll: function() {\n            this.model.contents.storage.clearExpanded();\n            _super.prototype.collapseAll.call(this);\n        },\n\n        // ------------------------------------------------------------------------ selection\n        /** Override to correctly set the historyId of the new collection */\n        getSelectedModels: function() {\n            var collection = _super.prototype.getSelectedModels.call(this);\n            collection.historyId = this.collection.historyId;\n            return collection;\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click > .controls .prev\": \"_clickPrevPage\",\n            \"click > .controls .next\": \"_clickNextPage\",\n            \"change > .controls .pages\": \"_changePageSelect\",\n            // allow (error) messages to be clicked away\n            \"click .messages [class$=message]\": \"clearMessages\"\n        }),\n\n        _clickPrevPage: function(ev) {\n            this.model.stopPolling();\n            this.model.contents.fetchPrevPage();\n        },\n\n        _clickNextPage: function(ev) {\n            this.model.stopPolling();\n            this.model.contents.fetchNextPage();\n        },\n\n        _changePageSelect: function(ev) {\n            this.model.stopPolling();\n            var page = $(ev.currentTarget).val();\n            this.model.contents.fetchPage(page);\n        },\n\n        /** Toggle and store the deleted visibility and re-render items\n         * @returns {Boolean} new setting\n         */\n        toggleShowDeleted: function(show, options) {\n            show = show !== undefined ? show : !this.model.contents.includeDeleted;\n            var contents = this.model.contents;\n            contents.setIncludeDeleted(show, options);\n            this.trigger(\"show-deleted\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** Toggle and store whether to render explicity hidden contents\n         * @returns {Boolean} new setting\n         */\n        toggleShowHidden: function(show, store, options) {\n            // console.log( 'toggleShowHidden', show, store );\n            show = show !== undefined ? show : !this.model.contents.includeHidden;\n            var contents = this.model.contents;\n            contents.setIncludeHidden(show, options);\n            this.trigger(\"show-hidden\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** On the first search, if there are no details - load them, then search */\n        _firstSearch: function(searchFor) {\n            var inputSelector = \"> .controls .search-input\";\n            this.log(\"onFirstSearch\", searchFor);\n\n            // if the contents already have enough details to search, search and return now\n            if (this.model.contents.haveSearchDetails()) {\n                this.searchItems(searchFor);\n                return;\n            }\n\n            // otherwise, load the details progressively here\n            this.$(inputSelector).searchInput(\"toggle-loading\");\n            // set this now so that only results will show during progress\n            this.searchFor = searchFor;\n            this.model.contents\n                .progressivelyFetchDetails({ silent: true })\n                .progress((response, limit, offset) => {\n                    this.renderItems();\n                    this.trigger(\"search:loading-progress\", limit, offset);\n                })\n                .always(() => {\n                    this.$el.find(inputSelector).searchInput(\"toggle-loading\");\n                })\n                .done(() => {\n                    this.searchItems(searchFor, \"force\");\n                });\n        },\n\n        /** clear the search filters and show all views that are normally shown */\n        clearSearch: function(searchFor) {\n            if (!this.searchFor) return this;\n            //this.log( 'onSearchClear', this );\n            this.searchFor = \"\";\n            this.trigger(\"search:clear\", this);\n            this.$(\"> .controls .search-query\").val(\"\");\n            // NOTE: silent + render prevents collection update event with merge only\n            // - which causes an empty page due to event handler above\n            this.model.contents.fetchCurrentPage({ silent: true }).done(() => {\n                this.renderItems();\n            });\n            return this;\n        },\n\n        // ........................................................................ error handling\n        /** Event handler for errors (from the panel, the history, or the history's contents)\n         *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n         *  @param {Model or View} model    the (Backbone) source of the error\n         *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n         *  @param {Object} options         the options map commonly used with bbone ajax\n         */\n        errorHandler: function(model, xhr, options) {\n            //TODO: to mixin or base model\n            // interrupted ajax or no connection\n            if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n                // return ERROR_MODAL.offlineErrorModal();\n                // fail silently\n                return;\n            }\n            // otherwise, leave something to report in the console\n            this.error(model, xhr, options);\n            // and feedback to a modal\n            // if sent two strings (and possibly details as 'options'), use those as message and title\n            if (_.isString(model) && _.isString(xhr)) {\n                var message = model;\n                var title = xhr;\n                return ERROR_MODAL.errorModal(message, title, options);\n            }\n            // bad gateway\n            // TODO: possibly to global handler\n            if (xhr && xhr.status === 502) {\n                return ERROR_MODAL.badGatewayErrorModal();\n            }\n            return ERROR_MODAL.ajaxErrorModal(model, xhr, options);\n        },\n\n        /** Remove all messages from the panel. */\n        clearMessages: function(ev) {\n            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n            $target.fadeOut(this.fxSpeed, function() {\n                $(this).remove();\n            });\n            return this;\n        },\n\n        // ........................................................................ scrolling\n        /** Scrolls the panel to show the content sub-view with the given hid.\n         *  @param {Integer} hid    the hid of item to scroll into view\n         *  @returns {HistoryView} the panel\n         */\n        scrollToHid: function(hid) {\n            return this.scrollToItem(_.first(this.viewsWhereModel({ hid: hid })));\n        },\n\n        // ........................................................................ misc\n        /** utility for adding -st, -nd, -rd, -th to numbers */\n        ordinalIndicator: function(number) {\n            var numStr = `${number}`;\n            switch (numStr.charAt(numStr.length - 1)) {\n                case \"1\":\n                    return `${numStr}st`;\n                case \"2\":\n                    return `${numStr}nd`;\n                case \"3\":\n                    return `${numStr}rd`;\n                default:\n                    return `${numStr}th`;\n            }\n        },\n\n        /** Return a string rep of the history */\n        toString: function() {\n            return `HistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryView.prototype.templates = (() => {\n    var mainTemplate = () =>\n        `<div>\n            <div class=\"controls\"></div>\n            <ul class=\"list-items\"></ul>\n            <div class=\"empty-message infomessagesmall\"></div>',\n        </div>`;\n\n    var controlsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"controls\">',\n            '<div class=\"title\">',\n            '<div class=\"name\"><%- history.name %></div>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            '<div class=\"history-size\"><%- history.nice_size %></div>',\n\n            '<div class=\"actions\"></div>',\n\n            '<div class=\"messages\">',\n            \"<% if( history.deleted && history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged and deleted\"),\n            \"</div>\",\n            \"<% } else if( history.deleted ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been deleted\"),\n            \"</div>\",\n            \"<% } else if( history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged\"),\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( history.message ){ %>\",\n            // should already be localized\n            '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n            \"<%= history.message.text %>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"</div>\",\n\n            // add tags and annotations\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"search\">',\n            '<div class=\"search-input\"></div>',\n            \"</div>\",\n\n            '<div class=\"list-actions\">',\n            '<div class=\"btn-group\">',\n            '<button class=\"select-all btn btn-secondary\"',\n            'data-mode=\"select\">',\n            _l(\"All\"),\n            \"</button>\",\n            '<button class=\"deselect-all btn btn-secondary\"',\n            'data-mode=\"select\">',\n            _l(\"None\"),\n            \"</button>\",\n            \"</div>\",\n            '<div class=\"list-action-menu btn-group\">',\n            \"</div>\",\n            \"</div>\",\n            '<div class=\"list-pagination form-inline\"></div>',\n            \"</div>\"\n        ],\n        \"history\"\n    );\n\n    var paginationTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<button class=\"prev\" <%- pages.current === 1 ? \"disabled\" : \"\" %>>previous</button>',\n            '<select class=\"pages form-control\" ',\n            'title=\"',\n            _l(\"Click to open and select a page. Begin typing a page number to select it\"),\n            '\">',\n            \"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>\",\n            '<option value=\"<%- i - 1 %>\" <%- i === pages.current ? \"selected\" : \"\" %>>',\n            \"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages\",\n            \"</option>\",\n            \"<% }); %>\",\n            \"</select>\",\n            '<button class=\"next\" <%- pages.current === pages.last ? \"disabled\" : \"\" %>>next</button>'\n        ],\n        \"pages\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        el: mainTemplate,\n        controls: controlsTemplate,\n        pagination: paginationTemplate\n    });\n})();\n\nexport function historyEntry(options) {\n    $(\"#toggle-deleted\").modeButton({\n        initialMode: options.initialModeDeleted,\n        modes: [\n            { mode: \"showing_deleted\", html: _l(\"Exclude deleted\") },\n            { mode: \"not_showing_deleted\", html: _l(\"Include deleted\") }\n        ]\n    });\n    $(\"#toggle-hidden\").modeButton({\n        initialMode: options.initialModeHidden,\n        modes: [\n            { mode: \"showing_hidden\", html: _l(\"Exclude hidden\") },\n            { mode: \"not_showing_hidden\", html: _l(\"Include hidden\") }\n        ]\n    });\n    $(\"#switch\").click(function() {\n        //##HACK:ity hack hack\n        //##TODO: remove when out of iframe\n        let Galaxy = getGalaxyInstance();\n        var hview = Galaxy.currHistoryPanel ? Galaxy.currHistoryPanel : null;\n        if (hview) {\n            hview.switchToHistory(\"${ history[ 'id' ] }\");\n        } else {\n            window.location = \"${ switch_to_url }\";\n        }\n    });\n    // use_panels affects where the the center_panel() is rendered:\n    //  w/o it renders to the body, w/ it renders to #center - we need to adjust a few things for scrolling to work\n    if (options.hasMasthead) {\n        $(\"#center\").addClass(\"flex-vertical-container\");\n    }\n\n    let viewClass = options.userIsOwner ? HistoryViewEdit.HistoryViewEdit : HistoryView.HistoryView;\n    let history = new History(options.historyJSON);\n\n    // attach the copy dialog to the import button now that we have a history\n    $(\"#import\").click(function() {\n        let Galaxy = getGalaxyInstance();\n        HistoryCopyDialog(history, {\n            useImport: true,\n            // use default datasets option to match the toggle-deleted button\n            allDatasets: $(\"#toggle-deleted\").modeButton(\"getMode\").mode === \"showing_deleted\"\n        }).done(function() {\n            if (window === window.parent) {\n                window.location = getAppRoot();\n            } else if (Galaxy.currHistoryPanel) {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            }\n        });\n    });\n\n    let historyView = new viewClass({\n        el: $(\"#history-\" + options.historyJSON.id),\n        className: viewClass.prototype.className + \" wide\",\n        $scrollContainer: options.hasMasthead\n            ? function() {\n                  return this.$el.parent();\n              }\n            : undefined,\n        model: history,\n        show_deleted: options.showDeletedJson,\n        show_hidden: options.showHiddenJson,\n        purgeAllowed: options.allow_user_dataset_purge\n    });\n    historyView.trigger(\"loading\");\n    history\n        .fetchContents({ silent: true })\n        .fail(function() {\n            alert(\"Galaxy history failed to load\");\n        })\n        .done(function() {\n            historyView.trigger(\"loading-done\");\n            historyView.render();\n        });\n    $(\"#toggle-deleted\").on(\"click\", function() {\n        historyView.toggleShowDeleted();\n    });\n    $(\"#toggle-hidden\").on(\"click\", function() {\n        historyView.toggleShowHidden();\n    });\n}\n\n//==============================================================================\nexport default {\n    HistoryView: HistoryView,\n    historyEntry: historyEntry\n};\n","import Toastr from \"toastr\";\n\n// Simple passthrough for now, but this gives us an extension point to work\n// against when converting over to either boostrap-specific or vue-based\n// toasts.\n\nexport const Toast = Toastr;\n","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n\n// ============================================================================\n/**\n * Make an element with text editable: (a) when user clicks on text, a textbox/area\n * is provided for editing; (b) when enter key pressed, element's text is set and on_finish\n * is called.\n */\n$.fn.make_text_editable = function(config_dict) {\n    // Get config options.\n    var num_cols = \"num_cols\" in config_dict ? config_dict.num_cols : 30;\n\n    var num_rows = \"num_rows\" in config_dict ? config_dict.num_rows : 4;\n\n    var use_textarea = \"use_textarea\" in config_dict ? config_dict.use_textarea : false;\n\n    var on_finish = \"on_finish\" in config_dict ? config_dict.on_finish : null;\n    var help_text = \"help_text\" in config_dict ? config_dict.help_text : null;\n\n    // Add element behavior.\n    var container = $(this);\n    container.addClass(\"editable-text\").click(function(e) {\n        // If there's already an input element, editing is active, so do nothing.\n        if ($(this).children(\":input\").length > 0) {\n            return;\n        }\n\n        container.removeClass(\"editable-text\");\n\n        // Handler for setting element text.\n        var set_text = new_text => {\n            container.find(\":input\").remove();\n\n            if (new_text !== \"\") {\n                container.text(new_text);\n            } else {\n                // No text; need a line so that there is a click target.\n                container.html(\"<br>\");\n            }\n            container.addClass(\"editable-text\");\n\n            if (on_finish) {\n                on_finish(new_text);\n            }\n        };\n\n        // Create input element(s) for editing.\n        var cur_text = \"cur_text\" in config_dict ? config_dict.cur_text : container.text();\n\n        var input_elt;\n        var button_elt;\n\n        if (use_textarea) {\n            input_elt = $(\"<textarea/>\")\n                .attr({ rows: num_rows, cols: num_cols })\n                .text($.trim(cur_text))\n                .keyup(e => {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        set_text(cur_text);\n                    }\n                });\n            button_elt = $(\"<button/>\")\n                .addClass(\"btn-sm float-right\")\n                .text(\"Done\")\n                .click(() => {\n                    set_text(input_elt.val());\n                    // Return false so that click does not propogate to container.\n                    return false;\n                });\n        } else {\n            input_elt = $(\"<input type='text'/>\")\n                .attr({ value: $.trim(cur_text), size: num_cols })\n                .blur(() => {\n                    set_text(cur_text);\n                })\n                .keyup(function(e) {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        $(this).trigger(\"blur\");\n                    } else if (e.keyCode === 13) {\n                        // Enter key.\n                        set_text($(this).val());\n                    }\n\n                    // Do not propogate event to avoid unwanted side effects.\n                    e.stopPropagation();\n                });\n        }\n\n        // Replace text with input object(s) and focus & select.\n        container.text(\"\");\n        container.append(input_elt);\n        if (button_elt) {\n            container.append(button_elt);\n        }\n        input_elt.focus();\n        input_elt.select();\n\n        // Do not propogate to elements below b/c that blurs input and prevents it from being used.\n        e.stopPropagation();\n    });\n\n    // Add help text if there some.\n    if (help_text) {\n        container.attr(\"title\", help_text).tooltip();\n    }\n\n    return container;\n};\n\n// ============================================================================\n","// Finds <link rel=\"index\"> in head element and pulls root url fragment from\n// there That should probably be a <base> tag instead since that's how\n// they're using <link rel=\"index\" />\n\nimport { serverPath } from \"utils/serverPath\";\n\nexport function getRootFromIndexLink(defaultRoot = \"/\") {\n    let links = document.getElementsByTagName(\"link\");\n    let indexLink = Array.from(links).find(link => link.rel == \"index\");\n    return indexLink && indexLink.href ? serverPath(indexLink.href) : defaultRoot;\n}\n","/**\n * Top-level trackster code, used for creating/loading visualizations and user interface elements.\n */\n\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\nimport tracks from \"viz/trackster/tracks\";\nimport visualization from \"viz/visualization\";\nimport IconButton from \"mvc/ui/icon-button\";\nimport query_string from \"utils/query-string-parsing\";\nimport GridView from \"mvc/grid/grid-view\";\n// import Utils from \"utils/utils\";\nimport \"libs/jquery/jquery.event.drag\";\nimport \"libs/jquery/jquery.event.hover\";\nimport \"jquery-mousewheel\";\nimport \"libs/jquery/jquery-ui\";\nimport \"libs/jquery/select2\";\nimport \"libs/farbtastic\";\nimport \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jquery.rating\";\nimport \"ui/editable-text\";\n\n//import \"style/scss/autocomplete_tagging.scss\";\n//import \"static/style/jquery-ui/smoothness/jquery-ui.css\";\n//import \"static/style/library.css\";\n//import \"static/style/trackster.css\";\n\n/**\n * User interface controls for trackster\n */\nexport class TracksterUI extends Backbone.Model {\n    constructor(options) {\n        super(options);\n    }\n\n    initialize(baseURL) {\n        this.baseURL = baseURL;\n    }\n\n    /**\n     * Save visualization, returning a Deferred object for the remote call to save.\n     */\n    save_viz() {\n        let Galaxy = getGalaxyInstance();\n\n        // show dialog\n        Galaxy.modal.show({ title: \"Saving...\", body: \"progress\" });\n\n        // Save bookmarks.\n        var bookmarks = [];\n        $(\".bookmark\").each(() => {\n            bookmarks.push({\n                position: $(this)\n                    .children(\".position\")\n                    .text(),\n                annotation: $(this)\n                    .children(\".annotation\")\n                    .text()\n            });\n        });\n\n        // FIXME: give unique IDs to Drawables and save overview as ID.\n        var overview_track_name = this.view.overview_drawable\n            ? this.view.overview_drawable.config.get_value(\"name\")\n            : null;\n\n        var viz_config = {\n            view: this.view.to_dict(),\n            viewport: {\n                chrom: this.view.chrom,\n                start: this.view.low,\n                end: this.view.high,\n                overview: overview_track_name\n            },\n            bookmarks: bookmarks\n        };\n\n        // Make call to save visualization.\n        return $.ajax({\n            url: `${getAppRoot()}visualization/save`,\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                id: this.view.vis_id,\n                title: this.view.config.get_value(\"name\"),\n                dbkey: this.view.dbkey,\n                type: \"trackster\",\n                vis_json: JSON.stringify(viz_config)\n            }\n        })\n            .success(vis_info => {\n                Galaxy.modal.hide();\n                this.view.vis_id = vis_info.vis_id;\n                this.view.has_changes = false;\n\n                // Needed to set URL when first saving a visualization.\n                window.history.pushState({}, \"\", vis_info.url + window.top.location.hash);\n            })\n            .error(() => {\n                // show dialog\n                Galaxy.modal.show({\n                    title: _l(\"Could Not Save\"),\n                    body: \"Could not save visualization. Please try again later.\",\n                    buttons: {\n                        Cancel: () => {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            });\n    }\n\n    /**\n     * Create button menu\n     */\n    createButtonMenu() {\n        var menu = IconButton.create_icon_buttons_menu(\n            [\n                {\n                    icon_class: \"plus-button\",\n                    title: _l(\"Add tracks\"),\n                    on_click: () => {\n                        visualization.select_datasets({ dbkey: this.view.dbkey }, new_tracks => {\n                            _.each(new_tracks, track => {\n                                this.view.add_drawable(tracks.object_from_template(track, this.view, this.view));\n                            });\n                        });\n                    }\n                },\n                {\n                    icon_class: \"block--plus\",\n                    title: _l(\"Add group\"),\n                    on_click: () => {\n                        this.view.add_drawable(\n                            new tracks.DrawableGroup(this.view, this.view, {\n                                name: \"New Group\"\n                            })\n                        );\n                    }\n                },\n                {\n                    icon_class: \"bookmarks\",\n                    title: _l(\"Bookmarks\"),\n                    on_click: () => {\n                        // HACK -- use style to determine if panel is hidden and hide/show accordingly.\n                        window.force_right_panel($(\"div#right\").css(\"right\") == \"0px\" ? \"hide\" : \"show\");\n                    }\n                },\n                {\n                    icon_class: \"globe\",\n                    title: _l(\"Circster\"),\n                    on_click: () => {\n                        window.top.location = `${this.baseURL}visualization/circster?id=${this.view.vis_id}`;\n                    }\n                },\n                {\n                    icon_class: \"disk--arrow\",\n                    title: _l(\"Save\"),\n                    on_click: () => {\n                        this.save_viz();\n                    }\n                },\n                {\n                    icon_class: \"cross-circle\",\n                    title: _l(\"Close\"),\n                    on_click: () => {\n                        this.handle_unsaved_changes(this.view);\n                    }\n                }\n            ],\n            {\n                tooltip_config: { placement: \"bottom\" }\n            }\n        );\n\n        this.buttonMenu = menu;\n        return menu;\n    }\n\n    /**\n     * Add bookmark.\n     */\n    add_bookmark(position, annotation, editable) {\n        // Create HTML.\n        var bookmarks_container = $(\"#right .unified-panel-body\");\n\n        var new_bookmark = $(\"<div/>\")\n            .addClass(\"bookmark\")\n            .appendTo(bookmarks_container);\n\n        var position_div = $(\"<div/>\")\n            .addClass(\"position\")\n            .appendTo(new_bookmark);\n\n        //position_link\n        $(\"<a href=''/>\")\n            .text(position)\n            .appendTo(position_div)\n            .click(() => {\n                this.view.go_to(position);\n                return false;\n            });\n\n        var annotation_div = $(\"<div/>\")\n            .text(annotation)\n            .appendTo(new_bookmark);\n\n        // If editable, enable bookmark deletion and annotation editing.\n        if (editable) {\n            var delete_icon_container = $(\"<div/>\")\n                .addClass(\"delete-icon-container\")\n                .prependTo(new_bookmark)\n                .click(() => {\n                    // Remove bookmark.\n                    new_bookmark.slideUp(\"fast\");\n                    new_bookmark.remove();\n                    this.view.has_changes = true;\n                    return false;\n                });\n\n            // delete_icon\n            $(\"<a href=''/>\")\n                .addClass(\"icon-button delete\")\n                .appendTo(delete_icon_container);\n\n            annotation_div\n                .make_text_editable({\n                    num_rows: 3,\n                    use_textarea: true,\n                    help_text: \"Edit bookmark note\"\n                })\n                .addClass(\"annotation\");\n        }\n\n        this.view.has_changes = true;\n        return new_bookmark;\n    }\n\n    /**\n     * Create a complete Trackster visualization. Returns view.\n     */\n    create_visualization(view_config, viewport_config, drawables_config, bookmarks_config, editable) {\n        // Create view.\n        this.view = new tracks.TracksterView(_.extend(view_config, { header: false }));\n        this.view.editor = true;\n\n        $.when(this.view.load_chroms_deferred).then(chrom_info => {\n            var overview_drawable_name = null;\n            // Viewport config.\n            if (viewport_config) {\n                var chrom = viewport_config.chrom;\n                var start = viewport_config.start;\n                var end = viewport_config.end;\n                overview_drawable_name = viewport_config.overview;\n\n                if (chrom && start !== undefined && end) {\n                    this.view.change_chrom(chrom, start, end);\n                } else {\n                    // No valid viewport, so use first chromosome.\n                    this.view.change_chrom(chrom_info[0].chrom);\n                }\n            } else {\n                // No viewport, so use first chromosome.\n                this.view.change_chrom(chrom_info[0].chrom);\n            }\n\n            // Add drawables to view.\n            if (drawables_config) {\n                // FIXME: can from_dict() be used to create view and add drawables?\n                for (let i = 0; i < drawables_config.length; i++) {\n                    this.view.add_drawable(tracks.object_from_template(drawables_config[i], this.view, this.view));\n                }\n            }\n\n            // Set overview.\n            for (let i = 0; i < this.view.drawables.length; i++) {\n                if (this.view.drawables[i].config.get_value(\"name\") === overview_drawable_name) {\n                    this.view.set_overview(this.view.drawables[i]);\n                    break;\n                }\n            }\n\n            // Load bookmarks.\n            if (bookmarks_config) {\n                var bookmark;\n                for (let i = 0; i < bookmarks_config.length; i++) {\n                    bookmark = bookmarks_config[i];\n                    this.add_bookmark(bookmark.position, bookmark.annotation, editable);\n                }\n            }\n\n            // View has no changes as of yet.\n            this.view.has_changes = false;\n        });\n\n        // Final initialization.\n        this.set_up_router({ view: this.view });\n\n        // TODO: This is hopefully not necessary anymore, since we're using the instance view.  Do it for compatibility for now.\n        return this.view;\n    }\n\n    /**\n     * Set up location router to use hashes as track browser locations.\n     */\n    set_up_router(options) {\n        new visualization.TrackBrowserRouter(options);\n        Backbone.history.start();\n    }\n\n    /**\n     * Set up keyboard navigation for a visualization.\n     */\n    init_keyboard_nav(view) {\n        // Keyboard navigation. Scroll ~7% of height when scrolling up/down.\n        $(document).keyup(e => {\n            // Do not navigate if arrow keys used in input element.\n            if ($(e.srcElement).is(\":input\")) {\n                return;\n            }\n\n            // Key codes: left == 37, up == 38, right == 39, down == 40\n            switch (e.which) {\n                case 37:\n                    view.move_fraction(0.25);\n                    break;\n                case 38:\n                    // var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() - 20);\n                    break;\n                case 39:\n                    view.move_fraction(-0.25);\n                    break;\n                case 40:\n                    // var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() + 20);\n                    break;\n            }\n        });\n    }\n\n    /**\n     * Handle unsaved changes in visualization.\n     */\n    handle_unsaved_changes(view) {\n        let Galaxy = getGalaxyInstance();\n        if (view.has_changes) {\n            Galaxy.modal.show({\n                title: _l(\"Close visualization\"),\n                body: \"There are unsaved changes to your visualization which will be lost if you do not save them.\",\n                buttons: {\n                    Cancel: () => {\n                        Galaxy.modal.hide();\n                    },\n                    \"Leave without Saving\": () => {\n                        $(window).off(\"beforeunload\");\n                        window.top.location = `${getAppRoot()}visualizations/list`;\n                    },\n                    Save: () => {\n                        $.when(this.save_viz()).then(() => {\n                            window.top.location = `${getAppRoot()}visualizations/list`;\n                        });\n                    }\n                }\n            });\n        } else {\n            window.top.location = `${getAppRoot()}visualizations/list`;\n        }\n    }\n}\n\nexport class TracksterUIView extends Backbone.View {\n    constructor(options) {\n        super(options);\n    }\n    // initalize trackster\n    initialize() {\n        // load ui\n        this.ui = new TracksterUI(getAppRoot());\n\n        // create button menu\n        this.ui.createButtonMenu();\n\n        // attach the button menu to the panel header and float it left\n        this.ui.buttonMenu.$el.attr(\"style\", \"float: right\");\n\n        // add to center panel\n        $(\"#center .unified-panel-header-inner\").append(this.ui.buttonMenu.$el);\n\n        // configure right panel\n        $(\"#right .unified-panel-title\").append(\"Bookmarks\");\n        $(\"#right .unified-panel-icons\").append(\n            \"<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>\"\n        );\n\n        // resize view when showing/hiding right panel (bookmarks for now).\n        $(\"#right-border\").click(() => {\n            this.ui.view.resize_window();\n        });\n\n        // hide right panel\n        window.force_right_panel(\"hide\");\n\n        // check if id is available\n        if (window.galaxy_config.app.id) {\n            this.view_existing();\n        } else if (query_string.get(\"dataset_id\")) {\n            this.choose_existing_or_new();\n        } else {\n            this.view_new();\n        }\n    }\n\n    choose_existing_or_new() {\n        let Galaxy = getGalaxyInstance();\n        var dbkey = query_string.get(\"dbkey\");\n        var listTracksParams = {};\n\n        var dataset_params = {\n            dbkey: dbkey,\n            dataset_id: query_string.get(\"dataset_id\"),\n            hda_ldda: query_string.get(\"hda_ldda\"),\n            gene_region: query_string.get(\"gene_region\")\n        };\n\n        if (dbkey) {\n            listTracksParams[\"f-dbkey\"] = dbkey;\n        }\n\n        Galaxy.modal.show({\n            title: \"View Data in a New or Saved Visualization?\",\n            // either have text in here or have to remove body and the header/footer margins\n            body: `<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>${dbkey ||\n                \"Not available.\"}</b></li><li>or create a new session with this dataset as the only track</li></ul></p>`,\n            buttons: {\n                Cancel: () => {\n                    window.top.location = `${getAppRoot()}visualizations/list`;\n                },\n                \"View in saved visualization\": () => {\n                    this.view_in_saved(dataset_params);\n                },\n                \"View in new visualization\": () => {\n                    this.view_new();\n                }\n            }\n        });\n    }\n\n    // view\n    view_in_saved(dataset_params) {\n        let Galaxy = getGalaxyInstance();\n        var tracks_grid = new GridView({\n            url_base: `${getAppRoot()}visualization/list_tracks`,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: _l(\"Add Data to Saved Visualization\"),\n            body: tracks_grid.$el,\n            buttons: {\n                Cancel: () => {\n                    window.top.location = `${getAppRoot()}visualizations/list`;\n                },\n                \"Add to visualization\": () => {\n                    $(window.parent.document)\n                        .find(\"input[name=id]:checked\")\n                        .each(() => {\n                            dataset_params.id = $(this).val();\n                            window.top.location = `${getAppRoot()}visualization/trackster?${$.param(dataset_params)}`;\n                        });\n                }\n            }\n        });\n    }\n\n    // view\n    view_existing() {\n        // get config\n        var viz_config = window.galaxy_config.app.viz_config;\n\n        // view\n        this.ui.create_visualization(\n            {\n                container: $(\"#center .unified-panel-body\"),\n                name: viz_config.title,\n                vis_id: viz_config.vis_id,\n                dbkey: viz_config.dbkey\n            },\n            viz_config.viewport,\n            viz_config.tracks,\n            viz_config.bookmarks,\n            true\n        );\n\n        // initialize editor\n        this.init_editor();\n    }\n\n    // view\n    view_new() {\n        let Galaxy = getGalaxyInstance();\n        // ajax\n        $.ajax({\n            url: `${getAppRoot()}api/genomes?chrom_info=True`,\n            data: {},\n            error: () => {\n                alert(\"Couldn't create new browser.\");\n            },\n            success: response => {\n                // show dialog\n                Galaxy.modal.show({\n                    title: _l(\"New Visualization\"),\n                    body: this.template_view_new(response),\n                    buttons: {\n                        Cancel: () => {\n                            window.top.location = `${getAppRoot()}visualizations/list`;\n                        },\n                        Create: () => {\n                            this.create_browser($(\"#new-title\").val(), $(\"#new-dbkey\").val());\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n\n                // select default\n                var dbkeys_in_genomes = response.map(r => r[1]);\n                if (\n                    window.galaxy_config.app.default_dbkey &&\n                    _.contains(dbkeys_in_genomes, window.galaxy_config.app.default_dbkey)\n                ) {\n                    $(\"#new-dbkey\").val(window.galaxy_config.app.default_dbkey);\n                }\n\n                // change focus\n                $(\"#new-title\").focus();\n                $(\"select[name='dbkey']\").select2();\n\n                // to support the large number of options for dbkey, enable scrolling in overlay.\n                $(\"#overlay\").css(\"overflow\", \"auto\");\n            }\n        });\n    }\n\n    // new browser form\n    template_view_new(response) {\n        // start template\n        var html =\n            '<form id=\"new-browser-form\" action=\"javascript:void(0);\" method=\"post\" onsubmit=\"return false;\">' +\n            '<div class=\"form-row\">' +\n            '<label for=\"new-title\">Browser name:</label>' +\n            '<div class=\"form-row-input\">' +\n            '<input type=\"text\" name=\"title\" id=\"new-title\" value=\"Unnamed\"></input>' +\n            \"</div>\" +\n            '<div style=\"clear: both;\"></div>' +\n            \"</div>\" +\n            '<div class=\"form-row\">' +\n            '<label for=\"new-dbkey\">Reference genome build (dbkey): </label>' +\n            '<div class=\"form-row-input\">' +\n            '<select name=\"dbkey\" id=\"new-dbkey\">';\n\n        // add dbkeys\n        for (let i = 0; i < response.length; i++) {\n            html += `<option value=\"${response[i][1]}\">${response[i][0]}</option>`;\n        }\n\n        // close selection/finalize template\n        html += `</select></div><div style=\"clear: both;\"></div></div><div class=\"form-row\">Is the build not listed here? <a href=\"${getAppRoot()}custom_builds\" target=\"_top\">Add a Custom Build</a></div></form>`;\n\n        // return\n        return html;\n    }\n\n    // initialization for editor-specific functions.\n    init_editor() {\n        // set title\n        $(\"#center .unified-panel-title\").text(`${this.ui.view.config.get_value(\"name\")} (${this.ui.view.dbkey})`);\n\n        // add dataset\n        if (window.galaxy_config.app.add_dataset)\n            $.ajax({\n                url: `${getAppRoot()}api/datasets/${window.galaxy_config.app.add_dataset}`,\n                data: { hda_ldda: \"hda\", data_type: \"track_config\" },\n                dataType: \"json\",\n                success: track_data => {\n                    this.ui.view.add_drawable(tracks.object_from_template(track_data, this.ui.view, this.ui.view));\n                }\n            });\n\n        // initialize icons\n        $(\"#add-bookmark-button\").click(() => {\n            // add new bookmark.\n            var position = `${this.ui.view.chrom}:${this.ui.view.low}-${this.ui.view.high}`;\n\n            var annotation = \"Bookmark description\";\n            return this.ui.add_bookmark(position, annotation, true);\n        });\n\n        // initialize keyboard\n        this.ui.init_keyboard_nav(this.ui.view);\n\n        $(window).on(\"beforeunload\", () => {\n            if (this.ui.view.has_changes) {\n                return \"There are unsaved changes to your visualization that will be lost if you leave this page.\";\n            }\n        });\n    }\n\n    // create\n    create_browser(name, dbkey) {\n        $(document).trigger(\"convert_to_values\");\n\n        this.ui.create_visualization(\n            {\n                container: $(\"#center .unified-panel-body\"),\n                name: name,\n                dbkey: dbkey\n            },\n            window.galaxy_config.app.gene_region\n        );\n\n        // initialize editor\n        this.init_editor();\n\n        // modify view setting\n        this.ui.view.editor = true;\n    }\n}\n","import _ from \"underscore\";\nimport BASE_MVC from \"mvc/base-mvc\";\n\n// ============================================================================\n/** session storage for individual history preferences */\nvar HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n    /** @lends HistoryPrefs.prototype */ {\n        //TODO:?? move to user prefs?\n        defaults: {\n            //TODO:?? expandedIds to array?\n            expandedIds: {},\n            show_deleted: false,\n            show_hidden: false\n        },\n\n        /** add an hda id to the hash of expanded hdas */\n        addExpanded: function(model) {\n            //TODO: use type_id and not model\n            var current = this.get(\"expandedIds\");\n            current[model.id] = model.get(\"id\");\n            this.save(\"expandedIds\", current);\n        },\n\n        /** remove an hda id from the hash of expanded hdas */\n        removeExpanded: function(model) {\n            var current = this.get(\"expandedIds\");\n            delete current[model.id];\n            this.save(\"expandedIds\", current);\n        },\n\n        isExpanded: function(contentId) {\n            return _.result(this.get(\"expandedIds\"), contentId, false);\n        },\n\n        allExpanded: function() {\n            return _.values(this.get(\"expandedIds\"));\n        },\n\n        clearExpanded: function() {\n            this.set(\"expandedIds\", {});\n        },\n\n        includeDeleted: function(val) {\n            // moving the invocation here so other components don't need to know the key\n            // TODO: change this key later\n            if (!_.isUndefined(val)) {\n                this.set(\"show_deleted\", val);\n            }\n            return this.get(\"show_deleted\");\n        },\n\n        includeHidden: function(val) {\n            // TODO: change this key later\n            if (!_.isUndefined(val)) {\n                this.set(\"show_hidden\", val);\n            }\n            return this.get(\"show_hidden\");\n        },\n\n        toString: function() {\n            return `HistoryPrefs(${this.id})`;\n        }\n    },\n    {\n        // ........................................................................ class vars\n        // class lvl for access w/o instantiation\n        storageKeyPrefix: \"history:\",\n\n        /** key string to store each histories settings under */\n        historyStorageKey: function historyStorageKey(historyId) {\n            if (!historyId) {\n                throw new Error(`HistoryPrefs.historyStorageKey needs valid id: ${historyId}`);\n            }\n            // single point of change\n            return HistoryPrefs.storageKeyPrefix + historyId;\n        },\n\n        /** return the existing storage for the history with the given id (or create one if it doesn't exist) */\n        get: function get(historyId) {\n            return new HistoryPrefs({\n                id: HistoryPrefs.historyStorageKey(historyId)\n            });\n        },\n\n        /** clear all history related items in sessionStorage */\n        clearAll: function clearAll(historyId) {\n            for (var key in sessionStorage) {\n                if (key.indexOf(HistoryPrefs.storageKeyPrefix) === 0) {\n                    sessionStorage.removeItem(key);\n                }\n            }\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    HistoryPrefs: HistoryPrefs\n};\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport CONTROLLED_FETCH_COLLECTION from \"mvc/base/controlled-fetch-collection\";\nimport HDA_MODEL from \"mvc/history/hda-model\";\nimport HDCA_MODEL from \"mvc/history/hdca-model\";\nimport HISTORY_PREFS from \"mvc/history/history-preferences\";\nimport JOB_STATES_MODEL from \"mvc/history/job-states-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport AJAX_QUEUE from \"utils/ajax-queue\";\n\nconst limitPerPageDefault = window.localStorage.getItem(\"historyContentsLimitPerPageDefault\") || 500;\n\n//==============================================================================\nvar _super = CONTROLLED_FETCH_COLLECTION.PaginatedCollection;\n/** @class Backbone collection for history content.\n *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n *          the same level.\n *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n *          HDAs or child dataset collections on one level.\n *      This is why this does not inherit from any of the DatasetCollections (currently).\n */\nexport var HistoryContents = _super.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    // ........................................................................ set up\n    limitPerPage: limitPerPageDefault,\n\n    /** @type {Integer} how many contents per call to fetch when using progressivelyFetchDetails */\n    limitPerProgressiveFetch: limitPerPageDefault,\n\n    /** @type {String} order used here and when fetching from server */\n    order: \"hid\",\n\n    /** complete api url */\n    url: function() {\n        return `${this.urlRoot}/${this.historyId}/contents`;\n    },\n\n    /** Set up */\n    initialize: function(models, options) {\n        this.on({\n            \"sync add\": this.trackJobStates\n        });\n\n        options = options || {};\n        this.urlRoot = `${getAppRoot()}api/histories`;\n        _super.prototype.initialize.call(this, models, options);\n\n        this.history = options.history || null;\n        this.setHistoryId(options.historyId || null);\n        /** @type {Boolean} does this collection contain and fetch deleted elements */\n        this.includeDeleted = options.includeDeleted || this.includeDeleted;\n        /** @type {Boolean} does this collection contain and fetch non-visible elements */\n        this.includeHidden = options.includeHidden || this.includeHidden;\n\n        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n        this.model.prototype.idAttribute = \"type_id\";\n    },\n\n    trackJobStates: function() {\n        this.each(historyContent => {\n            if (historyContent.has(\"job_states_summary\")) {\n                return;\n            }\n\n            if (historyContent.attributes.history_content_type === \"dataset_collection\") {\n                var jobSourceType = historyContent.attributes.job_source_type;\n                var jobSourceId = historyContent.attributes.job_source_id;\n                if (jobSourceType && this.jobStateSummariesCollection) {\n                    this.jobStateSummariesCollection.add({\n                        id: jobSourceId,\n                        model: jobSourceType,\n                        history_id: this.history_id,\n                        collection_id: historyContent.attributes.id\n                    });\n                    var jobStatesSummary = this.jobStateSummariesCollection.get(jobSourceId);\n                    historyContent.jobStatesSummary = jobStatesSummary;\n                }\n            }\n        });\n    },\n\n    // ........................................................................ composite collection\n    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n    model: function(attrs, options) {\n        if (attrs.history_content_type === \"dataset\") {\n            return new HDA_MODEL.HistoryDatasetAssociation(attrs, options);\n        } else if (attrs.history_content_type === \"dataset_collection\") {\n            return new HDCA_MODEL.HistoryDatasetCollection(attrs, options);\n        } else {\n            return {\n                validationError: `Unknown history_content_type: ${attrs.history_content_type}`\n            };\n        }\n    },\n\n    stopPolling: function() {\n        if (this.jobStateSummariesCollection) {\n            this.jobStateSummariesCollection.active = false;\n            this.jobStateSummariesCollection.clearUpdateTimeout();\n        }\n    },\n\n    setHistoryId: function(newId) {\n        this.stopPolling();\n        this.historyId = newId;\n        if (newId) {\n            // If actually reflecting a history - setup storage and monitor jobs.\n\n            this._setUpWebStorage();\n\n            this.jobStateSummariesCollection = new JOB_STATES_MODEL.JobStatesSummaryCollection();\n            this.jobStateSummariesCollection.historyId = newId;\n            this.jobStateSummariesCollection.monitor();\n        }\n    },\n\n    /** Set up client side storage. Currently PersistanStorage keyed under 'history:<id>' */\n    _setUpWebStorage: function(initialSettings) {\n        // TODO: use initialSettings\n        this.storage = new HISTORY_PREFS.HistoryPrefs({\n            id: HISTORY_PREFS.HistoryPrefs.historyStorageKey(this.historyId)\n        });\n        this.trigger(\"new-storage\", this.storage, this);\n\n        this.on({\n            \"include-deleted\": function(newVal) {\n                this.storage.includeDeleted(newVal);\n            },\n            \"include-hidden\": function(newVal) {\n                this.storage.includeHidden(newVal);\n            }\n        });\n\n        this.includeDeleted = this.storage.includeDeleted() || false;\n        this.includeHidden = this.storage.includeHidden() || false;\n        return this;\n    },\n\n    // ........................................................................ common queries\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_super.prototype.comparators), {\n        name: BASE_MVC.buildComparator(\"name\", { ascending: true }),\n        \"name-dsc\": BASE_MVC.buildComparator(\"name\", {\n            ascending: false\n        }),\n        hid: BASE_MVC.buildComparator(\"hid\", { ascending: false }),\n        \"hid-asc\": BASE_MVC.buildComparator(\"hid\", { ascending: true })\n    }),\n\n    /** Get every model in this collection not in a 'ready' state (running). */\n    running: function() {\n        return this.filter(c => !c.inReadyState());\n    },\n\n    /** return contents that are not ready and not deleted/hidden */\n    runningAndActive: function() {\n        return this.filter(\n            c =>\n                !c.inReadyState() &&\n                c.get(\"visible\") &&\n                // TODO: deletedOrPurged?\n                !c.get(\"deleted\")\n        );\n    },\n\n    /** Get the model with the given hid\n     *  @param {Int} hid the hid to search for\n     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n     */\n    getByHid: function(hid) {\n        // note: there *can* be more than one content with a given hid, this finds the first based on order\n        return this.findWhere({ hid: hid });\n    },\n\n    /** return true if all contents have details */\n    haveDetails: function() {\n        return this.all(c => c.hasDetails());\n    },\n\n    // ........................................................................ hidden / deleted\n    /** return a new contents collection of only hidden items */\n    hidden: function() {\n        return this.filter(c => c.hidden());\n    },\n\n    /** return a new contents collection of only hidden items */\n    deleted: function() {\n        return this.filter(c => c.get(\"deleted\"));\n    },\n\n    /** return a new contents collection of only hidden items */\n    visibleAndUndeleted: function() {\n        return this.filter(\n            c =>\n                c.get(\"visible\") &&\n                // TODO: deletedOrPurged?\n                !c.get(\"deleted\")\n        );\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeDeleted: function(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeDeleted) {\n            this.includeDeleted = setting;\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-deleted\", setting, this);\n        }\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeHidden: function(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeHidden) {\n            this.includeHidden = setting;\n            options = options || {};\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-hidden\", setting, this);\n        }\n    },\n\n    // ........................................................................ ajax\n    // ............ controlled fetch collection\n    /** override to get expanded ids from sessionStorage and pass to API as details */\n    fetch: function(options) {\n        options = options || {};\n        if (this.historyId && !options.details) {\n            var prefs = HISTORY_PREFS.HistoryPrefs.get(this.historyId).toJSON();\n            if (!_.isEmpty(prefs.expandedIds)) {\n                options.details = _.values(prefs.expandedIds).join(\",\");\n            }\n        }\n        return _super.prototype.fetch.call(this, options);\n    },\n\n    // ............. ControlledFetch stuff\n    /** override to include the API versioning flag */\n    _buildFetchData: function(options) {\n        return _.extend(_super.prototype._buildFetchData.call(this, options), {\n            v: \"dev\"\n        });\n    },\n\n    /** Extend to include details and version */\n    _fetchParams: _super.prototype._fetchParams.concat([\n        // TODO: remove (the need for) both\n        /** version */\n        \"v\",\n        /** dataset ids to get full details of */\n        \"details\"\n    ]),\n\n    /** override to add deleted/hidden filters */\n    _buildFetchFilters: function(options) {\n        var superFilters = _super.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (!this.includeDeleted) {\n            filters.deleted = false;\n            filters.purged = false;\n        }\n        if (!this.includeHidden) {\n            filters.visible = true;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    // ............ paginated collection\n    getTotalItemCount: function() {\n        return this.history.contentsShown();\n    },\n\n    // ............ history contents specific ajax\n    /** override to filter requested contents to those updated after the Date 'since' */\n    fetchUpdated: function(since, options) {\n        if (since) {\n            options = options || { filters: {} };\n            options.remove = false;\n            options.filters = {\n                \"update_time-ge\": since.toISOString(),\n                // workflows will produce hidden datasets (non-output datasets) that still\n                // need to be updated in the collection or they'll update forever\n                // we can remove the default visible filter by using an 'empty' value\n                visible: \"\"\n            };\n        }\n        return this.fetch(options);\n    },\n\n    /** fetch all the deleted==true contents of this collection */\n    fetchDeleted: function(options) {\n        options = options || {};\n        options.filters = _.extend(options.filters, {\n            // all deleted, purged or not\n            deleted: true,\n            purged: undefined\n        });\n        options.remove = false;\n\n        this.trigger(\"fetching-deleted\", this);\n        return this.fetch(options).always(() => {\n            this.trigger(\"fetching-deleted-done\", this);\n        });\n    },\n\n    /** fetch all the visible==false contents of this collection */\n    fetchHidden: function(options) {\n        options = options || {};\n        options.filters = _.extend(options.filters, {\n            visible: false\n        });\n        options.remove = false;\n\n        this.trigger(\"fetching-hidden\", this);\n        return this.fetch(options).always(() => {\n            this.trigger(\"fetching-hidden-done\", this);\n        });\n    },\n\n    /** fetch detailed model data for all contents in this collection */\n    fetchAllDetails: function(options) {\n        options = options || {};\n        var detailsFlag = { details: \"all\" };\n        options.data = _.extend(options.data || {}, detailsFlag);\n        return this.fetch(options);\n    },\n\n    // ............. quasi-batch ops\n    // TODO: to batch\n    /** helper that fetches using filterParams then calls save on each fetched using updateWhat as the save params */\n    _filterAndUpdate: function(filterParams, updateWhat) {\n        var idAttribute = this.model.prototype.idAttribute;\n        var updateArgs = [updateWhat];\n\n        return this.fetch({ filters: filterParams, remove: false }).then(fetched => {\n            // convert filtered json array to model array\n            fetched = fetched.reduce((modelArray, currJson, i) => {\n                var model = this.get(currJson[idAttribute]);\n                return model ? modelArray.concat(model) : modelArray;\n            }, []);\n            return this.ajaxQueue(\"save\", updateArgs, fetched);\n        });\n    },\n\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue: function(ajaxFn, args, collection) {\n        collection = collection || this.models;\n        return new AJAX_QUEUE.AjaxQueue(\n            collection\n                .slice()\n                .reverse()\n                .map((content, i) => {\n                    var fn = _.isString(ajaxFn) ? content[ajaxFn] : ajaxFn;\n                    return () => fn.apply(content, args);\n                })\n        ).deferred;\n    },\n\n    _recursivelyFetch: function(options, detailKeys, deferred, limit, offset) {\n        offset = offset || 0;\n        var _options = _.extend(_.clone(options), {\n            view: \"summary\",\n            keys: detailKeys,\n            limit: limit,\n            offset: offset,\n            reset: offset === 0,\n            remove: false\n        });\n\n        _.defer(() => {\n            this.fetch\n                .call(this, _options)\n                .fail(deferred.reject)\n                .done(response => {\n                    deferred.notify(response, limit, offset);\n                    if (response.length !== limit) {\n                        this.allFetched = true;\n                        deferred.resolve(response, limit, offset);\n                    } else {\n                        this._recursivelyFetch(options, detailKeys, deferred, limit, offset + limit);\n                    }\n                });\n        });\n    },\n\n    /** fetch contents' details in batches of limitPerCall - note: only get searchable details here */\n    progressivelyFetchDetails: function(options) {\n        // TODO: only fetch tags and annotations if specifically requested\n        options = options || {};\n        let deferred = jQuery.Deferred();\n        this._recursivelyFetch(\n            options,\n            HDA_MODEL.HistoryDatasetAssociation.prototype.searchAttributes.join(\",\"),\n            deferred,\n            options.limitPerCall || this.limitPerProgressiveFetch\n        );\n        return deferred;\n    },\n\n    /** does some bit of JSON represent something that can be copied into this contents collection */\n    isCopyable: function(contentsJSON) {\n        var copyableModelClasses = [\"HistoryDatasetAssociation\", \"HistoryDatasetCollectionAssociation\"];\n        return (\n            _.isObject(contentsJSON) && contentsJSON.id && _.contains(copyableModelClasses, contentsJSON.model_class)\n        );\n    },\n\n    /** copy an existing, accessible hda into this collection */\n    copy: function(json) {\n        // TODO: somehow showhorn all this into 'save'\n        var id;\n\n        var type;\n        var contentType;\n        if (_.isString(json)) {\n            id = json;\n            contentType = \"hda\";\n            type = \"dataset\";\n        } else {\n            id = json.id;\n            contentType =\n                {\n                    HistoryDatasetAssociation: \"hda\",\n                    LibraryDatasetDatasetAssociation: \"ldda\",\n                    HistoryDatasetCollectionAssociation: \"hdca\"\n                }[json.model_class] || \"hda\";\n            type = contentType === \"hdca\" ? \"dataset_collection\" : \"dataset\";\n        }\n        var collection = this;\n\n        var xhr = jQuery\n            .ajax(this.url(), {\n                method: \"POST\",\n                contentType: \"application/json\",\n                data: JSON.stringify({\n                    content: id,\n                    source: contentType,\n                    type: type\n                })\n            })\n            .done(response => {\n                collection.add([response], { parse: true });\n            })\n            .fail((error, status, message) => {\n                collection.trigger(\"error\", collection, xhr, {}, \"Error copying contents\", {\n                    type: type,\n                    id: id,\n                    source: contentType\n                });\n            });\n\n        return xhr;\n    },\n\n    /** create a new HDCA in this collection */\n    createHDCA: function(elementIdentifiers, collectionType, name, hideSourceItems, copyElements, options) {\n        // normally collection.create returns the new model, but we need the promise from the ajax, so we fake create\n        //precondition: elementIdentifiers is an array of plain js objects\n        //  in the proper form to create the collectionType\n        if (copyElements === undefined) {\n            copyElements = true;\n        }\n\n        var hdca = this.model({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: this.historyId,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            copy_elements: copyElements,\n            // should probably be able to just send in a bunch of json here and restruct per class\n            // note: element_identifiers is now (incorrectly) an attribute\n            element_identifiers: elementIdentifiers\n            // do not create the model on the client until the ajax returns\n        });\n        return hdca.save(options);\n    },\n\n    // ........................................................................ searching\n    /** return true if all contents have the searchable attributes */\n    haveSearchDetails: function() {\n        return (\n            this.allFetched &&\n            this.all((\n                content // null (which is a valid returned annotation value)\n            ) =>\n                // will return false when using content.has( 'annotation' )\n                //TODO: a bit hacky - formalize\n                _.has(content.attributes, \"annotation\")\n            )\n        );\n    },\n\n    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n    matches: function(matchesWhat) {\n        return this.filter(content => content.matches(matchesWhat));\n    },\n\n    // ........................................................................ misc\n    /** In this override, copy the historyId to the clone */\n    clone: function() {\n        var clone = Backbone.Collection.prototype.clone.call(this);\n        clone.historyId = this.historyId;\n        return clone;\n    },\n\n    /** String representation. */\n    toString: function() {\n        return [\"HistoryContents(\", [this.historyId, this.length].join(), \")\"].join(\"\");\n    }\n});\n","//==============================================================================\nvar LOGGING_FNS = [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"];\n/** adds logging functions to an obj.prototype (or obj directly) adding a namespace for filtering\n *  @param {Object} obj\n *  @param {String} namespace\n */\nfunction addLogging(obj, namespace) {\n    var addTo = obj.prototype !== undefined ? obj.prototype : obj;\n    if (namespace !== undefined) {\n        addTo._logNamespace = namespace;\n    }\n\n    // give the object each\n    LOGGING_FNS.forEach(logFn => {\n        addTo[logFn] = function() {\n            if (!this.logger) {\n                return undefined;\n            }\n            if (this.logger.emit) {\n                return this.logger.emit(logFn, this._logNamespace, arguments);\n            }\n            if (this.logger[logFn]) {\n                //TODO:! there has to be a way to get the lineno/file into this\n                // http://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number\n                // http://www.paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/\n                return this.logger[logFn].apply(this.logger, arguments);\n            }\n            return undefined;\n        };\n    });\n    return obj;\n}\n\n//==============================================================================\nexport default addLogging;\n","import $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\n\nexport var View = Backbone.View.extend({\n    visible: false,\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                cls: \"ui-portlet\",\n                title: \"\",\n                icon: \"\",\n                buttons: null,\n                body: null,\n                scrollable: true,\n                operations: null,\n                collapsible: false,\n                collapsible_button: true,\n                collapsed: false,\n                onchange_title: null\n            }).set(options);\n        this.setElement(this._template());\n\n        // link all dom elements\n        this.$body = this.$(\".portlet-body\");\n        this.$title = this.$(\".portlet-title\");\n        this.$title_text = this.$(\".portlet-title-text\");\n        this.$title_icon = this.$(\".portlet-title-icon\");\n        this.$header = this.$(\".portlet-header\");\n        this.$content = this.$(\".portlet-content\");\n        this.$backdrop = this.$(\".portlet-backdrop\");\n        this.$buttons = this.$(\".portlet-buttons\");\n        this.$operations = this.$(\".portlet-operations\");\n\n        // add body to component list\n        this.model.get(\"body\") && this.append(this.model.get(\"body\"));\n\n        // add icon for collapsible option\n        this.collapsible_button = new Ui.Button({\n            icon: \"fa-eye\",\n            tooltip: \"Collapse/Expand\",\n            cls: \"ui-button-icon-plain\",\n            onclick: function() {\n                self[self.collapsed ? \"expand\" : \"collapse\"]();\n            }\n        });\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$el\n            .removeClass()\n            .addClass(options.cls)\n            .attr(\"id\", options.id);\n        this.$header[options.title ? \"show\" : \"hide\"]();\n        this.$title_text.html(options.title);\n        if (options.title_id) {\n            this.$title.attr(\"id\", options.title_id);\n        }\n\n        // render title icon\n        if (options.icon) {\n            this.$title_icon\n                .removeClass()\n                .addClass(\"portlet-title-icon fa mr-1\")\n                .addClass(options.icon)\n                .show();\n        } else {\n            this.$title_icon.hide();\n        }\n\n        // make portlet collapsible\n        this.$title_text[options.collapsible ? \"addClass\" : \"removeClass\"](\"no-highlight collapsible\").off();\n        if (options.collapsible) {\n            this.$title_text.on(\"click\", () => {\n                self[self.collapsed ? \"expand\" : \"collapse\"]();\n            });\n            options.collapsed ? this.collapse() : this.expand();\n        }\n\n        // allow title editing\n        this.$title_text.prop(\"disabled\", !options.onchange_title);\n        options.onchange_title &&\n            this.$title_text.make_text_editable({\n                on_finish: function(new_title) {\n                    options.onchange_title(new_title);\n                }\n            });\n\n        // render buttons\n        if (options.buttons) {\n            this.$buttons.empty().show();\n            $.each(this.model.get(\"buttons\"), (name, item) => {\n                item.$el.prop(\"id\", name);\n                self.$buttons.append(item.$el);\n            });\n        } else {\n            this.$buttons.hide();\n        }\n\n        // render operations\n        this.$operations.empty;\n        if (options.collapsible && options.collapsible_button) {\n            this.$operations.append(this.collapsible_button.$el);\n        }\n        if (options.operations) {\n            $.each(options.operations, (name, item) => {\n                item.$el.prop(\"id\", name);\n                self.$operations.append(item.$el);\n            });\n        }\n        return this;\n    },\n\n    /** Append new doms to body */\n    append: function($el) {\n        this.$body.append($el);\n    },\n\n    /** Remove all content */\n    empty: function() {\n        this.$body.empty();\n    },\n\n    /** Return header element */\n    header: function() {\n        return this.$header;\n    },\n\n    /** Return body element */\n    body: function() {\n        return this.$body;\n    },\n\n    /** Show portlet */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn(\"fast\");\n    },\n\n    /** Hide portlet */\n    hide: function() {\n        this.visible = false;\n        this.$el.hide();\n    },\n\n    /** Enable a particular button */\n    enableButton: function(id) {\n        this.$buttons.find(`#${id}`).prop(\"disabled\", false);\n    },\n\n    /** Disable a particular button */\n    disableButton: function(id) {\n        this.$buttons.find(`#${id}`).prop(\"disabled\", true);\n    },\n\n    /** Hide a particular operation */\n    hideOperation: function(id) {\n        this.$operations.find(`#${id}`).hide();\n    },\n\n    /** Show a particular operation */\n    showOperation: function(id) {\n        this.$operations.find(`#${id}`).show();\n    },\n\n    /** Replaces the event callback of an existing operation */\n    setOperation: function(id, callback) {\n        this.$operations\n            .find(`#${id}`)\n            .off(\"click\")\n            .on(\"click\", callback);\n    },\n\n    /** Change title */\n    title: function(new_title) {\n        new_title && this.$title_text.html(new_title);\n        return this.$title_text.html();\n    },\n\n    /** Collapse portlet */\n    collapse: function() {\n        this.collapsed = true;\n        this.$content.hide();\n        this.collapsible_button.setIcon(\"fa-eye-slash\");\n    },\n\n    /** Expand portlet */\n    expand: function() {\n        this.collapsed = false;\n        this.$content.show();\n        this.collapsible_button.setIcon(\"fa-eye\");\n    },\n\n    /** Disable content access */\n    disable: function() {\n        this.$backdrop.show();\n    },\n\n    /** Enable content access */\n    enable: function() {\n        this.$backdrop.hide();\n    },\n\n    _template: function() {\n        return $(\"<div/>\")\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"portlet-header\")\n                    .append($(\"<div/>\").addClass(\"portlet-operations\"))\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"portlet-title\")\n                            .append($(\"<i/>\").addClass(\"portlet-title-icon\"))\n                            .append($(\"<span/>\").addClass(\"portlet-title-text\"))\n                    )\n            )\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"portlet-content\")\n                    .append($(\"<div/>\").addClass(\"portlet-body\"))\n                    .append($(\"<div/>\").addClass(\"portlet-buttons mt-3 mb-3\"))\n            )\n            .append($(\"<div/>\").addClass(\"portlet-backdrop\"));\n    }\n});\nexport default {\n    View: View\n};\n","import { hashFnv32a } from \"utils/utils\";\n\n/**\n * Implement W3C contrasting color algorithm\n * http://www.w3.org/TR/AERT#color-contrast\n *\n * @param   {number}  r       Red\n * @param   {number}  g       Green\n * @param   {number}  b       Blue\n * @return  {string}          Either 'white' or 'black'\n *\n * Assumes r, g, b are in the set [0, 1]\n */\nexport function contrastingColor(r, g, b) {\n    var o = (r * 255 * 299 + g * 255 * 587 + b * 255 * 114) / 1000;\n    return o > 125 ? \"black\" : \"white\";\n}\n\n/**\n * Converts an HSL color value to RGB. Conversion formula\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\n * Assumes h, s, and l are contained in the set [0, 1] and\n * returns r, g, and b in the set [0, 1].\n *\n * @param   {number}  h       The hue\n * @param   {number}  s       The saturation\n * @param   {number}  l       The lightness\n * @return  {Array}           The RGB representation\n */\nexport function hslToRgb(h, s, l) {\n    var r, g, b;\n\n    if (s == 0) {\n        r = g = b = l; // achromatic\n    } else {\n        var hue2rgb = function hue2rgb(p, q, t) {\n            if (t < 0) t += 1;\n            if (t > 1) t -= 1;\n            if (t < 1 / 6) return p + (q - p) * 6 * t;\n            if (t < 1 / 2) return q;\n            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n            return p;\n        };\n\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1 / 3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [r, g, b];\n}\n\n/**\n * Simple 3-color keyed color scheme generated\n * from a string key\n */\nexport function keyedColorScheme(strKey) {\n    let hash = hashFnv32a(strKey);\n    let hue = Math.abs((hash >> 4) % 360);\n    let lightnessOffset = 75;\n    let lightness = lightnessOffset + (hash & 0xf);\n\n    let primary = `hsl(${hue}, 100%, ${lightness}%)`;\n    let darker = `hsl(${hue}, 100%, ${lightness - 40}%)`;\n    let [r, g, b] = hslToRgb(hue, 1.0, lightness / 100);\n    let contrasting = contrastingColor(r, g, b);\n\n    return { primary, darker, contrasting };\n}\n","import $ from \"jquery\";\n\nexport function init_refresh_on_change() {\n    console.log(\"init_refresh_on_change\");\n\n    $(\"select[refresh_on_change='true']\")\n        .off(\"change\")\n        .change(function() {\n            var select_field = $(this);\n            var select_val = select_field.val();\n            var ref_on_change_vals = select_field.attr(\"refresh_on_change_values\");\n            if (ref_on_change_vals) {\n                ref_on_change_vals = ref_on_change_vals.split(\",\");\n                var last_selected_value = select_field.attr(\"last_selected_value\");\n                if (\n                    $.inArray(select_val, ref_on_change_vals) === -1 &&\n                    $.inArray(last_selected_value, ref_on_change_vals) === -1\n                ) {\n                    return;\n                }\n            }\n            $(window).trigger(\"refresh_on_change\");\n            $(document).trigger(\"convert_to_values\"); // Convert autocomplete text to values\n            select_field.get(0).form.submit();\n        });\n\n    // checkboxes refresh on change\n    $(\":checkbox[refresh_on_change='true']\")\n        .off(\"click\")\n        .click(function() {\n            var select_field = $(this);\n            var select_val = select_field.val();\n            var ref_on_change_vals = select_field.attr(\"refresh_on_change_values\");\n            if (ref_on_change_vals) {\n                ref_on_change_vals = ref_on_change_vals.split(\",\");\n                var last_selected_value = select_field.attr(\"last_selected_value\");\n                if (\n                    $.inArray(select_val, ref_on_change_vals) === -1 &&\n                    $.inArray(last_selected_value, ref_on_change_vals) === -1\n                ) {\n                    return;\n                }\n            }\n            $(window).trigger(\"refresh_on_change\");\n            select_field.get(0).form.submit();\n        });\n\n    // Links with confirmation\n    $(\"a[confirm]\")\n        .off(\"click\")\n        .click(function() {\n            return confirm($(this).attr(\"confirm\"));\n        });\n}\n","/* For presentation-related functionality shared across collection creators.\n   Particularily overlapping functionality related to name processing and help.\n*/\nimport _ from \"underscore\";\nvar CollectionCreatorMixin = {\n    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n    _validationWarning: function(what, clear) {\n        var VALIDATION_CLASS = \"validation-warning\";\n        if (what === \"name\") {\n            what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n            this.$(\".collection-name\")\n                .focus()\n                .select();\n        }\n        if (clear) {\n            what = what || this.$(`.${VALIDATION_CLASS}`);\n            what.removeClass(VALIDATION_CLASS);\n        } else {\n            what.addClass(VALIDATION_CLASS);\n        }\n    },\n\n    _changeHideOriginals: function(ev) {\n        this.hideOriginals = this.$(\".hide-originals\").prop(\"checked\");\n    },\n\n    // ........................................................................ footer\n    /** handle a collection name change */\n    _changeName: function(ev) {\n        this._validationWarning(\"name\", !!this._getName());\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter: function(ev) {\n        if (ev.keyCode === 13 && !this.blocking) {\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName: function() {\n        return _.escape(this.$(\".collection-name\").val());\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").addClass(\"expanded\");\n        this.$(\".more-help\").hide();\n    },\n    /** collapse help */\n    _clickLessHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").removeClass(\"expanded\");\n        this.$(\".more-help\").show();\n    },\n    /** toggle help */\n    _toggleHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").toggleClass(\"expanded\");\n        this.$(\".more-help\").toggle();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n    _showAlert: function(message, alertClass) {\n        alertClass = alertClass || \"alert-danger\";\n        this.$(\".main-help\").hide();\n        this.$(\".header .alert\")\n            .attr(\"class\", \"alert alert-dismissable\")\n            .addClass(alertClass)\n            .show()\n            .find(\".alert-message\")\n            .html(message);\n    },\n    /** hide the alerts at the top */\n    _hideAlert: function(message) {\n        this.$(\".main-help\").show();\n        this.$(\".header .alert\").hide();\n    },\n\n    _cancelCreate: function(ev) {\n        if (typeof this.oncancel === \"function\") {\n            this.oncancel.call(this);\n        }\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate: function(ev) {\n        var name = this._getName();\n        if (!name) {\n            this._validationWarning(\"name\");\n        } else if (!this.blocking) {\n            this.createList(name);\n        }\n    },\n\n    _setUpCommonSettings: function(attributes) {\n        this.hideOriginals = attributes.defaultHideSourceItems || false;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter: function(speed, callback) {\n        var self = this;\n        var $footer = this.$(\".footer\")\n            .empty()\n            .html(this.templates.footer());\n        _.each(this.footerSettings, (property, selector) => {\n            self.$(selector).prop(\"checked\", self[property]);\n        });\n        if (typeof this.oncancel === \"function\") {\n            this.$(\".cancel-create.btn\").show();\n        }\n        return $footer;\n    },\n\n    _creatorTemplates: {\n        main: _.template(\n            [\n                '<div class=\"header flex-row no-flex\"></div>',\n                '<div class=\"middle flex-row flex-row-container\"></div>',\n                '<div class=\"footer flex-row no-flex\"></div>'\n            ].join(\"\")\n        )\n    }\n};\n\n//==============================================================================\nexport default {\n    CollectionCreatorMixin: CollectionCreatorMixin\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport addLogging from \"utils/add-logging\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/** @class Mixin to add logging capabilities to an object.\n *      Designed to allow switching an objects log output off/on at one central\n *      statement. Can be used with plain browser console (or something more\n *      complex like an AJAX logger).\n *  <br />NOTE: currently only uses the console.debug log function\n *  (as opposed to debug, error, warn, etc.)\n *  @name LoggableMixin\n *\n *  @example\n *  // Add to your models/views at the definition using chaining:\n *      var MyModel = Backbone.Model.extend( LoggableMixin ).extend({ // ... });\n *\n *  // or - more explicitly AFTER the definition:\n *      var MyModel = Backbone.Model.extend({\n *          logger  : console\n *          // ...\n *          this.log( '$#%& it! - broken already...' );\n *      })\n *      _.extend( MyModel.prototype, LoggableMixin )\n *\n */\nvar LoggableMixin = /** @lends LoggableMixin# */ {\n    // replace null with console (if available) to see all logs for a particular view/model\n    /** The logging object whose log function will be used to output\n     *      messages. Null will supress all logging. Commonly set to console.\n     */\n    logger: null,\n    /** @type {String} a namespace for filtering/focusing log output */\n    _logNamespace: \".\"\n};\naddLogging(LoggableMixin);\n\n//==============================================================================\n/** Backbone model that syncs to the browser's sessionStorage API.\n *      This all largely happens behind the scenes and no special calls are required.\n */\nvar SessionStorageModel = Backbone.Model.extend({\n    initialize: function(initialAttrs) {\n        // check for sessionStorage and error if no id is provided\n        this._checkEnabledSessionStorage();\n        if (!initialAttrs.id) {\n            throw new Error(\"SessionStorageModel requires an id in the initial attributes\");\n        }\n        this.id = initialAttrs.id;\n\n        // load existing from storage (if any), clear any attrs set by bbone before init is called,\n        //  layer initial over existing and defaults, and save\n        var existing = !this.isNew() ? this._read(this) : {};\n        this.clear({ silent: true });\n        this.save(_.extend({}, this.defaults, existing, initialAttrs), {\n            silent: true\n        });\n\n        // save on any change to it immediately\n        this.on(\"change\", function() {\n            this.save();\n        });\n    },\n\n    _checkEnabledSessionStorage: function() {\n        try {\n            return window.sessionStorage.length >= 0;\n        } catch (err) {\n            alert(\"Please enable cookies in your browser for this Galaxy site\");\n            return false;\n        }\n    },\n\n    /** override of bbone sync to save to sessionStorage rather than REST\n     *      bbone options (success, errror, etc.) should still apply\n     */\n    sync: function(method, model, options) {\n        if (!options.silent) {\n            model.trigger(\"request\", model, {}, options);\n        }\n        var returned = {};\n        switch (method) {\n            case \"create\":\n                returned = this._create(model);\n                break;\n            case \"read\":\n                returned = this._read(model);\n                break;\n            case \"update\":\n                returned = this._update(model);\n                break;\n            case \"delete\":\n                returned = this._delete(model);\n                break;\n        }\n        if (returned !== undefined || returned !== null) {\n            if (options.success) {\n                options.success();\n            }\n        } else {\n            if (options.error) {\n                options.error();\n            }\n        }\n        return returned;\n    },\n\n    /** set storage to the stringified item */\n    _create: function(model) {\n        try {\n            var json = model.toJSON();\n            var set = sessionStorage.setItem(model.id, JSON.stringify(json));\n            return set === null ? set : json;\n            // DOMException is thrown in Safari if in private browsing mode and sessionStorage is attempted:\n            // http://stackoverflow.com/questions/14555347\n            // TODO: this could probably use a more general soln - like detecting priv. mode + safari => non-ajaxing Model\n        } catch (err) {\n            if (!(err instanceof DOMException && navigator.userAgent.indexOf(\"Safari\") > -1)) {\n                throw err;\n            }\n        }\n        return null;\n    },\n\n    /** read and parse json from storage */\n    _read: function(model) {\n        return JSON.parse(sessionStorage.getItem(model.id));\n    },\n\n    /** set storage to the item (alias to create) */\n    _update: function(model) {\n        return model._create(model);\n    },\n\n    /** remove the item from storage */\n    _delete: function(model) {\n        return sessionStorage.removeItem(model.id);\n    },\n\n    /** T/F whether sessionStorage contains the model's id (data is present) */\n    isNew: function() {\n        return !sessionStorage.hasOwnProperty(this.id);\n    },\n\n    _log: function() {\n        return JSON.stringify(this.toJSON(), null, \"  \");\n    },\n    toString: function() {\n        return `SessionStorageModel(${this.id})`;\n    }\n});\n(() => {\n    SessionStorageModel.prototype = _.omit(SessionStorageModel.prototype, \"url\", \"urlRoot\");\n})();\n\n//==============================================================================\n/** Function that allows mixing of hashs into bbone MVC while showing the mixins first\n *      (before the more local class overrides/hash).\n *      Basically, a simple reversal of param order on _.defaults() - to show mixins in top of definition.\n *  @example:\n *      var NewModel = Something.extend( mixin( MyMixinA, MyMixinB, { ... myVars : ... }) );\n *\n *  NOTE: this does not combine any hashes (like events, etc.) and you're expected to handle that\n */\nfunction mixin(mixinHash1, /* mixinHash2, etc: ... variadic */ propsHash) {\n    var args = Array.prototype.slice.call(arguments, 0);\n    var lastArg = args.pop();\n    args.unshift(lastArg);\n    return _.defaults.apply(_, args);\n}\n\n//==============================================================================\n/** A mixin for models that allow T/F/Matching to their attributes - useful when\n *      searching or filtering collections of models.\n * @example:\n *      see hda-model for searchAttribute and searchAliases definition examples.\n *      see history-contents.matches for how collections are filtered\n *      and see readonly-history-view.searchHdas for how user input is connected to the filtering\n */\nvar SearchableModelMixin = {\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes: [\n        // override\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases: {\n        // override\n    },\n\n    /** search the attribute with key attrKey for the string searchFor; T/F if found */\n    searchAttribute: function(attrKey, searchFor) {\n        var attrVal = this.get(attrKey);\n        //this.debug( 'searchAttribute', attrKey, attrVal, searchFor );\n        // bail if empty searchFor or unsearchable values\n        if (!searchFor || (attrVal === undefined || attrVal === null)) {\n            return false;\n        }\n        // pass to sep. fn for deep search of array attributes\n        if (_.isArray(attrVal)) {\n            return this._searchArrayAttribute(attrVal, searchFor);\n        }\n        return (\n            attrVal\n                .toString()\n                .toLowerCase()\n                .indexOf(searchFor.toLowerCase()) !== -1\n        );\n    },\n\n    /** deep(er) search for array attributes; T/F if found */\n    _searchArrayAttribute: function(array, searchFor) {\n        //this.debug( '_searchArrayAttribute', array, searchFor );\n        searchFor = searchFor.toLowerCase();\n        //precondition: searchFor has already been validated as non-empty string\n        //precondition: assumes only 1 level array\n        //TODO: could possibly break up searchFor more (CSV...)\n        return _.any(\n            array,\n            elem =>\n                elem\n                    .toString()\n                    .toLowerCase()\n                    .indexOf(searchFor.toLowerCase()) !== -1\n        );\n    },\n\n    /** search all searchAttributes for the string searchFor,\n     *      returning a list of keys of attributes that contain searchFor\n     */\n    search: function(searchFor) {\n        var model = this;\n        return _.filter(this.searchAttributes, key => model.searchAttribute(key, searchFor));\n    },\n\n    /** alias of search, but returns a boolean; accepts attribute specifiers where\n     *      the attributes searched can be narrowed to a single attribute using\n     *      the form: matches( 'genome_build=hg19' )\n     *      (the attribute keys allowed can also be aliases to the true attribute key;\n     *          see searchAliases above)\n     *  @param {String} term   plain text or ATTR_SPECIFIER sep. key=val pair\n     *  @returns {Boolean} was term found in (any) attribute(s)\n     */\n    matches: function(term) {\n        var ATTR_SPECIFIER = \"=\";\n        var split = term.split(ATTR_SPECIFIER);\n        // attribute is specified - search only that\n        if (split.length >= 2) {\n            var attrKey = split[0];\n            attrKey = this.searchAliases[attrKey] || attrKey;\n            return this.searchAttribute(attrKey, split[1]);\n        }\n        // no attribute is specified - search all attributes in searchAttributes\n        return !!this.search(term).length;\n    },\n\n    /** an implicit AND search for all terms; IOW, a model must match all terms given\n     *      where terms is a whitespace separated value string.\n     *      e.g. given terms of: 'blah bler database=hg19'\n     *          an HDA would have to have attributes containing blah AND bler AND a genome_build == hg19\n     *      To include whitespace in terms: wrap the term in double quotations (name=\"blah bler\").\n     */\n    matchesAll: function(terms) {\n        var model = this;\n        // break the terms up by whitespace and filter out the empty strings\n        terms = terms.match(/(\".*\"|\\w*=\".*\"|\\S*)/g).filter(s => !!s);\n        return _.all(terms, term => {\n            term = term.replace(/\"/g, \"\");\n            return model.matches(term);\n        });\n    }\n};\n\n//==============================================================================\n/** A view that renders hidden and shows when some activator is clicked.\n *      options:\n *          showFn: the effect used to show/hide the View (defaults to jq.toggle)\n *          $elementShown: some jqObject (defaults to this.$el) to be shown/hidden\n *          onShowFirstTime: fn called the first time the view is shown\n *          onshow: fn called every time the view is shown\n *          onhide: fn called every time the view is hidden\n *      events:\n *          hiddenUntilActivated:shown (the view is passed as an arg)\n *          hiddenUntilActivated:hidden (the view is passed as an arg)\n *      instance vars:\n *          view.hidden {boolean} is the view in the hidden state\n */\nvar HiddenUntilActivatedViewMixin = /** @lends hiddenUntilActivatedMixin# */ {\n    //TODO: since this is a mixin, consider moving toggle, hidden into HUAVOptions\n\n    /** call this in your initialize to set up the mixin\n     *  @param {jQuery} $activator the 'button' that's clicked to show/hide the view\n     *  @param {Object} hash with mixin options\n     */\n    hiddenUntilActivated: function($activator, options) {\n        // call this in your view's initialize fn\n        options = options || {};\n        //TODO: flesh out options - show them all here\n        this.HUAVOptions = {\n            $elementShown: this.$el,\n            showFn: $.prototype.toggle,\n            showSpeed: \"fast\"\n        };\n        _.extend(this.HUAVOptions, options || {});\n        /** has this been shown already (and onshowFirstTime called)? */\n        this.HUAVOptions.hasBeenShown = this.HUAVOptions.$elementShown.is(\":visible\");\n        this.hidden = this.isHidden();\n\n        if ($activator) {\n            var mixin = this;\n            $activator.on(\"click\", ev => {\n                mixin.toggle(mixin.HUAVOptions.showSpeed);\n            });\n        }\n    },\n\n    //TODO:?? remove? use .hidden?\n    /** returns T/F if the view is hidden */\n    isHidden: function() {\n        return this.HUAVOptions.$elementShown.is(\":hidden\");\n    },\n\n    /** toggle the hidden state, show/hide $elementShown, call onshow/hide, trigger events */\n    toggle: function() {\n        //TODO: more specific name - toggle is too general\n        // can be called manually as well with normal toggle arguments\n        //TODO: better as a callback (when the show/hide is actually done)\n        // show\n        if (this.hidden) {\n            // fire the optional fns on the first/each showing - good for render()\n            if (!this.HUAVOptions.hasBeenShown) {\n                if (_.isFunction(this.HUAVOptions.onshowFirstTime)) {\n                    this.HUAVOptions.hasBeenShown = true;\n                    this.HUAVOptions.onshowFirstTime.call(this);\n                }\n            }\n            if (_.isFunction(this.HUAVOptions.onshow)) {\n                this.HUAVOptions.onshow.call(this);\n                this.trigger(\"hiddenUntilActivated:shown\", this);\n            }\n            this.hidden = false;\n\n            // hide\n        } else {\n            if (_.isFunction(this.HUAVOptions.onhide)) {\n                this.HUAVOptions.onhide.call(this);\n                this.trigger(\"hiddenUntilActivated:hidden\", this);\n            }\n            this.hidden = true;\n        }\n        return this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown, arguments);\n    }\n};\n\n//==============================================================================\n/** Mixin for views that can be dragged and dropped\n *      Allows for the drag behavior to be turned on/off, setting/removing jQuery event\n *          handlers each time.\n *      dataTransfer data is set to the JSON string of the view's model.toJSON\n *      Override '$dragHandle' to define the draggable DOM sub-element.\n */\nvar DraggableViewMixin = {\n    /** set up instance vars to track whether this view is currently draggable */\n    initialize: function(attributes) {\n        /** is the body of this hda view expanded/not? */\n        this.draggable = attributes.draggable || false;\n    },\n\n    /** what part of the view's DOM triggers the dragging */\n    $dragHandle: function() {\n        //TODO: make abstract/general - move this to listItem\n        // override to the element you want to be your view's handle\n        return this.$(\".title-bar\");\n    },\n\n    /** toggle whether this view is draggable */\n    toggleDraggable: function() {\n        if (this.draggable) {\n            this.draggableOff();\n        } else {\n            this.draggableOn();\n        }\n    },\n\n    /** allow the view to be dragged, set up event handlers */\n    draggableOn: function() {\n        this.draggable = true;\n        this.dragStartHandler = _.bind(this._dragStartHandler, this);\n        this.dragEndHandler = _.bind(this._dragEndHandler, this);\n\n        var handle = this.$dragHandle()\n            .attr(\"draggable\", true)\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** turn of view dragging and remove event listeners */\n    draggableOff: function() {\n        this.draggable = false;\n        var handle = this.$dragHandle()\n            .attr(\"draggable\", false)\n            .get(0);\n        handle.removeEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.removeEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** sets the dataTransfer data to the model's toJSON\n     *  @fires draggable:dragstart (bbone event) which is passed the event and this view\n     */\n    _dragStartHandler: function(event) {\n        event.dataTransfer.effectAllowed = \"move\";\n        //ASSUMES: this.model\n        //TODO: all except IE: should be 'application/json', IE: must be 'text'\n        event.dataTransfer.setData(\"text\", JSON.stringify(this.model.toJSON()));\n        this.trigger(\"draggable:dragstart\", event, this);\n        return false;\n    },\n\n    /** handle the dragend\n     *  @fires draggable:dragend (bbone event) which is passed the event and this view\n     */\n    _dragEndHandler: function(event) {\n        this.trigger(\"draggable:dragend\", event, this);\n        return false;\n    }\n};\n\n//==============================================================================\n/** Mixin that allows a view to be selected (gen. from a list).\n *      Selection controls ($selector) may be hidden/shown/toggled.\n *          The bbone event 'selectable' is fired when the controls are shown/hidden (passed T/F).\n *      Default rendering is a font-awesome checkbox.\n *      Default selector is '.selector' within the view's $el.\n *      The bbone events 'selected' and 'de-selected' are fired when the $selector is clicked.\n *          Both events are passed the view and the (jQuery) event.\n */\nvar SelectableViewMixin = {\n    /** Set up instance state vars for whether the selector is shown and whether the view has been selected */\n    initialize: function(attributes) {\n        /** is the view currently in selection mode? */\n        this.selectable = attributes.selectable || false;\n        /** is the view currently selected? */\n        this.selected = attributes.selected || false;\n    },\n\n    /** $el sub-element where the selector is rendered and what can be clicked to select. */\n    $selector: function() {\n        return this.$(\".selector\");\n    },\n\n    /** How the selector is rendered - defaults to font-awesome checkbox */\n    _renderSelected: function() {\n        // override\n        this.$selector()\n            .find(\"span\")\n            .toggleClass(\"fa-check-square-o\", this.selected)\n            .toggleClass(\"fa-square-o\", !this.selected);\n    },\n\n    /** Toggle whether the selector is shown */\n    toggleSelector: function() {\n        //TODO: use this.selectable\n        if (!this.$selector().is(\":visible\")) {\n            this.showSelector();\n        } else {\n            this.hideSelector();\n        }\n    },\n\n    /** Display the selector control.\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed true (IOW, the selector is shown) and the view\n     */\n    showSelector: function(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // make sure selected state is represented properly\n        this.selectable = true;\n        this.trigger(\"selectable\", true, this);\n        this._renderSelected();\n        if (speed) {\n            this.$selector().show(speed);\n        } else {\n            this.$selector().show();\n        }\n    },\n\n    /** remove the selector control\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed false (IOW, the selector is not shown) and the view\n     */\n    hideSelector: function(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // reverse the process from showSelect\n        this.selectable = false;\n        this.trigger(\"selectable\", false, this);\n        if (speed) {\n            this.$selector().hide(speed);\n        } else {\n            this.$selector().hide();\n        }\n    },\n\n    /** Toggle whether the view is selected */\n    toggleSelect: function(event) {\n        if (this.selected) {\n            this.deselect(event);\n        } else {\n            this.select(event);\n        }\n    },\n\n    /** Select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    select: function(event) {\n        // switch icon, set selected, and trigger event\n        if (!this.selected) {\n            this.trigger(\"selected\", this, event);\n            this.selected = true;\n            this._renderSelected();\n        }\n        return false;\n    },\n\n    /** De-select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: de-selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    deselect: function(event) {\n        // switch icon, set selected, and trigger event\n        if (this.selected) {\n            this.trigger(\"de-selected\", this, event);\n            this.selected = false;\n            this._renderSelected();\n        }\n        return false;\n    }\n};\n\n//==============================================================================\n/** Return an underscore template fn from an array of strings.\n *  @param {String[]} template      the template strings to compile into the underscore template fn\n *  @param {String} jsonNamespace   an optional namespace for the json data passed in (defaults to 'model')\n *  @returns {Function} the (wrapped) underscore template fn\n *      The function accepts:\n *\n *  The template strings can access:\n *      the json/model hash using model (\"<%- model.myAttr %>) using the jsonNamespace above\n *      _l: the localizer function\n *      view (if passed): ostensibly, the view using the template (handy for view instance vars)\n *      Because they're namespaced, undefined attributes will not throw an error.\n *\n *  @example:\n *      templateBler : BASE_MVC.wrapTemplate([\n *          '<div class=\"myclass <%- mynamespace.modelClass %>\">',\n *              '<span><% print( _l( mynamespace.message ) ); %>:<%= view.status %></span>'\n *          '</div>'\n *      ], 'mynamespace' )\n *\n *  Meant to be called in a View's definition in order to compile only once.\n *\n */\nfunction wrapTemplate(template, jsonNamespace) {\n    jsonNamespace = jsonNamespace || \"model\";\n    var templateFn = _.template(template.join(\"\"));\n    return (json, view) => {\n        var templateVars = { view: view || {}, _l: _l };\n        templateVars[jsonNamespace] = json || {};\n        return templateFn(templateVars);\n    };\n}\n\n//==============================================================================\n/** Return a comparator function for sorted Collections */\nfunction buildComparator(attribute_name, options) {\n    options = options || {};\n    var ascending = options.ascending ? 1 : -1;\n    return function __comparator(a, b) {\n        a = a.get(attribute_name);\n        b = b.get(attribute_name);\n        return (a < b ? -1 : a > b ? 1 : 0) * ascending;\n    };\n}\n\n//==============================================================================\nexport default {\n    LoggableMixin: LoggableMixin,\n    SessionStorageModel: SessionStorageModel,\n    mixin: mixin,\n    SearchableModelMixin: SearchableModelMixin,\n    HiddenUntilActivatedViewMixin: HiddenUntilActivatedViewMixin,\n    DraggableViewMixin: DraggableViewMixin,\n    SelectableViewMixin: SelectableViewMixin,\n    wrapTemplate: wrapTemplate,\n    buildComparator: buildComparator\n};\n","import _ from \"underscore\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport LIST_VIEW from \"mvc/list/list-view\";\nimport DC_LI from \"mvc/collection/collection-li\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"collections\";\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class non-editable, read-only View/Controller for a dataset collection.\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar CollectionView = _super.extend(\n    /** @lends CollectionView.prototype */ {\n        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n        _logNamespace: logNamespace,\n\n        className: `${_super.prototype.className} dataset-collection-panel`,\n\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_LI.DatasetDCEListItemView,\n\n        /** key of attribute in model to assign to this.collection */\n        modelCollectionKey: \"elements\",\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n            this.dragItems = true;\n            this.hasUser = attributes.hasUser;\n            /** A stack of panels that currently cover or hide this panel */\n            this.panelStack = [];\n            /** The text of the link to go back to the panel containing this one */\n            this.parentName = attributes.parentName;\n            /** foldout or drilldown */\n            this.foldoutStyle = attributes.foldoutStyle || \"foldout\";\n            this.downloadUrl = `${getAppRoot()}api/dataset_collections/${this.model.attributes.id}/download`;\n        },\n\n        getNestedDCDCEViewClass: function() {\n            return DC_LI.NestedDCDCEListItemView.extend({\n                foldoutPanelClass: CollectionView\n            });\n        },\n\n        _queueNewRender: function($newRender, speed) {\n            speed = speed === undefined ? this.fxSpeed : speed;\n            var panel = this;\n            this.handleWarning($newRender);\n            panel.log(\"_queueNewRender:\", $newRender, speed);\n            // TODO: jquery@1.12 doesn't change display when the elem has display: flex\n            // this causes display: block for those elems after the use of show/hide animations\n            // animations are removed from this view for now until fixed\n            panel._swapNewRender($newRender);\n            panel.trigger(\"rendered\", panel);\n        },\n\n        handleWarning: function($newRender) {\n            var viewLength = this.views.length;\n            var elementCount = this.model.get(\"element_count\");\n            if (elementCount && elementCount !== viewLength) {\n                var warning = _l(`displaying only ${viewLength} of ${elementCount} items`);\n                var $warns = $newRender.find(\".elements-warning\");\n                $warns.html(`<div class=\"warningmessagesmall\">${warning}</div>`);\n            }\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** In this override, use model.getVisibleContents */\n        _filterCollection: function() {\n            //TODO: should *not* be model.getVisibleContents - visibility is not model related\n            return this.model.getVisibleContents();\n        },\n\n        /** override to return proper view class based on element_type */\n        _getItemViewClass: function(model) {\n            //this.debug( this + '._getItemViewClass:', model );\n            //TODO: subclasses use DCEViewClass - but are currently unused - decide\n            switch (model.get(\"element_type\")) {\n                case \"hda\":\n                    return this.DatasetDCEViewClass;\n                case \"dataset_collection\":\n                    return this.getNestedDCDCEViewClass();\n            }\n            throw new TypeError(\"Unknown element type:\", model.get(\"element_type\"));\n        },\n\n        /** override to add link target and anon */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                hasUser: this.hasUser,\n                //TODO: could move to only nested: list:paired\n                foldoutStyle: this.foldoutStyle\n            });\n        },\n\n        // ------------------------------------------------------------------------ collection sub-views\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n\n            // use pub-sub to: handle drilldown expansion and collapse\n            panel.listenTo(view, {\n                \"expanded:drilldown\": function(v, drilldown) {\n                    this._expandDrilldownPanel(drilldown);\n                },\n                \"collapsed:drilldown\": function(v, drilldown) {\n                    this._collapseDrilldownPanel(drilldown);\n                }\n            });\n            return this;\n        },\n\n        /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n        _expandDrilldownPanel: function(drilldown) {\n            this.panelStack.push(drilldown);\n            // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n            this.$(\"> .controls\")\n                .add(this.$list())\n                .hide();\n            drilldown.parentName = this.model.get(\"name\");\n            this.$el.append(drilldown.render().$el);\n        },\n\n        /** Handle drilldown close by freeing the panel and re-rendering this panel */\n        _collapseDrilldownPanel: function(drilldown) {\n            this.panelStack.pop();\n            this.render();\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: {\n            \"click .navigation .back\": \"close\"\n        },\n\n        /** close/remove this collection panel */\n        close: function(event) {\n            this.remove();\n            this.trigger(\"close\");\n        },\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `CollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nCollectionView.prototype.templates = (() => {\n    var controlsTemplate = (collection, view) => {\n        var subtitle = collectionDescription(view.model);\n        return `\n        <div class=\"controls\">\n            <div class=\"navigation\">\n            <a class=\"back\" href=\"javascript:void(0)\">\n                <span class=\"fa fa-icon fa-angle-left\"></span>\n                ${_l(\"Back to \")}\n                ${_.escape(view.parentName)}\n            </a>\n            </div>\n            <div class=\"title\">\n                <div class=\"name\">${_.escape(collection.name) || _.escape(collection.element_identifier)}</div>\n                <div class=\"subtitle\">\n                    ${subtitle}\n                </div>\n            </div>\n            <div class=\"elements-warning\">\n            </div>\n            <div class=\"tags-display\"></div>\n            <div class=\"actions\">\n                <a class=\"download-btn icon-btn\" href=\"${view.downloadUrl}\"\n                   title=\"\" download=\"\" data-original-title=\"Download Collection\">\n                   <span class=\"fa fa-floppy-o\"></span>\n                </a>\n            </div>\n        </div>`;\n    };\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        controls: controlsTemplate\n    });\n})();\n\nfunction collectionTypeDescription(collection) {\n    var collectionType = collection.get(\"collection_type\");\n    var collectionTypeDescription;\n    if (collectionType == \"list\") {\n        collectionTypeDescription = _l(\"list\");\n    } else if (collectionType == \"paired\") {\n        collectionTypeDescription = _l(\"dataset pair\");\n    } else if (collectionType == \"list:paired\") {\n        collectionTypeDescription = _l(\"list of pairs\");\n    } else {\n        collectionTypeDescription = _l(\"nested list\");\n    }\n    return collectionTypeDescription;\n}\n\nfunction collectionDescription(collection) {\n    var elementCount = collection.get(\"element_count\");\n\n    var itemsDescription = `a ${collectionTypeDescription(collection)}`;\n    if (elementCount) {\n        var countDescription;\n        if (elementCount == 1) {\n            countDescription = \"with 1 item\";\n        } else if (elementCount) {\n            countDescription = `with ${elementCount} items`;\n        }\n        itemsDescription = `${itemsDescription} ${_l(countDescription)}`;\n    }\n    return itemsDescription;\n}\n\n//==============================================================================\nexport default {\n    collectionTypeDescription: collectionTypeDescription,\n    collectionDescription: collectionDescription,\n    CollectionView: CollectionView\n};\n","import _ from \"underscore\";\nimport $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport STATES from \"mvc/dataset/states\";\nimport DATASET_LI from \"mvc/dataset/dataset-li\";\nimport { mountModelTags } from \"components/Tags\";\nimport ANNOTATIONS from \"mvc/annotation\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Editing view for DatasetAssociation.\n */\nvar DatasetListItemEdit = _super.extend(\n    /** @lends DatasetListItemEdit.prototype */ {\n        /** set up: options */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            this.hasUser = attributes.hasUser;\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n\n            //TODO: move to HiddenUntilActivatedViewMixin\n            /** should the tags editor be shown or hidden initially? */\n            this.tagsEditorShown = attributes.tagsEditorShown || false;\n            /** should the tags editor be shown or hidden initially? */\n            this.annotationEditorShown = attributes.annotationEditorShown || false;\n        },\n\n        // ......................................................................... titlebar actions\n        /** In this override, add the other two primary actions: edit and delete */\n        _renderPrimaryActions: function() {\n            var actions = _super.prototype._renderPrimaryActions.call(this);\n            if (this.model.get(\"state\") === STATES.NOT_VIEWABLE) {\n                return actions;\n            }\n            // render the display, edit attr and delete icon-buttons\n            return _super.prototype._renderPrimaryActions\n                .call(this)\n                .concat([this._renderEditButton(), this._renderDeleteButton()]);\n        },\n\n        //TODO: move titleButtons into state renderers, remove state checks in the buttons\n\n        /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n        _renderEditButton: function() {\n            var self = this;\n            // don't show edit while uploading, in-accessible\n            // DO show if in error (ala previous history panel)\n            if (this.model.get(\"state\") === STATES.DISCARDED || !this.model.get(\"accessible\")) {\n                return null;\n            }\n            var purged = this.model.get(\"purged\");\n            var deleted = this.model.get(\"deleted\");\n\n            var editBtnData = {\n                title: _l(\"Edit attributes\"),\n                href: `${getAppRoot()}datasets/edit?dataset_id=${this.model.attributes.id}`,\n                faIcon: \"fa-pencil\",\n                classes: \"edit-btn\",\n                onclick: function(ev) {\n                    let Galaxy = getGalaxyInstance();\n                    if (Galaxy.router) {\n                        ev.preventDefault();\n                        Galaxy.router.push(\"datasets/edit\", {\n                            dataset_id: self.model.attributes.id\n                        });\n                    }\n                }\n            };\n\n            // disable if purged or deleted and explain why in the tooltip\n            if (deleted || purged) {\n                editBtnData.disabled = true;\n                if (purged) {\n                    editBtnData.title = _l(\"Cannot edit attributes of datasets removed from disk\");\n                } else if (deleted) {\n                    editBtnData.title = _l(\"Undelete dataset to edit attributes\");\n                }\n\n                // disable if still uploading or new\n            } else if ([STATES.UPLOAD, STATES.NEW].includes(this.model.get(\"state\"))) {\n                editBtnData.disabled = true;\n                editBtnData.title = _l(\"This dataset is not yet editable\");\n            }\n            return faIconButton(editBtnData);\n        },\n\n        /** Render icon-button to delete this hda. */\n        _renderDeleteButton: function() {\n            // don't show delete if...\n            if (!this.model.get(\"accessible\")) {\n                return null;\n            }\n\n            var self = this;\n            var deletedAlready = this.model.isDeletedOrPurged();\n            return faIconButton({\n                title: !deletedAlready ? _l(\"Delete\") : _l(\"Dataset is already deleted\"),\n                disabled: deletedAlready,\n                faIcon: \"fa-times\",\n                classes: \"delete-btn\",\n                onclick: function() {\n                    self.$el.find(\".icon-btn.delete-btn\").tooltip(\"dispose\");\n                    self.model[\"delete\"]();\n                }\n            });\n        },\n\n        // ......................................................................... details\n        /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n        _renderDetails: function() {\n            //TODO: generalize to be allow different details for each state\n            var $details = _super.prototype._renderDetails.call(this);\n\n            var state = this.model.get(\"state\");\n\n            if (!this.model.isDeletedOrPurged()) {\n                //Enable tagging+annotation regardless of job state (see issue #6330)\n                this._renderTags($details);\n                this._renderAnnotation($details);\n                if ([STATES.OK, STATES.FAILED_METADATA].includes(state)) {\n                    this._makeDbkeyEditLink($details);\n                }\n            }\n\n            this._setUpBehaviors($details);\n            return $details;\n        },\n\n        /**************************************************************************\n         * Render help button to show tool help text without rerunning the tool.\n         * Issue #2100\n         */\n        _renderToolHelpButton: function() {\n            var datasetID = this.model.attributes.dataset_id;\n            var jobID = this.model.attributes.creating_job;\n            var self = this;\n\n            var parseToolBuild = data => {\n                var helpString = `<div id=\"thdiv-${datasetID}\" class=\"toolhelp\">`;\n                if (data.name && data.help) {\n                    helpString += `<strong>Tool help for ${data.name}</strong><hr/>`;\n                    helpString += data.help;\n                } else {\n                    helpString += \"<strong>Tool help is unavailable for this dataset.</strong><hr/>\";\n                }\n                helpString += \"</div>\";\n                self.$el.find(\".details\").append($.parseHTML(helpString));\n            };\n            var parseToolID = data => {\n                $.ajax({\n                    url: `${getAppRoot()}api/tools/${data.tool_id}/build`\n                })\n                    .done(data => {\n                        parseToolBuild(data);\n                    })\n                    .fail(() => {\n                        parseToolBuild({});\n                    });\n            };\n\n            let Galaxy = getGalaxyInstance();\n            if (Galaxy.user.id === null) {\n                return null;\n            }\n\n            return faIconButton({\n                title: _l(\"Tool Help\"),\n                classes: \"icon-btn\",\n                href: \"#\",\n                faIcon: \"fa-question\",\n                onclick: function() {\n                    if (self.$el.find(\".toolhelp\").length > 0) {\n                        self.$el.find(\".toolhelp\").toggle();\n                    } else {\n                        $.ajax({\n                            url: `${getAppRoot()}api/jobs/${jobID}`\n                        })\n                            .done(data => {\n                                parseToolID(data);\n                            })\n                            .fail(() => {\n                                console.log(\n                                    `Failed at recovering job information from the  Galaxy API for job id \"${jobID}\".`\n                                );\n                            });\n                    }\n                }\n            });\n        },\n        //*************************************************************************\n\n        /** Add less commonly used actions in the details section based on state */\n        _renderSecondaryActions: function() {\n            var actions = _super.prototype._renderSecondaryActions.call(this);\n            switch (this.model.get(\"state\")) {\n                case STATES.UPLOAD:\n                case STATES.NOT_VIEWABLE:\n                    return actions;\n                case STATES.ERROR:\n                    // error button comes first\n                    actions.unshift(this._renderErrButton());\n                    return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n                case STATES.OK:\n                case STATES.FAILED_METADATA:\n                    return actions.concat([\n                        this._renderRerunButton(),\n                        this._renderVisualizationsButton(),\n                        this._renderToolHelpButton()\n                    ]);\n            }\n            return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n        },\n\n        /** Render icon-button to report an error on this dataset to the galaxy admin. */\n        _renderErrButton: function() {\n            var self = this;\n            return faIconButton({\n                title: _l(\"View or report this error\"),\n                href: `${getAppRoot()}datasets/error?dataset_id=${this.model.attributes.id}`,\n                classes: \"report-error-btn\",\n                faIcon: \"fa-bug\",\n                onclick: function(ev) {\n                    let Galaxy = getGalaxyInstance();\n                    if (Galaxy.router) {\n                        ev.preventDefault();\n                        Galaxy.router.push(\"datasets/error\", {\n                            dataset_id: self.model.attributes.id\n                        });\n                    }\n                }\n            });\n        },\n\n        /** Render icon-button to re-run the job that created this dataset. */\n        _renderRerunButton: function() {\n            var creating_job = this.model.get(\"creating_job\");\n            if (this.model.get(\"rerunnable\")) {\n                return faIconButton({\n                    title: _l(\"Run this job again\"),\n                    href: this.model.urls.rerun,\n                    classes: \"rerun-btn\",\n                    target: this.linkTarget,\n                    faIcon: \"fa-refresh\",\n                    onclick: function(ev) {\n                        let Galaxy = getGalaxyInstance();\n                        if (Galaxy.router) {\n                            ev.preventDefault();\n                            Galaxy.router.push(\"/\", {\n                                job_id: creating_job\n                            });\n                        }\n                    }\n                });\n            }\n        },\n\n        /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n        _renderVisualizationsButton: function() {\n            //TODO: someday - lazyload visualizations\n            var visualizations = this.model.get(\"visualizations\");\n            if (this.model.isDeletedOrPurged() || !this.hasUser || !this.model.hasData() || _.isEmpty(visualizations)) {\n                return null;\n            }\n            if (!_.isObject(visualizations[0])) {\n                this.warn(\"Visualizations have been switched off\");\n                return null;\n            }\n\n            if (visualizations.length >= 1) {\n                let dsid = this.model.get(\"id\");\n                let url = getAppRoot() + \"visualizations?dataset_id=\" + dsid;\n                return faIconButton({\n                    title: _l(\"Visualize this data\"),\n                    href: url,\n                    classes: \"visualization-link\",\n                    faIcon: \"fa-bar-chart-o\",\n                    onclick: ev => {\n                        let Galaxy = getGalaxyInstance();\n                        if (Galaxy.frame && Galaxy.frame.active) {\n                            ev.preventDefault();\n                            Galaxy.frame.add({ url: url, title: \"Visualization\" });\n                        } else if (Galaxy.router) {\n                            ev.preventDefault();\n                            Galaxy.router.push(\"visualizations\", {\n                                dataset_id: dsid\n                            });\n                            Galaxy.trigger(\"activate-hda\", dsid);\n                        }\n                    }\n                });\n            }\n        },\n\n        /** Render the tags list/control */\n        _renderTags: function($where) {\n            if (!this.hasUser) {\n                return;\n            }\n\n            let el = $where.find(\".tags-display\")[0];\n\n            let propsData = {\n                model: this.model,\n                disabled: false,\n                context: \"dataset-li-edit\"\n            };\n\n            let vm = mountModelTags(propsData, el);\n\n            // tag icon button open/closes\n            let activator = faIconButton({\n                title: _l(\"Edit dataset tags\"),\n                classes: \"tag-btn\",\n                faIcon: \"fa-tags\"\n            }).appendTo($where.find(\".actions .right\"));\n\n            let toggleEditor = () => {\n                $(vm.$el).toggleClass(\"active\");\n                this.tagsEditorShown = $(vm.$el).hasClass(\"active\");\n            };\n\n            activator.on(\"click\", toggleEditor);\n\n            if (this.tagsEditorShown) {\n                let editorIsOpen = $(vm.$el).hasClass(\"active\");\n                if (!editorIsOpen) {\n                    toggleEditor();\n                }\n            }\n\n            return vm;\n        },\n\n        /** Render the annotation display/control */\n        _renderAnnotation: function($where) {\n            if (!this.hasUser) {\n                return;\n            }\n            var view = this;\n            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n                model: this.model,\n                el: $where.find(\".annotation-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // persist state on the hda view (and not the editor) since these are currently re-created each time\n                onshow: function() {\n                    view.annotationEditorShown = true;\n                },\n                onhide: function() {\n                    view.annotationEditorShown = false;\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit dataset annotation\"),\n                    classes: \"annotate-btn\",\n                    faIcon: \"fa-comment\"\n                }).appendTo($where.find(\".actions .right\"))\n            });\n            if (this.annotationEditorShown) {\n                this.annotationEditor.toggle(true);\n            }\n        },\n\n        /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n        _makeDbkeyEditLink: function($details) {\n            // make the dbkey a link to editing\n            if (this.model.get(\"metadata_dbkey\") === \"?\" && !this.model.isDeletedOrPurged()) {\n                var editableDbkey = $('<a class=\"value\">?</a>')\n                    .attr(\"href\", this.model.urls.edit)\n                    .attr(\"target\", \"_top\");\n                $details.find(\".dbkey .value\").replaceWith(editableDbkey);\n            }\n        },\n\n        // ......................................................................... events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .undelete-link\": \"_clickUndeleteLink\",\n            \"click .purge-link\": \"_clickPurgeLink\",\n\n            \"click .edit-btn\": function(ev) {\n                this.trigger(\"edit\", this, ev);\n            },\n            \"click .delete-btn\": function(ev) {\n                this.trigger(\"delete\", this, ev);\n            },\n            \"click .rerun-btn\": function(ev) {\n                this.trigger(\"rerun\", this, ev);\n            },\n            \"click .report-err-btn\": function(ev) {\n                this.trigger(\"report-err\", this, ev);\n            },\n            \"click .visualization-btn\": function(ev) {\n                this.trigger(\"visualize\", this, ev);\n            },\n            \"click .dbkey a\": function(ev) {\n                this.trigger(\"edit\", this, ev);\n            }\n        }),\n\n        /** listener for item undelete (in the messages section) */\n        _clickUndeleteLink: function(ev) {\n            this.model.undelete();\n            return false;\n        },\n\n        /** listener for item purge (in the messages section) */\n        _clickPurgeLink: function(ev) {\n            if (window.confirm(_l(\"This will permanently remove the data in your dataset. Are you sure?\"))) {\n                this.model.purge();\n            }\n            return false;\n        },\n\n        // ......................................................................... misc\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAEditView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemEdit.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: BASE_MVC.wrapTemplate(\n            [\n                // in this override, provide a link to the edit page\n                '<% if( dataset.state === \"failed_metadata\" ){ %>',\n                '<div class=\"failed_metadata-warning warningmessagesmall\">',\n                _l(\"An error occurred setting the metadata for this dataset\"),\n                '<br /><a href=\"<%- dataset.urls.edit %>\" target=\"_top\">',\n                _l(\"Set it manually or retry auto-detection\"),\n                \"</a>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        ),\n\n        deleted: BASE_MVC.wrapTemplate(\n            [\n                // in this override, provide links to undelete or purge the dataset\n                \"<% if( dataset.deleted && !dataset.purged ){ %>\",\n                // deleted not purged\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                _l(\"This dataset has been deleted\"),\n                '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">',\n                _l(\"Undelete it\"),\n                \"</a>\",\n                \"<% if( view.purgeAllowed ){ %>\",\n                '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">',\n                _l(\"Permanently remove it from disk\"),\n                \"</a>\",\n                \"<% } %>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    var visualizationsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( visualizations.length === 1 ){ %>\",\n            '<a class=\"visualization-link icon-btn\" href=\"<%- visualizations[0].href %>\"',\n            ' target=\"<%- visualizations[0].target %>\" title=\"',\n            _l(\"Visualize in\"),\n            ' <%- visualizations[0].html %>\">',\n            '<span class=\"fa fa-bar-chart-o\"></span>',\n            \"</a>\",\n\n            \"<% } else { %>\",\n            '<div class=\"visualizations-dropdown dropdown icon-btn\">',\n            '<a data-toggle=\"dropdown\" title=\"',\n            _l(\"Visualize\"),\n            '\">',\n            '<span class=\"fa fa-bar-chart-o\"></span>',\n            \"</a>\",\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n            \"<% _.each( visualizations, function( visualization ){ %>\",\n            '<li><a class=\"visualization-link\" href=\"<%- visualization.href %>\"',\n            ' target=\"<%- visualization.target %>\">',\n            \"<%- visualization.html %>\",\n            \"</a></li>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\",\n            \"<% } %>\"\n        ],\n        \"visualizations\"\n    );\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        visualizations: visualizationsTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    DatasetListItemEdit: DatasetListItemEdit\n};\n","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n// ============================================================================\n/**\n * Edit and save text asynchronously.\n */\nfunction async_save_text(\n    click_to_edit_elt,\n    text_elt_id,\n    save_url,\n    text_parm_name,\n    num_cols,\n    use_textarea,\n    num_rows,\n    on_start,\n    on_finish\n) {\n    // Set defaults if necessary.\n    if (num_cols === undefined) {\n        num_cols = 30;\n    }\n    if (num_rows === undefined) {\n        num_rows = 4;\n    }\n\n    // Set up input element.\n    $(`#${click_to_edit_elt}`)\n        .off()\n        .click(() => {\n            // Check if this is already active\n            if ($(\"#renaming-active\").length > 0) {\n                return;\n            }\n            var text_elt = $(`#${text_elt_id}`);\n            var old_text = text_elt.text();\n            var t;\n\n            if (use_textarea) {\n                t = $(\"<textarea></textarea>\")\n                    .attr({ rows: num_rows, cols: num_cols })\n                    .text($.trim(old_text));\n            } else {\n                t = $(\"<input type='text'></input>\").attr({\n                    value: $.trim(old_text),\n                    size: num_cols\n                });\n            }\n            t.attr(\"id\", \"renaming-active\");\n            t.blur(function() {\n                $(this).remove();\n                text_elt.show();\n                if (on_finish) {\n                    on_finish(t);\n                }\n            });\n            t.keyup(function(e) {\n                if (e.keyCode === 27) {\n                    // Escape key\n                    $(this).trigger(\"blur\");\n                } else if (e.keyCode === 13) {\n                    // Enter key submits\n                    var ajax_data = {};\n                    ajax_data[text_parm_name] = $(this).val();\n                    $(this).trigger(\"blur\");\n                    $.ajax({\n                        url: save_url,\n                        data: ajax_data,\n                        error: function() {\n                            alert(`Text editing for elt ${text_elt_id} failed`);\n                            // TODO: call finish or no? For now, let's not because error occurred.\n                        },\n                        success: function(processed_text) {\n                            // Set new text and call finish method.\n                            if (processed_text !== \"\") {\n                                text_elt.text(processed_text);\n                            } else {\n                                text_elt.html(\"<em>None</em>\");\n                            }\n                            if (on_finish) {\n                                on_finish(t);\n                            }\n                        }\n                    });\n                }\n            });\n\n            if (on_start) {\n                on_start(t);\n            }\n            // Replace text with input object and focus & select.\n            text_elt.hide();\n            t.insertAfter(text_elt);\n            t.focus();\n            t.select();\n\n            return;\n        });\n}\n\n// ============================================================================\nexport default async_save_text;\n","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n//TODO: too specific to history panel\nfunction LoadingIndicator($where, options) {\n    var self = this;\n    // defaults\n    options = jQuery.extend(\n        {\n            cover: false\n        },\n        options || {}\n    );\n\n    function render() {\n        var html = [\n            '<div class=\"loading-indicator\">',\n            '<div class=\"loading-indicator-text\">',\n            '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>',\n            '<span class=\"loading-indicator-message\">loading...</span>',\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\\n\");\n\n        var $indicator = $(html)\n            .hide()\n            .css(\n                options.css || {\n                    position: \"fixed\"\n                }\n            );\n\n        var $text = $indicator.children(\".loading-indicator-text\");\n\n        if (options.cover) {\n            $indicator.css({\n                \"z-index\": 2,\n                top: $where.css(\"top\"),\n                bottom: $where.css(\"bottom\"),\n                left: $where.css(\"left\"),\n                right: $where.css(\"right\"),\n                opacity: 0.5,\n                \"background-color\": \"white\",\n                \"text-align\": \"center\"\n            });\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                \"margin-top\": \"20px\"\n            });\n        } else {\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                margin: \"12px 0px 0px 10px\",\n                opacity: \"0.85\",\n                color: \"grey\"\n            });\n            $text.children(\".loading-indicator-message\").css({\n                margin: \"0px 8px 0px 0px\",\n                \"font-style\": \"italic\"\n            });\n        }\n        return $indicator;\n    }\n\n    self.show = (msg, speed, callback) => {\n        msg = msg || \"loading...\";\n        speed = speed || \"fast\";\n        // remove previous\n        $where\n            .parent()\n            .find(\".loading-indicator\")\n            .remove();\n        // since position is fixed - we insert as sibling\n        self.$indicator = render().insertBefore($where);\n        self.message(msg);\n        self.$indicator.fadeIn(speed, callback);\n        return self;\n    };\n\n    self.message = msg => {\n        self.$indicator.find(\"i\").text(msg);\n    };\n\n    self.hide = (speed, callback) => {\n        speed = speed || \"fast\";\n        if (self.$indicator && self.$indicator.length) {\n            self.$indicator.fadeOut(speed, () => {\n                self.$indicator.remove();\n                if (callback) {\n                    callback();\n                }\n            });\n        } else {\n            if (callback) {\n                callback();\n            }\n        }\n        return self;\n    };\n    return self;\n}\n\nconst markViewAsLoading = function(view) {\n    view.setElement($('<div><div class=\"loading\"></div></div>'));\n    new LoadingIndicator(view.$(\".loading\")).show();\n};\n\n//============================================================================\nexport default {\n    LoadingIndicator: LoadingIndicator,\n    markViewAsLoading: markViewAsLoading\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport DC_LI from \"mvc/collection/collection-li\";\nimport DATASET_LI_EDIT from \"mvc/dataset/dataset-li-edit\";\n\n//==============================================================================\nvar DCListItemView = DC_LI.DCListItemView;\n/** @class Edit view for DatasetCollection.\n */\nvar DCListItemEdit = DCListItemView.extend(\n    /** @lends DCListItemEdit.prototype */ {\n        /** override to add linkTarget */\n        initialize: function(attributes) {\n            DCListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nvar DCEListItemView = DC_LI.DCEListItemView;\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemEdit = DCEListItemView.extend(\n    /** @lends DCEListItemEdit.prototype */ {\n        //TODO: this might be expendable - compacted with HDAListItemView\n\n        /** set up */\n        initialize: function(attributes) {\n            DCEListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\n// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n//TODO: but should - if we can find something simpler than using diamond\n/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n    /** @lends DatasetDCEListItemEdit.prototype */ {\n        /** set up */\n        initialize: function(attributes) {\n            DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call(this, attributes);\n        },\n\n        // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n        //TODO: fix\n        /** In this override, only get details if in the ready state.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return $.when();\n        },\n\n        /** Override to remove delete button */\n        _renderDeleteButton: function() {\n            return null;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetDCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemEdit.prototype.templates = (() =>\n    _.extend({}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n        titleBar: DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n    }))();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n    /** @lends NestedDCDCEListItemEdit.prototype */ {\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `NestedDCDCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DCListItemEdit: DCListItemEdit,\n    DCEListItemEdit: DCEListItemEdit,\n    DatasetDCEListItemEdit: DatasetDCEListItemEdit,\n    NestedDCDCEListItemEdit: NestedDCDCEListItemEdit\n};\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport { getGalaxyInstance } from \"app\";\nimport HISTORY_VIEW from \"mvc/history/history-view\";\nimport HDA_MODEL from \"mvc/history/hda-model\";\nimport HDA_LI_EDIT from \"mvc/history/hda-li-edit\";\nimport HDCA_LI_EDIT from \"mvc/history/hdca-li-edit\";\nimport { mountModelTags } from \"components/Tags\";\nimport ANNOTATIONS from \"mvc/annotation\";\nimport LIST_COLLECTION_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_COLLECTION_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport LIST_OF_PAIRS_COLLECTION_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n\nvar $ = jQuery;\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// base class for history-view-edit-current and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryView allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryViewEdit = _super.extend(\n    /** @lends HistoryViewEdit.prototype */ {\n        /** class to use for constructing the HistoryDatasetAssociation views */\n        HDAViewClass: HDA_LI_EDIT.HDAListItemEdit,\n        /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n        HDCAViewClass: HDCA_LI_EDIT.HDCAListItemEdit,\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes\n         */\n        initialize: function(attributes) {\n            attributes = attributes || {};\n            _super.prototype.initialize.call(this, attributes);\n\n            // ---- set up instance vars\n            /** editor for tags - sub-view */\n            this.tagsEditor = null;\n\n            /** enable drag and drop - sub-view */\n            this.dragItems = true;\n\n            /** editor for annotations - sub-view */\n            this.annotationEditor = null;\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n\n            // states/modes the panel can be in\n            /** is the panel currently showing the dataset selection controls? */\n            this.annotationEditorShown = attributes.annotationEditorShown || false;\n            this.tagsEditorShown = attributes.tagsEditorShown || false;\n        },\n\n        /** Override to handle history as drag-drop target */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            return this.on({\n                \"droptarget:drop\": function(ev, data) {\n                    // process whatever was dropped and re-hide the drop target\n                    this.dataDropped(data);\n                    this.dropTargetOff();\n                },\n                \"view:attached view:removed\": function() {\n                    this._renderCounts();\n                },\n                \"search:loading-progress\": this._renderSearchProgress,\n                \"search:searching\": this._renderSearchFindings\n            });\n        },\n\n        // ------------------------------------------------------------------------ listeners\n        /** listening for history and HDA events */\n        _setUpModelListeners: function() {\n            _super.prototype._setUpModelListeners.call(this);\n            this.listenTo(this.model, \"change:size\", this.updateHistoryDiskSize);\n            return this;\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            this.listenTo(this.collection, {\n                \"change:deleted\": this._handleItemDeletedChange,\n                \"change:visible\": this._handleItemVisibleChange,\n                \"change:purged\": function(model) {\n                    // hafta get the new nice-size w/o the purged model\n                    this.model.fetch();\n                },\n                // loading indicators for deleted/hidden\n                \"fetching-deleted\": function(collection) {\n                    this.$(\"> .controls .deleted-count\").html(`<i>${_l(\"loading...\")}</i>`);\n                },\n                \"fetching-hidden\": function(collection) {\n                    this.$(\"> .controls .hidden-count\").html(`<i>${_l(\"loading...\")}</i>`);\n                },\n                \"fetching-deleted-done fetching-hidden-done\": this._renderCounts\n            });\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n        _buildNewRender: function() {\n            var Galaxy = getGalaxyInstance();\n\n            // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            if (!this.model) {\n                return $newRender;\n            }\n\n            if (Galaxy && Galaxy.user && Galaxy.user.id && Galaxy.user.id === this.model.get(\"user_id\")) {\n                this._renderTags($newRender);\n                this._renderAnnotation($newRender);\n            }\n            return $newRender;\n        },\n\n        /** Update the history size display (curr. upper right of panel). */\n        updateHistoryDiskSize: function() {\n            this.$(\".history-size\").text(this.model.get(\"nice_size\"));\n        },\n\n        /** override to render counts when the items are rendered */\n        renderItems: function($whereTo) {\n            var views = _super.prototype.renderItems.call(this, $whereTo);\n            if (!this.searchFor) {\n                this._renderCounts($whereTo);\n            } else {\n                this._renderSearchFindings($whereTo);\n            }\n            return views;\n        },\n\n        /** override to show counts, what's deleted/hidden, and links to toggle those */\n        _renderCounts: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.counts(this.model.toJSON(), this);\n            return $whereTo.find(\"> .controls .subtitle\").html(html);\n        },\n\n        /** render the tags sub-view controller */\n        _renderTags: function($where) {\n            let el = $where.find(\".controls .tags-display\")[0];\n\n            let propsData = {\n                model: this.model,\n                disabled: false,\n                context: \"history-view-edit\"\n            };\n\n            let vm = mountModelTags(propsData, el);\n\n            // tag icon button open/closes\n            let activator = faIconButton({\n                title: _l(\"Edit history tags\"),\n                classes: \"history-tag-btn\",\n                faIcon: \"fa-tags\",\n                tooltipConfig: { placement: \"top\" }\n            }).appendTo($where.find(\".controls .actions\"));\n\n            activator.on(\"click\", () => {\n                $(vm.$el).toggleClass(\"active\");\n            });\n\n            return vm;\n        },\n\n        /** render the annotation sub-view controller */\n        _renderAnnotation: function($where) {\n            var panel = this;\n            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n                model: this.model,\n                el: $where.find(\".controls .annotation-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // show hide sub-view view annotation editors when this is shown/hidden\n                onshow: function() {\n                    panel.toggleHDAAnnotationEditors(true, panel.fxSpeed);\n                },\n                onhide: function() {\n                    panel.toggleHDAAnnotationEditors(false, panel.fxSpeed);\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit history annotation\"),\n                    classes: \"history-annotate-btn\",\n                    faIcon: \"fa-comment\",\n                    tooltipConfig: { placement: \"top\" }\n                }).appendTo($where.find(\".controls .actions\"))\n            });\n        },\n\n        /** Set up HistoryViewEdit js/widget behaviours\n         *  In this override, make the name editable\n         */\n        _setUpBehaviors: function($where) {\n            var Galaxy = getGalaxyInstance();\n\n            $where = $where || this.$el;\n            _super.prototype._setUpBehaviors.call(this, $where);\n            if (!this.model) {\n                return;\n            }\n\n            // anon users shouldn't have access to any of the following\n            if (!Galaxy.user || Galaxy.user.isAnonymous() || Galaxy.user.id !== this.model.get(\"user_id\")) {\n                return;\n            }\n\n            var panel = this;\n            var nameSelector = \"> .controls .name\";\n            $where\n                .find(nameSelector)\n                .attr(\"title\", _l(\"Click to rename history\"))\n                .tooltip({ placement: \"bottom\" })\n                .make_text_editable({\n                    on_finish: function(newName) {\n                        var previousName = panel.model.get(\"name\");\n                        if (newName && newName !== previousName) {\n                            panel.$el.find(nameSelector).text(newName);\n                            panel.model.save({ name: newName }).fail(() => {\n                                panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                            });\n                        } else {\n                            panel.$el.find(nameSelector).text(previousName);\n                        }\n                    }\n                });\n        },\n\n        /** return a new popup menu for choosing a multi selection action\n         *  ajax calls made for multiple datasets are queued\n         */\n        multiselectActions: function() {\n            var panel = this;\n\n            var actions = [\n                {\n                    html: _l(\"Hide datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Unhide datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Delete datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype[\"delete\"];\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Undelete datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                }\n            ];\n\n            if (panel.purgeAllowed) {\n                actions.push({\n                    html: _l(\"Permanently delete datasets\"),\n                    func: function() {\n                        if (\n                            window.confirm(_l(\"This will permanently remove the data in your datasets. Are you sure?\"))\n                        ) {\n                            var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n                            const historyContents = panel.getSelectedModels();\n                            const selectedDatasets = historyContents.filter(\n                                c => c.get(\"history_content_type\") == \"dataset\"\n                            );\n                            historyContents.ajaxQueue(action, {}, selectedDatasets);\n                        }\n                    }\n                });\n            }\n            actions = actions.concat(panel._collectionActions());\n            return actions;\n        },\n\n        /**   */\n        _collectionActions: function() {\n            var panel = this;\n            return [\n                {\n                    html: _l(\"Build Dataset List\"),\n                    func: () => panel.buildCollection(\"list\")\n                },\n                // TODO: Only show quick pair if two things selected.\n                {\n                    html: _l(\"Build Dataset Pair\"),\n                    func: () => panel.buildCollection(\"paired\")\n                },\n                {\n                    html: _l(\"Build List of Dataset Pairs\"),\n                    func: () => panel.buildCollection(\"list:paired\")\n                },\n                {\n                    html: _l(\"Build Collection from Rules\"),\n                    func: () => panel.buildCollection(\"rules\")\n                }\n            ];\n        },\n\n        buildCollection: function(collectionType, selection, hideSourceItems) {\n            var panel = this;\n            selection = selection || panel.getSelectedModels();\n            hideSourceItems = hideSourceItems || false;\n            var createFunc;\n            if (collectionType == \"list\") {\n                createFunc = LIST_COLLECTION_CREATOR.createListCollection;\n            } else if (collectionType == \"paired\") {\n                createFunc = PAIR_COLLECTION_CREATOR.createPairCollection;\n            } else if (collectionType == \"list:paired\") {\n                createFunc = LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection;\n            } else if (collectionType.startsWith(\"rules\")) {\n                createFunc = LIST_COLLECTION_CREATOR.createCollectionViaRules;\n            } else {\n                console.warn(`Unknown collectionType encountered ${collectionType}`);\n            }\n            createFunc(selection, hideSourceItems).then(() => {\n                panel.model.refresh();\n            });\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            _.extend(options, {\n                purgeAllowed: this.purgeAllowed,\n                tagsEditorShown: this.tagsEditor && !this.tagsEditor.hidden,\n                annotationEditorShown: this.annotationEditor && !this.annotationEditor.hidden\n            });\n            return options;\n        },\n\n        /** If this item is deleted and we're not showing deleted items, remove the view\n         *  @param {Model} the item model to check\n         */\n        _handleItemDeletedChange: function(itemModel) {\n            if (itemModel.get(\"deleted\")) {\n                this._handleItemDeletion(itemModel);\n            } else {\n                this._handleItemUndeletion(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemDeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeDeleted) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUndeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted -= 1;\n            if (!this.model.contents.includeDeleted) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** If this item is hidden and we're not showing hidden items, remove the view\n         *  @param {Model} the item model to check\n         */\n        _handleItemVisibleChange: function(itemModel) {\n            if (itemModel.hidden()) {\n                this._handleItemHidden(itemModel);\n            } else {\n                this._handleItemUnhidden(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemHidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeHidden) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUnhidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden -= 1;\n            if (!this.model.contents.includeHidden) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n        // toggleHDATagEditors: function(showOrHide, speed) {\n        //     _.each(this.views, view => {\n        //         if (view.tagsEditor) {\n        //             view.tagsEditor.toggle(showOrHide, speed);\n        //         }\n        //     });\n        // },\n\n        /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n        toggleHDAAnnotationEditors: function(showOrHide, speed) {\n            _.each(this.views, view => {\n                if (view.annotationEditor) {\n                    view.annotationEditor.toggle(showOrHide, speed);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click .toggle-deleted-link\": function(ev) {\n                this.toggleShowDeleted();\n            },\n            \"click .toggle-hidden-link\": function(ev) {\n                this.toggleShowHidden();\n            }\n        }),\n\n        // ------------------------------------------------------------------------ search\n        _renderSearchProgress: function(limit, offset) {\n            var stop = limit + offset;\n            return this.$(\"> .controls .subtitle\").html(\n                [\"<i>\", _l(\"Searching \"), stop, \"/\", this.model.contentsShown(), \"</i>\"].join(\"\")\n            );\n        },\n\n        /** override to display number found in subtitle */\n        _renderSearchFindings: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.found(this.model.toJSON(), this);\n            $whereTo.find(\"> .controls .subtitle\").html(html);\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ as drop target\n        /** turn all the drag and drop handlers on and add some help text above the drop area */\n        dropTargetOn: function() {\n            if (this.dropTarget) {\n                return this;\n            }\n            this.dropTarget = true;\n\n            //TODO: to init\n            var dropHandlers = {\n                dragenter: _.bind(this.dragenter, this),\n                dragover: _.bind(this.dragover, this),\n                dragleave: _.bind(this.dragleave, this),\n                drop: _.bind(this.drop, this)\n            };\n\n            var $dropTarget = this._renderDropTarget();\n            this.$list().before([this._renderDropTargetHelp(), $dropTarget]);\n            for (var evName in dropHandlers) {\n                if (dropHandlers.hasOwnProperty(evName)) {\n                    $dropTarget.get(0).addEventListener(evName, dropHandlers[evName]);\n                }\n            }\n            return this;\n        },\n\n        /** render a box to serve as a 'drop here' area on the history */\n        _renderDropTarget: function() {\n            this.$(\".history-drop-target\").remove();\n            return $(\"<div/>\").addClass(\"history-drop-target\");\n        },\n\n        /** tell the user how it works  */\n        _renderDropTargetHelp: function() {\n            this.$(\".history-drop-target-help\").remove();\n            return $(\"<div/>\")\n                .addClass(\"history-drop-target-help\")\n                .text(_l(\"Drag datasets here to copy them to the current history\"));\n        },\n\n        /** shut down drag and drop event handlers and remove drop target */\n        dropTargetOff: function() {\n            if (!this.dropTarget) {\n                return this;\n            }\n            //this.log( 'dropTargetOff' );\n            this.dropTarget = false;\n            var dropTarget = this.$(\".history-drop-target\").get(0);\n            for (var evName in this._dropHandlers) {\n                if (this._dropHandlers.hasOwnProperty(evName)) {\n                    dropTarget.off(evName, this._dropHandlers[evName]);\n                }\n            }\n            this.$(\".history-drop-target\").remove();\n            this.$(\".history-drop-target-help\").remove();\n            return this;\n        },\n        /** toggle the target on/off */\n        dropTargetToggle: function() {\n            if (this.dropTarget) {\n                this.dropTargetOff();\n            } else {\n                this.dropTargetOn();\n            }\n            return this;\n        },\n\n        dragenter: function(ev) {\n            //console.debug( 'dragenter:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"2px solid black\");\n        },\n        dragover: function(ev) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        },\n        dragleave: function(ev) {\n            //console.debug( 'dragleave:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"1px dashed black\");\n        },\n        /** when (text) is dropped try to parse as json and trigger an event */\n        drop: function(ev) {\n            ev.preventDefault();\n            //ev.stopPropagation();\n            var dataTransfer = ev.dataTransfer;\n            var data = dataTransfer.getData(\"text\");\n\n            dataTransfer.dropEffect = \"move\";\n            try {\n                data = JSON.parse(data);\n            } catch (err) {\n                this.warn(\"error parsing JSON from drop:\", data);\n            }\n\n            this.trigger(\"droptarget:drop\", ev, data, this);\n            return false;\n        },\n\n        /** handler that copies data into the contents */\n        dataDropped: function(data) {\n            // HDA: dropping will copy it to the history\n            if (_.isObject(data) && data.model_class === \"HistoryDatasetAssociation\" && data.id) {\n                if (this.contents.currentPage !== 0) {\n                    return this.contents.fetchPage(0).then(() => this.model.contents.copy(data.id));\n                }\n                return this.model.contents.copy(data.id);\n            }\n            return jQuery.when();\n        },\n\n        // ........................................................................ misc\n        /** Return a string rep of the history */\n        toString: function() {\n            return `HistoryViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryViewEdit.prototype.templates = (() => {\n    var countsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% var shown = Math.max( view.views.length, history.contents_active.active ) %>\",\n            \"<% if( shown ){ %>\",\n            '<span class=\"shown-count\">',\n            \"<%- shown %> \",\n            _l(\"shown\"),\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            '<span class=\"deleted-count\">',\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.deleted %> \",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"deleted\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            '<span class=\"hidden-count\">',\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.hidden %> \",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    var foundTemplate = BASE_MVC.wrapTemplate(\n        [\n            _l(\"Found\"),\n            \" <%- view.views.length %>, \",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>, \",\n            \"<% } else { %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"show deleted\"),\n            \"</a>, \",\n            \"<% } %>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"show hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        counts: countsTemplate,\n        found: foundTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HistoryViewEdit: HistoryViewEdit\n};\n","import $ from \"jquery\";\nimport { getGalaxyInstance } from \"app\";\nimport DC_VIEW from \"mvc/collection/collection-view\";\nimport DC_EDIT from \"mvc/collection/collection-li-edit\";\nimport { mountModelTags } from \"components/Tags\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class editable View/Controller for a dataset collection.\n */\nvar _super = DC_VIEW.CollectionView;\nvar CollectionViewEdit = _super.extend(\n    /** @lends CollectionView.prototype */ {\n        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n        /** logger used to record this.log messages, commonly set to console */\n        //logger              : console,\n\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_EDIT.DatasetDCEListItemEdit,\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\n        getNestedDCDCEViewClass: function() {\n            return DC_EDIT.NestedDCDCEListItemEdit.extend({\n                foldoutPanelClass: CollectionViewEdit\n            });\n        },\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n        },\n\n        /** In this override, make the collection name editable\n         */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            _super.prototype._setUpBehaviors.call(this, $where);\n            if (!this.model) {\n                return;\n            }\n\n            // anon users shouldn't have access to any of the following\n            let Galaxy = getGalaxyInstance();\n            if (!Galaxy.user || Galaxy.user.isAnonymous()) {\n                return;\n            }\n\n            this.tagsEditorShown = true;\n\n            //TODO: extract\n            var panel = this;\n\n            var nameSelector = \"> .controls .name\";\n            $where\n                .find(nameSelector)\n                .attr(\"title\", _l(\"Click to rename collection\"))\n                .tooltip({ placement: \"bottom\" })\n                .make_text_editable({\n                    on_finish: function(newName) {\n                        var previousName = panel.model.get(\"name\");\n                        if (newName && newName !== previousName) {\n                            panel.$el.find(nameSelector).text(newName);\n                            panel.model.save({ name: newName }).fail(() => {\n                                panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                            });\n                        } else {\n                            panel.$el.find(nameSelector).text(previousName);\n                        }\n                    }\n                });\n\n            let el = $where.find(\".tags-display\")[0];\n            let propsData = {\n                model: this.model,\n                disabled: false,\n                context: \"collection-view-edit\"\n            };\n\n            let vm = mountModelTags(propsData, el);\n\n            let toggleEditor = () => {\n                $(vm.$el).toggleClass(\"active\");\n                this.tagsEditorShown = $(vm.$el).hasClass(\"active\");\n            };\n\n            if (this.tagsEditorShown) {\n                let editorIsOpen = $(vm.$el).hasClass(\"active\");\n                if (!editorIsOpen) {\n                    toggleEditor();\n                }\n            }\n        },\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `CollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    CollectionViewEdit: CollectionViewEdit\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport HDCA_LI from \"mvc/history/hdca-li\";\nimport DC_VIEW_EDIT from \"mvc/collection/collection-view-edit\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = HDCA_LI.HDCAListItemView;\n/** @class Editing view for HistoryDatasetCollectionAssociation.\n */\nvar HDCAListItemEdit = _super.extend(\n    /** @lends HDCAListItemEdit.prototype */ {\n        /** logger used to record this.log messages, commonly set to console */\n        //logger              : console,\n        /** set up: options */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n        },\n\n        /** Override to return editable versions of the collection panels */\n        _getFoldoutPanelClass: function() {\n            return DC_VIEW_EDIT.CollectionViewEdit;\n        },\n\n        // ......................................................................... delete\n        /** In this override, add the delete button. */\n        _renderPrimaryActions: function() {\n            this.log(`${this}._renderPrimaryActions`);\n            // render the display, edit attr and delete icon-buttons\n            return _super.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()]);\n        },\n\n        _renderDeleteButton: function() {\n            return $(`\n                <div class=\"dropdown\">\n                    <a class=\"delete-btn icon-btn\" title=\"${_l(\"Delete\")}\" data-toggle=\"dropdown\">\n                        <span class=\"fa fa-times\"></span>\n                    </a>\n                    <div class=\"dropdown-menu\" role=\"menu\">\n                            <a href=\"#\" class=\"dropdown-item delete-collection\">\n                                ${_l(\"Collection Only\")}\n                            </a>\n                            <a href=\"#\" class=\"dropdown-item delete-collection-and-datasets\">\n                                ${_l(\"Delete Datasets\")}\n                            </a>\n                            <a href=\"#\" style=\"display: ${\n                                this.purgeAllowed ? \"inherit\" : \"none\"\n                            }\" class=\"dropdown-item delete-collection-and-purge-datasets\">\n                                ${_l(\"Permanently Delete Datasets\")}\n                            </a>\n                    </div>\n                </div>`);\n        },\n\n        // ......................................................................... misc\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .delete-collection\": function(ev) {\n                this.model[\"delete\"]();\n            },\n            \"click .delete-collection-and-datasets\": function(ev) {\n                this.model[\"delete\"](true);\n            },\n            \"click .delete-collection-and-purge-datasets\": function(ev) {\n                this.model[\"delete\"](true, true);\n            }\n        }),\n\n        // ......................................................................... misc\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDCAListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    HDCAListItemEdit: HDCAListItemEdit\n};\n","/**\n *  This class creates/wraps a default html select field as backbone class.\n */\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport { keyedColorScheme } from \"utils/color\";\nimport Buttons from \"mvc/ui/ui-buttons\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.data = [];\n        this.data2 = [];\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                cls: \"ui-select\",\n                error_text: \"No options available\",\n                empty_text: \"Nothing selected\",\n                visible: true,\n                wait: false,\n                multiple: false,\n                searchable: true,\n                optional: false,\n                disabled: false,\n                readonly: false,\n                onchange: function() {},\n                value: null,\n                individual: false,\n                pagesize: 20\n            }).set(options);\n        this.on(\"change\", () => {\n            if (this.model.get(\"onchange\")) {\n                this.model.get(\"onchange\")(this.value());\n            }\n        });\n        this.listenTo(this.model, \"change:data\", this._changeData, this);\n        this.listenTo(this.model, \"change:disabled\", this._changeDisabled, this);\n        this.listenTo(this.model, \"change:wait\", this._changeWait, this);\n        this.listenTo(this.model, \"change:visible\", this._changeVisible, this);\n        this.listenTo(this.model, \"change:value\", this._changeValue, this);\n        this.listenTo(this.model, \"change:multiple change:searchable change:cls change:id\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        if (this.model.get(\"searchable\")) {\n            this._renderSearchable();\n        } else {\n            this._renderClassic();\n        }\n        this.$el.addClass(this.model.get(\"cls\")).attr(\"id\", this.model.get(\"id\"));\n        this.$select\n            .empty()\n            .addClass(\"select\")\n            .attr(\"id\", `${this.model.get(\"id\")}_select`)\n            .prop(\"multiple\", this.model.get(\"multiple\"))\n            .on(\"change\", () => {\n                this.value(this._getValue());\n                this.trigger(\"change\");\n            });\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n        this._changeDisabled();\n    },\n\n    /** Renders the classic selection field */\n    _renderClassic: function() {\n        this.$el\n            .addClass(this.model.get(\"multiple\") ? \"ui-select-multiple\" : \"ui-select\")\n            .append((this.$select = $(\"<select/>\")))\n            .append((this.$dropdown = $(\"<div/>\")))\n            .append((this.$resize = $(\"<div/>\").append((this.$resize_icon = $(\"<i/>\")))));\n        if (this.model.get(\"multiple\")) {\n            this.$dropdown.hide();\n            this.$resize_icon.addClass(\"fa fa-angle-double-right fa-rotate-45\").show();\n            this.$resize\n                .removeClass()\n                .addClass(\"icon-resize\")\n                .show()\n                .off(\"mousedown\")\n                .on(\"mousedown\", event => {\n                    var currentY = event.pageY;\n                    var currentHeight = this.$select.height();\n                    this.minHeight = this.minHeight || currentHeight;\n                    $(\"#dd-helper\")\n                        .show()\n                        .on(\"mousemove\", event => {\n                            this.$select.height(Math.max(currentHeight + (event.pageY - currentY), this.minHeight));\n                        })\n                        .on(\"mouseup mouseleave\", () => {\n                            $(\"#dd-helper\")\n                                .hide()\n                                .off();\n                        });\n                });\n        } else {\n            this.$dropdown.show();\n            this.$resize.hide();\n            this.$resize_icon.hide();\n        }\n    },\n\n    /** Renders the default select2 field */\n    _renderSearchable: function() {\n        this.$el.append((this.$select = $(\"<div/>\"))).append((this.$dropdown = $(\"<div/>\")));\n        this.$dropdown.hide();\n        if (!this.model.get(\"multiple\")) {\n            this.$dropdown.show().on(\"click\", () => {\n                if (this.$select.select2) {\n                    this.$select.select2(\"open\");\n                }\n            });\n        }\n        this.all_button = null;\n        if (this.model.get(\"multiple\") && !this.model.get(\"individual\") && !this.model.get(\"readonly\")) {\n            this.all_button = new Buttons.ButtonCheck({\n                onclick: () => {\n                    var new_value = [];\n                    if (this.all_button.value() !== 0) {\n                        _.each(this.model.get(\"data\"), option => {\n                            new_value.push(option.value);\n                        });\n                    }\n                    this.value(new_value);\n                    this.trigger(\"change\");\n                }\n            });\n            this.$el.prepend(this.all_button.$el);\n        }\n    },\n\n    /** Matches a search term with a given text */\n    _match: function(term, text) {\n        return (\n            !term ||\n            term === \"\" ||\n            String(text)\n                .toUpperCase()\n                .indexOf(term.toUpperCase()) >= 0\n        );\n    },\n\n    /** Updates the selection options */\n    _changeData: function() {\n        this.data = [];\n        if (!this.model.get(\"multiple\") && this.model.get(\"optional\")) {\n            this.data.push({\n                value: \"__null__\",\n                label: this.model.get(\"empty_text\")\n            });\n        }\n        _.each(this.model.get(\"data\"), option => {\n            this.data.push(option);\n        });\n        if (this.length() === 0) {\n            this.data.push({\n                value: \"__null__\",\n                label: this.model.get(\"error_text\")\n            });\n        }\n        if (this.model.get(\"searchable\")) {\n            this.data2 = [];\n            this.data2index = {};\n            _.each(this.data, (option, index) => {\n                let d = {\n                    order: index,\n                    id: option.value,\n                    text: option.label,\n                    tags: option.tags\n                };\n                this.data2.push(d);\n                this.data2index[d.id] = d;\n            });\n            if (this.$select.data(\"select2\")) {\n                this.$select.select2(\"destroy\");\n            }\n            this.matched_tags = {};\n            this.$select.select2({\n                data: this.data2,\n                closeOnSelect: !this.model.get(\"multiple\"),\n                multiple: this.model.get(\"multiple\"),\n                query: q => {\n                    this.matched_tags = {};\n                    var pagesize = this.model.get(\"pagesize\");\n                    var results = _.filter(this.data2, e => {\n                        var found = false;\n                        _.each(e.tags, tag => {\n                            if (this._match(q.term, tag)) {\n                                found = this.matched_tags[tag] = true;\n                            }\n                        });\n                        return found || this._match(q.term, e.text);\n                    });\n                    q.callback({\n                        results: results.slice((q.page - 1) * pagesize, q.page * pagesize),\n                        more: results.length >= q.page * pagesize\n                    });\n                },\n                formatResult: result => {\n                    let extraTagWarning = \"\";\n                    let filteredTags = _.filter(result.tags, t => this.matched_tags.hasOwnProperty(t));\n                    if (filteredTags.length > 5) {\n                        extraTagWarning = `&nbsp;<div class=\"label label-warning\">${filteredTags.length -\n                            5} more tags</div>`;\n                    }\n                    return `\n                    ${_.escape(result.text)}\n                    <div>\n                        ${_.reduce(\n                            filteredTags.slice(0, 5),\n                            (memo, tag) => {\n                                const tagColors = keyedColorScheme(tag.slice(5));\n                                return `${memo}&nbsp;<div style=\"background-color: ${tagColors.primary}; color: ${\n                                    tagColors.contrasting\n                                }; border: 1px solid ${\n                                    tagColors.darker\n                                }\" class=\"badge badge-primary badge-tags\">${_.escape(tag)}</div>`;\n                            },\n                            \"\"\n                        )}\n                        ${extraTagWarning}\n                   </div>`;\n                }\n            });\n            this.$(\".select2-container .select2-search input\").off(\"blur\");\n        } else {\n            this.$select.find(\"option\").remove();\n            _.each(this.data, option => {\n                this.$select.append(\n                    $(\"<option/>\")\n                        .attr(\"value\", option.value)\n                        .html(_.escape(option.label))\n                );\n            });\n        }\n        this.model.set(\"disabled\", this.model.get(\"readonly\") || this.length() === 0);\n        this._changeValue();\n    },\n\n    /** Handles field enabling/disabling, usually used when no options are available */\n    _changeDisabled: function() {\n        if (this.model.get(\"searchable\")) {\n            this.$select.select2(this.model.get(\"disabled\") ? \"disable\" : \"enable\");\n        } else {\n            this.$select.prop(\"disabled\", this.model.get(\"disabled\"));\n        }\n    },\n\n    /** Searchable fields may display a spinner e.g. while waiting for a server response */\n    _changeWait: function() {\n        this.$dropdown\n            .removeClass()\n            .addClass(\"icon-dropdown fa\")\n            .addClass(this.model.get(\"wait\") ? \"fa-spinner fa-spin\" : \"fa-caret-down\");\n    },\n\n    /** Handles field visibility */\n    _changeVisible: function() {\n        this.$el[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n        this.$select[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n    },\n\n    /** Synchronizes the model value with the actually selected field value */\n    _changeValue: function() {\n        this._setValue(this.model.get(\"value\"));\n        if (this.model.get(\"multiple\")) {\n            if (this.all_button) {\n                var value = this._getValue();\n                this.all_button.value($.isArray(value) ? value.length : 0, this.length());\n            }\n        } else if (this._getValue() === null && !this.model.get(\"optional\")) {\n            this._setValue(this.first());\n        }\n    },\n\n    /** Return/Set current selection */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            this.model.set(\"value\", new_value);\n        }\n        return this._getValue();\n    },\n\n    /** Return the first select option */\n    first: function() {\n        return this.data.length > 0 ? this.data[0].value : null;\n    },\n\n    /** Check if a value is an existing option */\n    exists: function(value) {\n        return _.findWhere(this.data, { value: value });\n    },\n\n    /** Return the label/text of the current selection */\n    text: function() {\n        var v = this._getValue();\n        var d = this.exists($.isArray(v) ? v[0] : v);\n        return d ? d.label : \"\";\n    },\n\n    /** Show the select field */\n    show: function() {\n        this.model.set(\"visible\", true);\n    },\n\n    /** Hide the select field */\n    hide: function() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set(\"wait\", true);\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set(\"wait\", false);\n    },\n\n    /** Returns true if the field is disabled */\n    disabled: function() {\n        return this.model.get(\"disabled\");\n    },\n\n    /** Enable the select field */\n    enable: function() {\n        this.model.set(\"disabled\", false);\n    },\n\n    /** Disable the select field */\n    disable: function() {\n        this.model.set(\"disabled\", true);\n    },\n\n    /** Update all available options at once */\n    add: function(options, sorter) {\n        _.each(this.model.get(\"data\"), v => {\n            if (v.keep && !_.findWhere(options, { value: v.value })) {\n                options.push(v);\n            }\n        });\n        if (sorter && options) {\n            options.sort(sorter);\n        }\n        this.model.set(\"data\", options);\n    },\n\n    /** Update available options */\n    update: function(input_def) {\n        this.model.set(\"data\", input_def.data);\n    },\n\n    /** Set the custom onchange callback function */\n    setOnChange: function(callback) {\n        this.model.set(\"onchange\", callback);\n    },\n\n    /** Number of available options */\n    length: function() {\n        return $.isArray(this.model.get(\"data\")) ? this.model.get(\"data\").length : 0;\n    },\n\n    /** Set value to dom */\n    _setValue: function(new_value) {\n        if (new_value === null || new_value === undefined) {\n            new_value = \"__null__\";\n        }\n        if (this.model.get(\"multiple\")) {\n            new_value = $.isArray(new_value) ? new_value : [new_value];\n        } else if ($.isArray(new_value)) {\n            if (new_value.length > 0) {\n                new_value = new_value[0];\n            } else {\n                new_value = \"__null__\";\n            }\n        }\n        if (this.model.get(\"searchable\")) {\n            if ($.isArray(new_value)) {\n                var val = [];\n                _.each(new_value, v => {\n                    var d = this.data2index[v];\n                    if (d) {\n                        val.push(d);\n                    }\n                });\n                new_value = val;\n            } else {\n                new_value = this.data2index[new_value];\n            }\n            this.$select.select2(\"data\", new_value);\n        } else {\n            this.$select.val(new_value);\n        }\n    },\n\n    /** Get value from dom */\n    _getValue: function() {\n        var val = null;\n        if (this.model.get(\"searchable\")) {\n            var selected = this.$select.select2(\"data\");\n            if (selected) {\n                if ($.isArray(selected)) {\n                    val = [];\n                    selected.sort((a, b) => a.order - b.order);\n                    _.each(selected, v => {\n                        val.push(v.id);\n                    });\n                } else {\n                    val = selected.id;\n                }\n            }\n        } else {\n            val = this.$select.val();\n        }\n        return Utils.isEmpty(val) ? null : val;\n    }\n});\n\nexport default {\n    View: View\n};\n","/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n */\n\nimport _ from \"underscore\";\nimport $ from \"jquery\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport { getGalaxyInstance } from \"app\";\nimport _l from \"utils/localization\";\n\n/** Builds a basic iframe */\nexport function iframe(src) {\n    return `<iframe src=\"${src}\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>`;\n}\n\n/** Traverse through json */\nexport function deepeach(dict, callback) {\n    for (var i in dict) {\n        var d = dict[i];\n        if (_.isObject(d)) {\n            var new_dict = callback(d);\n            if (new_dict) {\n                dict[i] = new_dict;\n            }\n            deepeach(d, callback);\n        }\n    }\n}\n\n/** Identifies urls and replaces them with anchors */\nexport function linkify(inputText) {\n    var replacedText;\n    var replacePattern1;\n    var replacePattern2;\n    var replacePattern3;\n\n    // URLs starting with http://, https://, or ftp://\n    replacePattern1 = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim;\n    replacedText = inputText.replace(replacePattern1, '<a href=\"$1\" target=\"_blank\">$1</a>');\n\n    // URLs starting with \"www.\" (without // before it, or it'd re-link the ones done above).\n    replacePattern2 = /(^|[^/])(www\\.[\\S]+(\\b|$))/gim;\n    replacedText = replacedText.replace(replacePattern2, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\n\n    // Change email addresses to mailto:: links.\n    replacePattern3 = /(([a-zA-Z0-9\\-_.])+@[a-zA-Z_]+?(\\.[a-zA-Z]{2,6})+)/gim;\n    replacedText = replacedText.replace(replacePattern3, '<a href=\"mailto:$1\">$1</a>');\n\n    return replacedText;\n}\n\n/** Clone */\nexport function clone(obj) {\n    return JSON.parse(JSON.stringify(obj) || null);\n}\n\n/**\n * Check if a string is a json string\n * @param{String}   text - Content to be validated\n */\nexport function isJSON(text) {\n    return /^[\\],:{}\\s]*$/.test(\n        text\n            .replace(/\\\\[\"\\\\/bfnrtu]/g, \"@\")\n            .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+-]?\\d+)?/g, \"]\")\n            .replace(/(?:^|:|,)(?:\\s*\\[)+/g, \"\")\n    );\n}\n\n/**\n * Sanitize/escape a string\n * @param{String}   content - Content to be sanitized\n */\nexport function sanitize(content) {\n    return $(\"<div/>\")\n        .text(content)\n        .html();\n}\n\n/**\n * Checks if a value or list of values is `empty`\n * usually used for selectable options\n * @param{String}   value - Value or list to be validated\n */\nexport function isEmpty(value) {\n    if (!(value instanceof Array)) {\n        value = [value];\n    }\n    if (value.length === 0) {\n        return true;\n    }\n    for (var i in value) {\n        if ([\"__null__\", \"__undefined__\", null, undefined].indexOf(value[i]) > -1) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * Convert list to pretty string\n * @param{String}   lst - List of strings to be converted in human readable list sentence\n */\nexport function textify(lst) {\n    if ($.isArray(lst)) {\n        lst = lst.toString().replace(/,/g, \", \");\n        var pos = lst.lastIndexOf(\", \");\n        if (pos != -1) {\n            lst = `${lst.substr(0, pos)} or ${lst.substr(pos + 2)}`;\n        }\n        return lst;\n    }\n    return \"\";\n}\n\n/**\n * Request handler for GET\n * @param{String}   url     - Url request is made to\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n * @param{Boolean}  cache   - Use cached data if available\n */\nexport function get(options) {\n    top.__utils__get__ = top.__utils__get__ || {};\n    var cache_key = JSON.stringify(options);\n    if (options.cache && top.__utils__get__[cache_key]) {\n        if (options.success) {\n            options.success(top.__utils__get__[cache_key]);\n        }\n        window.console.debug(`utils.js::get() - Fetching from cache [${options.url}].`);\n    } else {\n        request({\n            url: options.url,\n            data: options.data,\n            success: function(response) {\n                top.__utils__get__[cache_key] = response;\n                if (options.success) {\n                    options.success(response);\n                }\n            },\n            error: function(response, status) {\n                if (options.error) {\n                    options.error(response, status);\n                }\n            }\n        });\n    }\n}\n\n/**\n * Request handler\n * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n * @param{String}   url     - Url request is made to\n * @param{Object}   data    - Data send to url\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n */\nexport function request(options) {\n    // prepare ajax\n    var ajaxConfig = {\n        contentType: \"application/json\",\n        type: options.type || \"GET\",\n        data: options.data || {},\n        url: options.url\n    };\n    // encode data into url\n    if (ajaxConfig.type == \"GET\" || ajaxConfig.type == \"DELETE\") {\n        if (!$.isEmptyObject(ajaxConfig.data)) {\n            ajaxConfig.url += ajaxConfig.url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            ajaxConfig.url += $.param(ajaxConfig.data, true);\n        }\n        ajaxConfig.data = null;\n    } else {\n        ajaxConfig.dataType = \"json\";\n        ajaxConfig.data = JSON.stringify(ajaxConfig.data);\n    }\n\n    // make request\n    $.ajax(ajaxConfig)\n        .done(response => {\n            if (typeof response === \"string\") {\n                try {\n                    response = response.replace(\"Infinity,\", '\"Infinity\",');\n                    response = $.parseJSON(response);\n                } catch (e) {\n                    console.debug(e);\n                }\n            }\n            if (options.success) {\n                options.success(response);\n            }\n        })\n        .fail(response => {\n            var response_text = null;\n            try {\n                response_text = $.parseJSON(response.responseText);\n            } catch (e) {\n                response_text = response.responseText;\n            }\n            if (options.error) {\n                options.error(response_text, response.status);\n            }\n        })\n        .always(() => {\n            if (options.complete) {\n                options.complete();\n            }\n        });\n}\n\n/**\n * Read a property value from CSS\n * @param{String}   classname   - CSS class\n * @param{String}   name        - CSS property\n */\nexport function cssGetAttribute(classname, name) {\n    var el = $(`<div class=\"${classname}\"></div>`);\n    el.appendTo(\":eq(0)\");\n    var value = el.css(name);\n    el.remove();\n    return value;\n}\n\n/**\n * Load a CSS file\n * @param{String}   url - Url of CSS file\n */\nexport function cssLoadFile(url) {\n    if (!$(`link[href^=\"${url}\"]`).length) {\n        $(`<link href=\"${getAppRoot()}${url}\" rel=\"stylesheet\">`).appendTo(\"head\");\n    }\n}\n\n/**\n * Safely merge to dictionaries\n * @param{Object}   options         - Target dictionary\n * @param{Object}   optionsDefault  - Source dictionary\n */\nexport function merge(options, optionsDefault) {\n    if (options) {\n        return _.defaults(options, optionsDefault);\n    } else {\n        return optionsDefault;\n    }\n}\n\n/**\n * Round floaing point 'number' to 'numPlaces' number of decimal places.\n * @param{Object}   number      a floaing point number\n * @param{Object}   numPlaces   number of decimal places\n */\nexport function roundToDecimalPlaces(number, numPlaces) {\n    var placesMultiplier = 1;\n    for (var i = 0; i < numPlaces; i++) {\n        placesMultiplier *= 10;\n    }\n    return Math.round(number * placesMultiplier) / placesMultiplier;\n}\n\n// calculate on import\nvar kb = 1024;\n\nvar mb = kb * kb;\nvar gb = mb * kb;\nvar tb = gb * kb;\n/**\n * Format byte size to string with units\n * @param{Integer}   size           - Size in bytes\n * @param{Boolean}   normal_font    - Switches font between normal and bold\n */\nexport function bytesToString(size, normal_font, numberPlaces) {\n    numberPlaces = numberPlaces !== undefined ? numberPlaces : 1;\n    // identify unit\n    var unit = \"\";\n    if (size >= tb) {\n        size = size / tb;\n        unit = \"TB\";\n    } else if (size >= gb) {\n        size = size / gb;\n        unit = \"GB\";\n    } else if (size >= mb) {\n        size = size / mb;\n        unit = \"MB\";\n    } else if (size >= kb) {\n        size = size / kb;\n        unit = \"KB\";\n    } else if (size > 0) {\n        unit = \"b\";\n    } else {\n        return normal_font ? \"0 b\" : \"<strong>-</strong>\";\n    }\n    // return formatted string\n    var rounded = unit == \"b\" ? size : roundToDecimalPlaces(size, numberPlaces);\n    if (normal_font) {\n        return `${rounded} ${unit}`;\n    } else {\n        return `<strong>${rounded}</strong> ${unit}`;\n    }\n}\n\n/** Create a unique id */\nexport function uid() {\n    top.__utils__uid__ = top.__utils__uid__ || 0;\n    return `uid-${top.__utils__uid__++}`;\n}\n\n/** Create a time stamp */\nexport function time() {\n    var d = new Date();\n    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n    return `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()}, ${hours}:${minutes}`;\n}\n\n/** Append script and style tags to Galaxy main application */\nexport function appendScriptStyle(data) {\n    // create a script tag inside head tag\n    if (data.script && data.script !== \"\") {\n        $(\"<script/>\", { type: \"text/javascript\" })\n            .text(data.script)\n            .appendTo(\"head\");\n    }\n    // create a style tag inside head tag\n    if (data.styles && data.styles !== \"\") {\n        $(\"<style/>\", { type: \"text/css\" })\n            .text(data.styles)\n            .appendTo(\"head\");\n    }\n}\n\n/** Get querystrings from url */\nexport function getQueryString(key) {\n    return decodeURIComponent(\n        window.location.search.replace(\n            new RegExp(`^(?:.*[&\\\\?]${encodeURIComponent(key).replace(/[.+*]/g, \"\\\\$&\")}(?:\\\\=([^&]*))?)?.*$`, \"i\"),\n            \"$1\"\n        )\n    );\n}\n\nexport function setWindowTitle(title) {\n    let Galaxy = getGalaxyInstance();\n    if (title) {\n        window.document.title = `Galaxy ${Galaxy.config.brand ? ` | ${Galaxy.config.brand}` : \"\"} | ${_l(title)}`;\n    } else {\n        window.document.title = `Galaxy ${Galaxy.config.brand ? ` | ${Galaxy.config.brand}` : \"\"}`;\n    }\n}\n\n/**\n * Calculate a 32 bit FNV-1a hash\n * Found here: https://gist.github.com/vaiorabbit/5657561\n * Ref.: http://isthe.com/chongo/tech/comp/fnv/\n *\n * @param {string} str the input value\n * @returns {integer}\n */\nexport function hashFnv32a(str) {\n    var i,\n        l,\n        hval = 0x811c9dc5;\n\n    for (i = 0, l = str.length; i < l; i++) {\n        hval ^= str.charCodeAt(i);\n        hval += (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n    }\n    return hval >>> 0;\n}\n\nexport default {\n    cssLoadFile: cssLoadFile,\n    cssGetAttribute: cssGetAttribute,\n    get: get,\n    merge: merge,\n    iframe: iframe,\n    bytesToString: bytesToString,\n    uid: uid,\n    time: time,\n    request: request,\n    sanitize: sanitize,\n    textify: textify,\n    isEmpty: isEmpty,\n    deepeach: deepeach,\n    isJSON: isJSON,\n    clone: clone,\n    linkify: linkify,\n    appendScriptStyle: appendScriptStyle,\n    getQueryString: getQueryString,\n    setWindowTitle: setWindowTitle\n};\n","/**\n *  Renders tabs e.g. used in the charts editor, behaves similar to repeat and section rendering\n */\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\n\nexport var View = Backbone.View.extend({\n    initialize: function(options) {\n        this.collection = new Backbone.Collection();\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                onchange: null,\n                visible: true\n            }).set(options);\n        this.setElement($(this._template()));\n        this.$nav = this.$(\".tab-navigation\");\n        this.$content = this.$(\".tab-content\");\n        this.$el.on(\"click\", () => {\n            $(\".tooltip\").hide();\n        });\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"add\", this._add, this);\n        this.listenTo(this.collection, \"remove\", this._remove, this);\n        this.listenTo(this.collection, \"change\", this._change, this);\n        this.listenTo(this.collection, \"reset\", this._reset, this);\n        this.listenTo(this.collection, \"add remove reset\", this.render, this);\n    },\n\n    render: function() {\n        var id = this.model.get(\"current\");\n        id = this.$(`#${id}`).length > 0 ? id : this.first();\n        if (id) {\n            this.$nav.find(\".nav-link.active\").removeClass(\"active\");\n            this.$content.children().removeClass(\"active\");\n            this.$(`#tab-${id} .nav-link`).addClass(\"active\");\n            this.$(`#${id}`).addClass(\"active\");\n        }\n        this.$el[this.model.get(\"visible\") ? \"fadeIn\" : \"fadeOut\"](\"fast\");\n        this.$nav[this.size() > 1 ? \"show\" : \"hide\"]();\n    },\n\n    /** Returns tab id for currently shown tab */\n    current: function() {\n        return this.model.get(\"current\");\n    },\n\n    /** Show tab view and highlight a tab by id */\n    show: function(id) {\n        if (id) {\n            this.model.set({ current: id, visible: true });\n            this.model.get(\"onchange\") && this.model.get(\"onchange\")(id);\n        }\n    },\n\n    /** Hide tab view */\n    hide: function() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Returns first tab */\n    first: function() {\n        var model = this.collection.first();\n        return model && model.id;\n    },\n\n    /** Returns current number of tabs */\n    size: function() {\n        return this.collection.length;\n    },\n\n    /** Adds a new tab */\n    add: function(options) {\n        this.collection.add(options);\n    },\n\n    /** Delete tab */\n    del: function(id) {\n        this.collection.remove(id);\n    },\n\n    /** Delete all tabs */\n    delAll: function() {\n        this.collection.reset();\n    },\n\n    /** Show tab */\n    showTab: function(id) {\n        this.collection.get(id).set(\"hidden\", false);\n    },\n\n    /** Hide tab */\n    hideTab: function(id) {\n        this.collection.get(id).set(\"hidden\", true);\n    },\n\n    /** Adds a new tab */\n    _add: function(tab_model) {\n        var self = this;\n        var options = tab_model.attributes;\n        this.$content.append(\n            $(\"<div/>\")\n                .attr(\"id\", options.id)\n                .addClass(\"tab-pane\")\n                .append(options.$el)\n        );\n        this.$nav.append(\n            $(this._template_tab(options))\n                .show()\n                .tooltip({\n                    title: options.tooltip || \"\",\n                    placement: \"bottom\",\n                    container: self.$el\n                })\n                .on(\"click\", e => {\n                    e.preventDefault();\n                    self.show(options.id);\n                })\n        );\n        if (this.size() == 1) {\n            this.show(options.id);\n        }\n    },\n\n    /** Delete tab */\n    _remove: function(tab_model) {\n        this.$(`#tab-${tab_model.id}`).remove();\n        this.$(`#${tab_model.id}`).remove();\n    },\n\n    /** Reset collection */\n    _reset: function() {\n        this.$nav.empty();\n        this.$content.empty();\n    },\n\n    /** Change tab */\n    _change: function(tab_model) {\n        this.$(`#tab-${tab_model.id}`)[tab_model.get(\"hidden\") ? \"hide\" : \"show\"]();\n    },\n\n    /** Main template */\n    _template: function() {\n        return $(\"<div/>\")\n            .addClass(\"tabbable tabs-left\")\n            .append(\n                $(\"<ul/>\")\n                    .attr(\"style\", \"display: flex\")\n                    .addClass(\"tab-navigation nav nav-tabs\")\n            )\n            .append($(\"<div/>\").addClass(\"tab-content\"));\n    },\n\n    /** Tab template */\n    _template_tab: function(options) {\n        var $tmpl = $(\"<li/>\")\n            .addClass(\"nav-item\")\n            .attr(\"id\", `tab-${options.id}`)\n            .append(\n                $(\"<a/>\")\n                    .addClass(\"nav-link\")\n                    .attr(\"id\", `tab-title-link-${options.id}`)\n            );\n        var $href = $tmpl.find(\"a\");\n        options.icon &&\n            $href.append(\n                $(\"<i/>\")\n                    .addClass(\"fa\")\n                    .addClass(options.icon)\n            );\n        options.title &&\n            $href.append(\n                $(\"<span/>\")\n                    .attr(\"id\", `tab-title-text-${options.id}`)\n                    .addClass(\"tab-title-text ml-1\")\n                    .append(options.title)\n            );\n        return $tmpl;\n    }\n});\n\nexport default { View: View };\n","import _ from \"underscore\";\nimport jQuery from \"jquery\";\nimport Backbone from \"backbone\";\nimport { getAppRoot } from \"onload/loadConfig\";\nimport STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"dataset\";\n//==============================================================================\nvar searchableMixin = BASE_MVC.SearchableModelMixin;\n/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n */\nvar DatasetAssociation = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(\n    BASE_MVC.mixin(\n        searchableMixin,\n        /** @lends DatasetAssociation.prototype */ {\n            _logNamespace: logNamespace,\n\n            /** default attributes for a model */\n            defaults: {\n                state: STATES.NEW,\n                deleted: false,\n                purged: false,\n                name: \"(unnamed dataset)\",\n                accessible: true,\n                // sniffed datatype (sam, tabular, bed, etc.)\n                data_type: \"\",\n                file_ext: \"\",\n                file_size: 0,\n\n                // array of associated file types (eg. [ 'bam_index', ... ])\n                meta_files: [],\n\n                misc_blurb: \"\",\n                misc_info: \"\",\n\n                tags: []\n                // do NOT default on annotation, as this default is valid and will be passed on 'save'\n                //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n                //annotation          : ''\n            },\n\n            /** instance vars and listeners */\n            initialize: function(attributes, options) {\n                this.debug(`${this}(Dataset).initialize`, attributes, options);\n\n                //!! this state is not in trans.app.model.Dataset.states - set it here -\n                if (!this.get(\"accessible\")) {\n                    this.set(\"state\", STATES.NOT_VIEWABLE);\n                }\n\n                /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n                this.urls = this._generateUrls();\n\n                this._setUpListeners();\n            },\n\n            _getDatasetId: function() {\n                return this.get(\"id\");\n            },\n\n            /** returns misc. web urls for rendering things like re-run, display, etc. */\n            _generateUrls: function() {\n                const id = this._getDatasetId();\n                if (!id) {\n                    return {};\n                }\n                var urls = {\n                    purge: `datasets/${id}/purge_async`,\n                    display: `datasets/${id}/display/?preview=True`,\n                    edit: `datasets/edit?dataset_id=${id}`,\n                    download: `datasets/${id}/display${this._downloadQueryParameters()}`,\n                    report_error: `dataset/errors?id=${id}`,\n                    rerun: `tool_runner/rerun?id=${id}`,\n                    show_params: `datasets/${id}/show_params`,\n                    visualization: \"visualization\",\n                    meta_download: `dataset/get_metadata_file?hda_id=${id}&metadata_name=`\n                };\n                _.each(urls, (value, key) => {\n                    urls[key] = getAppRoot() + value;\n                });\n                this.urls = urls;\n                return urls;\n            },\n\n            _downloadQueryParameters: function() {\n                return `?to_ext=${this.get(\"file_ext\")}`;\n            },\n\n            /** set up any event listeners\n             *  event: state:ready  fired when this DA moves into/is already in a ready state\n             */\n            _setUpListeners: function() {\n                // if the state has changed and the new state is a ready state, fire an event\n                this.on(\"change:state\", function(currModel, newState) {\n                    this.log(`${this} has changed state:`, currModel, newState);\n                    if (this.inReadyState()) {\n                        this.trigger(\"state:ready\", currModel, newState, this.previous(\"state\"));\n                    }\n                });\n                // the download url (currently) relies on having a correct file extension\n                this.on(\"change:id change:file_ext\", function(currModel) {\n                    this._generateUrls();\n                });\n            },\n\n            // ........................................................................ common queries\n            /** override to add urls */\n            toJSON: function() {\n                var json = Backbone.Model.prototype.toJSON.call(this);\n                //console.warn( 'returning json?' );\n                //return json;\n                return _.extend(json, {\n                    urls: this.urls\n                });\n            },\n\n            /** Is this dataset deleted or purged? */\n            isDeletedOrPurged: function() {\n                return this.get(\"deleted\") || this.get(\"purged\");\n            },\n\n            /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n             *      processing (for the ds) is left to do on the server.\n             */\n            inReadyState: function() {\n                var ready = _.contains(STATES.READY_STATES, this.get(\"state\"));\n                return this.isDeletedOrPurged() || ready;\n            },\n\n            /** Does this model already contain detailed data (as opposed to just summary level data)? */\n            hasDetails: function() {\n                // if it's inaccessible assume it has everything it needs\n                if (!this.get(\"accessible\")) {\n                    return true;\n                }\n                return this.has(\"annotation\");\n            },\n\n            /** Convenience function to match dataset.has_data. */\n            hasData: function() {\n                return this.get(\"file_size\") > 0;\n            },\n\n            // ........................................................................ ajax\n            fetch: function(options) {\n                var dataset = this;\n                return Backbone.Model.prototype.fetch.call(this, options).always(() => {\n                    dataset._generateUrls();\n                });\n            },\n\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** override to wait by default */\n            save: function(attrs, options) {\n                options = options || {};\n                options.wait = _.isUndefined(options.wait) ? true : options.wait;\n                return Backbone.Model.prototype.save.call(this, attrs, options);\n            },\n\n            //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n            /** save this dataset, _Mark_ing it as deleted (just a flag) */\n            delete: function(options) {\n                if (this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true }, options);\n            },\n            /** save this dataset, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\") || this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** remove the file behind this dataset from the filesystem (if permitted) */\n            purge: function _purge(options) {\n                //TODO: use, override model.destroy, HDA.delete({ purge: true })\n                if (this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                options = options || {};\n                options.url = this.urls.purge;\n\n                //TODO: ideally this would be a DELETE call to the api\n                //  using purge async for now\n                var hda = this;\n\n                var xhr = jQuery.ajax(options);\n                xhr.done((message, status, responseObj) => {\n                    hda.set({ deleted: true, purged: true });\n                });\n                xhr.fail((xhr, status, message) => {\n                    // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n                    // unbury and re-add to xhr\n                    var error = _l(\"Unable to purge dataset\");\n                    var messageBuriedInUnfortunatelyFormattedError =\n                        \"Removal of datasets by users \" + \"is not allowed in this Galaxy instance\";\n                    if (xhr.responseJSON && xhr.responseJSON.error) {\n                        error = xhr.responseJSON.error;\n                    } else if (xhr.responseText.indexOf(messageBuriedInUnfortunatelyFormattedError) !== -1) {\n                        error = messageBuriedInUnfortunatelyFormattedError;\n                    }\n                    xhr.responseText = error;\n                    hda.trigger(\"error\", hda, xhr, options, _l(error), {\n                        error: error\n                    });\n                });\n                return xhr;\n            },\n\n            // ........................................................................ searching\n            /** what attributes of an HDA will be used in a text search */\n            searchAttributes: [\"name\", \"file_ext\", \"genome_build\", \"misc_blurb\", \"misc_info\", \"annotation\", \"tags\"],\n\n            /** our attr keys don't often match the labels we display to the user - so, when using\n             *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n             *      following attr keys.\n             */\n            searchAliases: {\n                title: \"name\",\n                format: \"file_ext\",\n                database: \"genome_build\",\n                blurb: \"misc_blurb\",\n                description: \"misc_blurb\",\n                info: \"misc_info\",\n                tag: \"tags\"\n            },\n\n            // ........................................................................ misc\n            /** String representation */\n            toString: function() {\n                var nameAndId = this.get(\"id\") || \"\";\n                if (this.get(\"name\")) {\n                    nameAndId = `\"${this.get(\"name\")}\",${nameAndId}`;\n                }\n                return `Dataset(${nameAndId})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection for dataset associations.\n */\nvar DatasetAssociationCollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends HistoryContents.prototype */ {\n        _logNamespace: logNamespace,\n\n        model: DatasetAssociation,\n\n        /** root api url */\n        urlRoot: `${getAppRoot()}api/datasets`,\n\n        /** url fn */\n        url: function() {\n            return this.urlRoot;\n        },\n\n        // ........................................................................ common queries\n        /** Get the ids of every item in this collection\n         *  @returns array of encoded ids\n         */\n        ids: function() {\n            return this.map(item => item.get(\"id\"));\n        },\n\n        /** Get contents that are not ready\n         *  @returns array of content models\n         */\n        notReady: function() {\n            return this.filter(content => !content.inReadyState());\n        },\n\n        /** return true if any datasets don't have details */\n        haveDetails: function() {\n            return this.all(dataset => dataset.hasDetails());\n        },\n\n        // ........................................................................ ajax\n        /** using a queue, perform ajaxFn on each of the models in this collection */\n        ajaxQueue: function(ajaxFn, options) {\n            var deferred = jQuery.Deferred();\n            var startingLength = this.length;\n            var responses = [];\n\n            if (!startingLength) {\n                deferred.resolve([]);\n                return deferred;\n            }\n\n            // use reverse order (stylistic choice)\n            var ajaxFns = this.chain()\n                .reverse()\n                .map((dataset, i) => () => {\n                    var xhr = ajaxFn.call(dataset, options);\n                    // if successful, notify using the deferred to allow tracking progress\n                    xhr.done(response => {\n                        deferred.notify({\n                            curr: i,\n                            total: startingLength,\n                            response: response,\n                            model: dataset\n                        });\n                    });\n                    // (regardless of previous error or success) if not last ajax call, shift and call the next\n                    //  if last fn, resolve deferred\n                    xhr.always(response => {\n                        responses.push(response);\n                        if (ajaxFns.length) {\n                            ajaxFns.shift()();\n                        } else {\n                            deferred.resolve(responses);\n                        }\n                    });\n                })\n                .value();\n            // start the queue\n            ajaxFns.shift()();\n\n            return deferred;\n        },\n\n        // ........................................................................ sorting/filtering\n        /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n        matches: function(matchesWhat) {\n            return this.filter(dataset => dataset.matches(matchesWhat));\n        },\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetAssociationCollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DatasetAssociation: DatasetAssociation,\n    DatasetAssociationCollection: DatasetAssociationCollection\n};\n","import { standardInit } from \"onload\";\n\nwindow.addEventListener(\"load\", () => standardInit(\"generic\"));\n","// Generic Vue component mount for use in transitional\n// mount functions\n\nimport Vue from \"vue\";\nimport store from \"../store\";\nimport _l from \"utils/localization\";\n\n// make localization filter available to all components\nVue.filter(\"localize\", value => _l(value));\n\nexport const mountVueComponent = ComponentDefinition => (propsData, el) => {\n    let component = Vue.extend(ComponentDefinition);\n    return new component({ store, propsData, el });\n};\n","/**\n * Vuex store module used for managing search parameters in the grid. Currently\n * only manages the tags that access this store via the new tagging components,\n * but presumably the entire grid search filter criteria will live here one day.\n */\n\nexport const gridSearchStore = {\n    state: {\n        searchTags: new Set()\n    },\n    mutations: {\n        // TODO: we could write an equivalence comparator here for searchTag\n        // Sets and not register a change if the new set is equivalent\n        setSearchTags(state, tags) {\n            state.searchTags = new Set(tags);\n        }\n    },\n    actions: {\n        toggleSearchTag({ state, commit }, { text }) {\n            let tags = new Set(state.searchTags);\n            tags.has(text) ? tags.delete(text) : tags.add(text);\n            commit(\"setSearchTags\", tags);\n        },\n        removeSearchTag({ state, commit }, { text }) {\n            let tags = new Set(state.searchTags);\n            tags.delete(text);\n            commit(\"setSearchTags\", tags);\n        },\n        clearSearchTags({ state, commit }) {\n            commit(\"setSearchTags\", new Set());\n        }\n    }\n};\n","export const state = {\n    userTagList: [], // List of recent user tags\n    modelTagCache: new Map() // Maps model id to list of tags\n};\n\nexport const getters = {\n    getTagsById: state => key => {\n        if (state.modelTagCache.has(key)) {\n            let tagSet = state.modelTagCache.get(key); //.sort();\n            return Array.from(tagSet);\n        }\n        return [];\n    }\n};\n\nexport const actions = {\n    updateTags({ commit }, { key, tags }) {\n        commit(\"setTags\", { key, tags });\n    },\n    initializeTags({ dispatch, state }, { key, tags }) {\n        if (!state.modelTagCache.has(key)) {\n            dispatch(\"updateTags\", { key, tags });\n        }\n    }\n};\n\nexport const mutations = {\n    setTags(state, { key, tags }) {\n        state.modelTagCache = new Map(state.modelTagCache);\n        state.modelTagCache.set(key, new Set(tags));\n    },\n    reset(state) {\n        state.userTagList = [];\n        state.modelTagCache = new Map();\n    }\n};\n\nexport const tagStore = {\n    state,\n    getters,\n    actions,\n    mutations\n};\n","/**\n * Central Vuex store\n */\n\nimport Vue from \"vue\";\nimport Vuex from \"vuex\";\nimport { gridSearchStore } from \"./gridSearchStore\";\nimport { tagStore } from \"./tagStore\";\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n    modules: {\n        gridSearch: gridSearchStore,\n        tags: tagStore\n    }\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport DATASET_LI_EDIT from \"mvc/dataset/dataset-li-edit\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI_EDIT.DatasetListItemEdit;\n/** @class Editing view for HistoryDatasetAssociation.\n */\nvar HDAListItemEdit = _super.extend(\n    /** @lends HDAListItemEdit.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n\n                // special case the need for the rerunnable and creating_job attributes\n                // needed for rendering re-run button on queued, running datasets\n            } else if (!view.model.has(\"rerunnable\")) {\n                return view.model.fetch({\n                    silent: true,\n                    data: {\n                        // only fetch rerunnable and creating_job to keep overhead down\n                        keys: [\"rerunnable\", \"creating_job\"].join(\",\")\n                    }\n                });\n            }\n            return $.when();\n        },\n\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .unhide-link\": function(ev) {\n                this.model.unhide();\n                return false;\n            }\n        }),\n\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAListItemEdit(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemEdit.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: BASE_MVC.wrapTemplate(\n            [\n                \"<% if( !dataset.visible ){ %>\",\n                // add a link to unhide a dataset\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                _l(\"This dataset has been hidden\"),\n                '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">',\n                _l(\"Unhide it\"),\n                \"</a>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        //NOTE: *steal* the HDAListItemView titleBar\n        titleBar: HDA_LI.HDAListItemView.prototype.templates.titleBar,\n        warnings: warnings\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDAListItemEdit: HDAListItemEdit\n};\n","/**\n *  This class defines a queue to ensure that multiple deferred callbacks are executed sequentially.\n */\nimport $ from \"jquery\";\nimport Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport { getGalaxyInstance } from \"app\";\n\nexport default Backbone.Model.extend({\n    initialize: function() {\n        this.active = {};\n        this.last = null;\n    },\n\n    /** Adds a callback to the queue. Upon execution a deferred object is parsed to the callback i.e. callback( deferred ).\n     *  If the callback does not take any arguments, the deferred is resolved instantly.\n     */\n    execute: function(callback) {\n        var self = this;\n        var id = Utils.uid();\n        var has_deferred = callback.length > 0;\n        let Galaxy = getGalaxyInstance();\n\n        // register process\n        this.active[id] = true;\n\n        // deferred process\n        var process = $.Deferred();\n        process.promise().always(function() {\n            delete self.active[id];\n            has_deferred &&\n                Galaxy.emit.debug(\n                    \"deferred::execute()\",\n                    `${this.state()\n                        .charAt(0)\n                        .toUpperCase() + this.state().slice(1)} ${id}`\n                );\n        });\n\n        // deferred queue\n        $.when(this.last).always(() => {\n            if (self.active[id]) {\n                has_deferred && Galaxy.emit.debug(\"deferred::execute()\", `Running ${id}`);\n                callback(process);\n                !has_deferred && process.resolve();\n            } else {\n                process.reject();\n            }\n        });\n        this.last = process.promise();\n    },\n\n    /** Resets the promise queue. All currently queued but unexecuted callbacks/promises will be rejected.\n     */\n    reset: function() {\n        let Galaxy = getGalaxyInstance();\n        Galaxy.emit.debug(\"deferred::execute()\", \"Reset\");\n        for (var i in this.active) {\n            this.active[i] = false;\n        }\n    },\n\n    /** Returns true if all processes are done.\n     */\n    ready: function() {\n        return $.isEmptyObject(this.active);\n    }\n});\n","// =============================================================================\n/**\n * view for a popup menu\n */\nimport $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nvar PopupMenu = Backbone.View.extend({\n    //TODO: maybe better as singleton off the Galaxy obj\n    /** Cache the desired button element and options, set up the button click handler\n     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n     */\n    initialize: function($button, options) {\n        // default settings\n        this.$button = $button;\n        if (!this.$button.length) {\n            this.$button = $(\"<div/>\");\n        }\n        this.options = options || [];\n        this.$button.data(\"popupmenu\", this);\n\n        // set up button click -> open menu behavior\n        var menu = this;\n        this.$button.click(event => {\n            // if there's already a menu open, remove it\n            $(\".popmenu-wrapper\").remove();\n            menu._renderAndShow(event);\n            return false;\n        });\n    },\n\n    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n    _renderAndShow: function(clickEvent) {\n        this.render();\n        this.$el\n            .appendTo(\"body\")\n            .css(this._getShownPosition(clickEvent))\n            .show();\n        this._setUpCloseBehavior();\n    },\n\n    // render the menu\n    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n    render: function() {\n        // render the menu body absolute and hidden, fill with template\n        this.$el\n            .addClass(\"popmenu-wrapper\")\n            .hide()\n            .css({ position: \"absolute\" })\n            .html(this.template(this.$button.attr(\"id\"), this.options));\n\n        // set up behavior on each link/anchor elem\n        if (this.options.length) {\n            var menu = this;\n            //precondition: there should be one option per li\n            this.$el.find(\"li\").each(function(i, li) {\n                var option = menu.options[i];\n\n                // if the option has 'func', call that function when the anchor is clicked\n                if (option.func) {\n                    $(this)\n                        .children(\"a.popupmenu-option\")\n                        .click(event => {\n                            option.func.call(menu, event, option);\n                            // We must preventDefault otherwise clicking \"cancel\"\n                            // on a purge or something still navigates and causes\n                            // the action.\n                            event.preventDefault();\n                            // bubble up so that an option click will call the close behavior\n                        });\n                }\n            });\n        }\n        return this;\n    },\n\n    template: function(id, options) {\n        return ['<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions(options), \"</ul>\"].join(\"\");\n    },\n\n    _templateOptions: function(options) {\n        if (!options.length) {\n            return \"<li>(no options)</li>\";\n        }\n        return _.map(options, option => {\n            if (option.divider) {\n                return '<li class=\"divider\"></li>';\n            } else if (option.header) {\n                return ['<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, \"</a></li>\"].join(\"\");\n            }\n            var href = option.href || \"javascript:void(0);\";\n            var target = option.target ? ` target=\"${option.target}\"` : \"\";\n\n            var check = option.checked ? '<span class=\"fa fa-check\"></span>' : \"\";\n\n            return [\n                '<li><a class=\"popupmenu-option\" href=\"',\n                href,\n                '\"',\n                target,\n                \">\",\n                check,\n                option.html,\n                \"</a></li>\"\n            ].join(\"\");\n        }).join(\"\");\n    },\n\n    // get the absolute position/offset for the menu\n    _getShownPosition: function(clickEvent) {\n        // display menu horiz. centered on click...\n        var menuWidth = this.$el.width();\n        var x = clickEvent.pageX - menuWidth / 2;\n\n        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n        x = Math.min(x, $(document).scrollLeft() + $(window).width() - menuWidth - 5);\n        x = Math.max(x, $(document).scrollLeft() + 5);\n        return {\n            top: clickEvent.pageY,\n            left: x\n        };\n    },\n\n    // bind an event handler to all available frames so that when anything is clicked\n    // the menu is removed from the DOM and the event handler unbinds itself\n    _setUpCloseBehavior: function() {\n        var menu = this;\n        //TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\n        // function to close popup and unbind itself\n        function closePopup(event) {\n            $(document).off(\"click.close_popup\");\n            try {\n                if (window && window.parent !== window) {\n                    $(window.parent.document).off(\"click.close_popup\");\n                } else {\n                    $(\"iframe#galaxy_main\")\n                        .contents()\n                        .off(\"click.close_popup\");\n                }\n            } catch (err) {\n                if (err instanceof DOMException) {\n                    console.debug(\n                        \"Error clearing parent popups, likely cross-origin frame access from the toolshed and not problematic.\"\n                    );\n                } else {\n                    console.debug(err);\n                }\n            }\n            menu.remove();\n        }\n\n        $(\"html\").one(\"click.close_popup\", closePopup);\n        try {\n            if (window && window.parent !== window) {\n                $(window.parent.document)\n                    .find(\"html\")\n                    .one(\"click.close_popup\", closePopup);\n            } else {\n                $(\"iframe#galaxy_main\")\n                    .contents()\n                    .one(\"click.close_popup\", closePopup);\n            }\n        } catch (err) {\n            if (err instanceof DOMException) {\n                console.debug(\n                    \"Error clearing parent popups, likely cross-origin frame access from the toolshed and not problematic.\"\n                );\n            } else {\n                console.debug(err);\n            }\n        }\n    },\n\n    // add a menu option/item at the given index\n    addItem: function(item, index) {\n        // append to end if no index\n        index = index >= 0 ? index : this.options.length;\n        this.options.splice(index, 0, item);\n        return this;\n    },\n\n    // remove a menu option/item at the given index\n    removeItem: function(index) {\n        if (index >= 0) {\n            this.options.splice(index, 1);\n        }\n        return this;\n    },\n\n    // search for a menu option by its html\n    findIndexByHtml: function(html) {\n        for (var i = 0; i < this.options.length; i++) {\n            if (_.has(this.options[i], \"html\") && this.options[i].html === html) {\n                return i;\n            }\n        }\n        return null;\n    },\n\n    // search for a menu option by its html\n    findItemByHtml: function(html) {\n        return this.options[this.findIndexByHtml(html)];\n    },\n\n    // string representation\n    toString: function() {\n        return \"PopupMenu\";\n    }\n});\n/** shortcut to new for when you don't need to preserve the ref */\nPopupMenu.create = function _create($button, options) {\n    return new PopupMenu($button, options);\n};\n\n// -----------------------------------------------------------------------------\n// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n// to the newer backbone.js PopupMenu\n\n/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n *      Converts initial_options to object array used by PopupMenu.\n *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n *  @param {Object} initial_options map of key -> values, where\n *      key is option text, value is fn to call when option is clicked\n *  @returns {PopupMenu} the PopupMenu created\n */\nPopupMenu.make_popupmenu = (button_element, initial_options) => {\n    var convertedOptions = [];\n    _.each(initial_options, (optionVal, optionKey) => {\n        var newOption = { html: optionKey };\n\n        // keys with null values indicate: header\n        if (optionVal === null) {\n            // !optionVal? (null only?)\n            newOption.header = true;\n\n            // keys with function values indicate: a menu option\n        } else if ($.type(optionVal) === \"function\") {\n            newOption.func = optionVal;\n        }\n        //TODO:?? any other special optionVals?\n        // there was no divider option originally\n        convertedOptions.push(newOption);\n    });\n    return new PopupMenu($(button_element), convertedOptions);\n};\n\n/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n *  @param {jQuery} $parent the element that contains the links to convert to options\n *  @param {String} selector jq selector string to find links\n *  @returns {Object[]} the options array to initialize a PopupMenu\n */\n//TODO: lose parent and selector, pass in array of links, use map to return options\nPopupMenu.convertLinksToOptions = ($parent, selector) => {\n    $parent = $($parent);\n    selector = selector || \"a\";\n    var options = [];\n    $parent.find(selector).each((elem, i) => {\n        var option = {};\n        var $link = $(elem);\n\n        // convert link text to the option text (html) and the href into the option func\n        option.html = $link.text();\n        if ($link.attr(\"href\")) {\n            var linkHref = $link.attr(\"href\");\n            var linkTarget = $link.attr(\"target\");\n            var confirmText = $link.attr(\"confirm\");\n\n            option.func = () => {\n                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n                //  if the user cancels - do nothing\n                if (confirmText && !confirm(confirmText)) {\n                    return;\n                }\n\n                // if there's no confirm attribute, or the user accepted the confirm dialog:\n                switch (linkTarget) {\n                    // relocate the center panel\n                    case \"_parent\":\n                        window.parent.location = linkHref;\n                        break;\n\n                    // relocate the entire window\n                    case \"_top\":\n                        window.top.location = linkHref;\n                        break;\n\n                    // relocate this panel\n                    default:\n                        window.location = linkHref;\n                }\n            };\n        }\n        options.push(option);\n    });\n    return options;\n};\n\n/** Create a single popupmenu from existing DOM button and anchor elements\n *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n */\nPopupMenu.fromExistingDom = ($buttonElement, $menuElement, menuElementLinkSelector) => {\n    $buttonElement = $($buttonElement);\n    $menuElement = $($menuElement);\n    var options = PopupMenu.convertLinksToOptions($menuElement, menuElementLinkSelector);\n    // we're done with the menu (having converted it to an options map)\n    $menuElement.remove();\n    return new PopupMenu($buttonElement, options);\n};\n\n/** Create all popupmenus within a document or a more specific element\n *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n *      Will be passed $menuElement, parent.\n *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n *  @returns {PopupMenu[]} array of popupmenus created\n */\nPopupMenu.make_popup_menus = (parent, menuSelector, buttonSelectorBuildFn) => {\n    parent = parent || document;\n    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n    //  which contains the id of the button that activates the menu\n    menuSelector = menuSelector || \"div[popupmenu]\";\n    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n    buttonSelectorBuildFn = buttonSelectorBuildFn || (($menuElement, parent) => `#${$menuElement.attr(\"popupmenu\")}`);\n\n    // aggregate and return all PopupMenus\n    var popupMenusCreated = [];\n    $(parent)\n        .find(menuSelector)\n        .each(function() {\n            var $menuElement = $(this);\n\n            var $buttonElement = $(parent).find(buttonSelectorBuildFn($menuElement, parent));\n\n            popupMenusCreated.push(PopupMenu.fromDom($buttonElement, $menuElement));\n            $buttonElement.addClass(\"popup\");\n        });\n    return popupMenusCreated;\n};\n\n// =============================================================================\nexport default PopupMenu;\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Backbone from \"backbone\";\nimport { getGalaxyInstance } from \"app\";\n\nvar MIN_PANEL_WIDTH = 160;\nvar MAX_PANEL_WIDTH = 800;\n\n/** View for left/right panels used by Page view */\nvar SidePanel = Backbone.View.extend({\n    initialize: function(options) {\n        this.view = options.view;\n        this.hidden = false;\n        this.saved_size = null;\n        this.hiddenByTool = false;\n    },\n\n    $center: function() {\n        return this.$el.siblings(\"#center\");\n    },\n\n    $toggleButton: function() {\n        return this.$(\".unified-panel-footer > .panel-collapse\");\n    },\n\n    render: function() {\n        var self = this;\n        var panel = this.view;\n        var components = this.view.model.attributes || {};\n        this.$el.html(this._templatePanel(this.id));\n        _.each(components.buttons, button => {\n            self.$(\".panel-header-buttons\").append(button.$el);\n        });\n        this.$el.addClass(components.cls);\n        this.$(\".panel-header-text\").html(_.escape(components.title));\n        this.$(\".unified-panel-body\").append(panel.$el);\n        panel.render();\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templatePanel: function() {\n        return [this._templateHeader(), this._templateBody(), this._templateFooter()].join(\"\");\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateHeader: function(data) {\n        return `<div class=\"unified-panel-header\" unselectable=\"on\">\n                    <div class=\"unified-panel-header-inner\">\n                        <div class=\"panel-header-buttons\"/>\n                        <div class=\"panel-header-text\"/>\n                    </div>\n                </div>\n                <div class=\"unified-panel-controls\"/>`;\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateBody: function(data) {\n        return '<div class=\"unified-panel-body\"/>';\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateFooter: function(data) {\n        return [\n            '<div class=\"unified-panel-footer\">',\n            '<div class=\"panel-collapse ',\n            _.escape(this.id),\n            '\"/>',\n            '<div class=\"drag\"/>',\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    events: {\n        \"mousedown .unified-panel-footer > .drag\": \"_mousedownDragHandler\",\n        \"click .unified-panel-footer > .panel-collapse\": \"toggle\"\n    },\n\n    _mousedownDragHandler: function(ev) {\n        var self = this;\n        var draggingLeft = this.id === \"left\";\n        // Save the mouse position and width of the element (panel) when the\n        // drag interaction is first started\n        var initialX = ev.pageX;\n        var initialWidth = self.$el.width();\n\n        function move(e) {\n            var delta = e.pageX - initialX;\n            var newWidth = draggingLeft ? initialWidth + delta : initialWidth - delta;\n            // Limit range\n            newWidth = Math.min(MAX_PANEL_WIDTH, Math.max(MIN_PANEL_WIDTH, newWidth));\n            self.resize(newWidth);\n        }\n\n        // This is a page wide overlay that assists in capturing the move and\n        // release of the mouse. If not provided, progress and end wouldn't fire\n        // if the mouse moved out of the drag button area.\n        $(\"#dd-helper\")\n            .show()\n            .on(\"mousemove\", move)\n            .one(\"mouseup\", function(e) {\n                $(this)\n                    .hide()\n                    .off(\"mousemove\", move);\n            });\n    },\n\n    // TODO: the following three could be simplified I think\n    // if panel is 'right' (this.id), move center right newSize number of pixels\n    resize: function(newSize) {\n        this.$el.css(\"width\", newSize);\n        this.$center().css(this.id, newSize);\n        return this;\n    },\n\n    show: function() {\n        if (!this.hidden) {\n            return;\n        }\n        var self = this;\n        var animation = {};\n        var whichSide = this.id;\n        animation[whichSide] = 0;\n        self.$el\n            .css(whichSide, -this.saved_size)\n            .show()\n            .animate(animation, \"fast\", () => {\n                self.resize(self.saved_size);\n            });\n        self.hidden = false;\n        self.$toggleButton().removeClass(\"hidden\");\n        return this;\n    },\n\n    hide: function() {\n        if (this.hidden) {\n            return;\n        }\n        var animation = {};\n        var whichSide = this.id;\n        this.saved_size = this.$el.width();\n        animation[whichSide] = -this.saved_size;\n        this.$el.animate(animation, \"fast\");\n        this.$center().css(whichSide, 0);\n        this.hidden = true;\n        this.$toggleButton().addClass(\"hidden\");\n        return this;\n    },\n\n    toggle: function(ev) {\n        this.hidden ? this.show() : this.hide();\n        this.hiddenByTool = false;\n        return this;\n    },\n\n    // ..............................................................\n    //TODO: only used in message.mako?\n    /**   */\n    handle_minwidth_hint: function(hint) {\n        var space = this.$center().width() - (this.hidden ? this.saved_size : 0);\n        if (space < hint) {\n            if (!this.hidden) {\n                this.toggle();\n                this.hiddenByTool = true;\n            }\n        } else {\n            if (this.hiddenByTool) {\n                this.toggle();\n                this.hiddenByTool = false;\n            }\n        }\n        return self;\n    },\n\n    /**   */\n    force_panel: function(op) {\n        if (op == \"show\") {\n            return this.show();\n        }\n        if (op == \"hide\") {\n            return this.hide();\n        }\n        return self;\n    },\n\n    toString: function() {\n        return `SidePanel(${this.id})`;\n    }\n});\n\n// ----------------------------------------------------------------------------\n// TODO: side should be defined by page - not here\nvar LeftPanel = SidePanel.extend({\n    id: \"left\"\n});\n\nvar RightPanel = SidePanel.extend({\n    id: \"right\"\n});\n\n/** Center panel with the ability to switch between iframe and view */\nvar CenterPanel = Backbone.View.extend({\n    initialize: function(options) {\n        this.setElement($(this.template()));\n        this.$frame = this.$(\".center-frame\");\n        this.$panel = this.$(\".center-panel\");\n        this.$frame.on(\"load\", this._iframeChangeHandler.bind(this));\n    },\n\n    /** Display iframe if its target url changes, hide center panel */\n    _iframeChangeHandler: function(ev) {\n        var iframe = ev.currentTarget;\n        var location = iframe.contentWindow && iframe.contentWindow.location;\n        var Galaxy = getGalaxyInstance();\n        // Adding try/catch to manage a CORS error in toolshed. Accessing\n        // location.host is a CORS no-no\n        try {\n            if (location && location.host) {\n                $(iframe).show();\n                this.$panel.empty().hide();\n                Galaxy.trigger(\"center-frame:load\", {\n                    fullpath: location.pathname + location.search + location.hash,\n                    pathname: location.pathname,\n                    search: location.search,\n                    hash: location.hash\n                });\n            }\n        } catch (err) {\n            console.warn(\"_iframeChangeHandler error\", ev, location, Galaxy);\n        }\n    },\n\n    /** Display a view in the center panel, hide iframe */\n    display: function(view) {\n        let Galaxy = getGalaxyInstance();\n        let contentWindow = this.$frame[0].contentWindow || {};\n        let message;\n        try {\n            message = contentWindow.onbeforeunload && contentWindow.onbeforeunload();\n        } catch (err) {\n            // This can happen when external content is displayed in this iframe // CORS violation\n            contentWindow = {};\n            console.warn(\n                \"Iframe unload exception.  This can happen when external content is displayed in the page iframe and causes a CORS violation -- likely harmless.\"\n            );\n        }\n        if (!message || confirm(message)) {\n            contentWindow.onbeforeunload = undefined;\n            this.$frame.attr(\"src\", \"about:blank\").hide();\n            this.$panel\n                .empty()\n                .scrollTop(0)\n                .append(view.$el || view)\n                .show();\n            Galaxy.trigger(\"center-panel:load\", view);\n        }\n    },\n\n    template: function() {\n        return (\n            '<div class=\"center-container\">' +\n            '<iframe id=\"galaxy_main\" name=\"galaxy_main\" frameborder=\"0\" class=\"center-frame\" />' +\n            '<div class=\"center-panel\" />' +\n            \"</div>\"\n        );\n    },\n\n    toString: function() {\n        return \"CenterPanel\";\n    }\n});\n\nexport default {\n    SidePanel: SidePanel,\n    LeftPanel: LeftPanel,\n    RightPanel: RightPanel,\n    CenterPanel: CenterPanel\n};\n"],"sourceRoot":""}