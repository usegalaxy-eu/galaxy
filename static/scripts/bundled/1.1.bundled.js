webpackJsonp([1],{16:function(t,e,i){var n,o;(function(l,a,s){n=[i(8),i(48),i(20)],o=function(t,e,i){var n=l.Model.extend({}),o=l.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new n;a.each(a.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var i=e.split("metadata_")[1];t.set(i,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),r=o.extend({defaults:a.extend({},o.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){o.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=s.Deferred();return s.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(i){var n;""!==i.ck_data?(n=i,t.attributes.offset=i.offset):(t.attributes.at_eof=!0,n=null),e.resolve(n)}),e}}),d=l.Collection.extend({model:o}),c=l.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new _({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),s.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=s("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=s("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),i=s("<thead/>").appendTo(t),n=s("<tr/>").appendTo(i);if(e)n.append("<th>"+e.join("</th><th>")+"</th>");else for(var o=1;o<=this.model.get_metadata("columns");o++)n.append("<th>"+o+"</th>");var l=this,a=this.model.get("first_data_chunk");a?this._renderChunk(a):s.when(l.model.get_next_chunk()).then(function(t){l._renderChunk(t)}),this.scroll_elt.scroll(function(){l.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,i){var n=s("<td>").text(t),o=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):o&&e<o.length&&("str"!==o[e]&&"list"!==o[e]||n.addClass("stringalign")),n},_renderRow:function(t){var e=t.split("\t"),i=s("<tr>"),n=this.model.get_metadata("columns");return this.row_count%2!==0&&i.addClass("dark_row"),e.length===n?a.each(e,function(t,e){i.append(this._renderCell(t,e))},this):e.length>n?(a.each(e.slice(0,n-1),function(t,e){i.append(this._renderCell(t,e))},this),i.append(this._renderCell(e.slice(n-1).join("\t"),n-1))):1===e.length?i.append(this._renderCell(t,0,n)):(a.each(e,function(t,e){i.append(this._renderCell(t,e))},this),a.each(a.range(n-e.length),function(){i.append(s("<td>"))})),this.row_count++,i},_renderChunk:function(t){var e=this.$el.find("table");a.each(t.ck_data.split("\n"),function(t,i){""!==t&&e.append(this._renderRow(t))},this)}}),h=c.extend({initialize:function(t){c.prototype.initialize.call(this,t);var e=a.find(this.$el.parents(),function(t){return"auto"===s(t).css("overflow")});e||(e=window),this.scroll_elt=s(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),u=c.extend({initialize:function(t){c.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),_=l.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){function e(t,e){for(var i=0;i<e.length;i++)if(e[i].match(t))return i;return-1}var n=parent.Galaxy;if(n&&n.modal&&(this.modal=n.modal),n&&n.frame&&(this.frame=n.frame),this.modal&&this.frame){var o=t.model,l=o.get("metadata");if(o.get("file_ext")){if(this.file_ext=o.get("file_ext"),"bed"==this.file_ext){if(!(l.get("chromCol")&&l.get("startCol")&&l.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=l.get("chromCol")-1,this.col.start=l.get("startCol")-1,this.col.end=l.get("endCol")-1}if("vcf"==this.file_ext&&(this.col.chrom=e("Chrom",l.get("column_names")),this.col.start=e("Pos",l.get("column_names")),this.col.end=null,this.col.chrom==-1||this.col.start==-1))return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.");if(void 0!==this.col.chrom){if(!o.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=o.id,!o.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=o.get("url_viz"),o.get("genome_build")&&(this.genome_build=o.get("genome_build"));var a=new i.IconButtonView({model:new i.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(a.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}var i=this;if(null!==this.col.chrom){var n=s(t.target).parent(),o=n.children().eq(this.col.chrom).html(),l=n.children().eq(this.col.start).html(),a=this.col.end?n.children().eq(this.col.end).html():l;if(!o.match("^#")&&""!==o&&e(l)){var r={dataset_id:this.dataset_id,gene_region:o+":"+l+"-"+a},d=n.offset(),c=d.left-10,h=d.top-s(window).scrollTop()+3;s("#btn_viz").css({position:"fixed",top:h+"px",left:c+"px"}),s("#btn_viz").off("click"),s("#btn_viz").click(function(){i.frame.add({title:"Trackster",url:i.url_viz+"/trackster?"+s.param(r)})}),s("#btn_viz").show()}else s("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),f=function(t){t.model||(t.model=new r(t.dataset_config));var e=t.parent_elt,i=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var n=i?new u(t):new h(t);return n.render(),e&&(e.append(n.$el),n.expand_to_container()),n};return{Dataset:o,TabularDataset:r,DatasetCollection:d,TabularDatasetChunkedView:c,createTabularDatasetChunkedView:f}}.apply(e,n),!(void 0!==o&&(t.exports=o))}).call(e,i(2),i(3),i(1))},20:function(t,e,i){var n,o;(function(i,l,a){n=[],o=function(){var t=i.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),e=i.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!l.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",a(e)}}),n=i.Collection.extend({model:t}),o=i.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var i=a("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&i.tooltip(e.attributes.tooltip_config);var n=e.get("options");n&&make_popupmenu(i,n)}),this}}),s=function(e,i){i||(i={});var a=new n(l.map(e,function(e){return new t(l.extend(e,i))}));return new o({collection:a})};return{IconButton:t,IconButtonView:e,IconButtonCollection:n,IconButtonMenuView:o,create_icon_buttons_menu:s}}.apply(e,n),!(void 0!==o&&(t.exports=o))}).call(e,i(2),i(3),i(1))}});
//# sourceMappingURL=1.1.bundled.js.map