define(["exports","jquery","backbone","onload/loadConfig","app","libs/toastr","mvc/base-mvc","mvc/library/library-folderlist-view","mvc/library/library-librarylist-view","mvc/library/library-librarytoolbar-view","mvc/library/library-foldertoolbar-view","mvc/library/library-dataset-view","mvc/library/library-library-view","mvc/library/library-folder-view"],function(e,r,i,a,s,l,t,o,d,n,b,w,u,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=k(r),y=k(i),_=k(l),V=k(t),g=k(o),p=k(d),h=k(n),m=k(b),v=k(w),L=k(u),T=k(f);function k(e){return e&&e.__esModule?e:{default:e}}var F=y.default.Router.extend({initialize:function(){this.routesHit=0,y.default.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){1<this.routesHit?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var e=y.default.history.getFragment();/^\//.test(e)||""==e||(e="/".concat(e)),"undefined"!=typeof ga&&ga("send","pageview","".concat((0,a.getAppRoot)(),"library/list").concat(e))}}),$=V.default.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),x=y.default.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){var e,r,i,a,l,t,o=(0,s.getGalaxyInstance)();o.config.ga_code&&(e=window,r=document,i="script",a="ga",e.GoogleAnalyticsObject=a,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,l=r.createElement(i),t=r.getElementsByTagName(i)[0],l.async=1,l.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(l,t),ga("create",o.config.ga_code,"auto"),ga("send","pageview")),(o.libraries=this).preferences=new $({id:"global-lib-prefs"}),this.library_router=new F,this.library_router.on("route:libraries",function(){o.libraries.libraryToolbarView&&o.libraries.libraryToolbarView.$el.unbind("click"),o.libraries.libraryToolbarView=new h.default.LibraryToolbarView,o.libraries.libraryListView=new p.default.LibraryListView}),this.library_router.on("route:libraries_page",function(e){null===o.libraries.libraryToolbarView?(o.libraries.libraryToolbarView=new h.default.LibraryToolbarView,o.libraries.libraryListView=new p.default.LibraryListView({show_page:e})):o.libraries.libraryListView.render({show_page:e})}),this.library_router.on("route:folder_content",function(e){o.libraries.folderToolbarView&&o.libraries.folderToolbarView.$el.unbind("click"),o.libraries.folderToolbarView=new m.default.FolderToolbarView({id:e}),o.libraries.folderListView=new g.default.FolderListView({id:e})}),this.library_router.on("route:folder_page",function(e,r){null===o.libraries.folderToolbarView?(o.libraries.folderToolbarView=new m.default.FolderToolbarView({id:e}),o.libraries.folderListView=new g.default.FolderListView({id:e,show_page:r})):o.libraries.folderListView.render({id:e,show_page:parseInt(r)})}),this.library_router.on("route:download",function(e,r){0===(0,c.default)("#folder_list_body").find(":checked").length?(_.default.info("You must select at least one dataset to download"),o.libraries.library_router.navigate("folders/".concat(e),{trigger:!0,replace:!0})):(o.libraries.folderToolbarView.download(r),o.libraries.library_router.navigate("folders/".concat(e),{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(e,r){o.libraries.datasetView&&o.libraries.datasetView.$el.unbind("click"),o.libraries.datasetView=new v.default.LibraryDatasetView({id:r,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(e,r,i){o.libraries.datasetView&&o.libraries.datasetView.$el.unbind("click"),o.libraries.datasetView=new v.default.LibraryDatasetView({id:r,ldda_id:i,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(e,r){o.libraries.datasetView&&o.libraries.datasetView.$el.unbind("click"),o.libraries.datasetView=new v.default.LibraryDatasetView({id:r,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(e){o.libraries.libraryView&&o.libraries.libraryView.$el.unbind("click"),o.libraries.libraryView=new L.default.LibraryView({id:e,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(e){o.libraries.folderView&&o.libraries.folderView.$el.unbind("click"),o.libraries.folderView=new T.default.FolderView({id:e,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(e,r){o.libraries.folderToolbarView&&o.libraries.folderListView||(o.libraries.folderToolbarView=new m.default.FolderToolbarView({id:e}),o.libraries.folderListView=new g.default.FolderListView({id:e})),o.libraries.folderToolbarView.showImportModal({source:r})}),y.default.history.start({pushState:!1})}});e.default={GalaxyApp:x}});