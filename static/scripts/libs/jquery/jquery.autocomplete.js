!function(c){"use strict";c.fn.autocomplete_verheul=function(t){var e;1<arguments.length?(e=t,(t=arguments[1]).url=e):"string"==typeof t&&(t={url:e=t});var s=c.extend({},c.fn.autocomplete_verheul.defaults,t);return this.each(function(){var t=c(this);t.data("autocompleter",new c.Autocompleter(t,c.meta?c.extend({},s,t.data()):s))})},c.fn.autocomplete_verheul.defaults={inputClass:"acInput",loadingClass:"acLoading",resultsClass:"acResults",selectClass:"acSelect",queryParamName:"q",extraParams:{},remoteDataType:!1,lineSeparator:"\n",cellSeparator:"|",minChars:2,maxItemsToShow:10,delay:400,useCache:!0,maxCacheLength:10,matchSubset:!0,matchCase:!1,matchInside:!0,mustMatch:!1,selectFirst:!1,selectOnly:!1,showResult:null,preventDefaultReturn:1,preventDefaultTab:0,autoFill:!1,filterResults:!0,filter:!0,sortResults:!0,sortFunction:null,onItemSelect:null,onNoMatch:null,onFinish:null,matchStringConverter:null,beforeUseConverter:null,autoWidth:"min-width",useDelimiter:!1,delimiterChar:",",delimiterKeyCode:188,processData:null,onError:null,enabled:!0};var i=function(t,e,s){var o=parseInt(t,10);return s=s||{},(isNaN(o)||s.min&&o<s.min)&&(o=e),o},o=function(t,e){var s=[];return c.each(e,function(t,e){s.push([t,encodeURIComponent(e)].join("="))}),s.length&&(t+=-1===t.indexOf("?")?"?":"&",t+=s.join("&")),t};c.Autocompleter=function(t,e){if(!t||!(t instanceof c)||1!==t.length||"INPUT"!==t.get(0).tagName.toUpperCase()&&"TEXTAREA"!==t.get(0).tagName.toUpperCase())throw new Error("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT or TEXTAREA tag expected.");var s=this;this.options=e,this.cacheData_={},this.cacheLength_=0,this.selectClass_="jquery-autocomplete-selected-item",this.keyTimeout_=null,this.finishTimeout_=null,this.lastKeyPressed_=null,this.lastProcessedValue_=null,this.lastSelectedValue_=null,this.active_=!1,this.finishOnBlur_=!0,this.options.minChars=i(this.options.minChars,c.fn.autocomplete_verheul.defaults.minChars,{min:0}),this.options.maxItemsToShow=i(this.options.maxItemsToShow,c.fn.autocomplete_verheul.defaults.maxItemsToShow,{min:0}),this.options.maxCacheLength=i(this.options.maxCacheLength,c.fn.autocomplete_verheul.defaults.maxCacheLength,{min:1}),this.options.delay=i(this.options.delay,c.fn.autocomplete_verheul.defaults.delay,{min:0}),2!=this.options.preventDefaultReturn&&(this.options.preventDefaultReturn=this.options.preventDefaultReturn?1:0),2!=this.options.preventDefaultTab&&(this.options.preventDefaultTab=this.options.preventDefaultTab?1:0),this.dom={},this.dom.$elem=t,this.dom.$elem.attr("autocomplete","off").addClass(this.options.inputClass),this.dom.$results=c("<div></div>").hide().addClass(this.options.resultsClass).css({position:"absolute"}),c("body").append(this.dom.$results),t.keydown(function(t){switch(s.lastKeyPressed_=t.keyCode,s.lastKeyPressed_){case s.options.delimiterKeyCode:s.options.useDelimiter&&s.active_&&s.selectCurrent();break;case 35:case 36:case 16:case 17:case 18:case 37:case 39:break;case 38:return t.preventDefault(),s.active_?s.focusPrev():s.activate(),!1;case 40:return t.preventDefault(),s.active_?s.focusNext():s.activate(),!1;case 9:if(s.active_&&(s.selectCurrent(),s.options.preventDefaultTab))return t.preventDefault(),!1;if(2===s.options.preventDefaultTab)return t.preventDefault(),!1;break;case 13:if(s.active_&&(s.selectCurrent(),s.options.preventDefaultReturn))return t.preventDefault(),!1;if(2===s.options.preventDefaultReturn)return t.preventDefault(),!1;break;case 27:if(s.active_)return t.preventDefault(),s.deactivate(!0),!1;break;default:s.activate()}}),t.on("paste",function(){s.activate()});var o=function(){s.deactivate(!0)};t.blur(function(){s.finishOnBlur_&&(s.finishTimeout_=setTimeout(o,200))}),t.parents("form").on("submit",o)},c.Autocompleter.prototype.position=function(){var t=this.dom.$elem.offset(),e=this.dom.$results.outerHeight(),s=c(window).outerHeight(),o=t.top+this.dom.$elem.outerHeight(),i=o+e,a={top:o,left:t.left};if(s<i){var r=t.top-e;0<=r&&(a.top=r)}this.dom.$results.css(a)},c.Autocompleter.prototype.cacheRead=function(t){var e,s,o,i,a;if(this.options.useCache)for(e=(t=String(t)).length,s=this.options.matchSubset?1:e;s<=e;){for(i=this.options.matchInside?e-s:0,a=0;a<=i;){if(o=t.substr(0,s),void 0!==this.cacheData_[o])return this.cacheData_[o];a++}s++}return!1},c.Autocompleter.prototype.cacheWrite=function(t,e){return!!this.options.useCache&&(this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush(),t=String(t),void 0!==this.cacheData_[t]&&this.cacheLength_++,this.cacheData_[t]=e,this.cacheData_[t])},c.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={},this.cacheLength_=0},c.Autocompleter.prototype.callHook=function(t,e){var s=this.options[t];return!(!s||!c.isFunction(s))&&s(e,this)},c.Autocompleter.prototype.activate=function(){if(this.options.enabled){var t=this;this.keyTimeout_&&clearTimeout(this.keyTimeout_),this.keyTimeout_=setTimeout(function(){t.activateNow()},this.options.delay)}},c.Autocompleter.prototype.activateNow=function(){var t=this.beforeUseConverter(this.dom.$elem.val());t!==this.lastProcessedValue_&&t!==this.lastSelectedValue_&&this.fetchData(t)},c.Autocompleter.prototype.fetchData=function(e){var s=this,o=function(t,e){s.options.processData&&(t=s.options.processData(t)),s.showResults(s.filterResults(t,e),e)};(this.lastProcessedValue_=e).length<this.options.minChars?o([],e):this.options.data?o(this.options.data,e):this.fetchRemoteData(e,function(t){o(t,e)})},c.Autocompleter.prototype.fetchRemoteData=function(s,o){var t=this.cacheRead(s);if(t)o(t);else{var i=this,e="json"===i.options.remoteDataType?"json":"text",a=function(t){var e=!1;!1!==t&&(e=i.parseRemoteData(t),i.cacheWrite(s,e)),i.dom.$elem.removeClass(i.options.loadingClass),o(e)};this.dom.$elem.addClass(this.options.loadingClass),c.ajax({url:this.makeUrl(s),success:a,error:function(t,e,s){c.isFunction(i.options.onError)?i.options.onError(t,e,s):a(!1)},dataType:e})}},c.Autocompleter.prototype.setExtraParam=function(t,e){var s=c.trim(String(t));return s&&(this.options.extraParams||(this.options.extraParams={}),this.options.extraParams[s]!==e&&(this.options.extraParams[s]=e,this.cacheFlush())),this},c.Autocompleter.prototype.makeUrl=function(t){var e=this.options.url,s=c.extend({},this.options.extraParams);return!1===this.options.queryParamName?e+=encodeURIComponent(t):s[this.options.queryParamName]=t,o(e,s)},c.Autocompleter.prototype.parseRemoteData=function(t){var e,s=t;if("json"!==this.options.remoteDataType)return function(t,e,s){var o,i,a,r,n,l,u=[];for(l=String(t).replace("\r\n","\n").split(e),o=0;o<l.length;o++){for(r=l[o].split(s),a=[],i=0;i<r.length;i++)a.push(decodeURIComponent(r[i]));n=a.shift(),u.push({value:n,data:a})}return u}(s,this.options.lineSeparator,this.options.cellSeparator);switch(e=typeof t){case"object":s=t;break;case"string":s=c.parseJSON(t);break;default:throw new Error("Unexpected remote data type: "+e)}return s},c.Autocompleter.prototype.defaultFilter=function(t,e){if(!t.value)return!1;if(this.options.filterResults){var s=this.matchStringConverter(e),o=this.matchStringConverter(t.value);this.options.matchCase||(s=s.toLowerCase(),o=o.toLowerCase());var i=o.indexOf(s);return this.options.matchInside?-1<i:0===i}return!0},c.Autocompleter.prototype.filterResult=function(t,e){return!1===this.options.filter||(c.isFunction(this.options.filter)?this.options.filter(t,e):this.defaultFilter(t,e))},c.Autocompleter.prototype.filterResults=function(t,e){var s,o,i,a,r,n,l=[];for(s=0;s<t.length;s++)i=t[s],r=a=void 0,"string"===(n=typeof i)?(a=i,r={}):c.isArray(i)?(a=i[0],r=i.slice(1)):"object"===n&&(a=i.value,r=i.data),"object"!=typeof r&&(r={}),o={value:a=String(a),data:r},this.filterResult(o,e)&&l.push(o);return this.options.sortResults&&(l=this.sortResults(l,e)),0<this.options.maxItemsToShow&&this.options.maxItemsToShow<l.length&&(l.length=this.options.maxItemsToShow),l},c.Autocompleter.prototype.sortResults=function(t,s){var r=this,o=this.options.sortFunction;return c.isFunction(o)||(o=function(t,e,s){return o=t,i=e,a=r.options.matchCase,o=String(o.value),i=String(i.value),a||(o=o.toLowerCase(),i=i.toLowerCase()),i<o?1:o<i?-1:0;var o,i,a}),t.sort(function(t,e){return o(t,e,s,r.options)}),t},c.Autocompleter.prototype.matchStringConverter=function(t,e,s){var o=this.options.matchStringConverter;return c.isFunction(o)&&(t=o(t,e,s)),t},c.Autocompleter.prototype.beforeUseConverter=function(t){t=this.getValue(t);var e=this.options.beforeUseConverter;return c.isFunction(e)&&(t=e(t)),t},c.Autocompleter.prototype.enableFinishOnBlur=function(){this.finishOnBlur_=!0},c.Autocompleter.prototype.disableFinishOnBlur=function(){this.finishOnBlur_=!1},c.Autocompleter.prototype.createItemFromResult=function(t){var e=this,s=c("<li/>");return s.html(this.showResult(t.value,t.data)),s.data({value:t.value,data:t.data}).click(function(){e.selectItem(s)}).mousedown(e.disableFinishOnBlur).mouseup(e.enableFinishOnBlur),s},c.Autocompleter.prototype.getItems=function(){return c(">ul>li",this.dom.$results)},c.Autocompleter.prototype.showResults=function(t,e){var s,o,i,a,r=t.length,n=this,l=c("<ul></ul>"),u=!1,h=!1;if(r){for(s=0;s<r;s++)o=t[s],i=this.createItemFromResult(o),l.append(i),!1===u&&(u=String(o.value),(h=i).addClass(this.options.firstItemClass)),s===r-1&&i.addClass(this.options.lastItemClass);this.dom.$results.html(l).show(),this.position(),this.options.autoWidth&&(a=this.dom.$elem.outerWidth()-this.dom.$results.outerWidth()+this.dom.$results.width(),this.dom.$results.css(this.options.autoWidth,a)),this.getItems().hover(function(){n.focusItem(this)},function(){}),(this.autoFill(u,e)||this.options.selectFirst||this.options.selectOnly&&1===r)&&this.focusItem(h),this.active_=!0}else this.hideResults(),this.active_=!1},c.Autocompleter.prototype.showResult=function(t,e){return c.isFunction(this.options.showResult)?this.options.showResult(t,e):c("<p></p>").text(t).html()},c.Autocompleter.prototype.autoFill=function(t,e){var s,o,i,a;if(this.options.autoFill&&8!==this.lastKeyPressed_&&(s=String(t).toLowerCase(),o=String(e).toLowerCase(),i=t.length,a=e.length,s.substr(0,a)===o)){var r=this.getDelimiterOffsets(),n=r.start?" ":"";this.setValue(n+t);var l=a+r.start+n.length,u=i+r.start+n.length;return this.selectRange(l,u),!0}return!1},c.Autocompleter.prototype.focusNext=function(){this.focusMove(1)},c.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)},c.Autocompleter.prototype.focusMove=function(t){var e=this.getItems();if(t=i(t,0))for(var s=0;s<e.length;s++)if(c(e[s]).hasClass(this.selectClass_))return void this.focusItem(s+t);this.focusItem(0)},c.Autocompleter.prototype.focusItem=function(t){var e,s=this.getItems();s.length&&(s.removeClass(this.selectClass_).removeClass(this.options.selectClass),(e="number"==typeof t?(t<0?t=0:t>=s.length&&(t=s.length-1),c(s[t])):c(t))&&e.addClass(this.selectClass_).addClass(this.options.selectClass))},c.Autocompleter.prototype.selectCurrent=function(){var t=c("li."+this.selectClass_,this.dom.$results);1===t.length?this.selectItem(t):this.deactivate(!1)},c.Autocompleter.prototype.selectItem=function(t){var e=t.data("value"),s=t.data("data"),o=this.displayValue(e,s),i=this.beforeUseConverter(o);this.lastProcessedValue_=i,this.lastSelectedValue_=i;var a=this.getDelimiterOffsets(),r=this.options.delimiterChar,n=this.dom.$elem,l=0;this.options.useDelimiter&&(n.val().substring(a.start-1,a.start)==r&&" "!=r&&(o=" "+o),n.val().substring(a.end,a.end+1)!=r&&this.lastKeyPressed_!=this.options.delimiterKeyCode?o+=r:l=1),this.setValue(o),this.setCaret(a.start+o.length+l),this.callHook("onItemSelect",{value:e,data:s}),this.deactivate(!0),n.focus()},c.Autocompleter.prototype.displayValue=function(t,e){return c.isFunction(this.options.displayValue)?this.options.displayValue(t,e):t},c.Autocompleter.prototype.hideResults=function(){this.dom.$results.hide()},c.Autocompleter.prototype.deactivate=function(t){this.finishTimeout_&&clearTimeout(this.finishTimeout_),this.keyTimeout_&&clearTimeout(this.keyTimeout_),t&&(this.lastProcessedValue_!==this.lastSelectedValue_&&(this.options.mustMatch&&this.setValue(""),this.callHook("onNoMatch")),this.active_&&this.callHook("onFinish"),this.lastKeyPressed_=null,this.lastProcessedValue_=null,this.lastSelectedValue_=null,this.active_=!1),this.hideResults()},c.Autocompleter.prototype.selectRange=function(t,e){var s=this.dom.$elem.get(0);if(s.setSelectionRange)s.focus(),s.setSelectionRange(t,e);else if(s.createTextRange){var o=s.createTextRange();o.collapse(!0),o.moveEnd("character",e),o.moveStart("character",t),o.select()}},c.Autocompleter.prototype.setCaret=function(t){this.selectRange(t,t)},c.Autocompleter.prototype.getCaret=function(){var t,e,s,o,i,a,r=this.dom.$elem,n=r[0];return i=n.createTextRange?(e=document.selection,"textarea"!=n.tagName.toLowerCase()?(t=r.val(),(s=e.createRange().duplicate()).moveEnd("character",t.length),o=""===s.text?t.length:t.lastIndexOf(s.text),(s=e.createRange().duplicate()).moveStart("character",-t.length),s.text.length):((a=(s=e.createRange()).duplicate()).moveToElementText(n),a.setEndPoint("EndToEnd",s),(o=a.text.length-s.text.length)+s.text.length)):(o=r[0].selectionStart,r[0].selectionEnd),{start:o,end:i}},c.Autocompleter.prototype.setValue=function(t){if(this.options.useDelimiter){var e=this.dom.$elem.val(),s=this.getDelimiterOffsets();t=e.substring(0,s.start)+t+e.substring(s.end)}this.dom.$elem.val(t)},c.Autocompleter.prototype.getValue=function(t){if(this.options.useDelimiter){var e=this.getDelimiterOffsets();return t.substring(e.start,e.end).trim()}return t},c.Autocompleter.prototype.getDelimiterOffsets=function(){var t=this.dom.$elem.val();if(this.options.useDelimiter){var e=t.substring(0,this.getCaret().start).lastIndexOf(this.options.delimiterChar)+1,s=t.substring(this.getCaret().start).indexOf(this.options.delimiterChar);-1==s&&(s=t.length),s+=this.getCaret().start}else e=0,s=t.length;return{start:e,end:s}}}(jQuery);