define(["exports","underscore","jquery","onload/loadConfig","app","utils/localization","mvc/ui/popup-menu","mvc/history/copy-dialog","mvc/webhooks"],function(t,e,a,i,r,n,o,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=m(e),d=m(a),c=m(n),f=m(o),h=m(l),y=m(u);function m(t){return t&&t.__esModule?t:{default:t}}var p=[{html:(0,c.default)("History Lists"),header:!0},{html:(0,c.default)("Saved Histories"),href:"histories/list",target:"_top"},{html:(0,c.default)("Histories Shared with Me"),href:"histories/list_shared",target:"_top"},{html:(0,c.default)("Current History"),header:!0,anon:!0},{html:(0,c.default)("Create New"),func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.currHistoryPanel.createNewHistory()}},{html:(0,c.default)("Copy History"),func:function(){var t=(0,r.getGalaxyInstance)();(0,h.default)(t.currHistoryPanel.model).done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Share or Publish"),func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/sharing?id=".concat(t.currHistoryPanel.model.id))}},{html:(0,c.default)("Show Structure"),anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/show_structure")}},{html:(0,c.default)("Extract Workflow"),href:"workflow/build_from_current_history"},{html:(0,c.default)("Delete"),anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&confirm((0,c.default)("Really delete the current history?"))&&t.currHistoryPanel.model._delete().done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Delete Permanently"),purge:!0,anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&confirm((0,c.default)("Really delete the current history permanently? This cannot be undone."))&&t.currHistoryPanel.model.purge().done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Make Data Private"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,c.default)("This will make all the data in this history private (excluding library datasets), and will set permissions such that all new data is created as private.  Any datasets within that are currently shared will need to be re-shared or published.  Are you sure you want to do this?"))&&d.default.post("".concat(Galaxy.root,"history/make_private"),{history_id:Galaxy.currHistoryPanel.model.id},function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Dataset Actions"),header:!0,anon:!0},{html:(0,c.default)("Copy Datasets"),href:"dataset/copy_datasets"},{html:(0,c.default)("Dataset Security"),func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/permissions?id=".concat(t.currHistoryPanel.model.id))}},{html:(0,c.default)("Resume Paused Jobs"),href:"history/resume_paused_jobs?current=True",anon:!0},{html:(0,c.default)("Collapse Expanded Datasets"),func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.currHistoryPanel.collapseAll()}},{html:(0,c.default)("Unhide Hidden Datasets"),anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&confirm((0,c.default)("Really unhide all hidden datasets?"))&&d.default.post("".concat((0,i.getAppRoot)(),"history/adjust_hidden"),{user_action:"unhide"},function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Delete Hidden Datasets"),anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&confirm((0,c.default)("Really delete all hidden datasets?"))&&d.default.post("".concat((0,i.getAppRoot)(),"history/adjust_hidden"),{user_action:"delete"},function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:(0,c.default)("Purge Deleted Datasets"),confirm:(0,c.default)("Really delete all deleted datasets permanently? This cannot be undone."),href:"history/purge_deleted_datasets",purge:!0,anon:!0},{html:(0,c.default)("Downloads"),header:!0},{html:(0,c.default)("Export Tool Citations"),anon:!0,func:function(){var t=(0,r.getGalaxyInstance)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/citations?id=".concat(t.currHistoryPanel.model.id))}},{html:(0,c.default)("Export History to File"),href:"history/export_archive?preview=True",anon:!0},{html:(0,c.default)("Other Actions"),header:!0},{html:(0,c.default)("Import from File"),href:"histories/import",target:"_top"}];y.default.load({type:"history-menu",async:!1,callback:function(t){var a=[];t.each(function(t){var e=t.toJSON();e.activate&&a.push({html:(0,c.default)(e.config.title),anon:!0})}),0<a.length&&(a.unshift({html:(0,c.default)("Webhooks"),header:!0}),d.default.merge(p,a))}});t.default=function(t,e){var a,r,n,o=void 0===(e=e||{}).anonymous||e.anonymous,l=e.purgeAllowed||!1,u=(a=o,r=l,n=(0,i.getAppRoot)(),s.default.clone(p).filter(function(t){return!(a&&!t.anon||!r&&t.purge||(t.href&&(t.href=n+t.href,t.target=t.target||"galaxy_main"),t.confirm&&(t.func=function(){confirm(t.confirm)&&(galaxy_main.location=t.href)}),0))}));return new f.default(t,u)}});