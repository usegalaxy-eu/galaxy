define(["exports","app","mvc/ui/ui-modal","mvc/ui/error-modal","utils/localization"],function(e,p,a,t,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(a),f=n(t),y=n(l);function n(e){return e&&e.__esModule?e:{default:e}}var i={defaultName:_.template("Copy of '<%- name %>'"),title:_.template("".concat((0,y.default)("Copying history"),' "<%- name %>"')),submitLabel:(0,y.default)("Copy"),errorMessage:(0,y.default)("History could not be copied."),progressive:(0,y.default)("Copying history"),activeLabel:(0,y.default)("Copy only the active, non-deleted datasets"),allLabel:(0,y.default)("Copy all datasets including deleted ones"),anonWarning:(0,y.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,y.default)("after copying this history. "),_template:_.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,y.default)("You can"),' <a href="/user/login">',(0,y.default)("login here"),"</a> ",(0,y.default)("or")," ",' <a href="/user/create">',(0,y.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,y.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,y.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,y.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '.concat(this.progressive,"...</p>");this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(e,i,a){a=a||{};var r=this,s=jQuery.Deferred(),t=(a.nameFn||this.defaultName)({name:i.get("name")}),l=a.allDatasets?"copy-all":"copy-non-deleted",o=!!_.isUndefined(a.allowAll)||a.allowAll,d=!!_.isUndefined(a.autoClose)||a.autoClose;function n(){var o=e.$("#copy-modal-title").val();if(o){var n="copy-all"===e.$('input[name="copy-what"]:checked').val();e.$("button").prop("disabled",!0),r._showAjaxIndicator(),i.copy(!0,o,n).done(function(e){s.resolve(e)}).fail(function(e,a,t){var l={name:o,copyAllDatasets:n};f.default.ajaxErrorModal(i,e,l,r.errorMessage),s.rejectWith(s,arguments)}).done(function(){d&&e.hide()})}else e.$(".invalid-title").show()}this.modal=e;var c=a.closing_callback,u=(0,p.getGalaxyInstance)();return e.show(_.extend(a,{title:this.title({name:i.get("name")}),body:$(r._template({name:t,isAnon:u.user.isAnonymous(),allowAll:o,copyWhat:l,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:_.object([[(0,y.default)("Cancel"),function(){e.hide()}],[this.submitLabel,n]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&s.reject({cancelled:!0}),c&&c(e)}})),e.$("#copy-modal-title").focus().select(),e.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),n())}),s}},r=_.extend({},i,{defaultName:_.template("imported: <%- name %>"),title:_.template("".concat((0,y.default)("Importing history"),' "<%- name %>"')),submitLabel:(0,y.default)("Import"),errorMessage:(0,y.default)("History could not be imported."),progressive:(0,y.default)("Importing history"),activeLabel:(0,y.default)("Import only the active, non-deleted datasets"),allLabel:(0,y.default)("Import all datasets including deleted ones"),anonWarning:(0,y.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,y.default)("after importing this history. ")});e.default=function(e,a){a=a||{};var t=(0,p.getGalaxyInstance)().modal||new o.default.View({});return a.useImport?r.dialog(t,e,a):i.dialog(t,e,a)}});