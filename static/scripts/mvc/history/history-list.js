define(["exports","jquery","backbone","onload/loadConfig","app","utils/localization","utils/ajax-queue","utils/utils","mvc/grid/grid-view","mvc/history/history-model","mvc/history/copy-dialog","ui/loading-indicator"],function(t,e,a,i,n,o,d,s,l,c,r,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=b(e),h=b(a),v=b(o),p=b(d),y=b(s),_=b(l),m=b(r),g=b(u);function b(t){return t&&t.__esModule?t:{default:t}}var w=_.default.extend({initialize:function(t){this.ajaxQueue=new p.default.AjaxQueue,_.default.prototype.initialize.call(this,t)},init_grid_elements:function(){var e=this.ajaxQueue;e.stop(),_.default.prototype.init_grid_elements.call(this),f.default.makeArray(this.$el.find(".delayed-value-datasets_by_state").map(function(t,a){return function(){var r=(0,f.default)(a).data("id"),t="".concat((0,i.getAppRoot)(),"api/histories/").concat(r,"?keys=nice_size,contents_active,contents_states"),e={};return e.url=t,e.type="GET",e.success=function(t){for(var e=t.contents_states,a="",i=["ok","running","queued","new","error"],n=0;n<i.length;n++){var o=i[n],d=e[o];d&&(a+='<div class="count-box state-color-'.concat(o,'" title="Datasets in ').concat(o,' state">').concat(d,"</div> "))}var s=t.contents_active,l=s.deleted;l&&(a+='<div class="count-box state-color-deleted" title="Deleted datasets">'.concat(l,"</div> "));var c=s.hidden;c&&(a+='<div class="count-box state-color-hidden" title="Hidden datasets">'.concat(c,"</div> ")),(0,f.default)(".delayed-value-datasets_by_state[data-id='".concat(r,"']")).html(a),(0,f.default)(".delayed-value-disk_size[data-id='".concat(r,"']")).html(t.nice_size)},f.default.ajax(e)}})).forEach(function(t){return e.add(t)}),e.start()},_showCopyDialog:function(t){var e=new c.History({id:t});e.fetch().fail(function(){alert("History could not be fetched. Please contact an administrator")}).done(function(){(0,m.default)(e,{}).done(function(){var t=(0,n.getGalaxyInstance)();t&&t.currHistoryPanel&&t.currHistoryPanel.loadCurrentHistory(),window.location.reload(!0)})})},add_operation:function(t,e,a){var i=this;"Copy"==e.label&&(e.onclick=function(t){i._showCopyDialog(t)}),_.default.prototype.add_operation.call(this,t,e,a)}}),x=h.default.View.extend({title:(0,v.default)("Histories"),initialize:function(t){var e=this,a=(0,n.getGalaxyInstance)();g.default.markViewAsLoading(this),"list_published"==t.action_id?this.active_tab="shared":"list"==t.action_id&&(this.active_tab="user"),this.model=new h.default.Model,y.default.get({url:"".concat((0,i.getAppRoot)(),"history/").concat(t.action_id,"?").concat(f.default.param(a.params)),success:function(t){e.model.set(t),e.render()}})},render:function(){var t=new w(this.model.attributes);this.$el.empty().append(t.$el)}});t.default={View:x}});