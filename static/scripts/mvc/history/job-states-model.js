define(["exports","backbone","onload/loadConfig","utils/ajax-queue"],function(t,e,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(e);r(n);function r(t){return t&&t.__esModule?t:{default:t}}var u=["new","queued","running"],a=["error","deleted"],s=o.default.Model.extend({url:function(){return"".concat((0,i.getAppRoot)(),"api/histories/").concat(this.attributes.history_id,"/contents/dataset_collections/").concat(this.attributes.collection_id,"/jobs_summary")},hasDetails:function(){return this.has("populated_state")},new:function(){return!this.hasDetails()||"new"==this.get("populated_state")},errored:function(){return"error"===this.get("populated_state")||this.anyWithStates(a)},states:function(){return this.get("states")||{}},anyWithState:function(t){return 0<(this.states()[t]||0)},anyWithStates:function(t){var e=this.states();for(var n in t)if(0<(e[t[n]]||0))return!0;return!1},numWithStates:function(t){var e=this.states(),n=0;for(var i in t)n+=e[t[i]]||0;return n},numInError:function(){return this.numWithStates(a)},running:function(){return this.anyWithState("running")},terminal:function(){return!this.new()&&!this.anyWithStates(u)},jobCount:function(){var t=this.states(),e=0;for(var n in t)e+=t[n];return e},toString:function(){return"JobStatesSummary(id=".concat(this.get("id"),")")}}),c=o.default.Collection.extend({model:s,initialize:function(){var e=this;this.on({add:function(t){e.active||t.fetch()}}),this.updateTimeoutId=null,this.active=!0},url:function(){var t=this.models.filter(function(t){return!t.terminal()}),e=t.map(function(t){return t.get("id")}).join(","),n=t.map(function(t){return t.get("model")}).join(",");return"".concat((0,i.getAppRoot)(),"api/histories/").concat(this.historyId,"/jobs_summary?ids=").concat(e,"&types=").concat(n)},monitor:function(){var t=this;if(this.clearUpdateTimeout(),this.active){var e=function(){t.updateTimeoutId=setTimeout(function(){t.monitor()},2e3)},n=this.models.filter(function(t){return!t.terminal()});n.length,0<n.length?this.fetch({remove:!1}).done(e):e()}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},toString:function(){return"JobStatesSummaryCollection()"}});t.default={JobStatesSummary:s,JobStatesSummaryCollection:c,FETCH_STATE_ON_ADD:!1,NON_TERMINAL_STATES:u,ERROR_STATES:a}});