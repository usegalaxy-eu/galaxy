define(["exports","underscore","jquery","backbone","onload/loadConfig","app","utils/localization","mvc/ui/ui-tabs","mvc/ui/ui-misc","mvc/form/form-view"],function(t,e,a,i,s,n,o,d,r,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=g(e),c=g(a),f=g(i),p=g(o),m=g(d),h=g(r),_=g(u);function g(t){return t&&t.__esModule?t:{default:t}}var b=f.default.View.extend({initialize:function(){var t=(0,n.getGalaxyInstance)();this.setElement("<div/>"),this.model=new f.default.Model({dataset_id:t.params.dataset_id}),this.message=new h.default.Message({persistent:!0}),this.tabs=this._createTabs(),this.active_tab="user",this.$el.append((0,c.default)("<h4/>").append("Edit dataset attributes")).append(this.message.$el).append("<p/>").append(this.tabs.$el).hide(),this.render()},render:function(){var i=this;c.default.ajax({url:"".concat((0,s.getAppRoot)(),"dataset/get_edit?dataset_id=").concat(i.model.get("dataset_id")),success:function(a){!i.initial_message&&i.message.update(a),i.initial_message=!0,l.default.each(i.forms,function(t,e){t.model.set("inputs",a["".concat(e,"_inputs")]),t.model.set("hide_operations",a["".concat(e,"_disable")]),t.render()}),i.$el.show()},error:function(t){var e=t.responseJSON&&t.responseJSON.err_msg;i.message.update({status:"danger",message:e||"Error occured while loading the dataset."})}})},_submit:function(t,e){var a=this,i=e.data.create();i.dataset_id=this.model.get("dataset_id"),i.operation=t,c.default.ajax({type:"PUT",url:"".concat((0,s.getAppRoot)(),"dataset/set_edit"),data:i,success:function(t){a.message.update(t),a.render(),a._reloadHistory()},error:function(t){var e=t.responseJSON&&t.responseJSON.err_msg;a.message.update({status:"danger",message:e||"Error occured while editing the dataset attributes."})}})},_createTabs:function(){this.forms={attribute:this._getAttribute(),conversion:this._getConversion(),datatype:this._getDatatype(),permission:this._getPermission()};var t=new m.default.View;return t.add({id:"attribute",title:(0,p.default)("Attributes"),icon:"fa fa-bars",tooltip:(0,p.default)("Edit dataset attributes"),$el:this.forms.attribute.$el}),t.add({id:"convert",title:(0,p.default)("Convert"),icon:"fa-gear",tooltip:(0,p.default)("Convert to new format"),$el:this.forms.conversion.$el}),t.add({id:"datatype",title:(0,p.default)("Datatypes"),icon:"fa-database",tooltip:(0,p.default)("Change data type"),$el:this.forms.datatype.$el}),t.add({id:"permissions",title:(0,p.default)("Permissions"),icon:"fa-user",tooltip:(0,p.default)("Permissions"),$el:this.forms.permission.$el}),t},_getAttribute:function(){var t=this,e=new _.default({title:(0,p.default)("Edit attributes"),operations:{submit_attributes:new h.default.Button({tooltip:(0,p.default)("Save attributes of the dataset."),icon:"fa-floppy-o",title:(0,p.default)("Save"),onclick:function(){t._submit("attributes",e)}}),submit_autodetect:new h.default.Button({tooltip:"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.",icon:"fa-undo",title:"Auto-detect",onclick:function(){t._submit("autodetect",e)}})}});return e},_getConversion:function(){var t=this,e=new _.default({title:(0,p.default)("Convert to new format"),operations:{submit_conversion:new h.default.Button({tooltip:(0,p.default)("Convert the datatype to a new format."),title:(0,p.default)("Convert datatype"),icon:"fa-exchange",onclick:function(){t._submit("conversion",e)}})}});return e},_getDatatype:function(){var t=this,e=new _.default({title:(0,p.default)("Change datatype"),operations:{submit_datatype:new h.default.Button({tooltip:(0,p.default)("Change the datatype to a new type."),title:(0,p.default)("Change datatype"),icon:"fa-exchange",onclick:function(){t._submit("datatype",e)}}),submit_datatype_detect:new h.default.Button({tooltip:(0,p.default)("Detect the datatype and change it."),title:(0,p.default)("Detect datatype"),icon:"fa-undo",onclick:function(){t._submit("datatype_detect",e)}})}});return e},_getPermission:function(){var t=this,e=new _.default({title:(0,p.default)("Manage dataset permissions"),operations:{submit_permission:new h.default.Button({tooltip:(0,p.default)("Save permissions."),title:(0,p.default)("Save permissions"),icon:"fa-floppy-o ",onclick:function(){t._submit("permission",e)}})}});return e},_reloadHistory:function(){var t=(0,n.getGalaxyInstance)();t&&t.currHistoryPanel.loadCurrentHistory()}});t.default={View:b}});