define(["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Backbone.View.extend({initialize:function(t,n){this.$button=t,this.$button.length||(this.$button=$("<div/>")),this.options=n||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(t){return $(".popmenu-wrapper").remove(),i._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var e=this;this.$el.find("li").each(function(t,n){var i=e.options[t];i.func&&$(this).children("a.popupmenu-option").click(function(t){i.func.call(e,t,i),t.preventDefault()})})}return this},template:function(t,n){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(n),"</ul>"].join("")},_templateOptions:function(t){return t.length?_.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'.concat(t.target,'"'):"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var n=this.$el.width(),i=t.pageX-n/2;return i=Math.min(i,$(document).scrollLeft()+$(window).width()-n-5),i=Math.max(i,$(document).scrollLeft()+5),{top:t.pageY,left:i}},_setUpCloseBehavior:function(){var n=this;function t(t){if($(document).off("click.close_popup"),window&&window.parent!==window)try{$(window.parent.document).off("click.close_popup")}catch(t){}else try{$("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){}n.remove()}if($("html").one("click.close_popup",t),window&&window.parent!==window)try{$(window.parent.document).find("html").one("click.close_popup",t)}catch(t){}else try{$("iframe#galaxy_main").contents().one("click.close_popup",t)}catch(t){}},addItem:function(t,n){return n=0<=n?n:this.options.length,this.options.splice(n,0,t),this},removeItem:function(t){return 0<=t&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var n=0;n<this.options.length;n++)if(_.has(this.options[n],"html")&&this.options[n].html===t)return n;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});r.create=function(t,n){return new r(t,n)},r.make_popupmenu=function(t,n){var e=[];return _.each(n,function(t,n){var i={html:n};null===t?i.header=!0:"function"===jQuery.type(t)&&(i.func=t),e.push(i)}),new r($(t),e)},r.convertLinksToOptions=function(t,n){t=$(t),n=n||"a";var c=[];return t.find(n).each(function(t,n){var i={},e=$(t);if(i.html=e.text(),e.attr("href")){var o=e.attr("href"),r=e.attr("target"),a=e.attr("confirm");i.func=function(){if(!a||confirm(a))switch(r){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}c.push(i)}),c},r.fromExistingDom=function(t,n,i){t=$(t),n=$(n);var e=r.convertLinksToOptions(n,i);return n.remove(),new r(t,e)},r.make_popup_menus=function(i,t,e){i=i||document,t=t||"div[popupmenu]",e=e||function(t,n){return"#".concat(t.attr("popupmenu"))};var o=[];return $(i).find(t).each(function(){var t=$(this),n=$(i).find(e(t,i));o.push(r.fromDom(n,t)),n.addClass("popup")}),o},t.default=r});