define(["exports","backbone","underscore","utils/utils"],function(t,e,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=h(e),o=h(i),l=(n=s)&&n.__esModule?n:{default:n};function h(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};s.get||s.set?Object.defineProperty(e,i,s):e[i]=t[i]}return e.default=t,e}var c=a.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,maximumTextLength:100,initialData:""},initialize:function(t){if(this.options=l.default.merge(t,this.optionsDefault),this.setElement(this._template(this.options)),this.options.container){if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var e=this;this.options.onchange&&this.$el.on("change",function(){e.options.onchange(e.value())})}}else console.log("ui-select::initialize() : container not specified.")},value:function(t){var e=this._getValue();void 0!==t&&this._setValue(t);var i=this._getValue();return i!=e&&this.options.onchange&&this.options.onchange(i),i},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(t){this.select_data.push({id:t.id,text:t.text}),this._refresh()},del:function(t){var e=this._getIndex(t);-1!=e&&(this.select_data.splice(e,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(t){for(var e in this.select_data=[],t.data)this.select_data.push(t.data[e]);this._refresh()},_refresh:function(){var t,n=this;if(this.options.multiple)t={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData},this.$el.select2(t);else{this.select_data&&this.select_data.map(function(t){var e=n.options.maximumTextLength+3;if(t.text&&t.text.length>e){var i=t.text.indexOf("(".concat(t.id,")"));i=-1!=i&&i<e?i:e;var s=t.text.substring(0,i).replace(/[\ \.]*$/,"");t.text="".concat(s,"...(").concat(t.id,")")}});var e=this._getValue();t={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0},this.$el.select2(t),this._setValue(e)}},_getIndex:function(t){o.findIndex(this.select_data,{id:t})},_getValue:function(){return this.$el.select2("val")},_setValue:function(t){-1==this._getIndex(t)&&0<this.select_data.length&&(t=this.select_data[0].id),this.$el.select2("val",t)},_template:function(t){return'<input type="hidden" value="'.concat(this.options.initialData,'"/>')}});t.default={View:c}});