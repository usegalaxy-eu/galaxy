define(["exports","jquery","backbone","underscore","mvc/base-mvc"],function(e,t,i,l,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FoldoutListItemView=e.ListItemView=void 0;var n=r(t),s=r(i),d=r(l),o=r(a);function r(e){return e&&e.__esModule?e:{default:e}}var u=s.default.View.extend(o.default.LoggableMixin).extend({_logNamespace:"list",initialize:function(e){this.expanded=e.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==e.fxSpeed?e.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(e){var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){var e=(0,n.default)(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(e).replaceWith(this._renderDetails().show()),e},_queueNewRender:function(t,i){i=void 0===i?this.fxSpeed:i;var l=this;0===i?(l._swapNewRender(t),l.trigger("rendered",l)):(0,n.default)(l).queue("fx",[function(e){l.$el.fadeOut(i,e)},function(e){l._swapNewRender(t),e()},function(e){l.$el.fadeIn(i,e)},function(e){l.trigger("rendered",l),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",d.default.isFunction(this.className)?this.className():this.className).append(e.children())},_setUpBehaviors:function(e){(e=e||this.$el).find("[title]").tooltip({placement:"bottom"})},$details:function(e){return(e=e||this.$el).find("> .details")},_renderDetails:function(){var e=(0,n.default)(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(e),e},toggleExpanded:function(e){return(e=void 0===e?!this.expanded:e)?this.expand():this.collapse(),this},expand:function(){var e=this;return e._fetchModelDetails().always(function(){e._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?n.default.when():this.model.fetch()},_expand:function(){var e=this,t=e._renderDetails();e.$details().replaceWith(t),e.expanded=!0,e.$details().slideDown(e.fxSpeed,function(){e.trigger("expanded",e)})},collapse:function(){this.debug("".concat(this,"(ExpandableView).collapse"));var e=this;e.expanded=!1,this.$details().slideUp(e.fxSpeed,function(){e.trigger("collapsed",e)})}}),c=e.ListItemView=u.extend(o.default.mixin(o.default.SelectableViewMixin,o.default.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(e){u.prototype.initialize.call(this,e),o.default.SelectableViewMixin.initialize.call(this,e),o.default.DraggableViewMixin.initialize.call(this,e),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(e){e?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var e=u.prototype._buildNewRender.call(this);return e.children(".warnings").replaceWith(this._renderWarnings()),e.children(".title-bar").replaceWith(this._renderTitleBar()),e.children(".primary-actions").append(this._renderPrimaryActions()),e.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),e},_swapNewRender:function(e){return u.prototype._swapNewRender.call(this,e),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var t=this,i=(0,n.default)('<div class="warnings"></div>'),l=t.model.toJSON();return d.default.each(t.templates.warnings,function(e){i.append((0,n.default)(e(l,t)))}),i},_renderTitleBar:function(){return(0,n.default)(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return(0,n.default)(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation(),e.altKey?(this.toggleSelect(e),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(e){return!e||"keydown"!==e.type||32!==e.keyCode&&13!==e.keyCode||(this.toggleExpanded(),e.stopPropagation(),!1)},toString:function(){var e=this.model?"".concat(this.model):"(no model)";return"ListItemView(".concat(e,")")}}));c.prototype.templates={el:o.default.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),warnings:{},titleBar:o.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),subtitle:o.default.wrapTemplate(['<div class="subtitle"></div>']),details:o.default.wrapTemplate(['<div class="details"></div>'])};var h,f=e.FoldoutListItemView=c.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(e){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=e.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=e.foldoutPanelClass||this.foldoutPanelClass,c.prototype.initialize.call(this,e),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return(0,n.default)();var e=c.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,e)},_createFoldoutPanel:function(){var e=this.model,t=this._getFoldoutPanelClass(e),i=this._getFoldoutPanelOptions(e);return new t(d.default.extend(i,{model:e}))},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(e,t){return t=t||this.$("> .details"),this.foldout=e.render(0),e.$("> .controls").hide(),t.append(e.$el)},expand:function(){var e=this;return e._fetchModelDetails().always(function(){"foldout"===e.foldoutStyle?e._expand():"drilldown"===e.foldoutStyle&&e._expandByDrilldown()})},_expandByDrilldown:function(){var e=this;e.listenTo(e.foldout,"close",function(){e.trigger("collapsed:drilldown",e,e.foldout)}),e.trigger("expanded:drilldown",e,e.foldout)}});f.prototype.templates=(h=o.default.wrapTemplate(['<div class="details">',"</div>"],"collection"),d.default.extend({},c.prototype.templates,{details:h})),e.default={ExpandableView:u,ListItemView:c,FoldoutListItemView:f}});