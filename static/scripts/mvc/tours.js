define(["exports","utils/localization","underscore","jquery","backbone","onload/loadConfig","libs/bootstrap-tour"],function(t,e,n,a,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToursView=void 0,t.giveTourWithData=m,t.giveTourById=w,t.activeGalaxyTourRunner=y;var i=c(e),s=c(n),u=c(a),l=c(o);function c(t){return t&&t.__esModule?t:{default:t}}var d=window.Tour,g=(0,r.getAppRoot)(),f={storage:window.sessionStorage,onEnd:function(){window.sessionStorage.removeItem("activeGalaxyTour")},delay:150,orphan:!0},p=function(t){return s.default.each(t.steps,function(t){t.preclick&&(t.onShow=function(){s.default.each(t.preclick,function(t){(0,u.default)(t).click()})}),t.postclick&&(t.onHide=function(){s.default.each(t.postclick,function(t){(0,u.default)(t).click()})}),t.textinsert&&(t.onShown=function(){(0,u.default)(t.element).val(t.textinsert).trigger("change")}),t.path&&(console.warn("This Galaxy Tour is attempting to use path navigation.  This is known to be unstable and can possibly get the Galaxy client 'stuck' in a tour, and at this time is not allowed."),delete t.path)}),t},h=l.default.Model.extend({urlRoot:"".concat(g,"api/tours")}),v=l.default.Collection.extend({url:"".concat(g,"api/tours"),model:h}),b=t.ToursView=l.default.View.extend({title:(0,i.default)("Tours"),initialize:function(){var t=this;this.setElement("<div/>"),this.model=new v,this.model.fetch({success:function(){t.render()},error:function(){console.error("Failed to fetch tours.")}})},render:function(){var t=s.default.template('\n    <h2>Galaxy Tours</h2>\n    <p>This page presents a list of interactive tours available on this Galaxy server.\n    Select any tour to get started (and remember, you can click \'End Tour\' at any time).</p>\n\n<div class="row mb-3">\n    <div class="col-12 btn-group" role="group" aria-label="Tag selector">\n        <% _.each(tourtagorder, function(tag) { %>\n        <button class="btn btn-primary tag-selector-button" tag-selector-button="<%- tag %>">\n            <%- tag %>\n        </button>\n        <% }); %>\n    </div>\n</div>\n\n<% _.each(tourtagorder, function(tourtagkey) { %>\n<div tag="<%- tourtagkey %>" class="row mb-3">\n    <div class="col-12">\n    <% var tourtag = tourtags[tourtagkey]; %>\n    <h4>\n        <%- tourtag.name %>\n    </h4>\n    <ul class="list-group">\n    <% _.each(tourtag.tours, function(tour) { %>\n        <li class="list-group-item">\n            <a href="/tours/<%- tour.id %>" class="tourItem" data-tour.id=<%- tour.id %>>\n                <%- tour.attributes.name || tour.id %>\n            </a>\n             - <%- tour.attributes.description || "No description given." %>\n             <% _.each(tour.attributes.tags, function(tag) { %>\n                <span class="badge badge-primary">\n                    <%- tag.charAt(0).toUpperCase() + tag.slice(1) %>\n                </span>\n             <% }); %>\n        </li>\n    <% }); %>\n    </ul>\n    </div>\n</div>\n<% }); %>'),n={};s.default.each(this.model.models,function(e){null===e.attributes.tags?(void 0===n.Untagged&&(n.Untagged={name:"Untagged",tours:[]}),n.Untagged.tours.push(e)):s.default.each(e.attributes.tags,function(t){t=t.charAt(0).toUpperCase()+t.slice(1),void 0===n[t]&&(n[t]={name:t,tours:[]}),n[t].tours.push(e)})});var e=Object.keys(n).sort();this.$el.html(t({tours:this.model.models,tourtags:n,tourtagorder:e})).on("click",".tourItem",function(t){t.preventDefault(),w((0,u.default)(this).data("tour.id"))}).on("click",".tag-selector-button",function(t){var e=(0,u.default)(t.target),n="block",a=e.attr("tag-selector-button");e.toggleClass("btn-primary"),e.toggleClass("btn-secondary"),e.hasClass("btn-secondary")&&(n="none"),(0,u.default)("div[tag='".concat(a,"']")).css({display:n})})}});function m(t){var e=p(t);window.sessionStorage.setItem("activeGalaxyTour",JSON.stringify(t));var n=new d(s.default.extend({steps:e.steps},f));return n.init(),n.goTo(0),n.restart(),n}function w(t){var e="".concat(g,"api/tours/").concat(t);u.default.getJSON(e,function(t){m(t)})}function y(){var t=JSON.parse(window.sessionStorage.getItem("activeGalaxyTour"));if(t&&(t=p(t))&&t.steps&&window&&window.self===window.top){var e=new d(s.default.extend({steps:t.steps},f));e.init(),e.restart()}}t.default={ToursView:b,giveTourWithData:m,giveTourById:w,activeGalaxyTourRunner:y}});