define(["exports","utils/localization","pyre-to-regexp"],function(e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=n(t),c=n(a);function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s="new",o=function(e,t){if(0==e.length)return"no columns";if(1==e.length)return"column ".concat(t[e[0]]);var a=e.map(function(e){return t[e]});return"columns ".concat([a.slice(0,-1).join(", "),a.slice(-1)[0]].join(" and "))},u=function(e,t){var a=[];for(var n in e)-1===t.indexOf(n)&&a.push(e[n]);return a},l=function(e,n,t,r,o){var u;try{u=(0,c.default)(String(e))}catch(e){return{error:"Invalid regular expression specified."}}var l=0;return t=t.map(function(e){var t=e[n],a=u.exec(t);return a?r?e.concat([u.pyreReplace(a[0],r)]):(o=o&&parseInt(o))?a.length!=o+1?(l++,null):e.concat(a.splice(1,a.length)):e.concat([a[0]]):(l++,null)}),0<l?{error:"".concat(l," row(s) failed to match specified regular expression.")}:{data:t}},i=function(a,e){return e.reduce(function(e,t){return e.concat(a(t))},[])},p={add_column_basename:{title:(0,d.default)("Basename of Path of URL"),display:function(e,t){return"Add column using basename of column ".concat(t[e.target_column])},init:function(e,t){e.addColumnBasenameTarget=t?t.target_column:0},save:function(e,t){t.target_column=e.addColumnBasenameTarget},apply:function(e,t,a,n){var r=e.target_column,o=l("[^/]*$",r,t);return n.push(s),o.columns=n,o}},add_column_rownum:{title:(0,d.default)("Row Number"),display:function(e,t){return"Add column for the current row number."},init:function(e,t){e.addColumnRownumStart=t?t.start:1},save:function(e,t){t.start=parseInt(e.addColumnRownumStart)},apply:function(e,t,a,n){var r=e.start;return t=t.map(function(e){var t=e.slice();return t.push(String(r)),r+=1,t}),n.push(s),{data:t,columns:n}}},add_column_value:{title:(0,d.default)("Fixed Value"),display:function(e,t){return"Add column for the constant value of ".concat(e.value,".")},init:function(e,t){e.addColumnValue=t?t.value:""},save:function(e,t){t.value=e.addColumnValue},apply:function(e,t,a,n){var r=e.value;return t=t.map(function(e){var t=e.slice();return t.push(r),t}),n.push(s),{data:t,columns:n}}},add_column_metadata:{title:(0,d.default)("Add Column from Metadata"),display:function(e,t){return"Add column for ".concat(e.value,".")},init:function(e,t){e.addColumnMetadataValue=t?t.value:null},save:function(e,t){t.value=e.addColumnMetadataValue},apply:function(e,t,r,a){var n,o=e.value;if(0==o.indexOf("identifier")){var u=parseInt(o.substring("identifier".length));n=function(e,t){var a=e.slice();return a.push(r[t].identifiers[u]),a}}else if("tags"==o)n=function(e,t){var a=e.slice(),n=r[t].tags;return n.sort(),a.push(n.join(",")),a};else{if("hid"!=o&&"name"!=o&&"path"!=o)return{error:"Unknown metadata type [".concat(o,"}]")};n=function(e,t){var a=e.slice();return a.push(r[t][o]),a}}return t=t.map(n),a.push(s),{data:t,columns:a}}},add_column_group_tag_value:{title:(0,d.default)("Add Column from Group Tag Value"),display:function(e,t){return"Add column for value of group tag ".concat(e.value,".")},init:function(e,t){e.addColumnGroupTagValueDefault=t?(e.addColumnGroupTagValueValue=t.value,t.default_value):(e.addColumnGroupTagValueValue=null,"")},save:function(e,t){t.value=e.addColumnGroupTagValueValue,t.default_value=e.addColumnGroupTagValueDefault},apply:function(l,e,i,t){var a=l.value,c="group:".concat(a,":");return e=e.map(function(e,t){var a=e.slice(),n=i[t].tags;n.sort();var r=l.default_value;for(var o in n){var u=n[o];if(0==u.indexOf(c)){r=u.substr(c.length);break}}return a.push(r),a}),t.push(s),{data:e,columns:t}}},add_column_regex:{title:(0,d.default)("Using a Regular Expression"),display:function(e,t){return"Add new column using ".concat(e.expression," applied to column ").concat(t[e.target_column])},init:function(e,t){e.addColumnRegexGroupCount=t?(e.addColumnRegexTarget=t.target_column,e.addColumnRegexExpression=t.expression,e.addColumnRegexReplacement=t.replacement,t.group_count):(e.addColumnRegexTarget=0,e.addColumnRegexExpression="",e.addColumnRegexReplacement=null);var a="global";e.addColumnRegexGroupCount?a="groups":e.addColumnRegexReplacement&&(a="replacement"),e.addColumnRegexType=a},save:function(e,t){t.target_column=e.addColumnRegexTarget,t.expression=e.addColumnRegexExpression,e.addColumnRegexReplacement&&(t.replacement=e.addColumnRegexReplacement),e.addColumnRegexGroupCount&&(t.group_count=e.addColumnRegexGroupCount)},apply:function(e,t,a,n){var r=e.target_column,o=l(e.expression,r,t,e.replacement,e.group_count);return n.push(s),o.columns=n,o}},add_column_concatenate:{title:(0,d.default)("Concatenate Columns"),display:function(e,t){return"Concatenate column ".concat(t[e.target_column_0]," and column ").concat(t[e.target_column_1])},init:function(e,t){e.addColumnConcatenateTarget1=t?(e.addColumnConcatenateTarget0=t.target_column_0,t.target_column_1):e.addColumnConcatenateTarget0=0},save:function(e,t){t.target_column_0=e.addColumnConcatenateTarget0,t.target_column_1=e.addColumnConcatenateTarget1},apply:function(e,t,a,n){var r=e.target_column_0,o=e.target_column_1;return t=t.map(function(e){var t=e.slice();return t.push(e[r]+e[o]),t}),n.push(s),{data:t,columns:n}}},add_column_substr:{title:(0,d.default)("Keep or Trim Prefix or Suffix"),display:function(e,t){var a,n=e.substr_type;return a="keep_prefix"==n?"Keep only ".concat(e.length," characters from the start of column ").concat(t[e.target_column]):"drop_prefix"==n?"Remove ".concat(e.length," characters from the start of column ").concat(t[e.target_column]):"keep_suffix"==n?"Keep only ".concat(e.length," characters from the end of column ").concat(t[e.target_column]):"Remove ".concat(e.length," characters from the end of column ").concat(t[e.target_column]),a},init:function(e,t){t?(e.addColumnSubstrTarget=t.target_column,e.addColumnSubstrLength=t.length,e.addColumnSubstrType=t.substr_type):(e.addColumnSubstrTarget=0,e.addColumnSubstrType="keep_prefix",e.addColumnSubstrLength=1)},save:function(e,t){t.target_column=e.addColumnSubstrTarget,t.length=parseInt(e.addColumnSubstrLength),t.substr_type=e.addColumnSubstrType},apply:function(e,t,a,n){var o=e.target_column,u=e.length,l=e.substr_type;return t=t.map(function(e){var t=e.slice(),a=e[o],n=0,r=a.length;return"keep_prefix"==l?r=u:"drop_prefix"==l?n=u:"keep_suffix"==l?(n=r-u)<0&&(n=0):(r-=u)<0&&(r=0),t.push(a.substr(n,r)),t}),n.push(s),{data:t}}},remove_columns:{title:(0,d.default)("Remove Column(s)"),display:function(e,t){var a=e.target_columns;return"Remove ".concat(o(a,t))},init:function(e,t){e.removeColumnTargets=t?t.target_columns:[]},save:function(e,t){t.target_columns=e.removeColumnTargets},apply:function(e,t,a,n){var r=e.target_columns;return{data:t=t.map(function(e){var t=[];for(var a in e)-1==r.indexOf(parseInt(a))&&t.push(e[a]);return t}),columns:n=u(n,r)}}},add_filter_regex:{title:(0,d.default)("Using a Regular Expression"),display:function(e,t){return"Filter rows using regular expression ".concat(e.expression," on column ").concat(t[e.target_column])},init:function(e,t){e.addFilterRegexInvert=t?(e.addFilterRegexTarget=t.target_column,e.addFilterRegexExpression=t.expression,t.invert):(e.addFilterRegexTarget=0,e.addFilterRegexExpression="",!1)},save:function(e,t){t.target_column=e.addFilterRegexTarget,t.expression=e.addFilterRegexExpression,t.invert=e.addFilterRegexInvert},apply:function(e,n,t,a){var r,o=String(e.expression);try{r=(0,c.default)(o)}catch(e){return{error:"Invalid regular expression specified."}}var u=e.target_column,l=e.invert,i=function(e,t){var a=n[parseInt(t)];return r.exec(a[u])?!l:l};return t=t.filter(i),{data:n=n.filter(i),sources:t}}},add_filter_count:{title:(0,d.default)("First or Last N Rows"),display:function(e,t){var a=e.which,n=e.invert;return"first"!=a||n?"first"==a&&n?"Keep only first ".concat(e.count," row(s)."):"last"!=a||n?"Keep only last ".concat(e.count," row(s)."):"Filter out last ".concat(e.count," row(s)."):"Filter out first ".concat(e.count," row(s).")},init:function(e,t){e.addFilterCountInvert=t?(e.addFilterCountN=parseInt(t.count),e.addFilterCountWhich=t.which,t.inverse):(e.addFilterCountN=0,!(e.addFilterCountWhich="first"))},save:function(e,t){t.count=parseInt(e.addFilterCountN),t.which=e.addFilterCountWhich,t.invert=e.addFilterCountInvert},apply:function(e,t,a,n){var r=e.count,o=e.invert,u=e.which,l=t.length,i=function(e,t){return("first"==u?r<=t:t<l-r)?!o:o};return a=a.filter(i),{data:t=t.filter(i),sources:a}}},add_filter_empty:{title:(0,d.default)("On Emptiness"),display:function(e,t){return"Filter rows if no value for column ".concat(t[e.target_column])},init:function(e,t){e.addFilterEmptyInvert=t?(e.addFilterEmptyTarget=t.target_column,t.invert):(e.addFilterEmptyTarget=0,!1)},save:function(e,t){t.target_column=e.addFilterEmptyTarget,t.invert=e.addFilterEmptyInvert},apply:function(e,a,t,n){var r=e.target_column,o=e.invert,u=function(e,t){return a[parseInt(t)][r].length?!o:o};return t=t.filter(u),{data:a=a.filter(u),sources:t}}},add_filter_matches:{title:(0,d.default)("Matching a Supplied Value"),display:function(e,t){return"Filter rows with value ".concat(e.value," for column ").concat(t[e.target_column])},init:function(e,t){e.addFilterMatchesInvert=t?(e.addFilterMatchesTarget=t.target_column,e.addFilterMatchesValue=t.value,t.invert):(e.addFilterMatchesTarget=0,e.addFilterMatchesValue="",!1)},save:function(e,t){t.target_column=e.addFilterMatchesTarget,t.value=e.addFilterMatchesValue,t.invert=e.addFilterMatchesInvert},apply:function(e,a,t,n){var r=e.target_column,o=e.invert,u=e.value,l=function(e,t){return a[parseInt(t)][r]==u?!o:o};return t=t.filter(l),{data:a=a.filter(l),sources:t}}},add_filter_compare:{title:(0,d.default)("By Comparing to a Numeric Value"),display:function(e,t){return"Filter rows with value ".concat(e.compare_type," ").concat(e.value," for column ").concat(t[e.target_column])},init:function(e,t){e.addFilterCompareType=t?(e.addFilterCompareTarget=t.target_column,e.addFilterCompareValue=t.value,t.compare_type):(e.addFilterCompareTarget=0,e.addFilterCompareValue=0,"less_than")},save:function(e,t){t.target_column=e.addFilterCompareTarget,t.value=e.addFilterCompareValue,t.compare_type=e.addFilterCompareType},apply:function(e,o,t,a){var u=e.target_column,l=e.compare_type,i=e.value,n=function(e,t){var a,n=o[parseInt(t)],r=parseFloat(n[u]);return"less_than"==l?a=r<i:"less_than_equal"==l?a=r<=i:"greater_than"==l?a=i<r:"greater_than_equal"==l&&(a=i<=r),a};return t=t.filter(n),{data:o=o.filter(n),sources:t}}},sort:{title:(0,d.default)("Sort"),display:function(e,t){return"Sort on column ".concat(t[e.target_column])},init:function(e,t){e.addSortingNumeric=t?(e.addSortingTarget=t.target_column,t.numeric):(e.addSortingTarget=0,!1)},save:function(e,t){t.target_column=e.addSortingTarget,t.numeric=e.addSortingNumeric},apply:function(e,t,a,n){var r=e.target_column,o=e.numeric,u=_.zip(t,a);u.sort(function(e,t){var a=e[0][r],n=t[0][r];return o&&(a=parseFloat(a),n=parseFloat(n)),a<n?-1:n<a?1:0});var l=[],i=[];return u.map(function(e){l.push(e[0]),i.push(e[1])}),{data:l,sources:i}}},swap_columns:{title:(0,d.default)("Swap Column(s)"),display:function(e,t){return"Swap ".concat(o([e.target_column_0,e.target_column_1],t))},init:function(e,t){e.swapColumnsTarget1=t?(e.swapColumnsTarget0=t.target_column_0,t.target_column_1):e.swapColumnsTarget0=0},save:function(e,t){t.target_column_0=e.swapColumnsTarget0,t.target_column_1=e.swapColumnsTarget1},apply:function(e,t,a,n){var r=e.target_column_0,o=e.target_column_1;t=t.map(function(e){var t=e.slice();return t[r]=e[o],t[o]=e[r],t});var u=n[r];return n[r]=n[o],n[o]=u,{data:t,columns:n}}},split_columns:{title:(0,d.default)("Split Column(s)"),display:function(e,t){return"Duplicate each row and split up columns"},init:function(e,t){e.splitColumnsTargets1=t?(e.splitColumnsTargets0=t.target_columns_0,t.target_columns_1):(e.splitColumnsTargets0=[],[])},save:function(e,t){t.target_columns_0=e.splitColumnsTargets0,t.target_columns_1=e.splitColumnsTargets1},apply:function(e,t,a,n){var r=e.target_columns_0,o=e.target_columns_1;return{data:t=i(function(e){var t=[],a=[];for(var n in e)n=parseInt(n),-1<r.indexOf(n)?t.push(e[n]):(-1<o.indexOf(n)||t.push(e[n]),a.push(e[n]));return[t,a]},t),sources:a=i(function(e){return[e,e]},a),columns:n=u(n,r)}}}},m={list_identifiers:{multiple:!0,label:(0,d.default)("List Identifier(s)"),columnHeader:(0,d.default)("List Identifier"),help:(0,d.default)("This should be a short description of the replicate, sample name, condition, etc... that describes each level of the list structure."),importType:"collections"},paired_identifier:{label:(0,d.default)("Paired-end Indicator"),columnHeader:(0,d.default)("Paired Indicator"),help:(0,d.default)("This should be set to '1', 'R1', 'forward', 'f', or 'F' to indicate forward reads, and '2', 'r', 'reverse', 'R2', 'R', or 'R2' to indicate reverse reads."),importType:"collections"},collection_name:{label:(0,d.default)("Collection Name"),help:(0,d.default)("If this is set, all rows with the same collection name will be joined into a collection and it is possible to create multiple collections at once."),modes:["raw","ftp","datasets","library_datasets"],importType:"collections"},name_tag:{label:(0,d.default)("Name Tag"),help:(0,d.default)("Add a name tag or hash tag based on the specified column value for imported datasets."),importType:"datasets",modes:["raw","ftp"]},tags:{multiple:!0,label:(0,d.default)("General Purpose Tag(s)"),help:(0,d.default)("Add a general purpose tag based on the specified column value, use : to separate key-value pairs if desired. These tags are not propagated to derived datasets the way name and group tags are."),modes:["raw","ftp","datasets","library_datasets"]},group_tags:{multiple:!0,label:(0,d.default)("Group Tag(s)"),help:(0,d.default)("Add a group tag based on the specified column value, use : to separate key-value pairs. These tags are propagated to derived datasets and may be useful for factorial experiments."),modes:["raw","ftp","datasets","library_datasets"]},name:{label:(0,d.default)("Name"),importType:"datasets"},dbkey:{label:(0,d.default)("Genome"),modes:["raw","ftp"]},file_type:{label:(0,d.default)("Type"),modes:["raw","ftp"],help:(0,d.default)("This should be the Galaxy file type corresponding to this file.")},url:{label:(0,d.default)("URL"),modes:["raw"],help:(0,d.default)("This should be a URL the file can be downloaded from.")},info:{label:(0,d.default)("Info"),help:(0,d.default)("Unstructured text associated with the dataset that shows up in the history panel, this is optional and can be whatever you would like."),modes:["raw","ftp"]},ftp_path:{label:(0,d.default)("FTP Path"),modes:["raw","ftp"],help:(0,d.default)("This should be the path to the target file to include relative to your FTP directory on the Galaxy server"),requiresFtp:!0}},f=function(e,t){return 0==e.length?t?t.map(function(e,t){return String.fromCharCode(65+t)}):[]:e[0].map(function(e,t){return String.fromCharCode(65+t)})};e.default={applyRules:function(e,t,a,n,r){r=r||[];var o=!1;for(var u in n){var l=f(e,a);r[u]=l;var i=n[u];if(i.error=null,i.warn=null,o)i.warn=(0,d.default)("Skipped due to previous errors.");else{var c=i.type,s=p[c].apply(i,e,t,a);s.error?(o=!0,i.error=s.error):(s.warn&&(i.warn=s.warn),e=s.data||e,t=s.sources||t,a=s.columns||a)}}return{data:e,sources:t,columns:a}},columnDisplay:function(e,t){var a;return 2==(a="object"==r(e)?e.map(function(e){return t[e]}):[t[e]]).length?"columns "+a[0]+" and "+a[1]:2<a.length?"columns "+a.slice(0,-1).join(", ")+", and "+a[a.length-1]:"column "+a[0]},colHeadersFor:f,RULES:p,MAPPING_TARGETS:m}});