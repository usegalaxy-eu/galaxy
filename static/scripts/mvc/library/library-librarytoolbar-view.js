define(["exports","underscore","backbone","utils/localization","libs/toastr","mvc/library/library-model","app"],function(e,a,t,i,r,s,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(a),c=u(t),o=u(i),p=u(r),d=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var h=c.default.View.extend({el:"#center",defaults:{search_term:""},events:{"click #create_new_library_btn":"createLibraryFromModal","click #include_deleted_chk":"includeDeletedChecked","click #exclude_restricted_chk":"excludeRestrictedChecked","click .page_size_prompt":"showPageSizePrompt","keyup .library-search-input":"searchLibraries"},initialize:function(e){this.options=n.default.defaults(this.options||{},e,this.defaults),this.render()},render:function(){var e=(0,l.getGalaxyInstance)(),a=this.templateToolBar(),t=!1,i=!0;e.user&&(t=e.user.isAdmin(),i=e.user.isAnonymous()),this.$el.html(a({admin_user:t,anon_user:i})),t&&(this.$el.find("#include_deleted_chk")[0].checked=e.libraries.preferences.get("with_deleted"),this.$el.find("#exclude_restricted_chk")[0].checked=e.libraries.preferences.get("without_restricted"))},renderPaginator:function(e){var a=(0,l.getGalaxyInstance)();this.options=n.default.extend(this.options,e);var t=this.templatePaginator();this.$el.find(".library-paginator").html(t({show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_libraries_count:this.options.total_libraries_count,libraries_shown:this.options.libraries_shown,library_page_size:a.libraries.preferences.get("library_page_size")}))},createLibraryFromModal:function(e){e.preventDefault(),e.stopPropagation();var a=(0,l.getGalaxyInstance)(),t=this;this.modal=a.modal,this.modal.show({closing_events:!0,title:(0,o.default)("Create New Library"),body:this.templateNewLibraryInModal(),buttons:{Create:function(){t.createNewLibrary()},Close:function(){t.modal.hide()}}})},createNewLibrary:function(){var a=(0,l.getGalaxyInstance)(),e=this.serializeNewLibrary();if(this.validateNewLibrary(e)){var t=new d.default.Library,i=this;t.save(e,{success:function(e){a.libraries.libraryListView.collection.add(e),i.modal.hide(),i.clearLibraryModal(),a.libraries.libraryListView.render(),p.default.success("Library created.")},error:function(e,a){void 0!==a.responseJSON?p.default.error(a.responseJSON.err_msg):p.default.error("An error occured.")}})}else p.default.error("Library's name is missing.");return!1},showPageSizePrompt:function(e){e.preventDefault();var a=(0,l.getGalaxyInstance)(),t=prompt("How many libraries per page do you want to see?",a.libraries.preferences.get("library_page_size"));null!=t&&t==parseInt(t)&&(a.libraries.preferences.set({library_page_size:parseInt(t)}),a.libraries.libraryListView.render({show_page:1}))},clearLibraryModal:function(){$("input[name='Name']").val(""),$("input[name='Description']").val(""),$("input[name='Synopsis']").val("")},serializeNewLibrary:function(){return{name:$("input[name='Name']").val(),description:$("input[name='Description']").val(),synopsis:$("input[name='Synopsis']").val()}},validateNewLibrary:function(e){return""!==e.name},includeDeletedChecked:function(e){var a=(0,l.getGalaxyInstance)();e.target.checked?(a.libraries.preferences.set({with_deleted:!0}),a.libraries.libraryListView.fetchDeleted()):(a.libraries.preferences.set({with_deleted:!1}),a.libraries.libraryListView.render())},excludeRestrictedChecked:function(e){var a=(0,l.getGalaxyInstance)();e.target.checked?a.libraries.preferences.set({without_restricted:!0}):a.libraries.preferences.set({without_restricted:!1}),a.libraries.libraryListView.render()},searchLibraries:function(e){var a=(0,l.getGalaxyInstance)(),t=$(".library-search-input").val();this.options.search_term=t,a.libraries.libraryListView.searchLibraries(t)},templateToolBar:function(){return n.default.template(['<div class="library_style_container">','<div class="d-flex align-items-center mb-2">','<a class="mr-1" href="#" data-toggle="tooltip" data-placement="top" title="Go to first page">DATA LIBRARIES</a>','<div class="d-flex align-items-center library-paginator mr-1" />','<form class="form-inline mr-1">','<input type="text" class="form-control library-search-input mr-1" placeholder="Great Library" size="15">',"<% if(admin_user === true) { %>",'<div class="form-check mr-1">','<input class="form-check-input" id="include_deleted_chk" type="checkbox">','<label class="form-check-label" for="include_deleted_chk">include deleted</label>',"</div>",'<div class="form-check mr-1">','<input class="form-check-input" id="exclude_restricted_chk" type="checkbox">','<label class="form-check-label" for="exclude_restricted_chk">exclude restricted</label>',"</div>",'<button data-toggle="tooltip" data-placement="top" title="Create new library" id="create_new_library_btn" class="btn btn-secondary" type="button"><span class="fa fa-plus"></span> New Library</button>',"<% } %>","</form>",'<a class="library-help-button" data-toggle="tooltip" data-placement="top" title="See this screen annotated" href="https://galaxyproject.org/data-libraries/screen/list-of-libraries/" target="_blank">','<button class="btn btn-secondary" type="button"><span class="fa fa-question-circle"></span> Help</button>',"</a>","</div>",'<div id="libraries_element" />',"</div>"].join(""))},templatePaginator:function(){return n.default.template(['<ul class="pagination mr-1">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="page-item active">','<a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>",'<span class="mr-1">',' <%- libraries_shown %> libraries shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- library_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>",'<span class="mr-1">'," <%- total_libraries_count %> total","</span>"].join(""))},templateNewLibraryInModal:function(){return n.default.template(['<div id="new_library_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">','<input type="text" name="Synopsis" value="" placeholder="Synopsis">',"</form>","</div>"].join(""))}});e.default={LibraryToolbarView:h}});