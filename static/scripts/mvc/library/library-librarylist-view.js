define(["exports","libs/underscore","backbone","app","libs/toastr","mvc/library/library-model","mvc/library/library-libraryrow-view"],function(e,r,t,a,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=b(r),l=b(t),c=b(i),h=b(s),d=b(o);function b(e){return e&&e.__esModule?e:{default:e}}var p=l.default.View.extend({el:"#libraries_element",events:{"click .sort-libraries-link":"sort_clicked"},defaults:{page_count:null,show_page:null,all_fetched:!1},initialize:function(e){this.options=n.default.defaults(this.options||{},e,this.defaults);var r=this;this.modal=null,this.collection=new h.default.Libraries,this.collection.url="".concat(this.collection.urlRoot,"?deleted=false"),this.collection.fetch({success:function(){r.render()},error:function(e,r){void 0!==r.responseJSON?c.default.error(r.responseJSON.err_msg):c.default.error("An error occurred.")}})},render:function(e){var r=(0,a.getGalaxyInstance)();this.options=n.default.extend(this.options,e),this.setElement("#libraries_element");var t=this.templateLibraryList(),i=null,s=null,o=function(e){return!0===e.get("public")};if($(".tooltip").hide(),void 0!==e&&(s=void 0!==e.models?e.models:null),null!==this.collection&&null===s)this.sortLibraries(),i=r.libraries.preferences.get("with_deleted")?this.collection.models:this.collection.where({deleted:!1}),r.libraries.preferences.get("without_restricted")&&(i=n.default.filter(i,o));else if(null!==s){if(r.libraries.preferences.get("with_deleted"))i=s;else{i=n.default.filter(s,function(e){return!1===e.get("deleted")})}r.libraries.preferences.get("without_restricted")&&(i=n.default.filter(i,o))}else i=[];(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_libraries_count=i.length;var l=r.libraries.preferences.get("library_page_size")*(this.options.show_page-1);this.options.page_count=Math.ceil(this.options.total_libraries_count/r.libraries.preferences.get("library_page_size")),0<this.options.total_libraries_count&&l<this.options.total_libraries_count?(i=i.slice(l,l+r.libraries.preferences.get("library_page_size")),this.options.libraries_shown=i.length,r.libraries.preferences.get("library_page_size")*this.options.show_page>this.options.total_libraries_count+r.libraries.preferences.get("library_page_size")&&(i=[]),this.$el.html(t({length:1,order:r.libraries.preferences.get("sort_order"),search_term:r.libraries.libraryToolbarView.options.search_term})),r.libraries.libraryToolbarView.renderPaginator(this.options),this.renderRows(i)):(this.$el.html(t({length:0,order:r.libraries.preferences.get("sort_order"),search_term:r.libraries.libraryToolbarView.options.search_term})),r.libraries.libraryToolbarView.renderPaginator(this.options)),$('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),$("#center").css("overflow","auto")},fetchDeleted:function(){if(this.options.all_fetched)this.render();else{var e=this;this.collection.url="".concat(this.collection.urlRoot,"?deleted=true"),this.collection.fetch({remove:!1,success:function(){e.options.all_fetched=!0,e.render()},error:function(e,r){void 0!==r.responseJSON?c.default.error(r.responseJSON.err_msg):c.default.error("An error occurred.")}})}},renderRows:function(e){for(var r=0;r<e.length;r++){var t=e[r];this.renderOne({library:t})}},renderOne:function(e){var r=e.library,t=new d.default.LibraryRowView(r);this.$el.find("#library_list_body").append(t.el)},sort_clicked:function(){var e=(0,a.getGalaxyInstance)();"asc"===e.libraries.preferences.get("sort_order")?e.libraries.preferences.set({sort_order:"desc"}):e.libraries.preferences.set({sort_order:"asc"}),this.render()},sortLibraries:function(){var e=(0,a.getGalaxyInstance)();"name"===e.libraries.preferences.get("sort_by")&&("asc"===e.libraries.preferences.get("sort_order")?this.collection.sortLibraries("name","asc"):"desc"===e.libraries.preferences.get("sort_order")&&this.collection.sortLibraries("name","desc"))},searchLibraries:function(e){if(""!==$.trim(e)){var r;r=this.collection.search(e),this.options.searching=!0,this.render({models:r,show_page:1})}else this.options.searching=!1,this.render()},templateLibraryList:function(){return n.default.template(['<div class="library_container table-responsive">',"<% if(length === 0) { %>","<% if(search_term.length > 0) { %>","<div>","There are no libraries matching your search. Try different keyword.","</div>","<% } else{ %>","<div>","There are no libraries visible to you here. If you expected some to show up please consult the",' <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>","<% }%>","<% } else{ %>",'<table class="grid table table-sm">',"<thead>",'<th style="width:30%;">','<a class="sort-libraries-link" title="Click to reverse order" href="#">',"name","</a>",'<span title="Sorted alphabetically" class="fa fa-sort-alpha-<%- order %>"/>',"</th>",'<th style="width:22%;">description</th>','<th style="width:22%;">synopsis</th> ','<th style="width:26%;"></th>',"</thead>",'<tbody id="library_list_body">',"</tbody>","</table>","<% }%>","</div>"].join(""))}});e.default={LibraryListView:p}});