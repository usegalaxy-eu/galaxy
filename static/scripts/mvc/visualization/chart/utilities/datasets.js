define(["exports","underscore","onload/loadConfig","utils/utils"],function(a,e,t,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=s(e),n=s(r);function s(a){return a&&a.__esModule?a:{default:a}}var h={},l=function(i){var a=i.dataset_groups,f=i.dataset_id,v=[];a.each(function(s){o.default.each(s.get("__data_columns"),function(a,e){var t=s.get(e),r=_(f,t);-1!==v.indexOf(t)||h[r]||"auto"==t||"zero"==t||void 0===t||v.push(t)})}),0!==v.length?n.default.get({url:(0,t.getAppRoot)()+"api/datasets/"+f,data:{data_type:"raw_data",provider:"dataset-column",indeces:v.toString()},success:function(a){for(var e=v.length,t=new Array(e),r=0;r<t.length;r++)t[r]=[];for(var s in a.data){var n=a.data[s];for(var o in n){var u=n[o];void 0!==u&&2147483647!=u&&o<e&&t[o].push(u)}}for(var l in console.debug("tabular-datasets::_fetch() - Fetching complete."),t){var c=v[l],d=_(f,c);h[d]=t[l]}g(i)}}):g(i)},g=function(a){var e=a.dataset_groups,f=a.dataset_id;console.debug("tabular-datasets::_fillFromCache() - Filling request from cache.");var v=0;e.each(function(n){o.default.each(n.get("__data_columns"),function(a,e){var t=n.get(e),r=_(f,t),s=h[r];s&&(v=Math.max(v,s.length))})}),0===v&&(console.debug("tabular-datasets::_fillFromCache() - No data available."),a.chart&&a.chart.state("failed","No data available."));var s=[];e.each(function(a,e){for(var t=n.default.merge({key:e+":"+a.get("key"),values:[]},a.attributes),r=0;r<v;r++)t.values[r]={x:parseInt(r)};s.push(t)}),e.each(function(d,a){var i=s[a].values;o.default.each(d.get("__data_columns"),function(a,e){var t=d.get(e);switch(t){case"auto":for(var r=0;r<v;r++)i[r][e]=parseInt(r);break;case"zero":for(var s=0;s<v;s++)i[s][e]=0;break;default:for(var n=_(f,t),o=h[n],u=0;u<v;u++){var l=i[u],c=o[u];isNaN(c)&&!a.is_label&&(c=0),l[e]=c}}})}),a.success(s)},_=function(a,e){return a+"__"+e};a.default={request:l,requestPanels:function(a){var s=a.process,n=a.chart,o=a.render,u=a.targets,e=a.dataset_id||a.chart.get("dataset_id"),t=a.dataset_groups||a.chart.groups;l({chart:n,dataset_id:e,dataset_groups:t,success:function(a){try{if(u.length==a.length){var e=!0;for(var t in a){var r=a[t];if(!o(u[t],[r])){e=!1;break}}e&&n.state("ok","Multi-panel chart drawn.")}else 1==u.length?o(u[0],a)&&n.state("ok","Chart drawn."):n.state("failed","Invalid panel count.");s.resolve()}catch(a){console.debug("FAILED: tabular-utilities::panelHelper() - "+a),n.state("failed",a),s.reject()}}})}}});