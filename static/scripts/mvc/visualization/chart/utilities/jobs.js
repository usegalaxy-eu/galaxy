define(["exports","underscore","onload/loadConfig","utils/utils","app"],function(e,t,u,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(t),r=i(s);function i(e){return e&&e.__esModule?e:{default:e}}var d=function s(a,i,o){r.default.request({type:"GET",url:(0,u.getAppRoot)()+"api/datasets/"+a.get("dataset_id_job"),data:{},success:function(e){var t=!1;switch(e.state){case"ok":a.state("wait","Job completed successfully..."),i&&i(e),t=!0;break;case"error":a.state("failed","Job has failed. Please check the history for details."),o&&o(e),t=!0;break;case"running":a.state("wait","Your job is running in the background and you may close the browser tab. Results will be available in your saved visualizations list.")}t||window.setTimeout(function(){s(a,i,o)},1e3)}})},l=function(){var e=(0,a.getGalaxyInstance)();e&&e.currHistoryPanel&&e.currHistoryPanel.refreshContents()};e.default={request:function(s,a,i,o){s.state("wait","Requesting job results..."),s.get("modified")&&s.get("dataset_id_job")&&(r.default.request({type:"PUT",url:(0,u.getAppRoot)()+"api/histories/none/contents/"+s.get("dataset_id_job"),data:{deleted:!0},success:function(){l()}}),s.set("dataset_id_job",null),s.set("modified",!1)),s.get("dataset_id_job")?d(s,i,o):(s.state("wait","Sending job request..."),r.default.request({type:"POST",url:(0,u.getAppRoot)()+"api/tools",data:a,success:function(e){if(e.outputs&&0!==e.outputs.length){l();var t=e.outputs[0];s.state("wait","Your job has been queued. You may close the browser window. The job will run in the background."),s.set("dataset_id_job",t.id),s.save(),d(s,i,o)}else s.state("failed","Job submission failed. No response."),o&&o()},error:function(e){var t="";e&&e.message&&e.message.data&&e.message.data.input&&(t=e.message.data.input+"."),s.state("failed","This visualization requires the '"+a.tool_id+"' tool. Please make sure it is installed. "+t),o&&o()}}))},requestCharts:function(e,t){var s="",a="",i=0;for(var o in e.settings.attributes){var u=e.settings.get(o);n.default.each([[" ","&#32;"],[",","&#44;"],[":","&#58;"]],function(e){u=u.replace(new RegExp(e[0],"g"),e[1])}),s+=o+":"+u+", "}return s=s.substring(0,s.length-2),e.groups.each(function(s){i++,n.default.each(s.get("__data_columns"),function(e,t){a+=t+"_"+i+":"+(parseInt(s.get(t))+1)+", "})}),a=a.substring(0,a.length-2),{tool_id:"toolshed.g2.bx.psu.edu/repos/iuc/charts/charts/1.0.1",inputs:{input:{id:e.get("dataset_id"),src:"hda"},module:t,columns:a,settings:s}}}}});