define(["exports","underscore","jquery","backbone","onload/loadConfig","utils/utils","mvc/ui/ui-misc","mvc/form/form-view","mvc/form/form-repeat","mvc/form/form-data"],function(e,t,a,i,r,n,s,o,d,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=v(t),c=v(a),h=v(i),f=v(n),p=(v(s),v(o)),m=v(d),g=v(u);function v(e){return e&&e.__esModule?e:{default:e}}var _=h.default.View.extend({initialize:function(e,t){var a=this;this.deferred=e.deferred,this.chart=e.chart,this.group=t.group,this.setElement((0,c.default)("<div/>")),this.listenTo(this.chart,"change:dataset_id",function(){a.render()}),this.render()},render:function(){var d=this,t=f.default.clone(this.chart.plugin.groups)||[],a=this.chart.get("dataset_id");a&&(this.chart.state("wait","Loading metadata..."),this.deferred.execute(function(e){f.default.get({url:(0,r.getAppRoot)()+"api/datasets/"+a,cache:!0,success:function(s){var o={};g.default.visitInputs(t,function(e,t){if("data_column"==e.type){o[t]=f.default.clone(e);var a=[];e.is_auto&&a.push({label:"Column: Row Number",value:"auto"}),e.is_zero&&a.push({label:"Column: None",value:"zero"});var i=s.metadata_column_types;for(var r in i)(-1!=["int","float"].indexOf(i[r])&&e.is_numeric||e.is_label)&&a.push({label:"Column: "+(parseInt(r)+1),value:r});e.data=a}var n=d.group.get(t);void 0===n||e.hidden||(e.value=n)}),t.push({name:"__data_columns",type:"hidden",hidden:!0,value:o}),d.chart.state("ok","Metadata initialized..."),d.form=new p.default({inputs:t,onchange:function(){d.group.set(d.form.data.create()),d.chart.set("modified",!0),d.chart.trigger("redraw")}}),d.group.set(d.form.data.create()),d.$el.empty().append(d.form.$el),e.resolve(),d.chart.trigger("redraw")}})}))}});e.default=h.default.View.extend({initialize:function(e){var t=this;this.app=e,this.chart=e.chart,this.repeat=new m.default.View({title:"Data series",title_new:"Data series",min:1,onnew:function(){t.chart.groups.add({id:f.default.uid()})}}),this.setElement((0,c.default)("<div/>").append(this.repeat.$el)),this.listenTo(this.chart.groups,"remove",function(e){t.repeat.del(e.id),t.chart.trigger("redraw")}),this.listenTo(this.chart.groups,"reset",function(){t.repeat.delAll()}),this.listenTo(this.chart.groups,"add",function(e){t.repeat.add({id:e.id,$el:new _(t.app,{group:e}).$el,ondel:function(){t.chart.groups.remove(e)}})})},render:function(){0<l.default.size(this.chart.plugin.groups)?this.repeat.$el.show():this.repeat.$el.hide()}})});