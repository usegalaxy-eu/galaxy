define(["exports","underscore","backbone","onload/loadConfig","mvc/history/history-contents","mvc/dataset/states","utils/ajax-queue","mvc/base-mvc"],function(t,e,n,i,o,a,u,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(e),l=p(n),c=p(o),d=p(a),f=p(u),h=p(s);function p(t){return t&&t.__esModule?t:{default:t}}var g="jobs",m=h.default.SearchableModelMixin,b=l.default.Model.extend(h.default.LoggableMixin).extend(h.default.mixin(m,{_logNamespace:g,defaults:{model_class:"Job",tool_id:null,exit_code:null,inputs:{},outputs:{},params:{},create_time:null,update_time:null,state:d.default.NEW},parse:function(t,e){return t.params=this.parseParams(t.params),t},parseParams:function(t){var n={};return r.default.each(t,function(t,e){n[e]=JSON.parse(t)}),n},initialize:function(t,e){this.debug("".concat(this,"(Job).initialize"),t,e),this.set("params",this.parseParams(this.get("params")),{silent:!0}),this.outputCollection=t.outputCollection||new c.default.HistoryContents([]),this._setUpListeners()},_setUpListeners:function(){this.on("change:state",function(t,e){this.log("".concat(this," has changed state:"),t,e),this.inReadyState()&&this.trigger("state:ready",t,e,this.previous("state"))})},inReadyState:function(){return r.default.contains(d.default.READY_STATES,this.get("state"))},hasDetails:function(){return!r.default.isEmpty(this.get("outputs"))},urlRoot:"".concat((0,i.getAppRoot)(),"api/jobs"),toString:function(){return["Job(",this.get("id"),":",this.get("tool_id"),")"].join("")}})),_=l.default.Collection.extend(h.default.LoggableMixin).extend({_logNamespace:g,model:b,urlRoot:"".concat((0,i.getAppRoot)(),"api/jobs"),url:function(){return this.urlRoot},intialize:function(t,e){console.debug(t,e)},ids:function(){return this.map(function(t){return t.get("id")})},notReady:function(){return this.filter(function(t){return!t.inReadyState()})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},queueDetailFetching:function(){var t=this,e=new f.default.AjaxQueue(this.map(function(t){return function(){return t.fetch({silent:!0})}}));return e.done(function(){t.trigger("details-loaded")}),e},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["JobCollection(",this.length,")"].join("")}},{fromHistory:function(t){console.debug(this);var e=new this([]);return e.fetch({data:{history_id:t}}).done(function(){window.queue=e.queueDetailFetching()}),e}});t.default={Job:b,JobCollection:_}});