define(["exports","libs/toastr"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,n):{};a.get||a.set?Object.defineProperty(e,n,a):e[n]=t[n]}return e.default=t,e}}(e);function a(t,e){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#25537b",t&&e&&this.connect(t,e)}$.extend(a.prototype,{connect:function(t,e){this.handle1=t,this.handle1&&this.handle1.connect(this),this.handle2=e,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),$(this.canvas).remove()},destroyIfInvalid:function(t){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&(t&&n.warning("Destroying a connection because collection type has changed."),this.destroy())},redraw:function(){var t=this.handle1,e=this.handle2,n=t&&t.isMappedOver(),a=e&&e.isMappedOver(),i="".concat(n?"start-ribbon":""," ").concat(a?"end-ribbon":""),s=$("#canvas-container"),r=window.workflow_globals.canvas_manager.canvasZoom;this.canvas||(this.canvas=document.createElement("canvas"),s.append($(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300")),this.canvas.setAttribute("handle1-id",t&&t.element.getAttribute?t.element.getAttribute("id"):""),this.canvas.setAttribute("handle2-id",e&&e.element.getAttribute?e.element.getAttribute("id"):"");var o=function(t){return($(t).offset().left-s.offset().left)/r},h=function(t){return($(t).offset().top-s.offset().top)/r};if(t&&e){var c=o(t.element)+5,l=h(t.element)+5,d=o(e.element)+5,u=h(e.element)+5,v=100,f=Math.min(c,d),b=Math.max(c,d),g=Math.min(l,u),p=Math.max(l,u),m=Math.min(Math.max(Math.abs(p-g)/2,100),300),y=f-v,_=g-v,w=b-f+200,M=p-g+200;this.canvas.style.left="".concat(y,"px"),this.canvas.style.top="".concat(_,"px"),this.canvas.setAttribute("width",w),this.canvas.setAttribute("height",M),this.canvas.setAttribute("class",i),c-=y,l-=_,d-=y,u-=_;this.canvas.getContext("2d");var O=null,x=null,A=1;if(n){O=[-6,-3,0,3,6];A=5}else O=[0];if(a){x=[-6,-3,0,3,6];A=5}else x=[0];for(var P=0;P<A;P++){var j=5,F=7;(1<O.length||1<x.length)&&(j=1,F=3),this.draw_outlined_curve(c,l,d,u,m,j,F,O[P%O.length],x[P%x.length])}}},draw_outlined_curve:function(t,e,n,a,i,s,r,o,h){o=o||0,h=h||0;var c=this.canvas.getContext("2d");c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=r,c.beginPath(),c.moveTo(t,e+o),c.bezierCurveTo(t+i,e+o,n-i,a+h,n,a+h),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=s,c.beginPath(),c.moveTo(t,e+o),c.bezierCurveTo(t+i,e+o,n-i,a+h,n,a+h),c.stroke()}}),t.default=a});