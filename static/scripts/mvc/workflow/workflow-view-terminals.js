define(["exports","mvc/workflow/workflow-terminals","mvc/workflow/workflow-connector"],function(e,n,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n),l=a(t);function a(e){return e&&e.__esModule?e:{default:e}}window.workflow_globals=window.workflow_globals||{};var r=Backbone.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(e){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",_.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),o=r.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(e){var n=this.model;!n.terminal.connected()&&n.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(e){this.$el.css("color","black")},onClick:function(e){var n=this.model;!n.terminal.connected()&&n.mapOver.isCollection&&n.terminal.resetMapping()}}),s=Backbone.View.extend({setupMappingView:function(e){var n=new this.terminalMappingClass({terminal:e}),t=new this.terminalMappingViewClass({model:n});t.render(),e.terminalMappingView=t,this.terminalMappingView=t},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),p=s.extend({className:"terminal input-terminal",initialize:function(e){var n=e.node,t=e.input,a=t.name,i="node-".concat(n.cid,"-input-").concat(a),l=this.terminalForInput(t);l.multiple||this.setupMappingView(l),this.el.terminal=l,this.$el.attr("input-name",a),this.$el.attr("id",i),this.$el.append($("<icon/>")),this.id=i,l.node=n,l.name=a,l.label=t.label,n.input_terminals[a]=l},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(e,n){var t=this.el.terminal;return $(n.drag).hasClass("output-terminal")&&t.canAccept(n.drag.terminal)},onDropStart:function(e,n){n.proxy.terminal&&(n.proxy.terminal.connectors[0].inner_color="#BBFFBB")},onDropEnd:function(e,n){n.proxy.terminal&&(n.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(e,n){var t=this.el.terminal;new l.default(n.drag.terminal,t).redraw()},onHover:function(){var e=this.el,n=e.terminal;if(0<n.connectors.length){var t=$("<div/>").addClass("delete-terminal").click(function(){$.each(n.connectors,function(e,n){n&&n.destroy()}),t.remove()}).on("mouseleave",function(){t.remove()});$(e).parent().append(t)}}}),c=p.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:o,terminalForInput:function(e){return new i.default.InputTerminal({element:this.el,input:e})}}),u=p.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:o,terminalForInput:function(e){return new i.default.InputParameterTerminal({element:this.el,input:e})}}),m=p.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:o,terminalForInput:function(e){return new i.default.InputCollectionTerminal({element:this.el,input:e})}}),d=s.extend({className:"terminal output-terminal",initialize:function(e){var n=e.node,t=e.output,a=t.name,i="node-".concat(n.cid,"-output-").concat(a),l=this.terminalForOutput(t);this.setupMappingView(l),this.el.terminal=l,this.$el.attr("output-name",a),this.$el.attr("id",i),this.$el.append($("<icon/>")),l.node=n,l.name=a,l.label=t.label,n.output_terminals[a]=l},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(e,i){var n=function(){var e=window.workflow_globals.canvas_manager.canvasZoom,n=$(i.proxy).offsetParent().offset(),t=i.offsetX-n.left,a=i.offsetY-n.top;$(i.proxy).css({left:t/e,top:a/e}),i.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};n(),$("#canvas-container").get(0).scroll_panel.test(e,n)},onDragStart:function(e,n){$(n.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var t=$("<div class='drag-terminal'/>").appendTo("#canvas-container").get(0);t.terminal=new i.default.OutputTerminal({element:t});var a=new l.default;return a.dragging=!0,a.connect(this.el.terminal,t.terminal),t},onDragEnd:function(e,n){var t=n.proxy.terminal.connectors[0];t&&t.destroy(),$(n.proxy).remove(),$(n.available).removeClass("input-terminal-active"),$("#canvas-container").get(0).scroll_panel.stop()}}),f=d.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:r,terminalForOutput:function(e){var n=e.extensions;return new i.default.OutputTerminal({element:this.el,datatypes:n})}}),w=d.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:r,terminalForOutput:function(e){var n=e.collection_type,t=e.collection_type_source;return new i.default.OutputCollectionTerminal({element:this.el,collection_type:n,collection_type_source:t,datatypes:e.extensions})}}),g=d.extend({terminalMappingClass:i.default.TerminalMapping,terminalMappingViewClass:r,terminalForOutput:function(e){e.collection_type,e.collection_type_source;return new i.default.OutputCollectionTerminal({element:this.el,type:e.type})}});e.default={InputTerminalView:c,InputParameterTerminalView:u,OutputTerminalView:f,OutputParameterTerminalView:g,InputCollectionTerminalView:m,OutputCollectionTerminalView:w}});