define(["exports","libs/underscore","mvc/workflow/workflow-view-terminals","mvc/workflow/workflow-view-data"],function(t,e,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(e),u=r(i),d=r(n);function r(t){return t&&t.__esModule?t:{default:t}}t.default=Backbone.View.extend({initialize:function(t){this.node=t.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name),this.$el.attr("node-label",this.node.label)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return $("<div/>").addClass("inputs")},updateMaxWidth:function(t){this.output_width=Math.max(this.output_width,t)},addRule:function(){this.tool_body.append($("<div/>").addClass("rule"))},addDataInput:function(t,e){var i=!0;e||(e=this.$(".inputs"),i=!1);var n=this.terminalViews[t.name],o=u.default.InputTerminalView;if("dataset_collection"==t.input_type?o=u.default.InputCollectionTerminalView:"parameter"==t.input_type&&(o=u.default.InputParameterTerminalView),!n||n instanceof o||(n.el.terminal.destroy(),n=null),n){var r=n.el.terminal;r.update(t),r.destroyInvalidConnections()}else n=new o({node:this.node,input:t});var a=(this.terminalViews[t.name]=n).el,l=new d.default.DataInputView({terminalElement:a,input:t,nodeView:this,skipResize:i}).$el;return e.append(l.prepend(n.terminalElements())),n},addDataOutput:function(t){var e=u.default.OutputTerminalView,i=d.default.DataOutputView;t.collection?e=u.default.OutputCollectionTerminalView:t.parameter&&(e=u.default.OutputParameterTerminalView,i=d.default.ParameterOutputView);var n=new e({node:this.node,output:t}),o=new i({output:t,terminalElement:n.el,nodeView:this});this.outputViews[t.name]=o,this.tool_body.append(o.$el.append(n.terminalElements()))},redrawWorkflowOutputs:function(){o.each(this.outputViews,function(t){t.redrawWorkflowOutput()})},updateDataOutput:function(t){this.node.output_terminals[t.name].update(t)}})});