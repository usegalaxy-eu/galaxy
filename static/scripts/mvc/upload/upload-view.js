define(["exports","utils/localization","utils/utils","mvc/ui/ui-modal","mvc/ui/ui-tabs","mvc/upload/upload-utils","mvc/upload/upload-button","mvc/upload/default/default-view","mvc/upload/composite/composite-view","mvc/upload/collection/collection-view","mvc/upload/collection/rules-input-view","app"],function(e,t,i,o,l,a,s,n,u,d,r,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=x(t),_=x(i),p=x(o),h=x(l),m=x(a),g=x(s),w=x(n),v=x(u),b=x(d),y=x(r);function x(e){return e&&e.__esModule?e:{default:e}}e.default=Backbone.View.extend({options:{ftp_upload_site:"n/a",default_genome:m.default.DEFAULT_GENOME,default_extension:m.default.DEFAULT_EXTENSION,height:500,width:900,auto:m.default.AUTO_EXTENSION},list_extensions:[],list_genomes:[],initialize:function(e){var t=this;this.options=_.default.merge(e,this.options),this.ui_button=new g.default.View({onclick:function(e){e.preventDefault(),t.show()},onunload:function(){var e=t.ui_button.model.get("percentage",0);if(0<e&&e<100)return"Several uploads are queued."}}),this.setElement(this.ui_button.$el),m.default.getUploadDatatypes(function(e){t.list_extensions=e},this.options.datatypes_disable_auto,this.options.auto),m.default.getUploadGenomes(function(e){t.list_genomes=e},this.default_genome)},show:function(){var e=(0,c.getGalaxyInstance)(),t=this;e.currHistoryPanel&&e.currHistoryPanel.model?(this.current_user=e.user.id,this.modal||(this.tabs=new h.default.View,this.default_view=new w.default(this),this.tabs.add({id:"regular",title:(0,f.default)("Regular"),$el:this.default_view.$el}),this.composite_view=new v.default(this),this.tabs.add({id:"composite",title:(0,f.default)("Composite"),$el:this.composite_view.$el}),this.collection_view=new b.default(this),this.tabs.add({id:"collection",title:(0,f.default)("Collection"),$el:this.collection_view.$el}),this.rule_based_view=new y.default(this),this.tabs.add({id:"rule-based",title:(0,f.default)("Rule-based"),$el:this.rule_based_view.$el}),this.modal=new p.default.View({title:(0,f.default)("Download from web or upload from disk"),body:this.tabs.$el,height:this.options.height,width:this.options.width,closing_events:!0,title_separator:!1})),this.modal.show()):window.setTimeout(function(){t.show()},500)},currentHistory:function(){var e=(0,c.getGalaxyInstance)();return this.current_user&&e.currHistoryPanel.model.get("id")},currentFtp:function(){return this.current_user&&this.options.ftp_upload_site},toData:function(e,t){var i={payload:{tool_id:"upload1",history_id:t||this.currentHistory(),inputs:{}},files:[],error_message:null};if(e&&0<e.length){var o={file_count:e.length,dbkey:e[0].get("genome","?"),file_type:e[0].get("extension")||"auto"};for(var l in e){var a=e[l];if(a.set("status","running"),!(0<a.get("file_size"))){i.error_message="Upload content incomplete.",a.set("status","error"),a.set("info",i.error_message);break}var s="files_".concat(l,"|");switch(o["".concat(s,"type")]="upload_dataset","New File"!=a.get("file_name")&&(o["".concat(s,"NAME")]=a.get("file_name")),o["".concat(s,"space_to_tab")]=a.get("space_to_tab")?"Yes":null,o["".concat(s,"to_posix_lines")]=a.get("to_posix_lines")?"Yes":null,o["".concat(s,"dbkey")]=a.get("genome",null),o["".concat(s,"file_type")]=a.get("extension",null),a.get("file_mode")){case"new":o["".concat(s,"url_paste")]=a.get("url_paste");break;case"ftp":o["".concat(s,"ftp_files")]=a.get("file_path");break;case"local":i.files.push({name:"".concat(s,"file_data"),file:a.get("file_data")})}}i.payload.inputs=JSON.stringify(o)}return i}})});