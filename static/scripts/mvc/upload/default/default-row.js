define(["exports","utils/localization","utils/utils","mvc/upload/upload-model","mvc/upload/upload-settings","mvc/ui/ui-popover","mvc/upload/upload-extension","mvc/ui/ui-select"],function(e,t,s,i,n,o,a,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=f(t),h=f(s),r=(f(i),f(n)),c=f(o),u=f(a),p=f(l);function f(e){return e&&e.__esModule?e:{default:e}}e.default=Backbone.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",warning:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},initialize:function(e,t){var s=this,i=this;this.app=e,this.list_extensions=e.list_extensions,this.model=t.model,this.setElement(this._template(t.model)),this.$mode=this.$(".upload-mode"),this.$title=this.$(".upload-title"),this.$text=this.$(".upload-text"),this.$size=this.$(".upload-size"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$text_content=this.$(".upload-text-content"),this.$settings=this.$(".upload-settings"),this.$symbol=this.$(".upload-symbol"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.settings=new c.default({title:(0,d.default)("Upload configuration"),container:this.$(".upload-settings"),placement:"bottom"});var n=this.app.select_genome.value(),o=this.app.select_extension.value();this.select_genome=new p.default.View({css:"upload-genome",data:i.app.list_genomes,container:this.$(".upload-genome"),value:n,onchange:function(e){i.model.set("genome",e)}}),this.select_extension=new p.default.View({css:"upload-extension",data:_.filter(this.list_extensions,function(e){return!e.composite_files}),container:this.$(".upload-extension"),value:o,onchange:function(e){i.model.set("extension",e)}}),this.model.set({genome:n,extension:o}),this.$symbol.on("click",function(){i._removeRow()}),this.$(".upload-extension-info").on("click",function(e){var t=s.upload_extension;t?t.extension_popup.visible?t.extension_popup.hide():(t.extension_popup.remove(),s._makeUploadExtensionsPopover(e)):s._makeUploadExtensionsPopover(e)}).on("mousedown",function(e){e.preventDefault()}),this.$settings.on("click",function(e){i._showSettings()}).on("mousedown",function(e){e.preventDefault()}),this.$text_content.on("change input",function(e){i.model.set({url_paste:$(e.target).val(),file_size:$(e.target).val().length})}),this.$title.on("change input",function(e){i.model.set({file_name:$(e.target).val()})}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:genome",function(){i._refreshGenome()}),this.listenTo(this.model,"change:extension",function(){i._refreshExtension()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()})},render:function(){this._refreshType(),this._refreshPercentage(),this._refreshStatus(),this._refreshInfo(),this._refreshGenome(),this._refreshExtension(),this._refreshFileSize()},remove:function(){this.select_genome.remove(),this.select_extension.remove(),Backbone.View.prototype.remove.apply(this)},_refreshType:function(){var e=this.model.attributes;this.$title.val(_.escape(e.file_name)),this.$size.html(h.default.bytesToString(e.file_size)),this.$mode.removeClass().addClass("upload-mode").addClass("text-primary"),"new"==e.file_mode?(this.$text.css({width:"".concat(this.$el.width()-16,"px"),top:"".concat(this.$el.height()-8,"px")}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$mode.addClass("fa fa-edit")):"local"==e.file_mode?this.$mode.addClass("fa fa-laptop"):"ftp"==e.file_mode&&this.$mode.addClass("fa fa-folder-open-o")},_refreshExtension:function(){this.select_extension.value(this.model.get("extension"))},_refreshGenome:function(){this.select_genome.value(this.model.get("genome"))},_refreshInfo:function(){var e=this.model.get("info");e?this.$info_text.html("<strong>Warning: </strong>".concat(e)).show():this.$info_text.hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));this.$progress_bar.css({width:"".concat(e,"%")}),this.$percentage.html(100!=e?"".concat(e,"%"):"Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$symbol.removeClass().addClass("upload-symbol").addClass(this.status_classes[e]),this.model.set("enabled","init"==e);var t=this.model.get("enabled");this.$text_content.attr("disabled",!t),this.$title.attr("disabled",!t),t?(this.select_genome.enable(),this.select_extension.enable()):(this.select_genome.disable(),this.select_extension.disable()),this.$info_progress.show(),this.$el.removeClass().addClass("upload-row"),"success"==e?(this.$el.addClass("table-success"),this.$percentage.html("100%")):"error"==e?(this.$el.addClass("table-danger"),this.$info_progress.hide()):"warning"==e&&(this.$el.addClass("table-warning"),this.$info_progress.hide())},_refreshFileSize:function(){this.$size.html(h.default.bytesToString(this.model.get("file_size")))},_removeRow:function(){-1!==["init","success","error"].indexOf(this.model.get("status"))&&this.app.collection.remove(this.model)},_showSettings:function(){this.settings.show(new r.default(this).$el)},_makeUploadExtensionsPopover:function(e){this.upload_extension=new u.default({$el:$(e.target),title:this.select_extension.text(),extension:this.select_extension.value(),list:this.list_extensions})},_template:function(e){return'<tr id="upload-row-'.concat(e.id,'" class="upload-row">\n                    <td>\n                        <div class="upload-text-column">\n                            <div class="upload-mode"/>\n                            <input class="upload-title ml-2 border rounded"/>\n                            <div class="upload-text">\n                                <div class="upload-text-info">\n                                    You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.\n                                </div>\n                                <textarea class="upload-text-content form-control"/>\n                            </div>\n                        </div>\n                    </td>\n                    <td>\n                        <div class="upload-size"/>\n                    </td>\n                    <td>\n                        <div class="upload-extension float-left mr-1"/>\n                        <div class="upload-extension-info upload-icon-button fa fa-search"/>\n                    </td>\n                    <td>\n                        <div class="upload-genome"/>\n                    </td>\n                    <td>\n                        <div class="upload-settings upload-icon-button fa fa-gear"/>\n                    </td>\n                    <td>\n                        <div class="upload-info">\n                            <div class="upload-info-text"/>\n                            <div class="upload-info-progress progress">\n                                <div class="upload-progress-bar progress-bar progress-bar-success"/>\n                                <div class="upload-percentage">0%</div>\n                            </div>\n                        </div>\n                    </td>\n                    <td>\n                        <div class="upload-symbol ').concat(this.status_classes.init,'"/>\n                    </td>\n                </tr>')}})});