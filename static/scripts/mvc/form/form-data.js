define(["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=t.Manager=Backbone.Model.extend({initialize:function(t){this.app=t},checksum:function(){var e="",n=this;return this.app.section.$el.find(".section-row").each(function(){var t=$(this).attr("id"),a=n.app.field_list[t];a&&(e+="".concat(t,":").concat(JSON.stringify(a.value&&a.value()),":").concat(a.collapsed,":").concat(a.connected,";"))}),e},create:function(){var m=this,t={};this._iterate(this.app.section.$el,t);var n={};function b(t,a,e){m.flat_dict[t]=a,n[t]=e,m.app.element_list[a]&&m.app.element_list[a].$el.attr("tour_id",t)}return this.flat_dict={},function t(a,e){for(var n in e){var i=e[n];if(i.input){var c=i.input,r=a;switch(""!==a&&(r+="|"),r+=c.name,c.type){case"repeat":var s="section-",o=[],l=null;for(var u in i){var f=u.indexOf(s);-1!=f&&(f+=s.length,o.push(parseInt(u.substr(f))),l||(l=u.substr(0,f)))}for(var p in o.sort(function(t,a){return t-a}),n=0,o)t("".concat(r,"_").concat(n++),i[l+o[p]]);break;case"conditional":var d=m.app.field_list[c.id].value();b("".concat(r,"|").concat(c.test_param.name),c.id,d);var v=y(c,d);-1!=v&&t(r,e["".concat(c.id,"-section-").concat(v)]);break;case"section":t(!c.flat&&r||"",i);break;default:var _=m.app.field_list[c.id];if(_&&_.value&&(d=_.value(),(void 0===c.ignore||c.ignore!=d)&&(_.connected?d={__class__:"ConnectedValue"}:_.collapsed&&c.collapsible_value&&(d=c.collapsible_value),b(r,c.id,d),c.payload)))for(var h in c.payload)b(h,c.id,c.payload[h])}}}}("",t),n},match:function(t){return this.flat_dict&&this.flat_dict[t]},matchCase:function(t,a){return y(t,a)},matchModel:function(t,e){var n=this;i(t.inputs,function(t,a){n.flat_dict[a]&&e(t,n.flat_dict[a])})},matchResponse:function(t){var s={},o=this;return function t(a,e){if("string"==typeof e){var n=o.flat_dict[a];n&&(s[n]=e)}else for(var i in e){var c=i;if(""!==a){var r="|";e instanceof Array&&(r="_"),c=a+r+c}t(c,e[i])}}("",t),s},_iterate:function(t,e){var n=this;$(t).children().each(function(){var t=$(this).attr("id");if($(this).hasClass("section-row")){var a=n.app.input_list[t];e[t]=a&&{input:a}||{},n._iterate(this,e[t])}else n._iterate(this,e)})}}),y=function(t,a){for(var e in"boolean"==t.test_param.type&&(a="true"==a?t.test_param.truevalue||"true":t.test_param.falsevalue||"false"),t.cases)if(t.cases[e].value==a)return e;return-1};t.matchCase=y;var i=t.visitInputs=function e(t,n,a,i){for(var c in i=$.extend({},i),_.each(t,function(t){t&&t.type&&t.name&&(i[t.name]=t)}),t){var r=t[c];r.name=r.name||c;var s=a?"".concat(a,"|").concat(r.name):r.name;switch(r.type){case"repeat":_.each(r.cache,function(t,a){e(t,n,"".concat(s,"_").concat(a),i)});break;case"conditional":if(r.test_param){n(r.test_param,"".concat(s,"|").concat(r.test_param.name),i);var o=y(r,r.test_param.value);-1!=o?e(r.cases[o].inputs,n,s,i):Galaxy.emit.debug("form-data::visitInputs() - Invalid case for ".concat(s,"."))}else Galaxy.emit.debug("form-data::visitInputs() - Conditional test parameter missing for ".concat(s,"."));break;case"section":e(r.inputs,n,s,i);break;default:n(r,s,i)}}};t.default={Manager:a,visitInputs:i}});