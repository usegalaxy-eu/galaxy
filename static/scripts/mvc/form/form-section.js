define(["exports","utils/utils","mvc/ui/ui-misc","mvc/ui/ui-portlet","mvc/form/form-repeat","mvc/form/form-input","mvc/form/form-parameters"],function(e,t,a,i,n,d,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=u(t),p=(u(a),u(i)),o=u(n),c=u(d),r=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var h=Backbone.View.extend({initialize:function(e,t){this.app=e,this.inputs=t.inputs,this.parameters=new r.default,this.setElement($("<div/>")),this.render()},render:function(){var t=this;this.$el.empty(),_.each(this.inputs,function(e){t.add(e)})},add:function(e){var t=jQuery.extend({},e);switch(t.id=l.default.uid(),(this.app.input_list[t.id]=t).type){case"conditional":this._addConditional(t);break;case"repeat":this._addRepeat(t);break;case"section":this._addSection(t);break;default:this._addRow(t)}},_addConditional:function(l){var p=this;l.test_param.id=l.id,l.test_param.textable=!1,this.app.model.get("sustain_conditionals")&&(l.test_param.disabled=!0);var e=this._addRow(l.test_param);if(e.model){for(var t in l.cases){var a=new h(this.app,{inputs:l.cases[t].inputs});this._append(a.$el.addClass("ui-portlet-section pl-2"),"".concat(l.id,"-section-").concat(t))}e.model.set("onchange",function(e){var t=p.app.data.matchCase(l,e);for(var a in l.cases){var i=l.cases[a],n=p.$("#".concat(l.id,"-section-").concat(a)),d=!1;for(var s in i.inputs)if(!i.inputs[s].hidden){d=!0;break}a==t&&d?n.fadeIn("fast"):n.hide()}p.app.trigger("change")}),e.trigger("change")}},_addRepeat:function(i){var n=this,d=0,s=new o.default.View({title:i.title||"Repeat",min:i.min,max:i.max,onnew:function(){e(i.inputs),n.app.trigger("change")}});function e(e){var t="".concat(i.id,"-section-").concat(d++),a=new h(n.app,{inputs:e});s.add({id:t,$el:a.$el,ondel:function(){s.del(t),n.app.trigger("change")}})}for(var t=_.size(i.cache),a=0;a<Math.max(Math.max(t,i.min||0),i.default||0);a++)e(a<t?i.cache[a]:i.inputs);this.app.model.get("sustain_repeats")&&s.hideOptions();var l=new c.default(this.app,{label:i.title||i.name,help:i.help,field:s});this._append(l.$el,i.id)},_addSection:function(e){var t=new p.default.View({title:e.title||e.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!e.expanded});t.append(new h(this.app,{inputs:e.inputs}).$el),t.append($("<div/>").addClass("form-text text-muted").html(e.help)),this.app.on("expand",function(e){0<t.$("#".concat(e)).length&&t.expand()}),this._append(t.$el,e.id)},_addRow:function(e){var t=this,a=e.id;e.onchange=e.onchange||function(){t.app.trigger("change",a)};var i=this.parameters.create(e);this.app.field_list[a]=i;var n=new c.default(this.app,{name:e.name,label:e.hide_label?"":e.label||e.name,value:e.value,text_value:e.text_value,collapsible_value:e.collapsible_value,collapsible_preview:e.collapsible_preview,connectable:e.connectable,help:e.help,argument:e.argument,disabled:e.disabled,color:e.color,style:e.style,backdrop:e.backdrop,hidden:e.hidden,fixed:e.fixed,field:i});return this.app.element_list[a]=n,this._append(n.$el,e.id),i},_append:function(e,t){this.$el.append(e.addClass("section-row").attr("id",t))}});e.default={View:h}});