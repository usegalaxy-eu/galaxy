define(["exports","jquery","backbone","onload/loadConfig","mvc/form/form-view","mvc/ui/ui-misc"],function(e,t,i,a,s,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=d(t),r=d(i),l=d(s),u=d(n);function d(e){return e&&e.__esModule?e:{default:e}}var c=r.default.View.extend({initialize:function(e){this.model=new r.default.Model(e),this.url=this.model.get("url"),this.redirect=this.model.get("redirect"),e&&e.active_tab&&(this.active_tab=e.active_tab),this.setElement("<div/>"),this.render()},render:function(){var s=this;o.default.ajax({url:(0,a.getAppRoot)()+this.url,type:"GET"}).done(function(e){var t=o.default.extend({},s.model.attributes,e),i=new l.default({title:t.title,title_id:t.title_id,message:t.message,status:t.status||"warning",icon:t.icon,initial_errors:!0,errors:t.errors,inputs:t.inputs,buttons:{submit:new u.default.Button({tooltip:t.submit_tooltip,title:t.submit_title||"Save",icon:t.submit_icon||"fa-save",cls:"btn btn-primary",onclick:function(){s._submit(i)}})}});s.$el.empty().append(i.$el)}).fail(function(e){s.$el.empty().append(new u.default.Message({message:"Failed to load resource ".concat(s.url,"."),status:"danger",persistent:!0}).$el)})},_submit:function(i){var s=this;o.default.ajax({url:(0,a.getAppRoot)()+s.url,data:JSON.stringify(i.data.create()),type:"PUT",contentType:"application/json"}).done(function(e){var t={};e.id?t.id=e.id:t={message:e.message,status:"success",persistent:!1},s.redirect?window.location="".concat((0,a.getAppRoot)()+s.redirect,"?").concat(o.default.param(t)):(i.data.matchModel(e,function(e,t){i.field_list[t].value(e.value)}),s._showMessage(i,e.message))}).fail(function(e){s._showMessage(i,{message:e.responseJSON.err_msg,status:"danger",persistent:!1})})},_showMessage:function(e,t){e.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf((0,o.default)(this).css("overflow"))}).first().animate({scrollTop:0},500),e.message.update(t)}});e.default={View:c}});