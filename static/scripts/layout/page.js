define(["exports","underscore","jquery","backbone","onload/loadConfig","app","layout/data","layout/masthead","layout/panel","mvc/ui/ui-modal","utils/utils"],function(e,t,i,s,a,l,n,o,d,c,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=b(t),u=b(i),f=b(s),v=b(n),m=b(o),g=b(d),_=b(c),p=b(h);function b(e){return e&&e.__esModule?e:{default:e}}var x=f.default.View.extend({el:"body",className:"full-content",_panelids:["left","right"],initialize:function(n){var o=this,d=this;this.config=r.default.defaults(n.config||{},{message_box_visible:!1,message_box_content:"",message_box_class:"info",show_inactivity_warning:!1,inactivity_box_content:"",hide_panels:!1,hide_masthead:!1});var e=(0,l.getGalaxyInstance)();e.modal=this.modal=new _.default.View,e.router=this.router=n.Router&&new n.Router(d,n),e.data=this.data=new v.default(this),this.masthead=new m.default.View(this.config),this.center=new g.default.CenterPanel,e.display=this.display=function(e){e.title?(p.default.setWindowTitle(e.title),e.allow_title_display=!1):(p.default.setWindowTitle(),e.allow_title_display=!0),e.active_tab&&d.masthead.highlight(e.active_tab),d.center.display(e)},this.$el.attr("scroll","no"),this.$el.html(this._template()),this.$masthead=this.$("#masthead"),this.$center=this.$("#center"),this.$messagebox=this.$("#messagebox"),this.$inactivebox=this.$("#inactivebox"),this.config.hide_masthead?(this.$masthead.remove(),this.$center.css("top",0)):this.$masthead.replaceWith(this.masthead.$el),this.$center.append(this.center.$el),this.$el.append(this.masthead.frame.$el),this.$el.append(this.modal.$el),this.panels={},this.config.hide_panels||r.default.each(this._panelids,function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),i=n[t];if(i){var s=new i(d,n),a=d.$("#".concat(e));d[s.toString()]=s,d.panels[e]=new g.default.SidePanel({id:e,el:a,view:s}),o.config.hide_masthead&&a.css("top",0)}}),this.render(),this.router&&f.default.history.start({root:(0,a.getAppRoot)(),pushState:!0})},render:function(){return(0,u.default)(".select2-hidden-accessible").remove(),this.config.hide_masthead||(this.masthead.render(),this.renderMessageBox(),this.renderInactivityBox()),this.renderPanels(),this._checkCommunicationServerOnline(),this},renderMessageBox:function(){if(this.config.message_box_visible){var e=this.config.message_box_content||"",t=this.config.message_box_class||"info";this.$el.addClass("has-message-box"),this.$messagebox.attr("class","panel-".concat(t,"-message")).html(e).toggle(!!e).show()}else this.$el.removeClass("has-message-box"),this.$messagebox.hide();return this},renderInactivityBox:function(){if(this.config.show_inactivity_warning){var e=this.config.inactivity_box_content||"",t=(0,u.default)("<a/>").attr("href","".concat((0,a.getAppRoot)(),"user/resend_verification")).text("Resend verification");this.$el.addClass("has-inactivity-box"),this.$inactivebox.html("".concat(e," ")).append(t).toggle(!!e).show()}else this.$el.removeClass("has-inactivity-box"),this.$inactivebox.hide();return this},renderPanels:function(){var i=this;return r.default.each(this._panelids,function(e){var t=i.panels[e];t?t.render():(i.$center.css(e,0),i.$("#".concat(e)).hide())}),this},_template:function(){return['<div id="everything">\n                <div id="background"/>\n                <div id="masthead"/>\n                <div id="messagebox"/>\n                <div id="inactivebox" class="panel-warning-message" />\n                <div id="columns">\n                    <div id="left" class="unified-panel"/>\n                    <div id="center" />\n                    <div id="right" class="unified-panel" />\n                </div>\n            </div>\n            <div id="dd-helper" />'].join("")},toString:function(){return"PageLayoutView"},_checkCommunicationServerOnline:function(){var t=(0,l.getGalaxyInstance)(),e=t.config.communication_server_host,i=t.config.communication_server_port,s=t.user.attributes.preferences,a=(0,u.default)("#show-chat-online");s&&-1!=["1","true"].indexOf(s.communication_server)?u.default.ajax({url:"".concat(e,":").concat(i)}).success(function(e){null!==t.user.id&&"hidden"===a.css("visibility")&&a.css("visibility","visible")}).error(function(e){a.css("visibility","hidden")}):a.css("visibility","hidden")}});e.default={View:x}});