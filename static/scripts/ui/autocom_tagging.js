define(["exports","jquery"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=e)&&a.__esModule?a:{default:a};var o=r.default;function c(t,e){o(t).find(".tag-name").each(function(){o(this).click(function(){var t=o(this).text().split(":");return e(t[0],t[1]),!0})})}r.default.fn.autocomplete_tagging=function(t){var e={get_toggle_link_text_fn:function(t){var e=_.size(t);return 0<e?e+(1<e?" Tags":" Tag"):"Add tags"},tag_click_fn:function(t,e){},editable:!0,input_size:20,in_form:!1,tags:{},use_toggle_link:!0,item_id:"",add_tag_img:"",add_tag_img_rollover:"",delete_tag_img:"",ajax_autocomplete_tag_url:"",ajax_retag_url:"",ajax_delete_tag_url:"",ajax_add_tag_url:""},g=r.default.extend(e,t),a=o(this),s=a.find(".tag-area"),u=a.find(".toggle-link"),i=a.find(".tag-input"),n=a.find(".add-tag-button");u.click(function(){var t;return t=s.is(":hidden")?function(){0===o(this).find(".tag-button").length&&s.click()}:function(){s.blur()},s.slideToggle("fast",t),o(this)}),g.editable&&i.hide(),i.keyup(function(t){if(27===t.keyCode)o(this).trigger("blur");else if(13===t.keyCode||188===t.keyCode||32===t.keyCode){var e=this.value;if(-1!==e.indexOf(": ",e.length-2))return this.value=e.substring(0,e.length-1),!1;if(188!==t.keyCode&&32!==t.keyCode||(e=e.substring(0,e.length-1)),(e=o.trim(e)).length<2)return!1;this.value="";var a=function(e){var t=o("<img/>").attr("src",g.delete_tag_img).addClass("delete-tag-img");d(t);var a=o("<span>").text(e).addClass("tag-name");a.click(function(){var t=e.split(":");return g.tag_click_fn(t[0],t[1]),!0});var i=o("<span></span>").addClass("tag-button");i.append(a),g.editable&&i.append(t);return i}(e),i=s.children(".tag-button");if(0!==i.length)i.slice(i.length-1).after(a);else s.prepend(a);var n=e.split(":");g.tags[n[0]]=n[1];var l=g.get_toggle_link_text_fn(g.tags);u.text(l);var r=o(this);return o.ajax({url:g.ajax_add_tag_url,data:{new_tag:e},error:function(){a.remove(),delete g.tags[n[0]];var t=g.get_toggle_link_text_fn(g.tags);u.text(t),alert("Add tag failed")},success:function(){r.data("autocompleter").cacheFlush()}}),!1}});var l={selectFirst:!1,formatItem:function(t,e,a,i,n){var l=i.split(":");return 1===l.length?l[0]:l[1]},autoFill:!1,highlight:!1};function d(r){o(r).mouseenter(function(){o(this).attr("src",g.delete_tag_img_rollover)}),o(r).mouseleave(function(){o(this).attr("src",g.delete_tag_img)}),o(r).click(function(){var t=o(this).parent(),e=t.find(".tag-name").eq(0).text().split(":"),a=e[0],i=e[1],n=t.prev();t.remove(),delete g.tags[a];var l=g.get_toggle_link_text_fn(g.tags);return u.text(l),o.ajax({url:g.ajax_delete_tag_url,data:{tag_name:a},error:function(){g.tags[a]=i,n.hasClass("tag-button")?n.after(t):s.prepend(t),alert("Remove tag failed"),u.text(g.get_toggle_link_text_fn(g.tags)),r.mouseenter(function(){o(this).attr("src",g.delete_tag_img_rollover)}),r.mouseleave(function(){o(this).attr("src",g.delete_tag_img)})},success:function(){}}),!0})}i.autocomplete_verheul(g.ajax_autocomplete_tag_url,l),a.find(".delete-tag-img").each(function(){d(o(this))}),c(o(this),g.tag_click_fn),n.click(function(){return o(this).hide(),s.click(),!1}),g.editable&&(s.bind("blur",function(t){0<_.size(g.tags)&&(n.show(),i.hide(),s.removeClass("active-tag-area"))}),s.click(function(t){var e=o(this).hasClass("active-tag-area");if(o(t.target).hasClass("delete-tag-img")&&!e)return!1;if(o(t.target).hasClass("tag-name")&&!e)return!1;o(this).addClass("active-tag-area"),n.hide(),i.show(),i.focus();return o(window).bind("click.tagging_blur",function(t){!function(t,e){t.attr("id"),e!==t&&(t.blur(),o(window).unbind("click.tagging_blur"),o(this).addClass("tooltip"))}(s,o(t.target))}),!1})),g.use_toggle_link&&s.hide()},t.default=c});