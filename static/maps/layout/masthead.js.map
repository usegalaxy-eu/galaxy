{"version":3,"sources":["layout/masthead.js"],"names":["Backbone","View","extend","initialize","options","self","setElement","_template","$navbarBrandLink","$","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","collection","Collection","on","append","Tab","model","render","$el","empty","each","callback","m","fetch","highlight","active_view","Galaxy","frame","quotaMeter","UserQuotaMeter","user","el","window","$download_link","e","target","closest","length","attr","hide","preventDefault","text","q","get","html","brand","logo_url","logo_src","id","forEach","set"],"mappings":"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","file":"../../scripts/layout/masthead.js","sourcesContent":["import * as Backbone from \"backbone\";\nimport Menu from \"layout/menu\";\nimport Scratchbook from \"layout/scratchbook\";\nimport QuotaMeter from \"mvc/user/user-quotameter\";\n\n/* global Galaxy */\n/* global $ */\n\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.options = options;\n        this.setElement(this._template());\n        this.$navbarBrandLink = this.$(\".navbar-brand\");\n        this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n        this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n        this.$navbarTabs = this.$(\".navbar-nav\");\n        this.$quoteMeter = this.$(\".quota-meter-container\");\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection\n            .on(\"add\", model => {\n                self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n            })\n            .on(\"reset\", () => {\n                self.$navbarTabs.empty();\n            })\n            .on(\"dispatch\", callback => {\n                self.collection.each(m => {\n                    callback(m);\n                });\n            })\n            .fetch(this.options);\n\n        // highlight initial active view\n        this.highlight(options.active_view);\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook({\n            collection: this.collection\n        });\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model: Galaxy.user,\n            el: this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $(window)\n            .on(\"click\", e => {\n                var $download_link = $(e.target).closest(\"a[download]\");\n                if ($download_link.length == 1) {\n                    if ($(\"iframe[id=download]\").length === 0) {\n                        $(\"body\").append(\n                            $(\"<iframe/>\")\n                                .attr(\"id\", \"download\")\n                                .hide()\n                        );\n                    }\n                    $(\"iframe[id=download]\").attr(\"src\", $download_link.attr(\"href\"));\n                    e.preventDefault();\n                }\n            })\n            .on(\"beforeunload\", () => {\n                var text = \"\";\n                self.collection.each(model => {\n                    var q = model.get(\"onbeforeunload\") && model.get(\"onbeforeunload\")();\n                    if (q) {\n                        text += `${q} `;\n                    }\n                });\n                if (text !== \"\") {\n                    return text;\n                }\n            });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html(`Galaxy ${(this.options.brand && `/ ${this.options.brand}`) || \"\"}`);\n        this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n        this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n        this.quotaMeter.render();\n        return this;\n    },\n\n    highlight: function(id) {\n        this.collection.forEach(function(model) {\n            model.set(\"active\", model.id == id);\n        });\n    },\n\n    /** body template */\n    _template: function() {\n        return `\n            <nav id=\"masthead\" class=\"navbar navbar-expand fixed-top justify-content-center navbar-dark\">\n                <a class=\"navbar-brand\">\n                    <img class=\"navbar-brand-image\"/>\n                    <span class=\"navbar-brand-title\"/>\n                </a>\n                <ul class=\"navbar-nav\"/>\n                <div class=\"quota-meter-container\"/>\n            </nav>`;\n    }\n});\n\nexport default {\n    View: View\n};\n"]}